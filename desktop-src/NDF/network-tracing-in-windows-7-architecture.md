---
title: Traccia di rete nell'architettura di Windows 7
description: Nella figura seguente è illustrata l'architettura di base della traccia di rete in Windows 7.
ms.assetid: b3023469-0f98-451c-b39f-c3eae771eacc
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 41221ebf434c05a8c9b7c8489e861128029b5320
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "106300370"
---
# <a name="network-tracing-in-windows-7-architecture"></a><span data-ttu-id="ed715-103">Traccia di rete in Windows 7: architettura</span><span class="sxs-lookup"><span data-stu-id="ed715-103">Network Tracing in Windows 7: Architecture</span></span>

<span data-ttu-id="ed715-104">Nella figura seguente è illustrata l'architettura di base della traccia di rete in Windows 7.</span><span class="sxs-lookup"><span data-stu-id="ed715-104">The illustration below shows the basic network tracing architecture in Windows 7.</span></span>

![diagramma dell'architettura di traccia di rete](images/ut1.png)

<span data-ttu-id="ed715-106">La traccia di rete utilizza il Framework di Event Tracing for Windows (ETW) disponibile in Windows.</span><span class="sxs-lookup"><span data-stu-id="ed715-106">Network tracing utilizes the Event Tracing for Windows (ETW) framework available in Windows.</span></span> <span data-ttu-id="ed715-107">I componenti di rete (ad esempio Winsock, TCP/IP, NDIS, acquisizione pacchetti e così via) vengono registrati come provider di traccia ETW ed emettono eventi correlati all'attività di rete.</span><span class="sxs-lookup"><span data-stu-id="ed715-107">Network components (such as Winsock, TCP/IP, NDIS, packet-capture, and so on) register as ETW trace providers and emit events related to network activity.</span></span> <span data-ttu-id="ed715-108">Qualsiasi attività registrabile di significato può essere un evento registrato in ETW.</span><span class="sxs-lookup"><span data-stu-id="ed715-108">Any recordable activity of significance can be an event logged to ETW.</span></span> <span data-ttu-id="ed715-109">La traccia per questi componenti di rete e le acquisizioni di pacchetti può essere abilitata usando il contesto di **traccia Netsh** che funge da controller ETW.</span><span class="sxs-lookup"><span data-stu-id="ed715-109">Tracing for these network components and packet captures can be enabled using the **netsh trace** context which acts as an ETW controller.</span></span>

<span data-ttu-id="ed715-110">Le tracce generate vengono raccolte in un file di log di traccia eventi (ETL).</span><span class="sxs-lookup"><span data-stu-id="ed715-110">The generated traces are collected in an Event Trace Log (ETL) file.</span></span> <span data-ttu-id="ed715-111">Questi file ETL possono quindi essere analizzati utilizzando diversi strumenti, ad esempio Network Monitor 3,2 e versioni successive, Visualizzatore eventi, **netsh trace Convert** o Tracerpt.exe.</span><span class="sxs-lookup"><span data-stu-id="ed715-111">These ETL files can then be analyzed using a number of tools, such as Network Monitor 3.2 and later, Event Viewer, **netsh trace convert**, or Tracerpt.exe.</span></span>

<span data-ttu-id="ed715-112">Ogni evento ETW dispone di un'intestazione comune in cui ETW archivia informazioni quali le proprietà, i timestamp e l'ID attività dell'evento.</span><span class="sxs-lookup"><span data-stu-id="ed715-112">Each ETW event has a common header where ETW stores information such as the event properties, time stamps, and activity ID.</span></span> <span data-ttu-id="ed715-113">Per ulteriori informazioni sugli ID attività, vedere [scrittura di eventi correlati in uno scenario end-to-end](../etw/writing-related-events-in-an-end-to-end-scenario.md).</span><span class="sxs-lookup"><span data-stu-id="ed715-113">(For more information about activity IDs, see [Writing Related Events in an End-to-End Scenario](../etw/writing-related-events-in-an-end-to-end-scenario.md)).</span></span> <span data-ttu-id="ed715-114">L'ID attività viene utilizzato per correlare gli eventi.</span><span class="sxs-lookup"><span data-stu-id="ed715-114">The activity ID is used to correlate events.</span></span> <span data-ttu-id="ed715-115">In modalità utente gli ID attività vengono archiviati nei thread e tutti gli eventi registrati in un thread verranno automaticamente contrassegnati con lo stesso ID attività.</span><span class="sxs-lookup"><span data-stu-id="ed715-115">In user mode, activity IDs are stored in threads, and all events logged in one thread will automatically be tagged with the same activity ID.</span></span> <span data-ttu-id="ed715-116">In modalità kernel, l'ID attività deve essere passato in modo esplicito quando viene registrato un evento.</span><span class="sxs-lookup"><span data-stu-id="ed715-116">In kernel mode, the activity ID must be explicitly passed when an event is logged.</span></span> <span data-ttu-id="ed715-117">Per impostazione predefinita, i file ETL sono correlati a raggruppare gli eventi in ID attività specifici.</span><span class="sxs-lookup"><span data-stu-id="ed715-117">By default, ETL files are correlated to group events together under specific activity IDs.</span></span>

<span data-ttu-id="ed715-118">Per ulteriori informazioni sugli eventi di Windows e ETW, vedere [eventi di Windows](../events/windows-events.md).</span><span class="sxs-lookup"><span data-stu-id="ed715-118">For more information about Windows Events and ETW, see [Windows Events](../events/windows-events.md).</span></span>

## <a name="etw-components-in-network-tracing"></a><span data-ttu-id="ed715-119">Componenti ETW nella traccia di rete</span><span class="sxs-lookup"><span data-stu-id="ed715-119">ETW Components in Network Tracing</span></span>

<span data-ttu-id="ed715-120">La traccia di rete usa ETW come meccanismo di traccia principale per fornire informazioni sulle attività dei sottosistemi di rete.</span><span class="sxs-lookup"><span data-stu-id="ed715-120">Network tracing uses ETW as its primary tracing mechanism to provide information about what the networking subsystems are doing.</span></span> <span data-ttu-id="ed715-121">In ETW sono presenti quattro componenti principali: sessioni di traccia eventi, provider di eventi, controller di eventi e consumer di eventi.</span><span class="sxs-lookup"><span data-stu-id="ed715-121">There are four main components in ETW: event trace sessions, event providers, event controllers and event consumers.</span></span>

<span data-ttu-id="ed715-122">Il buffering e la registrazione avvengono nelle *sessioni di traccia eventi* che accettano eventi dai provider e creano file di traccia.</span><span class="sxs-lookup"><span data-stu-id="ed715-122">Buffering and logging take place in *event trace sessions*, which accept events from providers and creates trace files.</span></span>

<span data-ttu-id="ed715-123">Un *provider di eventi* è un'entità logica che scrive eventi nelle sessioni ETW.</span><span class="sxs-lookup"><span data-stu-id="ed715-123">An *event provider* is a logical entity that writes events to ETW sessions.</span></span> <span data-ttu-id="ed715-124">Un provider di eventi può essere un'applicazione in modalità utente, un'applicazione gestita, un driver o qualsiasi altra entità software.</span><span class="sxs-lookup"><span data-stu-id="ed715-124">An event provider can be a user-mode application, a managed application, a driver, or any other software entity.</span></span> <span data-ttu-id="ed715-125">I provider di eventi registrano con ETW e scrivono gli eventi da diversi punti del codice richiamando l'API di registrazione ETW.</span><span class="sxs-lookup"><span data-stu-id="ed715-125">Event providers register with ETW and write events from various points in the code by invoking the ETW logging API.</span></span> <span data-ttu-id="ed715-126">A causa della crescente strumentazione degli eventi in molti componenti del sistema operativo, anche un'applicazione o uno scenario semplice in Windows conterrà diversi componenti che sono provider di eventi.</span><span class="sxs-lookup"><span data-stu-id="ed715-126">Due to the growing event instrumentation in many operating system components, even a simple application or scenario in Windows will contain several components that are event providers.</span></span>

<span data-ttu-id="ed715-127">Un *controller eventi* avvia e arresta le sessioni di traccia eventi e Abilita i provider.</span><span class="sxs-lookup"><span data-stu-id="ed715-127">An *event controller* starts and stops event trace sessions and enables providers.</span></span> <span data-ttu-id="ed715-128">Quando un provider di eventi viene abilitato in modo dinamico dall'applicazione del controller eventi, il provider invia gli eventi a una sessione di traccia eventi specifica designata dal controller eventi.</span><span class="sxs-lookup"><span data-stu-id="ed715-128">When an event provider is enabled dynamically by the event controller application, the provider sends events to a specific event trace session designated by the event controller.</span></span> <span data-ttu-id="ed715-129">Ogni evento inviato dal provider di eventi alla sessione di traccia eventi è costituito da un'intestazione fissa, che include i metadati dell'evento e gli eventuali dati personalizzati aggiuntivi registrati dal provider.</span><span class="sxs-lookup"><span data-stu-id="ed715-129">Each event sent by the event provider to the event trace session consists of a fixed header, which includes event metadata and any additional custom data logged by the provider.</span></span>

<span data-ttu-id="ed715-130">Un *consumer di eventi* è un'applicazione che legge i file di log o che è in ascolto di una sessione di traccia eventi per gli eventi in tempo reale e li elabora.</span><span class="sxs-lookup"><span data-stu-id="ed715-130">An *event consumer* is an application that reads log files or that listens to an event trace session for real-time events and processes them.</span></span> <span data-ttu-id="ed715-131">Un esempio di consumer di eventi è Microsoft Network Monitor 3,2, che include la possibilità di leggere e visualizzare i file di log prodotti dalla traccia di rete in Windows 7.</span><span class="sxs-lookup"><span data-stu-id="ed715-131">One example of an event consumer is Microsoft Network Monitor 3.2, which includes the capability to read and display log files produced by network tracing in Windows 7.</span></span>

<span data-ttu-id="ed715-132">Gli eventi vengono recapitati ai consumer di eventi in ordine cronologico e sono presenti diverse applicazioni consumer di eventi che visualizzano gli eventi in formati specifici.</span><span class="sxs-lookup"><span data-stu-id="ed715-132">Events are delivered to event consumers in chronological order, and there are various event consumer applications that display the events in specific formats.</span></span> <span data-ttu-id="ed715-133">Quando un evento viene registrato in una sessione, ETW aggiunge informazioni aggiuntive all'intestazione dell'evento, inclusi il timestamp, l'ID del processo e del thread, il numero del processore e i dati di utilizzo della CPU del thread di registrazione.</span><span class="sxs-lookup"><span data-stu-id="ed715-133">When an event is logged to a session, ETW adds additional information to the event header, including the timestamp, process and thread ID, processor number, and CPU usage data of the logging thread.</span></span> <span data-ttu-id="ed715-134">Questi dati vengono quindi passati ai consumer di eventi, insieme ai dati personalizzati inclusi nel provider.</span><span class="sxs-lookup"><span data-stu-id="ed715-134">This data is then passed on to event consumers, along with any custom data included by the provider.</span></span>

<span data-ttu-id="ed715-135">Si prevede che i provider che usano le nuove [API di registrazione eventi](/windows/win32/api/evntprov/nf-evntprov-eventwrite) forniscano un file XML denominato [manifesto dell'evento](../wes/eventschema-schema.md).</span><span class="sxs-lookup"><span data-stu-id="ed715-135">Providers using the new [Event Logging APIs](/windows/win32/api/evntprov/nf-evntprov-eventwrite) are expected to supply an XML file called the [event manifest](../wes/eventschema-schema.md).</span></span> <span data-ttu-id="ed715-136">Questo file fornisce i metadati per definire tutti i dati personalizzati e le informazioni sul layout per gli eventi scritti dal provider.</span><span class="sxs-lookup"><span data-stu-id="ed715-136">This file provides metadata to define all of the custom data and layout information for the events written by the provider.</span></span> <span data-ttu-id="ed715-137">Un'applicazione consumer per utilizzo generico usa quindi le API [Trace Data Helper (TDH)](/windows/win32/api/tdh/) per recuperare i metadati dell'evento, decodificare gli eventi e visualizzarli.</span><span class="sxs-lookup"><span data-stu-id="ed715-137">A general purpose consumer application then uses [Trace Data Helper (TDH)](/windows/win32/api/tdh/) APIs to retrieve the event metadata, decode the events, and display them.</span></span>

<span data-ttu-id="ed715-138">Grazie alla funzionalità di traccia di rete in Windows 7, il lato controller o consumer di eventi include il supporto per la traccia end-to-end, integrato con le esperienze di supporto e diagnostica di Windows generali.</span><span class="sxs-lookup"><span data-stu-id="ed715-138">With network tracing in Windows 7, the event controller/consumer side includes end-to-end scenario-based tracing support integrated with overall Windows diagnostic and support experiences.</span></span> <span data-ttu-id="ed715-139">Uno scenario definisce una raccolta di provider di eventi che coinvolgono lo scenario.</span><span class="sxs-lookup"><span data-stu-id="ed715-139">A scenario defines a collection of event providers involved in the scenario.</span></span> <span data-ttu-id="ed715-140">Il lato controller o consumer di eventi definisce gli scenari (contesti) in cui è possibile usare la traccia, inclusi i provider pertinenti per gli scenari specificati tra i componenti di rete.</span><span class="sxs-lookup"><span data-stu-id="ed715-140">The event controller/consumer side defines the scenarios (contexts) where tracing can be used, including the relevant providers for given scenarios across network components.</span></span> <span data-ttu-id="ed715-141">Il lato del provider di eventi include eventi di traccia di rete standardizzati di diversi componenti nello stack di rete, che possono essere correlati tramite ID attività ETW.</span><span class="sxs-lookup"><span data-stu-id="ed715-141">The event provider side includes standardized network tracing events from different components in the network stack, which can be correlated via ETW activity IDs.</span></span> <span data-ttu-id="ed715-142">I provider utilizzano uno schema di rete comune che standardizza l'utilizzo di concetti ETW quali parole chiave, livelli, attività e codici operativi.</span><span class="sxs-lookup"><span data-stu-id="ed715-142">The providers use a common network schema that standardizes the use of ETW concepts such as keywords, levels, tasks, and opcodes.</span></span> <span data-ttu-id="ed715-143">Lo schema definisce anche eventi comuni per molti componenti di rete, ad esempio eventi di errore, eventi di eliminazione di pacchetti, eventi dello schema ed eventi di transizione di stato.</span><span class="sxs-lookup"><span data-stu-id="ed715-143">The schema also defines events that are common for many network components such as error events, packet drop events, schema events, and state transition events.</span></span>

 

 