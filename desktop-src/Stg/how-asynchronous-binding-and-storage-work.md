---
title: Funzionamento dell'associazione asincrona e dell'archiviazione
description: L'archiviazione asincrona migliora la specifica di archiviazione strutturata COM per supportare il download di oggetti di archiviazione su reti a latenza elevata e a collegamento lento, ad esempio Internet.
ms.assetid: 891152c3-5abd-45e4-a7bb-0aac23262b03
keywords:
- Funzionamento dell'associazione asincrona e dell'archiviazione
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 626e8c7a55b667e158de42b3c88a17315b5e41ad
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "104399195"
---
# <a name="how-asynchronous-binding-and-storage-work"></a><span data-ttu-id="a3f69-104">Funzionamento dell'associazione asincrona e dell'archiviazione</span><span class="sxs-lookup"><span data-stu-id="a3f69-104">How Asynchronous Binding and Storage Work</span></span>

<span data-ttu-id="a3f69-105">L'archiviazione asincrona migliora la specifica di archiviazione strutturata COM per supportare il download di oggetti di archiviazione su reti a latenza elevata e a collegamento lento, ad esempio Internet.</span><span class="sxs-lookup"><span data-stu-id="a3f69-105">Asynchronous storage enhances the COM structured storage specification to support downloading of storage objects on high-latency, slow-link networks such as the Internet.</span></span> <span data-ttu-id="a3f69-106">L'archiviazione asincrona funziona insieme ai moniker asincroni per fornire un comportamento di associazione asincrono completo.</span><span class="sxs-lookup"><span data-stu-id="a3f69-106">Asynchronous storage works together with asynchronous monikers to provide complete asynchronous binding behavior.</span></span>

## <a name="document-object-embedded-in-a-web-page"></a><span data-ttu-id="a3f69-107">Oggetto Document incorporato in una pagina Web</span><span class="sxs-lookup"><span data-stu-id="a3f69-107">Document object embedded in a Web page</span></span>

<span data-ttu-id="a3f69-108">Quando un utente fa clic su un collegamento che rappresenta un documento incorporato in una pagina Web, si verificano gli eventi seguenti:</span><span class="sxs-lookup"><span data-stu-id="a3f69-108">When a user clicks a link representing a document embedded in a Web page, the following events occur:</span></span>

1.  <span data-ttu-id="a3f69-109">Il browser chiama la funzione [**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) , passando l'URL del collegamento.</span><span class="sxs-lookup"><span data-stu-id="a3f69-109">The browser calls the [**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) function, passing the link URL.</span></span>
2.  <span data-ttu-id="a3f69-110">[**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) analizza l'URL, crea un moniker asincrono corrispondente e restituisce un puntatore all'interfaccia [**IMoniker**](/windows/win32/api/objidl/nn-objidl-imoniker) del moniker.</span><span class="sxs-lookup"><span data-stu-id="a3f69-110">[**MkParseDisplayName**](/windows/win32/api/objbase/nf-objbase-mkparsedisplayname) parses the URL, creates a corresponding asynchronous moniker, and returns a pointer to the moniker's [**IMoniker**](/windows/win32/api/objidl/nn-objidl-imoniker) interface.</span></span>
3.  <span data-ttu-id="a3f69-111">Il browser chiama [**IsAsyncMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775110(v=vs.85)) per determinare se il moniker è asincrono, crea un contesto di associazione, registra l'interfaccia [**IBindStatusCallback**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775060(v=vs.85)) con il contesto di associazione, solo se il moniker è asincrono e chiama [**IMoniker:: BindToObject**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject), passando il contesto di associazione.</span><span class="sxs-lookup"><span data-stu-id="a3f69-111">The browser calls [**IsAsyncMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775110(v=vs.85)) to determine if the moniker is asynchronous, creates a bind context, registers the [**IBindStatusCallback**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775060(v=vs.85)) interface with the bind context, only if the moniker is asynchronous, and calls [**IMoniker::BindToObject**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject), passing the bind context.</span></span>
4.  <span data-ttu-id="a3f69-112">Il moniker viene associato all'oggetto ed esegue una query per l'interfaccia [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)) , che indica se l'oggetto supporta l'associazione asincrona e l'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="a3f69-112">The moniker binds to the object and queries it for the [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)) interface, which indicates whether the object supports asynchronous binding and storage.</span></span> <span data-ttu-id="a3f69-113">Se l'oggetto restituisce un puntatore a **IPersistMoniker**:</span><span class="sxs-lookup"><span data-stu-id="a3f69-113">If the object returns a pointer to **IPersistMoniker**:</span></span>

    1.  <span data-ttu-id="a3f69-114">Il moniker URL chiama [**IPersistMoniker:: Load**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775044(v=vs.85)), passando il proprio puntatore [**IMoniker**](/windows/win32/api/objidl/nn-objidl-imoniker) all'oggetto.</span><span class="sxs-lookup"><span data-stu-id="a3f69-114">The URL moniker calls [**IPersistMoniker::Load**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775044(v=vs.85)), passing its own [**IMoniker**](/windows/win32/api/objidl/nn-objidl-imoniker) pointer to the object.</span></span>
    2.  <span data-ttu-id="a3f69-115">L'oggetto modifica il contesto di associazione, sceglie se desidera un'archiviazione bloccante o non bloccata, registra il proprio [**IBindStatusCallback**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775060(v=vs.85)) e chiama [**IMoniker:: BindToStorage**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) sul puntatore ricevuto tramite [**IPersistMoniker:: Load**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775044(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="a3f69-115">The object modifies the bind context, chooses whether it wants a blocking or nonblocking storage, registers its own [**IBindStatusCallback**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775060(v=vs.85)) and calls [**IMoniker::BindToStorage**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) on the pointer it received through [**IPersistMoniker::Load**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775044(v=vs.85)).</span></span>
    3.  <span data-ttu-id="a3f69-116">Il moniker crea un'archiviazione asincrona, mantiene un riferimento all'interfaccia [**IFillLockBytes**](/windows/desktop/api/Objidl/nn-objidl-ifilllockbytes) dell'oggetto wrapper, registra l'interfaccia [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify) nell'archivio radice e chiama [**IPersistStorage:: Load**](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load), passando il puntatore [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) dell'archivio asincrono.</span><span class="sxs-lookup"><span data-stu-id="a3f69-116">The moniker creates an asynchronous storage, keeps a reference to the wrapper object's [**IFillLockBytes**](/windows/desktop/api/Objidl/nn-objidl-ifilllockbytes) interface, registers the [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify) interface on the root storage, and calls [**IPersistStorage::Load**](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load), passing the asynchronous storage's [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pointer.</span></span> <span data-ttu-id="a3f69-117">Quando i dati arrivano (in un thread in background), il moniker chiama **IFillLockBytes** per riempire il [**ILockBytes**](/windows/desktop/api/Objidl/nn-objidl-ilockbytes) nel file temporaneo.</span><span class="sxs-lookup"><span data-stu-id="a3f69-117">As data arrives (on a background thread) the moniker calls **IFillLockBytes** to fill the [**ILockBytes**](/windows/desktop/api/Objidl/nn-objidl-ilockbytes) on the temp file.</span></span>
    4.  <span data-ttu-id="a3f69-118">L'oggetto legge i dati dalla risorsa di archiviazione e restituisce da [**IPersistMoniker:: Load**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775044(v=vs.85)) quando riceve dati sufficienti per considerarsi inizializzato.</span><span class="sxs-lookup"><span data-stu-id="a3f69-118">The object reads data from the storage and returns from [**IPersistMoniker::Load**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775044(v=vs.85)) when it has received sufficient data to consider itself initialized.</span></span> <span data-ttu-id="a3f69-119">Se l'oggetto tenta di leggere i dati che non sono ancora stati scaricati, il Downloader riceve una notifica su [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify).</span><span class="sxs-lookup"><span data-stu-id="a3f69-119">If the object attempts to read data that has not yet been downloaded, the downloader receives a notification on [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify).</span></span> <span data-ttu-id="a3f69-120">All'interno del metodo [**IProgressNotify:: OnProgress**](/windows/win32/api/objidl/nf-objidl-iprogressnotify-onprogress) , il thread di download si blocca in un ciclo di messaggi modale o fa in modo che l'archivio asincrono restituisca E \_ in sospeso, a seconda che l'oggetto abbia richiesto un'archiviazione bloccante o non bloccata.</span><span class="sxs-lookup"><span data-stu-id="a3f69-120">Inside the [**IProgressNotify::OnProgress**](/windows/win32/api/objidl/nf-objidl-iprogressnotify-onprogress) method, the downloading thread either blocks in a modal message loop, or causes the asynchronous storage to return E\_PENDING, depending on whether the object has requested a blocking or nonblocking storage.</span></span>

5.  <span data-ttu-id="a3f69-121">Se l'oggetto non implementa [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)), il moniker esegue una query per [**IPersistStorage**](/windows/win32/api/objidl/nn-objidl-ipersiststorage), che indica che lo stato persistente dell'oggetto viene archiviato in un oggetto di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="a3f69-121">If the object does not implement [**IPersistMoniker**](/previous-versions/windows/internet-explorer/ie-developer/platform-apis/ms775042(v=vs.85)), the moniker queries for [**IPersistStorage**](/windows/win32/api/objidl/nn-objidl-ipersiststorage), which indicates that the object's persistent state is stored in a storage object.</span></span> <span data-ttu-id="a3f69-122">Se l'oggetto restituisce un puntatore a **IPersistStorage**:</span><span class="sxs-lookup"><span data-stu-id="a3f69-122">If the object returns a pointer to **IPersistStorage**:</span></span>

    1.  <span data-ttu-id="a3f69-123">Il moniker chiama [**IMoniker:: BindToStorage**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) su se stesso, richiedendo un [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) di blocco (poiché l'oggetto non è in grado di riconoscere asincrono), crea un'archiviazione asincrona, mantiene un riferimento all'interfaccia [**IFillLockBytes**](/windows/desktop/api/Objidl/nn-objidl-ifilllockbytes) dell'oggetto wrapper, registra l'interfaccia [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify) nell'archivio radice e chiama [**IPersistStorage:: Load**](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load), passando il puntatore **IStorage** dell'archivio asincrono.</span><span class="sxs-lookup"><span data-stu-id="a3f69-123">The Moniker calls [**IMoniker::BindToStorage**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtostorage) on itself, requesting a blocking [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) (because the object is not asynchronous-aware), creates an asynchronous storage, keeps a reference to the wrapper object's [**IFillLockBytes**](/windows/desktop/api/Objidl/nn-objidl-ifilllockbytes) interface, registers the [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify) interface on the root storage, and calls [**IPersistStorage::Load**](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load), passing the asynchronous storage's **IStorage** pointer.</span></span> <span data-ttu-id="a3f69-124">Quando i dati arrivano (in un thread in background), il moniker chiama [**IFillLockBytes**](/windows/desktop/api/Objidl/nn-objidl-ifilllockbytes) per riempire il [**ILockBytes**](/windows/desktop/api/Objidl/nn-objidl-ilockbytes) del file temporaneo.</span><span class="sxs-lookup"><span data-stu-id="a3f69-124">As data arrives (on a background thread) the moniker calls [**IFillLockBytes**](/windows/desktop/api/Objidl/nn-objidl-ifilllockbytes) to fill the [**ILockBytes**](/windows/desktop/api/Objidl/nn-objidl-ilockbytes) on the temporary file.</span></span>
    2.  <span data-ttu-id="a3f69-125">L'oggetto legge i dati dall'archivio e restituisce da [**IPersistStorage:: Load**](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) quando riceve dati sufficienti per considerarsi inizializzato.</span><span class="sxs-lookup"><span data-stu-id="a3f69-125">The object reads data from storage and returns from [**IPersistStorage::Load**](/windows/win32/api/objidl/nf-objidl-ipersiststorage-load) when it has received sufficient data to consider itself initialized.</span></span> <span data-ttu-id="a3f69-126">Se l'oggetto tenta di leggere i dati che non sono ancora stati scaricati, riceve una notifica in [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify).</span><span class="sxs-lookup"><span data-stu-id="a3f69-126">If the object attempts to read data that has not yet been downloaded, it receives a notification on [**IProgressNotify**](/windows/win32/api/objidl/nn-objidl-iprogressnotify).</span></span> <span data-ttu-id="a3f69-127">All'interno del metodo [**IProgressNotify:: OnProgress**](/windows/win32/api/objidl/nf-objidl-iprogressnotify-onprogress) il thread di download viene sempre bloccato in un ciclo di messaggi modale.</span><span class="sxs-lookup"><span data-stu-id="a3f69-127">Inside the [**IProgressNotify::OnProgress**](/windows/win32/api/objidl/nf-objidl-iprogressnotify-onprogress) method, the downloading thread always blocks in a modal message loop.</span></span>

6.  <span data-ttu-id="a3f69-128">Indipendentemente dal fatto che il download sia sincrono o asincrono, il moniker restituisce da [**IMoniker:: BindToObject**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject)e il browser riceve l'oggetto inizializzato richiesto.</span><span class="sxs-lookup"><span data-stu-id="a3f69-128">Regardless of whether the download is synchronous or asynchronous, the moniker returns from [**IMoniker::BindToObject**](/windows/win32/api/objidl/nf-objidl-imoniker-bindtoobject), and the browser receives the initialized object it requested.</span></span>
7.  <span data-ttu-id="a3f69-129">Il browser esegue una query per [**IOleObject**](/windows/win32/api/oleidl/nn-oleidl-ioleobject) e ospita l'oggetto come oggetto documento.</span><span class="sxs-lookup"><span data-stu-id="a3f69-129">The browser queries for [**IOleObject**](/windows/win32/api/oleidl/nn-oleidl-ioleobject) and hosts the object as a Document Object.</span></span> <span data-ttu-id="a3f69-130">A questo punto l'oggetto potrebbe non essere inizializzato completamente, ma sufficiente per visualizzare un elemento utile, nel qual caso il download continua in background.</span><span class="sxs-lookup"><span data-stu-id="a3f69-130">(At this point the object may not be initialized completely, but enough to display something useful, in which case downloading continues in the background.)</span></span>

 

 