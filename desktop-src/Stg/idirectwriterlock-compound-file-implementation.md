---
title: IDirectWriterLock-implementazione del file composto
description: L'implementazione del file composto di IDirectWriterLock fornisce un modo per aprire un file composto in modalità diretta con un solo Writer e più lettori.
ms.assetid: 4b247dae-d937-430a-bdb7-c47fa3c026b6
keywords:
- IDirectWriterLock Strctd STG, implementazione del file composto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 861935a4c373ce03408c0e633e581e56d39623da
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/16/2019
ms.locfileid: "103708452"
---
# <a name="idirectwriterlock---compound-file-implementation"></a><span data-ttu-id="3b1f0-104">IDirectWriterLock-implementazione del file composto</span><span class="sxs-lookup"><span data-stu-id="3b1f0-104">IDirectWriterLock - Compound File Implementation</span></span>

<span data-ttu-id="3b1f0-105">L'implementazione del file composto di [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) fornisce un modo per aprire un file composto in modalità diretta con un solo Writer e più lettori.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-105">The compound file implementation of [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) provides a way to open a compound file in direct mode with a single writer and multiple readers.</span></span>

<span data-ttu-id="3b1f0-106">I file composti possono essere aperti in modalità diretta usando il \_ flag diretto STGM.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-106">Compound files can be opened in direct mode using the STGM\_DIRECT flag.</span></span> <span data-ttu-id="3b1f0-107">L'interfaccia [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) imposta il \_ flag STGM ReadWrite \| STGM \_ share \_ Deny \_ Write come valido in modalità diretta senza richiedere l'overhead di una copia snapshot.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-107">The [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) interface sets the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flag as valid in direct mode without requiring the overhead of a snapshot copy.</span></span>

<span data-ttu-id="3b1f0-108">Quando un file composto viene aperto in modalità transazionale usando il \_ flag transazionale STGM, è anche possibile avere più lettori e un singolo writer usando \_ il \| \_ flag di condivisione \_ Nega scrittura STGM ReadWrite STGM \_ .</span><span class="sxs-lookup"><span data-stu-id="3b1f0-108">When a compound file is opened in transacted mode using the STGM\_TRANSACTED flag, you can also have multiple readers and a single writer using the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flag.</span></span> <span data-ttu-id="3b1f0-109">Tuttavia, in questo caso, viene creata una copia snapshot del file per i lettori.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-109">However, in this case, a snapshot copy of the file is made for the readers.</span></span> <span data-ttu-id="3b1f0-110">Spesso si verifica un sovraccarico di una copia Scratch.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-110">There is often overhead of a scratch copy.</span></span>

## <a name="when-to-use"></a><span data-ttu-id="3b1f0-111">Utilizzo</span><span class="sxs-lookup"><span data-stu-id="3b1f0-111">When to Use</span></span>

<span data-ttu-id="3b1f0-112">Usare l'implementazione fornita dal sistema di [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) quando si apre una risorsa di archiviazione in modalità diretta (STGM \_ Direct) con la \_ condivisione STGM ReadWrite \| STGM \_ \_ \_ flag Deny Write.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-112">Use the system-supplied implementation of [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock) when you open a storage in direct mode (STGM\_DIRECT) with the STGM\_READWRITE\|STGM\_SHARE\_DENY\_WRITE flags.</span></span>

<span data-ttu-id="3b1f0-113">Per ottenere un puntatore a [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock), chiamare **QueryInterface** in [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) per ottenere l'oggetto di archiviazione radice per il file composto.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-113">To obtain a pointer to [**IDirectWriterLock**](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock), call **QueryInterface** on [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) to get the root storage object for the compound file.</span></span>

<span data-ttu-id="3b1f0-114">Chiamare [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) per ottenere l'accesso in scrittura esclusivo a un file composto.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-114">Call [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) to obtain exclusive write access to a compound file.</span></span> <span data-ttu-id="3b1f0-115">Chiamare [**IDirectWriterLock:: ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) per rilasciare l'accesso in scrittura esclusivo.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-115">Call [**IDirectWriterLock::ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) to release exclusive write access.</span></span>

<span data-ttu-id="3b1f0-116">[**IDirectWriterLock:: HaveWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-havewriteaccess) indica se il file è attualmente bloccato.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-116">[**IDirectWriterLock::HaveWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-havewriteaccess) indicates whether the file is currently locked.</span></span>

## <a name="remarks"></a><span data-ttu-id="3b1f0-117">Commenti</span><span class="sxs-lookup"><span data-stu-id="3b1f0-117">Remarks</span></span>

<span data-ttu-id="3b1f0-118">L'implementazione del file composto della funzionalità per più lettori a writer singolo è basata sul blocco di intervalli.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-118">The compound file implementation of the single-writer, multiple-reader feature is based on range locking.</span></span> <span data-ttu-id="3b1f0-119">Il writer Ottiene l'accesso esclusivo alla risorsa di archiviazione da scrivere dopo che tutti i lettori correnti hanno chiuso l'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-119">The writer obtains exclusive access to the storage to write after all current readers have closed the storage.</span></span> <span data-ttu-id="3b1f0-120">Mentre il writer è attivo, i lettori successivi non possono aprire lo spazio di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-120">While the writer is active, subsequent readers cannot open the storage.</span></span> <span data-ttu-id="3b1f0-121">Il writer chiama [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) per ottenere l'accesso in scrittura esclusivo.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-121">The writer calls [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) to obtain exclusive write access.</span></span> <span data-ttu-id="3b1f0-122">Il writer deve quindi chiamare [**IDirectWriterLock:: ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) per rilasciare l'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-122">The writer must then call [**IDirectWriterLock::ReleaseWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-releasewriteaccess) to release the storage.</span></span>

<span data-ttu-id="3b1f0-123">La chiamata a [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) è obbligatoria prima di scrivere in questa modalità a singolo Reader e a più writer.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-123">The call to [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess) is required before writing in this single-reader, multiple-writer mode.</span></span> <span data-ttu-id="3b1f0-124">Tenta di scrivere nel file senza chiamare **IDirectWriterLock:: WaitForWriteAccess** per primo risultato in STG \_ E \_ AccessDenied.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-124">Attempts to write to the file without calling **IDirectWriterLock::WaitForWriteAccess** first result in STG\_E\_ACCESSDENIED.</span></span> <span data-ttu-id="3b1f0-125">Questo errore viene restituito anche se il writer ha aperto inizialmente il file e nessun lettore dispone attualmente del file aperto.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-125">This error is returned even if the writer opened the file initially, and no readers currently have the file open.</span></span>

## <a name="marshaling-considerations"></a><span data-ttu-id="3b1f0-126">Considerazioni sul marshalling</span><span class="sxs-lookup"><span data-stu-id="3b1f0-126">Marshaling Considerations</span></span>

<span data-ttu-id="3b1f0-127">Il marshalling personalizzato viene in genere usato quando viene effettuato il marshalling di un file composto in un altro processo nello stesso computer.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-127">Custom marshaling is typically used when a compound file is marshaled to another process on the same machine.</span></span> <span data-ttu-id="3b1f0-128">Quando si esegue il marshalling delle archiviazioni, i diritti di accesso non vengono considerati e il puntatore [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) viene passato al nuovo processo con le stesse modalità di accesso e diritti del processo di marshalling originale.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-128">When marshaling storages, access rights are not considered, and the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pointer is passed to the new process with the same access modes and rights as the original marshaling process.</span></span> <span data-ttu-id="3b1f0-129">Per altre informazioni sulle modalità di accesso, vedere [**costanti STGM**](stgm-constants.md).</span><span class="sxs-lookup"><span data-stu-id="3b1f0-129">For more information about access modes, see [**STGM Constants**](stgm-constants.md).</span></span> <span data-ttu-id="3b1f0-130">Durante il marshalling, non viene eseguito o verificato alcun blocco per garantire l'accesso in scrittura esclusivo.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-130">During marshaling, no locks are taken or verified to ensure exclusive write access.</span></span> <span data-ttu-id="3b1f0-131">In questo caso, non è prevista l'applicazione dei criteri a writer singolo per i file composti aperti in modalità a singolo writer e a più lettori.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-131">In this case, there is no enforcement of the single-writer policy for compound files opened in the single-writer, multiple-reader mode.</span></span> <span data-ttu-id="3b1f0-132">L'imposizione viene invece gestita internamente dall'implementazione del file composto.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-132">Instead, enforcement is handled internally by the compound file implementation.</span></span>

<span data-ttu-id="3b1f0-133">Poiché il puntatore [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) viene passato a un altro processo durante il marshalling, è possibile che due processi dispongano di accesso simultaneo allo stesso file composto.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-133">Because the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) pointer is passed to another process during marshaling, it is possible for two processes to have simultaneous access to the same compound file.</span></span> <span data-ttu-id="3b1f0-134">Anche se un chiamante potrebbe avere ottenuto l'accesso in scrittura esclusivo all'archiviazione chiamando [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), la versione di cui è stato effettuato il marshalling può anche avere accesso simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-134">Even though a caller may have obtained exclusive write access to the storage by calling [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), the marshaled version can also have access simultaneously.</span></span> <span data-ttu-id="3b1f0-135">Le versioni di cui è stato effettuato il marshalling non vengono forzate a chiudere mentre il writer singolo accede al file.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-135">The marshaled versions are not forced to close while the single writer accesses the file.</span></span> <span data-ttu-id="3b1f0-136">In questo caso, l'implementazione del file composto Sincronizza internamente le Scritture.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-136">In this case, the compound file implementation synchronizes the writes internally.</span></span>

<span data-ttu-id="3b1f0-137">Se un singolo writer Ottiene l'accesso esclusivo chiamando, [**IDirectWriterLock:: WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), anche l'archiviazione con marshalling ha accesso in scrittura e non è necessario chiamare **IDirectWriterLock:: WaitForWriteAccess**.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-137">If a single writer obtains exclusive access by calling, [**IDirectWriterLock::WaitForWriteAccess**](/windows/desktop/api/Objidl/nf-objidl-idirectwriterlock-waitforwriteaccess), the marshaled storage also has write access and does not have to call **IDirectWriterLock::WaitForWriteAccess**.</span></span> <span data-ttu-id="3b1f0-138">Entrambi i processi hanno accesso in scrittura e la sincronizzazione è controllata dall'implementazione del file composto interno.</span><span class="sxs-lookup"><span data-stu-id="3b1f0-138">Both processes have write access and synchronization is controlled by the internal compound file implementation.</span></span>

## <a name="related-topics"></a><span data-ttu-id="3b1f0-139">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="3b1f0-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="3b1f0-140">**IDirectWriterLock**</span><span class="sxs-lookup"><span data-stu-id="3b1f0-140">**IDirectWriterLock**</span></span>](/windows/desktop/api/Objidl/nn-objidl-idirectwriterlock)
</dt> </dl>

 

 




