---
title: Considerazioni sull'archiviazione delle proprietà
description: IPropertyStorage ReadMultiple legge il numero di proprietà specificate nella matrice rgpspec come si trova nel set di proprietà.
ms.assetid: 7540966f-a3b2-46c9-9e04-b15133a517eb
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2aad6aabf8b22a7c01f91a090136e6cc8156c791
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "106299910"
---
# <a name="property-storage-considerations"></a><span data-ttu-id="366a0-103">Considerazioni sull'archiviazione delle proprietà</span><span class="sxs-lookup"><span data-stu-id="366a0-103">Property Storage Considerations</span></span>

<span data-ttu-id="366a0-104">[**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) legge il numero di proprietà specificate nella matrice *rgpspec* come si trova nel set di proprietà.</span><span class="sxs-lookup"><span data-stu-id="366a0-104">[**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) reads as many of the properties specified in the *rgpspec* array as are found in the property set.</span></span> <span data-ttu-id="366a0-105">Se una delle proprietà richieste viene letta, una richiesta di recupero di una proprietà che non esiste non è un errore.</span><span class="sxs-lookup"><span data-stu-id="366a0-105">As long as any of the properties requested is read, a request to retrieve a property that does not exist is not an error.</span></span> <span data-ttu-id="366a0-106">Al contrario, questo deve causare \_ la scrittura di un VT vuoto per la proprietà nella matrice *rgvar* al \[ \] ritorno.</span><span class="sxs-lookup"><span data-stu-id="366a0-106">Instead, this must cause VT\_EMPTY to be written for that property to the *rgvar*\[\] array on return.</span></span> <span data-ttu-id="366a0-107">Quando nessuna delle proprietà richieste esiste, il metodo deve restituire S \_ false e impostare VT \_ Empty in ogni [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant).</span><span class="sxs-lookup"><span data-stu-id="366a0-107">When none of the requested properties exist, the method should return S\_FALSE, and set VT\_EMPTY in each [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant).</span></span> <span data-ttu-id="366a0-108">Se viene restituito un altro errore, non viene recuperato alcun valore di proprietà e il chiamante non deve preoccuparsi di rilasciarlo.</span><span class="sxs-lookup"><span data-stu-id="366a0-108">If any other error is returned, no property values are retrieved, and the caller need not worry about releasing them.</span></span>

<span data-ttu-id="366a0-109">Il parametro *rgpspec* è una matrice di strutture [**Campo PROPSPEC**](/windows/win32/api/propidlbase/ns-propidlbase-propspec) che specifica per ogni proprietà l'identificatore di proprietà o, se ne viene assegnato uno, un identificatore di stringa.</span><span class="sxs-lookup"><span data-stu-id="366a0-109">The *rgpspec* parameter is an array of [**PROPSPEC**](/windows/win32/api/propidlbase/ns-propidlbase-propspec) structures, which specify for each property either its property identifier or, if one is assigned, a string identifier.</span></span> <span data-ttu-id="366a0-110">È possibile eseguire il mapping di una stringa a un identificatore di proprietà chiamando [**IPropertyStorage:: WritePropertyNames**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames).</span><span class="sxs-lookup"><span data-stu-id="366a0-110">You can map a string to a property identifier by calling [**IPropertyStorage::WritePropertyNames**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writepropertynames).</span></span> <span data-ttu-id="366a0-111">L'uso degli identificatori di proprietà è, tuttavia, molto più efficiente rispetto all'uso di stringhe.</span><span class="sxs-lookup"><span data-stu-id="366a0-111">The use of property identifiers is, however, likely to be significantly more efficient than the use of strings.</span></span>

<span data-ttu-id="366a0-112">Le proprietà richieste da nome stringa (PRSPEC \_ LPWSTR) vengono mappate senza distinzione tra maiuscole e minuscole a identificatori di proprietà (ID), perché sono specificate nel set di proprietà corrente (e in base alle impostazioni locali correnti del sistema).</span><span class="sxs-lookup"><span data-stu-id="366a0-112">Properties that are requested by string name (PRSPEC\_LPWSTR) are mapped case-insensitively to property identifiers (IDs) as they are specified in the current property set (and according to the current system locale).</span></span>

<span data-ttu-id="366a0-113">Quando il tipo di proprietà è VT \_ LPSTR e la proprietà viene letta da un set di proprietà ANSI, ovvero la tabella codici per il set di proprietà è impostata su un valore diverso da Unicode, il valore della proprietà utilizza la stessa tabella codici del set di proprietà.</span><span class="sxs-lookup"><span data-stu-id="366a0-113">When the property type is VT\_LPSTR and the property is read from an ANSI property set, that is, the code page for the property set is set to something other than Unicode, the value of the property uses the same code page as the property set.</span></span> <span data-ttu-id="366a0-114">Quando una \_ Proprietà LPSTR di VT viene letta da un set di proprietà Unicode, il valore della proprietà utilizza la tabella codici ANSI predefinita corrente del sistema, ovvero la tabella codici restituita dalla funzione **GetACP** .</span><span class="sxs-lookup"><span data-stu-id="366a0-114">When a VT\_LPSTR property is read from a Unicode property set, the value of the property uses the system's current default ANSI code page, that is, the code page returned from the **GetACP** function.</span></span>

<span data-ttu-id="366a0-115">Un [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant), ad eccezione di quelli che sono puntatori a flussi e archivi, viene chiamato semplice **PROPVARIANT**.</span><span class="sxs-lookup"><span data-stu-id="366a0-115">A [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant), except for those that are pointers to streams and storages, is called a simple **PROPVARIANT**.</span></span> <span data-ttu-id="366a0-116">Questi **PROPVARIANT** semplici ricevono i dati per valore, quindi una chiamata a [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) fornisce una copia dei dati di proprietà del chiamante.</span><span class="sxs-lookup"><span data-stu-id="366a0-116">These simple **PROPVARIANT** s receive data by value, so a call to [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) supplies a copy of the data that the caller then owns.</span></span> <span data-ttu-id="366a0-117">Per creare o aggiornare queste proprietà, chiamare [**IPropertyStorage:: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="366a0-117">To create or update these properties, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span>

<span data-ttu-id="366a0-118">Al contrario, il flusso VT dei tipi Variant \_ , l' \_ \_ oggetto trasmesso tramite VT, l'archiviazione VT \_ e \_ \_ l'oggetto archiviato VT sono proprietà non semplici, perché invece di fornire un valore, il metodo recupera un puntatore all'interfaccia indicata, da cui i dati possono essere letti.</span><span class="sxs-lookup"><span data-stu-id="366a0-118">In contrast, the variant types VT\_STREAM, VT\_STREAMED\_OBJECT, VT\_STORAGE, and VT\_STORED\_OBJECT are non-simple properties, because rather than supplying a value, the method retrieves a pointer to the indicated interface, from which the data can then be read.</span></span> <span data-ttu-id="366a0-119">Questi tipi consentono l'archiviazione di grandi quantità di informazioni tramite una singola proprietà.</span><span class="sxs-lookup"><span data-stu-id="366a0-119">These types permit the storage of large amounts of information through a single property.</span></span> <span data-ttu-id="366a0-120">Esistono diversi problemi che si verificano nell'utilizzo di proprietà non semplici.</span><span class="sxs-lookup"><span data-stu-id="366a0-120">There are several issues that arise in using nonsimple properties.</span></span>

<span data-ttu-id="366a0-121">Per creare queste proprietà, come per le altre proprietà, chiamare [**IPropertyStorage:: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="366a0-121">To create these properties, as for the other properties, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span> <span data-ttu-id="366a0-122">Anziché chiamare lo stesso metodo per aggiornare, tuttavia, è più efficiente chiamare prima [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) per ottenere il puntatore di interfaccia al flusso o all'archiviazione, quindi scrivere i dati usando i metodi [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) o [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="366a0-122">Rather than calling the same method to update, however, it is more efficient to first call [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) to get the interface pointer to the stream or storage, then write data using the [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) or [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) methods.</span></span> <span data-ttu-id="366a0-123">Un flusso o una risorsa di archiviazione aperta tramite una proprietà viene sempre aperta in modalità diretta, pertanto non è stato introdotto un ulteriore livello di transazione nidificata.</span><span class="sxs-lookup"><span data-stu-id="366a0-123">A stream or storage opened through a property is always opened in direct mode, so an additional level of nested transaction is not introduced.</span></span> <span data-ttu-id="366a0-124">Può tuttavia essere comunque una transazione sulla proprietà impostata nel suo complesso, a seconda della modalità di apertura o creazione tramite [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage).</span><span class="sxs-lookup"><span data-stu-id="366a0-124">There may, however, still be a transaction on the property set as a whole, depending on how it was opened or created through [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage).</span></span> <span data-ttu-id="366a0-125">Inoltre, i tag della modalità di accesso e condivisione specificati al momento dell'apertura o della creazione del set di proprietà vengono passati a flussi o archiviazione basati su Proprietà.</span><span class="sxs-lookup"><span data-stu-id="366a0-125">Further, the access and share mode tags specified when the property set is opened or created, are passed to property-based streams or storages.</span></span>

<span data-ttu-id="366a0-126">Le durate dei puntatori di archiviazione o di flusso basati su proprietà, sebbene teoricamente indipendenti dai puntatori [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) e [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) associati, in realtà dipendono da essi.</span><span class="sxs-lookup"><span data-stu-id="366a0-126">The lifetimes of property-based stream or storage pointers, although theoretically independent of their associated [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) and [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) pointers, in fact, effectively depend on them.</span></span> <span data-ttu-id="366a0-127">I dati visibili tramite il flusso o l'archiviazione sono correlati alla transazione nell'oggetto di archiviazione della proprietà da cui vengono recuperati, come per un oggetto di archiviazione (che supporta [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)) con oggetti secondari di flusso e di archiviazione contenuti.</span><span class="sxs-lookup"><span data-stu-id="366a0-127">The data visible through the stream or storage is related to the transaction on the property storage object from which it is retrieved, just as for a storage object (supporting [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage)) with contained stream and storage sub-objects.</span></span> <span data-ttu-id="366a0-128">Se la transazione sull'oggetto padre viene interrotta, i puntatori [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) e **IStorage** esistenti subordinati a tale oggetto non saranno più accessibili.</span><span class="sxs-lookup"><span data-stu-id="366a0-128">If the transaction on the parent object is aborted, existing [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) and **IStorage** pointers subordinate to that object are no longer accessible.</span></span> <span data-ttu-id="366a0-129">Poiché **IPropertyStorage** è l'unica interfaccia nell'oggetto di archiviazione delle proprietà, la durata utile dei puntatori **IStream** e **IStorage** contenuti è vincolata dalla durata dell'interfaccia **IPropertyStorage** .</span><span class="sxs-lookup"><span data-stu-id="366a0-129">Because **IPropertyStorage** is the only interface on the property storage object, the useful lifetime of the contained **IStream** and **IStorage** pointers is bounded by the lifetime of the **IPropertyStorage** interface.</span></span>

<span data-ttu-id="366a0-130">L'implementazione deve inoltre gestire la situazione in cui la stessa proprietà con valori di flusso o di archiviazione viene richiesta più volte tramite la stessa istanza dell'interfaccia [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) .</span><span class="sxs-lookup"><span data-stu-id="366a0-130">The implementation must also deal with the situation where the same stream- or storage-valued property is requested multiple times through the same [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) interface instance.</span></span> <span data-ttu-id="366a0-131">Nell'implementazione del file composto COM, ad esempio, l'apertura avrà esito positivo o negativo a seconda che la proprietà sia già aperta o meno.</span><span class="sxs-lookup"><span data-stu-id="366a0-131">For example, in the COM compound file implementation, the open will succeed or fail depending on whether or not the property is already open.</span></span>

<span data-ttu-id="366a0-132">Un altro problema è l'apertura multipla in modalità transazionale.</span><span class="sxs-lookup"><span data-stu-id="366a0-132">Another issue is multiple opens in transacted mode.</span></span> <span data-ttu-id="366a0-133">Il risultato dipende dal livello di isolamento specificato tramite una chiamata ai metodi [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) (il metodo [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) o [**create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) , tramite i flag STGM) nel momento in cui è stata aperta l'archiviazione della proprietà.</span><span class="sxs-lookup"><span data-stu-id="366a0-133">The result depends on the isolation level that was specified through a call to [**IPropertySetStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertysetstorage) methods, (either the [**Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) or [**Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create) method, through the STGM flags) at the time that the property storage was opened.</span></span>

<span data-ttu-id="366a0-134">Se la chiamata per aprire il set di proprietà specifica l'accesso in lettura/scrittura, le proprietà [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) e [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)sono sempre aperte con accesso in lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="366a0-134">If the call to open the property set specifies read-write access, [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) and [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream)-valued properties are always opened with read-write access.</span></span> <span data-ttu-id="366a0-135">I dati possono quindi essere scritti tramite queste interfacce, modificando il valore della proprietà, che rappresenta il modo più efficiente per aggiornare queste proprietà.</span><span class="sxs-lookup"><span data-stu-id="366a0-135">Data can then be written through these interfaces, changing the value of the property, which is the most efficient way to update these properties.</span></span> <span data-ttu-id="366a0-136">Il valore della proprietà non dispone di un livello aggiuntivo di annidamento delle transazioni, quindi l'ambito delle modifiche viene definito sotto la transazione (se presente) nell'oggetto di archiviazione della proprietà.</span><span class="sxs-lookup"><span data-stu-id="366a0-136">The property value itself does not have an additional level of transaction nesting, so changes are scoped under the transaction (if any) on the property storage object.</span></span>

## <a name="storage-and-stream-properties"></a><span data-ttu-id="366a0-137">Proprietà di archiviazione e di flusso</span><span class="sxs-lookup"><span data-stu-id="366a0-137">Storage and Stream Properties</span></span>

<span data-ttu-id="366a0-138">Per scrivere un flusso o un oggetto di archiviazione in un set di proprietà, il set di proprietà deve essere stato creato come non semplice.</span><span class="sxs-lookup"><span data-stu-id="366a0-138">To write a stream or storage object to a property set, the property set must have been created as nonsimple.</span></span> <span data-ttu-id="366a0-139">Per ulteriori informazioni sui set di proprietà semplici e non semplici, vedere la sezione intitolata [oggetti di archiviazione e di flusso per un set di proprietà](storage-vs--stream-for-a-property-set.md).</span><span class="sxs-lookup"><span data-stu-id="366a0-139">For more information on simple and nonsimple property sets, see the section titled [Storage and Stream Objects for a Property Set](storage-vs--stream-for-a-property-set.md).</span></span> <span data-ttu-id="366a0-140">I seguenti tipi di proprietà, come specificato nel campo *VT* degli elementi della matrice *rgvar* , sono tipi di flusso o di archiviazione: \_ flusso VT, \_ archiviazione VT, oggetto con \_ flusso VT \_ , \_ oggetto archiviato VT \_ .</span><span class="sxs-lookup"><span data-stu-id="366a0-140">The following property types, as specified in the *vt* field of the *rgvar* array elements, are stream or storage types: VT\_STREAM, VT\_STORAGE, VT\_STREAMED\_OBJECT, VT\_STORED\_OBJECT.</span></span>

<span data-ttu-id="366a0-141">Per scrivere un flusso o un oggetto di archiviazione come proprietà in un set di proprietà non semplice, chiamare [**IPropertyStorage:: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span><span class="sxs-lookup"><span data-stu-id="366a0-141">To write a stream or storage object as a property in a non-simple property set, call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple).</span></span> <span data-ttu-id="366a0-142">Anche se si chiama questo metodo per aggiornare le proprietà semplici, non si tratta di un modo efficiente per aggiornare gli oggetti flusso e archiviazione in un set di proprietà.</span><span class="sxs-lookup"><span data-stu-id="366a0-142">While you would also call this method to update simple properties, it is not an efficient way to update stream and storage objects in a property set.</span></span> <span data-ttu-id="366a0-143">Questo perché l'aggiornamento di una di queste proprietà tramite una chiamata a **WriteMultiple** crea nell'oggetto archiviazione proprietà una copia dei dati passati e i puntatori [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) o [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) non vengono conservati oltre la durata della chiamata.</span><span class="sxs-lookup"><span data-stu-id="366a0-143">This is because updating one of these properties through a call to **WriteMultiple** creates in the property storage object a copy of the passed-in data, and the [**IStorage**](/windows/desktop/api/Objidl/nn-objidl-istorage) or [**IStream**](/windows/desktop/api/Objidl/nn-objidl-istream) pointers are not retained beyond the duration of this call.</span></span> <span data-ttu-id="366a0-144">È in genere più efficiente aggiornare direttamente gli oggetti Stream o storage chiamando [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) per ottenere il puntatore di interfaccia al flusso o all'archiviazione, quindi scrivere i dati tramite i metodi **IStream** o **IStorage** .</span><span class="sxs-lookup"><span data-stu-id="366a0-144">It is usually more efficient to update stream or storage objects directly by first calling [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) to get the interface pointer to the stream or storage, then writing data through the **IStream** or **IStorage** methods.</span></span>

<span data-ttu-id="366a0-145">Ad esempio, è possibile chiamare [**IPropertyStorage:: WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) per scrivere un flusso **null** o un oggetto di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="366a0-145">For example, you can call [**IPropertyStorage::WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) to write a **NULL** stream or storage object.</span></span> <span data-ttu-id="366a0-146">L'implementazione creerà quindi un oggetto vuoto nel set di proprietà.</span><span class="sxs-lookup"><span data-stu-id="366a0-146">The implementation will then create an empty object in the property set.</span></span> <span data-ttu-id="366a0-147">È quindi possibile ottenere l'accesso a questo oggetto chiamando [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple).</span><span class="sxs-lookup"><span data-stu-id="366a0-147">You can then get access to this object by calling [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple).</span></span> <span data-ttu-id="366a0-148">Al termine dell'aggiornamento dell'oggetto, non è necessario scriverlo nel set di proprietà, in quanto gli aggiornamenti venivano inseriti direttamente nel set di proprietà.</span><span class="sxs-lookup"><span data-stu-id="366a0-148">When you finish updating this object you need not write it to the property set, as your updates were going directly into the property set.</span></span>

<span data-ttu-id="366a0-149">Un flusso o una risorsa di archiviazione aperta tramite una proprietà viene sempre aperta in modalità diretta, pertanto non è stato introdotto un ulteriore livello di transazione nidificata.</span><span class="sxs-lookup"><span data-stu-id="366a0-149">A stream or storage opened through a property is always opened in direct mode, so an additional level of nested transaction is not introduced.</span></span> <span data-ttu-id="366a0-150">Potrebbe essere ancora presente una transazione per la proprietà impostata nel suo complesso.</span><span class="sxs-lookup"><span data-stu-id="366a0-150">There still may be a transaction on the property set as a whole.</span></span> <span data-ttu-id="366a0-151">Ad esempio, se [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) è stato ottenuto chiamando [**IPropertySetStorage:: Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) con STGM \_ Flag transazionale impostato nel parametro *grfMode* . Un flusso o una risorsa di archiviazione basata su proprietà viene inoltre aperto in modalità di lettura/scrittura, se possibile, in base alla modalità del set di proprietà. in caso contrario, viene utilizzata la modalità di lettura.</span><span class="sxs-lookup"><span data-stu-id="366a0-151">(For example, if the [**IPropertyStorage**](/windows/desktop/api/Propidl/nn-propidl-ipropertystorage) was obtained by calling [**IPropertySetStorage::Open**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-open) with the STGM\_TRANSACTED flag set in the *grfmode* parameter.) Further, a property-based stream or storage is opened in read-write mode, if possible, given the mode on the property set; otherwise, read mode is used.</span></span>

<span data-ttu-id="366a0-152">Come indicato in precedenza, quando un flusso o un oggetto di archiviazione viene scritto in una proprietà impostata con il metodo [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) , viene creata una copia dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="366a0-152">As mentioned earlier, when a stream or storage object is written to a property set with the [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) method, a copy of the object is made.</span></span> <span data-ttu-id="366a0-153">Quando tale copia viene eseguita su un oggetto flusso, l'operazione di copia inizia in corrispondenza della posizione di ricerca corrente dell'origine.</span><span class="sxs-lookup"><span data-stu-id="366a0-153">When such a copy is made on a stream object, the copy operation starts at the current seek position of the source.</span></span> <span data-ttu-id="366a0-154">La posizione di ricerca non è definita in caso di errore, ma in caso di esito positivo si trova alla fine del flusso; il puntatore di ricerca non viene ripristinato nella posizione originale.</span><span class="sxs-lookup"><span data-stu-id="366a0-154">The seek position is undefined on failure, but on success it is at the end of the stream; the seek pointer is not restored to its original position.</span></span>

<span data-ttu-id="366a0-155">Se una proprietà di flusso o di archiviazione è stata letta da un set di proprietà con [**ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple), viene ancora mantenuta aperta e viene eseguita una chiamata successiva a [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) per la stessa proprietà, l'operazione **WriteMultiple** avrà esito positivo.</span><span class="sxs-lookup"><span data-stu-id="366a0-155">If a stream or storage property has been read from a property set with [**ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple), is still held open, and a subsequent call to [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) for the same property is made, the **WriteMultiple** operation will succeed.</span></span> <span data-ttu-id="366a0-156">Il flusso o la proprietà di archiviazione precedentemente aperti viene posizionata nello stato Reverted (tutte le chiamate a questo oggetto restituiscono l' \_ errore STG E \_ Reverted).</span><span class="sxs-lookup"><span data-stu-id="366a0-156">The previously opened stream or storage property is placed in the reverted state (all calls to it will return STG\_E\_REVERTED error).</span></span>

<span data-ttu-id="366a0-157">Se il metodo [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) restituisce un errore durante la scrittura di una matrice di proprietà o anche di singole proprietà non semplici, la quantità di dati effettivamente scritta non è definita.</span><span class="sxs-lookup"><span data-stu-id="366a0-157">If the [**WriteMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-writemultiple) method returns an error when writing an array of properties, or even individual non-simple properties, the amount of data actually written is undefined.</span></span>

## <a name="reference-properties"></a><span data-ttu-id="366a0-158">Proprietà riferimento</span><span class="sxs-lookup"><span data-stu-id="366a0-158">Reference Properties</span></span>

<span data-ttu-id="366a0-159">Se una struttura [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) specificata include il \_ flag ByRef del VT nel membro **VT** , la proprietà associata è una proprietà di riferimento.</span><span class="sxs-lookup"><span data-stu-id="366a0-159">If a specified [**PROPVARIANT**](/windows/win32/api/propidlbase/ns-propidlbase-propvariant) structure includes the VT\_BYREF flag in its **vt** member, the associated property is a reference property.</span></span> <span data-ttu-id="366a0-160">Una proprietà di riferimento viene automaticamente dereferenziata prima di scrivere il valore nel set di proprietà.</span><span class="sxs-lookup"><span data-stu-id="366a0-160">A reference property is automatically dereferenced before writing the value to the property set.</span></span> <span data-ttu-id="366a0-161">Se, ad esempio, il membro **VT** della struttura **PROPVARIANT** specifica un valore di tipo VT \_ ByRef \| VT \_ I4, il valore effettivo scritto è un \_ tipo VT i4.</span><span class="sxs-lookup"><span data-stu-id="366a0-161">For example, if the **vt** member of the **PROPVARIANT** structure specifies a value of type VT\_BYREF \| VT\_I4, the actual value written is a VT\_I4 type.</span></span> <span data-ttu-id="366a0-162">Una chiamata successiva al metodo [**IPropertyStorage:: ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) restituisce un valore come VT \_ i4.</span><span class="sxs-lookup"><span data-stu-id="366a0-162">A subsequent call to the [**IPropertyStorage::ReadMultiple**](/windows/desktop/api/Propidl/nf-propidl-ipropertystorage-readmultiple) method returns a value as VT\_I4.</span></span> <span data-ttu-id="366a0-163">L'utilizzo di proprietà di riferimento è simile alla chiamata della funzione [VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) .</span><span class="sxs-lookup"><span data-stu-id="366a0-163">Using reference properties is similar to calling the [VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) function.</span></span> <span data-ttu-id="366a0-164">[VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) libera la variante di destinazione ed esegue una copia dell'oggetto VARIANTARG di origine, eseguendo il riferimento indiretto necessario se l'origine è specificata come ByRef del VT \_ .</span><span class="sxs-lookup"><span data-stu-id="366a0-164">[VariantCopyInd](/windows/win32/api/oleauto/nf-oleauto-variantcopyind) frees the destination variant and makes a copy of the source VARIANTARG, performing the necessary indirection if the source is specified to be VT\_BYREF.</span></span> <span data-ttu-id="366a0-165">Questa funzione è utile quando è necessaria una copia di una variante e per garantire che non sia un VT \_ ByRef, ad esempio quando si gestiscono gli argomenti in un'implementazione di [**IDispatch:: Invoke**](/windows/win32/api/oaidl/nf-oaidl-idispatch-invoke).</span><span class="sxs-lookup"><span data-stu-id="366a0-165">This function is useful when a copy of a variant is needed, and to guarantee that it is not VT\_BYREF, for example when handling arguments in an implementation of [**IDispatch::Invoke**](/windows/win32/api/oaidl/nf-oaidl-idispatch-invoke).</span></span>

## <a name="notes-to-callers"></a><span data-ttu-id="366a0-166">Note per i chiamanti</span><span class="sxs-lookup"><span data-stu-id="366a0-166">Notes to Callers</span></span>

<span data-ttu-id="366a0-167">È consigliabile creare i set di proprietà come Unicode, non impostando il \_ flag ANSI PROPSETFLAG nel parametro *GrfFlags* di [**IPropertySetStorage:: create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).</span><span class="sxs-lookup"><span data-stu-id="366a0-167">It is recommended that property sets be created as Unicode, by not setting the PROPSETFLAG\_ANSI flag in the *grfFlags* parameter of [**IPropertySetStorage::Create**](/windows/desktop/api/Propidl/nf-propidl-ipropertysetstorage-create).</span></span> <span data-ttu-id="366a0-168">È inoltre consigliabile evitare di usare \_ i valori LPSTR di VT e usare \_ invece i valori LPWSTR di VT.</span><span class="sxs-lookup"><span data-stu-id="366a0-168">It is also recommended that you avoid using VT\_LPSTR values, and use VT\_LPWSTR values instead.</span></span> <span data-ttu-id="366a0-169">Quando la tabella codici del set di proprietà è Unicode, \_ i valori di stringa VT LPSTR vengono convertiti in Unicode quando vengono archiviati e restituiti a valori stringa multibyte quando vengono recuperati.</span><span class="sxs-lookup"><span data-stu-id="366a0-169">When the property set code page is Unicode, VT\_LPSTR string values are converted to Unicode when stored, and back to multibyte string values when retrieved.</span></span> <span data-ttu-id="366a0-170">Quando la tabella codici della proprietà impostata non è Unicode, i nomi delle proprietà, le stringhe di tipo VT \_ e i valori di proprietà non semplici vengono convertiti in stringhe multibyte quando vengono archiviati e riconvertiti in Unicode quando vengono recuperati, tutti utilizzando la tabella codici ANSI di sistema corrente.</span><span class="sxs-lookup"><span data-stu-id="366a0-170">When the code page of the property set is not Unicode, property names, VT\_BSTR strings, and non-simple property values are converted to multibyte strings when stored, and converted back to Unicode when retrieved, all using the current system ANSI code page.</span></span>

## <a name="notes-to-implementers"></a><span data-ttu-id="366a0-171">Note per gli implementatori</span><span class="sxs-lookup"><span data-stu-id="366a0-171">Notes to Implementers</span></span>

<span data-ttu-id="366a0-172">Quando si alloca un identificatore di proprietà, l'implementazione può scegliere qualsiasi valore non attualmente in uso nel set di proprietà per un identificatore di proprietà, purché non sia 0 o 1 o maggiore di 0x80000000, tutti i quali sono valori riservati.</span><span class="sxs-lookup"><span data-stu-id="366a0-172">When allocating a property identifier, the implementation can choose any value not currently in use in the property set for a property identifier, as long as it is not 0 or 1 or greater than 0x80000000, all of which are reserved values.</span></span> <span data-ttu-id="366a0-173">Il parametro *propidNameFirst* stabilisce un valore minimo per gli identificatori di proprietà all'interno del set e deve essere maggiore di 1 e minore di 0x80000000.</span><span class="sxs-lookup"><span data-stu-id="366a0-173">The *propidNameFirst* parameter establishes a minimum value for property identifiers within the set, and must be greater than 1 and less than 0x80000000.</span></span> <span data-ttu-id="366a0-174">Vedere la sezione Osservazioni sopra.</span><span class="sxs-lookup"><span data-stu-id="366a0-174">See Remarks section above.</span></span>

## <a name="related-topics"></a><span data-ttu-id="366a0-175">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="366a0-175">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="366a0-176">IPropertyStorage-implementazione del file composto</span><span class="sxs-lookup"><span data-stu-id="366a0-176">IPropertyStorage-Compound File Implementation</span></span>](ipropertystorage-compound-file-implementation.md)
</dt> <dt>

[<span data-ttu-id="366a0-177">IPropertyStorage-implementazione del file system NTFS</span><span class="sxs-lookup"><span data-stu-id="366a0-177">IPropertyStorage-NTFS File System Implementation</span></span>](ipropertystorage-ntfs-file-system-implementation.md)
</dt> <dt>

[<span data-ttu-id="366a0-178">IPropertyStorage-implementazione autonoma</span><span class="sxs-lookup"><span data-stu-id="366a0-178">IPropertyStorage-Stand-alone Implementation</span></span>](ipropertystorage-stand-alone-implementation.md)
</dt> </dl>

 

 