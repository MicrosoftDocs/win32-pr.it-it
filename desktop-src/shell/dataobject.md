---
description: L'oggetto dati è fondamentale per tutti i trasferimenti di dati della shell.
ms.assetid: c63d339e-ac62-4da1-b5ce-22d45a6a3413
title: Oggetto dati shell
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 812e5c18f5a2120fbf22682c6e768dc005128630
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104225926"
---
# <a name="shell-data-object"></a><span data-ttu-id="3be84-103">Oggetto dati shell</span><span class="sxs-lookup"><span data-stu-id="3be84-103">Shell Data Object</span></span>

<span data-ttu-id="3be84-104">L'oggetto dati è fondamentale per tutti i trasferimenti di dati della shell.</span><span class="sxs-lookup"><span data-stu-id="3be84-104">The data object is central to all Shell data transfers.</span></span> <span data-ttu-id="3be84-105">Si tratta principalmente di un contenitore che consente di conservare i dati trasferiti.</span><span class="sxs-lookup"><span data-stu-id="3be84-105">It is primarily a container to hold the transferred data.</span></span> <span data-ttu-id="3be84-106">Tuttavia, la destinazione può comunicare anche con l'oggetto dati per facilitare alcuni tipi specializzati di trasferimento dei dati della shell, ad esempio gli spostamenti ottimizzati.</span><span class="sxs-lookup"><span data-stu-id="3be84-106">However, the target can also communicate with the data object to facilitate some specialized types of Shell data transfer such as optimized moves.</span></span> <span data-ttu-id="3be84-107">In questo argomento viene fornita una descrizione generale del funzionamento degli oggetti dati della shell, della modalità di creazione da un'origine e del modo in cui vengono gestiti da una destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-107">This topic provides a general discussion of how Shell data objects work, how they are constructed by a source, and how they are handled by a target.</span></span> <span data-ttu-id="3be84-108">Per una descrizione dettagliata di come usare gli oggetti dati per trasferire tipi diversi di dati della shell, vedere [gestione di scenari di trasferimento dati Shell](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="3be84-108">For a detailed discussion of how to use data objects to transfer different types of Shell data, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

-   [<span data-ttu-id="3be84-109">Funzionamento degli oggetti dati</span><span class="sxs-lookup"><span data-stu-id="3be84-109">How Data Objects Work</span></span>](#how-data-objects-work)
    -   [<span data-ttu-id="3be84-110">Formati degli Appunti</span><span class="sxs-lookup"><span data-stu-id="3be84-110">Clipboard Formats</span></span>](#clipboard-formats)
    -   [<span data-ttu-id="3be84-111">Struttura FORMATETC</span><span class="sxs-lookup"><span data-stu-id="3be84-111">FORMATETC Structure</span></span>](#formatetc-structure)
    -   [<span data-ttu-id="3be84-112">Struttura STGMEDIUM</span><span class="sxs-lookup"><span data-stu-id="3be84-112">STGMEDIUM structure</span></span>](#stgmedium-structure)
-   [<span data-ttu-id="3be84-113">Creazione di un oggetto dati in un'origine</span><span class="sxs-lookup"><span data-stu-id="3be84-113">How a Source Creates a Data Object</span></span>](#how-a-source-creates-a-data-object)
    -   [<span data-ttu-id="3be84-114">Come aggiungere un oggetto memoria globale a un oggetto dati</span><span class="sxs-lookup"><span data-stu-id="3be84-114">How to Add a Global Memory Object to a Data Object</span></span>](#how-to-add-a-global-memory-object-to-a-data-object)
    -   [<span data-ttu-id="3be84-115">Implementazione di IDataObject</span><span class="sxs-lookup"><span data-stu-id="3be84-115">Implementing IDataObject</span></span>](#implementing-idataobject)
    -   [<span data-ttu-id="3be84-116">Implementazione di IDropSource</span><span class="sxs-lookup"><span data-stu-id="3be84-116">Implementing IDropSource</span></span>](#implementing-idropsource)
-   [<span data-ttu-id="3be84-117">Gestione di un oggetto dati in una destinazione</span><span class="sxs-lookup"><span data-stu-id="3be84-117">How a Target Handles a Data Object</span></span>](#how-a-target-handles-a-data-object)
    -   [<span data-ttu-id="3be84-118">Estrazione dei dati della shell da un oggetto dati</span><span class="sxs-lookup"><span data-stu-id="3be84-118">Extracting Shell Data from a Data Object</span></span>](#extracting-shell-data-from-a-data-object)
    -   [<span data-ttu-id="3be84-119">Implementazione di IDropTarget</span><span class="sxs-lookup"><span data-stu-id="3be84-119">Implementing IDropTarget</span></span>](#implementing-idroptarget)
-   [<span data-ttu-id="3be84-120">Uso dell'oggetto helper di trascinamento della selezione</span><span class="sxs-lookup"><span data-stu-id="3be84-120">Using the Drag-and-Drop Helper Object</span></span>](#using-the-drag-and-drop-helper-object)
    -   [<span data-ttu-id="3be84-121">Uso dell'interfaccia IDragSourceHelper</span><span class="sxs-lookup"><span data-stu-id="3be84-121">Using the IDragSourceHelper Interface</span></span>](#using-the-idragsourcehelper-interface)
    -   [<span data-ttu-id="3be84-122">Uso dell'interfaccia IDropTargetHelper</span><span class="sxs-lookup"><span data-stu-id="3be84-122">Using the IDropTargetHelper Interface</span></span>](#using-the-idroptargethelper-interface)

## <a name="how-data-objects-work"></a><span data-ttu-id="3be84-123">Funzionamento degli oggetti dati</span><span class="sxs-lookup"><span data-stu-id="3be84-123">How Data Objects Work</span></span>

<span data-ttu-id="3be84-124">Gli oggetti dati sono oggetti Component Object Model (COM), creati dall'origine dati per trasferire i dati a una destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-124">Data objects are Component Object Model (COM) objects, created by the data source to transfer data to a target.</span></span> <span data-ttu-id="3be84-125">In genere contengono più di un elemento di dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-125">They typically carry more than one item of data.</span></span> <span data-ttu-id="3be84-126">Esistono due motivi per questa procedura:</span><span class="sxs-lookup"><span data-stu-id="3be84-126">There are two reasons for this practice:</span></span>

-   <span data-ttu-id="3be84-127">Sebbene quasi tutti i tipi di dati possano essere trasferiti con un oggetto dati, l'origine non conosce in genere il tipo di dati che la destinazione può accettare.</span><span class="sxs-lookup"><span data-stu-id="3be84-127">While almost any type of data can be transferred with a data object, the source typically does not know what kind of data the target can accept.</span></span> <span data-ttu-id="3be84-128">Ad esempio, i dati possono essere una parte di un documento di testo formattato.</span><span class="sxs-lookup"><span data-stu-id="3be84-128">For instance, the data might be a portion of a formatted text document.</span></span> <span data-ttu-id="3be84-129">Sebbene la destinazione possa essere in grado di gestire informazioni di formattazione complesse, potrebbe anche essere in grado di accettare solo testo ANSI.</span><span class="sxs-lookup"><span data-stu-id="3be84-129">While the target might be able to handle complex formatting information, it might also be able to accept only ANSI text.</span></span> <span data-ttu-id="3be84-130">Per questo motivo, gli oggetti dati includono spesso gli stessi dati in formati diversi.</span><span class="sxs-lookup"><span data-stu-id="3be84-130">For this reason, data objects often include the same data in several different formats.</span></span> <span data-ttu-id="3be84-131">La destinazione può quindi estrarre i dati in un formato che è in grado di gestire.</span><span class="sxs-lookup"><span data-stu-id="3be84-131">The target can then extract the data in a format that it can handle.</span></span>
-   <span data-ttu-id="3be84-132">Gli oggetti dati possono contenere anche elementi di dati ausiliari che non sono versioni dei dati di origine.</span><span class="sxs-lookup"><span data-stu-id="3be84-132">Data objects can also contain auxiliary data items that are not versions of source data.</span></span> <span data-ttu-id="3be84-133">Questo tipo di elemento di dati in genere fornisce informazioni aggiuntive sull'operazione di trasferimento dei dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-133">This type of data item typically provides additional information about the data transfer operation.</span></span> <span data-ttu-id="3be84-134">Ad esempio, la shell usa elementi di dati ausiliari per indicare se un file deve essere copiato o spostato.</span><span class="sxs-lookup"><span data-stu-id="3be84-134">For instance, the Shell uses auxiliary data items to indicate whether a file is to be copied or moved.</span></span>

### <a name="clipboard-formats"></a><span data-ttu-id="3be84-135">Formati degli Appunti</span><span class="sxs-lookup"><span data-stu-id="3be84-135">Clipboard Formats</span></span>

<span data-ttu-id="3be84-136">A ogni elemento di dati in un oggetto dati è associato un formato, generalmente denominato *formato degli Appunti*.</span><span class="sxs-lookup"><span data-stu-id="3be84-136">Each item of data in a data object has an associated format, usually called a *clipboard format*.</span></span> <span data-ttu-id="3be84-137">Sono disponibili diversi formati degli Appunti standard, dichiarati in winuser. h, che corrispondono ai tipi di dati usati comunemente.</span><span class="sxs-lookup"><span data-stu-id="3be84-137">There are a number of standard clipboard formats, declared in Winuser.h, that correspond to commonly used types of data.</span></span> <span data-ttu-id="3be84-138">I formati degli Appunti sono numeri interi, ma in genere fanno riferimento al nome equivalente, che ha il formato CF \_ *xxx*.</span><span class="sxs-lookup"><span data-stu-id="3be84-138">Clipboard formats are integers, but they are normally referred to by their equivalent name, which has the form CF\_*XXX*.</span></span> <span data-ttu-id="3be84-139">Ad esempio, il formato degli Appunti per il testo ANSI è il \_ testo CF.</span><span class="sxs-lookup"><span data-stu-id="3be84-139">For instance, the clipboard format for ANSI text is CF\_TEXT.</span></span>

<span data-ttu-id="3be84-140">Le applicazioni possono estendere la gamma di formati degli appunti disponibili definendo i formati privati.</span><span class="sxs-lookup"><span data-stu-id="3be84-140">Applications can extend the range of available clipboard formats by defining private formats.</span></span> <span data-ttu-id="3be84-141">Per definire un formato privato, un'applicazione chiama [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) con una stringa che identifica il formato.</span><span class="sxs-lookup"><span data-stu-id="3be84-141">To define a private format, an application calls [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) with a string that identifies the format.</span></span> <span data-ttu-id="3be84-142">Il Unsigned Integer restituito dalla funzione è un valore di formato valido che può essere utilizzato come un formato degli Appunti standard.</span><span class="sxs-lookup"><span data-stu-id="3be84-142">The unsigned integer that the function returns is a valid format value that can be used just like a standard clipboard format.</span></span> <span data-ttu-id="3be84-143">Tuttavia, l'origine e la destinazione devono registrare il formato per poterlo usare.</span><span class="sxs-lookup"><span data-stu-id="3be84-143">However, both source and target must register the format in order to use it.</span></span> <span data-ttu-id="3be84-144">Con un'eccezione,[CF \_ HDROP](clipboard.md), i formati degli Appunti usati per trasferire i dati della shell sono definiti come formati privati.</span><span class="sxs-lookup"><span data-stu-id="3be84-144">With one exception—[CF\_HDROP](clipboard.md)—the clipboard formats used to transfer Shell data are defined as private formats.</span></span> <span data-ttu-id="3be84-145">Devono essere registrati dall'origine e dalla destinazione prima di poter essere usati.</span><span class="sxs-lookup"><span data-stu-id="3be84-145">They must be registered by the source and target before they can be used.</span></span> <span data-ttu-id="3be84-146">Per una descrizione dei formati degli Appunti della shell disponibili, vedere la pagina relativa ai formati degli Appunti della shell.</span><span class="sxs-lookup"><span data-stu-id="3be84-146">For a description of the available Shell clipboard formats, see Shell Clipboard Formats.</span></span>

<span data-ttu-id="3be84-147">Sebbene esistano alcune eccezioni, in genere gli oggetti dati contengono un solo elemento di dati per ogni formato degli Appunti supportati.</span><span class="sxs-lookup"><span data-stu-id="3be84-147">Although there are some exceptions, data objects normally contain only one item of data for each clipboard format they support.</span></span> <span data-ttu-id="3be84-148">Questa correlazione uno-a-uno tra formato e dati consente di utilizzare il valore del formato come identificatore per l'elemento di dati associato.</span><span class="sxs-lookup"><span data-stu-id="3be84-148">This one-to-one correlation between format and data allows the format value to be used as an identifier for the associated data item.</span></span> <span data-ttu-id="3be84-149">Infatti, quando si discute il contenuto di un oggetto dati, un particolare elemento di dati viene in genere chiamato "Format" e a cui fa riferimento il relativo nome di formato.</span><span class="sxs-lookup"><span data-stu-id="3be84-149">In fact, when discussing the contents of a data object, a particular item of data is typically called a "format" and is referred to by its format name.</span></span> <span data-ttu-id="3be84-150">Ad esempio, frasi come "Estrai il \_ formato di testo CF..." vengono in genere utilizzate quando si discute l'elemento dati di testo ANSI di un oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-150">For example, phrases such as "Extract the CF\_TEXT format..." are typically used when discussing a data object's ANSI text data item.</span></span>

<span data-ttu-id="3be84-151">Quando l'obiettivo di rilascio riceve il puntatore all'oggetto dati, la destinazione di rilascio enumera i formati disponibili per determinare quali tipi di dati sono disponibili.</span><span class="sxs-lookup"><span data-stu-id="3be84-151">When the drop target receives the pointer to the data object, the drop target enumerates the available formats to determine what types of data are available.</span></span> <span data-ttu-id="3be84-152">Quindi richiede uno o più formati disponibili ed estrae i dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-152">It then requests one or more of the available formats and extracts the data.</span></span> <span data-ttu-id="3be84-153">Il modo specifico in cui la destinazione estrae i dati della shell da un oggetto dati varia in base al formato; questo argomento viene descritto in dettaglio in [come una destinazione gestisce un oggetto dati](#how-a-target-handles-a-data-object).</span><span class="sxs-lookup"><span data-stu-id="3be84-153">The specific way that the target extracts Shell data from a data object varies with the format; this is discussed in detail in [How a Target Handles a Data Object](#how-a-target-handles-a-data-object).</span></span>

<span data-ttu-id="3be84-154">Con i trasferimenti di dati degli appunti semplici, i dati vengono inseriti in un oggetto memoria globale.</span><span class="sxs-lookup"><span data-stu-id="3be84-154">With simple clipboard data transfers, the data is placed in a global memory object.</span></span> <span data-ttu-id="3be84-155">L'indirizzo di tale oggetto viene inserito negli Appunti, insieme al relativo formato.</span><span class="sxs-lookup"><span data-stu-id="3be84-155">The address of that object is placed on the Clipboard, along with its format.</span></span> <span data-ttu-id="3be84-156">Il formato degli Appunti indica alla destinazione il tipo di dati che troverà nell'indirizzo associato.</span><span class="sxs-lookup"><span data-stu-id="3be84-156">The clipboard format tells the target what kind of data it will find at the associated address.</span></span> <span data-ttu-id="3be84-157">Sebbene i trasferimenti di appunti semplici siano facili da implementare:</span><span class="sxs-lookup"><span data-stu-id="3be84-157">While simple clipboard transfers are easy to implement:</span></span>

-   <span data-ttu-id="3be84-158">Gli oggetti dati forniscono un metodo molto più flessibile per trasferire i dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-158">Data objects provide a much more flexible way to transfer data.</span></span>
-   <span data-ttu-id="3be84-159">Gli oggetti dati sono più adatti per il trasferimento di grandi quantità di dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-159">Data objects are better suited for transferring large amounts of data.</span></span>
-   <span data-ttu-id="3be84-160">È necessario usare gli oggetti dati per trasferire i dati con un'operazione di trascinamento della selezione.</span><span class="sxs-lookup"><span data-stu-id="3be84-160">Data objects must be used to transfer data with a drag-and-drop operation.</span></span>

<span data-ttu-id="3be84-161">Per questi motivi, tutti i trasferimenti di dati della Shell utilizzano oggetti dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-161">For these reasons, all Shell data transfers use data objects.</span></span> <span data-ttu-id="3be84-162">Con gli oggetti dati, i formati degli Appunti non vengono usati direttamente.</span><span class="sxs-lookup"><span data-stu-id="3be84-162">With data objects, clipboard formats are not used directly.</span></span> <span data-ttu-id="3be84-163">Al contrario, gli elementi di dati vengono identificati con una generalizzazione del formato degli Appunti, una struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) .</span><span class="sxs-lookup"><span data-stu-id="3be84-163">Instead, data items are identified with a generalization of the clipboard format, a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span>

### <a name="formatetc-structure"></a><span data-ttu-id="3be84-164">Struttura FORMATETC</span><span class="sxs-lookup"><span data-stu-id="3be84-164">FORMATETC Structure</span></span>

<span data-ttu-id="3be84-165">La struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) è una versione estesa del formato degli Appunti.</span><span class="sxs-lookup"><span data-stu-id="3be84-165">The [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure is an extended version of a clipboard format.</span></span> <span data-ttu-id="3be84-166">Come usato per i trasferimenti di dati della shell, la struttura **FORMATETC** presenta le caratteristiche seguenti:</span><span class="sxs-lookup"><span data-stu-id="3be84-166">As used for Shell data transfers, the **FORMATETC** structure has the following characteristics:</span></span>

-   <span data-ttu-id="3be84-167">Un elemento dati viene ancora identificato dal formato degli Appunti, nel membro **cfFormat** .</span><span class="sxs-lookup"><span data-stu-id="3be84-167">A data item is still identified by its clipboard format, in the **cfFormat** member.</span></span>
-   <span data-ttu-id="3be84-168">Il trasferimento dei dati non è limitato agli oggetti della memoria globale.</span><span class="sxs-lookup"><span data-stu-id="3be84-168">Data transfer is not limited to global memory objects.</span></span> <span data-ttu-id="3be84-169">Il membro **TYMED** viene usato per indicare il meccanismo di trasferimento dei dati contenuto nella struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) associata.</span><span class="sxs-lookup"><span data-stu-id="3be84-169">The **tymed** member is used to indicate the data transfer mechanism contained in the associated [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="3be84-170">Viene impostato su uno dei valori [**TYMED \_ xxx**](/windows/win32/api/objidl/ne-objidl-tymed) .</span><span class="sxs-lookup"><span data-stu-id="3be84-170">It is set to one of the [**TYMED\_XXX**](/windows/win32/api/objidl/ne-objidl-tymed) values.</span></span>
-   <span data-ttu-id="3be84-171">La shell usa il membro **lIndex** con il [formato \_ fileContents CFSTR](clipboard.md) per consentire a un oggetto dati di contenere più di un elemento di dati per formato.</span><span class="sxs-lookup"><span data-stu-id="3be84-171">The Shell uses the **lIndex** member with its [CFSTR\_FILECONTENTS](clipboard.md) format to allow a data object to contain more than one data item per format.</span></span> <span data-ttu-id="3be84-172">Per informazioni su come usare questo formato, vedere la sezione *uso del \_ formato fileContents CFSTR per estrarre i dati da un file in* [scenari di gestione della shell trasferimento dati](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="3be84-172">For a discussion of how to use this format, see the *Using the CFSTR\_FILECONTENTS Format to Extract Data from a File* section of [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>
-   <span data-ttu-id="3be84-173">Il membro **dwAspect** viene in genere impostato sul \_ contenuto di DVASPECT.</span><span class="sxs-lookup"><span data-stu-id="3be84-173">The **dwAspect** member is typically set to DVASPECT\_CONTENT.</span></span> <span data-ttu-id="3be84-174">Sono tuttavia disponibili tre valori definiti in Shlobj. h che possono essere utilizzati per il trasferimento dei dati della shell.</span><span class="sxs-lookup"><span data-stu-id="3be84-174">However, there are three values defined in Shlobj.h that can be used for Shell data transfer.</span></span> 

    |                     |                                                                                                   |
    |---------------------|---------------------------------------------------------------------------------------------------|
    | <span data-ttu-id="3be84-175">copia di DVASPECT \_</span><span class="sxs-lookup"><span data-stu-id="3be84-175">DVASPECT\_COPY</span></span>      | <span data-ttu-id="3be84-176">Utilizzato per indicare che il formato rappresenta una copia dei dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-176">Used to indicate that the format represents a copy of the data.</span></span>                                   |
    | <span data-ttu-id="3be84-177">\_collegamento DVASPECT</span><span class="sxs-lookup"><span data-stu-id="3be84-177">DVASPECT\_LINK</span></span>      | <span data-ttu-id="3be84-178">Utilizzato per indicare che il formato rappresenta un collegamento ai dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-178">Used to indicate that the format represents a shortcut to the data.</span></span>                               |
    | <span data-ttu-id="3be84-179">DVASPECT \_ ShortName</span><span class="sxs-lookup"><span data-stu-id="3be84-179">DVASPECT\_SHORTNAME</span></span> | <span data-ttu-id="3be84-180">Usato con il \_ formato CF HDROP per richiedere un percorso di file con i nomi abbreviati nel formato 8,3.</span><span class="sxs-lookup"><span data-stu-id="3be84-180">Used with the CF\_HDROP format to request a file path with the names shortened to the 8.3 format.</span></span> |

    

     

-   <span data-ttu-id="3be84-181">Il membro **PTD** non viene usato per i trasferimenti di dati della shell ed è in genere impostato su **null**.</span><span class="sxs-lookup"><span data-stu-id="3be84-181">The **ptd** member is not used for Shell data transfers and is normally set to **NULL**.</span></span>

### <a name="stgmedium-structure"></a><span data-ttu-id="3be84-182">Struttura STGMEDIUM</span><span class="sxs-lookup"><span data-stu-id="3be84-182">STGMEDIUM structure</span></span>

<span data-ttu-id="3be84-183">La struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) fornisce l'accesso ai dati trasferiti.</span><span class="sxs-lookup"><span data-stu-id="3be84-183">The [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure provides access to the data being transferred.</span></span> <span data-ttu-id="3be84-184">Per i dati della shell sono supportati tre meccanismi di trasferimento dei dati:</span><span class="sxs-lookup"><span data-stu-id="3be84-184">Three data transfer mechanisms are supported for Shell data:</span></span>

-   <span data-ttu-id="3be84-185">Oggetto memoria globale.</span><span class="sxs-lookup"><span data-stu-id="3be84-185">A global memory object.</span></span>
-   <span data-ttu-id="3be84-186">Interfaccia [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="3be84-186">An [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span>
-   <span data-ttu-id="3be84-187">Interfaccia [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="3be84-187">An [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span>

<span data-ttu-id="3be84-188">Il membro **TYMED** della struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) è un valore [**TYMED \_ xxx**](/windows/win32/api/objidl/ne-objidl-tymed) che identifica il meccanismo di trasferimento dei dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-188">The **tymed** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure is a [**TYMED\_XXX**](/windows/win32/api/objidl/ne-objidl-tymed) value that identifies the data transfer mechanism.</span></span> <span data-ttu-id="3be84-189">Il secondo membro è un puntatore usato dalla destinazione per estrarre i dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-189">The second member is a pointer that is used by the target to extract the data.</span></span> <span data-ttu-id="3be84-190">Il puntatore può essere di una varietà di tipi, a seconda del valore di **TYMED** .</span><span class="sxs-lookup"><span data-stu-id="3be84-190">The pointer can be one of a variety of types, depending on the **tymed** value.</span></span> <span data-ttu-id="3be84-191">I tre valori **TYMED** usati per i trasferimenti di dati della shell sono riepilogati nella tabella seguente, insieme al nome del membro **STGMEDIUM** corrispondente.</span><span class="sxs-lookup"><span data-stu-id="3be84-191">The three **tymed** values that are used for Shell data transfers are summarized in the following table, along with their corresponding **STGMEDIUM** member name.</span></span>



| <span data-ttu-id="3be84-192">Valore TYMED</span><span class="sxs-lookup"><span data-stu-id="3be84-192">tymed Value</span></span>     | <span data-ttu-id="3be84-193">Nome del membro</span><span class="sxs-lookup"><span data-stu-id="3be84-193">Member name</span></span> | <span data-ttu-id="3be84-194">Descrizione</span><span class="sxs-lookup"><span data-stu-id="3be84-194">Description</span></span>                                                                                                                                                                                                                                                                                                       |
|-----------------|-------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="3be84-195">\_HGLOBAL TYMED</span><span class="sxs-lookup"><span data-stu-id="3be84-195">TYMED\_HGLOBAL</span></span>  | <span data-ttu-id="3be84-196">**hGlobal**</span><span class="sxs-lookup"><span data-stu-id="3be84-196">**hGlobal**</span></span> | <span data-ttu-id="3be84-197">Puntatore a un oggetto memoria globale.</span><span class="sxs-lookup"><span data-stu-id="3be84-197">A pointer to a global memory object.</span></span> <span data-ttu-id="3be84-198">Questo tipo di puntatore viene in genere utilizzato per il trasferimento di piccole quantità di dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-198">This pointer type is typically used for transferring small amounts of data.</span></span> <span data-ttu-id="3be84-199">Ad esempio, la shell usa gli oggetti memoria globale per trasferire stringhe di testo brevi, ad esempio nomi file o URL.</span><span class="sxs-lookup"><span data-stu-id="3be84-199">For instance, the Shell uses global memory objects to transfer short text strings such as file names or URLs.</span></span>                                                                                    |
| <span data-ttu-id="3be84-200">\_IStream TYMED</span><span class="sxs-lookup"><span data-stu-id="3be84-200">TYMED\_ISTREAM</span></span>  | <span data-ttu-id="3be84-201">**pstm**</span><span class="sxs-lookup"><span data-stu-id="3be84-201">**pstm**</span></span>    | <span data-ttu-id="3be84-202">Puntatore a un'interfaccia [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="3be84-202">A pointer to an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) interface.</span></span> <span data-ttu-id="3be84-203">Questo tipo di puntatore è preferibile per la maggior parte dei trasferimenti di dati della shell perché richiede una quantità di memoria relativamente ridotta rispetto a TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="3be84-203">This pointer type is preferred for most Shell data transfers because it requires relatively little memory compared to TYMED\_HGLOBAL.</span></span> <span data-ttu-id="3be84-204">Inoltre, il \_ meccanismo di trasferimento dei dati di TYMED IStream non richiede che l'origine memorizzi i dati in un modo particolare.</span><span class="sxs-lookup"><span data-stu-id="3be84-204">Also, the TYMED\_ISTREAM data transfer mechanism does not require the source to store its data in any particular way.</span></span> |
| <span data-ttu-id="3be84-205">\_ISTORAGE TYMED</span><span class="sxs-lookup"><span data-stu-id="3be84-205">TYMED\_ISTORAGE</span></span> | <span data-ttu-id="3be84-206">**pstg**</span><span class="sxs-lookup"><span data-stu-id="3be84-206">**pstg**</span></span>    | <span data-ttu-id="3be84-207">Puntatore a un'interfaccia [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="3be84-207">A pointer to an [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="3be84-208">La destinazione chiama i metodi di interfaccia per estrarre i dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-208">The target calls the interface methods to extract the data.</span></span> <span data-ttu-id="3be84-209">Analogamente a TYMED \_ IStream, questo tipo di puntatore richiede una quantità di memoria relativamente ridotta.</span><span class="sxs-lookup"><span data-stu-id="3be84-209">Like TYMED\_ISTREAM, this pointer type requires relatively little memory.</span></span> <span data-ttu-id="3be84-210">Tuttavia, poiché TYMED \_ ISTORAGE è meno flessibile di TYMED \_ IStream, non viene usato comunemente.</span><span class="sxs-lookup"><span data-stu-id="3be84-210">However, because TYMED\_ISTORAGE is less flexible than TYMED\_ISTREAM, it is not as commonly used.</span></span>                  |



 

## <a name="how-a-source-creates-a-data-object"></a><span data-ttu-id="3be84-211">Creazione di un oggetto dati in un'origine</span><span class="sxs-lookup"><span data-stu-id="3be84-211">How a Source Creates a Data Object</span></span>

<span data-ttu-id="3be84-212">Quando un utente avvia un trasferimento dati della shell, l'origine è responsabile della creazione di un oggetto dati e del relativo caricamento con i dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-212">When a user initiates a Shell data transfer, the source is responsible for creating a data object and loading it with data.</span></span> <span data-ttu-id="3be84-213">Nella procedura seguente viene riepilogato il processo:</span><span class="sxs-lookup"><span data-stu-id="3be84-213">The following procedure summarizes the process:</span></span>

1.  <span data-ttu-id="3be84-214">Chiamare [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) per ottenere un valore di formato degli Appunti valido per ogni formato della shell che verrà incluso nell'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-214">Call [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) to obtain a valid clipboard format value for each Shell format that will be included in the data object.</span></span> <span data-ttu-id="3be84-215">Tenere presente che [CF \_ HDROP](clipboard.md) è già un formato degli Appunti valido e non deve essere registrato.</span><span class="sxs-lookup"><span data-stu-id="3be84-215">Remember that [CF\_HDROP](clipboard.md) is already a valid clipboard format and does not need to be registered.</span></span>
2.  <span data-ttu-id="3be84-216">Per ogni formato da trasferire, inserire i dati associati in un oggetto memoria globale o creare un oggetto che fornisca l'accesso a tali dati tramite un'interfaccia [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) o [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) .</span><span class="sxs-lookup"><span data-stu-id="3be84-216">For each format to be transferred, either put the associated data into a global memory object or create an object that provides access to that data through an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) or [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface.</span></span> <span data-ttu-id="3be84-217">Le interfacce **IStream** e **IStorage** vengono create utilizzando tecniche com standard.</span><span class="sxs-lookup"><span data-stu-id="3be84-217">The **IStream** and **IStorage** interfaces are created using standard COM techniques.</span></span> <span data-ttu-id="3be84-218">Per informazioni su come gestire gli oggetti della memoria globale, vedere [come aggiungere un oggetto memoria globale a un oggetto dati](#how-to-add-a-global-memory-object-to-a-data-object).</span><span class="sxs-lookup"><span data-stu-id="3be84-218">For a discussion of how to handle global memory objects, see [How to Add a Global Memory Object to a Data Object](#how-to-add-a-global-memory-object-to-a-data-object).</span></span>
3.  <span data-ttu-id="3be84-219">Creare strutture [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) e [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) per ogni formato.</span><span class="sxs-lookup"><span data-stu-id="3be84-219">Create [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures for each format.</span></span>
4.  <span data-ttu-id="3be84-220">Creare un'istanza di un oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-220">Instantiate a data object.</span></span>
5.  <span data-ttu-id="3be84-221">Caricare i dati nell'oggetto dati chiamando il metodo [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) per ogni formato supportato e passando le strutture [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) e [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) del formato.</span><span class="sxs-lookup"><span data-stu-id="3be84-221">Load the data into the data object by calling the [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method for each supported format and passing in the format's [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures.</span></span>
6.  <span data-ttu-id="3be84-222">Con i trasferimenti di dati degli Appunti, chiamare [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) per inserire un puntatore all'interfaccia [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) dell'oggetto dati negli Appunti.</span><span class="sxs-lookup"><span data-stu-id="3be84-222">With clipboard data transfers, call [**OleSetClipboard**](/windows/win32/api/ole2/nf-ole2-olesetclipboard) to place a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface on the Clipboard.</span></span> <span data-ttu-id="3be84-223">Per i trasferimenti con trascinamento della selezione, avviare un *ciclo di trascinamento* chiamando [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span><span class="sxs-lookup"><span data-stu-id="3be84-223">For drag-and-drop transfers, initiate a *drag loop* by calling [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop).</span></span> <span data-ttu-id="3be84-224">Il puntatore **IDataObject** verrà passato all'obiettivo di rilascio quando i dati vengono eliminati, terminando il ciclo di trascinamento.</span><span class="sxs-lookup"><span data-stu-id="3be84-224">The **IDataObject** pointer will be passed to the drop target when the data is dropped, ending the drag loop.</span></span>

<span data-ttu-id="3be84-225">L'oggetto dati è ora pronto per essere trasferito alla destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-225">The data object is now ready to be transferred to the target.</span></span> <span data-ttu-id="3be84-226">Per i trasferimenti di dati degli Appunti, l'oggetto viene semplicemente mantenuto fino a quando non viene richiesto dalla destinazione chiamando [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span><span class="sxs-lookup"><span data-stu-id="3be84-226">For clipboard data transfers, the object is simply held until the target requests it by calling [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span></span> <span data-ttu-id="3be84-227">Per i trasferimenti di dati con trascinamento della selezione, l'oggetto dati è responsabile della creazione di un'icona per rappresentare i dati e dello spostamento quando l'utente sposta il cursore.</span><span class="sxs-lookup"><span data-stu-id="3be84-227">For drag-and-drop data transfers, the data object is responsible for creating an icon to represent the data and moving it as the user moves the cursor.</span></span> <span data-ttu-id="3be84-228">Mentre l'oggetto si trova nel ciclo di trascinamento, l'origine riceve informazioni sullo stato tramite l'interfaccia [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) .</span><span class="sxs-lookup"><span data-stu-id="3be84-228">While the object is in the drag loop, the source receives status information through its [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="3be84-229">Per ulteriori informazioni, vedere [implementazione di IDropSource](#implementing-idropsource).</span><span class="sxs-lookup"><span data-stu-id="3be84-229">For further discussion, see [Implementing IDropSource](#implementing-idropsource).</span></span>

<span data-ttu-id="3be84-230">L'origine non riceve alcuna notifica se l'oggetto dati viene recuperato dagli Appunti da una destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-230">The source receives no notification if the data object is retrieved from the Clipboard by a target.</span></span> <span data-ttu-id="3be84-231">Quando un oggetto viene rilasciato in una destinazione mediante un'operazione di trascinamento della selezione, la funzione [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) chiamata per avviare il ciclo di trascinamento restituirà.</span><span class="sxs-lookup"><span data-stu-id="3be84-231">When an object is dropped on a target by a drag-and-drop operation, the [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) function that was called to initiate the drag loop will return.</span></span>

### <a name="how-to-add-a-global-memory-object-to-a-data-object"></a><span data-ttu-id="3be84-232">Come aggiungere un oggetto memoria globale a un oggetto dati</span><span class="sxs-lookup"><span data-stu-id="3be84-232">How to Add a Global Memory Object to a Data Object</span></span>

<span data-ttu-id="3be84-233">Molti formati di dati della shell sono sotto forma di oggetto memoria globale.</span><span class="sxs-lookup"><span data-stu-id="3be84-233">Many of the Shell data formats are in the form of a global memory object.</span></span> <span data-ttu-id="3be84-234">Utilizzare la procedura seguente per creare un formato contenente un oggetto memoria globale e caricarlo nell'oggetto dati:</span><span class="sxs-lookup"><span data-stu-id="3be84-234">Use the following procedure to create a format containing a global memory object and load it into the data object:</span></span>

1.  <span data-ttu-id="3be84-235">Creare una struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) .</span><span class="sxs-lookup"><span data-stu-id="3be84-235">Create a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="3be84-236">Impostare il membro **cfFormat** sul valore del formato degli Appunti appropriato e il membro **TYMED** su TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="3be84-236">Set the **cfFormat** member to the appropriate clipboard format value and the **tymed** member to TYMED\_HGLOBAL.</span></span>
2.  <span data-ttu-id="3be84-237">Creare una struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .</span><span class="sxs-lookup"><span data-stu-id="3be84-237">Create an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="3be84-238">Impostare il membro **TYMED** su TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="3be84-238">Set the **tymed** member to TYMED\_HGLOBAL.</span></span>
3.  <span data-ttu-id="3be84-239">Creare un oggetto memoria globale chiamando [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc) per allocare un blocco di memoria opportunamente dimensionato.</span><span class="sxs-lookup"><span data-stu-id="3be84-239">Create a global memory object by calling [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc) to allocate a suitably sized block of memory.</span></span>
4.  <span data-ttu-id="3be84-240">Assegnare il blocco di dati da trasferire all'indirizzo restituito da [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc).</span><span class="sxs-lookup"><span data-stu-id="3be84-240">Assign the block of data to be transferred to the address returned by [**GlobalAlloc**](/windows/win32/api/winbase/nf-winbase-globalalloc).</span></span>
5.  <span data-ttu-id="3be84-241">Assegnare l'indirizzo dell'oggetto memoria globale al membro **hGlobal** della struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .</span><span class="sxs-lookup"><span data-stu-id="3be84-241">Assign the global memory object's address to the **hGlobal** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
6.  <span data-ttu-id="3be84-242">Caricare il formato nell'oggetto dati chiamando [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) e passando le strutture [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) e [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) create nei passaggi precedenti.</span><span class="sxs-lookup"><span data-stu-id="3be84-242">Load the format into the data object by calling [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) and passing in the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures created in the previous steps.</span></span>

<span data-ttu-id="3be84-243">La funzione di esempio seguente crea un oggetto memoria globale contenente un valore **DWORD** e lo carica in un oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-243">The following sample function creates a global memory object containing a **DWORD** value and loads it into a data object.</span></span> <span data-ttu-id="3be84-244">Il parametro **pdtobj** è un puntatore all'interfaccia [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) dell'oggetto dati, **CF** è il valore del formato degli Appunti e **DW** è il valore dei dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-244">The **pdtobj** parameter is a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface, **cf** is the clipboard format value, and **dw** is the data value.</span></span>


```C++
STDAPI DataObj_SetDWORD(IDataObject *pdtobj, UINT cf, DWORD dw)
{
    FORMATETC fmte = {(CLIPFORMAT) cf, 
                      NULL, 
                      DVASPECT_CONTENT, 
                      -1, 
                      TYMED_HGLOBAL};
    STGMEDIUM medium;

    HRESULT hres = E_OUTOFMEMORY;
    DWORD *pdw = (DWORD *)GlobalAlloc(GPTR, sizeof(DWORD));
    
    if (pdw)
    {
        *pdw = dw;       
        medium.tymed = TYMED_HGLOBAL;
        medium.hGlobal = pdw;
        medium.pUnkForRelease = NULL;

        hres = pdtobj->SetData(&fmte, &medium, TRUE);
 
        if (FAILED(hres))
            GlobalFree((HGLOBAL)pdw);
    }
    return hres;
}
```



### <a name="implementing-idataobject"></a><span data-ttu-id="3be84-245">Implementazione di IDataObject</span><span class="sxs-lookup"><span data-stu-id="3be84-245">Implementing IDataObject</span></span>

<span data-ttu-id="3be84-246">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) è l'interfaccia primaria di un oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-246">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) is a data object's primary interface.</span></span> <span data-ttu-id="3be84-247">Deve essere implementato da tutti gli oggetti dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-247">It must be implemented by all data objects.</span></span> <span data-ttu-id="3be84-248">Viene usato sia da origine che da destinazione per diversi scopi, tra cui:</span><span class="sxs-lookup"><span data-stu-id="3be84-248">It is used by both source and target for a variety of purposes, including:</span></span>

-   <span data-ttu-id="3be84-249">Caricamento dei dati nell'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-249">Loading data into the data object.</span></span>
-   <span data-ttu-id="3be84-250">Estrazione dei dati dall'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-250">Extracting data from the data object.</span></span>
-   <span data-ttu-id="3be84-251">Determinazione dei tipi di dati presenti nell'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-251">Determining what types of data are in the data object.</span></span>
-   <span data-ttu-id="3be84-252">Invio di commenti e suggerimenti all'oggetto dati sul risultato del trasferimento dei dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-252">Providing feedback to the data object on outcome of the data transfer.</span></span>

<span data-ttu-id="3be84-253">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) supporta diversi metodi.</span><span class="sxs-lookup"><span data-stu-id="3be84-253">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) supports a number of methods.</span></span> <span data-ttu-id="3be84-254">In questa sezione viene illustrato come implementare i tre metodi più importanti per gli oggetti dati della shell, [SetData](#setdata-method), [EnumFormatEtc](#enumformatetc-method)e [GetData](#getdata-method).</span><span class="sxs-lookup"><span data-stu-id="3be84-254">This section discusses how to implement the three most important methods for Shell data objects, [SetData](#setdata-method), [EnumFormatEtc](#enumformatetc-method), and [GetData](#getdata-method).</span></span> <span data-ttu-id="3be84-255">Per informazioni sugli altri metodi, vedere il riferimento a **IDataObject** .</span><span class="sxs-lookup"><span data-stu-id="3be84-255">For a discussion of the other methods, see the **IDataObject** reference.</span></span>

### <a name="setdata-method"></a><span data-ttu-id="3be84-256">SetData (metodo)</span><span class="sxs-lookup"><span data-stu-id="3be84-256">SetData method</span></span>

<span data-ttu-id="3be84-257">La funzione primaria del metodo [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) consente all'origine di caricare i dati nell'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-257">The primary function of the [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) method is to allow the source to load data into the data object.</span></span> <span data-ttu-id="3be84-258">Per includere ogni formato, l'origine crea una struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) per identificare il formato e una struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) per contenere un puntatore ai dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-258">For each format to be included, the source creates a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to identify the format and an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure to hold a pointer to the data.</span></span> <span data-ttu-id="3be84-259">L'origine chiama quindi il metodo **IDataObject:: SetData** dell'oggetto e passa le strutture **FORMATETC** e **STGMEDIUM** del formato.</span><span class="sxs-lookup"><span data-stu-id="3be84-259">The source then calls the object's **IDataObject::SetData** method and passes in the format's **FORMATETC** and **STGMEDIUM** structures.</span></span> <span data-ttu-id="3be84-260">Il metodo deve archiviare queste informazioni in modo che siano disponibili quando la destinazione chiama [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) per estrarre i dati dall'oggetto.</span><span class="sxs-lookup"><span data-stu-id="3be84-260">The method must store this information so that it is available when the target calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to extract data from the object.</span></span>

<span data-ttu-id="3be84-261">Tuttavia, durante il trasferimento di file, la shell spesso inserisce le informazioni per ogni file da trasferire in un formato [CFSTR \_ fileContents](clipboard.md) separato.</span><span class="sxs-lookup"><span data-stu-id="3be84-261">However, when transferring files, the Shell often puts the information for each file to be transferred into a separate [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span> <span data-ttu-id="3be84-262">Per distinguere i diversi file, il membro **lIndex** della struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) di ogni file viene impostato su un valore di indice che identifica il file specifico.</span><span class="sxs-lookup"><span data-stu-id="3be84-262">To distinguish the different files, the **lIndex** member of each file's [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure is set to an index value that identifies the particular file.</span></span> <span data-ttu-id="3be84-263">L'implementazione di [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) deve essere in grado di archiviare più \_ formati fileContents CFSTR che differiscono solo per i membri di **lIndex** .</span><span class="sxs-lookup"><span data-stu-id="3be84-263">Your [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) implementation must be capable of storing multiple CFSTR\_FILECONTENTS formats that differ only by their **lIndex** members.</span></span>

<span data-ttu-id="3be84-264">Quando il cursore si trova sulla finestra di destinazione, la destinazione può usare l'oggetto di supporto per il [trascinamento della selezione](#using-the-drag-and-drop-helper-object) per specificare l'immagine di trascinamento.</span><span class="sxs-lookup"><span data-stu-id="3be84-264">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to specify the drag image.</span></span> <span data-ttu-id="3be84-265">L'oggetto helper di trascinamento della selezione chiama [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) per caricare formati privati nell'oggetto dati utilizzati per il supporto tra processi.</span><span class="sxs-lookup"><span data-stu-id="3be84-265">The drag-and-drop helper object calls [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to load private formats into the data object that are used for cross-process support.</span></span> <span data-ttu-id="3be84-266">Per supportare l'oggetto helper di trascinamento della selezione, l'implementazione di **IDataObject:: SetData** deve essere in grado di accettare e archiviare formati privati arbitrari.</span><span class="sxs-lookup"><span data-stu-id="3be84-266">To support the drag-and-drop helper object, your **IDataObject::SetData** implementation must be able to accept and store arbitrary private formats.</span></span>

<span data-ttu-id="3be84-267">Una volta eliminati i dati, alcuni tipi di trasferimento dei dati della shell richiedono che la destinazione chiami [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) per fornire all'oggetto dati le informazioni sul risultato dell'operazione di rilascio.</span><span class="sxs-lookup"><span data-stu-id="3be84-267">After the data has been dropped, some types of Shell data transfer require the target to call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to provide the data object with information about the outcome of the drop operation.</span></span> <span data-ttu-id="3be84-268">Ad esempio, quando si spostano i file con un'operazione di spostamento ottimizzata, la destinazione normalmente Elimina i file originali, ma non è necessario.</span><span class="sxs-lookup"><span data-stu-id="3be84-268">For example, when moving files with an optimized move operation, the target normally deletes the original files, but it is not required to do so.</span></span> <span data-ttu-id="3be84-269">La destinazione informa l'oggetto dati se i file sono stati eliminati chiamando **IDataObject:: SetData** con un formato [CFSTR \_ LOGICALPERFORMEDDROPEFFECT](clipboard.md) .</span><span class="sxs-lookup"><span data-stu-id="3be84-269">The target informs the data object whether it deleted the files by calling **IDataObject::SetData** with a [CFSTR\_LOGICALPERFORMEDDROPEFFECT](clipboard.md) format.</span></span> <span data-ttu-id="3be84-270">Sono disponibili diversi altri [formati degli Appunti della shell](clipboard.md) utilizzati dalla destinazione per passare informazioni all'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-270">There are several other [Shell Clipboard Formats](clipboard.md) that are also used by the target to pass information to the data object.</span></span> <span data-ttu-id="3be84-271">L'implementazione di **IDataObject:: SetData** deve essere in grado di riconoscere questi formati e rispondere in modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="3be84-271">Your **IDataObject::SetData** implementation must be able to recognize these formats and respond appropriately.</span></span> <span data-ttu-id="3be84-272">Per ulteriori informazioni, vedere [gestione degli scenari di trasferimento dati Shell](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="3be84-272">For further discussion, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

### <a name="enumformatetc-method"></a><span data-ttu-id="3be84-273">Metodo EnumFormatEtc</span><span class="sxs-lookup"><span data-stu-id="3be84-273">EnumFormatEtc method</span></span>

<span data-ttu-id="3be84-274">Quando la destinazione riceve un oggetto dati, in genere chiama [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) per determinare quali formati sono contenuti nell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="3be84-274">When the target receives a data object, it commonly calls [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) to determine what formats the object contains.</span></span> <span data-ttu-id="3be84-275">Il metodo crea un oggetto enumerazione OLE e restituisce un puntatore all'interfaccia [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="3be84-275">The method creates an OLE enumeration object and returns a pointer to the object's [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) interface.</span></span> <span data-ttu-id="3be84-276">La destinazione USA quindi l'interfaccia per enumerare i formati disponibili.</span><span class="sxs-lookup"><span data-stu-id="3be84-276">The target then uses the interface to enumerate the available formats.</span></span>

<span data-ttu-id="3be84-277">Un oggetto enumerazione deve sempre enumerare i formati disponibili in ordine di qualità, a partire dal migliore.</span><span class="sxs-lookup"><span data-stu-id="3be84-277">An enumeration object should always enumerate the available formats in order of quality, starting with the best.</span></span> <span data-ttu-id="3be84-278">La qualità relativa dei formati è definita dall'origine di rilascio.</span><span class="sxs-lookup"><span data-stu-id="3be84-278">The relative quality of formats is defined by the drop source.</span></span> <span data-ttu-id="3be84-279">In generale, i formati di qualità superiore contengono i dati più ricchi e più completi.</span><span class="sxs-lookup"><span data-stu-id="3be84-279">In general, the highest-quality formats contain the richest and most complete data.</span></span> <span data-ttu-id="3be84-280">Ad esempio, un'immagine a 24 bit viene normalmente considerata di qualità superiore rispetto a una versione di tale immagine in scala di grigi.</span><span class="sxs-lookup"><span data-stu-id="3be84-280">For instance, a 24-bit color image would normally be considered higher quality than a gray-scale version of that image.</span></span> <span data-ttu-id="3be84-281">Il motivo per l'enumerazione dei formati in ordine di qualità consiste nel fatto che le destinazioni vengono in genere enumerate fino a raggiungere un formato supportato e quindi utilizzano tale formato per estrarre i dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-281">The reason for enumerating formats in order of their quality is that targets typically enumerate until they get to a format that they support, and then they use that format to extract the data.</span></span> <span data-ttu-id="3be84-282">Affinché questa procedura produca il migliore formato disponibile che la destinazione può supportare, i formati devono essere enumerati in ordine di qualità.</span><span class="sxs-lookup"><span data-stu-id="3be84-282">For this procedure to produce the best available format that the target can support, the formats must be enumerated in order of their quality.</span></span>

<span data-ttu-id="3be84-283">Un oggetto di enumerazione per i dati della shell viene implementato in modo molto simile a quello di altri tipi di trasferimento dei dati, con un'eccezione rilevante.</span><span class="sxs-lookup"><span data-stu-id="3be84-283">An enumeration object for Shell data is implemented in much the same way as for other types of data transfer, with one notable exception.</span></span> <span data-ttu-id="3be84-284">Poiché gli oggetti dati contengono in genere solo un elemento dati per formato, in genere enumerano ogni formato passato a [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span><span class="sxs-lookup"><span data-stu-id="3be84-284">Because data objects typically contain only one data item per format, they normally enumerate every format that is passed to [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span></span> <span data-ttu-id="3be84-285">Tuttavia, come illustrato nella sezione relativa al [metodo SetData](#setdata-method) , gli oggetti dati della shell possono contenere più formati [ \_ fileContents di CFSTR](clipboard.md) .</span><span class="sxs-lookup"><span data-stu-id="3be84-285">However, as discussed in the [SetData method](#setdata-method) section, Shell data objects can contain multiple [CFSTR\_FILECONTENTS](clipboard.md) formats.</span></span>

<span data-ttu-id="3be84-286">Poiché lo scopo di [**IDataObject:: EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) è quello di consentire alla destinazione di determinare i tipi di dati presenti, non è necessario enumerare più di un formato [di \_ fileContents CFSTR](clipboard.md) .</span><span class="sxs-lookup"><span data-stu-id="3be84-286">Because the purpose of [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc) is to allow the target to determine what types of data are present, there is no need to enumerate more than one [CFSTR\_FILECONTENTS](clipboard.md) format.</span></span> <span data-ttu-id="3be84-287">Se è necessario che la destinazione conosca il numero di formati contenuti nell'oggetto dati, la destinazione può recuperare tali informazioni dal \_ formato di FILEDESCRIPTOR CFSTR associato.</span><span class="sxs-lookup"><span data-stu-id="3be84-287">If the target needs to know how many of these formats the data object contains, the target can retrieve that information from the accompanying CFSTR\_FILEDESCRIPTOR format.</span></span> <span data-ttu-id="3be84-288">Per ulteriori informazioni su come implementare **IDataObject:: EnumFormatEtc**, vedere la documentazione di riferimento del metodo.</span><span class="sxs-lookup"><span data-stu-id="3be84-288">For further discussion of how to implement **IDataObject::EnumFormatEtc**, see the method's reference documentation.</span></span>

### <a name="getdata-method"></a><span data-ttu-id="3be84-289">GetData (metodo)</span><span class="sxs-lookup"><span data-stu-id="3be84-289">GetData method</span></span>

<span data-ttu-id="3be84-290">La destinazione chiama [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) per estrarre un particolare formato dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-290">The target calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to extract a particular data format.</span></span> <span data-ttu-id="3be84-291">La destinazione specifica il formato passando la struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) appropriata.</span><span class="sxs-lookup"><span data-stu-id="3be84-291">The target specifies the format by passing in the appropriate [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="3be84-292">**IDataObject:: GetData** restituisce la struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) del formato.</span><span class="sxs-lookup"><span data-stu-id="3be84-292">**IDataObject::GetData** returns the format's [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>

<span data-ttu-id="3be84-293">La destinazione può impostare il membro **TYMED** della struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) su un valore TYMED \_ *xxx* specifico per specificare il meccanismo di trasferimento dei dati che verrà utilizzato per estrarre i dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-293">The target can set the **tymed** member of the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to a specific TYMED\_*XXX* value to specify which data transfer mechanism it will use to extract the data.</span></span> <span data-ttu-id="3be84-294">Tuttavia, la destinazione può anche effettuare una richiesta più generica e consentire all'oggetto dati di decidere.</span><span class="sxs-lookup"><span data-stu-id="3be84-294">However, the target can also make a more generic request and let the data object decide.</span></span> <span data-ttu-id="3be84-295">Per richiedere all'oggetto dati di selezionare il meccanismo di trasferimento dei dati, la destinazione imposta tutti i valori TYMED \_ *xxx* supportati.</span><span class="sxs-lookup"><span data-stu-id="3be84-295">To ask the data object to select the data transfer mechanism, the target sets all the TYMED\_*XXX* values that it supports.</span></span> <span data-ttu-id="3be84-296">[**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) seleziona uno di questi meccanismi di trasferimento dei dati e restituisce la struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) appropriata.</span><span class="sxs-lookup"><span data-stu-id="3be84-296">[**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) selects one of these data transfer mechanisms and returns the appropriate [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="3be84-297">Ad esempio, **TYMED** è in genere impostato su TYMED \_ HGLOBAL \| TYMED \_ IStream \| TYMED \_ ISTORAGE per richiedere uno dei tre meccanismi di trasferimento dei dati della shell.</span><span class="sxs-lookup"><span data-stu-id="3be84-297">For instance, **tymed** is commonly set to TYMED\_HGLOBAL \| TYMED\_ISTREAM \| TYMED\_ISTORAGE to request any of the three Shell data transfer mechanisms.</span></span>

> [!Note]  
> <span data-ttu-id="3be84-298">Poiché possono essere presenti più [formati \_ fileContents CFSTR](clipboard.md) , i membri **cfFormat** e **TYMED** della struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) non sono sufficienti per indicare la struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) di [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) che deve restituire.</span><span class="sxs-lookup"><span data-stu-id="3be84-298">Because there can be multiple [CFSTR\_FILECONTENTS](clipboard.md) formats, the **cfFormat** and **tymed** members of the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure are not sufficient to indicate which [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) should return.</span></span> <span data-ttu-id="3be84-299">Per il \_ formato CFSTR FILEcontents, **IDataObject:: GetData** deve esaminare anche il membro **lIndex** della struttura **FORMATETC** per restituire la struttura **STGMEDIUM** corretta.</span><span class="sxs-lookup"><span data-stu-id="3be84-299">For the CFSTR\_FILECONTENTS format, **IDataObject::GetData** must also examine the **FORMATETC** structure's **lIndex** member in order to return the correct **STGMEDIUM** structure.</span></span>

 

<span data-ttu-id="3be84-300">Il formato [CFSTR \_ INDRAGLOOP](clipboard.md) viene inserito in oggetti dati per consentire alle destinazioni di controllare lo stato del ciclo di trascinamento della selezione evitando il rendering intensivo della memoria dei dati dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="3be84-300">The [CFSTR\_INDRAGLOOP](clipboard.md) format is placed in data objects to allow targets to check the status of the drag-and-drop loop while avoiding memory intensive rendering of the object's data.</span></span> <span data-ttu-id="3be84-301">I dati del formato sono un valore **DWORD** impostato su un valore diverso da zero se l'oggetto dati si trova all'interno di un ciclo di trascinamento.</span><span class="sxs-lookup"><span data-stu-id="3be84-301">The format's data is a **DWORD** value that is set to a nonzero value if the data object is within a drag loop.</span></span> <span data-ttu-id="3be84-302">Il valore dei dati del formato è impostato su zero se i dati sono stati eliminati.</span><span class="sxs-lookup"><span data-stu-id="3be84-302">The format's data value is set to zero if the data has been dropped.</span></span> <span data-ttu-id="3be84-303">Se una destinazione richiede questo formato e non è stato caricato dall'origine, [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) deve rispondere come se l'origine avesse caricato il formato con un valore pari a zero.</span><span class="sxs-lookup"><span data-stu-id="3be84-303">If a target requests this format and it has not been loaded by the source, [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) should respond as if the source had loaded the format with a value of zero.</span></span>

<span data-ttu-id="3be84-304">Quando il cursore si trova sulla finestra di destinazione, la destinazione può usare l'oggetto di supporto per il [trascinamento della selezione](#using-the-drag-and-drop-helper-object) per specificare l'immagine di trascinamento.</span><span class="sxs-lookup"><span data-stu-id="3be84-304">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to specify the drag image.</span></span> <span data-ttu-id="3be84-305">L'oggetto helper di trascinamento della selezione chiama [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) per caricare formati privati nell'oggetto dati utilizzati per il supporto tra processi.</span><span class="sxs-lookup"><span data-stu-id="3be84-305">The drag-and-drop helper object calls [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to load private formats into the data object that are used for cross-process support.</span></span> <span data-ttu-id="3be84-306">In un secondo momento chiama [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) per recuperarli.</span><span class="sxs-lookup"><span data-stu-id="3be84-306">It later calls [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) to retrieve them.</span></span> <span data-ttu-id="3be84-307">Per supportare l'oggetto helper di trascinamento della selezione, l'implementazione dell'oggetto dati della shell deve essere in grado di restituire formati privati arbitrari quando vengono richiesti.</span><span class="sxs-lookup"><span data-stu-id="3be84-307">To support the drag-and-drop helper object, your Shell Data Object implementation must be able to return arbitrary private formats when they are requested.</span></span>

### <a name="implementing-idropsource"></a><span data-ttu-id="3be84-308">Implementazione di IDropSource</span><span class="sxs-lookup"><span data-stu-id="3be84-308">Implementing IDropSource</span></span>

<span data-ttu-id="3be84-309">L'origine deve creare un oggetto che espone un'interfaccia [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) .</span><span class="sxs-lookup"><span data-stu-id="3be84-309">The source must create an object that exposes an [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="3be84-310">Questa interfaccia consente all'origine di aggiornare l' *immagine di trascinamento* che indica la posizione corrente del cursore e di inviare commenti e suggerimenti al sistema su come terminare un'operazione di trascinamento della selezione.</span><span class="sxs-lookup"><span data-stu-id="3be84-310">This interface allows the source to update the *drag image* that indicates the current position of the cursor and to provide feedback to the system on how to terminate a drag-and-drop operation.</span></span> <span data-ttu-id="3be84-311">**IDropSource** dispone di due metodi: [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) e [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag).</span><span class="sxs-lookup"><span data-stu-id="3be84-311">**IDropSource** has two methods: [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) and [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag).</span></span>

### <a name="givefeedback-method"></a><span data-ttu-id="3be84-312">GiveFeedback (metodo)</span><span class="sxs-lookup"><span data-stu-id="3be84-312">GiveFeedback method</span></span>

<span data-ttu-id="3be84-313">Nel ciclo di trascinamento, un'origine di rilascio è responsabile di tenere traccia della posizione del cursore e di visualizzare un'immagine di trascinamento appropriata.</span><span class="sxs-lookup"><span data-stu-id="3be84-313">While in the drag loop, a drop source is responsible for keeping track of the cursor position and displaying an appropriate drag image.</span></span> <span data-ttu-id="3be84-314">In alcuni casi, tuttavia, potrebbe essere necessario modificare l'aspetto dell'immagine di trascinamento quando si trova sulla finestra della destinazione di rilascio.</span><span class="sxs-lookup"><span data-stu-id="3be84-314">However, in some cases you might want to change the appearance of the drag image when it is over the drop target's window.</span></span>

<span data-ttu-id="3be84-315">Quando il cursore entra o esce dalla finestra di destinazione e mentre si sposta sulla finestra di destinazione, il sistema chiama periodicamente l'interfaccia [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) della destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-315">When the cursor enters or leaves the target window and while it is moving over the target window, the system periodically calls the target's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span> <span data-ttu-id="3be84-316">La destinazione risponde con un valore [**DropEffect**](../com/dropeffect-constants.md) che viene inviato all'origine tramite il metodo [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) .</span><span class="sxs-lookup"><span data-stu-id="3be84-316">The target responds with a [**DROPEFFECT**](../com/dropeffect-constants.md) value that is forwarded to the source through the [**GiveFeedback**](/windows/win32/api/oleidl/nf-oleidl-idropsource-givefeedback) method.</span></span> <span data-ttu-id="3be84-317">Se necessario, l'origine può modificare l'aspetto del cursore in base al valore di **DropEffect** .</span><span class="sxs-lookup"><span data-stu-id="3be84-317">If appropriate, the source can modify the appearance of the cursor based on the **DROPEFFECT** value.</span></span> <span data-ttu-id="3be84-318">Per ulteriori informazioni, vedere i riferimenti **GiveFeedback** e [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) .</span><span class="sxs-lookup"><span data-stu-id="3be84-318">For further details, see the **GiveFeedback** and [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) references.</span></span>

### <a name="querycontinuedrag-method"></a><span data-ttu-id="3be84-319">QueryContinueDrag (metodo)</span><span class="sxs-lookup"><span data-stu-id="3be84-319">QueryContinueDrag method</span></span>

<span data-ttu-id="3be84-320">Questo metodo viene chiamato se il pulsante del mouse o lo stato della tastiera cambia mentre l'oggetto dati si trova nel ciclo di trascinamento.</span><span class="sxs-lookup"><span data-stu-id="3be84-320">This method is called if the mouse button or keyboard state changes while the data object is in the drag loop.</span></span> <span data-ttu-id="3be84-321">Invia una notifica all'origine se è stato premuto il tasto ESC e fornisce lo stato corrente dei tasti di modifica della tastiera, ad esempio CTRL o MAIUSC.</span><span class="sxs-lookup"><span data-stu-id="3be84-321">It notifies the source whether the ESC key has been pressed and provides the current state of the keyboard modifier keys, such as CTRL or SHIFT.</span></span> <span data-ttu-id="3be84-322">Il valore restituito del metodo [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) specifica una delle tre azioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="3be84-322">The [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) method's return value specifies one of three actions:</span></span>

-   <span data-ttu-id="3be84-323">S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="3be84-323">S\_OK.</span></span> <span data-ttu-id="3be84-324">Continua l'operazione di trascinamento</span><span class="sxs-lookup"><span data-stu-id="3be84-324">Continue the drag operation</span></span>
-   <span data-ttu-id="3be84-325">eliminazione del DRAGDROP \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="3be84-325">DRAGDROP\_S\_DROP.</span></span> <span data-ttu-id="3be84-326">Eliminare i dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-326">Drop the data.</span></span> <span data-ttu-id="3be84-327">Il sistema chiama quindi il metodo [**IDropTarget::D por**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) della destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-327">The system then calls the target's [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method.</span></span>
-   <span data-ttu-id="3be84-328">DRAGDROP \_ S \_ Annulla.</span><span class="sxs-lookup"><span data-stu-id="3be84-328">DRAGDROP\_S\_CANCEL.</span></span> <span data-ttu-id="3be84-329">Terminare il ciclo di trascinamento senza eliminare i dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-329">Terminate the drag loop without dropping the data.</span></span> <span data-ttu-id="3be84-330">Questo valore viene in genere restituito se è stato premuto il tasto di ESCAPE.</span><span class="sxs-lookup"><span data-stu-id="3be84-330">This value is normally returned if the ESCAPE key was pressed.</span></span>

<span data-ttu-id="3be84-331">Per ulteriori informazioni, vedere i riferimenti [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) e [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) .</span><span class="sxs-lookup"><span data-stu-id="3be84-331">For further discussion, see the [**QueryContinueDrag**](/windows/win32/api/oleidl/nf-oleidl-idropsource-querycontinuedrag) and [**DoDragDrop**](/windows/win32/api/ole2/nf-ole2-dodragdrop) references.</span></span>

## <a name="how-a-target-handles-a-data-object"></a><span data-ttu-id="3be84-332">Gestione di un oggetto dati in una destinazione</span><span class="sxs-lookup"><span data-stu-id="3be84-332">How a Target Handles a Data Object</span></span>

<span data-ttu-id="3be84-333">La destinazione riceve un oggetto dati quando recupera l'oggetto dati dagli Appunti o è stato rilasciato dalla finestra di destinazione dall'utente.</span><span class="sxs-lookup"><span data-stu-id="3be84-333">The target receives a data object when it either retrieves the data object from the Clipboard or has it dropped on the target window by the user.</span></span> <span data-ttu-id="3be84-334">La destinazione può quindi estrarre i dati dall'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-334">The target can then extract data from the data object.</span></span> <span data-ttu-id="3be84-335">Se necessario, la destinazione può inoltre notificare all'oggetto dati il risultato dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-335">If necessary, the target can also notify the data object of the outcome of the operation.</span></span> <span data-ttu-id="3be84-336">Prima del trasferimento dei dati di una shell, un obiettivo di rilascio deve prepararsi per l'operazione:</span><span class="sxs-lookup"><span data-stu-id="3be84-336">Prior to a Shell data transfer, a drop target must prepare itself for the operation:</span></span>

1.  <span data-ttu-id="3be84-337">La destinazione deve chiamare [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) per ottenere un valore di formato degli Appunti valido per tutti i formati della shell, diversi da [CF \_ HDROP](clipboard.md), che potrebbero essere inclusi nell'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-337">The target must call [RegisterClipboardFormat](/windows/win32/api/winuser/nf-winuser-registerclipboardformata) to obtain a valid clipboard format value for all Shell formats, other than [CF\_HDROP](clipboard.md), that might be included in the data object.</span></span> <span data-ttu-id="3be84-338">CF \_ HDROP è già un formato degli Appunti valido e non deve essere registrato.</span><span class="sxs-lookup"><span data-stu-id="3be84-338">CF\_HDROP is already a valid clipboard format and does not need to be registered.</span></span>
2.  <span data-ttu-id="3be84-339">Per supportare un'operazione di trascinamento della selezione, la destinazione deve implementare un'interfaccia [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) e registrare una finestra di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-339">To support a drag-and-drop operation, the target must implement an [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface and register a target window.</span></span> <span data-ttu-id="3be84-340">Per registrare una finestra di destinazione, la destinazione chiama [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) e passa l'handle della finestra e il puntatore all'interfaccia **IDropTarget** .</span><span class="sxs-lookup"><span data-stu-id="3be84-340">To register a target window, the target calls [**RegisterDragDrop**](/windows/win32/api/ole2/nf-ole2-registerdragdrop) and passes in the window's handle and the **IDropTarget** interface pointer.</span></span>

<span data-ttu-id="3be84-341">Per i trasferimenti degli Appunti, la destinazione non riceve alcuna notifica che un oggetto dati è stato inserito negli Appunti.</span><span class="sxs-lookup"><span data-stu-id="3be84-341">For clipboard transfers, the target does not receive any notification that a data object has been placed on the Clipboard.</span></span> <span data-ttu-id="3be84-342">In genere, a un'applicazione viene notificato che un oggetto si trova negli Appunti da un'azione dell'utente, ad esempio facendo clic sul pulsante Incolla sulla barra degli strumenti dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-342">Typically, an application is notified that an object is on the Clipboard by a user action, such as clicking the Paste button on the application's toolbar.</span></span> <span data-ttu-id="3be84-343">La destinazione recupera quindi il puntatore [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) dell'oggetto dati dagli Appunti chiamando [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span><span class="sxs-lookup"><span data-stu-id="3be84-343">The target then retrieves the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pointer from the Clipboard by calling [**OleGetClipboard**](/windows/win32/api/ole2/nf-ole2-olegetclipboard).</span></span> <span data-ttu-id="3be84-344">Per i trasferimenti di dati con trascinamento della selezione, il sistema utilizza l'interfaccia [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) della destinazione per fornire alla destinazione informazioni sullo stato di avanzamento del trasferimento dei dati:</span><span class="sxs-lookup"><span data-stu-id="3be84-344">For drag-and-drop data transfers, the system uses the target's [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface to provide the target with information about the progress of the data transfer:</span></span>

-   <span data-ttu-id="3be84-345">Il sistema chiama [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) quando il cursore entra nella finestra di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-345">The system calls [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) when the cursor enters the target window.</span></span>
-   <span data-ttu-id="3be84-346">Il sistema chiama periodicamente [**IDropTarget::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) quando il cursore passa sulla finestra di destinazione, per assegnare alla destinazione la posizione corrente del cursore.</span><span class="sxs-lookup"><span data-stu-id="3be84-346">The system periodically calls [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) as the cursor passes over the target window, to give the target the current cursor position.</span></span>
-   <span data-ttu-id="3be84-347">Il sistema chiama [**IDropTarget::D ragleave**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave) quando il cursore esce dalla finestra di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-347">The system calls [**IDropTarget::DragLeave**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragleave) when the cursor leaves the target window.</span></span>
-   <span data-ttu-id="3be84-348">Il sistema chiama [**IDropTarget::D por**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) quando l'utente rilascia l'oggetto dati nella finestra di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-348">The system calls [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) when the user drops the data object on the target window.</span></span>

<span data-ttu-id="3be84-349">Per informazioni su come implementare questi metodi, vedere [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget).</span><span class="sxs-lookup"><span data-stu-id="3be84-349">For a discussion of how to implement these methods, see [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget).</span></span>

<span data-ttu-id="3be84-350">Quando i dati vengono eliminati, [**IDropTarget::D por**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) fornisce la destinazione con un puntatore all'interfaccia [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) dell'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-350">When the data is dropped, [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) provides the target with a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="3be84-351">La destinazione USA quindi questa interfaccia per estrarre i dati dall'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-351">The target then uses this interface to extract data from the data object.</span></span>

### <a name="extracting-shell-data-from-a-data-object"></a><span data-ttu-id="3be84-352">Estrazione dei dati della shell da un oggetto dati</span><span class="sxs-lookup"><span data-stu-id="3be84-352">Extracting Shell Data from a Data Object</span></span>

<span data-ttu-id="3be84-353">Una volta che un oggetto dati è stato eliminato o recuperato dagli Appunti, la destinazione può estrarre i dati necessari.</span><span class="sxs-lookup"><span data-stu-id="3be84-353">Once a data object has been dropped or retrieved from the Clipboard, the target can extract the data it needs.</span></span> <span data-ttu-id="3be84-354">Il primo passaggio del processo di estrazione consiste in genere nell'enumerare i formati contenuti nell'oggetto dati:</span><span class="sxs-lookup"><span data-stu-id="3be84-354">The first step in the extraction process is typically to enumerate the formats contained by the data object:</span></span>

-   <span data-ttu-id="3be84-355">Chiamare [**IDataObject:: EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc).</span><span class="sxs-lookup"><span data-stu-id="3be84-355">Call [**IDataObject::EnumFormatEtc**](/windows/win32/api/objidl/nf-objidl-idataobject-enumformatetc).</span></span> <span data-ttu-id="3be84-356">L'oggetto dati crea un oggetto enumerazione OLE standard e restituisce un puntatore alla relativa interfaccia [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) .</span><span class="sxs-lookup"><span data-stu-id="3be84-356">The data object creates a standard OLE enumeration object and returns a pointer to its [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) interface.</span></span>
-   <span data-ttu-id="3be84-357">Usare i metodi [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) per enumerare i formati contenuti nell'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-357">Use the [**IEnumFORMATETC**](/windows/win32/api/objidl/nn-objidl-ienumformatetc) methods to enumerate the formats contained by the data object.</span></span> <span data-ttu-id="3be84-358">Questa operazione in genere recupera una struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) per ogni formato contenuto nell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="3be84-358">This operation usually retrieves one [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure for each format that the object contains.</span></span> <span data-ttu-id="3be84-359">Tuttavia, l'oggetto di enumerazione restituisce in genere solo una singola struttura **FORMATETC** per il formato [ \_ fileContents CFSTR](clipboard.md) , indipendentemente dal numero di tali formati contenuti nell'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-359">However, the enumeration object normally returns only a single **FORMATETC** structure for the [CFSTR\_FILECONTENTS](clipboard.md) format, regardless of how many such formats are contained by the data object.</span></span>
-   <span data-ttu-id="3be84-360">Selezionare uno o più formati da estrarre e archiviare le relative strutture [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) .</span><span class="sxs-lookup"><span data-stu-id="3be84-360">Select one or more formats to be extracted, and store their [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structures.</span></span>

<span data-ttu-id="3be84-361">Per recuperare un particolare formato, passare la struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) associata a [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata).</span><span class="sxs-lookup"><span data-stu-id="3be84-361">To retrieve a particular format, pass the associated [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata).</span></span> <span data-ttu-id="3be84-362">Questo metodo restituisce una struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) che fornisce l'accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-362">This method returns an [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure that provides access to the data.</span></span> <span data-ttu-id="3be84-363">Per specificare un meccanismo di trasferimento dati specifico, impostare il valore **TYMED** della struttura **FORMATETC** sul valore TYMED \_ *xxx* corrispondente.</span><span class="sxs-lookup"><span data-stu-id="3be84-363">To specify a particular data transfer mechanism, set the **tymed** value of the **FORMATETC** structure to the corresponding TYMED\_*XXX* value.</span></span> <span data-ttu-id="3be84-364">Per chiedere all'oggetto dati di selezionare un meccanismo di trasferimento dei dati, la destinazione imposta i \_ valori *xxx* TYMED per ogni meccanismo di trasferimento dei dati che può essere gestito dalla destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-364">To ask the data object to select a data transfer mechanism, the target sets the TYMED\_*XXX* values for every data transfer mechanism that the target can handle.</span></span> <span data-ttu-id="3be84-365">L'oggetto dati seleziona uno di questi meccanismi di trasferimento dei dati e restituisce la struttura **STGMEDIUM** appropriata.</span><span class="sxs-lookup"><span data-stu-id="3be84-365">The data object selects one of these data transfer mechanisms and returns the appropriate **STGMEDIUM** structure.</span></span>

<span data-ttu-id="3be84-366">Per la maggior parte dei formati, la destinazione può recuperare i dati passando la struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) ricevuta durante l'enumerazione dei formati disponibili.</span><span class="sxs-lookup"><span data-stu-id="3be84-366">For most formats, the target can retrieve the data by passing the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure that it received when it enumerated the available formats.</span></span> <span data-ttu-id="3be84-367">Un'eccezione a questa regola è [CFSTR \_ fileContents](clipboard.md).</span><span class="sxs-lookup"><span data-stu-id="3be84-367">One exception to this rule is [CFSTR\_FILECONTENTS](clipboard.md).</span></span> <span data-ttu-id="3be84-368">Poiché un oggetto dati può contenere più istanze di questo formato, la struttura **FORMATETC** restituita dall'enumeratore potrebbe non corrispondere al formato specifico che si desidera estrarre.</span><span class="sxs-lookup"><span data-stu-id="3be84-368">Because a data object can contain multiple instances of this format, the **FORMATETC** structure returned by the enumerator might not correspond to the particular format you want to extract.</span></span> <span data-ttu-id="3be84-369">Oltre a specificare i membri **cfFormat** e **TYMED** , è necessario impostare anche il membro **lIndex** sul valore di indice del file.</span><span class="sxs-lookup"><span data-stu-id="3be84-369">In addition to specifying the **cfFormat** and **tymed** members, you must also set the **lIndex** member to the file's index value.</span></span> <span data-ttu-id="3be84-370">Per ulteriori informazioni, vedere la sezione *utilizzo del \_ formato fileContents CFSTR per estrarre i dati da un file* di [gestione della shell trasferimento dati scenari](datascenarios.md)</span><span class="sxs-lookup"><span data-stu-id="3be84-370">For further discussion, see the *Using the CFSTR\_FILECONTENTS Format to Extract Data from a File* section of [Handling Shell Data Transfer Scenarios](datascenarios.md)</span></span>

<span data-ttu-id="3be84-371">Il processo di estrazione dei dati dipende dal tipo di puntatore contenuto dalla struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) restituita.</span><span class="sxs-lookup"><span data-stu-id="3be84-371">The data extraction process depends on the type of pointer contained by the returned [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span> <span data-ttu-id="3be84-372">Se la struttura contiene un puntatore a un'interfaccia [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) o [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) , utilizzare i metodi di interfaccia per estrarre i dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-372">If the structure contains a pointer to an [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) or [**IStorage**](/windows/win32/api/objidl/nn-objidl-istorage) interface, use the interface methods to extract the data.</span></span> <span data-ttu-id="3be84-373">Il processo di estrazione dei dati da un oggetto di memoria globale viene illustrato nella sezione successiva.</span><span class="sxs-lookup"><span data-stu-id="3be84-373">The process of extracting data from a global memory object is discussed in the next section.</span></span>

### <a name="extracting-a-global-memory-object-from-a-data-object"></a><span data-ttu-id="3be84-374">Estrazione di un oggetto memoria globale da un oggetto dati</span><span class="sxs-lookup"><span data-stu-id="3be84-374">Extracting a global memory object from a data object</span></span>

<span data-ttu-id="3be84-375">Molti formati di dati della shell sono sotto forma di oggetto memoria globale.</span><span class="sxs-lookup"><span data-stu-id="3be84-375">Many of the Shell data formats are in the form of a global memory object.</span></span> <span data-ttu-id="3be84-376">Utilizzare la seguente procedura per estrarre un formato contenente un oggetto memoria globale da un oggetto dati e assegnare i relativi dati a una variabile locale:</span><span class="sxs-lookup"><span data-stu-id="3be84-376">Use the following procedure to extract a format containing a global memory object from a data object and assign its data to a local variable:</span></span>

1.  <span data-ttu-id="3be84-377">Creare una struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) .</span><span class="sxs-lookup"><span data-stu-id="3be84-377">Create a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure.</span></span> <span data-ttu-id="3be84-378">Impostare il membro **cfFormat** sul valore del formato degli Appunti appropriato e il membro **TYMED** su TYMED \_ HGLOBAL.</span><span class="sxs-lookup"><span data-stu-id="3be84-378">Set the **cfFormat** member to the appropriate clipboard format value and the **tymed** member to TYMED\_HGLOBAL.</span></span>
2.  <span data-ttu-id="3be84-379">Creare una struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) vuota.</span><span class="sxs-lookup"><span data-stu-id="3be84-379">Create an empty [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
3.  <span data-ttu-id="3be84-380">Chiamare [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata)e passare i puntatori alle strutture [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) e [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .</span><span class="sxs-lookup"><span data-stu-id="3be84-380">Call [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata), and pass in pointers to the [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) and [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structures.</span></span>

    <span data-ttu-id="3be84-381">Quando [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) restituisce, la struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) conterrà un puntatore all'oggetto memoria globale che contiene i dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-381">When [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) returns, the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure will contain a pointer to the global memory object that contains the data.</span></span>

4.  <span data-ttu-id="3be84-382">Assegnare i dati a una variabile locale chiamando [**funzione GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) e passando il membro **HGlobal** della struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) .</span><span class="sxs-lookup"><span data-stu-id="3be84-382">Assign the data to a local variable by calling [**GlobalLock**](/windows/win32/api/winbase/nf-winbase-globallock) and passing in the **hGlobal** member of the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure.</span></span>
5.  <span data-ttu-id="3be84-383">Chiamare [**funzione GlobalUnlock**](/windows/win32/api/winbase/nf-winbase-globalunlock) per rilasciare il blocco sull'oggetto memoria globale.</span><span class="sxs-lookup"><span data-stu-id="3be84-383">Call [**GlobalUnlock**](/windows/win32/api/winbase/nf-winbase-globalunlock) to release the lock on the global memory object.</span></span>
6.  <span data-ttu-id="3be84-384">Chiamare [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) per rilasciare l'oggetto memoria globale.</span><span class="sxs-lookup"><span data-stu-id="3be84-384">Call [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) to release the global memory object.</span></span>

> [!Note]  
> <span data-ttu-id="3be84-385">Per rilasciare l'oggetto memoria globale, non [**GlobalFree**](/windows/win32/api/winbase/nf-winbase-globalfree), è necessario utilizzare [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) .</span><span class="sxs-lookup"><span data-stu-id="3be84-385">You must use [**ReleaseStgMedium**](/windows/win32/api/ole2/nf-ole2-releasestgmedium) to release the global memory object, not [**GlobalFree**](/windows/win32/api/winbase/nf-winbase-globalfree).</span></span>

 

<span data-ttu-id="3be84-386">Nell'esempio seguente viene illustrato come estrarre un valore **DWORD** archiviato come oggetto memoria globale da un oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-386">The following example shows how to extract a **DWORD** value stored as a global memory object from a data object.</span></span> <span data-ttu-id="3be84-387">Il parametro **pdtobj** è un puntatore all'interfaccia [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) dell'oggetto dati, **CF** è il formato degli appunti che identifica i dati desiderati e **pdwOut** viene utilizzato per restituire il valore dei dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-387">The **pdtobj** parameter is a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface, **cf** is the clipboard format that identifies the desired data, and **pdwOut** is used to return the data value.</span></span>


```C++
STDAPI DataObj_GetDWORD(IDataObject *pdtobj, UINT cf, DWORD *pdwOut)
{    STGMEDIUM medium;
   FORMATETC fmte = {(CLIPFORMAT) cf, NULL, DVASPECT_CONTENT, -1, 
       TYMED_HGLOBAL};
    HRESULT hres = pdtobj->GetData(&fmte, &medium);
    if (SUCCEEDED(hres))
   {
       DWORD *pdw = (DWORD *)GlobalLock(medium.hGlobal);
       if (pdw)
       {
           *pdwOut = *pdw;
           GlobalUnlock(medium.hGlobal);
       }
       else
       {
           hres = E_UNEXPECTED;
       }
       ReleaseStgMedium(&medium);
   }
   return hres;
}
```



### <a name="implementing-idroptarget"></a><span data-ttu-id="3be84-388">Implementazione di IDropTarget</span><span class="sxs-lookup"><span data-stu-id="3be84-388">Implementing IDropTarget</span></span>

<span data-ttu-id="3be84-389">Il sistema utilizza l'interfaccia [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) per comunicare con la destinazione mentre il cursore è posizionato sulla finestra di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-389">The system uses the [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface to communicate with the target while the cursor is over the target window.</span></span> <span data-ttu-id="3be84-390">Le risposte della destinazione vengono inviate all'origine tramite la relativa interfaccia [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) .</span><span class="sxs-lookup"><span data-stu-id="3be84-390">The target's responses are forwarded to the source through its [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface.</span></span> <span data-ttu-id="3be84-391">A seconda della risposta, l'origine può modificare l'icona che rappresenta i dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-391">Depending on the response, the source can modify the icon that represents the data.</span></span> <span data-ttu-id="3be84-392">Se l'obiettivo di rilascio deve specificare l'icona dei dati, questa operazione può essere eseguita creando un [oggetto helper di trascinamento della selezione](#using-the-drag-and-drop-helper-object).</span><span class="sxs-lookup"><span data-stu-id="3be84-392">If the drop target needs to specify the data icon, it can do so by creating a [drag-and-drop helper object](#using-the-drag-and-drop-helper-object).</span></span>

<span data-ttu-id="3be84-393">Con le operazioni di trascinamento della selezione convenzionali, la destinazione informa l'oggetto dati del risultato dell'operazione impostando il parametro *pdwEffect* di [**IDropTarget::D por**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) sul valore [**DropEffect**](../com/dropeffect-constants.md) appropriato.</span><span class="sxs-lookup"><span data-stu-id="3be84-393">With conventional drag-and-drop operations, the target informs the data object of the outcome of the operation by setting the *pdwEffect* parameter of [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) to the appropriate [**DROPEFFECT**](../com/dropeffect-constants.md) value.</span></span> <span data-ttu-id="3be84-394">Con gli oggetti dati della shell, potrebbe anche essere necessario che la destinazione chiami [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span><span class="sxs-lookup"><span data-stu-id="3be84-394">With Shell data objects, the target might also need to call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata).</span></span> <span data-ttu-id="3be84-395">Per informazioni sul modo in cui le destinazioni devono rispondere per diversi scenari di trasferimento dei dati, vedere [gestione di scenari di trasferimento dati Shell](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="3be84-395">For a discussion of how targets should respond for different data transfer scenarios, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

<span data-ttu-id="3be84-396">Le sezioni seguenti illustrano brevemente come implementare i metodi [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), [**IDropTarget::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover)e [**IDropTarget::D por**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) .</span><span class="sxs-lookup"><span data-stu-id="3be84-396">The following sections briefly discuss how to implement the [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover), and [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) methods.</span></span> <span data-ttu-id="3be84-397">Per ulteriori informazioni, vedere la documentazione di riferimento.</span><span class="sxs-lookup"><span data-stu-id="3be84-397">For further details, see the reference documentation.</span></span>

### <a name="dragenter-method"></a><span data-ttu-id="3be84-398">DragEnter (metodo)</span><span class="sxs-lookup"><span data-stu-id="3be84-398">DragEnter method</span></span>

<span data-ttu-id="3be84-399">Il sistema chiama il metodo [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) quando il cursore entra nella finestra di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-399">The system calls the [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) method when the cursor enters the target window.</span></span> <span data-ttu-id="3be84-400">I relativi parametri forniscono la destinazione con la posizione del cursore, lo stato dei tasti di modifica della tastiera, ad esempio il tasto CTRL, e un puntatore all'interfaccia [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) dell'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-400">Its parameters provide the target with the location of the cursor, the state of keyboard modifier keys such as the CTRL key, and a pointer to the data object's [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="3be84-401">La destinazione è responsabile dell'utilizzo di tale interfaccia per determinare se può accettare qualsiasi formato contenuto nell'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-401">The target is responsible for using that interface to determine whether it can accept any of the formats contained by the data object.</span></span> <span data-ttu-id="3be84-402">Se possibile, in genere il valore di *pdwEffect* rimane invariato.</span><span class="sxs-lookup"><span data-stu-id="3be84-402">If it can, it normally leaves the value of *pdwEffect* unchanged.</span></span> <span data-ttu-id="3be84-403">Se non è in grado di accettare dati dall'oggetto dati, imposta il parametro *pdwEffect* su DropEffect \_ None.</span><span class="sxs-lookup"><span data-stu-id="3be84-403">If it cannot accept any data from the data object, it sets the *pdwEffect* parameter to DROPEFFECT\_NONE.</span></span> <span data-ttu-id="3be84-404">Il sistema passa il valore di questo parametro all'interfaccia [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) dell'oggetto dati per consentire la visualizzazione dell'immagine di trascinamento appropriata.</span><span class="sxs-lookup"><span data-stu-id="3be84-404">The system passes the value of this parameter to the data object's [**IDropSource**](/windows/win32/api/oleidl/nn-oleidl-idropsource) interface to allow it to display the appropriate drag image.</span></span>

<span data-ttu-id="3be84-405">Le destinazioni non devono usare il metodo [**IDataObject:: GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) per eseguire il rendering dei dati della shell prima che vengano eliminati.</span><span class="sxs-lookup"><span data-stu-id="3be84-405">Targets should not use the [**IDataObject::GetData**](/windows/win32/api/objidl/nf-objidl-idataobject-getdata) method to render Shell data before it has been dropped.</span></span> <span data-ttu-id="3be84-406">Il rendering completo dei dati dell'oggetto per ogni occorrenza può provocare il blocco del cursore di trascinamento.</span><span class="sxs-lookup"><span data-stu-id="3be84-406">Fully rendering the object's data for each such occurrence might cause the drag cursor to stall.</span></span> <span data-ttu-id="3be84-407">Per evitare questo problema, alcuni oggetti della shell contengono un formato [CFSTR \_ INDRAGLOOP](clipboard.md) .</span><span class="sxs-lookup"><span data-stu-id="3be84-407">To avoid this problem, some Shell objects contain a [CFSTR\_INDRAGLOOP](clipboard.md) format.</span></span> <span data-ttu-id="3be84-408">Estraendo questo formato, le destinazioni possono controllare lo stato del ciclo di trascinamento evitando il rendering intensivo della memoria dei dati dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="3be84-408">By extracting this format, targets can check the status of the drag loop while avoiding memory intensive rendering of the object's data.</span></span> <span data-ttu-id="3be84-409">Il valore dei dati del formato è un valore **DWORD** impostato su un valore diverso da zero se l'oggetto dati si trova all'interno di un ciclo di trascinamento.</span><span class="sxs-lookup"><span data-stu-id="3be84-409">The format's data value is a **DWORD** that is set to a nonzero value if the data object is within a drag loop.</span></span> <span data-ttu-id="3be84-410">Il valore dei dati del formato è impostato su zero se i dati sono stati eliminati.</span><span class="sxs-lookup"><span data-stu-id="3be84-410">The format's data value is set to zero if the data has been dropped.</span></span>

<span data-ttu-id="3be84-411">Se la destinazione può accettare i dati dall'oggetto dati, deve esaminare **grfKeyState** per determinare se sono stati premuti i tasti di modifica per modificare il normale comportamento di rilascio.</span><span class="sxs-lookup"><span data-stu-id="3be84-411">If the target can accept data from the data object, it should examine **grfKeyState** to determine whether any modifier keys have been pressed to modify the normal drop behavior.</span></span> <span data-ttu-id="3be84-412">Ad esempio, l'operazione predefinita è in genere uno spostamento, ma la pressione del tasto CTRL indica in genere un'operazione di copia.</span><span class="sxs-lookup"><span data-stu-id="3be84-412">For instance, the default operation is typically a move, but depressing the CTRL key usually indicates a copy operation.</span></span>

<span data-ttu-id="3be84-413">Quando il cursore si trova sulla finestra di destinazione, la destinazione può usare l'oggetto di supporto per il [trascinamento della selezione](#using-the-drag-and-drop-helper-object) per sostituire l'immagine di trascinamento dell'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-413">While the cursor is over the target window, the target can use the [drag-and-drop helper object](#using-the-drag-and-drop-helper-object) to replace the data object's drag image with its own.</span></span> <span data-ttu-id="3be84-414">In tal caso, [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) deve chiamare [**IDropTargetHelper::D ragenter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter) per passare le informazioni contenute nei parametri *DragEnter* all'oggetto helper di trascinamento della selezione.</span><span class="sxs-lookup"><span data-stu-id="3be84-414">If so, [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter) should call [**IDropTargetHelper::DragEnter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter) to pass the information contained in the *DragEnter* parameters to the drag-and-drop helper object.</span></span>

### <a name="dragover-method"></a><span data-ttu-id="3be84-415">DragOver (metodo)</span><span class="sxs-lookup"><span data-stu-id="3be84-415">DragOver method</span></span>

<span data-ttu-id="3be84-416">Quando il cursore si sposta all'interno della finestra di destinazione, il sistema chiama periodicamente il metodo [**IDropTarget::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) .</span><span class="sxs-lookup"><span data-stu-id="3be84-416">As the cursor moves within the target window, the system periodically calls the [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) method.</span></span> <span data-ttu-id="3be84-417">I relativi parametri forniscono la destinazione con la posizione del cursore e lo stato dei tasti di modifica della tastiera, ad esempio il tasto CTRL.</span><span class="sxs-lookup"><span data-stu-id="3be84-417">Its parameters provide the target with the location of the cursor and the state of keyboard modifier keys such as the CTRL key.</span></span> <span data-ttu-id="3be84-418">**IDropTarget::D ragover** ha molte stesse responsabilità di [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter)e le implementazioni sono in genere molto simili.</span><span class="sxs-lookup"><span data-stu-id="3be84-418">**IDropTarget::DragOver** has much the same responsibilities as [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter), and the implementations are usually very similar.</span></span>

<span data-ttu-id="3be84-419">Se la destinazione usa l'oggetto helper con trascinamento della selezione, [**IDropTarget::D ragover**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) deve chiamare [**IDropTargetHelper::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) per inviare le informazioni contenute nei parametri *DragOver* all'oggetto helper di trascinamento della selezione.</span><span class="sxs-lookup"><span data-stu-id="3be84-419">If the target is using the drag-and-drop helper object, [**IDropTarget::DragOver**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragover) should call [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) to forward the information contained in the *DragOver* parameters to the drag-and-drop helper object.</span></span>

### <a name="drop-method"></a><span data-ttu-id="3be84-420">Drop (metodo)</span><span class="sxs-lookup"><span data-stu-id="3be84-420">Drop method</span></span>

<span data-ttu-id="3be84-421">Il sistema chiama il metodo [**IDropTarget::D por**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) per notificare alla destinazione che l'utente ha rilasciato i dati, in genere rilasciando il pulsante del mouse.</span><span class="sxs-lookup"><span data-stu-id="3be84-421">The system calls the [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) method to notify the target that the user has dropped the data, typically by releasing the mouse button.</span></span> <span data-ttu-id="3be84-422">**IDropTarget::D por** presenta gli stessi parametri di [**IDropTarget::D ragenter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter).</span><span class="sxs-lookup"><span data-stu-id="3be84-422">**IDropTarget::Drop** has the same parameters as [**IDropTarget::DragEnter**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-dragenter).</span></span> <span data-ttu-id="3be84-423">La destinazione risponde normalmente estraendo uno o più formati dall'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-423">The target normally responds by extracting one or more formats from the data object.</span></span> <span data-ttu-id="3be84-424">Al termine, la destinazione deve impostare il parametro *pdwEffect* su un valore [**DropEffect**](../com/dropeffect-constants.md) che indica il risultato dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-424">When finished, the target should set the *pdwEffect* parameter to a [**DROPEFFECT**](../com/dropeffect-constants.md) value that indicates the outcome of the operation.</span></span> <span data-ttu-id="3be84-425">Per alcuni tipi di trasferimento dei dati della shell, è necessario che la destinazione chiami anche [**IDataObject:: SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) per passare un formato con informazioni aggiuntive sul risultato dell'operazione all'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-425">For some types of Shell data transfer, the target must also call [**IDataObject::SetData**](/windows/win32/api/objidl/nf-objidl-idataobject-setdata) to pass a format with additional information on the outcome of the operation to the data object.</span></span> <span data-ttu-id="3be84-426">Per una descrizione dettagliata, vedere [gestione degli scenari di trasferimento dati Shell](datascenarios.md).</span><span class="sxs-lookup"><span data-stu-id="3be84-426">For a detailed discussion, see [Handling Shell Data Transfer Scenarios](datascenarios.md).</span></span>

<span data-ttu-id="3be84-427">Se la destinazione usa l'oggetto helper con trascinamento della selezione, [**IDropTarget::D por**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) deve chiamare [**IDropTargetHelper::D por**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop) per inviare le informazioni contenute nei parametri [**IDropTargetHelper::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) all'oggetto helper di trascinamento della selezione.</span><span class="sxs-lookup"><span data-stu-id="3be84-427">If the target is using the drag-and-drop helper object, [**IDropTarget::Drop**](/windows/win32/api/oleidl/nf-oleidl-idroptarget-drop) should call [**IDropTargetHelper::Drop**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop) to forward the information contained in the [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover) parameters to the drag-and-drop helper object.</span></span>

## <a name="using-the-drag-and-drop-helper-object"></a><span data-ttu-id="3be84-428">Uso dell'oggetto helper di trascinamento della selezione</span><span class="sxs-lookup"><span data-stu-id="3be84-428">Using the Drag-and-Drop Helper Object</span></span>

<span data-ttu-id="3be84-429">L'oggetto helper con trascinamento della selezione (CLSID \_ DragDropHelper) viene esportato dalla Shell per consentire alle destinazioni di specificare l'immagine di trascinamento mentre si trova sulla finestra di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-429">The drag-and-drop helper object (CLSID\_DragDropHelper) is exported by the Shell to allow targets to specify the drag image while it is over the target window.</span></span> <span data-ttu-id="3be84-430">Per usare l'oggetto helper di trascinamento della selezione, creare un oggetto server in-process chiamando [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) con un identificatore di classe (CLSID) di CLSID \_ DragDropHelper.</span><span class="sxs-lookup"><span data-stu-id="3be84-430">To use the drag-and-drop helper object, create an in-process server object by calling [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) with a class identifier (CLSID) of CLSID\_DragDropHelper.</span></span> <span data-ttu-id="3be84-431">L'oggetto helper di trascinamento della selezione espone due interfacce che vengono usate nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="3be84-431">The drag-and-drop helper object exposes two interfaces that are used in the following way:</span></span>

-   <span data-ttu-id="3be84-432">L'interfaccia [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) consente all'obiettivo di rilascio di specificare un'icona per rappresentare l'oggetto dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-432">The [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) interface allows the drop target to specify an icon to represent the data object.</span></span>
-   <span data-ttu-id="3be84-433">L'interfaccia [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) consente all'obiettivo di rilascio di informare l'oggetto helper di trascinamento della selezione della posizione del cursore e di mostrare o nascondere l'icona dei dati.</span><span class="sxs-lookup"><span data-stu-id="3be84-433">The [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) interface allows the drop target to inform the drag-and-drop helper object of the cursor location, and to show or hide the data icon.</span></span>

### <a name="using-the-idragsourcehelper-interface"></a><span data-ttu-id="3be84-434">Uso dell'interfaccia IDragSourceHelper</span><span class="sxs-lookup"><span data-stu-id="3be84-434">Using the IDragSourceHelper Interface</span></span>

<span data-ttu-id="3be84-435">L'interfaccia [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) viene esposta dall'oggetto helper di trascinamento della selezione per consentire a una destinazione di rilascio di fornire l'immagine che verrà visualizzata quando il cursore si trova sulla finestra di destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-435">The [**IDragSourceHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idragsourcehelper) interface is exposed by the drag-and-drop helper object to allow a drop target to provide the image that will be displayed while the cursor is over the target window.</span></span> <span data-ttu-id="3be84-436">**IDragSourceHelper** offre due modi alternativi per specificare la bitmap da usare come immagine di trascinamento:</span><span class="sxs-lookup"><span data-stu-id="3be84-436">**IDragSourceHelper** provides two alternative ways to specify the bitmap to be used as a drag image:</span></span>

-   <span data-ttu-id="3be84-437">Drop targets che dispongono di una finestra possono registrare un \_ messaggio della finestra di GETDRAGIMAGE inizializzando l'oggetto helper con trascinamento della selezione con [**IDragSourceHelper:: InitializeFromWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefromwindow).</span><span class="sxs-lookup"><span data-stu-id="3be84-437">Drop targets that have a window can register a DI\_GETDRAGIMAGE window message for it by initializing the drag-and-drop helper object with [**IDragSourceHelper::InitializeFromWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefromwindow).</span></span> <span data-ttu-id="3be84-438">Quando la destinazione riceve un \_ messaggio di GETDRAGIMAGE, il gestore inserisce le informazioni bitmap dell'immagine di trascinamento nella struttura [**SHDRAGIMAGE**](/windows/desktop/api/Shobjidl_core/ns-shobjidl_core-shdragimage) che viene passata come valore *lParam* del messaggio.</span><span class="sxs-lookup"><span data-stu-id="3be84-438">When the target receives a DI\_GETDRAGIMAGE message, the handler puts the drag image bitmap information in the [**SHDRAGIMAGE**](/windows/desktop/api/Shobjidl_core/ns-shobjidl_core-shdragimage) structure that is passed as the message's *lParam* value.</span></span>
-   <span data-ttu-id="3be84-439">Le destinazioni di rilascio senza finestra specificano una bitmap quando inizializzano l'oggetto helper con trascinamento della selezione con [**IDragSourceHelper:: InitializeFromBitmap**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefrombitmap).</span><span class="sxs-lookup"><span data-stu-id="3be84-439">Windowless drop targets specify a bitmap when they initialize the drag-and-drop helper object with [**IDragSourceHelper::InitializeFromBitmap**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idragsourcehelper-initializefrombitmap).</span></span>

### <a name="using-the-idroptargethelper-interface"></a><span data-ttu-id="3be84-440">Uso dell'interfaccia IDropTargetHelper</span><span class="sxs-lookup"><span data-stu-id="3be84-440">Using the IDropTargetHelper Interface</span></span>

<span data-ttu-id="3be84-441">Questa interfaccia consente all'obiettivo di rilascio di inviare una notifica all'oggetto helper con trascinamento della selezione quando il cursore entra o esce dalla destinazione.</span><span class="sxs-lookup"><span data-stu-id="3be84-441">This interface allows the drop target to notify the drag-and-drop helper object when the cursor enters or leaves the target.</span></span> <span data-ttu-id="3be84-442">Quando il cursore si trova sulla finestra di destinazione, [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) consente alla destinazione di assegnare all'oggetto di supporto per il trascinamento della selezione le informazioni ricevute dalla destinazione tramite l'interfaccia [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) .</span><span class="sxs-lookup"><span data-stu-id="3be84-442">While the cursor is over the target window, [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) allows the target to give the drag-and-drop helper object the information that the target receives through its [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) interface.</span></span>

<span data-ttu-id="3be84-443">Quattro dei metodi [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) ,[**IDropTargetHelper::D ragenter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter), [**IDropTargetHelper::D Ragleave**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragleave), [**IDropTargetHelper::D ragover**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover)e [**IDropTargetHelper::D por**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop), sono associati al metodo [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) con lo stesso nome.</span><span class="sxs-lookup"><span data-stu-id="3be84-443">Four of the [**IDropTargetHelper**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-idroptargethelper) methods—[**IDropTargetHelper::DragEnter**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragenter), [**IDropTargetHelper::DragLeave**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragleave), [**IDropTargetHelper::DragOver**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-dragover), and [**IDropTargetHelper::Drop**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-drop)—are associated with the [**IDropTarget**](/windows/win32/api/oleidl/nn-oleidl-idroptarget) method of the same name.</span></span> <span data-ttu-id="3be84-444">Per usare l'oggetto helper di trascinamento della selezione, ognuno dei metodi **IDropTarget** deve chiamare il metodo **IDropTargetHelper** corrispondente per inviare le informazioni all'oggetto helper di trascinamento della selezione.</span><span class="sxs-lookup"><span data-stu-id="3be84-444">To use the drag-and-drop helper object, each of the **IDropTarget** methods should call the corresponding **IDropTargetHelper** method to forward the information to the drag-and-drop helper object.</span></span> <span data-ttu-id="3be84-445">Il quinto metodo **IDropTargetHelper** , [**IDropTargetHelper:: Show**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-show), invia una notifica all'oggetto helper di trascinamento della selezione per mostrare o nascondere l'immagine di trascinamento.</span><span class="sxs-lookup"><span data-stu-id="3be84-445">The fifth **IDropTargetHelper** method, [**IDropTargetHelper::Show**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-idroptargethelper-show), notifies the drag-and-drop helper object to show or hide the drag image.</span></span> <span data-ttu-id="3be84-446">Questo metodo viene utilizzato durante il trascinamento su una finestra di destinazione in modalità video a bassa intensità di colore.</span><span class="sxs-lookup"><span data-stu-id="3be84-446">This method is used when dragging over a target window in a low color-depth video mode.</span></span> <span data-ttu-id="3be84-447">Consente alla destinazione di nascondere l'immagine di trascinamento mentre disegna la finestra.</span><span class="sxs-lookup"><span data-stu-id="3be84-447">It allows the target to hide the drag image while it is painting the window.</span></span>

 

 
