---
description: In questo argomento vengono illustrate le interfacce e i metodi specifici necessari per creare un gestore di anteprime.
ms.assetid: 6c240a63-c184-4b65-9483-794f5de4d695
title: Compilazione di gestori di anteprime
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a309873cf082071d5f426ce0ba6d039107c59665
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104342851"
---
# <a name="building-preview-handlers"></a><span data-ttu-id="2e435-103">Compilazione di gestori di anteprime</span><span class="sxs-lookup"><span data-stu-id="2e435-103">Building Preview Handlers</span></span>

<span data-ttu-id="2e435-104">In questo argomento vengono illustrate le interfacce e i metodi specifici necessari per creare un gestore di anteprime.</span><span class="sxs-lookup"><span data-stu-id="2e435-104">This topic discusses the specific interfaces and methods required to create a preview handler.</span></span>

<span data-ttu-id="2e435-105">Un gestore di anteprime deve implementare le interfacce seguenti:</span><span class="sxs-lookup"><span data-stu-id="2e435-105">A preview handler must implement the following interfaces:</span></span>

-   <span data-ttu-id="2e435-106">[IInitializeWithStream:: Initialize](#iinitializewithstreaminitialize) (scelta consigliata), [**IInitializeWithFile**](/windows/desktop/api/Propsys/nn-propsys-iinitializewithfile)o [**IInitializeWithItem**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-iinitializewithitem)</span><span class="sxs-lookup"><span data-stu-id="2e435-106">[IInitializeWithStream::Initialize](#iinitializewithstreaminitialize) (strongly preferred), [**IInitializeWithFile**](/windows/desktop/api/Propsys/nn-propsys-iinitializewithfile), or [**IInitializeWithItem**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-iinitializewithitem)</span></span>
-   [<span data-ttu-id="2e435-107">IObjectWithSite</span><span class="sxs-lookup"><span data-stu-id="2e435-107">IObjectWithSite</span></span>](#iobjectwithsite)
-   [<span data-ttu-id="2e435-108">IOleWindow</span><span class="sxs-lookup"><span data-stu-id="2e435-108">IOleWindow</span></span>](#iolewindow)
-   [<span data-ttu-id="2e435-109">IPreviewHandler</span><span class="sxs-lookup"><span data-stu-id="2e435-109">IPreviewHandler</span></span>](#ipreviewhandler)

<span data-ttu-id="2e435-110">Se il gestore di anteprime supporta le impostazioni visive fornite dall'host, ad esempio il colore di sfondo e il tipo di carattere, deve implementare anche l'interfaccia seguente:</span><span class="sxs-lookup"><span data-stu-id="2e435-110">If your preview handler supports visual settings provided by the host such as background color and font, it must also implement the following interface:</span></span>

-   [<span data-ttu-id="2e435-111">IPreviewHandlerVisuals</span><span class="sxs-lookup"><span data-stu-id="2e435-111">IPreviewHandlerVisuals</span></span>](#ipreviewhandlervisuals)

<span data-ttu-id="2e435-112">In questo argomento si presuppone che il gestore di anteprime venga inizializzato con un flusso ed è registrato per una particolare estensione di file.</span><span class="sxs-lookup"><span data-stu-id="2e435-112">This topic assumes that the preview handler is initialized with a stream and is registered for a particular file name extension.</span></span>

## <a name="iinitializewithstreaminitialize"></a><span data-ttu-id="2e435-113">IInitializeWithStream:: Initialize</span><span class="sxs-lookup"><span data-stu-id="2e435-113">IInitializeWithStream::Initialize</span></span>

<span data-ttu-id="2e435-114">Archiviare i parametri [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) e Mode per poter leggere i dati dell'elemento quando si è pronti per l'anteprima dell'elemento.</span><span class="sxs-lookup"><span data-stu-id="2e435-114">Store the [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) and mode parameters so that you can read the item's data when you are ready to preview the item.</span></span> <span data-ttu-id="2e435-115">Non caricare i dati in [**Initialize**](/windows/desktop/api/Propsys/nf-propsys-iinitializewithstream-initialize).</span><span class="sxs-lookup"><span data-stu-id="2e435-115">Do not load the data in [**Initialize**](/windows/desktop/api/Propsys/nf-propsys-iinitializewithstream-initialize).</span></span> <span data-ttu-id="2e435-116">Caricare i dati in [**IPreviewHandler::D opreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) appena prima di eseguire il rendering.</span><span class="sxs-lookup"><span data-stu-id="2e435-116">Load the data in [**IPreviewHandler::DoPreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) just before you render.</span></span>

## <a name="iobjectwithsite"></a><span data-ttu-id="2e435-117">IObjectWithSite</span><span class="sxs-lookup"><span data-stu-id="2e435-117">IObjectWithSite</span></span>

-   [<span data-ttu-id="2e435-118">IObjectWithSite:: SESITE</span><span class="sxs-lookup"><span data-stu-id="2e435-118">IObjectWithSite::SetSite</span></span>](#iobjectwithsitesetsite)
-   [<span data-ttu-id="2e435-119">IObjectWithSite:: GetSite</span><span class="sxs-lookup"><span data-stu-id="2e435-119">IObjectWithSite::GetSite</span></span>](#iobjectwithsitegetsite)

### <a name="iobjectwithsitesetsite"></a><span data-ttu-id="2e435-120">IObjectWithSite:: SESITE</span><span class="sxs-lookup"><span data-stu-id="2e435-120">IObjectWithSite::SetSite</span></span>

<span data-ttu-id="2e435-121">Archiviare il puntatore [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) per l'accesso successivo.</span><span class="sxs-lookup"><span data-stu-id="2e435-121">Store the [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer for later access.</span></span>

<span data-ttu-id="2e435-122">Se attualmente si dispone di un riferimento a un oggetto [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) , rilasciarlo.</span><span class="sxs-lookup"><span data-stu-id="2e435-122">If you currently have a reference to an [**IPreviewHandlerFrame**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlerframe) object, release it.</span></span> <span data-ttu-id="2e435-123">Usare il puntatore [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) archiviato per chiamare [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) sul sito per un nuovo riferimento **IPreviewHandlerFrame** .</span><span class="sxs-lookup"><span data-stu-id="2e435-123">Use the stored [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer to call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on the site for a new **IPreviewHandlerFrame** reference.</span></span>

<span data-ttu-id="2e435-124">Se si dispone attualmente di una tabella dei tasti di scelta rapida, eliminarla.</span><span class="sxs-lookup"><span data-stu-id="2e435-124">If you currently have an accelerator table, destroy it.</span></span> <span data-ttu-id="2e435-125">Chiamare [**IPreviewHandlerFrame:: GetWindowContext**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-getwindowcontext) per ottenere una nuova tabella dei tasti di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="2e435-125">Call [**IPreviewHandlerFrame::GetWindowContext**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-getwindowcontext) to get a new accelerator table.</span></span> <span data-ttu-id="2e435-126">Archiviare questa tabella.</span><span class="sxs-lookup"><span data-stu-id="2e435-126">Store this table.</span></span> <span data-ttu-id="2e435-127">Si noti che viene usato solo come un elenco di tasti di scelta rapida supportati dal frame.</span><span class="sxs-lookup"><span data-stu-id="2e435-127">Note that it is used only as a list of accelerator keys that the frame supports.</span></span> <span data-ttu-id="2e435-128">I comandi nelle voci dell'acceleratore vengono ignorati.</span><span class="sxs-lookup"><span data-stu-id="2e435-128">Commands in the accelerator entries are ignored.</span></span>

### <a name="iobjectwithsitegetsite"></a><span data-ttu-id="2e435-129">IObjectWithSite:: GetSite</span><span class="sxs-lookup"><span data-stu-id="2e435-129">IObjectWithSite::GetSite</span></span>

<span data-ttu-id="2e435-130">Restituisce il puntatore del sito, indipendentemente dal tipo.</span><span class="sxs-lookup"><span data-stu-id="2e435-130">Return the site pointer, whatever it is.</span></span>

## <a name="iolewindow"></a><span data-ttu-id="2e435-131">IOleWindow</span><span class="sxs-lookup"><span data-stu-id="2e435-131">IOleWindow</span></span>

-   [<span data-ttu-id="2e435-132">IOleWindow:: ContextSensitiveHelp</span><span class="sxs-lookup"><span data-stu-id="2e435-132">IOleWindow::ContextSensitiveHelp</span></span>](#iolewindowcontextsensitivehelp)
-   [<span data-ttu-id="2e435-133">IOleWindow:: GetWindow</span><span class="sxs-lookup"><span data-stu-id="2e435-133">IOleWindow::GetWindow</span></span>](#iolewindowgetwindow)

### <a name="iolewindowcontextsensitivehelp"></a><span data-ttu-id="2e435-134">IOleWindow:: ContextSensitiveHelp</span><span class="sxs-lookup"><span data-stu-id="2e435-134">IOleWindow::ContextSensitiveHelp</span></span>

<span data-ttu-id="2e435-135">Restituisce E \_ NOTIMPL per questo metodo.</span><span class="sxs-lookup"><span data-stu-id="2e435-135">Return E\_NOTIMPL for this method.</span></span>

### <a name="iolewindowgetwindow"></a><span data-ttu-id="2e435-136">IOleWindow:: GetWindow</span><span class="sxs-lookup"><span data-stu-id="2e435-136">IOleWindow::GetWindow</span></span>

<span data-ttu-id="2e435-137">Se la finestra del gestore di anteprime esiste attualmente, restituire il **HWND** di tale finestra e s \_ OK.</span><span class="sxs-lookup"><span data-stu-id="2e435-137">If the preview handler's window currently exists, return the **HWND** of that window and S\_OK.</span></span> <span data-ttu-id="2e435-138">Se la finestra non esiste, restituire E ha \_ esito negativo.</span><span class="sxs-lookup"><span data-stu-id="2e435-138">If the window does not exist, return E\_FAIL.</span></span>

## <a name="ipreviewhandler"></a><span data-ttu-id="2e435-139">IPreviewHandler</span><span class="sxs-lookup"><span data-stu-id="2e435-139">IPreviewHandler</span></span>

-   [<span data-ttu-id="2e435-140">IPreviewHandler:: finestra</span><span class="sxs-lookup"><span data-stu-id="2e435-140">IPreviewHandler::SetWindow</span></span>](#ipreviewhandlersetwindow)
-   [<span data-ttu-id="2e435-141">IPreviewHandler:: serect</span><span class="sxs-lookup"><span data-stu-id="2e435-141">IPreviewHandler::SetRect</span></span>](#ipreviewhandlersetrect)
-   [<span data-ttu-id="2e435-142">IPreviewHandler::D oPreview</span><span class="sxs-lookup"><span data-stu-id="2e435-142">IPreviewHandler::DoPreview</span></span>](#ipreviewhandlerdopreview)
-   [<span data-ttu-id="2e435-143">IPreviewHandler:: SetFocus</span><span class="sxs-lookup"><span data-stu-id="2e435-143">IPreviewHandler::SetFocus</span></span>](#ipreviewhandlersetfocus)
-   [<span data-ttu-id="2e435-144">IPreviewHandler:: QueryFocus</span><span class="sxs-lookup"><span data-stu-id="2e435-144">IPreviewHandler::QueryFocus</span></span>](#ipreviewhandlerqueryfocus)
-   [<span data-ttu-id="2e435-145">IPreviewHandler:: TranslateAccelerator</span><span class="sxs-lookup"><span data-stu-id="2e435-145">IPreviewHandler::TranslateAccelerator</span></span>](#ipreviewhandlertranslateaccelerator)
-   [<span data-ttu-id="2e435-146">IPreviewHandler:: Unload</span><span class="sxs-lookup"><span data-stu-id="2e435-146">IPreviewHandler::Unload</span></span>](#ipreviewhandlerunload)

### <a name="ipreviewhandlersetwindow"></a><span data-ttu-id="2e435-147">IPreviewHandler:: finestra</span><span class="sxs-lookup"><span data-stu-id="2e435-147">IPreviewHandler::SetWindow</span></span>

<span data-ttu-id="2e435-148">Impostare il parametro *HWND* di questo metodo sull'elemento padre dell'oggetto **HWND** del gestore di anteprime.</span><span class="sxs-lookup"><span data-stu-id="2e435-148">Set the *hwnd* parameter of this method to the parent of your preview handler's **HWND**.</span></span> <span data-ttu-id="2e435-149">Questo metodo può essere chiamato più volte.</span><span class="sxs-lookup"><span data-stu-id="2e435-149">This method can be called multiple times.</span></span> <span data-ttu-id="2e435-150">Ridimensionare l'anteprima in modo che venga eseguito il rendering solo nell'area descritta dal parametro *PRC* .</span><span class="sxs-lookup"><span data-stu-id="2e435-150">Resize your preview so that it renders only in the area described by the *prc* parameter.</span></span>

<span data-ttu-id="2e435-151">Se è in corso il rendering del Visualizzatore anteprima, usare il metodo [**IPreviewHandler:: sefinestra**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow) per modificare l'elemento padre del Visualizzatore anteprima.</span><span class="sxs-lookup"><span data-stu-id="2e435-151">If the previewer is in the process of rendering, use the [**IPreviewHandler::SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow) method to change the parent of the previewer.</span></span> <span data-ttu-id="2e435-152">Modificare anche l'area in cui viene eseguito il rendering del Visualizzatore anteprima.</span><span class="sxs-lookup"><span data-stu-id="2e435-152">Also change the area in which the previewer is rendering.</span></span>

### <a name="ipreviewhandlersetrect"></a><span data-ttu-id="2e435-153">IPreviewHandler:: serect</span><span class="sxs-lookup"><span data-stu-id="2e435-153">IPreviewHandler::SetRect</span></span>

<span data-ttu-id="2e435-154">Ridimensionare l'anteprima in modo che esegua il rendering solo nell'area descritta dalla *Repubblica popolare* di questo metodo.</span><span class="sxs-lookup"><span data-stu-id="2e435-154">Resize your preview so that it only renders in the area described by this method's *prc*.</span></span>

<span data-ttu-id="2e435-155">Se è in corso il rendering del Visualizzatore anteprima, modificare l'area in cui viene eseguito il rendering del Visualizzatore anteprime.</span><span class="sxs-lookup"><span data-stu-id="2e435-155">If the previewer is in the process of rendering, change the area in which your previewer renders.</span></span>

### <a name="ipreviewhandlerdopreview"></a><span data-ttu-id="2e435-156">IPreviewHandler::D oPreview</span><span class="sxs-lookup"><span data-stu-id="2e435-156">IPreviewHandler::DoPreview</span></span>

<span data-ttu-id="2e435-157">Questo è il punto in cui vengono eseguite le operazioni effettive.</span><span class="sxs-lookup"><span data-stu-id="2e435-157">This is where the real work is done.</span></span> <span data-ttu-id="2e435-158">Poiché un'anteprima è dinamica, il contenuto di anteprima deve essere caricato solo quando necessario.</span><span class="sxs-lookup"><span data-stu-id="2e435-158">Since a preview is dynamic, the preview content should only be loaded when it is needed.</span></span> <span data-ttu-id="2e435-159">Non caricare contenuto nell'inizializzazione.</span><span class="sxs-lookup"><span data-stu-id="2e435-159">Do not load content in the initialization.</span></span>

<span data-ttu-id="2e435-160">Se la finestra del gestore di anteprime non esiste, crearla.</span><span class="sxs-lookup"><span data-stu-id="2e435-160">If the preview handler window does not exist, create it.</span></span> <span data-ttu-id="2e435-161">Le finestre del gestore di anteprime devono essere elementi figlio della finestra fornita da [**IPreviewHandler:: sewindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow).</span><span class="sxs-lookup"><span data-stu-id="2e435-161">Your preview handler's windows should be children of the window provided by [**IPreviewHandler::SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow).</span></span> <span data-ttu-id="2e435-162">Devono essere le dimensioni fornite da **IPreviewHandler:: sewindow** e [**IPreviewHandler:: serect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect) (a seconda di quale è stato chiamato più di recente).</span><span class="sxs-lookup"><span data-stu-id="2e435-162">They should be the size provided by **IPreviewHandler::SetWindow** and [**IPreviewHandler::SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect) (whichever was called most recently).</span></span>

<span data-ttu-id="2e435-163">Quando si dispone di una finestra, caricare i dati dall'oggetto [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) con cui è stato inizializzato il gestore di anteprime ed eseguire il rendering dei dati nella finestra del gestore di anteprime.</span><span class="sxs-lookup"><span data-stu-id="2e435-163">Once you have a window, load the data from the [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) that the preview handler was initialized with, and render that data to your preview handler's window.</span></span>

### <a name="ipreviewhandlersetfocus"></a><span data-ttu-id="2e435-164">IPreviewHandler:: SetFocus</span><span class="sxs-lookup"><span data-stu-id="2e435-164">IPreviewHandler::SetFocus</span></span>

<span data-ttu-id="2e435-165">Questo metodo viene chiamato quando lo stato attivo entra nel riquadro di lettura tramite un'azione di tabulazione.</span><span class="sxs-lookup"><span data-stu-id="2e435-165">This method is called when the focus enters the reading pane through a tab action.</span></span> <span data-ttu-id="2e435-166">Poiché può essere immesso come una scheda di avanzamento o una scheda inversa, utilizzare lo stato corrente del tasto MAIUSC per decidere se il primo o l'ultimo punto di tabulazione nel riquadro di lettura deve ricevere lo stato attivo.</span><span class="sxs-lookup"><span data-stu-id="2e435-166">Since it can be entered as a forward tab or reverse tab, use the current state of the SHIFT key to decide whether the first or last tab stop in the reading pane should receive the focus.</span></span>

### <a name="ipreviewhandlerqueryfocus"></a><span data-ttu-id="2e435-167">IPreviewHandler:: QueryFocus</span><span class="sxs-lookup"><span data-stu-id="2e435-167">IPreviewHandler::QueryFocus</span></span>

<span data-ttu-id="2e435-168">Questo metodo deve chiamare la funzione [**GetFocus**](/windows/win32/api/winuser/nf-winuser-getfocus) e restituire il risultato di tale chiamata nel parametro *phwnd* .</span><span class="sxs-lookup"><span data-stu-id="2e435-168">This method should call the [**GetFocus**](/windows/win32/api/winuser/nf-winuser-getfocus) function and return the result of that call in the *phwnd* parameter.</span></span>

### <a name="ipreviewhandlertranslateaccelerator"></a><span data-ttu-id="2e435-169">IPreviewHandler:: TranslateAccelerator</span><span class="sxs-lookup"><span data-stu-id="2e435-169">IPreviewHandler::TranslateAccelerator</span></span>

<span data-ttu-id="2e435-170">Questo metodo viene chiamato dal message pump del processo del gestore di anteprime (indipendentemente dal fatto che sia prevhost.exe o un server locale personalizzato) in risposta alle sequenze di tasti dell'utente.</span><span class="sxs-lookup"><span data-stu-id="2e435-170">This method is called by the message pump of the preview handler's process (whether prevhost.exe or a custom local server) in response to user keystrokes.</span></span> <span data-ttu-id="2e435-171">I gestori di anteprime devono gestire queste sequenze di tasti o inviarle all'host in base all'algoritmo descritto di seguito.</span><span class="sxs-lookup"><span data-stu-id="2e435-171">Preview handlers should handle these keystrokes or forward them to their host according to the algorithm detailed below.</span></span>

<span data-ttu-id="2e435-172">Tuttavia, poiché le anteprime sono di sola lettura, l'input da tastiera deve essere minimo e le ottimizzazioni, ad esempio, non sono necessarie in molti casi.</span><span class="sxs-lookup"><span data-stu-id="2e435-172">However, because previews are read-only, keyboard input should be minimal and optimizations such as this are not needed in many cases.</span></span>

<span data-ttu-id="2e435-173">Se il tasto di scelta rapida passato a questo metodo tramite message pump è un tasto di scelta rapida accettato dal gestore di anteprime, elaborarlo e restituire S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="2e435-173">If the keyboard accelerator passed to this method through the message pump is an accelerator that your preview handler accepts, then process it and return S\_OK.</span></span> <span data-ttu-id="2e435-174">Se il gestore non accetta tale acceleratore, il messaggio Accelerator può essere restituito fino al frame da gestire.</span><span class="sxs-lookup"><span data-stu-id="2e435-174">If your handler does not accept that accelerator, the accelerator message can be sent back as far as the frame to be handled.</span></span>

<span data-ttu-id="2e435-175">Sono disponibili due opzioni per l'invio di tasti di scelta rapida al frame:</span><span class="sxs-lookup"><span data-stu-id="2e435-175">There are two options for forwarding keyboard accelerators back to the frame:</span></span>

<span data-ttu-id="2e435-176">Il modello più semplice consiste nell'inviare tutte le sequenze di tasti all'host usando [**IPreviewHandlerFrame:: TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-translateaccelerator).</span><span class="sxs-lookup"><span data-stu-id="2e435-176">The simplest model is to forward all keystrokes to the host using [**IPreviewHandlerFrame::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-translateaccelerator).</span></span> <span data-ttu-id="2e435-177">Questa operazione viene eseguita nell'esempio di gestore di anteprime fornito con Windows Software Development Kit (SDK).</span><span class="sxs-lookup"><span data-stu-id="2e435-177">This is done in the preview handler sample provided with the Windows Software Development Kit (SDK).</span></span> <span data-ttu-id="2e435-178">Tutti i gestori di anteprime con integrità basso devono utilizzare questo modello.</span><span class="sxs-lookup"><span data-stu-id="2e435-178">All low-integrity preview handlers must use this model.</span></span> <span data-ttu-id="2e435-179">Se il tasto di scelta rapida non è gestito dal gestore di anteprime, chiamare **IPreviewHandlerFrame:: TranslateAccelerator** e restituire il risultato.</span><span class="sxs-lookup"><span data-stu-id="2e435-179">If the accelerator is not handled by your preview handler, call **IPreviewHandlerFrame::TranslateAccelerator** and return its result.</span></span>

<span data-ttu-id="2e435-180">L'altro modello consiste nell'usare una tabella dei tasti di scelta rapida come ottimizzazione per evitare di inviare troppe sequenze di tasti tra i limiti dei processi:</span><span class="sxs-lookup"><span data-stu-id="2e435-180">The other model is to use an accelerator table as an optimization to avoid sending too many keystrokes across process boundaries:</span></span>

1.  <span data-ttu-id="2e435-181">Quando [**IObjectWithSite:: SESITE**](/windows/win32/api/ocidl/nf-ocidl-iobjectwithsite-setsite) viene chiamato sul gestore di anteprime, acquisire la tabella dei tasti di scelta rapida tramite [**IPreviewHandlerFrame:: GetWindowContext**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-getwindowcontext).</span><span class="sxs-lookup"><span data-stu-id="2e435-181">When [**IObjectWithSite::SetSite**](/windows/win32/api/ocidl/nf-ocidl-iobjectwithsite-setsite) is called on your preview handler, acquire the accelerator table through [**IPreviewHandlerFrame::GetWindowContext**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-getwindowcontext).</span></span> <span data-ttu-id="2e435-182">Assicurarsi di liberare l'handle alla tabella dei tasti di scelta rapida quando il Visualizzatore anteprima viene eliminato definitivamente.</span><span class="sxs-lookup"><span data-stu-id="2e435-182">(Be sure to free the handle to the accelerator table when your previewer is destroyed.)</span></span>
2.  <span data-ttu-id="2e435-183">Se il tasto di scelta rapida è gestito dal gestore di anteprime, gestirlo e restituire S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="2e435-183">If the accelerator is handled by your preview handler, handle it and return S\_OK.</span></span>
3.  <span data-ttu-id="2e435-184">Se il tasto di scelta rapida non è gestito dal gestore di anteprime, confrontarlo con l' [**acceleratore**](/windows/win32/api/ole2/nf-ole2-isaccelerator) nella tabella dei tasti di scelta rapida acquisita.</span><span class="sxs-lookup"><span data-stu-id="2e435-184">If the accelerator is not handled by your preview handler, compare the message using [**IsAccelerator**](/windows/win32/api/ole2/nf-ole2-isaccelerator) against the accelerator table acquired.</span></span>
4.  <span data-ttu-id="2e435-185">Se il tasto di scelta rapida corrisponde a una voce nella tabella dell'acceleratore, chiamare [**IPreviewHandlerFrame:: TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-translateaccelerator) e restituire il risultato.</span><span class="sxs-lookup"><span data-stu-id="2e435-185">If the accelerator matches an entry in that accelerator table, call [**IPreviewHandlerFrame::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandlerframe-translateaccelerator) and return its result.</span></span>
5.  <span data-ttu-id="2e435-186">Se il tasto di scelta rapida non corrisponde ad alcuna voce nella tabella dei tasti di scelta rapida, restituisce \_ false.</span><span class="sxs-lookup"><span data-stu-id="2e435-186">If the accelerator does not match any entry in the accelerator table, return S\_FALSE.</span></span>

### <a name="ipreviewhandlerunload"></a><span data-ttu-id="2e435-187">IPreviewHandler:: Unload</span><span class="sxs-lookup"><span data-stu-id="2e435-187">IPreviewHandler::Unload</span></span>

<span data-ttu-id="2e435-188">Quando viene chiamato questo metodo, Interrompi qualsiasi rendering, rilascia le risorse allocate leggendo i dati dal flusso e rilascia il [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="2e435-188">When this method is called, stop any rendering, release any resources allocated by reading data from the stream, and release the [**IStream**](/windows/win32/api/objidl/nn-objidl-istream) itself.</span></span>

<span data-ttu-id="2e435-189">Quando viene chiamato questo metodo, il gestore deve essere reinizializzato prima di qualsiasi tentativo di chiamare [**IPreviewHandler::D opreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) di nuovo.</span><span class="sxs-lookup"><span data-stu-id="2e435-189">Once this method is called, the handler must be reinitialized before any attempt to call [**IPreviewHandler::DoPreview**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-dopreview) again.</span></span>

## <a name="ipreviewhandlervisuals"></a><span data-ttu-id="2e435-190">IPreviewHandlerVisuals</span><span class="sxs-lookup"><span data-stu-id="2e435-190">IPreviewHandlerVisuals</span></span>

-   [<span data-ttu-id="2e435-191">IPreviewHandlerVisuals::SetBackgroundColor</span><span class="sxs-lookup"><span data-stu-id="2e435-191">IPreviewHandlerVisuals::SetBackgroundColor</span></span>](#ipreviewhandlervisualssetbackgroundcolor)
-   [<span data-ttu-id="2e435-192">IPreviewHandlerVisuals:: sefont</span><span class="sxs-lookup"><span data-stu-id="2e435-192">IPreviewHandlerVisuals::SetFont</span></span>](#ipreviewhandlervisualssetfont)
-   [<span data-ttu-id="2e435-193">IPreviewHandlerVisuals:: SetTextColor</span><span class="sxs-lookup"><span data-stu-id="2e435-193">IPreviewHandlerVisuals::SetTextColor</span></span>](#ipreviewhandlervisualssettextcolor)

<span data-ttu-id="2e435-194">Questi metodi devono essere implementati quando il gestore di anteprime viene indirizzato per rispondere agli schemi di colori e tipi di carattere dell'host.</span><span class="sxs-lookup"><span data-stu-id="2e435-194">These methods should be implemented when directing the preview handler to respond to the host's color and font schemes.</span></span> <span data-ttu-id="2e435-195">L'host esegue una query sul gestore per [**IPreviewHandlerVisuals**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlervisuals).</span><span class="sxs-lookup"><span data-stu-id="2e435-195">The host queries the handler for [**IPreviewHandlerVisuals**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ipreviewhandlervisuals).</span></span> <span data-ttu-id="2e435-196">Se risulta supportato, l'host fornisce il colore, il tipo di carattere e il colore del testo.</span><span class="sxs-lookup"><span data-stu-id="2e435-196">If found to be supported, the host provides it with color, font, and text color.</span></span>

### <a name="ipreviewhandlervisualssetbackgroundcolor"></a><span data-ttu-id="2e435-197">IPreviewHandlerVisuals::SetBackgroundColor</span><span class="sxs-lookup"><span data-stu-id="2e435-197">IPreviewHandlerVisuals::SetBackgroundColor</span></span>

<span data-ttu-id="2e435-198">Archiviare questo colore e usarlo durante il rendering quando si desidera fornire un colore di sfondo.</span><span class="sxs-lookup"><span data-stu-id="2e435-198">Store this color and use it during rendering when you want to provide a background color.</span></span> <span data-ttu-id="2e435-199">Ad esempio, per riempire la finestra quando il gestore viene sottoposto a rendering in un'area più piccola dell'area fornita da [**IPreviewHandler:: sewindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow) e [**IPreviewHandler:: serect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span><span class="sxs-lookup"><span data-stu-id="2e435-199">For instance, to fill the window when the handler renders to an area smaller than the area provided by [**IPreviewHandler::SetWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setwindow) and [**IPreviewHandler::SetRect**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ipreviewhandler-setrect).</span></span> <span data-ttu-id="2e435-200">Si noti, tuttavia, che non è consigliabile creare un oggetto all'esterno dell'area fornita da tali metodi.</span><span class="sxs-lookup"><span data-stu-id="2e435-200">Note, however, that you should not draw outside the area provided by those methods.</span></span>

<span data-ttu-id="2e435-201">Se questo metodo viene chiamato mentre è già in corso il rendering dell'anteprima, il rendering deve essere riavviato utilizzando questo colore di sfondo.</span><span class="sxs-lookup"><span data-stu-id="2e435-201">If this method is called while the preview is already being rendered, the rendering should be restarted using this background color.</span></span>

### <a name="ipreviewhandlervisualssetfont"></a><span data-ttu-id="2e435-202">IPreviewHandlerVisuals:: sefont</span><span class="sxs-lookup"><span data-stu-id="2e435-202">IPreviewHandlerVisuals::SetFont</span></span>

<span data-ttu-id="2e435-203">Archiviare le informazioni sul tipo di carattere e usarle durante il rendering quando si desidera visualizzare il testo coerente con le impostazioni correnti di Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="2e435-203">Store this font information and use it during rendering when you want to display text consistent with the current Windows Vista settings.</span></span>

### <a name="ipreviewhandlervisualssettextcolor"></a><span data-ttu-id="2e435-204">IPreviewHandlerVisuals:: SetTextColor</span><span class="sxs-lookup"><span data-stu-id="2e435-204">IPreviewHandlerVisuals::SetTextColor</span></span>

<span data-ttu-id="2e435-205">Archiviare le informazioni sul colore del testo e utilizzarle durante il rendering quando si desidera visualizzare il testo coerente con le impostazioni correnti di Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="2e435-205">Store this text color information and use it during rendering when you want to display text consistent with the current Windows Vista settings.</span></span>

## <a name="related-topics"></a><span data-ttu-id="2e435-206">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="2e435-206">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2e435-207">Gestori di anteprime e host di anteprima della shell</span><span class="sxs-lookup"><span data-stu-id="2e435-207">Preview Handlers and Shell Preview Host</span></span>](preview-handlers.md)
</dt> <dt>

[<span data-ttu-id="2e435-208">Come registrare un gestore di anteprime</span><span class="sxs-lookup"><span data-stu-id="2e435-208">How to Register a Preview Handler</span></span>](how-to-register-a-preview-handler.md)
</dt> <dt>

[<span data-ttu-id="2e435-209">Linee guida per il gestore di anteprime</span><span class="sxs-lookup"><span data-stu-id="2e435-209">Preview Handler Guidelines</span></span>](preview-handler-guidelines.md)
</dt> </dl>

 

 
