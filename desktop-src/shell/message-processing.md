---
description: La funzione di callback CPlApplet elabora tutti i messaggi inviati a un elemento del pannello di controllo da Windows. I messaggi inviati alla funzione sono in un ordine specifico. Per lo stesso token, l'elemento. cpl richiede che i messaggi vengano elaborati in modo specifico.
ms.assetid: 70302698-f9d5-4de4-a662-4815002eea52
title: Elaborazione del messaggio del pannello di controllo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0b8b43c6e265030279a6644547f41e3630208325
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "103968043"
---
# <a name="control-panel-message-processing"></a><span data-ttu-id="e175a-105">Elaborazione del messaggio del pannello di controllo</span><span class="sxs-lookup"><span data-stu-id="e175a-105">Control Panel Message Processing</span></span>

<span data-ttu-id="e175a-106">La funzione di callback [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) elabora tutti i messaggi inviati a un elemento del pannello di controllo da Windows.</span><span class="sxs-lookup"><span data-stu-id="e175a-106">The [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) callback function processes all messages sent to a Control Panel item by Windows.</span></span> <span data-ttu-id="e175a-107">I messaggi inviati alla funzione sono in un ordine specifico.</span><span class="sxs-lookup"><span data-stu-id="e175a-107">Messages sent to the function are in a specific order.</span></span> <span data-ttu-id="e175a-108">Per lo stesso token, l'elemento. cpl richiede che i messaggi vengano elaborati in modo specifico.</span><span class="sxs-lookup"><span data-stu-id="e175a-108">By the same token, the .cpl item requires the messages to be processed in a specific way.</span></span>

<span data-ttu-id="e175a-109">Prima di tutto, la funzione [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) riceve il \_ messaggio cpl init quando Windows carica l'elemento del pannello di controllo.</span><span class="sxs-lookup"><span data-stu-id="e175a-109">First, the [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function receives the CPL\_INIT message when Windows first loads the Control Panel item.</span></span> <span data-ttu-id="e175a-110">La funzione deve eseguire qualsiasi inizializzazione, ad esempio l'allocazione della memoria e restituire un valore diverso da zero.</span><span class="sxs-lookup"><span data-stu-id="e175a-110">The function should carry out any initialization, such as allocating memory, and return nonzero.</span></span> <span data-ttu-id="e175a-111">Se **CPlApplet** non è in grado di completare l'inizializzazione, deve restituire zero, indirizzando le finestre per terminare la comunicazione e rilasciare la dll.</span><span class="sxs-lookup"><span data-stu-id="e175a-111">If **CPlApplet** cannot complete the initialization, it must return zero, directing Windows to terminate communication and release the DLL.</span></span>

<span data-ttu-id="e175a-112">Successivamente, se il \_ messaggio cpl init ha avuto esito positivo, Windows invierà il \_ messaggio cpl GetCount.</span><span class="sxs-lookup"><span data-stu-id="e175a-112">Next, if the CPL\_INIT message succeeded, Windows sends the CPL\_GETCOUNT message.</span></span> <span data-ttu-id="e175a-113">La funzione deve quindi restituire il numero di elementi del pannello di controllo supportati dal file con estensione dll.</span><span class="sxs-lookup"><span data-stu-id="e175a-113">The function must then return the number of Control Panel items supported by the .dll file.</span></span>

<span data-ttu-id="e175a-114">La funzione [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) riceve quindi un \_ messaggio di richiesta cpl e un messaggio cpl \_ NEWINQUIRE per ogni elemento del pannello di controllo supportato dal file con estensione dll.</span><span class="sxs-lookup"><span data-stu-id="e175a-114">The [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function then receives one CPL\_INQUIRE message and one CPL\_NEWINQUIRE message for each Control Panel item supported by the .dll file.</span></span> <span data-ttu-id="e175a-115">La funzione compila una struttura [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) o [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) con le informazioni sull'elemento, ad esempio il nome, l'icona e una stringa descrittiva.</span><span class="sxs-lookup"><span data-stu-id="e175a-115">The function fills in a [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure with information about your item, such as its name, icon, and a descriptive string.</span></span> <span data-ttu-id="e175a-116">La maggior parte delle applicazioni deve elaborare il \_ messaggio cpl Inquirer e ignorare il \_ messaggio cpl NEWINQUIRE.</span><span class="sxs-lookup"><span data-stu-id="e175a-116">Most applications should process the CPL\_INQUIRE message and ignore the CPL\_NEWINQUIRE message.</span></span> <span data-ttu-id="e175a-117">Il \_ messaggio di richiesta cpl fornisce informazioni in un modulo che può essere memorizzato nella cache di Windows, con un conseguente miglioramento delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="e175a-117">The CPL\_INQUIRE message provides information in a form that Windows can cache, which results in much better performance.</span></span> <span data-ttu-id="e175a-118">Il \_ messaggio cpl NEWINQUIRE viene usato solo se è necessario modificare l'icona dell'elemento o visualizzare le stringhe in base allo stato del computer.</span><span class="sxs-lookup"><span data-stu-id="e175a-118">The CPL\_NEWINQUIRE message is used only if you need to change your item's icon or display strings based on the state of the computer.</span></span> <span data-ttu-id="e175a-119">Gli elementi del pannello di controllo che usano CPL \_ NEWINQUIRE non sono stati trovati da una ricerca del menu **Start** in Windows Vista perché si basa sulla memorizzazione nella cache.</span><span class="sxs-lookup"><span data-stu-id="e175a-119">Control Panel items that use CPL\_NEWINQUIRE cannot be found by a **Start** menu search in Windows Vista because it relies on caching.</span></span>

<span data-ttu-id="e175a-120">La funzione [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) successivamente riceve un \_ messaggio cpl DBLCLK come notifica che l'utente ha scelto l'icona che rappresenta l'elemento del pannello di controllo.</span><span class="sxs-lookup"><span data-stu-id="e175a-120">The [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) function next receives a CPL\_DBLCLK message as a notification that the user has chosen the icon that represents the Control Panel item.</span></span> <span data-ttu-id="e175a-121">La funzione può ricevere questo messaggio un numero qualsiasi di volte.</span><span class="sxs-lookup"><span data-stu-id="e175a-121">The function might receive this message any number of times.</span></span> <span data-ttu-id="e175a-122">Il messaggio include l'identificatore dell'elemento e il puntatore **lpData** restituito nella struttura [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) o [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) nella chiamata a [**cpl \_ Inquirer**](cpl-inquire.md) o [**cpl \_ NEWINQUIRE**](cpl-newinquire.md).</span><span class="sxs-lookup"><span data-stu-id="e175a-122">The message includes the item identifier and the **lpData** pointer returned in the [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure in the call to [**CPL\_INQUIRE**](cpl-inquire.md) or [**CPL\_NEWINQUIRE**](cpl-newinquire.md).</span></span> <span data-ttu-id="e175a-123">La funzione dovrebbe visualizzare la finestra di dialogo corrispondente ed elaborare l'input dell'utente successivo.</span><span class="sxs-lookup"><span data-stu-id="e175a-123">The function should display the corresponding dialog box and process subsequent user input.</span></span>

<span data-ttu-id="e175a-124">Oltre a CPL \_ DblClk, \_ è possibile inviare il messaggio cpl STARTWPARMS se viene richiamato un elemento del pannello di controllo con parametri di input, ad esempio da un prompt dei comandi o da un altro programma.</span><span class="sxs-lookup"><span data-stu-id="e175a-124">Besides CPL\_DBLCLK, the CPL\_STARTWPARMS message can be sent if a Control Panel item is invoked with input parameters, such as from a command prompt or from another program.</span></span> <span data-ttu-id="e175a-125">Il messaggio include l'identificatore dell'elemento insieme alla stringa di parametro aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="e175a-125">The message includes the item identifier along with the additional parameter string.</span></span>

<span data-ttu-id="e175a-126">Prima di terminare l'applicazione di controllo, [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) riceve il \_ messaggio di arresto cpl una volta per ogni elemento del pannello di controllo supportato dal file con estensione dll.</span><span class="sxs-lookup"><span data-stu-id="e175a-126">Before the controlling application terminates, [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) receives the CPL\_STOP message once for each Control Panel item supported by the .dll file.</span></span> <span data-ttu-id="e175a-127">Il messaggio include l'identificatore per l'elemento del pannello di controllo e il puntatore **lpData** restituito nella struttura [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) o [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) nella chiamata a [**cpl \_ Inquirer**](cpl-inquire.md) o [**cpl \_ NEWINQUIRE**](cpl-newinquire.md).</span><span class="sxs-lookup"><span data-stu-id="e175a-127">The message includes the identifier for the Control Panel item and the **lpData** pointer returned in the [**CPLINFO**](/windows/win32/api/cpl/ns-cpl-cplinfo) or [**NEWCPLINFO**](/windows/win32/api/cpl/ns-cpl-newcplinfoa) structure in the call to [**CPL\_INQUIRE**](cpl-inquire.md) or [**CPL\_NEWINQUIRE**](cpl-newinquire.md).</span></span> <span data-ttu-id="e175a-128">La funzione deve liberare la memoria allocata per la finestra di dialogo specificata.</span><span class="sxs-lookup"><span data-stu-id="e175a-128">The function should free any memory that it allocated for the specified dialog box.</span></span>

<span data-ttu-id="e175a-129">Dopo l'ultimo \_ messaggio di arresto cpl, [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) riceve un \_ messaggio di uscita cpl.</span><span class="sxs-lookup"><span data-stu-id="e175a-129">After the last CPL\_STOP message, [**CPlApplet**](/windows/win32/api/cpl/nc-cpl-applet_proc) receives a CPL\_EXIT message.</span></span> <span data-ttu-id="e175a-130">La funzione deve liberare tutta la memoria allocata rimanente e annullare la registrazione di tutte le classi della finestra privata che potrebbero essere state registrate.</span><span class="sxs-lookup"><span data-stu-id="e175a-130">The function should free all remaining allocated memory and unregister any private window classes that it might have registered.</span></span> <span data-ttu-id="e175a-131">Subito dopo la restituzione della funzione da questo messaggio, Windows rilascia l'elemento del pannello di controllo chiamando la funzione [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) .</span><span class="sxs-lookup"><span data-stu-id="e175a-131">Immediately after the function returns from this message, Windows releases the Control Panel item by calling the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function.</span></span>

## <a name="related-topics"></a><span data-ttu-id="e175a-132">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="e175a-132">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="e175a-133">Elementi del pannello di controllo</span><span class="sxs-lookup"><span data-stu-id="e175a-133">Control Panel Items</span></span>](control-panel-applications.md)
</dt> <dt>

[<span data-ttu-id="e175a-134">Linee guida sull'esperienza utente</span><span class="sxs-lookup"><span data-stu-id="e175a-134">User Experience Guidelines</span></span>](user-experience-guidelines.md)
</dt> <dt>

[<span data-ttu-id="e175a-135">Registrazione degli elementi del pannello di controllo</span><span class="sxs-lookup"><span data-stu-id="e175a-135">Registering Control Panel Items</span></span>](registering-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="e175a-136">Uso di CPLApplet</span><span class="sxs-lookup"><span data-stu-id="e175a-136">Using CPLApplet</span></span>](using-cplapplet.md)
</dt> <dt>

[<span data-ttu-id="e175a-137">Esecuzione degli elementi del pannello di controllo</span><span class="sxs-lookup"><span data-stu-id="e175a-137">Executing Control Panel Items</span></span>](executing-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="e175a-138">Estensione degli elementi del pannello di controllo di sistema</span><span class="sxs-lookup"><span data-stu-id="e175a-138">Extending System Control Panel Items</span></span>](extending-system-control-panel-items.md)
</dt> <dt>

[<span data-ttu-id="e175a-139">Assegnazione delle categorie del pannello di controllo</span><span class="sxs-lookup"><span data-stu-id="e175a-139">Assigning Control Panel Categories</span></span>](assigning-control-panel-categories.md)
</dt> <dt>

[<span data-ttu-id="e175a-140">Creazione di collegamenti alle attività ricercabili per un elemento del pannello di controllo</span><span class="sxs-lookup"><span data-stu-id="e175a-140">Creating Searchable Task Links for a Control Panel Item</span></span>](creating-searchable-task-links.md)
</dt> <dt>

[<span data-ttu-id="e175a-141">Accesso al pannello di controllo in modalità provvisoria in Windows Vista</span><span class="sxs-lookup"><span data-stu-id="e175a-141">Accessing the Control Panel in Safe Mode under Windows Vista</span></span>](accessing-the-cp-in-safe-mode-under-vista.md)
</dt> </dl>

 

 
