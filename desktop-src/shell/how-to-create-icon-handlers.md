---
description: Viene descritto come creare un gestore per le assegnazioni di icone personalizzate.
ms.assetid: 23ed3a21-cf62-4440-b983-fae23aa56890
title: Come creare gestori di icone
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e2c620b6f6a4c05f8996a26c8365e4f4201ee0b4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104979599"
---
# <a name="how-to-create-icon-handlers"></a><span data-ttu-id="9c4cc-103">Come creare gestori di icone</span><span class="sxs-lookup"><span data-stu-id="9c4cc-103">How to Create Icon Handlers</span></span>

<span data-ttu-id="9c4cc-104">A un [tipo di file](fa-file-types.md) è spesso associata un'icona personalizzata, per rendere i membri facilmente riconoscibili in Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-104">A [file type](fa-file-types.md) often has a custom icon associated with it, to make its members easily recognizable in Windows Explorer.</span></span> <span data-ttu-id="9c4cc-105">Il modo più semplice per assegnare un'icona personalizzata a un tipo di file consiste nel registrare il file dell'icona.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-105">The simplest way to assign a custom icon to a file type is to register the icon's file.</span></span> <span data-ttu-id="9c4cc-106">Tuttavia, un'icona registrata in questo modo sarà la stessa per tutti i membri del tipo di file.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-106">However, an icon registered in this way will be the same for all members of the file type.</span></span> <span data-ttu-id="9c4cc-107">È possibile disporre di una maggiore flessibilità nell'assegnazione delle icone ai membri del tipo di file mediante l'implementazione di un *gestore di icone*.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-107">You can have much more flexibility in assigning icons to the members of the file type by implementing an *icon handler*.</span></span>

<span data-ttu-id="9c4cc-108">Un gestore di icone è un tipo di gestore di estensione della shell che consente di assegnare dinamicamente icone ai membri di un tipo di file.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-108">An icon handler is a type of Shell extension handler that allows you to dynamically assign icons to the members of a file type.</span></span> <span data-ttu-id="9c4cc-109">Ogni volta che viene visualizzato un file di tipo, la shell esegue una query sul gestore per l'icona appropriata.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-109">Every time a file of the type is displayed, the Shell queries the handler for the appropriate icon.</span></span> <span data-ttu-id="9c4cc-110">Ad esempio, un gestore di icone può assegnare icone diverse a membri diversi del tipo di file o variare l'icona in base allo stato corrente del file.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-110">For instance, an icon handler can assign different icons to different members of the file type, or vary the icon based on the current state of the file.</span></span>

<span data-ttu-id="9c4cc-111">Le procedure generali per l'implementazione e la registrazione di un gestore di estensione della shell sono descritte in [creazione di gestori di estensioni della shell](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="9c4cc-111">The general procedures for implementing and registering a Shell extension handler are discussed in [Creating Shell Extension Handlers](handlers.md).</span></span> <span data-ttu-id="9c4cc-112">Questo documento è incentrato sugli aspetti dell'implementazione specifici dei gestori di icone.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-112">This document focuses on those aspects of implementation that are specific to icon handlers.</span></span>

-   [<span data-ttu-id="9c4cc-113">Implementazione di gestori di icone</span><span class="sxs-lookup"><span data-stu-id="9c4cc-113">Implementing Icon Handlers</span></span>](#step-1-implementing-icon-handlers)
-   [<span data-ttu-id="9c4cc-114">Implementazione dell'interfaccia IExtractIcon</span><span class="sxs-lookup"><span data-stu-id="9c4cc-114">Implementing the IExtractIcon Interface</span></span>](#step-2-implementing-the-iextracticon-interface)
-   [<span data-ttu-id="9c4cc-115">Registrazione di gestori di icone</span><span class="sxs-lookup"><span data-stu-id="9c4cc-115">Registering Icon Handlers</span></span>](#step-3-registering-icon-handlers)
-   [<span data-ttu-id="9c4cc-116">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="9c4cc-116">Related topics</span></span>](#related-topics)

## <a name="instructions"></a><span data-ttu-id="9c4cc-117">Istruzioni</span><span class="sxs-lookup"><span data-stu-id="9c4cc-117">Instructions</span></span>

### <a name="step-1-implementing-icon-handlers"></a><span data-ttu-id="9c4cc-118">Passaggio 1: implementazione di gestori di icone</span><span class="sxs-lookup"><span data-stu-id="9c4cc-118">Step 1: Implementing Icon Handlers</span></span>

<span data-ttu-id="9c4cc-119">Come tutti i gestori di estensioni della shell, i gestori di icone sono oggetti COM (Component Object Model in-process) implementati come dll.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-119">Like all Shell extension handlers, icon handlers are in-process Component Object Model (COM) objects implemented as DLLs.</span></span> <span data-ttu-id="9c4cc-120">Devono esportare due interfacce, oltre a [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) e [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona).</span><span class="sxs-lookup"><span data-stu-id="9c4cc-120">They must export two interfaces in addition to [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown): [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) and [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona).</span></span>

<span data-ttu-id="9c4cc-121">La shell Inizializza il gestore tramite la relativa interfaccia [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) .</span><span class="sxs-lookup"><span data-stu-id="9c4cc-121">The Shell initializes the handler through its [**IPersistFile**](/windows/win32/api/objidl/nn-objidl-ipersistfile) interface.</span></span> <span data-ttu-id="9c4cc-122">Usa questa interfaccia per richiedere l'identificatore di classe del gestore (CLSID) e fornisce il nome del file.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-122">It uses this interface to request the handler's class identifier (CLSID) and provides it with the file's name.</span></span> <span data-ttu-id="9c4cc-123">Il resto dell'operazione viene eseguita tramite l'interfaccia [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) .</span><span class="sxs-lookup"><span data-stu-id="9c4cc-123">The rest of the operation takes place through the [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) interface.</span></span> <span data-ttu-id="9c4cc-124">Per informazioni generali su come implementare i gestori di estensioni della shell, inclusa l'interfaccia **IPersistFile** , vedere [creazione di gestori di estensioni della shell](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="9c4cc-124">For a general discussion of how to implement Shell extension handlers, including the **IPersistFile** interface, see [Creating Shell Extension Handlers](handlers.md).</span></span> <span data-ttu-id="9c4cc-125">Nella parte restante di questo documento viene illustrato come implementare l'interfaccia **IExtractIcon** .</span><span class="sxs-lookup"><span data-stu-id="9c4cc-125">The remainder of this document discusses how to implement the **IExtractIcon** interface.</span></span>

### <a name="step-2-implementing-the-iextracticon-interface"></a><span data-ttu-id="9c4cc-126">Passaggio 2: implementazione dell'interfaccia IExtractIcon</span><span class="sxs-lookup"><span data-stu-id="9c4cc-126">Step 2: Implementing the IExtractIcon Interface</span></span>

<span data-ttu-id="9c4cc-127">Dopo l'inizializzazione dell'interfaccia, la shell usa l'interfaccia [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) del gestore per richiedere l'icona appropriata.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-127">After the interface is initialized, the Shell uses the handler's [**IExtractIcon**](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona) interface to request the appropriate icon.</span></span> <span data-ttu-id="9c4cc-128">L'interfaccia dispone di due metodi: [**IExtractIcon:: GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) e [**IExtractIcon:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span><span class="sxs-lookup"><span data-stu-id="9c4cc-128">The interface has two methods: [**IExtractIcon::GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) and [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span></span>

<span data-ttu-id="9c4cc-129">Le icone vengono identificate in base alla relativa posizione nella file system.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-129">Icons are identified by their location in the file system.</span></span> <span data-ttu-id="9c4cc-130">Per richiedere queste informazioni, viene chiamato il metodo [**IExtractIcon:: GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) .</span><span class="sxs-lookup"><span data-stu-id="9c4cc-130">The [**IExtractIcon::GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation) method is called to request this information.</span></span> <span data-ttu-id="9c4cc-131">Impostare il parametro *szIconFile* sul nome del file.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-131">Set the *szIconFile* parameter to the file name.</span></span> <span data-ttu-id="9c4cc-132">Se nel file è presente più di un'icona, impostare *piIndex* sull'indice dell'icona.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-132">If there is more than one icon in the file, set *piIndex* to the icon's index.</span></span> <span data-ttu-id="9c4cc-133">Assegnare i valori appropriati alle due variabili del flag.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-133">Assign appropriate values to the two flag variables.</span></span> <span data-ttu-id="9c4cc-134">Se non si vuole specificare un nome di file o se non si vuole che la shell estragga l'icona, impostare il flag **Gil \_ NOTFILENAME** nel parametro *pwFlags* .</span><span class="sxs-lookup"><span data-stu-id="9c4cc-134">If you do not want to specify a file name, or if you do not want the Shell to extract the icon, set the **GIL\_NOTFILENAME** flag in the *pwFlags* parameter.</span></span> <span data-ttu-id="9c4cc-135">Non è necessario assegnare un valore a *szIconFile*, ma il gestore deve fornire handle di icona quando la shell chiama [**IExtractIcon:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span><span class="sxs-lookup"><span data-stu-id="9c4cc-135">You do not need to assign a value to *szIconFile*, but the handler must provide icon handles when the Shell calls [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract).</span></span>

<span data-ttu-id="9c4cc-136">Se si restituisce un nome di file, la shell tenta in genere di caricare l'icona dalla relativa cache.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-136">If you return a file name, the Shell normally attempts to load the icon from its cache.</span></span> <span data-ttu-id="9c4cc-137">Per evitare il caricamento di un'icona memorizzata nella cache, impostare il flag **Gil \_ DONTCACHE** nel parametro *pwFlags* .</span><span class="sxs-lookup"><span data-stu-id="9c4cc-137">To prevent the loading of a cached icon, set the **GIL\_DONTCACHE** flag in the *pwFlags* parameter.</span></span> <span data-ttu-id="9c4cc-138">Se non viene caricata un'icona memorizzata nella cache, la shell chiama [**IExtractIcon:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) per richiedere l'handle dell'icona.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-138">If a cached icon is not loaded, the Shell then calls [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) to request the icon handle.</span></span>

<span data-ttu-id="9c4cc-139">Se un file e un indice sono stati specificati da [**IExtractIcon:: GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation), vengono passati rispettivamente a [**IExtractIcon:: Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) nei parametri *pszFile* e *nIconIndex* .</span><span class="sxs-lookup"><span data-stu-id="9c4cc-139">If a file and index were specified by [**IExtractIcon::GetIconLocation**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-geticonlocation), they are passed to [**IExtractIcon::Extract**](/windows/win32/api/shlobj_core/nf-shlobj_core-iextracticona-extract) in the *pszFile* and *nIconIndex* parameters, respectively.</span></span> <span data-ttu-id="9c4cc-140">Se viene fornito un nome di file, il gestore può restituire S \_ false per fare in modo che la shell estragga l'icona.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-140">If a file name is provided, your handler can return S\_FALSE to have the Shell extract the icon.</span></span> <span data-ttu-id="9c4cc-141">In caso contrario, il gestore deve estrarre o produrre icone grandi e piccole, quindi assegnare i rispettivi handle HICON ai parametri *phiconLarge* e *phiconSmall* .</span><span class="sxs-lookup"><span data-stu-id="9c4cc-141">Otherwise, your handler must extract or otherwise produce large and small icons, and assign their HICON handles to the *phiconLarge* and *phiconSmall* parameters.</span></span> <span data-ttu-id="9c4cc-142">La shell aggiunge le icone alla relativa cache per velocizzare le chiamate successive al gestore.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-142">The Shell adds the icons to its cache to expedite subsequent calls to the handler.</span></span>

### <a name="step-3-registering-icon-handlers"></a><span data-ttu-id="9c4cc-143">Passaggio 3: registrazione di gestori di icone</span><span class="sxs-lookup"><span data-stu-id="9c4cc-143">Step 3: Registering Icon Handlers</span></span>

<span data-ttu-id="9c4cc-144">Quando si [registra in modo statico un'icona](icon.md) per un [tipo di file](fa-file-types.md), si crea una sottochiave **DefaultIcon** in ProgID per il tipo di file.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-144">When you [statically register an icon](icon.md) for a [file type](fa-file-types.md), you create a **DefaultIcon** subkey under the ProgID for the file type.</span></span> <span data-ttu-id="9c4cc-145">Il valore predefinito è impostato sul file che contiene l'icona.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-145">Its default value is set to the file that contains the icon.</span></span> <span data-ttu-id="9c4cc-146">Per registrare un gestore di icone, è necessario avere ancora la sottochiave **DefaultIcon** , ma il valore predefinito deve essere impostato su "%1".</span><span class="sxs-lookup"><span data-stu-id="9c4cc-146">To register an icon handler, you must still have the **DefaultIcon** subkey, but its default value must be set to "%1".</span></span> <span data-ttu-id="9c4cc-147">Aggiungere una sottochiave **IconHandler** alla sottochiave **ShellEx** della sottochiave ProgID e impostarne il valore predefinito sul formato stringa del GUID CLSID del gestore.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-147">Add an **IconHandler** subkey to the **Shellex** subkey of the ProgID subkey, and set its default value to the string form of the handler's CLSID GUID.</span></span> <span data-ttu-id="9c4cc-148">Per informazioni generali su come registrare i gestori di estensioni della shell, vedere [creazione di gestori di estensioni della shell](handlers.md).</span><span class="sxs-lookup"><span data-stu-id="9c4cc-148">For a general discussion of how to register Shell extension handlers, see [Creating Shell Extension Handlers](handlers.md).</span></span>

<span data-ttu-id="9c4cc-149">Nell'esempio seguente la voce del registro di sistema viene modificata dalle [Icone di personalizzazione](icon.md) in modo che il tipo di file. MYP ora usi un gestore di menu di scelta rapida anziché un'icona definita in modo statico.</span><span class="sxs-lookup"><span data-stu-id="9c4cc-149">The following example modifies the registry entry from [Customizing Icons](icon.md) so that the .myp file type now uses a shortcut menu handler instead of a statically defined icon.</span></span>

```
HKEY_CLASSES_ROOT
   .myp
      (Default) = MyProgram.1
   MyProgram.1
      (Default) = MyProgram Application
      DefaultIcon
         (Default) = %1
      Shellex
         IconHandler
            (Default) = {The handler's CLSID GUID}
```

## <a name="related-topics"></a><span data-ttu-id="9c4cc-150">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="9c4cc-150">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9c4cc-151">Creazione di gestori di estensione della shell</span><span class="sxs-lookup"><span data-stu-id="9c4cc-151">Creating Shell Extension Handlers</span></span>](handlers.md)
</dt> <dt>

[<span data-ttu-id="9c4cc-152">**IPersistFile**</span><span class="sxs-lookup"><span data-stu-id="9c4cc-152">**IPersistFile**</span></span>](/windows/win32/api/objidl/nn-objidl-ipersistfile)
</dt> <dt>

[<span data-ttu-id="9c4cc-153">**IExtractIcon**</span><span class="sxs-lookup"><span data-stu-id="9c4cc-153">**IExtractIcon**</span></span>](/windows/win32/api/shlobj_core/nn-shlobj_core-iextracticona)
</dt> </dl>

 

 
