---
title: Multipath I/O supporta ora i blocchi delle richieste di archiviazione estesa
description: Multipath I/O supporta ora i blocchi delle richieste di archiviazione estesa
ms.assetid: 5373D9ED-34AF-4D66-8888-49F1EBF768F4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f558f8088b5066b51447c5f2ea23edd5154d5c10
ms.sourcegitcommit: 46376be61d3fa308f9b1a06d7e2fa122a39755af
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/10/2020
ms.locfileid: "104339503"
---
# <a name="multipath-io-now-supports-extended-storage-request-blocks"></a><span data-ttu-id="0af14-103">Multipath I/O supporta ora i blocchi delle richieste di archiviazione estesa</span><span class="sxs-lookup"><span data-stu-id="0af14-103">Multipath I/O now supports extended storage request blocks</span></span>

## <a name="platforms"></a><span data-ttu-id="0af14-104">Piattaforme</span><span class="sxs-lookup"><span data-stu-id="0af14-104">Platforms</span></span>

<span data-ttu-id="0af14-105">**Server** : Windows Server 2012</span><span class="sxs-lookup"><span data-stu-id="0af14-105">**Servers** – Windows Server 2012</span></span> 

## <a name="description"></a><span data-ttu-id="0af14-106">Descrizione</span><span class="sxs-lookup"><span data-stu-id="0af14-106">Description</span></span>

<span data-ttu-id="0af14-107">In Windows Server 2012, una nuova struttura, il blocco di richieste di archiviazione \_ \_ (SRB esteso) sostituisce \_ il \_ blocco di richieste SCSI (SRB legacy) nello stack di archiviazione principale.</span><span class="sxs-lookup"><span data-stu-id="0af14-107">In Windows Server 2012, a new structure, the STORAGE\_REQUEST\_BLOCK (extended SRB) replaces the SCSI\_REQUEST\_BLOCK (legacy SRB) in the core storage stack.</span></span> <span data-ttu-id="0af14-108">SRB estese replicano le funzionalità del SRB legacy, ma sono anche estendibili e scalabili.</span><span class="sxs-lookup"><span data-stu-id="0af14-108">Extended SRBs replicate the functionality of the legacy SRBs, but are also extensible and scalable.</span></span>

<span data-ttu-id="0af14-109">Multipath I/O (MPIO) supporta SRB esteso e consente ai moduli specifici del dispositivo (DSM) di specificare anche il supporto per SRB esteso.</span><span class="sxs-lookup"><span data-stu-id="0af14-109">Multipath I/O (MPIO) supports extended SRBs and allows Device Specific Modules (DSMs) to specify extended SRB support as well.</span></span> <span data-ttu-id="0af14-110">Tuttavia, per fare in modo che lo stack di archiviazione di un dispositivo a percorsi multipli usi SRB estesi, **tutti i componenti nello stack devono supportare SRB estesi, incluso il DSM**.</span><span class="sxs-lookup"><span data-stu-id="0af14-110">However, in order for a multipath device’s storage stack to use extended SRBs, **all components in the stack must support extended SRBs, including the DSM**.</span></span> <span data-ttu-id="0af14-111">Si noti che il DSM interno di Microsoft, MSDSl, supporta il SRB esteso.</span><span class="sxs-lookup"><span data-stu-id="0af14-111">Note that the Microsoft in-box DSM, MSDSM, does support extended SRBs.</span></span>

<span data-ttu-id="0af14-112">La \_ struttura ad albero pass- \_ through SCSI non fa \_ parte della struttura pass-through MPIO estesa perché il pass-through SCSI esteso può avere una dimensione variabile, a seconda del debugger della riga di comando (CDB).</span><span class="sxs-lookup"><span data-stu-id="0af14-112">The SCSI\_PASS\_THROUGH\_EX structure is not part of the extended MPIO pass through structure since the extended SCSI pass through can be of a variable size, depending on the command line debugger (CDB).</span></span> <span data-ttu-id="0af14-113">Al contrario, il pass-through MPIO esteso ha un campo che descrive l'offset dall'inizio della struttura pass-through MPIO estesa alla struttura del pass-through SCSI \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="0af14-113">Instead, the extended MPIO pass through has a field that describes the offset from the beginning of the extended MPIO pass through structure to the SCSI\_PASS\_THROUGH\_EX structure.</span></span> <span data-ttu-id="0af14-114">Il chiamante deve assicurarsi di allocare un buffer di dimensioni appropriate e impostare correttamente l'offset del pass-through SCSI.</span><span class="sxs-lookup"><span data-stu-id="0af14-114">The caller must make sure they allocate a buffer of the appropriate size and set the SCSI pass through offset correctly.</span></span> <span data-ttu-id="0af14-115">Finché il chiamante segue le regole per i pass-through SCSI estesi, non dovrebbe essere necessario alcun lavoro aggiuntivo per poter utilizzare il pass-through MPIO esteso.</span><span class="sxs-lookup"><span data-stu-id="0af14-115">As long as the caller follows the rules for extended SCSI pass-throughs, then there should not be any extra work for them to use the extended MPIO pass through.</span></span>

> [!Note]  
> <span data-ttu-id="0af14-116">Se il DSM non supporta il SRB esteso, MPIO non riuscirà a eseguire le richieste di pass-through MPIO estese che hanno il \_ flag IOCTL MPIO che \_ coinvolgono il \_ \_ flag DSM impostato.</span><span class="sxs-lookup"><span data-stu-id="0af14-116">If the DSM does not support extended SRBs, MPIO will fail extended MPIO pass through requests that have the MPIO\_IOCTL\_FLAG\_INVOLVE\_DSM flag set.</span></span>

 

## <a name="manifestation"></a><span data-ttu-id="0af14-117">Manifestazione</span><span class="sxs-lookup"><span data-stu-id="0af14-117">Manifestation</span></span>

<span data-ttu-id="0af14-118">Se una parte dello stack di archiviazione del dispositivo, incluso DSM, non supporta il SRB esteso, lo stack di archiviazione verrà ripristinato usando SRB legacy.</span><span class="sxs-lookup"><span data-stu-id="0af14-118">If any part of the device’s storage stack, including DSM, does not support extended SRBs, the storage stack will revert to using legacy SRBs.</span></span>

## <a name="solution"></a><span data-ttu-id="0af14-119">Soluzione</span><span class="sxs-lookup"><span data-stu-id="0af14-119">Solution</span></span>

<span data-ttu-id="0af14-120">Esistono solo due requisiti MPIO per un DSM per supportare i blocchi delle richieste di archiviazione \_ \_ :</span><span class="sxs-lookup"><span data-stu-id="0af14-120">There are only two MPIO requirements for a DSM to support STORAGE\_REQUEST\_BLOCKS:</span></span>

-   <span data-ttu-id="0af14-121">Il DSM deve segnalare il tipo come DsmType6</span><span class="sxs-lookup"><span data-stu-id="0af14-121">The DSM must report its type as DsmType6</span></span>
-   <span data-ttu-id="0af14-122">Il DSM deve fornire la \_ \_ \_ funzione supportata per il tipo di indirizzo DSM</span><span class="sxs-lookup"><span data-stu-id="0af14-122">The DSM must provide the DSM\_ADDRESS\_TYPE\_SUPPORTED function</span></span>

<span data-ttu-id="0af14-123">Se il DSM non segnala DsmType6 o restituisce DsmType6 ma non fornisce la \_ funzione supportata per il tipo di indirizzo DSM \_ \_ , MPIO presuppone che il DSM non supporti SRB estesi.</span><span class="sxs-lookup"><span data-stu-id="0af14-123">If the DSM does not report DsmType6 or if it reports DsmType6 but does not provide the DSM\_ADDRESS\_TYPE\_SUPPORTED function, MPIO will assume the DSM does not support extended SRBs.</span></span>

<span data-ttu-id="0af14-124">La \_ \_ funzione supportata per il tipo di indirizzo DSM \_ accetta due parametri, uno dei quali è un tipo di indirizzo.</span><span class="sxs-lookup"><span data-stu-id="0af14-124">The DSM\_ADDRESS\_TYPE\_SUPPORTED function accepts two parameters, one of which is an address type.</span></span> <span data-ttu-id="0af14-125">Questo tipo di indirizzo deve essere uno dei valori del tipo di indirizzo di archiviazione \_ \_ \_ \* definito in SRB. h.</span><span class="sxs-lookup"><span data-stu-id="0af14-125">This address type must be one of the STORAGE\_ADDRESS\_TYPE\_\* values defined in srb.h.</span></span> <span data-ttu-id="0af14-126">Il DSM deve restituire TRUE se supporta il tipo di indirizzo specificato e FALSE in caso contrario.</span><span class="sxs-lookup"><span data-stu-id="0af14-126">The DSM must return TRUE if it supports the given address type and FALSE if it does not.</span></span> <span data-ttu-id="0af14-127">La definizione di "supporto" è alla fine il DSM.</span><span class="sxs-lookup"><span data-stu-id="0af14-127">The definition of “support” is ultimately up to the DSM.</span></span> <span data-ttu-id="0af14-128">MPIO usa questa funzione per garantire che il DSM non si comporti in modo non conforme se viene passata una SRB estesa con una \_ struttura dell'indirizzo stor del tipo specificato.</span><span class="sxs-lookup"><span data-stu-id="0af14-128">MPIO uses this function to ensure that the DSM will not misbehave if it is handed an extended SRB with a STOR\_ADDRESS structure of the given type.</span></span> <span data-ttu-id="0af14-129">Di conseguenza, MPIO chiama in genere questa funzione quando un dispositivo a percorsi multipli viene enumerato, ma la funzione può essere chiamata in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="0af14-129">As such, MPIO generally calls this function when a multipath device is being enumerated, but the function could be called at any time.</span></span>

<span data-ttu-id="0af14-130">Se un DSM non tocca mai un indirizzo STOR esteso di SRB \_ , può restituire true per qualsiasi valore di tipo di indirizzo di archiviazione valido \_ \_ \_ \* .</span><span class="sxs-lookup"><span data-stu-id="0af14-130">If a DSM never touches an extended SRB’s STOR\_ADDRESS, then it can return TRUE for any valid STORAGE\_ADDRESS\_TYPE\_\* value.</span></span> <span data-ttu-id="0af14-131">Esaminare il DSM di esempio in WDK.</span><span class="sxs-lookup"><span data-stu-id="0af14-131">Review the sample DSM in the WDK.</span></span>

<span data-ttu-id="0af14-132">**Altre note importanti**</span><span class="sxs-lookup"><span data-stu-id="0af14-132">**Other important notes**</span></span>

-   <span data-ttu-id="0af14-133">DSM che supportano SRB estese devono essere in grado di gestire sia le strutture del \_ blocco di richieste SCSI sia \_ le strutture di blocco delle richieste di archiviazione \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="0af14-133">DSMs that support extended SRBs must be able to handle both SCSI\_REQUEST\_BLOCK structures and STORAGE\_REQUEST\_BLOCK structures.</span></span> <span data-ttu-id="0af14-134">Solo perché un DSM segnala che supporta SRB esteso non significa che riceva esclusivamente SRB estese.</span><span class="sxs-lookup"><span data-stu-id="0af14-134">Just because a DSM reports that it supports extended SRBs does not mean that it will exclusively receive extended SRBs.</span></span> <span data-ttu-id="0af14-135">Può comunque ricevere un numero qualsiasi di SRB legacy oltre ai SRB estesi e pertanto deve essere in grado di gestire entrambe.</span><span class="sxs-lookup"><span data-stu-id="0af14-135">It may still receive any number of legacy SRBs in addition to extended SRBs, and therefore must be able to handle both.</span></span>
-   <span data-ttu-id="0af14-136">È stato fornito un file di intestazione in WDK denominato srbhelper. h che contiene funzioni inline per aiutare i driver che devono gestire SRB estesi e legacy.</span><span class="sxs-lookup"><span data-stu-id="0af14-136">We have provided a header file in the WDK called srbhelper.h that contains inline functions to help drivers that must handle both extended and legacy SRBs.</span></span> <span data-ttu-id="0af14-137">Il DSM di esempio usa questa intestazione per poterla usare come esempio di come usare queste funzioni.</span><span class="sxs-lookup"><span data-stu-id="0af14-137">Our sample DSM uses this header so you can use it as an example of how to use these functions.</span></span>
-   <span data-ttu-id="0af14-138">Un DSM che non supporta SRB estesi non dovrà mai gestire SRB estesi.</span><span class="sxs-lookup"><span data-stu-id="0af14-138">A DSM that does not support extended SRBs will never have to handle extended SRBs.</span></span>
-   <span data-ttu-id="0af14-139">È possibile che un MPIO provochi il fallback dello stack di archiviazione nei SRB legacy nel caso in cui il DSM non supporti un determinato tipo di indirizzo di archiviazione \_ \_ \_ \* (ma in caso contrario supporta SRB estesi).</span><span class="sxs-lookup"><span data-stu-id="0af14-139">It’s possible that a MPIO will cause the storage stack to fall back on legacy SRBs in the event that the DSM does not support a given STORAGE\_ADDRESS\_TYPE\_\* (but otherwise supports extended SRBs).</span></span>
-   <span data-ttu-id="0af14-140">"BTL8" è l'unico \_ \_ tipo di indirizzo \_ \* di archiviazione attualmente definito per Windows Server 2012.</span><span class="sxs-lookup"><span data-stu-id="0af14-140">“BTL8” is the only STORAGE\_ADDRESS\_TYPE\_\*currently defined for Windows Server 2012.</span></span>

 

 




