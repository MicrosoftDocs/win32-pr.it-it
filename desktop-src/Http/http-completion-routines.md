---
title: Routine di completamento HTTP
description: Per le applicazioni sono disponibili diverse opzioni per la ricezione di indicazioni di completamento e una certa flessibilità per gli sviluppatori.
ms.assetid: c48a64d2-b6c8-4694-8600-f84751954bad
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8aee05efc8284cb29130efae4bcaefb4834a3fb4
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/19/2020
ms.locfileid: "103963067"
---
# <a name="http-completion-routines"></a><span data-ttu-id="a24ce-103">Routine di completamento HTTP</span><span class="sxs-lookup"><span data-stu-id="a24ce-103">HTTP Completion Routines</span></span>

<span data-ttu-id="a24ce-104">Per le applicazioni sono disponibili diverse opzioni per la ricezione di indicazioni di completamento e una certa flessibilità per gli sviluppatori.</span><span class="sxs-lookup"><span data-stu-id="a24ce-104">Applications have several options for receiving completion indications and providing some flexibility for developers.</span></span> <span data-ttu-id="a24ce-105">Le opzioni sono bloccate in attesa del completamento di una chiamata API o per l'uso di routine di completamento per le operazioni asincrone.</span><span class="sxs-lookup"><span data-stu-id="a24ce-105">The options are to block while waiting for an API call to complete or to use completion routines for asynchronous operations.</span></span> <span data-ttu-id="a24ce-106">Il vantaggio dell'uso di operazioni asincrone è un aumento della velocità di risposta dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a24ce-106">The advantage of using asynchronous operations is an increase in responsiveness of the application.</span></span>

## <a name="blocked-io"></a><span data-ttu-id="a24ce-107">I/O bloccato</span><span class="sxs-lookup"><span data-stu-id="a24ce-107">Blocked I/O</span></span>

<span data-ttu-id="a24ce-108">Le applicazioni possono bloccarsi in attesa del completamento della chiamata API impostando la struttura [**sovrapposta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) su **null**.</span><span class="sxs-lookup"><span data-stu-id="a24ce-108">Applications can block while waiting for the API call to complete by setting the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure to **NULL**.</span></span> <span data-ttu-id="a24ce-109">Questo blocca tutte le operazioni sul thread.</span><span class="sxs-lookup"><span data-stu-id="a24ce-109">This truly blocks all operations on the thread.</span></span> <span data-ttu-id="a24ce-110">Nelle chiamate a [**HttpWaitForDisconnect**](/windows/desktop/api/Http/nf-http-httpwaitfordisconnect), ad esempio, la chiamata si blocca fino a quando la connessione non viene interruppe.</span><span class="sxs-lookup"><span data-stu-id="a24ce-110">For example, in calls to [**HttpWaitForDisconnect**](/windows/desktop/api/Http/nf-http-httpwaitfordisconnect), the call blocks until the connection is broken.</span></span>

## <a name="asynchronous-io"></a><span data-ttu-id="a24ce-111">I/O asincrono</span><span class="sxs-lookup"><span data-stu-id="a24ce-111">Asynchronous I/O</span></span>

<span data-ttu-id="a24ce-112">Le applicazioni che preferiscono non bloccare possono utilizzare la struttura [**sovrapposta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) per ottenere i risultati del completamento.</span><span class="sxs-lookup"><span data-stu-id="a24ce-112">Applications that prefer not to block can use the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure to obtain the completion results.</span></span> <span data-ttu-id="a24ce-113">L'applicazione fornisce un puntatore a una struttura **sovrapposta** , che viene utilizzata con un oggetto evento o una porta di completamento.</span><span class="sxs-lookup"><span data-stu-id="a24ce-113">The application supplies a pointer to an **OVERLAPPED** structure, which is used with an event object or a completion port.</span></span> <span data-ttu-id="a24ce-114">Con una porta di completamento di I/O, un handle HTTP viene usato come handle di file in un'operazione di I/O di file asincrona.</span><span class="sxs-lookup"><span data-stu-id="a24ce-114">With an I/O completion port, an HTTP handle is used as a file handle would be in an asynchronous file I/O operation.</span></span> <span data-ttu-id="a24ce-115">Nella tabella seguente sono riepilogate le opzioni di completamento disponibili per le applicazioni.</span><span class="sxs-lookup"><span data-stu-id="a24ce-115">The following table summarizes the completion options available to the applications.</span></span>



| <span data-ttu-id="a24ce-116">Struttura sovrapposta</span><span class="sxs-lookup"><span data-stu-id="a24ce-116">Overlapped structure</span></span> | <span data-ttu-id="a24ce-117">Oggetto Event</span><span class="sxs-lookup"><span data-stu-id="a24ce-117">Event object</span></span>   | <span data-ttu-id="a24ce-118">Porta di completamento</span><span class="sxs-lookup"><span data-stu-id="a24ce-118">Completion port</span></span> | <span data-ttu-id="a24ce-119">Completion</span><span class="sxs-lookup"><span data-stu-id="a24ce-119">Completion</span></span>                                                                                                   |
|----------------------|----------------|-----------------|--------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="a24ce-120">**NULL**</span><span class="sxs-lookup"><span data-stu-id="a24ce-120">**NULL**</span></span>             | <span data-ttu-id="a24ce-121">Non applicabile</span><span class="sxs-lookup"><span data-stu-id="a24ce-121">Not Applicable</span></span> | <span data-ttu-id="a24ce-122">Ignorato</span><span class="sxs-lookup"><span data-stu-id="a24ce-122">Ignored</span></span>         | <span data-ttu-id="a24ce-123">L'operazione viene completata in modo sincrono.</span><span class="sxs-lookup"><span data-stu-id="a24ce-123">Operation completes synchronously.</span></span>                                                                           |
| <span data-ttu-id="a24ce-124">Non **null**</span><span class="sxs-lookup"><span data-stu-id="a24ce-124">Non-**NULL**</span></span>         | <span data-ttu-id="a24ce-125">Non **null**</span><span class="sxs-lookup"><span data-stu-id="a24ce-125">Non-**NULL**</span></span>   | <span data-ttu-id="a24ce-126">**NULL**</span><span class="sxs-lookup"><span data-stu-id="a24ce-126">**NULL**</span></span>        | <span data-ttu-id="a24ce-127">L'operazione viene completata in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="a24ce-127">Operation completes asynchronously.</span></span> <span data-ttu-id="a24ce-128">La notifica sovrapposta viene eseguita segnalando un oggetto evento.</span><span class="sxs-lookup"><span data-stu-id="a24ce-128">Overlapped notification is performed by signaling an event object.</span></span>       |
| <span data-ttu-id="a24ce-129">Non **null**</span><span class="sxs-lookup"><span data-stu-id="a24ce-129">Non-**NULL**</span></span>         | <span data-ttu-id="a24ce-130">Ignorato</span><span class="sxs-lookup"><span data-stu-id="a24ce-130">Ignored</span></span>        | <span data-ttu-id="a24ce-131">Non **null**</span><span class="sxs-lookup"><span data-stu-id="a24ce-131">Non-**NULL**</span></span>    | <span data-ttu-id="a24ce-132">L'operazione viene completata in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="a24ce-132">Operation completes asynchronously.</span></span> <span data-ttu-id="a24ce-133">La notifica sovrapposta viene eseguita pianificando una routine di completamento.</span><span class="sxs-lookup"><span data-stu-id="a24ce-133">Overlapped notification is performed by scheduling a completion routine.</span></span> |



 

## <a name="returning-the-number-of-bytes-read"></a><span data-ttu-id="a24ce-134">Restituzione del numero di byte letti</span><span class="sxs-lookup"><span data-stu-id="a24ce-134">Returning the Number of Bytes Read</span></span>

<span data-ttu-id="a24ce-135">Alcune delle funzioni che usano la struttura [**sovrapposta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) per il completamento asincrono restituiscono un parametro *PBytesReceived* (o *pBytesSent* o *pBytesRead*) che indica il numero di byte trasferiti in modo sincrono.</span><span class="sxs-lookup"><span data-stu-id="a24ce-135">Some of the functions that use the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure for asynchronous completion return a *pBytesReceived* (or *pBytesSent* or *pBytesRead*) parameter that indicates the number of bytes transferred synchronously.</span></span> <span data-ttu-id="a24ce-136">Per le chiamate asincrone, questo parametro deve essere impostato su **null**.</span><span class="sxs-lookup"><span data-stu-id="a24ce-136">For asynchronous calls, this parameter should be set to **NULL**.</span></span> <span data-ttu-id="a24ce-137">Per le chiamate sincrone, il parametro *pBytesReceived* è facoltativo e può essere **null** o non **null**.</span><span class="sxs-lookup"><span data-stu-id="a24ce-137">For synchronous calls, the *pBytesReceived* parameter is optional and can be either **NULL** or non-**NULL**.</span></span>

<span data-ttu-id="a24ce-138">Se l'oggetto evento viene utilizzato per il completamento asincrono, viene chiamata la funzione [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) per determinare il numero di byte letti.</span><span class="sxs-lookup"><span data-stu-id="a24ce-138">If the event object is used for asynchronous completion, the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function is called to determine the number of bytes read.</span></span> <span data-ttu-id="a24ce-139">Se viene usata la porta di completamento (il parametro *hFile* è associato a una porta di completamento di I/O), l'applicazione chiama la funzione [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) per determinare il numero di byte letti.</span><span class="sxs-lookup"><span data-stu-id="a24ce-139">If the completion port is used (the *hFile* parameter is associated with an I/O completion port), the application calls the [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) function to determine the number of bytes read.</span></span> <span data-ttu-id="a24ce-140">Se le operazioni asincrone non sono state completate, le applicazioni possono chiamare la funzione [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) per ottenere informazioni estese sull'errore.</span><span class="sxs-lookup"><span data-stu-id="a24ce-140">If the asynchronous operations have not completed, applications can call the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function to obtain extended error information.</span></span>

<span data-ttu-id="a24ce-141">La tabella seguente riepiloga il comportamento di completamento per il completamento sincrono e asincrono in funzioni come [**HttpReceiveHttpRequest**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) che usano il parametro *pBytesReceived* .</span><span class="sxs-lookup"><span data-stu-id="a24ce-141">The following table summarizes the completion behavior for synchronous and asynchronous completion in functions such as [**HttpReceiveHttpRequest**](/windows/desktop/api/Http/nf-http-httpreceivehttprequest) that use the *pBytesReceived* parameter.</span></span>



| <span data-ttu-id="a24ce-142">pBytesReceived\*</span><span class="sxs-lookup"><span data-stu-id="a24ce-142">pBytesReceived\*</span></span> | <span data-ttu-id="a24ce-143">pOverlapped</span><span class="sxs-lookup"><span data-stu-id="a24ce-143">pOverlapped</span></span>  | <span data-ttu-id="a24ce-144">Descrizione</span><span class="sxs-lookup"><span data-stu-id="a24ce-144">Description</span></span>                                                                             |
|------------------|--------------|-----------------------------------------------------------------------------------------|
| <span data-ttu-id="a24ce-145">**NULL**</span><span class="sxs-lookup"><span data-stu-id="a24ce-145">**NULL**</span></span>         | <span data-ttu-id="a24ce-146">**NULL**</span><span class="sxs-lookup"><span data-stu-id="a24ce-146">**NULL**</span></span>     | <span data-ttu-id="a24ce-147">L'applicazione non riceve informazioni sul numero di byte restituiti.</span><span class="sxs-lookup"><span data-stu-id="a24ce-147">The application does not receive information on the number of bytes returned.</span></span>           |
| <span data-ttu-id="a24ce-148">**NULL**</span><span class="sxs-lookup"><span data-stu-id="a24ce-148">**NULL**</span></span>         | <span data-ttu-id="a24ce-149">Non **null**</span><span class="sxs-lookup"><span data-stu-id="a24ce-149">Non-**NULL**</span></span> | <span data-ttu-id="a24ce-150">L'operazione asincrona *pBytesReceived* è priva di significato.</span><span class="sxs-lookup"><span data-stu-id="a24ce-150">Asynchronous operation, *pBytesReceived* is meaningless.</span></span>                                |
| <span data-ttu-id="a24ce-151">Non **null**</span><span class="sxs-lookup"><span data-stu-id="a24ce-151">Non-**NULL**</span></span>     | <span data-ttu-id="a24ce-152">**NULL**</span><span class="sxs-lookup"><span data-stu-id="a24ce-152">**NULL**</span></span>     | <span data-ttu-id="a24ce-153">Operazione sincrona, numero di byte restituiti in *pBytesReceived*.</span><span class="sxs-lookup"><span data-stu-id="a24ce-153">Synchronous operation, number of bytes returned in *pBytesReceived*.</span></span>                    |
| <span data-ttu-id="a24ce-154">Non **null**</span><span class="sxs-lookup"><span data-stu-id="a24ce-154">Non-**NULL**</span></span>     | <span data-ttu-id="a24ce-155">Non **null**</span><span class="sxs-lookup"><span data-stu-id="a24ce-155">Non-**NULL**</span></span> | <span data-ttu-id="a24ce-156">L'operazione asincrona *pBytesReceived* viene ignorata anche se non è **null**.\*\*</span><span class="sxs-lookup"><span data-stu-id="a24ce-156">Asynchronous operation, *pBytesReceived* is ignored even though it is not **NULL**.\*\*</span></span> |



 

> [!Note]  
> <span data-ttu-id="a24ce-157">\*Questo parametro può essere anche *pBytesSent* o *pBytesRead*.</span><span class="sxs-lookup"><span data-stu-id="a24ce-157">\*This parameter can also be *pBytesSent* or *pBytesRead*.</span></span>

 

> [!Note]  
> <span data-ttu-id="a24ce-158">\*\*È consigliabile che le applicazioni passino un **valore null** in *pBytesReceived* per le operazioni asincrone e ottengano il numero di byte ricevuti da [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) o [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus).</span><span class="sxs-lookup"><span data-stu-id="a24ce-158">\*\*It is recommended that applications pass a **NULL** in *pBytesReceived* for asynchronous operations and obtain the number of bytes received from either [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) or [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus).</span></span>

 

## <a name="return-codes"></a><span data-ttu-id="a24ce-159">Codici restituiti</span><span class="sxs-lookup"><span data-stu-id="a24ce-159">Return Codes</span></span>

<span data-ttu-id="a24ce-160">L'API server HTTP restituisce tre classi di codici per le chiamate di funzione asincrone.</span><span class="sxs-lookup"><span data-stu-id="a24ce-160">The HTTP Server API returns three classes of codes for asynchronous function calls.</span></span>

-   <span data-ttu-id="a24ce-161">Nessun \_ errore</span><span class="sxs-lookup"><span data-stu-id="a24ce-161">NO\_ERROR</span></span>
-   <span data-ttu-id="a24ce-162">ERRORE i/o \_ \_ in sospeso</span><span class="sxs-lookup"><span data-stu-id="a24ce-162">ERROR\_IO\_PENDING</span></span>
-   <span data-ttu-id="a24ce-163">Qualsiasi altro [codice di errore di sistema](/windows/desktop/Debug/system-error-codes).</span><span class="sxs-lookup"><span data-stu-id="a24ce-163">Any other [system error code](/windows/desktop/Debug/system-error-codes).</span></span>

<span data-ttu-id="a24ce-164">Quando si verificano errori \_ \_ di i/o in sospeso o non \_ vengono restituiti errori dalla chiamata di funzione asincrona, è necessario che gli utenti attendano la segnalazione dell'evento o della routine di completamento.</span><span class="sxs-lookup"><span data-stu-id="a24ce-164">When ERROR\_IO\_PENDING or NO\_ERROR are returned from the asynchronous function call, users should expect the event or completion routine to be signaled.</span></span> <span data-ttu-id="a24ce-165">La chiamata della funzione [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) per l'evento o la funzione [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) per la porta di completamento restituisce lo stato di completamento.</span><span class="sxs-lookup"><span data-stu-id="a24ce-165">Calling the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function for the event or the [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) function for the completion port returns the completion status.</span></span> <span data-ttu-id="a24ce-166">Inoltre, se non \_ viene restituito alcun errore, le applicazioni possono eseguire la post-elaborazione sullo stesso thread che ha effettuato la chiamata all'API.</span><span class="sxs-lookup"><span data-stu-id="a24ce-166">In addition, if NO\_ERROR is returned, applications can perform post-processing on the same thread that made the API call.</span></span>

<span data-ttu-id="a24ce-167">Se l'API del server HTTP restituisce un valore diverso da errore \_ io \_ in sospeso o nessun \_ errore, dalla chiamata di funzione asincrona, la routine di completamento non viene segnalata e l'errore viene restituito direttamente dall'API.</span><span class="sxs-lookup"><span data-stu-id="a24ce-167">If the HTTP Server API returns anything other than ERROR\_IO\_PENDING or NO\_ERROR, from the asynchronous function call, the completion routine is not signaled, and the error is directly returned by the API.</span></span>

 

 