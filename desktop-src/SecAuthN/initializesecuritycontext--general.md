---
description: Avvia il lato client, il contesto di [*sicurezza*](../secgloss/s-gly.md) in uscita da un handle di credenziale.
ms.assetid: 21d965d4-3c03-4e29-a70d-4538c5c366b0
title: Funzione InitializeSecurityContext (General) (Sspi.h)
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: bc96fe74202f1380d2d85946a373f176e14dfd6d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "104348076"
---
# <a name="initializesecuritycontext-general-function"></a><span data-ttu-id="790a1-103">Funzione InitializeSecurityContext (General)</span><span class="sxs-lookup"><span data-stu-id="790a1-103">InitializeSecurityContext (General) function</span></span>

<span data-ttu-id="790a1-104">La funzione **InitializeSecurityContext (General)** avvia il lato client, il contesto di [*sicurezza*](../secgloss/s-gly.md) in uscita da un handle di credenziale.</span><span class="sxs-lookup"><span data-stu-id="790a1-104">The **InitializeSecurityContext (General)** function initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle.</span></span> <span data-ttu-id="790a1-105">La funzione viene utilizzata per creare un [*contesto di sicurezza*](../secgloss/s-gly.md) tra l'applicazione client e un peer remoto.</span><span class="sxs-lookup"><span data-stu-id="790a1-105">The function is used to build a [*security context*](../secgloss/s-gly.md) between the client application and a remote peer.</span></span> <span data-ttu-id="790a1-106">**InitializeSecurityContext (generale)** restituisce un token che il client deve passare al peer remoto, che a sua volta viene inviato all'implementazione della sicurezza locale tramite la chiamata [**AcceptSecurityContext (generale)**](acceptsecuritycontext--general.md) .</span><span class="sxs-lookup"><span data-stu-id="790a1-106">**InitializeSecurityContext (General)** returns a token that the client must pass to the remote peer, which the peer in turn submits to the local security implementation through the [**AcceptSecurityContext (General)**](acceptsecuritycontext--general.md) call.</span></span> <span data-ttu-id="790a1-107">Il token generato deve essere considerato opaco da tutti i chiamanti.</span><span class="sxs-lookup"><span data-stu-id="790a1-107">The token generated should be considered opaque by all callers.</span></span>

<span data-ttu-id="790a1-108">In genere, la funzione **InitializeSecurityContext (generale)** viene chiamata in un ciclo fino a quando non viene stabilito un [*contesto di sicurezza*](../secgloss/s-gly.md) sufficiente.</span><span class="sxs-lookup"><span data-stu-id="790a1-108">Typically, the **InitializeSecurityContext (General)** function is called in a loop until a sufficient [*security context*](../secgloss/s-gly.md) is established.</span></span>

<span data-ttu-id="790a1-109">Per informazioni sull'utilizzo di questa funzione con un [*Security Support Provider*](../secgloss/s-gly.md) specifico (SSP), vedere gli argomenti seguenti.</span><span class="sxs-lookup"><span data-stu-id="790a1-109">For information about using this function with a specific [*security support provider*](../secgloss/s-gly.md) (SSP), see the following topics.</span></span>



| <span data-ttu-id="790a1-110">Argomento</span><span class="sxs-lookup"><span data-stu-id="790a1-110">Topic</span></span>                                                                                  | <span data-ttu-id="790a1-111">Descrizione</span><span class="sxs-lookup"><span data-stu-id="790a1-111">Description</span></span>                                                                                                                                |
|----------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="790a1-112">**InitializeSecurityContext (CredSSP)**</span><span class="sxs-lookup"><span data-stu-id="790a1-112">**InitializeSecurityContext (CredSSP)**</span></span>](initializesecuritycontext--credssp.md)     | <span data-ttu-id="790a1-113">Avvia il lato client, il contesto di [*sicurezza*](../secgloss/s-gly.md) in uscita da un handle delle credenziali utilizzando il [*pacchetto di sicurezza*](../secgloss/s-gly.md)Credential Security Support Provider (CredSSP).</span><span class="sxs-lookup"><span data-stu-id="790a1-113">Initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle by using the Credential Security Support Provider (CredSSP) [*security package*](../secgloss/s-gly.md).</span></span>  
| [<span data-ttu-id="790a1-114">**InitializeSecurityContext (digest)**</span><span class="sxs-lookup"><span data-stu-id="790a1-114">**InitializeSecurityContext (Digest)**</span></span>](initializesecuritycontext--digest.md)       | <span data-ttu-id="790a1-115">Avvia il lato client, il contesto di [*sicurezza*](../secgloss/s-gly.md) in uscita da un handle delle credenziali utilizzando il [*pacchetto di sicurezza*](../secgloss/s-gly.md)digest.</span><span class="sxs-lookup"><span data-stu-id="790a1-115">Initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle by using the Digest [*security package*](../secgloss/s-gly.md).</span></span>                        |
| [<span data-ttu-id="790a1-116">**InitializeSecurityContext (Kerberos)**</span><span class="sxs-lookup"><span data-stu-id="790a1-116">**InitializeSecurityContext (Kerberos)**</span></span>](initializesecuritycontext--kerberos.md)   | <span data-ttu-id="790a1-117">Avvia il lato client, il contesto di [*sicurezza*](../secgloss/s-gly.md) in uscita da un handle delle credenziali utilizzando il [*pacchetto di sicurezza*](../secgloss/s-gly.md)Kerberos.</span><span class="sxs-lookup"><span data-stu-id="790a1-117">Initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle by using the Kerberos [*security package*](../secgloss/s-gly.md).</span></span>                      |
| [<span data-ttu-id="790a1-118">**InitializeSecurityContext (negoziazione)**</span><span class="sxs-lookup"><span data-stu-id="790a1-118">**InitializeSecurityContext (Negotiate)**</span></span>](initializesecuritycontext--negotiate.md) | <span data-ttu-id="790a1-119">Avvia il lato client, il contesto di [*sicurezza*](../secgloss/s-gly.md) in uscita da un handle delle credenziali utilizzando il [*pacchetto di sicurezza*](../secgloss/s-gly.md)Negotiate.</span><span class="sxs-lookup"><span data-stu-id="790a1-119">Initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle by using the Negotiate [*security package*](../secgloss/s-gly.md).</span></span>                     |
| [<span data-ttu-id="790a1-120">**InitializeSecurityContext (NTLM)**</span><span class="sxs-lookup"><span data-stu-id="790a1-120">**InitializeSecurityContext (NTLM)**</span></span>](initializesecuritycontext--ntlm.md)           | <span data-ttu-id="790a1-121">Avvia il lato client, il contesto di [*sicurezza*](../secgloss/s-gly.md) in uscita da un handle delle credenziali utilizzando il [*pacchetto di sicurezza*](../secgloss/s-gly.md)NTLM.</span><span class="sxs-lookup"><span data-stu-id="790a1-121">Initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle by using the NTLM [*security package*](../secgloss/s-gly.md).</span></span>                          |
| [<span data-ttu-id="790a1-122">**InitializeSecurityContext (Schannel)**</span><span class="sxs-lookup"><span data-stu-id="790a1-122">**InitializeSecurityContext (Schannel)**</span></span>](initializesecuritycontext--schannel.md)   | <span data-ttu-id="790a1-123">Avvia il lato client, il contesto di [*sicurezza*](../secgloss/s-gly.md) in uscita da un handle delle credenziali usando il [*pacchetto di sicurezza*](../secgloss/s-gly.md)Schannel.</span><span class="sxs-lookup"><span data-stu-id="790a1-123">Initiates the client side, outbound [*security context*](../secgloss/s-gly.md) from a credential handle by using the Schannel [*security package*](../secgloss/s-gly.md).</span></span>                      |



 

## <a name="syntax"></a><span data-ttu-id="790a1-124">Sintassi</span><span class="sxs-lookup"><span data-stu-id="790a1-124">Syntax</span></span>


```C++
SECURITY_STATUS SEC_Entry InitializeSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _In_opt_    PCtxtHandle    phContext,
  _In_opt_    SEC_CHAR       *pszTargetName,
  _In_        ULONG          fContextReq,
  _In_        ULONG          Reserved1,
  _In_        ULONG          TargetDataRep,
  _In_opt_    PSecBufferDesc pInput,
  _In_        ULONG          Reserved2,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Inout_opt_ PSecBufferDesc pOutput,
  _Out_       PULONG         pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```



## <a name="parameters"></a><span data-ttu-id="790a1-125">Parametri</span><span class="sxs-lookup"><span data-stu-id="790a1-125">Parameters</span></span>

<dl> <dt>

<span data-ttu-id="790a1-126">*phCredential* \[ in, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="790a1-126">*phCredential* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="790a1-127">Handle per le credenziali restituite da [**AcquireCredentialsHandle (generale)**](acquirecredentialshandle--general.md).</span><span class="sxs-lookup"><span data-stu-id="790a1-127">A handle to the credentials returned by [**AcquireCredentialsHandle (General)**](acquirecredentialshandle--general.md).</span></span> <span data-ttu-id="790a1-128">Questo handle viene utilizzato per compilare il [*contesto di sicurezza*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="790a1-128">This handle is used to build the [*security context*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="790a1-129">La funzione **InitializeSecurityContext (generale)** richiede almeno credenziali in uscita.</span><span class="sxs-lookup"><span data-stu-id="790a1-129">The **InitializeSecurityContext (General)** function requires at least OUTBOUND credentials.</span></span>

</dd> <dt>

<span data-ttu-id="790a1-130">*phContext* \[ in, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="790a1-130">*phContext* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="790a1-131">Puntatore a una struttura [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="790a1-131">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="790a1-132">Alla prima chiamata a **InitializeSecurityContext (generale)**, questo puntatore è **null**.</span><span class="sxs-lookup"><span data-stu-id="790a1-132">On the first call to **InitializeSecurityContext (General)**, this pointer is **NULL**.</span></span> <span data-ttu-id="790a1-133">Alla seconda chiamata, questo parametro è un puntatore all'handle per il contesto parzialmente formato restituito nel parametro *phNewContext* dalla prima chiamata.</span><span class="sxs-lookup"><span data-stu-id="790a1-133">On the second call, this parameter is a pointer to the handle to the partially formed context returned in the *phNewContext* parameter by the first call.</span></span>

<span data-ttu-id="790a1-134">Questo parametro è facoltativo con il SSP Microsoft Digest e può essere impostato su **null**.</span><span class="sxs-lookup"><span data-stu-id="790a1-134">This parameter is optional with the Microsoft Digest SSP and can be set to **NULL**.</span></span>

<span data-ttu-id="790a1-135">Quando si usa SSP Schannel, alla prima chiamata a **InitializeSecurityContext (generale)** specificare **null**.</span><span class="sxs-lookup"><span data-stu-id="790a1-135">When using the Schannel SSP, on the first call to **InitializeSecurityContext (General)**, specify **NULL**.</span></span> <span data-ttu-id="790a1-136">Nelle chiamate future specificare il token ricevuto nel parametro *phNewContext* dopo la prima chiamata a questa funzione.</span><span class="sxs-lookup"><span data-stu-id="790a1-136">On future calls, specify the token received in the *phNewContext* parameter after the first call to this function.</span></span>

</dd> <dt>

<span data-ttu-id="790a1-137">*pTargetName* \[ in, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="790a1-137">*pTargetName* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="790a1-138">Puntatore a una stringa con terminazione null che indica la destinazione del contesto.</span><span class="sxs-lookup"><span data-stu-id="790a1-138">A pointer to a null-terminated string that indicates the target of the context.</span></span> <span data-ttu-id="790a1-139">Il contenuto della stringa è specifico del [*pacchetto di sicurezza*](../secgloss/s-gly.md) , come descritto nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="790a1-139">The string contents are [*security package*](../secgloss/s-gly.md) specific, as described in the following table.</span></span> <span data-ttu-id="790a1-140">L'elenco non è completo.</span><span class="sxs-lookup"><span data-stu-id="790a1-140">This list is not exhaustive.</span></span> <span data-ttu-id="790a1-141">È possibile aggiungere altri SSP di sistema e SSP di terze parti a un sistema.</span><span class="sxs-lookup"><span data-stu-id="790a1-141">Additional system SSPs and third party SSPs can be added to a system.</span></span>



<table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr class="header"><th><span data-ttu-id="790a1-142">SSP in uso</span><span class="sxs-lookup"><span data-stu-id="790a1-142">SSP in use</span></span></th><th><span data-ttu-id="790a1-143">Significato</span><span class="sxs-lookup"><span data-stu-id="790a1-143">Meaning</span></span></th></tr></thead><tbody><tr class="odd"><td><span id="Digest"></span><span id="digest"></span><span id="DIGEST"></span><dl> <span data-ttu-id="790a1-144"><dt><strong>Digest</strong></dt><dt></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-144"><dt><strong>Digest</strong></dt> <dt></dt> </span></span></dl></td><td><span data-ttu-id="790a1-145">Stringa con terminazione null che identifica in modo univoco l'URI della risorsa richiesta.</span><span class="sxs-lookup"><span data-stu-id="790a1-145">Null-terminated string that uniquely identifies the URI of the requested resource.</span></span> <span data-ttu-id="790a1-146">La stringa deve essere composta da caratteri consentiti in un URI e deve essere rappresentabile dal set di codici ASCII US.</span><span class="sxs-lookup"><span data-stu-id="790a1-146">The string must be composed of characters that are allowed in a URI and must be representable by the US ASCII code set.</span></span> <span data-ttu-id="790a1-147">È possibile usare la codifica percent per rappresentare i caratteri al di fuori del set di codici ASCII US.</span><span class="sxs-lookup"><span data-stu-id="790a1-147">Percent encoding can be used to represent characters outside the US ASCII code set.</span></span><br/></td></tr><tr class="even"><td><span id="Kerberos_or_Negotiate"></span><span id="kerberos_or_negotiate"></span><span id="KERBEROS_OR_NEGOTIATE"></span><dl> <span data-ttu-id="790a1-148"><dt><strong>Kerberos o negoziazione</strong></dt><dt></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-148"><dt><strong>Kerberos or Negotiate</strong></dt> <dt></dt> </span></span></dl></td><td><span data-ttu-id="790a1-149">Nome dell'entità servizio (SPN) o il [*contesto di sicurezza*](../secgloss/s-gly.md) del server di destinazione.</span><span class="sxs-lookup"><span data-stu-id="790a1-149">Service principal name (SPN) or the [*security context*](../secgloss/s-gly.md) of the destination server.</span></span><br/></td></tr><tr class="odd"><td><span id="NTLM"></span><span id="ntlm"></span><dl> <span data-ttu-id="790a1-150"><dt><strong>NTLM</strong></dt><dt></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-150"><dt><strong>NTLM</strong></dt> <dt></dt> </span></span></dl></td><td><span data-ttu-id="790a1-151">Nome dell'entità servizio (SPN) o il [*contesto di sicurezza*](../secgloss/s-gly.md) del server di destinazione.</span><span class="sxs-lookup"><span data-stu-id="790a1-151">Service principal name (SPN) or the [*security context*](../secgloss/s-gly.md) of the destination server.</span></span><br/></td></tr><tr class="even"><td><span id="Schannel_SSL"></span><span id="schannel_ssl"></span><span id="SCHANNEL_SSL"></span><dl> <span data-ttu-id="790a1-152"><dt><strong>Schannel/SSL</strong></dt><dt></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-152"><dt><strong>Schannel/SSL</strong></dt> <dt></dt> </span></span></dl></td><td><span data-ttu-id="790a1-153">Stringa con terminazione null che identifica in modo univoco il server di destinazione.</span><span class="sxs-lookup"><span data-stu-id="790a1-153">Null-terminated string that uniquely identifies the target server.</span></span> <span data-ttu-id="790a1-154">SChannel utilizza questo valore per verificare il certificato del server.</span><span class="sxs-lookup"><span data-stu-id="790a1-154">Schannel uses this value to verify the server certificate.</span></span> <span data-ttu-id="790a1-155">Schannel usa anche questo valore per individuare la sessione nella cache della sessione quando si ristabilisce una connessione.</span><span class="sxs-lookup"><span data-stu-id="790a1-155">Schannel also uses this value to locate the session in the session cache when reestablishing a connection.</span></span> <span data-ttu-id="790a1-156">La sessione memorizzata nella cache viene utilizzata solo se vengono soddisfatte tutte le condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="790a1-156">The cached session is used only if all of the following conditions are met:</span></span><ul><li><span data-ttu-id="790a1-157">Il nome di destinazione è lo stesso.</span><span class="sxs-lookup"><span data-stu-id="790a1-157">The target name is the same.</span></span></li><li><span data-ttu-id="790a1-158">La voce della cache non è scaduta.</span><span class="sxs-lookup"><span data-stu-id="790a1-158">The cache entry has not expired.</span></span></li><li><span data-ttu-id="790a1-159">Il processo dell'applicazione che chiama la funzione è lo stesso.</span><span class="sxs-lookup"><span data-stu-id="790a1-159">The application process that calls the function is the same.</span></span></li><li><span data-ttu-id="790a1-160">La sessione di accesso è la stessa.</span><span class="sxs-lookup"><span data-stu-id="790a1-160">The logon session is the same.</span></span></li><li><span data-ttu-id="790a1-161">L'handle delle credenziali è lo stesso.</span><span class="sxs-lookup"><span data-stu-id="790a1-161">The credential handle is the same.</span></span></li></ul><br/></td></tr></tbody></table>



 

</dd> <dt>

<span data-ttu-id="790a1-162">*fContextReq* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="790a1-162">*fContextReq* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="790a1-163">Flag di bit che indicano le richieste per il contesto.</span><span class="sxs-lookup"><span data-stu-id="790a1-163">Bit flags that indicate requests for the context.</span></span> <span data-ttu-id="790a1-164">Non tutti i pacchetti possono supportare tutti i requisiti.</span><span class="sxs-lookup"><span data-stu-id="790a1-164">Not all packages can support all requirements.</span></span> <span data-ttu-id="790a1-165">I flag usati per questo parametro sono preceduti da ISC \_ req \_ , ad esempio ISC \_ req \_ delegate.</span><span class="sxs-lookup"><span data-stu-id="790a1-165">Flags used for this parameter are prefixed with ISC\_REQ\_, for example, ISC\_REQ\_DELEGATE.</span></span> <span data-ttu-id="790a1-166">Questo parametro può essere costituito da uno o più dei flag di attributi seguenti.</span><span class="sxs-lookup"><span data-stu-id="790a1-166">This parameter can be one or more of the following attributes flags.</span></span>



<table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr class="header"><th><span data-ttu-id="790a1-167">Valore</span><span class="sxs-lookup"><span data-stu-id="790a1-167">Value</span></span></th><th><span data-ttu-id="790a1-168">Significato</span><span class="sxs-lookup"><span data-stu-id="790a1-168">Meaning</span></span></th></tr></thead><tbody><tr class="odd"><td><span id="ISC_REQ_ALLOCATE_MEMORY"></span><span id="isc_req_allocate_memory"></span><dl> <span data-ttu-id="790a1-169"><dt><strong>ISC_REQ_ALLOCATE_MEMORY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-169"><dt><strong>ISC_REQ_ALLOCATE_MEMORY</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-170">Il [*pacchetto di sicurezza*](../secgloss/s-gly.md) alloca automaticamente i buffer di output.</span><span class="sxs-lookup"><span data-stu-id="790a1-170">The [*security package*](../secgloss/s-gly.md) allocates output buffers for you.</span></span> <span data-ttu-id="790a1-171">Al termine dell'utilizzo dei buffer di output, è possibile liberarli chiamando la funzione [<strong>FreeContextBuffer</strong>] (/Windows/Win32/API/SSPI/NF-SSPI-freecontextbuffer).</span><span class="sxs-lookup"><span data-stu-id="790a1-171">When you have finished using the output buffers, free them by calling the [<strong>FreeContextBuffer</strong>](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_CONFIDENTIALITY"></span><span id="isc_req_confidentiality"></span><dl> <span data-ttu-id="790a1-172"><dt><strong>ISC_REQ_CONFIDENTIALITY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-172"><dt><strong>ISC_REQ_CONFIDENTIALITY</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-173">Crittografare i messaggi utilizzando la funzione [<strong>EncryptMessage</strong>] (EncryptMessage--General.MD).</span><span class="sxs-lookup"><span data-stu-id="790a1-173">Encrypt messages by using the [<strong>EncryptMessage</strong>](encryptmessage--general.md) function.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_CONNECTION"></span><span id="isc_req_connection"></span><dl> <span data-ttu-id="790a1-174"><dt><strong>ISC_REQ_CONNECTION</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-174"><dt><strong>ISC_REQ_CONNECTION</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-175">Il [*contesto di sicurezza*](../secgloss/s-gly.md) non gestirà i messaggi di formattazione.</span><span class="sxs-lookup"><span data-stu-id="790a1-175">The [*security context*](../secgloss/s-gly.md) will not handle formatting messages.</span></span> <span data-ttu-id="790a1-176">Questo valore è l'impostazione predefinita per le istanze della [*delega vincolata*](../secgloss/s-gly.md)Kerberos, Negotiate e NTLM.</span><span class="sxs-lookup"><span data-stu-id="790a1-176">This value is the default for the Kerberos, Negotiate, and NTLM [*constrained delegation*](../secgloss/s-gly.md)s.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_DELEGATE"></span><span id="isc_req_delegate"></span><dl> <span data-ttu-id="790a1-177"><dt><strong>ISC_REQ_DELEGATE</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-177"><dt><strong>ISC_REQ_DELEGATE</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-178">Il server può utilizzare il contesto per l'autenticazione ad altri server come client.</span><span class="sxs-lookup"><span data-stu-id="790a1-178">The server can use the context to authenticate to other servers as the client.</span></span> <span data-ttu-id="790a1-179">Per il corretto funzionamento di questo flag è necessario impostare il flag ISC_REQ_MUTUAL_AUTH.</span><span class="sxs-lookup"><span data-stu-id="790a1-179">The ISC_REQ_MUTUAL_AUTH flag must be set for this flag to work.</span></span> <span data-ttu-id="790a1-180">Valido per Kerberos.</span><span class="sxs-lookup"><span data-stu-id="790a1-180">Valid for Kerberos.</span></span> <span data-ttu-id="790a1-181">Ignorare questo flag per la [*delega vincolata*](../secgloss/c-gly.md).</span><span class="sxs-lookup"><span data-stu-id="790a1-181">Ignore this flag for [*constrained delegation*](../secgloss/c-gly.md).</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_EXTENDED_ERROR"></span><span id="isc_req_extended_error"></span><dl> <span data-ttu-id="790a1-182"><dt><strong>ISC_REQ_EXTENDED_ERROR</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-182"><dt><strong>ISC_REQ_EXTENDED_ERROR</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-183">Quando si verificano errori, viene inviata una notifica all'entità remota.</span><span class="sxs-lookup"><span data-stu-id="790a1-183">When errors occur, the remote party will be notified.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_HTTP"></span><span id="isc_req_http"></span><dl> <span data-ttu-id="790a1-184"><dt><strong>ISC_REQ_HTTP</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-184"><dt><strong>ISC_REQ_HTTP</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-185">Usare digest per HTTP.</span><span class="sxs-lookup"><span data-stu-id="790a1-185">Use Digest for HTTP.</span></span> <span data-ttu-id="790a1-186">Omettere questo flag per utilizzare il digest come meccanismo SASL.</span><span class="sxs-lookup"><span data-stu-id="790a1-186">Omit this flag to use Digest as a SASL mechanism.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_INTEGRITY"></span><span id="isc_req_integrity"></span><dl> <span data-ttu-id="790a1-187"><dt><strong>ISC_REQ_INTEGRITY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-187"><dt><strong>ISC_REQ_INTEGRITY</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-188">Firmare i messaggi e verificare le firme usando le funzioni [<strong>EncryptMessage</strong>] (EncryptMessage--General.MD) e [<strong>MakeSignature</strong>] (makesignature.MD).</span><span class="sxs-lookup"><span data-stu-id="790a1-188">Sign messages and verify signatures by using the [<strong>EncryptMessage</strong>](encryptmessage--general.md) and [<strong>MakeSignature</strong>](makesignature.md) functions.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_MANUAL_CRED_VALIDATION"></span><span id="isc_req_manual_cred_validation"></span><dl> <span data-ttu-id="790a1-189"><dt><strong>ISC_REQ_MANUAL_CRED_VALIDATION</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-189"><dt><strong>ISC_REQ_MANUAL_CRED_VALIDATION</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-190">Schannel non deve autenticare il server automaticamente.</span><span class="sxs-lookup"><span data-stu-id="790a1-190">Schannel must not authenticate the server automatically.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_MUTUAL_AUTH"></span><span id="isc_req_mutual_auth"></span><dl> <span data-ttu-id="790a1-191"><dt><strong>ISC_REQ_MUTUAL_AUTH</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-191"><dt><strong>ISC_REQ_MUTUAL_AUTH</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-192">Verranno soddisfatti i criteri di autenticazione reciproca del servizio.</span><span class="sxs-lookup"><span data-stu-id="790a1-192">The mutual authentication policy of the service will be satisfied.</span></span><br/><blockquote>[!Caution]<br />
<span data-ttu-id="790a1-193">Ciò non significa necessariamente che venga eseguita l'autenticazione reciproca, solo che i criteri di autenticazione del servizio siano soddisfatti.</span><span class="sxs-lookup"><span data-stu-id="790a1-193">This does not necessarily mean that mutual authentication is performed, only that the authentication policy of the service is satisfied.</span></span> <span data-ttu-id="790a1-194">Per assicurarsi che venga eseguita l'autenticazione reciproca, chiamare la funzione [<strong>QueryContextAttributes (generale)</strong>] (QueryContextAttributes--General.MD).</span><span class="sxs-lookup"><span data-stu-id="790a1-194">To ensure that mutual authentication is performed, call the [<strong>QueryContextAttributes (General)</strong>](querycontextattributes--general.md) function.</span></span></blockquote><br/></td></tr><tr class="even"><td><span id="ISC_REQ_NO_INTEGRITY"></span><span id="isc_req_no_integrity"></span><dl> <span data-ttu-id="790a1-195"><dt><strong>ISC_REQ_NO_INTEGRITY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-195"><dt><strong>ISC_REQ_NO_INTEGRITY</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-196">Se questo flag è impostato, il flag di <strong>ISC_REQ_INTEGRITY</strong> viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="790a1-196">If this flag is set, the <strong>ISC_REQ_INTEGRITY</strong> flag is ignored.</span></span><br/> <span data-ttu-id="790a1-197">Questo valore è supportato solo dalla [*delega vincolata*](../secgloss/s-gly.md)Negotiate e Kerberos.</span><span class="sxs-lookup"><span data-stu-id="790a1-197">This value is supported only by the Negotiate and Kerberos [*constrained delegation*](../secgloss/s-gly.md)s.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_REPLAY_DETECT"></span><span id="isc_req_replay_detect"></span><dl> <span data-ttu-id="790a1-198"><dt><strong>ISC_REQ_REPLAY_DETECT</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-198"><dt><strong>ISC_REQ_REPLAY_DETECT</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-199">Rilevare i messaggi riprodotti che sono stati codificati tramite le funzioni [<strong>EncryptMessage</strong>] (EncryptMessage--General.MD) o [<strong>MakeSignature</strong>] (makesignature.MD).</span><span class="sxs-lookup"><span data-stu-id="790a1-199">Detect replayed messages that have been encoded by using the [<strong>EncryptMessage</strong>](encryptmessage--general.md) or [<strong>MakeSignature</strong>](makesignature.md) functions.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_SEQUENCE_DETECT"></span><span id="isc_req_sequence_detect"></span><dl> <span data-ttu-id="790a1-200"><dt><strong>ISC_REQ_SEQUENCE_DETECT</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-200"><dt><strong>ISC_REQ_SEQUENCE_DETECT</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-201">Rilevare i messaggi ricevuti fuori sequenza.</span><span class="sxs-lookup"><span data-stu-id="790a1-201">Detect messages received out of sequence.</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_STREAM"></span><span id="isc_req_stream"></span><dl> <span data-ttu-id="790a1-202"><dt><strong>ISC_REQ_STREAM</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-202"><dt><strong>ISC_REQ_STREAM</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-203">Supportare una connessione orientata al flusso.</span><span class="sxs-lookup"><span data-stu-id="790a1-203">Support a stream-oriented connection.</span></span><br/></td></tr><tr class="even"><td><span id="ISC_REQ_USE_SESSION_KEY"></span><span id="isc_req_use_session_key"></span><dl> <span data-ttu-id="790a1-204"><dt><strong>ISC_REQ_USE_SESSION_KEY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-204"><dt><strong>ISC_REQ_USE_SESSION_KEY</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-205">È necessario negoziare una nuova [*chiave di sessione*](../secgloss/s-gly.md) .</span><span class="sxs-lookup"><span data-stu-id="790a1-205">A new [*session key*](../secgloss/s-gly.md) must be negotiated.</span></span><br/> <span data-ttu-id="790a1-206">Questo valore è supportato solo dalla [*delega vincolata*](../secgloss/s-gly.md)Kerberos.</span><span class="sxs-lookup"><span data-stu-id="790a1-206">This value is supported only by the Kerberos [*constrained delegation*](../secgloss/s-gly.md).</span></span><br/></td></tr><tr class="odd"><td><span id="ISC_REQ_USE_SUPPLIED_CREDS"></span><span id="isc_req_use_supplied_creds"></span><dl> <span data-ttu-id="790a1-207"><dt><strong>ISC_REQ_USE_SUPPLIED_CREDS</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="790a1-207"><dt><strong>ISC_REQ_USE_SUPPLIED_CREDS</strong></dt> </span></span></dl></td><td><span data-ttu-id="790a1-208">Schannel non deve tentare di fornire automaticamente le credenziali per il client.</span><span class="sxs-lookup"><span data-stu-id="790a1-208">Schannel must not attempt to supply credentials for the client automatically.</span></span><br/></td></tr></tbody></table>



 

<span data-ttu-id="790a1-209">Gli attributi richiesti potrebbero non essere supportati dal client.</span><span class="sxs-lookup"><span data-stu-id="790a1-209">The requested attributes may not be supported by the client.</span></span> <span data-ttu-id="790a1-210">Per ulteriori informazioni, vedere il parametro *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="790a1-210">For more information, see the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="790a1-211">Per altre descrizioni dei diversi attributi, vedere [requisiti di contesto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="790a1-211">For further descriptions of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

</dd> <dt>

<span data-ttu-id="790a1-212">*Reserved1* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="790a1-212">*Reserved1* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="790a1-213">Questo parametro è riservato e deve essere impostato su zero.</span><span class="sxs-lookup"><span data-stu-id="790a1-213">This parameter is reserved and must be set to zero.</span></span>

</dd> <dt>

<span data-ttu-id="790a1-214">*TargetDataRep* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="790a1-214">*TargetDataRep* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="790a1-215">Rappresentazione dei dati, ad esempio l'ordinamento dei byte, sulla destinazione.</span><span class="sxs-lookup"><span data-stu-id="790a1-215">The data representation, such as byte ordering, on the target.</span></span> <span data-ttu-id="790a1-216">Questo parametro può essere una sicurezza \_ nativa \_ DREP o DREP della rete di sicurezza \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="790a1-216">This parameter can be either SECURITY\_NATIVE\_DREP or SECURITY\_NETWORK\_DREP.</span></span>

<span data-ttu-id="790a1-217">Questo parametro non viene usato con digest o Schannel.</span><span class="sxs-lookup"><span data-stu-id="790a1-217">This parameter is not used with Digest or Schannel.</span></span> <span data-ttu-id="790a1-218">Impostarlo su zero.</span><span class="sxs-lookup"><span data-stu-id="790a1-218">Set it to zero.</span></span>

</dd> <dt>

<span data-ttu-id="790a1-219">*Pinput* \[ in, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="790a1-219">*pInput* \[in, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="790a1-220">Puntatore a una struttura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) che contiene puntatori ai buffer forniti come input per il pacchetto.</span><span class="sxs-lookup"><span data-stu-id="790a1-220">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains pointers to the buffers supplied as input to the package.</span></span> <span data-ttu-id="790a1-221">A meno che il contesto client non sia stato avviato dal server, il valore di questo parametro deve essere **null** nella prima chiamata alla funzione.</span><span class="sxs-lookup"><span data-stu-id="790a1-221">Unless the client context was initiated by the server, the value of this parameter must be **NULL** on the first call to the function.</span></span> <span data-ttu-id="790a1-222">Nelle chiamate successive alla funzione o quando il contesto client è stato avviato dal server, il valore di questo parametro è un puntatore a un buffer allocato con memoria sufficiente per memorizzare il token restituito dal computer remoto.</span><span class="sxs-lookup"><span data-stu-id="790a1-222">On subsequent calls to the function or when the client context was initiated by the server, the value of this parameter is a pointer to a buffer allocated with enough memory to hold the token returned by the remote computer.</span></span>

</dd> <dt>

<span data-ttu-id="790a1-223">*Reserved2* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="790a1-223">*Reserved2* \[in\]</span></span>
</dt> <dd>

<span data-ttu-id="790a1-224">Questo parametro è riservato e deve essere impostato su zero.</span><span class="sxs-lookup"><span data-stu-id="790a1-224">This parameter is reserved and must be set to zero.</span></span>

</dd> <dt>

<span data-ttu-id="790a1-225">*phNewContext* \[ in, out, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="790a1-225">*phNewContext* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="790a1-226">Puntatore a una struttura [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="790a1-226">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="790a1-227">Alla prima chiamata a **InitializeSecurityContext (generale)**, questo puntatore riceve il nuovo handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="790a1-227">On the first call to **InitializeSecurityContext (General)**, this pointer receives the new context handle.</span></span> <span data-ttu-id="790a1-228">Alla seconda chiamata, *phNewContext* può corrispondere all'handle specificato nel parametro *phContext* .</span><span class="sxs-lookup"><span data-stu-id="790a1-228">On the second call, *phNewContext* can be the same as the handle specified in the *phContext* parameter.</span></span>

<span data-ttu-id="790a1-229">Quando si usa SSP Schannel, quando si effettuano chiamate dopo la prima chiamata, passare l'handle restituito qui come parametro *phContext* e specificare **null** per *phNewContext*.</span><span class="sxs-lookup"><span data-stu-id="790a1-229">When using the Schannel SSP, on calls after the first call, pass the handle returned here as the *phContext* parameter and specify **NULL** for *phNewContext*.</span></span>

</dd> <dt>

<span data-ttu-id="790a1-230">*pOutput* \[ in, out, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="790a1-230">*pOutput* \[in, out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="790a1-231">Puntatore a una struttura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) che contiene i puntatori alla struttura [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) che riceve i dati di output.</span><span class="sxs-lookup"><span data-stu-id="790a1-231">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains pointers to the [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) structure that receives the output data.</span></span> <span data-ttu-id="790a1-232">Se un buffer è stato tipizzato come SEC \_ ReadWrite nell'input, sarà presente nell'output.</span><span class="sxs-lookup"><span data-stu-id="790a1-232">If a buffer was typed as SEC\_READWRITE in the input, it will be there on output.</span></span> <span data-ttu-id="790a1-233">Il sistema alloca un buffer per il token di sicurezza, se richiesto (tramite ISC \_ req \_ allocare \_ memoria) e immettere l'indirizzo nel descrittore del buffer per il token di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="790a1-233">The system will allocate a buffer for the security token if requested (through ISC\_REQ\_ALLOCATE\_MEMORY) and fill in the address in the buffer descriptor for the security token.</span></span>

<span data-ttu-id="790a1-234">Quando si utilizza il provider di servizi condivisi Microsoft Digest, questo parametro riceve la risposta alla richiesta di verifica da inviare al server.</span><span class="sxs-lookup"><span data-stu-id="790a1-234">When using the Microsoft Digest SSP, this parameter receives the challenge response that must be sent to the server.</span></span>

<span data-ttu-id="790a1-235">Quando si usa SSP Schannel, se \_ \_ si specifica il flag ISC di allocazione della \_ memoria, SSP Schannel alloca memoria per il buffer e inserisce le informazioni appropriate in [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc).</span><span class="sxs-lookup"><span data-stu-id="790a1-235">When using the Schannel SSP, if the ISC\_REQ\_ALLOCATE\_MEMORY flag is specified, the Schannel SSP will allocate memory for the buffer and put the appropriate information in the [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc).</span></span> <span data-ttu-id="790a1-236">Inoltre, il chiamante deve passare un buffer di tipo **SECBUFFER \_ Alert**.</span><span class="sxs-lookup"><span data-stu-id="790a1-236">In addition, the caller must pass in a buffer of type **SECBUFFER\_ALERT**.</span></span> <span data-ttu-id="790a1-237">Nell'output, se viene generato un avviso, questo buffer contiene informazioni sull'avviso e la funzione ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="790a1-237">On output, if an alert is generated, this buffer contains information about that alert, and the function fails.</span></span>

</dd> <dt>

<span data-ttu-id="790a1-238">*pfContextAttr* \[ out\]</span><span class="sxs-lookup"><span data-stu-id="790a1-238">*pfContextAttr* \[out\]</span></span>
</dt> <dd>

<span data-ttu-id="790a1-239">Puntatore a una variabile per ricevere un set di flag di bit che indicano gli [*attributi*](../secgloss/a-gly.md#_security_attribute_gly) del contesto stabilito.</span><span class="sxs-lookup"><span data-stu-id="790a1-239">A pointer to a variable to receive a set of bit flags that indicate the [*attributes*](../secgloss/a-gly.md#_security_attribute_gly) of the established context.</span></span> <span data-ttu-id="790a1-240">Per una descrizione dei vari attributi, vedere [requisiti di contesto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="790a1-240">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

<span data-ttu-id="790a1-241">I flag usati per questo parametro sono preceduti da ISC RET \_ , ad esempio ISC \_ ret \_ delegate.</span><span class="sxs-lookup"><span data-stu-id="790a1-241">Flags used for this parameter are prefixed with ISC\_RET, such as ISC\_RET\_DELEGATE.</span></span> <span data-ttu-id="790a1-242">Per un elenco di valori validi, vedere il parametro *fContextReq* .</span><span class="sxs-lookup"><span data-stu-id="790a1-242">For a list of valid values, see the *fContextReq* parameter.</span></span>

<span data-ttu-id="790a1-243">Non controllare gli attributi correlati alla sicurezza finché la chiamata di funzione finale non viene completata correttamente.</span><span class="sxs-lookup"><span data-stu-id="790a1-243">Do not check for security-related attributes until the final function call returns successfully.</span></span> <span data-ttu-id="790a1-244">I flag di attributo non correlati alla sicurezza, ad esempio il \_ flag ASC RET \_ allocazioned \_ Memory, possono essere controllati prima del ritorno finale.</span><span class="sxs-lookup"><span data-stu-id="790a1-244">Attribute flags that are not related to security, such as the ASC\_RET\_ALLOCATED\_MEMORY flag, can be checked before the final return.</span></span>

> [!Note]  
> <span data-ttu-id="790a1-245">Attributi di contesto specifici possono essere modificati durante la negoziazione con un peer remoto.</span><span class="sxs-lookup"><span data-stu-id="790a1-245">Particular context attributes can change during negotiation with a remote peer.</span></span>

 

</dd> <dt>

<span data-ttu-id="790a1-246">*ptsExpiry* \[ out, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="790a1-246">*ptsExpiry* \[out, optional\]</span></span>
</dt> <dd>

<span data-ttu-id="790a1-247">Puntatore a una struttura di [**timestamp**](timestamp.md) che riceve l'ora di scadenza del contesto.</span><span class="sxs-lookup"><span data-stu-id="790a1-247">A pointer to a [**TimeStamp**](timestamp.md) structure that receives the expiration time of the context.</span></span> <span data-ttu-id="790a1-248">È consigliabile che il [*pacchetto di sicurezza*](../secgloss/s-gly.md) restituisca sempre questo valore nell'ora locale.</span><span class="sxs-lookup"><span data-stu-id="790a1-248">It is recommended that the [*security package*](../secgloss/s-gly.md) always return this value in local time.</span></span> <span data-ttu-id="790a1-249">Questo parametro è facoltativo e deve essere passato **null** per i client di breve durata.</span><span class="sxs-lookup"><span data-stu-id="790a1-249">This parameter is optional and **NULL** should be passed for short-lived clients.</span></span>

<span data-ttu-id="790a1-250">Non esiste alcuna ora di scadenza per il [*contesto di sicurezza*](../secgloss/s-gly.md)o le credenziali di Microsoft Digest SSP.</span><span class="sxs-lookup"><span data-stu-id="790a1-250">There is no expiration time for Microsoft Digest SSP [*security context*](../secgloss/s-gly.md)s or credentials.</span></span>

</dd> </dl>

## <a name="return-value"></a><span data-ttu-id="790a1-251">Valore restituito</span><span class="sxs-lookup"><span data-stu-id="790a1-251">Return value</span></span>

<span data-ttu-id="790a1-252">Se la funzione ha esito positivo, la funzione restituisce uno dei seguenti codici di esito positivo.</span><span class="sxs-lookup"><span data-stu-id="790a1-252">If the function succeeds, the function returns one of the following success codes.</span></span>



| <span data-ttu-id="790a1-253">Codice restituito</span><span class="sxs-lookup"><span data-stu-id="790a1-253">Return code</span></span>                                                                                                    | <span data-ttu-id="790a1-254">Descrizione</span><span class="sxs-lookup"><span data-stu-id="790a1-254">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|----------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <dl> <span data-ttu-id="790a1-255"><dt>**SEC \_ \_ completamento \_ e \_ continuazione**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-255"><dt>**SEC\_I\_COMPLETE\_AND\_CONTINUE**</dt></span></span> </dl> | <span data-ttu-id="790a1-256">Il client deve chiamare [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) e quindi passare l'output al server.</span><span class="sxs-lookup"><span data-stu-id="790a1-256">The client must call [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) and then pass the output to the server.</span></span> <span data-ttu-id="790a1-257">Il client attende quindi un token restituito e lo passa, in un'altra chiamata, a [**InitializeSecurityContext (generale)**](initializesecuritycontext--general.md).</span><span class="sxs-lookup"><span data-stu-id="790a1-257">The client then waits for a returned token and passes it, in another call, to [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md).</span></span><br/>                                                                                                                                                                                                                                                                                     |
| <dl> <span data-ttu-id="790a1-258"><dt>**SEC \_ I \_ completamenti \_ necessari**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-258"><dt>**SEC\_I\_COMPLETE\_NEEDED**</dt></span></span> </dl>        | <span data-ttu-id="790a1-259">Il client deve completare la compilazione del messaggio e quindi chiamare la funzione [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) .</span><span class="sxs-lookup"><span data-stu-id="790a1-259">The client must finish building the message and then call the [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) function.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| <dl> <span data-ttu-id="790a1-260"><dt>**SEC \_ \_ continuazione \_ necessaria**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-260"><dt>**SEC\_I\_CONTINUE\_NEEDED**</dt></span></span> </dl>        | <span data-ttu-id="790a1-261">Il client deve inviare il token di output al server e attendere un token restituito.</span><span class="sxs-lookup"><span data-stu-id="790a1-261">The client must send the output token to the server and wait for a return token.</span></span> <span data-ttu-id="790a1-262">Il token restituito viene quindi passato in un'altra chiamata a [**InitializeSecurityContext (generale)**](initializesecuritycontext--general.md).</span><span class="sxs-lookup"><span data-stu-id="790a1-262">The returned token is then passed in another call to [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md).</span></span> <span data-ttu-id="790a1-263">Il token di output può essere vuoto.</span><span class="sxs-lookup"><span data-stu-id="790a1-263">The output token can be empty.</span></span><br/>                                                                                                                                                                                                                                                                                                          |
| <dl> <span data-ttu-id="790a1-264"><dt>**SECONDI \_ di \_ credenziali incomplete \_**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-264"><dt>**SEC\_I\_INCOMPLETE\_CREDENTIALS**</dt></span></span> </dl> | <span data-ttu-id="790a1-265">Usare con Schannel.</span><span class="sxs-lookup"><span data-stu-id="790a1-265">Use with Schannel.</span></span> <span data-ttu-id="790a1-266">Il server ha richiesto l'autenticazione client e le credenziali fornite non includono un certificato o il certificato non è stato emesso da un'autorità di certificazione considerata attendibile dal server.</span><span class="sxs-lookup"><span data-stu-id="790a1-266">The server has requested client authentication, and the supplied credentials either do not include a certificate or the certificate was not issued by a certification authority that is trusted by the server.</span></span> <span data-ttu-id="790a1-267">Per altre informazioni, vedere la sezione Osservazioni.</span><span class="sxs-lookup"><span data-stu-id="790a1-267">For more information, see Remarks.</span></span><br/>                                                                                                                                                                                              |
| <dl> <span data-ttu-id="790a1-268"><dt>**SEC \_ E \_ messaggio incompleto \_**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-268"><dt>**SEC\_E\_INCOMPLETE\_MESSAGE**</dt></span></span> </dl>     | <span data-ttu-id="790a1-269">Usare con Schannel.</span><span class="sxs-lookup"><span data-stu-id="790a1-269">Use with Schannel.</span></span> <span data-ttu-id="790a1-270">I dati per l'intero messaggio non sono stati letti dalla rete.</span><span class="sxs-lookup"><span data-stu-id="790a1-270">Data for the whole message was not read from the wire.</span></span><br/> <span data-ttu-id="790a1-271">Quando viene restituito questo valore, il buffer *Pinput* contiene una struttura [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) con un membro **BufferType** di **SecBuffer \_ mancante**.</span><span class="sxs-lookup"><span data-stu-id="790a1-271">When this value is returned, the *pInput* buffer contains a [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) structure with a **BufferType** member of **SECBUFFER\_MISSING**.</span></span> <span data-ttu-id="790a1-272">Il membro **cbBuffer** di **SecBuffer** contiene un valore che indica il numero di byte aggiuntivi che la funzione deve leggere dal client prima che questa funzione abbia esito positivo.</span><span class="sxs-lookup"><span data-stu-id="790a1-272">The **cbBuffer** member of **SecBuffer** contains a value that indicates the number of additional bytes that the function must read from the client before this function succeeds.</span></span> <span data-ttu-id="790a1-273">Anche se questo numero non è sempre accurato, l'uso di questo numero può contribuire a migliorare le prestazioni evitando più chiamate a questa funzione.</span><span class="sxs-lookup"><span data-stu-id="790a1-273">While this number is not always accurate, using it can help improve performance by avoiding multiple calls to this function.</span></span><br/> |
| <dl> <span data-ttu-id="790a1-274"><dt>**SEC \_ E \_ OK**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-274"><dt>**SEC\_E\_OK**</dt></span></span> </dl>                      | <span data-ttu-id="790a1-275">Il [*contesto di sicurezza*](../secgloss/s-gly.md) è stato inizializzato correttamente.</span><span class="sxs-lookup"><span data-stu-id="790a1-275">The [*security context*](../secgloss/s-gly.md) was successfully initialized.</span></span> <span data-ttu-id="790a1-276">Non è necessario eseguire un'altra chiamata a [**InitializeSecurityContext (generale)**](initializesecuritycontext--general.md) .</span><span class="sxs-lookup"><span data-stu-id="790a1-276">There is no need for another [**InitializeSecurityContext (General)**](initializesecuritycontext--general.md) call.</span></span> <span data-ttu-id="790a1-277">Se la funzione restituisce un token di output, ovvero se il token SECBUFFER \_ in *pOutput* è di lunghezza diversa da zero, il token deve essere inviato al server.</span><span class="sxs-lookup"><span data-stu-id="790a1-277">If the function returns an output token, that is, if the SECBUFFER\_TOKEN in *pOutput* is of nonzero length, that token must be sent to the server.</span></span><br/>                                                                                                                                                    |



 

<span data-ttu-id="790a1-278">Se la funzione ha esito negativo, la funzione restituisce uno dei codici di errore seguenti.</span><span class="sxs-lookup"><span data-stu-id="790a1-278">If the function fails, the function returns one of the following error codes.</span></span>



| <span data-ttu-id="790a1-279">Codice restituito</span><span class="sxs-lookup"><span data-stu-id="790a1-279">Return code</span></span>                                                                                                          | <span data-ttu-id="790a1-280">Descrizione</span><span class="sxs-lookup"><span data-stu-id="790a1-280">Description</span></span>                                                                                                                                                                                                                                                                                         |
|----------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <dl> <span data-ttu-id="790a1-281"><dt>**SEC \_ E \_ memoria insufficiente \_**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-281"><dt>**SEC\_E\_INSUFFICIENT\_MEMORY**</dt></span></span> </dl>          | <span data-ttu-id="790a1-282">La memoria disponibile non è sufficiente per completare l'azione richiesta.</span><span class="sxs-lookup"><span data-stu-id="790a1-282">There is not enough memory available to complete the requested action.</span></span><br/>                                                                                                                                                                                                                   |
| <dl> <span data-ttu-id="790a1-283"><dt>**\_ \_ errore interno sec \_ E**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-283"><dt>**SEC\_E\_INTERNAL\_ERROR**</dt></span></span> </dl>               | <span data-ttu-id="790a1-284">Si è verificato un errore che non è stato mappato a un codice di errore SSPI.</span><span class="sxs-lookup"><span data-stu-id="790a1-284">An error occurred that did not map to an SSPI error code.</span></span><br/>                                                                                                                                                                                                                                |
| <dl> <span data-ttu-id="790a1-285"><dt>**\_handle sec E \_ non valido \_**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-285"><dt>**SEC\_E\_INVALID\_HANDLE**</dt></span></span> </dl>               | <span data-ttu-id="790a1-286">L'handle passato alla funzione non è valido.</span><span class="sxs-lookup"><span data-stu-id="790a1-286">The handle passed to the function is not valid.</span></span><br/>                                                                                                                                                                                                                                          |
| <dl> <span data-ttu-id="790a1-287"><dt>**SEC \_ E \_ token non valido \_**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-287"><dt>**SEC\_E\_INVALID\_TOKEN**</dt></span></span> </dl>                | <span data-ttu-id="790a1-288">L'errore è dovuto a un token di input in formato non valido, ad esempio un token danneggiato in transito, un token di dimensioni non corrette o un token passato al [*pacchetto di sicurezza*](../secgloss/s-gly.md)errato.</span><span class="sxs-lookup"><span data-stu-id="790a1-288">The error is due to a malformed input token, such as a token corrupted in transit, a token of incorrect size, or a token passed into the wrong [*security package*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="790a1-289">Il passaggio di un token al pacchetto errato può verificarsi se il client e il server non hanno negoziato il [*pacchetto di sicurezza*](../secgloss/s-gly.md)appropriato.</span><span class="sxs-lookup"><span data-stu-id="790a1-289">Passing a token to the wrong package can happen if the client and server did not negotiate the proper [*security package*](../secgloss/s-gly.md).</span></span><br/> |
| <dl> <span data-ttu-id="790a1-290"><dt>**SEC \_ E \_ accesso \_ negato**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-290"><dt>**SEC\_E\_LOGON\_DENIED**</dt></span></span> </dl>                 | <span data-ttu-id="790a1-291">Accesso non riuscito.</span><span class="sxs-lookup"><span data-stu-id="790a1-291">The logon failed.</span></span><br/>                                                                                                                                                                                                                                                                        |
| <dl> <span data-ttu-id="790a1-292"><dt>**SEC \_ E \_ Nessuna \_ autorità di autenticazione \_**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-292"><dt>**SEC\_E\_NO\_AUTHENTICATING\_AUTHORITY**</dt></span></span> </dl> | <span data-ttu-id="790a1-293">Non è stato possibile contattare un'autorità per l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="790a1-293">No authority could be contacted for authentication.</span></span> <span data-ttu-id="790a1-294">Il nome di dominio dell'entità di autenticazione potrebbe essere errato, il dominio potrebbe non essere raggiungibile o potrebbe essersi verificato un errore di relazione di trust.</span><span class="sxs-lookup"><span data-stu-id="790a1-294">The domain name of the authenticating party could be wrong, the domain could be unreachable, or there might have been a trust relationship failure.</span></span><br/>                                                                                  |
| <dl> <span data-ttu-id="790a1-295"><dt>**SEC \_ E \_ Nessuna \_ credenziale**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-295"><dt>**SEC\_E\_NO\_CREDENTIALS**</dt></span></span> </dl>               | <span data-ttu-id="790a1-296">Nessuna credenziale disponibile nel [*pacchetto di sicurezza*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="790a1-296">No credentials are available in the [*security package*](../secgloss/s-gly.md).</span></span><br/>                                                                                                                                                  |
| <dl> <span data-ttu-id="790a1-297"><dt>**SEC \_ E \_ destinazione \_ sconosciuta**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-297"><dt>**SEC\_E\_TARGET\_UNKNOWN**</dt></span></span> </dl>               | <span data-ttu-id="790a1-298">La destinazione non è stata riconosciuta.</span><span class="sxs-lookup"><span data-stu-id="790a1-298">The target was not recognized.</span></span><br/>                                                                                                                                                                                                                                                           |
| <dl> <span data-ttu-id="790a1-299"><dt>**SEC \_ E \_ funzione non supportata \_**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-299"><dt>**SEC\_E\_UNSUPPORTED\_FUNCTION**</dt></span></span> </dl>         | <span data-ttu-id="790a1-300">Nel parametro FContextReq è stato specificato un flag di attributo di contesto non valido (ISC \_ req \_ delegate o ISC \_ req \_ prompt \_ per \_ credenziali). </span><span class="sxs-lookup"><span data-stu-id="790a1-300">A context attribute flag that is not valid (ISC\_REQ\_DELEGATE or ISC\_REQ\_PROMPT\_FOR\_CREDS) was specified in the *fContextReq* parameter.</span></span><br/>                                                                                                                                            |
| <dl> <span data-ttu-id="790a1-301"><dt>**SEC \_ E \_ entità errata \_**</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-301"><dt>**SEC\_E\_WRONG\_PRINCIPAL**</dt></span></span> </dl>              | <span data-ttu-id="790a1-302">L'entità che ha ricevuto la richiesta di autenticazione non corrisponde a quella passata nel parametro *pszTargetName* .</span><span class="sxs-lookup"><span data-stu-id="790a1-302">The principal that received the authentication request is not the same as the one passed into the *pszTargetName* parameter.</span></span> <span data-ttu-id="790a1-303">Ciò indica un errore durante l'autenticazione reciproca.</span><span class="sxs-lookup"><span data-stu-id="790a1-303">This indicates a failure in mutual authentication.</span></span><br/>                                                                                                          |



 

## <a name="remarks"></a><span data-ttu-id="790a1-304">Commenti</span><span class="sxs-lookup"><span data-stu-id="790a1-304">Remarks</span></span>

<span data-ttu-id="790a1-305">Il chiamante è responsabile di determinare se gli attributi di contesto finali sono sufficienti.</span><span class="sxs-lookup"><span data-stu-id="790a1-305">The caller is responsible for determining whether the final context attributes are sufficient.</span></span> <span data-ttu-id="790a1-306">Se, ad esempio, è stata richiesta la riservatezza, ma non è stato possibile stabilirlo, alcune applicazioni potrebbero scegliere di arrestare immediatamente la connessione.</span><span class="sxs-lookup"><span data-stu-id="790a1-306">If, for example, confidentiality was requested, but could not be established, some applications may choose to shut down the connection immediately.</span></span>

<span data-ttu-id="790a1-307">Se gli attributi del [*contesto di sicurezza*](../secgloss/s-gly.md) non sono sufficienti, il client deve liberare il contesto parzialmente creato chiamando la funzione [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="790a1-307">If attributes of the [*security context*](../secgloss/s-gly.md) are not sufficient, the client must free the partially created context by calling the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function.</span></span>

<span data-ttu-id="790a1-308">La funzione **InitializeSecurityContext (generale)** viene utilizzata da un client per inizializzare un contesto in uscita.</span><span class="sxs-lookup"><span data-stu-id="790a1-308">The **InitializeSecurityContext (General)** function is used by a client to initialize an outbound context.</span></span>

<span data-ttu-id="790a1-309">Per un [*contesto di sicurezza*](../secgloss/s-gly.md)a due gambe, la sequenza chiamante è la seguente:</span><span class="sxs-lookup"><span data-stu-id="790a1-309">For a two-leg [*security context*](../secgloss/s-gly.md), the calling sequence is as follows:</span></span>

1.  <span data-ttu-id="790a1-310">Il client chiama la funzione con *phContext* impostato su **null** e compila il descrittore del buffer con il messaggio di input.</span><span class="sxs-lookup"><span data-stu-id="790a1-310">The client calls the function with *phContext* set to **NULL** and fills in the buffer descriptor with the input message.</span></span>
2.  <span data-ttu-id="790a1-311">Il [*pacchetto di sicurezza*](../secgloss/s-gly.md) esamina i parametri e costruisce un token opaco, inserendolo nell'elemento token nella matrice di buffer.</span><span class="sxs-lookup"><span data-stu-id="790a1-311">The [*security package*](../secgloss/s-gly.md) examines the parameters and constructs an opaque token, placing it in the TOKEN element in the buffer array.</span></span> <span data-ttu-id="790a1-312">Se il parametro *fContextReq* include il \_ flag ISC \_ di allocazione della \_ memoria, il [*pacchetto di sicurezza*](../secgloss/s-gly.md) alloca la memoria e restituisce il puntatore nell'elemento token.</span><span class="sxs-lookup"><span data-stu-id="790a1-312">If the *fContextReq* parameter includes the ISC\_REQ\_ALLOCATE\_MEMORY flag, the [*security package*](../secgloss/s-gly.md) allocates the memory and returns the pointer in the TOKEN element.</span></span>
3.  <span data-ttu-id="790a1-313">Il client invia il token restituito nel buffer *pOutput* al server di destinazione.</span><span class="sxs-lookup"><span data-stu-id="790a1-313">The client sends the token returned in the *pOutput* buffer to the target server.</span></span> <span data-ttu-id="790a1-314">Il server passa quindi il token come argomento di input in una chiamata alla funzione [**AcceptSecurityContext (generale)**](acceptsecuritycontext--general.md) .</span><span class="sxs-lookup"><span data-stu-id="790a1-314">The server then passes the token as an input argument in a call to the [**AcceptSecurityContext (General)**](acceptsecuritycontext--general.md) function.</span></span>
4.  <span data-ttu-id="790a1-315">[**AcceptSecurityContext (generale)**](acceptsecuritycontext--general.md) può restituire un token, che il server invia al client per una seconda chiamata a **InitializeSecurityContext (generale)** se la prima chiamata ha restituito un secondo di cui è \_ \_ \_ necessario continuare.</span><span class="sxs-lookup"><span data-stu-id="790a1-315">[**AcceptSecurityContext (General)**](acceptsecuritycontext--general.md) may return a token, which the server sends to the client for a second call to **InitializeSecurityContext (General)** if the first call returned SEC\_I\_CONTINUE\_NEEDED.</span></span>

<span data-ttu-id="790a1-316">Per i [*contesti di sicurezza*](../secgloss/s-gly.md)a più gambe, ad esempio l'autenticazione reciproca, la sequenza chiamante è la seguente:</span><span class="sxs-lookup"><span data-stu-id="790a1-316">For multiple-leg [*security context*](../secgloss/s-gly.md)s, such as mutual authentication, the calling sequence is as follows:</span></span>

1.  <span data-ttu-id="790a1-317">Il client chiama la funzione come descritto in precedenza, ma il pacchetto restituisce il \_ \_ codice di \_ esito positivo continuo necessario.</span><span class="sxs-lookup"><span data-stu-id="790a1-317">The client calls the function as described earlier, but the package returns the SEC\_I\_CONTINUE\_NEEDED success code.</span></span>
2.  <span data-ttu-id="790a1-318">Il client invia il token di output al server e attende la risposta del server.</span><span class="sxs-lookup"><span data-stu-id="790a1-318">The client sends the output token to the server and waits for the server's reply.</span></span>
3.  <span data-ttu-id="790a1-319">Al momento della ricezione della risposta del server, il client chiama di nuovo **InitializeSecurityContext (General)** , con *phContext* impostato sull'handle restituito dall'ultima chiamata a.</span><span class="sxs-lookup"><span data-stu-id="790a1-319">Upon receipt of the server's response, the client calls **InitializeSecurityContext (General)** again, with *phContext* set to the handle that was returned from the last call.</span></span> <span data-ttu-id="790a1-320">Il token ricevuto dal server viene fornito nel parametro *Pinput* .</span><span class="sxs-lookup"><span data-stu-id="790a1-320">The token received from the server is supplied in the *pInput* parameter.</span></span>

<span data-ttu-id="790a1-321">Se il server ha risposto correttamente, il [*pacchetto di sicurezza*](../secgloss/s-gly.md) restituisce sec \_ e \_ OK e viene stabilita una sessione protetta.</span><span class="sxs-lookup"><span data-stu-id="790a1-321">If the server has successfully responded, the [*security package*](../secgloss/s-gly.md) returns SEC\_E\_OK and a secure session is established.</span></span>

<span data-ttu-id="790a1-322">Se la funzione restituisce una delle risposte di errore, la risposta del server non viene accettata e la sessione non viene stabilita.</span><span class="sxs-lookup"><span data-stu-id="790a1-322">If the function returns one of the error responses, the server's response is not accepted, and the session is not established.</span></span>

<span data-ttu-id="790a1-323">Se la funzione restituisce il secondo, è necessario continuare, il \_ \_ \_ secondo \_ \_ \_ è necessario, o sec \_ i \_ completati \_ e \_ continuano, i passaggi 2 e 3 vengono ripetuti.</span><span class="sxs-lookup"><span data-stu-id="790a1-323">If the function returns SEC\_I\_CONTINUE\_NEEDED, SEC\_I\_COMPLETE\_NEEDED, or SEC\_I\_COMPLETE\_AND\_CONTINUE, steps 2 and 3 are repeated.</span></span>

<span data-ttu-id="790a1-324">Per inizializzare un [*contesto di sicurezza*](../secgloss/s-gly.md), potrebbe essere necessaria più di una chiamata a questa funzione, a seconda del meccanismo di autenticazione sottostante, nonché delle opzioni specificate nel parametro *fContextReq* .</span><span class="sxs-lookup"><span data-stu-id="790a1-324">To initialize a [*security context*](../secgloss/s-gly.md), more than one call to this function may be required, depending on the underlying authentication mechanism as well as the choices specified in the *fContextReq* parameter.</span></span>

<span data-ttu-id="790a1-325">I parametri *fContextReq* e *pfContextAttributes* sono maschere di maschera che rappresentano vari attributi di contesto.</span><span class="sxs-lookup"><span data-stu-id="790a1-325">The *fContextReq* and *pfContextAttributes* parameters are bitmasks that represent various context attributes.</span></span> <span data-ttu-id="790a1-326">Per una descrizione dei vari attributi, vedere [requisiti di contesto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="790a1-326">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="790a1-327">Il parametro *pfContextAttributes* è valido in caso di esito positivo, ma solo in caso di esito positivo finale è possibile esaminare i flag relativi agli aspetti di sicurezza del contesto.</span><span class="sxs-lookup"><span data-stu-id="790a1-327">The *pfContextAttributes* parameter is valid on any successful return, but only on the final successful return should you examine the flags that pertain to security aspects of the context.</span></span> <span data-ttu-id="790a1-328">I ritorni intermedi possono impostare, ad esempio, \_ il \_ flag di memoria allocata RET di ISC \_ .</span><span class="sxs-lookup"><span data-stu-id="790a1-328">Intermediate returns can set, for example, the ISC\_RET\_ALLOCATED\_MEMORY flag.</span></span>

<span data-ttu-id="790a1-329">Se viene impostata la richiesta di \_ \_ utilizzo del \_ flag credenziali fornito da ISC \_ , il [*pacchetto di sicurezza*](../secgloss/s-gly.md) deve cercare un tipo di \_ buffer SECBUFFER pkg \_ params nel buffer di input *Pinput* .</span><span class="sxs-lookup"><span data-stu-id="790a1-329">If the ISC\_REQ\_USE\_SUPPLIED\_CREDS flag is set, the [*security package*](../secgloss/s-gly.md) must look for a SECBUFFER\_PKG\_PARAMS buffer type in the *pInput* input buffer.</span></span> <span data-ttu-id="790a1-330">Non si tratta di una soluzione generica, ma consente un forte accoppiamento del [*pacchetto di sicurezza*](../secgloss/s-gly.md) e dell'applicazione quando appropriato.</span><span class="sxs-lookup"><span data-stu-id="790a1-330">This is not a generic solution, but it allows for a strong pairing of [*security package*](../secgloss/s-gly.md) and application when appropriate.</span></span>

<span data-ttu-id="790a1-331">Se \_ \_ \_ è stata specificata la memoria di ISC req allocata, il chiamante deve liberare la memoria chiamando la funzione [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) .</span><span class="sxs-lookup"><span data-stu-id="790a1-331">If ISC\_REQ\_ALLOCATE\_MEMORY was specified, the caller must free the memory by calling the [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span>

<span data-ttu-id="790a1-332">Ad esempio, il token di input potrebbe essere la sfida di un gestore di LAN.</span><span class="sxs-lookup"><span data-stu-id="790a1-332">For example, the input token could be the challenge from a LAN Manager.</span></span> <span data-ttu-id="790a1-333">In questo caso, il token di output sarà la risposta crittografata NTLM alla richiesta di verifica.</span><span class="sxs-lookup"><span data-stu-id="790a1-333">In this case, the output token would be the NTLM-encrypted response to the challenge.</span></span>

<span data-ttu-id="790a1-334">L'azione eseguita dal client dipende dal codice restituito da questa funzione.</span><span class="sxs-lookup"><span data-stu-id="790a1-334">The action the client takes depends on the return code from this function.</span></span> <span data-ttu-id="790a1-335">Se il codice restituito è SEC \_ e \_ OK, non sarà prevista alcuna seconda chiamata **InitializeSecurityContext (generale)** e non sarà prevista alcuna risposta dal server.</span><span class="sxs-lookup"><span data-stu-id="790a1-335">If the return code is SEC\_E\_OK, there will be no second **InitializeSecurityContext (General)** call, and no response from the server is expected.</span></span> <span data-ttu-id="790a1-336">Se il codice restituito è SEC \_ \_ , continuerà a essere \_ necessario, il client aspetta un token in risposta dal server e lo passa in una seconda chiamata a **InitializeSecurityContext (generale)**.</span><span class="sxs-lookup"><span data-stu-id="790a1-336">If the return code is SEC\_I\_CONTINUE\_NEEDED, the client expects a token in response from the server and passes it in a second call to **InitializeSecurityContext (General)**.</span></span> <span data-ttu-id="790a1-337">Il \_ \_ \_ codice restituito necessario per il completamento del secondo indica che il client deve completare la compilazione del messaggio e chiamare la funzione [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) .</span><span class="sxs-lookup"><span data-stu-id="790a1-337">The SEC\_I\_COMPLETE\_NEEDED return code indicates that the client must finish building the message and call the [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) function.</span></span> <span data-ttu-id="790a1-338">Il \_ \_ \_ codice per il completamento e la \_ continuazione del codice incorpora entrambe le azioni.</span><span class="sxs-lookup"><span data-stu-id="790a1-338">The SEC\_I\_COMPLETE\_AND\_CONTINUE code incorporates both of these actions.</span></span>

<span data-ttu-id="790a1-339">Se **InitializeSecurityContext (General)** restituisce Success sulla prima (o solo) chiamata, il chiamante deve chiamare la funzione [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) sull'handle restituito, anche se la chiamata ha esito negativo in una fase successiva dello scambio di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="790a1-339">If **InitializeSecurityContext (General)** returns success on the first (or only) call, then the caller must eventually call the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function on the returned handle, even if the call fails on a later leg of the authentication exchange.</span></span>

<span data-ttu-id="790a1-340">Il client può chiamare nuovamente **InitializeSecurityContext (General)** dopo che è stato completato correttamente.</span><span class="sxs-lookup"><span data-stu-id="790a1-340">The client may call **InitializeSecurityContext (General)** again after it has completed successfully.</span></span> <span data-ttu-id="790a1-341">Indica al pacchetto di [*sicurezza*](../secgloss/s-gly.md) che si desidera una riautenticazione.</span><span class="sxs-lookup"><span data-stu-id="790a1-341">This indicates to the [*security package*](../secgloss/s-gly.md) that a reauthentication is wanted.</span></span>

<span data-ttu-id="790a1-342">I chiamanti in modalità kernel presentano le differenze seguenti: il nome di destinazione è una stringa [*Unicode*](../secgloss/u-gly.md) che deve essere allocata nella memoria virtuale usando [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc); non deve essere allocato dal pool.</span><span class="sxs-lookup"><span data-stu-id="790a1-342">Kernel mode callers have the following differences: the target name is a [*Unicode*](../secgloss/u-gly.md) string that must be allocated in virtual memory by using [**VirtualAlloc**](/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc); it must not be allocated from the pool.</span></span> <span data-ttu-id="790a1-343">I buffer passati e specificati in *Pinput* e *pOutput* devono trovarsi nella memoria virtuale, non nel pool.</span><span class="sxs-lookup"><span data-stu-id="790a1-343">Buffers passed and supplied in *pInput* and *pOutput* must be in virtual memory, not in the pool.</span></span>

<span data-ttu-id="790a1-344">Quando si usa SSP Schannel, se la funzione restituisce le \_ \_ credenziali incomplete del secondo \_ , verificare di aver specificato un certificato valido e attendibile nelle credenziali.</span><span class="sxs-lookup"><span data-stu-id="790a1-344">When using the Schannel SSP, if the function returns SEC\_I\_INCOMPLETE\_CREDENTIALS, check that you specified a valid and trusted certificate in your credentials.</span></span> <span data-ttu-id="790a1-345">Il certificato viene specificato quando si chiama la funzione [**AcquireCredentialsHandle (generale)**](acquirecredentialshandle--general.md) .</span><span class="sxs-lookup"><span data-stu-id="790a1-345">The certificate is specified when calling the [**AcquireCredentialsHandle (General)**](acquirecredentialshandle--general.md) function.</span></span> <span data-ttu-id="790a1-346">Il certificato deve essere un certificato di autenticazione client emesso da un'autorità di certificazione (CA) considerata attendibile dal server.</span><span class="sxs-lookup"><span data-stu-id="790a1-346">The certificate must be a client authentication certificate issued by a certification authority (CA) trusted by the server.</span></span> <span data-ttu-id="790a1-347">Per ottenere un elenco delle CA considerate attendibili dal server, chiamare la funzione [**QueryContextAttributes (General)**](querycontextattributes--general.md) e specificare l' \_ attributo SECPKG attr \_ Issuer \_ List \_ ex.</span><span class="sxs-lookup"><span data-stu-id="790a1-347">To obtain a list of the CAs trusted by the server, call the [**QueryContextAttributes (General)**](querycontextattributes--general.md) function and specify the SECPKG\_ATTR\_ISSUER\_LIST\_EX attribute.</span></span>

<span data-ttu-id="790a1-348">Quando si usa SSP Schannel, dopo che un'applicazione client ha ricevuto un certificato di autenticazione da un'autorità di certificazione considerata attendibile dal server, l'applicazione crea una nuova credenziale chiamando la funzione [**AcquireCredentialsHandle (generale)**](acquirecredentialshandle--general.md) e chiamando di nuovo **InitializeSecurityContext (General)** , specificando la nuova credenziale nel parametro *phCredential* .</span><span class="sxs-lookup"><span data-stu-id="790a1-348">When using the Schannel SSP, after a client application receives an authentication certificate from a CA that is trusted by the server, the application creates a new credential by calling the [**AcquireCredentialsHandle (General)**](acquirecredentialshandle--general.md) function and then calling **InitializeSecurityContext (General)** again, specifying the new credential in the *phCredential* parameter.</span></span>

## <a name="requirements"></a><span data-ttu-id="790a1-349">Requisiti</span><span class="sxs-lookup"><span data-stu-id="790a1-349">Requirements</span></span>



| <span data-ttu-id="790a1-350">Requisito</span><span class="sxs-lookup"><span data-stu-id="790a1-350">Requirement</span></span> | <span data-ttu-id="790a1-351">Valore</span><span class="sxs-lookup"><span data-stu-id="790a1-351">Value</span></span> |
|-------------------------------------|--------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="790a1-352">Client minimo supportato</span><span class="sxs-lookup"><span data-stu-id="790a1-352">Minimum supported client</span></span><br/> | <span data-ttu-id="790a1-353">\[Solo app desktop Windows XP\]</span><span class="sxs-lookup"><span data-stu-id="790a1-353">Windows XP \[desktop apps only\]</span></span><br/>                                                            |
| <span data-ttu-id="790a1-354">Server minimo supportato</span><span class="sxs-lookup"><span data-stu-id="790a1-354">Minimum supported server</span></span><br/> | <span data-ttu-id="790a1-355">\[Solo app desktop Windows Server 2003\]</span><span class="sxs-lookup"><span data-stu-id="790a1-355">Windows Server 2003 \[desktop apps only\]</span></span><br/>                                                   |
| <span data-ttu-id="790a1-356">Intestazione</span><span class="sxs-lookup"><span data-stu-id="790a1-356">Header</span></span><br/>                   | <dl> <span data-ttu-id="790a1-357"><dt>SSPI. h (include Security. h)</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-357"><dt>Sspi.h (include Security.h)</dt></span></span> </dl> |
| <span data-ttu-id="790a1-358">Libreria</span><span class="sxs-lookup"><span data-stu-id="790a1-358">Library</span></span><br/>                  | <dl> <span data-ttu-id="790a1-359"><dt>Secur32. lib</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-359"><dt>Secur32.lib</dt></span></span> </dl>                 |
| <span data-ttu-id="790a1-360">DLL</span><span class="sxs-lookup"><span data-stu-id="790a1-360">DLL</span></span><br/>                      | <dl> <span data-ttu-id="790a1-361"><dt>Secur32.dll</dt></span><span class="sxs-lookup"><span data-stu-id="790a1-361"><dt>Secur32.dll</dt></span></span> </dl>                 |
| <span data-ttu-id="790a1-362">Nomi Unicode e ANSI</span><span class="sxs-lookup"><span data-stu-id="790a1-362">Unicode and ANSI names</span></span><br/>   | <span data-ttu-id="790a1-363">**InitializeSecurityContextW** (Unicode) e **InitializeSecurityContextA** (ANSI)</span><span class="sxs-lookup"><span data-stu-id="790a1-363">**InitializeSecurityContextW** (Unicode) and **InitializeSecurityContextA** (ANSI)</span></span><br/>          |



## <a name="see-also"></a><span data-ttu-id="790a1-364">Vedi anche</span><span class="sxs-lookup"><span data-stu-id="790a1-364">See also</span></span>

<dl> <dt>

[<span data-ttu-id="790a1-365">Funzioni SSPI</span><span class="sxs-lookup"><span data-stu-id="790a1-365">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
</dt> <dt>

[<span data-ttu-id="790a1-366">**AcceptSecurityContext (generale)**</span><span class="sxs-lookup"><span data-stu-id="790a1-366">**AcceptSecurityContext (General)**</span></span>](acceptsecuritycontext--general.md)
</dt> <dt>

[<span data-ttu-id="790a1-367">**AcquireCredentialsHandle (generale)**</span><span class="sxs-lookup"><span data-stu-id="790a1-367">**AcquireCredentialsHandle (General)**</span></span>](acquirecredentialshandle--general.md)
</dt> <dt>

[<span data-ttu-id="790a1-368">**CompleteAuthToken**</span><span class="sxs-lookup"><span data-stu-id="790a1-368">**CompleteAuthToken**</span></span>](/windows/win32/api/sspi/nf-sspi-completeauthtoken)
</dt> <dt>

[<span data-ttu-id="790a1-369">**DeleteSecurityContext**</span><span class="sxs-lookup"><span data-stu-id="790a1-369">**DeleteSecurityContext**</span></span>](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
</dt> <dt>

[<span data-ttu-id="790a1-370">**FreeContextBuffer**</span><span class="sxs-lookup"><span data-stu-id="790a1-370">**FreeContextBuffer**</span></span>](/windows/win32/api/sspi/nf-sspi-freecontextbuffer)
</dt> <dt>

[<span data-ttu-id="790a1-371">**SecBuffer**</span><span class="sxs-lookup"><span data-stu-id="790a1-371">**SecBuffer**</span></span>](/windows/win32/api/sspi/ns-sspi-secbuffer)
</dt> <dt>

[<span data-ttu-id="790a1-372">**SecBufferDesc**</span><span class="sxs-lookup"><span data-stu-id="790a1-372">**SecBufferDesc**</span></span>](/windows/win32/api/sspi/ns-sspi-secbufferdesc)
</dt> </dl>

 

 
