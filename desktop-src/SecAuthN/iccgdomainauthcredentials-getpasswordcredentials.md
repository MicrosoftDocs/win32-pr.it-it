---
description: Restituisce le credenziali per autenticare un contenitore non appartenente a un dominio con Active Directory.
title: 'Metodo ICcgDomainAuthCredentials:: GetPasswordCredentials (ccgplugins. h)'
ms.topic: reference
ms.date: 10/21/2020
topic_type:
- APIRef
- kbSyntax
api_name:
- ICcgDomainAuthCredentials.GetPasswordCredentials
api_type:
- COM
api_location:
- ccgplugins.h
ms.openlocfilehash: abd70a109e491773b374ae32787760d265167baa
ms.sourcegitcommit: c8ec1ded1ffffc364d3c4f560bb2171da0dc5040
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/22/2021
ms.locfileid: "106328431"
---
# <a name="iccgdomainauthcredentialsgetpasswordcredentials-method"></a>Metodo ICcgDomainAuthCredentials:: GetPasswordCredentials

Restituisce le credenziali per autenticare un contenitore non appartenente a un dominio con Active Directory.

## <a name="syntax"></a>Sintassi


```C++
HRESULT GetPasswordCredentials(
[in] LPCWSTR pluginInput, 
[out] LPWSTR* domainName, 
[out] LPWSTR* username, 
[out] LPWSTR* password);
);
```



## <a name="parameters"></a>Parametri

<dl> <dt>

*pluginInput* \[ in\]
</dt> <dd>

Stringa di input passata dal runtime del contenitore. L'implementazione client utilizza la stringa di input fornita per recuperare le credenziali di autenticazione, in genere da un provider di archiviazione protetta, restituite nei parametri di output. La stringa di input viene fornita ai servizi di calcolo host (HCS) in un file di specifica delle credenziali. Per ulteriori informazioni, vedere la sezione **osservazioni** .

</dd> </dl>

<dl> <dt>

*NomeDominio* \[ out\]
</dt> <dd>

Nome di dominio per le credenziali.

</dd> </dl>

<dl> <dt>

*nome utente* \[ out\]
</dt> <dd>

Nome utente per le credenziali.

</dd> </dl>

<dl> <dt>

*password* \[ di out\]
</dt> <dd>

Password per le credenziali.

</dd> </dl>

## <a name="return-value"></a>Valore restituito

Il valore restituito è un valore **HRESULT**. Il valore S \_ OK indica che la chiamata è stata eseguita correttamente.

## <a name="remarks"></a>Commenti

L'API può essere chiamata simultaneamente. Pertanto, lo sviluppatore deve garantire che la loro implementazione sia thread-safe. Inoltre, l'oggetto COM verrà attivato out-of-process e deve essere registrato in modo appropriato. 

L'implementatore deve aggiungere una chiave in "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\CCG\COMClasses" per il relativo CLSID COM. L'accesso in scrittura a "CCG\COMClasses" è limitato agli account di sistema e amministratore. 

Di seguito è riportato un esempio di file di specifica delle credenziali. Per informazioni su come fornire questo file a Docker, vedere [eseguire un contenitore con un gMSA](/virtualization/windowscontainers/manage-containers/gmsa-run-container).

```json
{
    "CmsPlugins": [
        "ActiveDirectory"
    ],
    "DomainJoinConfig": {
        "Sid": "S-1-5-21-3700119848-2853083131-2094573802",
        "MachineAccountName": "gmsa1",
        "Guid": "630a7dd3-2d3e-4471-ae91-1d9ea2556cd5",
        "DnsTreeName": "contoso.com",
        "DnsName": "contoso.com",
        "NetBiosName": "CONTOSO"
    },
    "ActiveDirectoryConfig": {
        "GroupManagedServiceAccounts": [
            {
                "Name": "gmsa1",
                "Scope": "contoso.com"
            },
            {
                "Name": "gmsa1",
                "Scope": "CONTOSO"
            }
        ],
        "HostAccountConfig": {
            "PortableCcgVersion": "1",
            "PluginGUID": "{CFCA0441-511D-4B2A-862E-20348A78760B}",
            "PluginInput": "contoso.com:gmsaccg:<password>"
        }
    }
}

```

## <a name="examples"></a>Esempio

Nell'esempio seguente viene illustrata un'implementazione semplice di **ICcgDomainAuthCredentials**. Si noti che, a scopo illustrativo, questo esempio ottiene le credenziali semplicemente analizzando la stringa di input. Un'implementazione reale archivia le credenziali in un archivio dati protetto e usa la stringa di input per individuare le informazioni sulle credenziali. Inoltre, le implementazioni del metodo COM standard sono state omesse dall'esempio per brevità.


```C++
// UUID generated by the developer
[uuid("cfca0441-511d-4b2a-862e-20348a78760b")] 
class CCGStubPlugin : public RuntimeClass<RuntimeClassFlags<RuntimeClassType::ClassicCom>, ICcgDomainAuthCredentials >
{
   public:
    CCGStubPlugin() {}

    ~CCGStubPlugin() {}

    IFACEMETHODIMP GetPasswordCredentials(
        _In_ LPCWSTR pluginInput,
        _Outptr_ LPWSTR *domainName,
        _Outptr_ LPWSTR *username,
        _Outptr_ LPWSTR *password)
    {
        std::wstring domainParsed, userParsed, passwordParsed; 
        try
        {
            if(domainName == NULL || username == NULL || password == NULL)
            {
                return STG_E_INVALIDPARAMETER;
            }
            *domainName = NULL;
            *username = NULL;
            *password = NULL;
            wstring pluginInputString(pluginInput);
            if (count(pluginInputString.begin(), pluginInputString.end(), ':') < 2)
            {
                return CO_E_NOT_SUPPORTED;
            }
            // Extract creds of this format Domain:Username:Password
            size_t sep1 = pluginInputString.find(L":");
            size_t sep2 = pluginInputString.find(L":", sep1 + 1);
            domainParsed = pluginInputString.substr(0, sep1);
            userParsed = pluginInputString.substr(sep1 + 1, sep2 - sep1 - 1);
            passwordParsed = pluginInputString.substr(sep2 + 1);
        }
        catch (...)
        {
            return EVENT_E_INTERNALERROR;
        }

        auto userCo = wil::make_cotaskmem_string_nothrow(userParsed.c_str());
        auto passwordCo = wil::make_cotaskmem_string_nothrow(passwordParsed.c_str());
        auto domainCo = wil::make_cotaskmem_string_nothrow(domainParsed.c_str());
        if (userCo == nullptr || passwordCo == nullptr || domainCo == nullptr)
        {
            return STG_E_INSUFFICIENTMEMORY;
        }

        *domainName = domainCo.release();
        *username = userCo.release();
        *password = passwordCo.release();
        return S_OK;
    }
};
CoCreatableClass(CCGStubPlugin);

```



## <a name="requirements"></a>Requisiti




| Requisito | Valore |
|-------------------------------------|-----------------------------------------------------------------------------------------|
| Server minimo supportato | Windows Server, versione 2004                                    |
| Intestazione                   | ccgplugins. h   |
| IID                    | 6ecda518-2010-4437-8bc3-46e752b7b172          |



 

