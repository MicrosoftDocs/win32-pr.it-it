---
description: La comunicazione comporta spesso grandi quantità di dati o dati di lunghezza sconosciuta.
ms.assetid: e7b12b9e-8caa-4dad-b81f-b609ccb92c9f
title: Uso di SecBufferDesc e SecBuffer
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ca7d8155a610263838d2baf2a7d1c8fc96ec874
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "103883881"
---
# <a name="using-secbufferdesc-and-secbuffer"></a><span data-ttu-id="e5a33-103">Uso di SecBufferDesc e SecBuffer</span><span class="sxs-lookup"><span data-stu-id="e5a33-103">Using SecBufferDesc and SecBuffer</span></span>

<span data-ttu-id="e5a33-104">La comunicazione comporta spesso grandi quantità di dati o dati di lunghezza sconosciuta.</span><span class="sxs-lookup"><span data-stu-id="e5a33-104">Communication often involves potentially large amounts of data or data of unknown length.</span></span> <span data-ttu-id="e5a33-105">L'invio e la ricezione di dati vengono eseguiti in modo analogo o identico in entrambi i casi.</span><span class="sxs-lookup"><span data-stu-id="e5a33-105">Sending and receiving data is done in similar or identical fashion in both of these cases.</span></span> <span data-ttu-id="e5a33-106">Per gestire la lunghezza sconosciuta e potenzialmente grandi quantità di dati, la comunicazione SSPI viene eseguita utilizzando due strutture, [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) e [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer).</span><span class="sxs-lookup"><span data-stu-id="e5a33-106">To deal with unknown length and potentially large amounts of data, SSPI communication is done using two structures, [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) and [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer).</span></span>

<span data-ttu-id="e5a33-107">Una struttura [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) è un contenitore per una matrice di strutture [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="e5a33-107">A [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) structure is a container for an array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures.</span></span> <span data-ttu-id="e5a33-108">Una struttura **SecBufferDesc** dispone dei seguenti membri:</span><span class="sxs-lookup"><span data-stu-id="e5a33-108">A **SecBufferDesc** structure has the following members:</span></span>

-   <span data-ttu-id="e5a33-109">Numero di versione</span><span class="sxs-lookup"><span data-stu-id="e5a33-109">Version number</span></span>
-   <span data-ttu-id="e5a33-110">Numero di elementi [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer)</span><span class="sxs-lookup"><span data-stu-id="e5a33-110">Number of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) elements</span></span>
-   <span data-ttu-id="e5a33-111">Indirizzo della matrice di strutture [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer)</span><span class="sxs-lookup"><span data-stu-id="e5a33-111">Address of the array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures</span></span>

<span data-ttu-id="e5a33-112">Una struttura [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) contiene i tre membri seguenti:</span><span class="sxs-lookup"><span data-stu-id="e5a33-112">A [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structure contains the following three members:</span></span>

-   <span data-ttu-id="e5a33-113">Numero di byte nel buffer</span><span class="sxs-lookup"><span data-stu-id="e5a33-113">Number of bytes in the buffer</span></span>
-   <span data-ttu-id="e5a33-114">Tipo di informazioni contenute nell'elemento dati</span><span class="sxs-lookup"><span data-stu-id="e5a33-114">Type of information contained in the data item</span></span>
-   <span data-ttu-id="e5a33-115">Byte stessi</span><span class="sxs-lookup"><span data-stu-id="e5a33-115">The bytes themselves</span></span>

<span data-ttu-id="e5a33-116">Un intero messaggio SSPI è spesso costituito da una matrice di strutture [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="e5a33-116">A whole SSPI message often consists of an array of [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) structures.</span></span>

<span data-ttu-id="e5a33-117">I tipi di dati del buffer seguenti sono definiti nel modo seguente.</span><span class="sxs-lookup"><span data-stu-id="e5a33-117">The following buffer data types are defined as follows.</span></span>



| <span data-ttu-id="e5a33-118">Tipo di buffer</span><span class="sxs-lookup"><span data-stu-id="e5a33-118">Buffer type</span></span>                | <span data-ttu-id="e5a33-119">Significato</span><span class="sxs-lookup"><span data-stu-id="e5a33-119">Meaning</span></span>                                                                                                                                |
|----------------------------|----------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="e5a33-120">SECBUFFER \_ vuoto</span><span class="sxs-lookup"><span data-stu-id="e5a33-120">SECBUFFER\_EMPTY</span></span>           | <span data-ttu-id="e5a33-121">Non definito, sostituito dalla funzione del [*pacchetto di sicurezza*](../secgloss/s-gly.md)</span><span class="sxs-lookup"><span data-stu-id="e5a33-121">Undefined, replaced by the [*security package*](../secgloss/s-gly.md) function</span></span> |
| <span data-ttu-id="e5a33-122">\_dati SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="e5a33-122">SECBUFFER\_DATA</span></span>            | <span data-ttu-id="e5a33-123">Dati dei pacchetti</span><span class="sxs-lookup"><span data-stu-id="e5a33-123">Packet data</span></span>                                                                                                                            |
| <span data-ttu-id="e5a33-124">\_token SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="e5a33-124">SECBUFFER\_TOKEN</span></span>           | <span data-ttu-id="e5a33-125">Token di sicurezza</span><span class="sxs-lookup"><span data-stu-id="e5a33-125">Security token</span></span>                                                                                                                         |
| <span data-ttu-id="e5a33-126">\_parametri pkg \_ SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="e5a33-126">SECBUFFER\_PKG\_PARAMS</span></span>     | <span data-ttu-id="e5a33-127">Parametri specifici del pacchetto</span><span class="sxs-lookup"><span data-stu-id="e5a33-127">Package-specific parameters</span></span>                                                                                                            |
| <span data-ttu-id="e5a33-128">SECBUFFER \_ mancante</span><span class="sxs-lookup"><span data-stu-id="e5a33-128">SECBUFFER\_MISSING</span></span>         | <span data-ttu-id="e5a33-129">Indicatore dati mancante</span><span class="sxs-lookup"><span data-stu-id="e5a33-129">Missing data indicator</span></span>                                                                                                                 |
| <span data-ttu-id="e5a33-130">SECBUFFER \_ extra</span><span class="sxs-lookup"><span data-stu-id="e5a33-130">SECBUFFER\_EXTRA</span></span>           | <span data-ttu-id="e5a33-131">Dati aggiuntivi</span><span class="sxs-lookup"><span data-stu-id="e5a33-131">Extra data</span></span>                                                                                                                             |
| <span data-ttu-id="e5a33-132">\_flusso SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="e5a33-132">SECBUFFER\_STREAM</span></span>          | <span data-ttu-id="e5a33-133">Dati del flusso di sicurezza</span><span class="sxs-lookup"><span data-stu-id="e5a33-133">Security stream data</span></span>                                                                                                                   |
| <span data-ttu-id="e5a33-134">\_trailer del flusso SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="e5a33-134">SECBUFFER\_STREAM\_TRAILER</span></span> | <span data-ttu-id="e5a33-135">Trailer del flusso di sicurezza</span><span class="sxs-lookup"><span data-stu-id="e5a33-135">Security stream trailer</span></span>                                                                                                                |
| <span data-ttu-id="e5a33-136">\_intestazione del flusso SECBUFFER \_</span><span class="sxs-lookup"><span data-stu-id="e5a33-136">SECBUFFER\_STREAM\_HEADER</span></span>  | <span data-ttu-id="e5a33-137">Intestazione del flusso di sicurezza</span><span class="sxs-lookup"><span data-stu-id="e5a33-137">Security stream header</span></span>                                                                                                                 |



 

<span data-ttu-id="e5a33-138">I tipi di buffer precedenti possono essere combinati utilizzando un'**operazione OR bit per** bit con uno dei seguenti tipi di buffer.</span><span class="sxs-lookup"><span data-stu-id="e5a33-138">The buffer types above can be combined using a bitwise-**OR** operation with either of the following buffer types.</span></span>



| <span data-ttu-id="e5a33-139">Tipo di buffer</span><span class="sxs-lookup"><span data-stu-id="e5a33-139">Buffer type</span></span>         | <span data-ttu-id="e5a33-140">Significato</span><span class="sxs-lookup"><span data-stu-id="e5a33-140">Meaning</span></span>                                                                          |
|---------------------|----------------------------------------------------------------------------------|
| <span data-ttu-id="e5a33-141">\_ATTRMASK SECBUFFER</span><span class="sxs-lookup"><span data-stu-id="e5a33-141">SECBUFFER\_ATTRMASK</span></span> | <span data-ttu-id="e5a33-142">Mascherare gli attributi di sicurezza separando i flag di attributo dal tipo di buffer.</span><span class="sxs-lookup"><span data-stu-id="e5a33-142">Mask security attributes by separating the attribute flags from the buffer type.</span></span> |
| <span data-ttu-id="e5a33-143">SECBUFFER \_ ReadOnly</span><span class="sxs-lookup"><span data-stu-id="e5a33-143">SECBUFFER\_READONLY</span></span> | <span data-ttu-id="e5a33-144">Il buffer è di sola lettura</span><span class="sxs-lookup"><span data-stu-id="e5a33-144">Buffer is read-only</span></span>                                                              |



 

<span data-ttu-id="e5a33-145">Prima di ogni chiamata a un'API SSPI che richiede un parametro [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) , vengono dichiarati e inizializzati uno o più elementi della matrice [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="e5a33-145">Before each call to an SSPI API that requires a [**SecBufferDesc**](/windows/desktop/api/Sspi/ns-sspi-secbufferdesc) parameter, one or more [**SecBuffer**](/windows/desktop/api/Sspi/ns-sspi-secbuffer) array elements are declared and initialized.</span></span> <span data-ttu-id="e5a33-146">Ad esempio, possono essere presenti due buffer di sicurezza: uno contenente i dati del messaggio di input e l'altro per il token di sicurezza opaco di output restituito dal pacchetto di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="e5a33-146">For example, there can be two security buffers: one that contains input message data and the other for the output opaque security token returned by the security package.</span></span> <span data-ttu-id="e5a33-147">L'ordine dei buffer di sicurezza nel descrittore del buffer di sicurezza non è importante, ma ogni buffer deve essere contrassegnato con il tipo appropriato.</span><span class="sxs-lookup"><span data-stu-id="e5a33-147">The order of security buffers in the security buffer descriptor is not important, but each buffer must be tagged with its appropriate type.</span></span> <span data-ttu-id="e5a33-148">Un tag di sola lettura può essere utilizzato con qualsiasi buffer di input che non deve essere modificato dal [*pacchetto di sicurezza*](../secgloss/s-gly.md).</span><span class="sxs-lookup"><span data-stu-id="e5a33-148">A read-only tag can be used with any input buffer that must not be modified by the [*security package*](../secgloss/s-gly.md).</span></span>

<span data-ttu-id="e5a33-149">La dimensione del buffer di output che dovrebbe contenere il token di sicurezza è importante.</span><span class="sxs-lookup"><span data-stu-id="e5a33-149">The size of the output buffer that is expected to contain the security token is important.</span></span> <span data-ttu-id="e5a33-150">Un'applicazione è in grado di trovare le dimensioni massime del token per un pacchetto di sicurezza durante l'installazione iniziale.</span><span class="sxs-lookup"><span data-stu-id="e5a33-150">An application can find the maximum token size for a security package during initial setup.</span></span> <span data-ttu-id="e5a33-151">La chiamata a [**EnumerateSecurityPackages**](/windows/desktop/api/Sspi/nf-sspi-enumeratesecuritypackagesa) restituisce una matrice di puntatori alle informazioni sui pacchetti di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="e5a33-151">The call to [**EnumerateSecurityPackages**](/windows/desktop/api/Sspi/nf-sspi-enumeratesecuritypackagesa) returns an array of pointers to security package information.</span></span> <span data-ttu-id="e5a33-152">La struttura delle informazioni del pacchetto di sicurezza contiene le dimensioni massime del token per ogni pacchetto.</span><span class="sxs-lookup"><span data-stu-id="e5a33-152">The security package information structure contains the maximum token size for each package.</span></span> <span data-ttu-id="e5a33-153">Nell'esempio le informazioni sono contenute nel membro **cbMaxToken** della struttura [**SecPkgInfo**](/windows/desktop/api/Sspi/ns-sspi-secpkginfoa) .</span><span class="sxs-lookup"><span data-stu-id="e5a33-153">In the example, the information is in the **cbMaxToken** member of the [**SecPkgInfo**](/windows/desktop/api/Sspi/ns-sspi-secpkginfoa) structure.</span></span> <span data-ttu-id="e5a33-154">Le stesse informazioni possono essere ottenute in un secondo momento usando [**QuerySecurityPackageInfo**](/windows/desktop/api/Sspi/nf-sspi-querysecuritypackageinfoa).</span><span class="sxs-lookup"><span data-stu-id="e5a33-154">The same information can be obtained later using [**QuerySecurityPackageInfo**](/windows/desktop/api/Sspi/nf-sspi-querysecuritypackageinfoa).</span></span>

<span data-ttu-id="e5a33-155">L'applicazione Inizializza i puntatori e le dimensioni del buffer nella descrizione del buffer per indicare dove è possibile trovare i dati del messaggio e altre informazioni.</span><span class="sxs-lookup"><span data-stu-id="e5a33-155">The application initializes the buffer pointers and sizes in the buffer description to indicate where message data and other information can be found.</span></span>

<span data-ttu-id="e5a33-156">Per informazioni dettagliate, vedere il [codice di esempio SecBuffer e SecBufferDesc](secbuffer-and-secbufferdesc-example-code.md).</span><span class="sxs-lookup"><span data-stu-id="e5a33-156">For details, see [SecBuffer and SecBufferDesc Example Code](secbuffer-and-secbufferdesc-example-code.md).</span></span>

 

 
