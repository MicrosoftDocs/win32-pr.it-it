---
description: Consente al componente server di un'applicazione di trasporto di stabilire un contesto di sicurezza tra il server e un client remoto.
ms.assetid: a53f733e-b646-4431-b021-a2c446308849
title: Funzione AcceptSecurityContext (CredSSP)
ms.topic: article
ms.date: 07/25/2019
ms.openlocfilehash: 681e03ea15729cc8726d63551e8b7b0a2b39ecac
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106312829"
---
# <a name="acceptsecuritycontext-credssp-function"></a><span data-ttu-id="12b32-103">Funzione AcceptSecurityContext (CredSSP)</span><span class="sxs-lookup"><span data-stu-id="12b32-103">AcceptSecurityContext (CredSSP) function</span></span>

<span data-ttu-id="12b32-104">La funzione **AcceptSecurityContext (CredSSP)** consente al componente server di un'applicazione di trasporto di stabilire un contesto di sicurezza tra il server e un client remoto.</span><span class="sxs-lookup"><span data-stu-id="12b32-104">The **AcceptSecurityContext (CredSSP)** function lets the server component of a transport application establish a security context between the server and a remote client.</span></span> <span data-ttu-id="12b32-105">Il client remoto chiama la funzione [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) per avviare il processo di creazione di un contesto di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="12b32-105">The remote client calls the [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) function to start the process of establishing a security context.</span></span> <span data-ttu-id="12b32-106">Il server può richiedere uno o più token di risposta dal client remoto per completare la creazione del contesto di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="12b32-106">The server can require one or more reply tokens from the remote client to complete establishing the security context.</span></span>

## <a name="syntax"></a><span data-ttu-id="12b32-107">Sintassi</span><span class="sxs-lookup"><span data-stu-id="12b32-107">Syntax</span></span>

```C++
SECURITY_STATUS SEC_ENTRY AcceptSecurityContext(
  _In_opt_    PCredHandle    phCredential,
  _In_opt_    PCtxtHandle    phContext,
  _In_opt_    PSecBufferDesc pInput,
  _In_        unsigned long  fContextReq,
  _In_        unsigned long  TargetDataRep,
  _Inout_opt_ PCtxtHandle    phNewContext,
  _Inout_opt_ PSecBufferDesc pOutput,
  _Out_       unsigned long  *pfContextAttr,
  _Out_opt_   PTimeStamp     ptsExpiry
);
```

## <a name="parameters"></a><span data-ttu-id="12b32-108">Parametri</span><span class="sxs-lookup"><span data-stu-id="12b32-108">Parameters</span></span>

<span data-ttu-id="12b32-109">*phCredential* \[ in, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="12b32-109">*phCredential* \[in, optional\]</span></span>

<span data-ttu-id="12b32-110">Handle per le credenziali del server.</span><span class="sxs-lookup"><span data-stu-id="12b32-110">A handle to the server credentials.</span></span> <span data-ttu-id="12b32-111">Per recuperare questo handle, il server chiama la funzione [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) con SECPKG cred in \_ \_ ingresso o SECPKG \_ cred \_ entrambi impostati flag.</span><span class="sxs-lookup"><span data-stu-id="12b32-111">To retrieve this handle, the server calls the [**AcquireCredentialsHandle (CredSSP)**](acquirecredentialshandle--credssp.md) function with either the SECPKG\_CRED\_INBOUND or SECPKG\_CRED\_BOTH flag set.</span></span>

<span data-ttu-id="12b32-112">*phContext* \[ in, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="12b32-112">*phContext* \[in, optional\]</span></span>

<span data-ttu-id="12b32-113">Puntatore a una struttura [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="12b32-113">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="12b32-114">Alla prima chiamata a **AcceptSecurityContext (CredSSP)**, questo puntatore è **null**.</span><span class="sxs-lookup"><span data-stu-id="12b32-114">On the first call to **AcceptSecurityContext (CredSSP)**, this pointer is **NULL**.</span></span> <span data-ttu-id="12b32-115">Nelle chiamate successive, *phContext* specifica il contesto parzialmente formato restituito nel parametro *phNewContext* dalla prima chiamata.</span><span class="sxs-lookup"><span data-stu-id="12b32-115">On subsequent calls, *phContext* specifies the partially formed context returned in the *phNewContext* parameter by the first call.</span></span>

<span data-ttu-id="12b32-116">*Pinput* \[ in, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="12b32-116">*pInput* \[in, optional\]</span></span>

<span data-ttu-id="12b32-117">Puntatore a una struttura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) generata da una chiamata client a [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="12b32-117">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure generated by a client call to [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span></span> <span data-ttu-id="12b32-118">La struttura contiene il descrittore del buffer di input.</span><span class="sxs-lookup"><span data-stu-id="12b32-118">The structure contains the input buffer descriptor.</span></span>

<span data-ttu-id="12b32-119">Il primo buffer deve essere di tipo **\_ token SECBUFFER** e contenere il token di sicurezza ricevuto dal client.</span><span class="sxs-lookup"><span data-stu-id="12b32-119">The first buffer must be of type **SECBUFFER\_TOKEN** and contain the security token received from the client.</span></span> <span data-ttu-id="12b32-120">Il secondo buffer deve essere di tipo **SECBUFFER \_ vuoto**.</span><span class="sxs-lookup"><span data-stu-id="12b32-120">The second buffer should be of type **SECBUFFER\_EMPTY**.</span></span>

<span data-ttu-id="12b32-121">*fContextReq* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="12b32-121">*fContextReq* \[in\]</span></span>

<span data-ttu-id="12b32-122">-Flag di bit che specificano gli attributi necessari al server per stabilire il contesto.</span><span class="sxs-lookup"><span data-stu-id="12b32-122">-Bit flags that specify the attributes required by the server to establish the context.</span></span> <span data-ttu-id="12b32-123">I flag di bit possono essere combinati usando **operazioni OR bit per** bit.</span><span class="sxs-lookup"><span data-stu-id="12b32-123">Bit flags can be combined by using bitwise-**OR** operations.</span></span> <span data-ttu-id="12b32-124">Il parametro può essere costituito da uno o più dei valori seguenti.</span><span class="sxs-lookup"><span data-stu-id="12b32-124">This parameter can be one or more of the following values.</span></span>

| <span data-ttu-id="12b32-125">Valore</span><span class="sxs-lookup"><span data-stu-id="12b32-125">Value</span></span>                          | <span data-ttu-id="12b32-126">Significato</span><span class="sxs-lookup"><span data-stu-id="12b32-126">Meaning</span></span>                                                                                                                                                                                                        |
|--------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="12b32-127">**ASC \_ req \_ alloca \_ memoria**</span><span class="sxs-lookup"><span data-stu-id="12b32-127">**ASC\_REQ\_ALLOCATE\_MEMORY**</span></span> | <span data-ttu-id="12b32-128">Credential Security Support Provider (CredSSP) assegnerà i buffer di output.</span><span class="sxs-lookup"><span data-stu-id="12b32-128">Credential Security Support Provider (CredSSP) will allocate output buffers.</span></span> <span data-ttu-id="12b32-129">Al termine dell'utilizzo dei buffer di output, è possibile liberarli chiamando la funzione [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) .</span><span class="sxs-lookup"><span data-stu-id="12b32-129">When you have finished using the output buffers, free them by calling the [**FreeContextBuffer**](/windows/win32/api/sspi/nf-sspi-freecontextbuffer) function.</span></span> |
| <span data-ttu-id="12b32-130">**\_connessione ASC req \_**</span><span class="sxs-lookup"><span data-stu-id="12b32-130">**ASC\_REQ\_CONNECTION**</span></span>       | <span data-ttu-id="12b32-131">Il contesto di sicurezza non gestirà i messaggi di formattazione.</span><span class="sxs-lookup"><span data-stu-id="12b32-131">The security context will not handle formatting messages.</span></span>                                                                                                                                                      |
| <span data-ttu-id="12b32-132">**\_delega ASC req \_**</span><span class="sxs-lookup"><span data-stu-id="12b32-132">**ASC\_REQ\_DELEGATE**</span></span>         | <span data-ttu-id="12b32-133">Il server può rappresentare il client.</span><span class="sxs-lookup"><span data-stu-id="12b32-133">The server is allowed to impersonate the client.</span></span> <span data-ttu-id="12b32-134">Ignorare questo flag per la delega vincolata.</span><span class="sxs-lookup"><span data-stu-id="12b32-134">Ignore this flag for constrained delegation.</span></span>                                                         |
| <span data-ttu-id="12b32-135">**\_ \_ errore esteso di ASC req \_**</span><span class="sxs-lookup"><span data-stu-id="12b32-135">**ASC\_REQ\_EXTENDED\_ERROR**</span></span>  | <span data-ttu-id="12b32-136">Quando si verificano errori, viene inviata una notifica all'entità remota.</span><span class="sxs-lookup"><span data-stu-id="12b32-136">When errors occur, the remote party will be notified.</span></span>                                                                                                                                                          |
| <span data-ttu-id="12b32-137">**\_ \_ rilevamento riesecuzione di ASC req \_**</span><span class="sxs-lookup"><span data-stu-id="12b32-137">**ASC\_REQ\_REPLAY\_DETECT**</span></span>   | <span data-ttu-id="12b32-138">Rilevare i pacchetti riprodotti.</span><span class="sxs-lookup"><span data-stu-id="12b32-138">Detect replayed packets.</span></span>                                                                                                                                                                                       |
| <span data-ttu-id="12b32-139">**\_ \_ rilevamento sequenza ASC \_ req**</span><span class="sxs-lookup"><span data-stu-id="12b32-139">**ASC\_REQ\_SEQUENCE\_DETECT**</span></span> | <span data-ttu-id="12b32-140">Rilevare i messaggi ricevuti fuori sequenza.</span><span class="sxs-lookup"><span data-stu-id="12b32-140">Detect messages received out of sequence.</span></span>                                                                                                                                                                      |
| <span data-ttu-id="12b32-141">**flusso di ASC \_ req \_**</span><span class="sxs-lookup"><span data-stu-id="12b32-141">**ASC\_REQ\_STREAM**</span></span>           | <span data-ttu-id="12b32-142">Supportare una connessione orientata al flusso.</span><span class="sxs-lookup"><span data-stu-id="12b32-142">Support a stream-oriented connection.</span></span>                                                                                                                                                                          |

<span data-ttu-id="12b32-143">Per i flag di attributo possibili e i relativi significati, vedere [requisiti di contesto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="12b32-143">For possible attribute flags and their meanings, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="12b32-144">I flag usati per questo parametro sono preceduti dal prefisso ASC \_ req, ad esempio, ASC \_ req \_ delegate.</span><span class="sxs-lookup"><span data-stu-id="12b32-144">Flags used for this parameter are prefixed with ASC\_REQ, for example, ASC\_REQ\_DELEGATE.</span></span>

<span data-ttu-id="12b32-145">Gli attributi richiesti potrebbero non essere supportati dal client.</span><span class="sxs-lookup"><span data-stu-id="12b32-145">The requested attributes may not be supported by the client.</span></span> <span data-ttu-id="12b32-146">Per ulteriori informazioni, vedere il parametro *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="12b32-146">For more information, see the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="12b32-147">*TargetDataRep* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="12b32-147">*TargetDataRep* \[in\]</span></span>

<span data-ttu-id="12b32-148">Rappresentazione dei dati, ad esempio l'ordinamento dei byte, sulla destinazione.</span><span class="sxs-lookup"><span data-stu-id="12b32-148">The data representation, such as byte ordering, on the target.</span></span> <span data-ttu-id="12b32-149">Questo parametro può essere una **sicurezza \_ nativa \_ DREP** o **\_ \_ DREP della rete di sicurezza**.</span><span class="sxs-lookup"><span data-stu-id="12b32-149">This parameter can be either **SECURITY\_NATIVE\_DREP** or **SECURITY\_NETWORK\_DREP**.</span></span>

<span data-ttu-id="12b32-150">*phNewContext* \[ in, out, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="12b32-150">*phNewContext* \[in, out, optional\]</span></span>

<span data-ttu-id="12b32-151">Puntatore a una struttura [CtxtHandle](sspi-handles.md) .</span><span class="sxs-lookup"><span data-stu-id="12b32-151">A pointer to a [CtxtHandle](sspi-handles.md) structure.</span></span> <span data-ttu-id="12b32-152">Alla prima chiamata a **AcceptSecurityContext (CredSSP)**, questo puntatore riceve il nuovo handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="12b32-152">On the first call to **AcceptSecurityContext (CredSSP)**, this pointer receives the new context handle.</span></span> <span data-ttu-id="12b32-153">Nelle chiamate successive, *phNewContext* può corrispondere all'handle specificato nel parametro *phContext* .</span><span class="sxs-lookup"><span data-stu-id="12b32-153">On subsequent calls, *phNewContext* can be the same as the handle specified in the *phContext* parameter.</span></span>

<span data-ttu-id="12b32-154">*pOutput* \[ in, out, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="12b32-154">*pOutput* \[in, out, optional\]</span></span>

<span data-ttu-id="12b32-155">Puntatore a una struttura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) che contiene il descrittore del buffer di output.</span><span class="sxs-lookup"><span data-stu-id="12b32-155">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure that contains the output buffer descriptor.</span></span> <span data-ttu-id="12b32-156">Questo buffer viene inviato al client per l'input in chiamate aggiuntive a [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="12b32-156">This buffer is sent to the client for input into additional calls to [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md).</span></span> <span data-ttu-id="12b32-157">Un buffer di output può essere generato anche se la funzione restituisce SEC \_ E \_ OK.</span><span class="sxs-lookup"><span data-stu-id="12b32-157">An output buffer may be generated even if the function returns SEC\_E\_OK.</span></span> <span data-ttu-id="12b32-158">Qualsiasi buffer generato deve essere restituito all'applicazione client.</span><span class="sxs-lookup"><span data-stu-id="12b32-158">Any buffer generated must be sent back to the client application.</span></span>

<span data-ttu-id="12b32-159">Nell'output questo buffer riceve un token per il contesto di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="12b32-159">On output, this buffer receives a token for the security context.</span></span> <span data-ttu-id="12b32-160">Il token deve essere inviato al client.</span><span class="sxs-lookup"><span data-stu-id="12b32-160">The token must be sent to the client.</span></span> <span data-ttu-id="12b32-161">La funzione può anche restituire un buffer di tipo SECBUFFER \_ extra.</span><span class="sxs-lookup"><span data-stu-id="12b32-161">The function can also return a buffer of type SECBUFFER\_EXTRA.</span></span>

<span data-ttu-id="12b32-162">*pfContextAttr* \[ out\]</span><span class="sxs-lookup"><span data-stu-id="12b32-162">*pfContextAttr* \[out\]</span></span>

<span data-ttu-id="12b32-163">Puntatore a un set di flag di bit che indicano gli attributi del contesto stabilito.</span><span class="sxs-lookup"><span data-stu-id="12b32-163">A pointer to a set of bit flags that indicate the attributes of the established context.</span></span> <span data-ttu-id="12b32-164">Per una descrizione dei vari attributi, vedere [requisiti di contesto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="12b32-164">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span> <span data-ttu-id="12b32-165">I flag usati per questo parametro sono preceduti dal prefisso ASC \_ RET, ad esempio ASC \_ ret \_ delegate.</span><span class="sxs-lookup"><span data-stu-id="12b32-165">Flags used for this parameter are prefixed with ASC\_RET, for example, ASC\_RET\_DELEGATE.</span></span>

<span data-ttu-id="12b32-166">Non controllare gli attributi correlati alla sicurezza finché la chiamata di funzione finale non viene completata correttamente.</span><span class="sxs-lookup"><span data-stu-id="12b32-166">Do not check for security-related attributes until the final function call returns successfully.</span></span> <span data-ttu-id="12b32-167">I flag di attributo non correlati alla sicurezza, ad esempio \_ il \_ flag ASC RET allocazioned \_ Memory, possono essere controllati prima della restituzione finale.</span><span class="sxs-lookup"><span data-stu-id="12b32-167">Attribute flags not related to security, such as the ASC\_RET\_ALLOCATED\_MEMORY flag, can be checked before the final return.</span></span>

<span data-ttu-id="12b32-168">*ptsExpiry* \[ out, facoltativo\]</span><span class="sxs-lookup"><span data-stu-id="12b32-168">*ptsExpiry* \[out, optional\]</span></span>

<span data-ttu-id="12b32-169">Puntatore a una struttura di [**timestamp**](timestamp.md) che riceve l'ora di scadenza del contesto.</span><span class="sxs-lookup"><span data-stu-id="12b32-169">A pointer to a [**TimeStamp**](timestamp.md) structure that receives the expiration time of the context.</span></span> <span data-ttu-id="12b32-170">È consigliabile che il pacchetto di sicurezza restituisca sempre questo valore nell'ora locale.</span><span class="sxs-lookup"><span data-stu-id="12b32-170">We recommend that the security package always return this value in local time.</span></span>

> [!Note]  
> <span data-ttu-id="12b32-171">Fino all'ultima chiamata del processo di autenticazione, l'ora di scadenza per il contesto può non essere corretta perché verranno fornite ulteriori informazioni durante le fasi successive della negoziazione.</span><span class="sxs-lookup"><span data-stu-id="12b32-171">Until the last call of the authentication process, the expiration time for the context can be incorrect because more information will be provided during later stages of the negotiation.</span></span> <span data-ttu-id="12b32-172">Pertanto, *ptsTimeStamp* deve essere **null** fino all'ultima chiamata alla funzione.</span><span class="sxs-lookup"><span data-stu-id="12b32-172">Therefore, *ptsTimeStamp* must be **NULL** until the last call to the function.</span></span>

## <a name="return-value"></a><span data-ttu-id="12b32-173">Valore restituito</span><span class="sxs-lookup"><span data-stu-id="12b32-173">Return value</span></span>

<span data-ttu-id="12b32-174">Questa funzione restituisce uno dei valori seguenti.</span><span class="sxs-lookup"><span data-stu-id="12b32-174">This function returns one of the following values.</span></span>

| <span data-ttu-id="12b32-175">Codice/valore restituito</span><span class="sxs-lookup"><span data-stu-id="12b32-175">Return code/value</span></span>                                   | <span data-ttu-id="12b32-176">Descrizione</span><span class="sxs-lookup"><span data-stu-id="12b32-176">Description</span></span>                                                                                                                                                                 |
|-----------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="12b32-177">SEC_E_INCOMPLETE_MESSAGE</span><span class="sxs-lookup"><span data-stu-id="12b32-177">SEC_E_INCOMPLETE_MESSAGE</span></span> <br/> <span data-ttu-id="12b32-178">0x80090318L</span><span class="sxs-lookup"><span data-stu-id="12b32-178">0x80090318L</span></span>          | <span data-ttu-id="12b32-179">Funzione completata.</span><span class="sxs-lookup"><span data-stu-id="12b32-179">The function succeeded.</span></span> <span data-ttu-id="12b32-180">I dati nel buffer di input sono incompleti.</span><span class="sxs-lookup"><span data-stu-id="12b32-180">The data in the input buffer is incomplete.</span></span> <span data-ttu-id="12b32-181">L'applicazione deve leggere i dati aggiuntivi dal client e chiamare di nuovo [<strong>AcceptSecurityContext (CredSSP)</strong>](acceptsecuritycontext--credssp.md) .</span><span class="sxs-lookup"><span data-stu-id="12b32-181">The application must read additional data from the client and call [<strong>AcceptSecurityContext (CredSSP)</strong>](acceptsecuritycontext--credssp.md) again.</span></span> |
| <span data-ttu-id="12b32-182">SEC_E_INSUFFICIENT_MEMORY</span><span class="sxs-lookup"><span data-stu-id="12b32-182">SEC_E_INSUFFICIENT_MEMORY</span></span> <br/> <span data-ttu-id="12b32-183">0x80090300L</span><span class="sxs-lookup"><span data-stu-id="12b32-183">0x80090300L</span></span>         | <span data-ttu-id="12b32-184">La funzione non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="12b32-184">The function failed.</span></span> <span data-ttu-id="12b32-185">La memoria disponibile non è sufficiente per completare l'azione richiesta.</span><span class="sxs-lookup"><span data-stu-id="12b32-185">There is not enough memory available to complete the requested action.</span></span>                                                                                 |
| <span data-ttu-id="12b32-186">SEC_E_INTERNAL_ERROR</span><span class="sxs-lookup"><span data-stu-id="12b32-186">SEC_E_INTERNAL_ERROR</span></span> <br/> <span data-ttu-id="12b32-187">0x80090304L</span><span class="sxs-lookup"><span data-stu-id="12b32-187">0x80090304L</span></span>              | <span data-ttu-id="12b32-188">La funzione non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="12b32-188">The function failed.</span></span> <span data-ttu-id="12b32-189">Si è verificato un errore che non è stato mappato a un codice di errore SSPI.</span><span class="sxs-lookup"><span data-stu-id="12b32-189">An error occurred that did not map to an SSPI error code.</span></span>                                                                                              |
| <span data-ttu-id="12b32-190">SEC_E_INVALID_HANDLE</span><span class="sxs-lookup"><span data-stu-id="12b32-190">SEC_E_INVALID_HANDLE</span></span> <br/> <span data-ttu-id="12b32-191">0x80100003L</span><span class="sxs-lookup"><span data-stu-id="12b32-191">0x80100003L</span></span>              | <span data-ttu-id="12b32-192">La funzione non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="12b32-192">The function failed.</span></span> <span data-ttu-id="12b32-193">L'handle passato alla funzione non è valido.</span><span class="sxs-lookup"><span data-stu-id="12b32-193">The handle passed to the function is not valid.</span></span>                                                                                                        |
| <span data-ttu-id="12b32-194">SEC_E_INVALID_TOKEN</span><span class="sxs-lookup"><span data-stu-id="12b32-194">SEC_E_INVALID_TOKEN</span></span> <br/> <span data-ttu-id="12b32-195">0x80090308L</span><span class="sxs-lookup"><span data-stu-id="12b32-195">0x80090308L</span></span>               | <span data-ttu-id="12b32-196">La funzione non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="12b32-196">The function failed.</span></span> <span data-ttu-id="12b32-197">Il token passato alla funzione non è valido.</span><span class="sxs-lookup"><span data-stu-id="12b32-197">The token passed to the function is not valid.</span></span>                                                                                                         |
| <span data-ttu-id="12b32-198">SEC_E_LOGON_DENIED</span><span class="sxs-lookup"><span data-stu-id="12b32-198">SEC_E_LOGON_DENIED</span></span> <br/> <span data-ttu-id="12b32-199">0x8009030CL</span><span class="sxs-lookup"><span data-stu-id="12b32-199">0x8009030CL</span></span>                | <span data-ttu-id="12b32-200">Accesso non riuscito.</span><span class="sxs-lookup"><span data-stu-id="12b32-200">The logon failed.</span></span>                                                                                                                                                           |
| <span data-ttu-id="12b32-201">SEC_E_NO_AUTHENTICATING_AUTHORITY</span><span class="sxs-lookup"><span data-stu-id="12b32-201">SEC_E_NO_AUTHENTICATING_AUTHORITY</span></span> <br/> <span data-ttu-id="12b32-202">0x80090311L</span><span class="sxs-lookup"><span data-stu-id="12b32-202">0x80090311L</span></span> | <span data-ttu-id="12b32-203">La funzione non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="12b32-203">The function failed.</span></span> <span data-ttu-id="12b32-204">Non è stato possibile contattare un'autorità per l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="12b32-204">No authority could be contacted for authentication.</span></span> <span data-ttu-id="12b32-205">Questo problema può essere dovuto alle condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="12b32-205">This could be due to the following conditions:</span></span><br/><ul><li><span data-ttu-id="12b32-206">Il nome di dominio dell'entità di autenticazione non è corretto.</span><span class="sxs-lookup"><span data-stu-id="12b32-206">The domain name of the authenticating party is incorrect.</span></span></li><li><span data-ttu-id="12b32-207">Il dominio non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="12b32-207">The domain is unavailable.</span></span></li><li><span data-ttu-id="12b32-208">Relazione di trust non riuscita.</span><span class="sxs-lookup"><span data-stu-id="12b32-208">The trust relationship has failed.</span></span> |
| <span data-ttu-id="12b32-209">SEC_E_NO_CREDENTIALS</span><span class="sxs-lookup"><span data-stu-id="12b32-209">SEC_E_NO_CREDENTIALS</span></span> <br/><span data-ttu-id="12b32-210">0x8009030EL</span><span class="sxs-lookup"><span data-stu-id="12b32-210">0x8009030EL</span></span>               | <span data-ttu-id="12b32-211">La funzione non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="12b32-211">The function failed.</span></span> <span data-ttu-id="12b32-212">L'handle delle credenziali specificato nel parametro *phCredential* non è valido.</span><span class="sxs-lookup"><span data-stu-id="12b32-212">The credentials handle specified in the *phCredential* parameter is not valid.</span></span>                            |
| <span data-ttu-id="12b32-213">SEC_E_OK</span><span class="sxs-lookup"><span data-stu-id="12b32-213">SEC_E_OK</span></span> <br/> <span data-ttu-id="12b32-214">0x00000000L</span><span class="sxs-lookup"><span data-stu-id="12b32-214">0x00000000L</span></span>                          | <span data-ttu-id="12b32-215">Funzione completata.</span><span class="sxs-lookup"><span data-stu-id="12b32-215">The function succeeded.</span></span> <span data-ttu-id="12b32-216">Il contesto di sicurezza ricevuto dal client è stato accettato.</span><span class="sxs-lookup"><span data-stu-id="12b32-216">The security context received from the client was accepted.</span></span> <span data-ttu-id="12b32-217">Se la funzione ha generato un token di output, il token deve essere inviato al processo client.</span><span class="sxs-lookup"><span data-stu-id="12b32-217">If the function generated an output token, the token must be sent to the client process.</span></span> |
| <span data-ttu-id="12b32-218">SEC_E_UNSUPPORTED_FUNCTION</span><span class="sxs-lookup"><span data-stu-id="12b32-218">SEC_E_UNSUPPORTED_FUNCTION</span></span> <br/> <span data-ttu-id="12b32-219">0x80090302L</span><span class="sxs-lookup"><span data-stu-id="12b32-219">0x80090302L</span></span>        | <span data-ttu-id="12b32-220">La funzione non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="12b32-220">The function failed.</span></span> <span data-ttu-id="12b32-221">Il parametro *fContextReq* ha specificato un flag di attributo di contesto (ASC_REQ_DELEGATE o ASC_REQ_PROMPT_FOR_CREDS) non valido.</span><span class="sxs-lookup"><span data-stu-id="12b32-221">The *fContextReq* parameter specified a context attribute flag (ASC_REQ_DELEGATE or ASC_REQ_PROMPT_FOR_CREDS) that was not valid.</span></span>                       |
| <span data-ttu-id="12b32-222">SEC_I_COMPLETE_AND_CONTINUE</span><span class="sxs-lookup"><span data-stu-id="12b32-222">SEC_I_COMPLETE_AND_CONTINUE</span></span> <br/> <span data-ttu-id="12b32-223">0x00090314L</span><span class="sxs-lookup"><span data-stu-id="12b32-223">0x00090314L</span></span>       | <span data-ttu-id="12b32-224">Funzione completata.</span><span class="sxs-lookup"><span data-stu-id="12b32-224">The function succeeded.</span></span> <span data-ttu-id="12b32-225">Il server deve chiamare [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) e passare il token di output al client.</span><span class="sxs-lookup"><span data-stu-id="12b32-225">The server must call [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken) and pass the output token to the client.</span></span> <span data-ttu-id="12b32-226">Il server deve quindi attendere un token restituito dal client prima di effettuare un'altra chiamata a [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="12b32-226">The server must then wait for a return token from the client before making another call to [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span></span> |
| <span data-ttu-id="12b32-227">SEC_I_COMPLETE_NEEDED</span><span class="sxs-lookup"><span data-stu-id="12b32-227">SEC_I_COMPLETE_NEEDED</span></span> <br/> <span data-ttu-id="12b32-228">0x00090313L</span><span class="sxs-lookup"><span data-stu-id="12b32-228">0x00090313L</span></span>             | <span data-ttu-id="12b32-229">Funzione completata.</span><span class="sxs-lookup"><span data-stu-id="12b32-229">The function succeeded.</span></span> <span data-ttu-id="12b32-230">Il server deve terminare la compilazione del messaggio dal client prima di chiamare [ **CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)</span><span class="sxs-lookup"><span data-stu-id="12b32-230">The server must finish building the message from the client before calling [**CompleteAuthToken**](/windows/win32/api/sspi/nf-sspi-completeauthtoken)</span></span>                             |
| <span data-ttu-id="12b32-231">SEC_I_CONTINUE_NEEDED</span><span class="sxs-lookup"><span data-stu-id="12b32-231">SEC_I_CONTINUE_NEEDED</span></span> <br/> <span data-ttu-id="12b32-232">0x00090312L</span><span class="sxs-lookup"><span data-stu-id="12b32-232">0x00090312L</span></span>             | <span data-ttu-id="12b32-233">Funzione completata.</span><span class="sxs-lookup"><span data-stu-id="12b32-233">The function succeeded.</span></span> <span data-ttu-id="12b32-234">Il server deve inviare il token di output al client e attendere un token restituito.</span><span class="sxs-lookup"><span data-stu-id="12b32-234">The server must send the output token to the client and wait for a returned token.</span></span> <span data-ttu-id="12b32-235">Il token restituito deve essere passato in *Pinput* per un'altra chiamata a [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span><span class="sxs-lookup"><span data-stu-id="12b32-235">The returned token should be passed in *pInput* for another call to [**AcceptSecurityContext (CredSSP)**](acceptsecuritycontext--credssp.md).</span></span>


## <a name="remarks"></a><span data-ttu-id="12b32-236">Commenti</span><span class="sxs-lookup"><span data-stu-id="12b32-236">Remarks</span></span>

<span data-ttu-id="12b32-237">La funzione **AcceptSecurityContext (CredSSP)** è la controparte del server della funzione [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) .</span><span class="sxs-lookup"><span data-stu-id="12b32-237">The **AcceptSecurityContext (CredSSP)** function is the server counterpart to the [**InitializeSecurityContext (CredSSP)**](initializesecuritycontext--credssp.md) function.</span></span>

<span data-ttu-id="12b32-238">Quando il server riceve una richiesta da un client, usa il parametro *fContextReq* per specificare cosa richiede la sessione.</span><span class="sxs-lookup"><span data-stu-id="12b32-238">When the server receives a request from a client, it uses the *fContextReq* parameter to specify what it requires of the session.</span></span> <span data-ttu-id="12b32-239">In questo modo, un server può richiedere che i client siano in grado di usare una sessione riservata o controllata dall' [*integrità*](../secgloss/i-gly.md). può rifiutare i client che non sono in grado di soddisfare tale richiesta.</span><span class="sxs-lookup"><span data-stu-id="12b32-239">In this fashion, a server can require that clients be capable of using a confidential or [*integrity*](../secgloss/i-gly.md)-checked session; it can reject clients that cannot meet that demand.</span></span> <span data-ttu-id="12b32-240">In alternativa, un server può non essere necessario. qualsiasi cosa il client richiede o può fornire viene restituito nel parametro *pfContextAttr* .</span><span class="sxs-lookup"><span data-stu-id="12b32-240">Alternatively, a server can require nothing; whatever the client requires or can provide is returned in the *pfContextAttr* parameter.</span></span>

<span data-ttu-id="12b32-241">I parametri *fContextReq* e *pfContextAttr* sono maschere di maschera che rappresentano vari attributi di contesto.</span><span class="sxs-lookup"><span data-stu-id="12b32-241">The *fContextReq* and *pfContextAttr* parameters are bitmasks that represent various context attributes.</span></span> <span data-ttu-id="12b32-242">Per una descrizione dei vari attributi, vedere [requisiti di contesto](context-requirements.md).</span><span class="sxs-lookup"><span data-stu-id="12b32-242">For a description of the various attributes, see [Context Requirements](context-requirements.md).</span></span>

> [!Note]  
> <span data-ttu-id="12b32-243">Anche se il parametro *pfContextAttr* è valido in caso di esito positivo, è necessario esaminare i flag relativi agli aspetti di sicurezza del contesto solo per la restituzione finale riuscita.</span><span class="sxs-lookup"><span data-stu-id="12b32-243">While the *pfContextAttr* parameter is valid on any successful return, you should examine the flags pertaining to security aspects of the context only on the final successful return.</span></span> <span data-ttu-id="12b32-244">I ritorni intermedi possono impostare, ad esempio, \_ il \_ flag di memoria allocata RET di ISC \_ .</span><span class="sxs-lookup"><span data-stu-id="12b32-244">Intermediate returns can set, for example, the ISC\_RET\_ALLOCATED\_MEMORY flag.</span></span>

<span data-ttu-id="12b32-245">Il chiamante è responsabile di determinare se gli attributi di contesto finali sono sufficienti.</span><span class="sxs-lookup"><span data-stu-id="12b32-245">The caller is responsible for determining whether the final context attributes are sufficient.</span></span> <span data-ttu-id="12b32-246">Se, ad esempio, è stata richiesta la riservatezza (crittografia) ma non è stato possibile stabilirla, è possibile che alcune applicazioni decidano di arrestare immediatamente la connessione.</span><span class="sxs-lookup"><span data-stu-id="12b32-246">For example, if confidentiality (encryption) was requested but could not be established, some applications may choose to shut down the connection immediately.</span></span> <span data-ttu-id="12b32-247">Se non è possibile stabilire il contesto di sicurezza, il server deve liberare il contesto parzialmente creato chiamando la funzione [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) .</span><span class="sxs-lookup"><span data-stu-id="12b32-247">If the security context cannot be established, the server must free the partially created context by calling the [**DeleteSecurityContext**](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext) function.</span></span> <span data-ttu-id="12b32-248">Per informazioni sul momento in cui chiamare la funzione **DeleteSecurityContext** , vedere **DeleteSecurityContext**.</span><span class="sxs-lookup"><span data-stu-id="12b32-248">For information about when to call the **DeleteSecurityContext** function, see **DeleteSecurityContext**.</span></span>

<span data-ttu-id="12b32-249">Una volta stabilito il contesto di sicurezza, l'applicazione server può utilizzare la funzione [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) per recuperare un handle per l'account utente a cui è stato eseguito il mapping del certificato client.</span><span class="sxs-lookup"><span data-stu-id="12b32-249">After the security context has been established, the server application can use the [**QuerySecurityContextToken**](/windows/win32/api/sspi/nf-sspi-querysecuritycontexttoken) function to retrieve a handle to the user account to which the client certificate was mapped.</span></span> <span data-ttu-id="12b32-250">Inoltre, il server può utilizzare la funzione [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) per rappresentare l'utente.</span><span class="sxs-lookup"><span data-stu-id="12b32-250">Also, the server can use the [**ImpersonateSecurityContext**](/windows/win32/api/sspi/nf-sspi-impersonatesecuritycontext) function to impersonate the user.</span></span>

## <a name="requirements"></a><span data-ttu-id="12b32-251">Requisiti</span><span class="sxs-lookup"><span data-stu-id="12b32-251">Requirements</span></span>

| <span data-ttu-id="12b32-252">Requisito</span><span class="sxs-lookup"><span data-stu-id="12b32-252">Requirement</span></span> | <span data-ttu-id="12b32-253">Valore</span><span class="sxs-lookup"><span data-stu-id="12b32-253">Value</span></span> |
|--------------------------|-------------------------------------------|
| <span data-ttu-id="12b32-254">Client minimo supportato</span><span class="sxs-lookup"><span data-stu-id="12b32-254">Minimum supported client</span></span> | <span data-ttu-id="12b32-255">\[Solo app desktop di Windows Vista\]</span><span class="sxs-lookup"><span data-stu-id="12b32-255">Windows�Vista \[desktop apps only\]</span></span>       |
| <span data-ttu-id="12b32-256">Server minimo supportato</span><span class="sxs-lookup"><span data-stu-id="12b32-256">Minimum supported server</span></span> | <span data-ttu-id="12b32-257">\[Solo app desktop Windows Server 2008\]</span><span class="sxs-lookup"><span data-stu-id="12b32-257">Windows Server�2008 \[desktop apps only\]</span></span> |
| <span data-ttu-id="12b32-258">Intestazione</span><span class="sxs-lookup"><span data-stu-id="12b32-258">Header</span></span>                   | <span data-ttu-id="12b32-259">SSPI. h (include Security. h)</span><span class="sxs-lookup"><span data-stu-id="12b32-259">Sspi.h (include Security.h)</span></span>               |
| <span data-ttu-id="12b32-260">Libreria</span><span class="sxs-lookup"><span data-stu-id="12b32-260">Library</span></span>                  | <span data-ttu-id="12b32-261">Secur32. lib</span><span class="sxs-lookup"><span data-stu-id="12b32-261">Secur32.lib</span></span>                               |
| <span data-ttu-id="12b32-262">DLL</span><span class="sxs-lookup"><span data-stu-id="12b32-262">DLL</span></span>                      | <span data-ttu-id="12b32-263">Secur32.dll</span><span class="sxs-lookup"><span data-stu-id="12b32-263">Secur32.dll</span></span>                               |

## <a name="see-also"></a><span data-ttu-id="12b32-264">Vedi anche</span><span class="sxs-lookup"><span data-stu-id="12b32-264">See also</span></span>

- [<span data-ttu-id="12b32-265">Funzioni SSPI</span><span class="sxs-lookup"><span data-stu-id="12b32-265">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
- [<span data-ttu-id="12b32-266">**DeleteSecurityContext**</span><span class="sxs-lookup"><span data-stu-id="12b32-266">**DeleteSecurityContext**</span></span>](/windows/win32/api/sspi/nf-sspi-deletesecuritycontext)
- [<span data-ttu-id="12b32-267">**InitializeSecurityContext (CredSSP)**</span><span class="sxs-lookup"><span data-stu-id="12b32-267">**InitializeSecurityContext (CredSSP)**</span></span>](initializesecuritycontext--credssp.md)
