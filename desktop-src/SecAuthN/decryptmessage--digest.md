---
description: Consente di decrittografare un messaggio tramite digest.
ms.assetid: 46d45f59-33fa-434a-b329-20b6257c9a19
title: Funzione DecryptMessage (digest)
ms.topic: reference
ms.date: 07/25/2019
ms.openlocfilehash: 5363a5efc79d78c9c88e4a817c1c341e0e0f9c02
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104485253"
---
# <a name="decryptmessage-digest-function"></a><span data-ttu-id="da1b4-103">Funzione DecryptMessage (digest)</span><span class="sxs-lookup"><span data-stu-id="da1b4-103">DecryptMessage (Digest) function</span></span>

<span data-ttu-id="da1b4-104">La funzione **DecryptMessage (digest)** decrittografa un messaggio.</span><span class="sxs-lookup"><span data-stu-id="da1b4-104">The **DecryptMessage (Digest)** function decrypts a message.</span></span> <span data-ttu-id="da1b4-105">Alcuni pacchetti non crittografano e decrittografano i messaggi, bensì eseguono e controllano un [*hash*](../secgloss/h-gly.md)di integrità.</span><span class="sxs-lookup"><span data-stu-id="da1b4-105">Some packages do not encrypt and decrypt messages but rather perform and check an integrity [*hash*](../secgloss/h-gly.md).</span></span>

<span data-ttu-id="da1b4-106">Il [*Security Support Provider*](../secgloss/s-gly.md) digest (SSP) fornisce la riservatezza di crittografia e decrittografia per i messaggi scambiati tra client e server solo come meccanismo SASL.</span><span class="sxs-lookup"><span data-stu-id="da1b4-106">The Digest [*security support provider*](../secgloss/s-gly.md) (SSP) provides encryption and decryption confidentiality for messages exchanged between client and server as a SASL mechanism only.</span></span>

> [!Note]  
> <span data-ttu-id="da1b4-107">[**EncryptMessage (digest)**](encryptmessage--digest.md) e **DecryptMessage (digest)** possono essere chiamati contemporaneamente da due thread diversi in un contesto SSPI (Single [*Security Support Provider Interface*](../secgloss/s-gly.md) ) se un thread esegue la crittografia e l'altro esegue la decrittografia.</span><span class="sxs-lookup"><span data-stu-id="da1b4-107">[**EncryptMessage (Digest)**](encryptmessage--digest.md) and **DecryptMessage (Digest)** can be called at the same time from two different threads in a single [*security support provider interface*](../secgloss/s-gly.md) (SSPI) context if one thread is encrypting and the other is decrypting.</span></span> <span data-ttu-id="da1b4-108">Se più di un thread sta per essere crittografato o più di un thread viene decrittografato, ogni thread deve ottenere un contesto univoco.</span><span class="sxs-lookup"><span data-stu-id="da1b4-108">If more than one thread is encrypting, or more than one thread is decrypting, each thread should obtain a unique context.</span></span>

## <a name="syntax"></a><span data-ttu-id="da1b4-109">Sintassi</span><span class="sxs-lookup"><span data-stu-id="da1b4-109">Syntax</span></span>

```C++
SECURITY_STATUS SEC_ENTRY DecryptMessage(
  PCtxtHandle    phContext,
  PSecBufferDesc pMessage,
  unsigned long  MessageSeqNo,
  unsigned long  *pfQOP
);
```

## <a name="parameters"></a><span data-ttu-id="da1b4-110">Parametri</span><span class="sxs-lookup"><span data-stu-id="da1b4-110">Parameters</span></span>

<span data-ttu-id="da1b4-111">*phContext* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="da1b4-111">*phContext* \[in\]</span></span>

<span data-ttu-id="da1b4-112">Handle per il [*contesto di sicurezza*](../secgloss/s-gly.md) da utilizzare per decrittografare il messaggio.</span><span class="sxs-lookup"><span data-stu-id="da1b4-112">A handle to the [*security context*](../secgloss/s-gly.md) to be used to decrypt the message.</span></span>

<span data-ttu-id="da1b4-113">*PMessage* \[ in uscita\]</span><span class="sxs-lookup"><span data-stu-id="da1b4-113">*pMessage* \[in, out\]</span></span>

<span data-ttu-id="da1b4-114">Puntatore a una struttura [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) .</span><span class="sxs-lookup"><span data-stu-id="da1b4-114">A pointer to a [**SecBufferDesc**](/windows/win32/api/sspi/ns-sspi-secbufferdesc) structure.</span></span> <span data-ttu-id="da1b4-115">In input la struttura fa riferimento a una o più strutture [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="da1b4-115">On input, the structure references one or more [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) structures.</span></span> <span data-ttu-id="da1b4-116">Almeno uno di questi deve essere di tipo SECBUFFER \_ Data.</span><span class="sxs-lookup"><span data-stu-id="da1b4-116">At least one of these must be of type SECBUFFER\_DATA.</span></span> <span data-ttu-id="da1b4-117">Il buffer contiene il messaggio crittografato.</span><span class="sxs-lookup"><span data-stu-id="da1b4-117">That buffer contains the encrypted message.</span></span> <span data-ttu-id="da1b4-118">Il messaggio crittografato viene decrittografato sul posto, sovrascrivendo il contenuto originale del buffer.</span><span class="sxs-lookup"><span data-stu-id="da1b4-118">The encrypted message is decrypted in place, overwriting the original contents of its buffer.</span></span>

<span data-ttu-id="da1b4-119">Quando si usa il provider di servizi condivisi del digest, su input la struttura fa riferimento a una o più strutture [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) .</span><span class="sxs-lookup"><span data-stu-id="da1b4-119">When using the Digest SSP, on input, the structure references one or more [**SecBuffer**](/windows/win32/api/sspi/ns-sspi-secbuffer) structures.</span></span> <span data-ttu-id="da1b4-120">Uno di questi deve essere di tipo SECBUFFER \_ data o SECBUFFER \_ Stream e deve contenere il messaggio crittografato.</span><span class="sxs-lookup"><span data-stu-id="da1b4-120">One of these must be of type SECBUFFER\_DATA or SECBUFFER\_STREAM, and it must contain the encrypted message.</span></span>

<span data-ttu-id="da1b4-121">*MessageSeqNo* \[ in\]</span><span class="sxs-lookup"><span data-stu-id="da1b4-121">*MessageSeqNo* \[in\]</span></span>

<span data-ttu-id="da1b4-122">Numero di sequenza previsto dall'applicazione di trasporto, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="da1b4-122">The sequence number expected by the transport application, if any.</span></span> <span data-ttu-id="da1b4-123">Se l'applicazione di trasporto non mantiene i numeri di sequenza, questo parametro deve essere impostato su zero.</span><span class="sxs-lookup"><span data-stu-id="da1b4-123">If the transport application does not maintain sequence numbers, this parameter must be set to zero.</span></span>

<span data-ttu-id="da1b4-124">Quando si utilizza SSP digest, questo parametro deve essere impostato su zero.</span><span class="sxs-lookup"><span data-stu-id="da1b4-124">When using the Digest SSP, this parameter must be set to zero.</span></span> <span data-ttu-id="da1b4-125">SSP digest gestisce internamente i numeri di sequenza.</span><span class="sxs-lookup"><span data-stu-id="da1b4-125">The Digest SSP manages sequence numbering internally.</span></span>

<span data-ttu-id="da1b4-126">*pfQOP* \[ out\]</span><span class="sxs-lookup"><span data-stu-id="da1b4-126">*pfQOP* \[out\]</span></span>

<span data-ttu-id="da1b4-127">Puntatore a una variabile di tipo **ULONG** che riceve flag specifici del pacchetto che indicano la qualità della protezione.</span><span class="sxs-lookup"><span data-stu-id="da1b4-127">A pointer to a variable of type **ULONG** that receives package-specific flags that indicate the quality of protection.</span></span>

<span data-ttu-id="da1b4-128">Questo parametro può essere uno dei flag seguenti.</span><span class="sxs-lookup"><span data-stu-id="da1b4-128">This parameter can be one of the following flags.</span></span>

<table><colgroup><col style="width: 50%" /><col style="width: 50%" /></colgroup><thead><tr class="header"><th><span data-ttu-id="da1b4-129">Valore</span><span class="sxs-lookup"><span data-stu-id="da1b4-129">Value</span></span></th><th><span data-ttu-id="da1b4-130">Significato</span><span class="sxs-lookup"><span data-stu-id="da1b4-130">Meaning</span></span></th></tr></thead><tbody><tr class="odd"><td><span id="SECQOP_WRAP_NO_ENCRYPT"></span><span id="secqop_wrap_no_encrypt"></span><dl> <span data-ttu-id="da1b4-131"><dt><strong>SECQOP_WRAP_NO_ENCRYPT</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="da1b4-131"><dt><strong>SECQOP_WRAP_NO_ENCRYPT</strong></dt> </span></span></dl></td><td><span data-ttu-id="da1b4-132">Il messaggio non è stato crittografato, ma è stata generata un'intestazione o un trailer.</span><span class="sxs-lookup"><span data-stu-id="da1b4-132">The message was not encrypted, but a header or trailer was produced.</span></span><br/><blockquote>[!Note]<br />
<span data-ttu-id="da1b4-133">KERB_WRAP_NO_ENCRYPT ha lo stesso valore e lo stesso significato.</span><span class="sxs-lookup"><span data-stu-id="da1b4-133">KERB_WRAP_NO_ENCRYPT has the same value and the same meaning.</span></span></blockquote><br/></td></tr><tr class="even"><td><span id="SIGN_ONLY_"></span><span id="sign_only_"></span><dl> <span data-ttu-id="da1b4-134"><dt><strong>SIGN_ONLY</strong></dt> </span><span class="sxs-lookup"><span data-stu-id="da1b4-134"><dt><strong>SIGN_ONLY</strong> </dt> </span></span></dl></td><td><span data-ttu-id="da1b4-135">Quando si utilizza il provider di servizi condivisi del digest, utilizzare questo flag quando il [*contesto di sicurezza*](../secgloss/s-gly.md) è impostato in modo da verificare solo la [*firma*](../secgloss/s-gly.md) .</span><span class="sxs-lookup"><span data-stu-id="da1b4-135">When using the Digest SSP, use this flag when the [*security context*](../secgloss/s-gly.md) is set to verify the [*signature*](../secgloss/s-gly.md) only.</span></span> <span data-ttu-id="da1b4-136">Per ulteriori informazioni, vedere [Quality of Protection](quality-of-protection.md).</span><span class="sxs-lookup"><span data-stu-id="da1b4-136">For more information, see [Quality of Protection](quality-of-protection.md).</span></span><br/></td></tr></tbody></table>

## <a name="return-value"></a><span data-ttu-id="da1b4-137">Valore restituito</span><span class="sxs-lookup"><span data-stu-id="da1b4-137">Return value</span></span>

<span data-ttu-id="da1b4-138">Se la funzione verifica che il messaggio sia stato ricevuto nella sequenza corretta, la funzione restituisce SEC \_ E \_ OK.</span><span class="sxs-lookup"><span data-stu-id="da1b4-138">If the function verifies that the message was received in the correct sequence, the function returns SEC\_E\_OK.</span></span>

<span data-ttu-id="da1b4-139">Se la funzione non riesce a decrittografare il messaggio, restituisce uno dei codici di errore seguenti.</span><span class="sxs-lookup"><span data-stu-id="da1b4-139">If the function fails to decrypt the message, it returns one of the following error codes.</span></span>

| <span data-ttu-id="da1b4-140">Codice restituito</span><span class="sxs-lookup"><span data-stu-id="da1b4-140">Return code</span></span>                         | <span data-ttu-id="da1b4-141">Descrizione</span><span class="sxs-lookup"><span data-stu-id="da1b4-141">Description</span></span>                                                                                                                                                                  |
|-------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="da1b4-142">**SEC \_ E \_ buffer \_ troppo \_ piccolo**</span><span class="sxs-lookup"><span data-stu-id="da1b4-142">**SEC\_E\_BUFFER\_TOO\_SMALL**</span></span>      | <span data-ttu-id="da1b4-143">Il buffer dei messaggi è troppo piccolo.</span><span class="sxs-lookup"><span data-stu-id="da1b4-143">The message buffer is too small.</span></span> <span data-ttu-id="da1b4-144">Utilizzato con il provider SSP del digest.</span><span class="sxs-lookup"><span data-stu-id="da1b4-144">Used with the Digest SSP.</span></span>                                                                                                                   |
| <span data-ttu-id="da1b4-145">**\_sistema di crittografia sec E \_ \_ \_ non valido**</span><span class="sxs-lookup"><span data-stu-id="da1b4-145">**SEC\_E\_CRYPTO\_SYSTEM\_INVALID**</span></span> | <span data-ttu-id="da1b4-146">La [*crittografia*](../secgloss/c-gly.md) scelta per il [*contesto di sicurezza*](../secgloss/s-gly.md) non è supportata.</span><span class="sxs-lookup"><span data-stu-id="da1b4-146">The [*cipher*](../secgloss/c-gly.md) chosen for the [*security context*](../secgloss/s-gly.md) is not supported.</span></span> <span data-ttu-id="da1b4-147">Utilizzato con il provider SSP del digest.</span><span class="sxs-lookup"><span data-stu-id="da1b4-147">Used with the Digest SSP.</span></span>                                                                                       |
| <span data-ttu-id="da1b4-148">**SEC \_ E \_ messaggio incompleto \_**</span><span class="sxs-lookup"><span data-stu-id="da1b4-148">**SEC\_E\_INCOMPLETE\_MESSAGE**</span></span>     | <span data-ttu-id="da1b4-149">I dati nel buffer di input sono incompleti.</span><span class="sxs-lookup"><span data-stu-id="da1b4-149">The data in the input buffer is incomplete.</span></span> <span data-ttu-id="da1b4-150">L'applicazione deve leggere più dati dal server e chiamare di nuovo [**DecryptMessage (digest)**](decryptmessage--digest.md) .</span><span class="sxs-lookup"><span data-stu-id="da1b4-150">The application needs to read more data from the server and call [**DecryptMessage (Digest)**](decryptmessage--digest.md) again.</span></span> |
| <span data-ttu-id="da1b4-151">**\_handle sec E \_ non valido \_**</span><span class="sxs-lookup"><span data-stu-id="da1b4-151">**SEC\_E\_INVALID\_HANDLE**</span></span>         | <span data-ttu-id="da1b4-152">Handle di contesto non valido specificato nel parametro *phContext* .</span><span class="sxs-lookup"><span data-stu-id="da1b4-152">A context handle that is not valid was specified in the *phContext* parameter.</span></span> <span data-ttu-id="da1b4-153">Utilizzato con il provider SSP del digest.</span><span class="sxs-lookup"><span data-stu-id="da1b4-153">Used with the Digest SSP.</span></span>                                                                     |
| <span data-ttu-id="da1b4-154">**SEC \_ E \_ messaggio \_ modificato**</span><span class="sxs-lookup"><span data-stu-id="da1b4-154">**SEC\_E\_MESSAGE\_ALTERED**</span></span>        | <span data-ttu-id="da1b4-155">Il messaggio è stato modificato.</span><span class="sxs-lookup"><span data-stu-id="da1b4-155">The message has been altered.</span></span> <span data-ttu-id="da1b4-156">Utilizzato con il provider SSP del digest.</span><span class="sxs-lookup"><span data-stu-id="da1b4-156">Used with the Digest SSP.</span></span>                                                                                                                      |
| <span data-ttu-id="da1b4-157">**SEC \_ E \_ fuori \_ \_ sequenza**</span><span class="sxs-lookup"><span data-stu-id="da1b4-157">**SEC\_E\_OUT\_OF\_SEQUENCE**</span></span>       | <span data-ttu-id="da1b4-158">Il messaggio non è stato ricevuto nella sequenza corretta.</span><span class="sxs-lookup"><span data-stu-id="da1b4-158">The message was not received in the correct sequence.</span></span>                                                                                                                        |
| <span data-ttu-id="da1b4-159">**SEC \_ E \_ qop \_ non \_ supportati**</span><span class="sxs-lookup"><span data-stu-id="da1b4-159">**SEC\_E\_QOP\_NOT\_SUPPORTED**</span></span>     | <span data-ttu-id="da1b4-160">Il [*contesto di sicurezza*](../secgloss/s-gly.md)non supporta né la riservatezza né l' [*integrità*](../secgloss/i-gly.md) .</span><span class="sxs-lookup"><span data-stu-id="da1b4-160">Neither confidentiality nor [*integrity*](../secgloss/i-gly.md) are supported by the [*security context*](../secgloss/s-gly.md).</span></span> <span data-ttu-id="da1b4-161">Utilizzato con il provider SSP del digest.</span><span class="sxs-lookup"><span data-stu-id="da1b4-161">Used with the Digest SSP.</span></span>                           |

## <a name="remarks"></a><span data-ttu-id="da1b4-162">Commenti</span><span class="sxs-lookup"><span data-stu-id="da1b4-162">Remarks</span></span>

<span data-ttu-id="da1b4-163">A volte un'applicazione legge i dati dalla parte remota, tenta di decrittografarli usando **DecryptMessage (digest)** e rileva che **DecryptMessage (digest)** è riuscito, ma i buffer di output sono vuoti.</span><span class="sxs-lookup"><span data-stu-id="da1b4-163">Sometimes an application will read data from the remote party, attempt to decrypt it by using **DecryptMessage (Digest)**, and discover that **DecryptMessage (Digest)** succeeded but the output buffers are empty.</span></span> <span data-ttu-id="da1b4-164">Si tratta di un comportamento normale che le applicazioni devono essere in grado di gestire.</span><span class="sxs-lookup"><span data-stu-id="da1b4-164">This is normal behavior, and applications must be able to deal with it.</span></span>

<span data-ttu-id="da1b4-165">**Windows XP:** Questa funzione è nota anche come **UnsealMessage**.</span><span class="sxs-lookup"><span data-stu-id="da1b4-165">**Windows XP:** This function was also known as **UnsealMessage**.</span></span> <span data-ttu-id="da1b4-166">Le applicazioni devono ora usare solo **DecryptMessage (digest)** .</span><span class="sxs-lookup"><span data-stu-id="da1b4-166">Applications should now use **DecryptMessage (Digest)** only.</span></span>

## <a name="requirements"></a><span data-ttu-id="da1b4-167">Requisiti</span><span class="sxs-lookup"><span data-stu-id="da1b4-167">Requirements</span></span>

| <span data-ttu-id="da1b4-168">Requisito</span><span class="sxs-lookup"><span data-stu-id="da1b4-168">Requirement</span></span> | <span data-ttu-id="da1b4-169">Valore</span><span class="sxs-lookup"><span data-stu-id="da1b4-169">Value</span></span> |
|--------------------------|-------------------------------------------|
| <span data-ttu-id="da1b4-170">Client minimo supportato</span><span class="sxs-lookup"><span data-stu-id="da1b4-170">Minimum supported client</span></span> | <span data-ttu-id="da1b4-171">\[Solo app desktop Windows XP\]</span><span class="sxs-lookup"><span data-stu-id="da1b4-171">Windows XP \[desktop apps only\]</span></span>          |
| <span data-ttu-id="da1b4-172">Server minimo supportato</span><span class="sxs-lookup"><span data-stu-id="da1b4-172">Minimum supported server</span></span> | <span data-ttu-id="da1b4-173">\[Solo app desktop Windows Server 2003\]</span><span class="sxs-lookup"><span data-stu-id="da1b4-173">Windows Server 2003 \[desktop apps only\]</span></span> |
| <span data-ttu-id="da1b4-174">Intestazione</span><span class="sxs-lookup"><span data-stu-id="da1b4-174">Header</span></span>                   | <span data-ttu-id="da1b4-175">SSPI. h (include Security. h)</span><span class="sxs-lookup"><span data-stu-id="da1b4-175">Sspi.h (include Security.h)</span></span>               |
| <span data-ttu-id="da1b4-176">Libreria</span><span class="sxs-lookup"><span data-stu-id="da1b4-176">Library</span></span>                  | <span data-ttu-id="da1b4-177">Secur32. lib</span><span class="sxs-lookup"><span data-stu-id="da1b4-177">Secur32.lib</span></span>                               |
| <span data-ttu-id="da1b4-178">DLL</span><span class="sxs-lookup"><span data-stu-id="da1b4-178">DLL</span></span>                      | <span data-ttu-id="da1b4-179">Secur32.dll</span><span class="sxs-lookup"><span data-stu-id="da1b4-179">Secur32.dll</span></span>                               |

## <a name="see-also"></a><span data-ttu-id="da1b4-180">Vedi anche</span><span class="sxs-lookup"><span data-stu-id="da1b4-180">See also</span></span>

- [<span data-ttu-id="da1b4-181">Funzioni SSPI</span><span class="sxs-lookup"><span data-stu-id="da1b4-181">SSPI Functions</span></span>](authentication-functions.md#sspi-functions)
- [<span data-ttu-id="da1b4-182">**EncryptMessage (digest)**</span><span class="sxs-lookup"><span data-stu-id="da1b4-182">**EncryptMessage (Digest)**</span></span>](encryptmessage--digest.md)
- [<span data-ttu-id="da1b4-183">**SecBuffer**</span><span class="sxs-lookup"><span data-stu-id="da1b4-183">**SecBuffer**</span></span>](/windows/win32/api/sspi/ns-sspi-secbuffer)
- [<span data-ttu-id="da1b4-184">**SecBufferDesc**</span><span class="sxs-lookup"><span data-stu-id="da1b4-184">**SecBufferDesc**</span></span>](/windows/win32/api/sspi/ns-sspi-secbufferdesc)
