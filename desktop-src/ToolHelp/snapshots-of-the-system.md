---
title: Snapshot del sistema
description: Gli snapshot sono alla base delle funzioni della guida dello strumento. Uno snapshot è una copia di sola lettura dello stato corrente di uno o più degli elenchi seguenti che si trovano in processi di memoria di sistema, thread, moduli e heap.
ms.assetid: a8122960-f078-4efb-8e01-bf6fb69ee0dd
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6ab6f9a45ad2e12eda53d3143e43c9234c20aae3
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "103872713"
---
# <a name="snapshots-of-the-system"></a><span data-ttu-id="1f7a0-104">Snapshot del sistema</span><span class="sxs-lookup"><span data-stu-id="1f7a0-104">Snapshots of the System</span></span>

<span data-ttu-id="1f7a0-105">Gli snapshot sono alla base delle funzioni della guida dello strumento.</span><span class="sxs-lookup"><span data-stu-id="1f7a0-105">Snapshots are at the core of the tool help functions.</span></span> <span data-ttu-id="1f7a0-106">Uno snapshot è una copia di sola lettura dello stato corrente di uno o più degli elenchi seguenti che si trovano nella memoria di sistema: processi, thread, moduli e heap.</span><span class="sxs-lookup"><span data-stu-id="1f7a0-106">A snapshot is a read-only copy of the current state of one or more of the following lists that reside in system memory: processes, threads, modules, and heaps.</span></span>

<span data-ttu-id="1f7a0-107">I processi che usano funzioni della Guida degli strumenti accedono a questi elenchi da snapshot anziché direttamente dal sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="1f7a0-107">Processes that use tool help functions access these lists from snapshots instead of directly from the operating system.</span></span> <span data-ttu-id="1f7a0-108">Gli elenchi in memoria di sistema cambiano quando i processi vengono avviati e terminati, i thread vengono creati ed eliminati, i moduli eseguibili vengono caricati e scaricati dalla memoria di sistema e gli heap vengono creati ed eliminati.</span><span class="sxs-lookup"><span data-stu-id="1f7a0-108">The lists in system memory change when processes are started and ended, threads are created and destroyed, executable modules are loaded and unloaded from system memory, and heaps are created and destroyed.</span></span> <span data-ttu-id="1f7a0-109">L'utilizzo di informazioni da uno snapshot impedisce le incoerenze.</span><span class="sxs-lookup"><span data-stu-id="1f7a0-109">The use of information from a snapshot prevents inconsistencies.</span></span> <span data-ttu-id="1f7a0-110">In caso contrario, le modifiche apportate a un elenco potrebbero causare l'attraversamento non corretto dell'elenco da parte di un thread o la causa di una violazione di accesso (un errore di GP).</span><span class="sxs-lookup"><span data-stu-id="1f7a0-110">Otherwise, changes to a list could possibly cause a thread to incorrectly traverse the list or cause an access violation (a GP fault).</span></span> <span data-ttu-id="1f7a0-111">Se, ad esempio, un'applicazione attraversa l'elenco dei thread mentre vengono creati o terminati altri thread, le informazioni che l'applicazione usa per attraversare l'elenco dei thread potrebbero diventare obsolete e causare un errore per l'applicazione che attraversa l'elenco.</span><span class="sxs-lookup"><span data-stu-id="1f7a0-111">For example, if an application traverses the thread list while other threads are created or terminated, information that the application is using to traverse the thread list might become outdated and could cause an error for the application traversing the list.</span></span>

<span data-ttu-id="1f7a0-112">Per eseguire uno snapshot della memoria di sistema, usare la funzione [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) .</span><span class="sxs-lookup"><span data-stu-id="1f7a0-112">To take a snapshot of the system memory, use the [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) function.</span></span> <span data-ttu-id="1f7a0-113">Quando si chiama questa funzione, è possibile controllare il contenuto di uno snapshot specificando uno o più dei valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="1f7a0-113">You can control the content of a snapshot by specifying one or more of the following values when calling this function:</span></span>

-   <span data-ttu-id="1f7a0-114">**\_SNAPHEAPLIST TH32CS**</span><span class="sxs-lookup"><span data-stu-id="1f7a0-114">**TH32CS\_SNAPHEAPLIST**</span></span>
-   <span data-ttu-id="1f7a0-115">**\_SNAPMODULE TH32CS**</span><span class="sxs-lookup"><span data-stu-id="1f7a0-115">**TH32CS\_SNAPMODULE**</span></span>
-   <span data-ttu-id="1f7a0-116">**\_SNAPPROCESS TH32CS**</span><span class="sxs-lookup"><span data-stu-id="1f7a0-116">**TH32CS\_SNAPPROCESS**</span></span>
-   <span data-ttu-id="1f7a0-117">**\_SNAPTHREAD TH32CS**</span><span class="sxs-lookup"><span data-stu-id="1f7a0-117">**TH32CS\_SNAPTHREAD**</span></span>

<span data-ttu-id="1f7a0-118">I valori **TH32CS \_ SNAPHEAPLIST** e **TH32CS \_ SNAPMODULE** sono specifici del processo.</span><span class="sxs-lookup"><span data-stu-id="1f7a0-118">The **TH32CS\_SNAPHEAPLIST** and **TH32CS\_SNAPMODULE** values are process specific.</span></span> <span data-ttu-id="1f7a0-119">Quando si specificano questi valori, gli elenchi di heap e moduli del processo specificato vengono inclusi nello snapshot.</span><span class="sxs-lookup"><span data-stu-id="1f7a0-119">When these values are specified, the heap and module lists of the specified process are included in the snapshot.</span></span> <span data-ttu-id="1f7a0-120">Se si specifica zero come identificatore del processo, viene usato il processo corrente.</span><span class="sxs-lookup"><span data-stu-id="1f7a0-120">If you specify zero as the process identifier, the current process is used.</span></span> <span data-ttu-id="1f7a0-121">Il **valore \_ SNAPTHREAD di TH32CS** crea sempre uno snapshot a livello di sistema anche se un identificatore di processo viene passato a [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot).</span><span class="sxs-lookup"><span data-stu-id="1f7a0-121">The **TH32CS\_SNAPTHREAD** value always creates a system-wide snapshot even if a process identifier is passed to [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot).</span></span>

<span data-ttu-id="1f7a0-122">Per enumerare lo stato dell'heap o del modulo per tutti i processi, specificare il valore **\_ SNAPALL di TH32CS** e l'identificatore del processo corrente.</span><span class="sxs-lookup"><span data-stu-id="1f7a0-122">To enumerate the heap or module state for all processes, specify the **TH32CS\_SNAPALL** value and the process identifier of the current process.</span></span> <span data-ttu-id="1f7a0-123">Quindi, per ogni processo aggiuntivo nello snapshot, chiamare di nuovo [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) , specificando il relativo identificatore di processo e il valore **TH32CS \_ SNAPHEAPLIST** o **TH32CS \_ SNAPMODULE** .</span><span class="sxs-lookup"><span data-stu-id="1f7a0-123">Then, for each additional process in the snapshot, call [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) again, specifying its process identifier and the **TH32CS\_SNAPHEAPLIST** or **TH32CS\_SNAPMODULE** value.</span></span>

<span data-ttu-id="1f7a0-124">È possibile recuperare un codice di stato di errore esteso per [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) usando la funzione [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) .</span><span class="sxs-lookup"><span data-stu-id="1f7a0-124">You can retrieve an extended error status code for [**CreateToolhelp32Snapshot**](/windows/desktop/api/TlHelp32/nf-tlhelp32-createtoolhelp32snapshot) by using the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function.</span></span>

<span data-ttu-id="1f7a0-125">Quando il processo termina utilizzando uno snapshot, eliminarlo utilizzando la funzione [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) .</span><span class="sxs-lookup"><span data-stu-id="1f7a0-125">When your process finishes using a snapshot, destroy it using the [**CloseHandle**](/windows/desktop/api/handleapi/nf-handleapi-closehandle) function.</span></span> <span data-ttu-id="1f7a0-126">Se non si elimina definitivamente uno snapshot, il processo perderà memoria fino a quando non si chiude, a quel punto il sistema recupera la memoria.</span><span class="sxs-lookup"><span data-stu-id="1f7a0-126">If you do not destroy a snapshot, the process will leak memory until the it exits, at which time the system reclaims the memory.</span></span>

> [!Note]  
> <span data-ttu-id="1f7a0-127">L'handle di snapshot funge da handle di file ed è soggetto alle stesse regole relative ai processi e ai thread in cui è possibile utilizzarlo.</span><span class="sxs-lookup"><span data-stu-id="1f7a0-127">The snapshot handle acts like a file handle and is subject to the same rules regarding the processes and threads in which it can be used.</span></span> <span data-ttu-id="1f7a0-128">Per specificare che l'handle è ereditabile, creare lo snapshot usando il **valore \_ ereditato TH32CS** .</span><span class="sxs-lookup"><span data-stu-id="1f7a0-128">To specify that the handle is inheritable, create the snapshot using the **TH32CS\_INHERIT** value.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="1f7a0-129">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="1f7a0-129">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="1f7a0-130">Creazione di uno snapshot e visualizzazione dei processi</span><span class="sxs-lookup"><span data-stu-id="1f7a0-130">Taking a Snapshot and Viewing Processes</span></span>](taking-a-snapshot-and-viewing-processes.md)
</dt> </dl>

 

 