---
description: Quando la funzione CreateFile apre un handle per una risorsa di comunicazione seriale, il sistema Inizializza e configura la risorsa in base ai valori impostati per l'ultima apertura della risorsa.
ms.assetid: a39881d8-32af-4846-a2d3-508f1945b666
title: Modifica delle impostazioni delle risorse di comunicazione
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8658029470fae9ee2d70ffb1459312c3c4d80ecf
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104049186"
---
# <a name="modification-of-communications-resource-settings"></a><span data-ttu-id="3fbb4-103">Modifica delle impostazioni delle risorse di comunicazione</span><span class="sxs-lookup"><span data-stu-id="3fbb4-103">Modification of Communications Resource Settings</span></span>

<span data-ttu-id="3fbb4-104">Quando la funzione [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) apre un handle per una risorsa di comunicazione seriale, il sistema Inizializza e configura la risorsa in base ai valori impostati per l'ultima apertura della risorsa.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-104">When the [**CreateFile**](/windows/desktop/api/fileapi/nf-fileapi-createfilea) function opens a handle to a serial communications resource, the system initializes and configures the resource according to the values set up the last time the resource was opened.</span></span> <span data-ttu-id="3fbb4-105">La conservazione delle impostazioni precedenti consente all'utente di mantenere le impostazioni specificate tramite un comando **mode** quando il dispositivo viene riaperto.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-105">Preserving the previous settings enables the user to retain the settings specified through a **mode** command when the device is reopened.</span></span> <span data-ttu-id="3fbb4-106">I valori ereditati dall'operazione di apertura precedente includono le impostazioni di configurazione del blocco di controllo del dispositivo (struttura [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) ) e i valori di timeout utilizzati nelle operazioni di I/O.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-106">The values inherited from the previous open operation include the configuration settings of the device control block (a [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure) and the time-out values used in I/O operations.</span></span> <span data-ttu-id="3fbb4-107">Se il dispositivo non è mai stato aperto, viene configurato con le impostazioni predefinite del sistema.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-107">If the device has never been opened, it is configured with the system defaults.</span></span>

<span data-ttu-id="3fbb4-108">Per determinare la configurazione iniziale di una risorsa di comunicazione seriale, un processo chiama la funzione [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) , che compila una struttura [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) della porta seriale con le impostazioni di configurazione correnti.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-108">To determine the initial configuration of a serial communications resource, a process calls the [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) function, which fills in a serial port [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure with the current configuration settings.</span></span> <span data-ttu-id="3fbb4-109">Per modificare questa configurazione, un processo specifica una struttura **DCB** in una chiamata alla funzione [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) .</span><span class="sxs-lookup"><span data-stu-id="3fbb4-109">To modify this configuration, a process specifies a **DCB** structure in a call to the [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) function.</span></span>

<span data-ttu-id="3fbb4-110">I membri della struttura [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) specificano le impostazioni di configurazione, ad esempio la velocità in baud, il numero di bit di dati per byte e il numero di bit di interruzione per byte.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-110">Members of the [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure specify the configuration settings such as the baud rate, the number of data bits per byte, and the number of stop bits per byte.</span></span> <span data-ttu-id="3fbb4-111">Altri membri **DCB** specificano caratteri speciali e abilitano il controllo della parità e il controllo di flusso.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-111">Other **DCB** members specify special characters and enable parity checking and flow control.</span></span> <span data-ttu-id="3fbb4-112">Quando un processo deve modificare solo alcune di queste impostazioni di configurazione, deve prima chiamare [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) per compilare una struttura **DCB** con la configurazione corrente.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-112">When a process needs to modify only a few of these configuration settings, it should first call [**GetCommState**](/windows/desktop/api/Winbase/nf-winbase-getcommstate) to fill in a **DCB** structure with the current configuration.</span></span> <span data-ttu-id="3fbb4-113">Il processo può quindi modificare i valori importanti nella struttura **DCB** e riconfigurare il dispositivo chiamando [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) e specificando la struttura **DCB** modificata.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-113">Then the process can adjust the important values in the **DCB** structure and reconfigure the device by calling [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) and specifying the modified **DCB** structure.</span></span> <span data-ttu-id="3fbb4-114">Questa procedura garantisce che i membri non modificati della struttura **DCB** contengano valori appropriati.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-114">This procedure ensures that the unmodified members of the **DCB** structure contain appropriate values.</span></span> <span data-ttu-id="3fbb4-115">Ad esempio, un errore comune è la configurazione di un dispositivo con una struttura **DCB** in cui il membro **XonChar** della struttura è uguale al membro **XoffChar** .</span><span class="sxs-lookup"><span data-stu-id="3fbb4-115">For example, a common error is to configure a device with a **DCB** structure in which the structure's **XonChar** member is equal to the **XoffChar** member.</span></span>

<span data-ttu-id="3fbb4-116">La funzione [**BuildCommDCB**](/windows/desktop/api/Winbase/nf-winbase-buildcommdcba) fornisce un altro modo per modificare una struttura [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) .</span><span class="sxs-lookup"><span data-stu-id="3fbb4-116">The [**BuildCommDCB**](/windows/desktop/api/Winbase/nf-winbase-buildcommdcba) function provides another way to modify a [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) structure.</span></span> <span data-ttu-id="3fbb4-117">**BuildCommDCB** usa una stringa con lo stesso formato degli argomenti della riga di comando del comando **mode** per specificare la velocità in baud, lo schema di parità, il numero di bit di interruzione e il numero di bit di dati.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-117">**BuildCommDCB** uses a string with the same form as the command-line arguments of the **mode** command to specify the baud rate, parity scheme, number of stop bits, and number of data bits.</span></span> <span data-ttu-id="3fbb4-118">I membri rimanenti di [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) non vengono modificati da questa funzione, ad eccezione del fatto che i membri appropriati sono impostati per disabilitare XON/XOFF e il controllo del flusso hardware.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-118">The remaining members of [**DCB**](/windows/desktop/api/Winbase/ns-winbase-dcb) are not changed by this function, except that the appropriate members are set to disable XON/XOFF and hardware flow control.</span></span> <span data-ttu-id="3fbb4-119">**BuildCommDCB** modifica solo una struttura **DCB** ; non riconfigura il dispositivo.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-119">**BuildCommDCB** only modifies a **DCB** structure; it does not reconfigure the device.</span></span>

<span data-ttu-id="3fbb4-120">Un processo può riconfigurare una risorsa di comunicazione usando la funzione [**GetCommProperties**](/windows/desktop/api/Winbase/nf-winbase-getcommproperties) per ottenere informazioni da un driver di dispositivo sulle impostazioni di configurazione supportate.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-120">A process can reconfigure a communications resource by using the [**GetCommProperties**](/windows/desktop/api/Winbase/nf-winbase-getcommproperties) function to get information from a device driver about the configuration settings that it supports.</span></span> <span data-ttu-id="3fbb4-121">Il processo può utilizzare queste informazioni per evitare di specificare una configurazione non supportata.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-121">The process can use this information to avoid specifying a configuration that is not supported.</span></span>

<span data-ttu-id="3fbb4-122">La funzione [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) riconfigura la risorsa di comunicazione, ma non influisce sui buffer di input e di output interni del driver specificato.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-122">The [**SetCommState**](/windows/desktop/api/Winbase/nf-winbase-setcommstate) function reconfigures the communications resource, but it does not affect the internal output and input buffers of the specified driver.</span></span> <span data-ttu-id="3fbb4-123">I buffer non vengono scaricati e le operazioni di lettura e scrittura in sospeso non vengono terminate in modo anomalo.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-123">The buffers are not flushed, and pending read and write operations are not terminated prematurely.</span></span>

<span data-ttu-id="3fbb4-124">Un processo reinizializza una risorsa di comunicazione usando la funzione [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm) , che esegue le attività seguenti:</span><span class="sxs-lookup"><span data-stu-id="3fbb4-124">A process reinitializes a communications resource by using the [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm) function, which performs the following tasks:</span></span>

-   <span data-ttu-id="3fbb4-125">Termina le operazioni di lettura e scrittura in sospeso, anche se non sono state completate.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-125">Terminates pending read and write operations, even if they have not been completed.</span></span>
-   <span data-ttu-id="3fbb4-126">Elimina i caratteri non letti e libera i buffer di input e di output interni del driver associato alla risorsa specificata.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-126">Discards unread characters and frees the internal output and input buffers of the driver associated with the specified resource.</span></span>
-   <span data-ttu-id="3fbb4-127">Rialloca l'output interno e i buffer di input.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-127">Reallocates the internal output and input buffers.</span></span>

<span data-ttu-id="3fbb4-128">Non è necessario un processo per chiamare [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm).</span><span class="sxs-lookup"><span data-stu-id="3fbb4-128">A process is not required to call [**SetupComm**](/windows/desktop/api/Winbase/nf-winbase-setupcomm).</span></span> <span data-ttu-id="3fbb4-129">In caso contrario, il driver della risorsa Inizializza il dispositivo con le impostazioni predefinite la prima volta che si usa l'handle delle risorse di comunicazione.</span><span class="sxs-lookup"><span data-stu-id="3fbb4-129">If it does not, the resource's driver initializes the device with the default settings the first time that the communications resource handle is used.</span></span>

 

 
