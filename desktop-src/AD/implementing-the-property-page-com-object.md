---
title: Implementazione dell'oggetto COM della pagina delle proprietà
description: Un'estensione della finestra delle proprietà è un oggetto COM implementato come server in-process.
ms.assetid: 77a71086-1949-4828-801e-073ea5a6838b
ms.tgt_platform: multiple
keywords:
- Implementazione dell'oggetto COM della pagina delle proprietà
- Oggetto COM della pagina delle proprietà, implementazione
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 55962002ca059ad6e9c137925d1ba21ba9adc513
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/17/2020
ms.locfileid: "103872298"
---
# <a name="implementing-the-property-page-com-object"></a><span data-ttu-id="02cf7-105">Implementazione dell'oggetto COM della pagina delle proprietà</span><span class="sxs-lookup"><span data-stu-id="02cf7-105">Implementing the Property Page COM Object</span></span>

<span data-ttu-id="02cf7-106">Un'estensione della finestra delle proprietà è un oggetto COM implementato come server in-process.</span><span class="sxs-lookup"><span data-stu-id="02cf7-106">A property sheet extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="02cf7-107">L'estensione della finestra delle proprietà deve implementare le interfacce [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) e [**IShellPropSheetExt**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-107">The property sheet extension must implement the [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) and [**IShellPropSheetExt**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellpropsheetext) interfaces.</span></span> <span data-ttu-id="02cf7-108">Viene creata un'istanza di un'estensione della finestra delle proprietà quando l'utente Visualizza la finestra delle proprietà per un oggetto di una classe per la quale l'estensione della finestra delle proprietà è stata registrata nell'identificatore di visualizzazione della classe.</span><span class="sxs-lookup"><span data-stu-id="02cf7-108">A property sheet extension is instantiated when the user displays the property sheet for an object of a class for which the property sheet extension has been registered in the display specifier of the class.</span></span>

-   [<span data-ttu-id="02cf7-109">Implementazione di IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="02cf7-109">Implementing IShellExtInit</span></span>](#implementing-ishellextinit)
-   [<span data-ttu-id="02cf7-110">Implementazione di IShellPropSheetExt</span><span class="sxs-lookup"><span data-stu-id="02cf7-110">Implementing IShellPropSheetExt</span></span>](#implementing-ishellpropsheetext)
-   [<span data-ttu-id="02cf7-111">Passaggio dell'oggetto estensione alla pagina delle proprietà</span><span class="sxs-lookup"><span data-stu-id="02cf7-111">Passing the Extension Object to the Property Page</span></span>](#passing-the-extension-object-to-the-property-page)
-   [<span data-ttu-id="02cf7-112">Utilizzo dell'oggetto Notification</span><span class="sxs-lookup"><span data-stu-id="02cf7-112">Working With the Notification Object</span></span>](#working-with-the-notification-object)
-   [<span data-ttu-id="02cf7-113">Varie</span><span class="sxs-lookup"><span data-stu-id="02cf7-113">Miscellaneous</span></span>](#miscellaneous)
-   [<span data-ttu-id="02cf7-114">Finestre delle proprietà a selezione multipla</span><span class="sxs-lookup"><span data-stu-id="02cf7-114">Multiple-Selection Property Sheets</span></span>](#multiple-selection-property-sheets)
-   [<span data-ttu-id="02cf7-115">Novità con Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="02cf7-115">New with Windows Server 2003</span></span>](#new-with-windows-server-2003)
-   [<span data-ttu-id="02cf7-116">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="02cf7-116">Related topics</span></span>](#related-topics)

## <a name="implementing-ishellextinit"></a><span data-ttu-id="02cf7-117">Implementazione di IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="02cf7-117">Implementing IShellExtInit</span></span>

<span data-ttu-id="02cf7-118">Quando viene creata un'istanza dell'oggetto COM dell'estensione della finestra delle proprietà, viene chiamato il metodo [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-118">After the property sheet extension COM object is instantiated, the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method is called.</span></span> <span data-ttu-id="02cf7-119">**IShellExtInit:: Initialize** fornisce l'estensione della finestra delle proprietà con un oggetto [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) che contiene i dati relativi all'oggetto directory a cui viene applicata la finestra delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="02cf7-119">**IShellExtInit::Initialize** supplies the property sheet extension with an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) object that contains data that pertains to the directory object that the property sheet applies.</span></span>

<span data-ttu-id="02cf7-120">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contiene i dati nel formato [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-120">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contains data in the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) format.</span></span> <span data-ttu-id="02cf7-121">Il formato dati **CFSTR \_ DSOBJECTNAMES** è un **HGLOBAL** che contiene una struttura [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-121">The **CFSTR\_DSOBJECTNAMES** data format is an **HGLOBAL** that contains a [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure.</span></span> <span data-ttu-id="02cf7-122">La struttura **DSOBJECTNAMES** contiene i dati dell'oggetto directory a cui viene applicata l'estensione della finestra delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="02cf7-122">The **DSOBJECTNAMES** structure contains directory object data that the property sheet extension applies.</span></span>

<span data-ttu-id="02cf7-123">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contiene inoltre dati nel formato delle [**Opzioni di \_ visualizzazione delle \_ \_ specifiche \_ di CFSTR DS**](cfstr-ds-display-spec-options.md) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-123">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) also contains data in the [**CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS**](cfstr-ds-display-spec-options.md) format.</span></span> <span data-ttu-id="02cf7-124">Il formato dei dati delle **\_ \_ \_ \_ Opzioni di visualizzazione di CFSTR DS** è un **HGLOBAL** che contiene una struttura [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-124">The **CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS** data format is an **HGLOBAL** that contains a [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) structure.</span></span> <span data-ttu-id="02cf7-125">**DSDISPLAYSPECOPTIONS** contiene i dati di configurazione per l'utilizzo da parte dell'estensione.</span><span class="sxs-lookup"><span data-stu-id="02cf7-125">The **DSDISPLAYSPECOPTIONS** contains configuration data for use by the extension.</span></span>

<span data-ttu-id="02cf7-126">Se un valore diverso da **S \_ OK** viene restituito da [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), la finestra delle proprietà non viene visualizzata.</span><span class="sxs-lookup"><span data-stu-id="02cf7-126">If any value other than **S\_OK** is returned from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), the property sheet is not displayed.</span></span>

<span data-ttu-id="02cf7-127">I parametri *pidlFolder* e *HkeyProgID* del metodo [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) non vengono usati.</span><span class="sxs-lookup"><span data-stu-id="02cf7-127">The *pidlFolder* and *hkeyProgID* parameters of the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method are not used.</span></span>

<span data-ttu-id="02cf7-128">Il puntatore [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) può essere salvato dall'estensione incrementando il conteggio dei riferimenti di **IDataObject**.</span><span class="sxs-lookup"><span data-stu-id="02cf7-128">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) pointer can be saved by the extension by incrementing the reference count of the **IDataObject**.</span></span> <span data-ttu-id="02cf7-129">Questa interfaccia deve essere rilasciata quando non è più necessaria.</span><span class="sxs-lookup"><span data-stu-id="02cf7-129">This interface must be released when no longer required.</span></span>

## <a name="implementing-ishellpropsheetext"></a><span data-ttu-id="02cf7-130">Implementazione di IShellPropSheetExt</span><span class="sxs-lookup"><span data-stu-id="02cf7-130">Implementing IShellPropSheetExt</span></span>

<span data-ttu-id="02cf7-131">Dopo che [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) restituisce, viene chiamato il metodo [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-131">After [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) returns, the [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) method is called.</span></span> <span data-ttu-id="02cf7-132">L'estensione della finestra delle proprietà deve aggiungere la pagina o le pagine durante questo metodo.</span><span class="sxs-lookup"><span data-stu-id="02cf7-132">The property sheet extension must add the page or pages during this method.</span></span> <span data-ttu-id="02cf7-133">Una pagina delle proprietà viene creata riempiendo una struttura [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) e quindi passando la struttura alla funzione [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-133">A property page is created by filling a [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and then passing this structure to the [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) function.</span></span> <span data-ttu-id="02cf7-134">La pagina delle proprietà viene quindi aggiunta alla finestra delle proprietà chiamando la funzione di callback passata a **IShellPropSheetExt:: AddPages** nel parametro *lpfnAddPage* .</span><span class="sxs-lookup"><span data-stu-id="02cf7-134">The property page is then added to the property sheet by calling the callback function passed to **IShellPropSheetExt::AddPages** in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="02cf7-135">Se un valore diverso da **S \_ OK** viene restituito da [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages), la finestra delle proprietà non viene visualizzata.</span><span class="sxs-lookup"><span data-stu-id="02cf7-135">If any value other than **S\_OK** is returned from [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages), the property sheet is not displayed.</span></span>

<span data-ttu-id="02cf7-136">Se l'estensione della finestra delle proprietà non è necessaria per aggiungere pagine alla finestra delle proprietà, non deve chiamare la funzione di callback passata a [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) nel parametro *lpfnAddPage* .</span><span class="sxs-lookup"><span data-stu-id="02cf7-136">If the property sheet extension is not required to add any pages to the property sheet, it should not call the callback function passed to [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="02cf7-137">Il metodo [**IShellPropSheetExt:: ReplacePage**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-replacepage) non viene utilizzato.</span><span class="sxs-lookup"><span data-stu-id="02cf7-137">The [**IShellPropSheetExt::ReplacePage**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-replacepage) method is not used.</span></span>

## <a name="passing-the-extension-object-to-the-property-page"></a><span data-ttu-id="02cf7-138">Passaggio dell'oggetto estensione alla pagina delle proprietà</span><span class="sxs-lookup"><span data-stu-id="02cf7-138">Passing the Extension Object to the Property Page</span></span>

<span data-ttu-id="02cf7-139">L'oggetto estensione della finestra delle proprietà è indipendente dalla pagina delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="02cf7-139">The property sheet extension object is independent from the property page.</span></span> <span data-ttu-id="02cf7-140">In molti casi, è preferibile poter usare l'oggetto di estensione, o un altro oggetto, dalla pagina delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="02cf7-140">In many cases, it is desirable to be able to use the extension object, or some other object, from the property page.</span></span> <span data-ttu-id="02cf7-141">A tale scopo, impostare il membro **lParam** della struttura [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) sul puntatore all'oggetto.</span><span class="sxs-lookup"><span data-stu-id="02cf7-141">To do this, set the **lParam** member of [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure to the object pointer.</span></span> <span data-ttu-id="02cf7-142">La pagina delle proprietà può quindi recuperare questo valore quando elabora il messaggio [**WM \_ INITDIALOG**](../dlgbox/wm-initdialog.md) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-142">The property page can then retrieve this value when it processes the [**WM\_INITDIALOG**](../dlgbox/wm-initdialog.md) message.</span></span> <span data-ttu-id="02cf7-143">Per una pagina delle proprietà, il parametro *lParam* del messaggio **WM \_ INITDIALOG** è un puntatore alla struttura **PROPSHEETPAGE** .</span><span class="sxs-lookup"><span data-stu-id="02cf7-143">For a property page, the *lParam* parameter of the **WM\_INITDIALOG** message is a pointer to the **PROPSHEETPAGE** structure.</span></span> <span data-ttu-id="02cf7-144">Recuperare il puntatore all'oggetto eseguendo il cast del valore *lParam* del messaggio **WM \_ INITDIALOG** a un puntatore **PROPSHEETPAGE** e quindi recuperando il membro **lParam** della struttura **PROPSHEETPAGE** .</span><span class="sxs-lookup"><span data-stu-id="02cf7-144">Retrieve the object pointer by casting the *lParam* of the **WM\_INITDIALOG** message to a **PROPSHEETPAGE** pointer and then retrieving the **lParam** member of the **PROPSHEETPAGE** structure.</span></span>

<span data-ttu-id="02cf7-145">Nell'esempio di codice C++ riportato di seguito viene illustrato come passare un oggetto a una pagina delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="02cf7-145">The following C++ code example shows how to pass an object to a property page.</span></span>


```C++
case WM_INITDIALOG:
    {
        LPPROPSHEETPAGE pPage = (LPPROPSHEETPAGE)lParam;

        if(NULL != pPage)
        {
            CPropSheetExt *pPropSheetExt;
            pPropSheetExt = (CPropSheetExt*)pPage->lParam;

            if(pPropSheetExt)
            {
                return pPropSheetExt>OnInitDialog(wParam, lParam);
            }
        }
    }
    break;
```



<span data-ttu-id="02cf7-146">Tenere presente che, dopo la chiamata di [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) , la finestra delle proprietà rilascerà l'oggetto estensione della finestra delle proprietà e non verrà mai riutilizzato.</span><span class="sxs-lookup"><span data-stu-id="02cf7-146">Be aware that after [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages) is called, the property sheet will release the property sheet extension object and never use it again.</span></span> <span data-ttu-id="02cf7-147">Questo significa che l'oggetto di estensione verrebbe eliminato prima della visualizzazione della pagina delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="02cf7-147">This means that the extension object would be deleted before the property page is displayed.</span></span> <span data-ttu-id="02cf7-148">Quando la pagina tenta di accedere al puntatore all'oggetto, la memoria viene liberata e il puntatore non sarà valido.</span><span class="sxs-lookup"><span data-stu-id="02cf7-148">When the page attempts to access the object pointer, the memory will have been freed and the pointer will not be valid.</span></span> <span data-ttu-id="02cf7-149">Per risolvere il problema, incrementare il conteggio dei riferimenti per l'oggetto estensione quando viene aggiunta la pagina e quindi rilasciare l'oggetto quando la finestra di dialogo della pagina delle proprietà viene distrutta.</span><span class="sxs-lookup"><span data-stu-id="02cf7-149">To correct this, increment the reference count for the extension object when the page is added and then release the object when the property page dialog is destroyed.</span></span> <span data-ttu-id="02cf7-150">Viene creato un altro problema perché la finestra di dialogo della pagina delle proprietà non viene creata fino alla prima visualizzazione della pagina.</span><span class="sxs-lookup"><span data-stu-id="02cf7-150">This creates another issue because the property page dialog box is not created until the first time the page is displayed.</span></span> <span data-ttu-id="02cf7-151">Se l'utente non seleziona mai la pagina di estensione, la pagina non viene mai creata ed eliminata definitivamente.</span><span class="sxs-lookup"><span data-stu-id="02cf7-151">If the user never selects the extension page, the page never gets created and destroyed.</span></span> <span data-ttu-id="02cf7-152">In questo modo l'oggetto di estensione non verrà mai rilasciato, quindi si verificherà una perdita di memoria.</span><span class="sxs-lookup"><span data-stu-id="02cf7-152">This results in the extension object never getting released, so a memory leak occurs.</span></span> <span data-ttu-id="02cf7-153">Per evitare questo problema, implementare una funzione di callback della pagina delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="02cf7-153">To avoid this, implement a property page callback function.</span></span> <span data-ttu-id="02cf7-154">A tale scopo, aggiungere il **flag \_ USECALLBACK di PSP** al **membro dwFlags** della struttura [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) e impostare il membro **PfnCallback** della struttura **PROPSHEETPAGE** sull'indirizzo della funzione [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) implementata.</span><span class="sxs-lookup"><span data-stu-id="02cf7-154">To do this, add the **PSP\_USECALLBACK** flag to the **dwFlags** member of the [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and set the **pfnCallback** member of the **PROPSHEETPAGE** structure to the address of the [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) function implemented.</span></span> <span data-ttu-id="02cf7-155">Quando la funzione **PropSheetPageProc** riceve la notifica di **\_ rilascio PSPCB** , il parametro *ppSP* di **PropSheetPageProc** contiene un puntatore alla struttura **PROPSHEETPAGE** .</span><span class="sxs-lookup"><span data-stu-id="02cf7-155">When the **PropSheetPageProc** function receives the **PSPCB\_RELEASE** notification, the *ppsp* parameter of the **PropSheetPageProc** contains a pointer to the **PROPSHEETPAGE** structure.</span></span> <span data-ttu-id="02cf7-156">Il membro **lParam** della struttura **PROPSHEETPAGE** contiene il puntatore di estensione che può essere utilizzato per rilasciare l'oggetto.</span><span class="sxs-lookup"><span data-stu-id="02cf7-156">The **lParam** member of the **PROPSHEETPAGE** structure contains the extension pointer which can be used to release the object.</span></span>

<span data-ttu-id="02cf7-157">Nell'esempio di codice C++ riportato di seguito viene illustrato come rilasciare un oggetto di estensione.</span><span class="sxs-lookup"><span data-stu-id="02cf7-157">The following C++ code example shows how to release an extension object.</span></span>


```C++
UINT CALLBACK CPropSheetExt::PageCallbackProc(  HWND hWnd,
                                                UINT uMsg,
                                                LPPROPSHEETPAGE ppsp)
{
    switch(uMsg)
    {
    case PSPCB_CREATE:
        // Must return TRUE to enable the page to be created.
        return TRUE;

    case PSPCB_RELEASE:
        {
            /*
            Release the object. This is called even if the page dialog box was 
            never actually created.
            */
            CPropSheetExt *pPropSheetExt = (CPropSheetExt*)ppsp->lParam;

            if(pPropSheetExt)
            {
                pPropSheetExt->Release();
            }
        }
        break;
    }

    return FALSE;
}
```



## <a name="working-with-the-notification-object"></a><span data-ttu-id="02cf7-158">Utilizzo dell'oggetto Notification</span><span class="sxs-lookup"><span data-stu-id="02cf7-158">Working With the Notification Object</span></span>

<span data-ttu-id="02cf7-159">Poiché le pagine di estensione della finestra delle proprietà vengono visualizzate all'interno di una finestra delle proprietà creata da un componente sconosciuto all'estensione, è necessario utilizzare un "Manager" per gestire il trasferimento dei dati tra le pagine di estensione e la finestra delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="02cf7-159">Because the property sheet extension pages are displayed within a property sheet created by a component unknown to the extension, it is necessary to use a "manager" to handle the data transfer between the extension pages and the property sheet.</span></span> <span data-ttu-id="02cf7-160">Questo "Manager" è denominato oggetto notifica.</span><span class="sxs-lookup"><span data-stu-id="02cf7-160">This "manager" is called the notification object.</span></span> <span data-ttu-id="02cf7-161">L'oggetto notifica funge da moderatore tra le singole pagine e la finestra delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="02cf7-161">The notification object operates as a moderator between the individual pages and the property sheet.</span></span>

<span data-ttu-id="02cf7-162">Quando viene inizializzato l'oggetto estensione della finestra delle proprietà, l'estensione deve creare un oggetto notifica chiamando [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj), passando il [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) ottenuto da [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) e il nome dell'oggetto directory.</span><span class="sxs-lookup"><span data-stu-id="02cf7-162">When the property sheet extension object is initialized, the extension must create a notification object by calling [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj), passing the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtained from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) and the directory object name.</span></span> <span data-ttu-id="02cf7-163">Non è necessario incrementare il conteggio dei riferimenti dell'interfaccia **IDataObject** , perché l'oggetto notifica creato dalla funzione **ADsPropCreateNotifyObj** eseguirà questa operazione.</span><span class="sxs-lookup"><span data-stu-id="02cf7-163">It is not necessary to increment the reference count of the **IDataObject** interface, because the notification object created by **ADsPropCreateNotifyObj** function will do this.</span></span> <span data-ttu-id="02cf7-164">L'handle dell'oggetto notifica fornito da **ADsPropCreateNotifyObj** deve essere salvato per un uso successivo.</span><span class="sxs-lookup"><span data-stu-id="02cf7-164">The notification object handle provided by **ADsPropCreateNotifyObj** should be saved for later use.</span></span> <span data-ttu-id="02cf7-165">**ADsPropCreateNotifyObj** può essere chiamato durante **IShellExtInit:: Initialize** o [**IShellPropSheetExt:: AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages).</span><span class="sxs-lookup"><span data-stu-id="02cf7-165">**ADsPropCreateNotifyObj** can be either called during **IShellExtInit::Initialize** or [**IShellPropSheetExt::AddPages**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellpropsheetext-addpages).</span></span> <span data-ttu-id="02cf7-166">Quando l'estensione della finestra delle proprietà viene arrestata, deve inviare un messaggio di [**\_ uscita di \_ notifica \_ di WM ADSPROP**](wm-adsprop-notify-exit.md) all'oggetto notifica.</span><span class="sxs-lookup"><span data-stu-id="02cf7-166">When the property sheet extension is shut down, it must send a [**WM\_ADSPROP\_NOTIFY\_EXIT**](wm-adsprop-notify-exit.md) message to the notification object.</span></span> <span data-ttu-id="02cf7-167">In questo modo l'oggetto notifica si distrugge automaticamente.</span><span class="sxs-lookup"><span data-stu-id="02cf7-167">This causes the notification object to destroy itself.</span></span> <span data-ttu-id="02cf7-168">Questa operazione viene eseguita meglio quando la funzione [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) riceve la notifica di **\_ rilascio di PSPCB** .</span><span class="sxs-lookup"><span data-stu-id="02cf7-168">This is best done when the [**PropSheetPageProc**](/windows/win32/api/prsht/nc-prsht-lpfnpspcallbacka) function receives the **PSPCB\_RELEASE** notification.</span></span>

<span data-ttu-id="02cf7-169">L'estensione della finestra delle proprietà può ottenere dati oltre a quelli forniti dal formato degli Appunti [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) chiamando [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo).</span><span class="sxs-lookup"><span data-stu-id="02cf7-169">The property sheet extension can obtain data in addition to that provided by the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) clipboard format by calling [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo).</span></span> <span data-ttu-id="02cf7-170">Uno dei vantaggi dell'uso di **ADsPropGetInitInfo** è che fornisce un oggetto [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) usato per lavorare a livello di codice con l'oggetto directory.</span><span class="sxs-lookup"><span data-stu-id="02cf7-170">One of the advantages of using **ADsPropGetInitInfo** is that it provides an [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) object used to programmatically work with the directory object.</span></span>

> [!Note]  
> <span data-ttu-id="02cf7-171">A differenza della maggior parte dei metodi e delle funzioni COM, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) non incrementa il conteggio dei riferimenti per l'oggetto [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-171">Unlike most COM methods and functions, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) does not increment the reference count for the [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) object.</span></span> <span data-ttu-id="02cf7-172">Il **IDirectoryObject** non deve essere rilasciato se il conteggio dei riferimenti viene incrementato manualmente.</span><span class="sxs-lookup"><span data-stu-id="02cf7-172">The **IDirectoryObject** must not be released unless the reference count is manually incremented first.</span></span>

 

<span data-ttu-id="02cf7-173">Quando la pagina delle proprietà viene creata per la prima volta, l'estensione deve registrare la pagina con l'oggetto notifica chiamando [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd) con l'handle di finestra della pagina.</span><span class="sxs-lookup"><span data-stu-id="02cf7-173">When the property page is first created, the extension should register the page with the notification object by calling [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd) with the window handle of the page.</span></span>

<span data-ttu-id="02cf7-174">[**ADsPropCheckIfWritable**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcheckifwritable) è una funzione di utilità che può essere utilizzata dall'estensione della finestra delle proprietà per determinare se è possibile scrivere una proprietà.</span><span class="sxs-lookup"><span data-stu-id="02cf7-174">[**ADsPropCheckIfWritable**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcheckifwritable) is a utility function that the property sheet extension can use to determine if a property can be written.</span></span>

## <a name="miscellaneous"></a><span data-ttu-id="02cf7-175">Varie</span><span class="sxs-lookup"><span data-stu-id="02cf7-175">Miscellaneous</span></span>

<span data-ttu-id="02cf7-176">L'handle della pagina delle proprietà viene passato alla routine della finestra di dialogo della pagina.</span><span class="sxs-lookup"><span data-stu-id="02cf7-176">The handle of the property page is passed to the page dialog box procedure.</span></span> <span data-ttu-id="02cf7-177">La finestra delle proprietà è l'elemento padre diretto della pagina delle proprietà, quindi l'handle della finestra delle proprietà può essere ottenuto chiamando la funzione [**GetParent**](/windows/win32/api/winuser/nf-winuser-getparent) con l'handle della pagina delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="02cf7-177">The property sheet is the direct parent of the property page, so the handle of the property sheet can be obtained by calling the [**GetParent**](/windows/win32/api/winuser/nf-winuser-getparent) function with the property page handle.</span></span>

<span data-ttu-id="02cf7-178">Quando viene modificato il contenuto della pagina di estensione, l'estensione deve usare la macro [**PropSheet \_ modificata**](/windows/win32/api/prsht/nf-prsht-propsheet_changed) per inviare una notifica alla finestra delle proprietà delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="02cf7-178">When the contents of the extension page changes, the extension should use the [**PropSheet\_Changed**](/windows/win32/api/prsht/nf-prsht-propsheet_changed) macro to notify the property sheet of changes.</span></span> <span data-ttu-id="02cf7-179">Il pulsante Applica verrà abilitato dalla finestra delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="02cf7-179">The property sheet will then enable the Apply button.</span></span>

## <a name="multiple-selection-property-sheets"></a><span data-ttu-id="02cf7-180">Finestre delle proprietà Multiple-Selection</span><span class="sxs-lookup"><span data-stu-id="02cf7-180">Multiple-Selection Property Sheets</span></span>

<span data-ttu-id="02cf7-181">Con i sistemi operativi Windows Server 2003 e versioni successive, i Active Directory snap-in MMC amministrativi supportano le estensioni della finestra delle proprietà per più oggetti directory.</span><span class="sxs-lookup"><span data-stu-id="02cf7-181">With Windows Server 2003 and later operating systems, the Active Directory administrative MMC snap-ins support property sheet extensions for multiple directory objects.</span></span> <span data-ttu-id="02cf7-182">Queste finestre delle proprietà vengono visualizzate quando le proprietà vengono visualizzate per più di un elemento alla volta.</span><span class="sxs-lookup"><span data-stu-id="02cf7-182">These property sheets are displayed when the properties are viewed for more than one item at a time.</span></span> <span data-ttu-id="02cf7-183">La differenza principale tra un'estensione della finestra delle proprietà a selezione singola e un'estensione della finestra delle proprietà a selezione multipla è che la struttura [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) fornita dal formato degli Appunti [**\_ DSOBJECTNAMES CFSTR**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) in [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) conterrà più di una struttura [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-183">The primary difference between a single-selection property sheet extension and a multiple-selection property sheet extension is that the [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure supplied by the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) clipboard format in [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) will contain more than one [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) structure.</span></span>

<span data-ttu-id="02cf7-184">Quando viene creato l'oggetto notifica, un'estensione della finestra delle proprietà per più selezioni deve passare un nome univoco fornito dallo snap-in anziché un nome creato dall'estensione.</span><span class="sxs-lookup"><span data-stu-id="02cf7-184">When the notification object is created, a multi-selection property sheet extension must pass a unique name that is provided by the snap-in rather than a name created by the extension.</span></span> <span data-ttu-id="02cf7-185">Per ottenere il nome univoco, richiedere il formato degli Appunti [**\_ \_ MULTISELECTPROPPAGE di CFSTR DS**](cfstr-ds-multiselectproppage.md) dall' [**interfaccia IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) ottenuta da [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span><span class="sxs-lookup"><span data-stu-id="02cf7-185">To obtain the unique name, request the [**CFSTR\_DS\_MULTISELECTPROPPAGE**](cfstr-ds-multiselectproppage.md) clipboard format from the [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) obtained from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize).</span></span> <span data-ttu-id="02cf7-186">Questi dati sono **HGLOBAL** che contengono una stringa Unicode con terminazione null che rappresenta il nome univoco.</span><span class="sxs-lookup"><span data-stu-id="02cf7-186">This data is an **HGLOBAL** that contains a null-terminated Unicode string that is the unique name.</span></span> <span data-ttu-id="02cf7-187">Questo nome univoco viene quindi passato alla funzione [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj) per creare l'oggetto notifica.</span><span class="sxs-lookup"><span data-stu-id="02cf7-187">This unique name is then passed to the [**ADsPropCreateNotifyObj**](/windows/desktop/api/Adsprop/nf-adsprop-adspropcreatenotifyobj) function to create the notification object.</span></span> <span data-ttu-id="02cf7-188">La funzione di esempio **CreateADsNotificationObject** nel [codice di esempio per l'implementazione dell'oggetto com della finestra delle proprietà](example-code-for-implementation-of-the-property-sheet-com-object.md) illustra come eseguire questa operazione in modo corretto, oltre che essere compatibile con le versioni precedenti dello snap-in che non supportano le finestre delle proprietà a selezione multifunzione.</span><span class="sxs-lookup"><span data-stu-id="02cf7-188">The **CreateADsNotificationObject** example function in [Example Code for Implementation of the Property Sheet COM Object](example-code-for-implementation-of-the-property-sheet-com-object.md) demonstrates how to do this correctly, as well as being compatible with earlier versions of the snap-in that do not support multi-selection property sheets.</span></span>

<span data-ttu-id="02cf7-189">Per le finestre delle proprietà a selezione multipla, il sistema viene associato solo al primo oggetto nella matrice [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-189">For multiple-selection property sheets, the system only binds to the first object in the [**DSOBJECT**](/windows/desktop/api/Dsclient/ns-dsclient-dsobject) array.</span></span> <span data-ttu-id="02cf7-190">Per questo motivo, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) fornisce solo gli attributi [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) e Write-able per il primo oggetto nella matrice.</span><span class="sxs-lookup"><span data-stu-id="02cf7-190">Because of this, [**ADsPropGetInitInfo**](/windows/desktop/api/Adsprop/nf-adsprop-adspropgetinitinfo) only supplies the [**IDirectoryObject**](/windows/desktop/api/iads/nn-iads-idirectoryobject) and write-able attributes for the first object in the array.</span></span> <span data-ttu-id="02cf7-191">Gli altri oggetti nella matrice non sono associati a.</span><span class="sxs-lookup"><span data-stu-id="02cf7-191">The other objects in the array are not bound to.</span></span>

<span data-ttu-id="02cf7-192">Un'estensione della finestra delle proprietà a selezione multipla è registrata nell'attributo [**adminMultiselectPropertyPages**](/windows/desktop/ADSchema/a-adminmultiselectpropertypages) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-192">A multiple-selection property sheet extension is registered under the [**adminMultiselectPropertyPages**](/windows/desktop/ADSchema/a-adminmultiselectpropertypages) attribute.</span></span>

## <a name="new-with-windows-server-2003"></a><span data-ttu-id="02cf7-193">Novità con Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="02cf7-193">New with Windows Server 2003</span></span>

<span data-ttu-id="02cf7-194">Di seguito sono riportate le nuove funzionalità di Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="02cf7-194">The following features are new with Windows Server 2003.</span></span>

<span data-ttu-id="02cf7-195">Se la pagina delle proprietà rileva un errore, è possibile chiamare [**ADsPropSendErrorMessage**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsenderrormessage) con i dati di errore appropriati.</span><span class="sxs-lookup"><span data-stu-id="02cf7-195">If the property page encounters an error, [**ADsPropSendErrorMessage**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsenderrormessage) can be called with the appropriate error data.</span></span> <span data-ttu-id="02cf7-196">In **ADsPropSendErrorMessage** vengono archiviati tutti i messaggi di errore in una coda.</span><span class="sxs-lookup"><span data-stu-id="02cf7-196">**ADsPropSendErrorMessage** will store all error messages in a queue.</span></span> <span data-ttu-id="02cf7-197">Questi messaggi verranno visualizzati la volta successiva che viene chiamato [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-197">These messages will be displayed the next time [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) is called.</span></span> <span data-ttu-id="02cf7-198">Quando **ADsPropShowErrorDialog** restituisce, i messaggi in coda vengono eliminati.</span><span class="sxs-lookup"><span data-stu-id="02cf7-198">When **ADsPropShowErrorDialog** returns, the queued messages are deleted.</span></span>

<span data-ttu-id="02cf7-199">Windows Server 2003 introduce la funzione [**ADsPropSetHwndWithTitle**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwndwithtitle) .</span><span class="sxs-lookup"><span data-stu-id="02cf7-199">Windows Server 2003 introduces the [**ADsPropSetHwndWithTitle**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwndwithtitle) function.</span></span> <span data-ttu-id="02cf7-200">Questa funzione è simile a [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd), ma include il titolo della pagina.</span><span class="sxs-lookup"><span data-stu-id="02cf7-200">This function is similar to [**ADsPropSetHwnd**](/windows/desktop/api/Adsprop/nf-adsprop-adspropsethwnd), but includes the page title.</span></span> <span data-ttu-id="02cf7-201">In questo modo viene abilitata la finestra di dialogo di errore visualizzata da [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) per fornire dati più utili all'utente.</span><span class="sxs-lookup"><span data-stu-id="02cf7-201">This enables the error dialog box displayed by [**ADsPropShowErrorDialog**](/windows/desktop/api/Adsprop/nf-adsprop-adspropshowerrordialog) to provide more useful data to the user.</span></span> <span data-ttu-id="02cf7-202">Se l'estensione della finestra delle proprietà utilizza la funzione **ADsPropShowErrorDialog** , l'estensione deve utilizzare **ADsPropSetHwndWithTitle** anziché **ADsPropSetHwnd**.</span><span class="sxs-lookup"><span data-stu-id="02cf7-202">If the property sheet extension uses the **ADsPropShowErrorDialog** function, the extension should use **ADsPropSetHwndWithTitle** rather than **ADsPropSetHwnd**.</span></span>

## <a name="related-topics"></a><span data-ttu-id="02cf7-203">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="02cf7-203">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="02cf7-204">Codice di esempio per l'implementazione dell'oggetto COM della finestra delle proprietà</span><span class="sxs-lookup"><span data-stu-id="02cf7-204">Example Code for Implementation of the Property Sheet COM Object</span></span>](example-code-for-implementation-of-the-property-sheet-com-object.md)
</dt> </dl>

 

 