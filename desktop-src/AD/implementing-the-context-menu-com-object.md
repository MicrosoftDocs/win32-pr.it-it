---
title: Implementazione dell'oggetto COM del menu di scelta rapida
description: Un'estensione del menu di scelta rapida è un oggetto COM implementato come server in-process.
ms.assetid: 362dd8e5-1518-4bf4-ac53-115263cd6c62
ms.tgt_platform: multiple
keywords:
- oggetto COM del menu di scelta rapida
- oggetto COM del menu di scelta rapida, implementazione
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a34d6b487d130327b379ed845f2d0157f2b28056
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/17/2020
ms.locfileid: "106299569"
---
# <a name="implementing-the-context-menu-com-object"></a><span data-ttu-id="b5227-105">Implementazione dell'oggetto COM del menu di scelta rapida</span><span class="sxs-lookup"><span data-stu-id="b5227-105">Implementing the Context Menu COM Object</span></span>

<span data-ttu-id="b5227-106">Un'estensione del menu di scelta rapida è un oggetto COM implementato come server in-process.</span><span class="sxs-lookup"><span data-stu-id="b5227-106">A context menu extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="b5227-107">L'estensione del menu di scelta rapida deve implementare le interfacce [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) e [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) .</span><span class="sxs-lookup"><span data-stu-id="b5227-107">The context menu extension must implement the [**IShellExtInit**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-ishellextinit) and [**IContextMenu**](/windows/win32/api/shobjidl_core/nn-shobjidl_core-icontextmenu) interfaces.</span></span> <span data-ttu-id="b5227-108">Viene creata un'istanza dell'estensione del menu di scelta rapida quando l'utente Visualizza il menu di scelta rapida per un oggetto di una classe per la quale è stata registrata l'estensione del menu di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="b5227-108">A context menu extension is instantiated when the user displays the context menu for an object of a class for which the context menu extension has been registered.</span></span>

## <a name="implementing-ishellextinit"></a><span data-ttu-id="b5227-109">Implementazione di IShellExtInit</span><span class="sxs-lookup"><span data-stu-id="b5227-109">Implementing IShellExtInit</span></span>

<span data-ttu-id="b5227-110">Quando viene creata un'istanza dell'oggetto COM dell'estensione del menu di scelta rapida, viene chiamato il metodo [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) .</span><span class="sxs-lookup"><span data-stu-id="b5227-110">After the context menu extension COM object is instantiated, the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method is called.</span></span> <span data-ttu-id="b5227-111">**IShellExtInit:: Initialize** fornisce l'estensione del menu di scelta rapida con un oggetto [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) che contiene i dati pertinenti all'oggetto directory a cui si applica il menu di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="b5227-111">**IShellExtInit::Initialize** supplies the context menu extension with an [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) object that contains data pertinent to the directory object that the context menu applies to.</span></span>

<span data-ttu-id="b5227-112">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contiene i dati nel formato [**CFSTR \_ DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) .</span><span class="sxs-lookup"><span data-stu-id="b5227-112">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contains data in the [**CFSTR\_DSOBJECTNAMES**](/previous-versions/windows/desktop/mmc/cfstr-dsobjectnames-clipboard-format) format.</span></span> <span data-ttu-id="b5227-113">Il formato dati **CFSTR \_ DSOBJECTNAMES** è un **HGLOBAL** che contiene una struttura [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) .</span><span class="sxs-lookup"><span data-stu-id="b5227-113">The **CFSTR\_DSOBJECTNAMES** data format is an **HGLOBAL** that contains a [**DSOBJECTNAMES**](/windows/desktop/api/Dsclient/ns-dsclient-dsobjectnames) structure.</span></span> <span data-ttu-id="b5227-114">La struttura **DSOBJECTNAMES** contiene i dati relativi all'oggetto directory a cui viene applicata l'estensione della finestra delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="b5227-114">The **DSOBJECTNAMES** structure contains data about the directory object that the property sheet extension applies to.</span></span>

<span data-ttu-id="b5227-115">[**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) contiene inoltre dati nel formato delle [**Opzioni di \_ visualizzazione delle \_ \_ specifiche \_ di CFSTR DS**](cfstr-ds-display-spec-options.md) .</span><span class="sxs-lookup"><span data-stu-id="b5227-115">The [**IDataObject**](/windows/win32/api/objidl/nn-objidl-idataobject) also contains data in the [**CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS**](cfstr-ds-display-spec-options.md) format.</span></span> <span data-ttu-id="b5227-116">Il formato dei dati delle **\_ \_ \_ \_ Opzioni di visualizzazione di CFSTR DS** è un **HGLOBAL** che contiene una struttura [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) .</span><span class="sxs-lookup"><span data-stu-id="b5227-116">The **CFSTR\_DS\_DISPLAY\_SPEC\_OPTIONS** data format is an **HGLOBAL** that contains a [**DSDISPLAYSPECOPTIONS**](/windows/desktop/api/Dsclient/ns-dsclient-dsdisplayspecoptions) structure.</span></span> <span data-ttu-id="b5227-117">**DSDISPLAYSPECOPTIONS** contiene i dati di configurazione per l'utilizzo da parte dell'estensione.</span><span class="sxs-lookup"><span data-stu-id="b5227-117">The **DSDISPLAYSPECOPTIONS** contains configuration data for use by the extension.</span></span>

<span data-ttu-id="b5227-118">Se un valore diverso da **S \_ OK** viene restituito da [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), l'estensione del menu di scelta rapida non verrà utilizzata.</span><span class="sxs-lookup"><span data-stu-id="b5227-118">If any value other than **S\_OK** is returned from [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize), the context menu extension will not be used.</span></span>

<span data-ttu-id="b5227-119">I parametri *pidlFolder* e *HkeyProgID* del metodo [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) non vengono usati.</span><span class="sxs-lookup"><span data-stu-id="b5227-119">The *pidlFolder* and *hkeyProgID* parameters of the [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) method are not used.</span></span>

## <a name="implementing-icontextmenu"></a><span data-ttu-id="b5227-120">Implementazione di IContextMenu</span><span class="sxs-lookup"><span data-stu-id="b5227-120">Implementing IContextMenu</span></span>

<span data-ttu-id="b5227-121">Dopo che [**IShellExtInit:: Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) restituisce, viene chiamato il metodo [**IContextMenu:: QueryContextMenu**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) per ottenere la voce di menu o gli elementi che verrà aggiunta dall'estensione del menu di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="b5227-121">After [**IShellExtInit::Initialize**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-ishellextinit-initialize) returns, the [**IContextMenu::QueryContextMenu**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-querycontextmenu) method is called to obtain the menu item or items that the context menu extension will add.</span></span> <span data-ttu-id="b5227-122">L'implementazione di **QueryContextMenu** è piuttosto semplice.</span><span class="sxs-lookup"><span data-stu-id="b5227-122">The **QueryContextMenu** implementation is fairly straightforward.</span></span> <span data-ttu-id="b5227-123">L'estensione del menu di scelta rapida aggiunge le voci di menu utilizzando [**InsertMenuItem**](/windows/win32/api/winuser/nf-winuser-insertmenuitema) o una funzione simile.</span><span class="sxs-lookup"><span data-stu-id="b5227-123">The context menu extension adds its menu items using the [**InsertMenuItem**](/windows/win32/api/winuser/nf-winuser-insertmenuitema) or similar function.</span></span> <span data-ttu-id="b5227-124">Gli identificatori dei comandi di menu devono essere maggiori o uguali a *idCmdFirst* e devono essere minori di *idCmdLast*.</span><span class="sxs-lookup"><span data-stu-id="b5227-124">The menu command identifiers must be greater than or equal to *idCmdFirst* and must be less than *idCmdLast*.</span></span> <span data-ttu-id="b5227-125">**QueryContextMenu** deve restituire l'identificatore numerico più grande aggiunto al menu più uno.</span><span class="sxs-lookup"><span data-stu-id="b5227-125">**QueryContextMenu** must return the greatest numeric identifier added to the menu plus one.</span></span> <span data-ttu-id="b5227-126">Il modo migliore per assegnare gli identificatori dei comandi di menu è iniziare da zero e lavorare in sequenza.</span><span class="sxs-lookup"><span data-stu-id="b5227-126">The best way to assign menu command identifiers is to start at zero and work up in sequence.</span></span> <span data-ttu-id="b5227-127">Se l'estensione del menu di scelta rapida non richiede alcuna voce di menu, non deve semplicemente aggiungere elementi al menu e restituire zero da **QueryContextMenu**.</span><span class="sxs-lookup"><span data-stu-id="b5227-127">If the context menu extension does not need to any menu items, it should simply not add any items to the menu and return zero from **QueryContextMenu**.</span></span>

<span data-ttu-id="b5227-128">[**IContextMenu:: GetCommandString**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-getcommandstring) viene chiamato per recuperare i dati testuali per la voce di menu, ad esempio il testo della guida da visualizzare per la voce di menu.</span><span class="sxs-lookup"><span data-stu-id="b5227-128">[**IContextMenu::GetCommandString**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-getcommandstring) is called to retrieve textual data for the menu item, such as help text to be displayed for the menu item.</span></span> <span data-ttu-id="b5227-129">È possibile che l'host del menu di scelta rapida usi stringhe Unicode mentre l'estensione usa stringhe ANSI.</span><span class="sxs-lookup"><span data-stu-id="b5227-129">It is possible that the context menu host will use Unicode strings while the extension uses ANSI strings.</span></span> <span data-ttu-id="b5227-130">Per questo motivo, i case **cataloghi globali \_ HELPTEXTA**, **cataloghi globali \_ HELPTEXTW**, cataloghi **globali \_ Verba** e **cataloghi globali \_ VERBW** devono essere gestiti singolarmente.</span><span class="sxs-lookup"><span data-stu-id="b5227-130">Because of this, the **GCS\_HELPTEXTA**, **GCS\_HELPTEXTW**, **GCS\_VERBA** and **GCS\_VERBW** cases must be handled individually.</span></span> <span data-ttu-id="b5227-131">L'implementazione di questo metodo è facoltativa.</span><span class="sxs-lookup"><span data-stu-id="b5227-131">Implementation of this method is optional.</span></span>

<span data-ttu-id="b5227-132">[**IContextMenu:: InvokeCommand**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) viene chiamato quando viene selezionata una delle voci di menu installate dall'estensione del menu di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="b5227-132">[**IContextMenu::InvokeCommand**](/windows/win32/api/shobjidl_core/nf-shobjidl_core-icontextmenu-invokecommand) is called when one of the menu items installed by the context menu extension is selected.</span></span> <span data-ttu-id="b5227-133">Il menu di scelta rapida consente di eseguire o avviare le azioni desiderate in risposta a questo metodo.</span><span class="sxs-lookup"><span data-stu-id="b5227-133">The context menu performs or initiates the desired actions in response to this method.</span></span>

 

 