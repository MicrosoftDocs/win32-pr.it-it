---
title: Polling delle modifiche tramite USNChanged
description: Le modifiche da Active Directory possono essere ottenute anche eseguendo una query sull'attributo uSNChanged, che evita le limitazioni del controllo DirSync.
ms.assetid: 83bda359-09e5-4abf-8f60-9c63bccfcdd1
ms.tgt_platform: multiple
keywords:
- Polling delle modifiche tramite USNChanged AD
- USNChanged AD
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a8e062c84fae575f837f45d78be7c92e5e284c1e
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/17/2020
ms.locfileid: "103872277"
---
# <a name="polling-for-changes-using-usnchanged"></a><span data-ttu-id="226d2-105">Polling delle modifiche tramite USNChanged</span><span class="sxs-lookup"><span data-stu-id="226d2-105">Polling for Changes Using USNChanged</span></span>

<span data-ttu-id="226d2-106">Il controllo DirSync è potente ed efficiente, ma presenta due limitazioni significative:</span><span class="sxs-lookup"><span data-stu-id="226d2-106">The DirSync control is powerful and efficient, but has two significant limitations:</span></span>

-   <span data-ttu-id="226d2-107">Solo per le applicazioni con privilegi elevati: per usare il controllo DirSync, un'applicazione deve essere eseguita con un account che disponga del privilegio **\_ \_ \_ nome agente di sincronizzazione se** nel controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="226d2-107">Only for highly privileged applications: To use the DirSync control, an application must run under an account that has the **SE\_SYNC\_AGENT\_NAME** privilege on the domain controller.</span></span> <span data-ttu-id="226d2-108">Pochi account hanno privilegi elevati, pertanto un'applicazione che utilizza il controllo DirSync non può essere eseguita da utenti normali.</span><span class="sxs-lookup"><span data-stu-id="226d2-108">Few accounts are so highly privileged, so an application that uses the DirSync control cannot be run by ordinary users.</span></span>
-   <span data-ttu-id="226d2-109">Nessun ambito del sottoalbero: il controllo DirSync restituisce tutte le modifiche che si verificano all'interno di un contesto dei nomi.</span><span class="sxs-lookup"><span data-stu-id="226d2-109">No subtree scoping: The DirSync control returns all changes that occur within a naming context.</span></span> <span data-ttu-id="226d2-110">Un'applicazione interessata solo alle modifiche che si verificano in un piccolo sottoalbero di un contesto dei nomi deve guadare molte modifiche irrilevanti, il che risulta inefficiente sia per l'applicazione sia per il controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="226d2-110">An application interested only in changes that occur in a small subtree of a naming context must wade through many irrelevant changes, which is inefficient both for the application and for the domain controller.</span></span>

<span data-ttu-id="226d2-111">Le modifiche da Active Directory possono essere ottenute anche eseguendo una query sull'attributo [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) , che evita le limitazioni del controllo DirSync.</span><span class="sxs-lookup"><span data-stu-id="226d2-111">Changes from Active Directory can also be obtained by querying the [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute, which avoids the limitations of the DirSync control.</span></span> <span data-ttu-id="226d2-112">Questa alternativa non è preferibile rispetto al controllo DirSync, perché comporta la trasmissione di tutti gli attributi quando viene modificato un attributo e richiede più lavoro da parte dello sviluppatore di applicazioni per gestire correttamente determinati scenari di errore.</span><span class="sxs-lookup"><span data-stu-id="226d2-112">This alternative is not better than the DirSync control in all respects because it involves transmitting all attributes when any attribute changes and it requires more work from the application developer to handle certain failure scenarios correctly.</span></span> <span data-ttu-id="226d2-113">Attualmente, il modo migliore per scrivere alcune applicazioni di rilevamento delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="226d2-113">It is, currently, the best way to write certain change-tracking applications.</span></span>

<span data-ttu-id="226d2-114">Quando un controller di dominio modifica un oggetto, imposta l'attributo [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) dell'oggetto su un valore maggiore del valore precedente dell'attributo **uSNChanged** per quell'oggetto e maggiore del valore corrente dell'attributo **uSNChanged** per tutti gli altri oggetti contenuti in tale controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="226d2-114">When a domain controller modifies an object it sets that object's [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute to a value that is larger than the previous value of the **uSNChanged** attribute for that object, and larger than the current value of the **uSNChanged** attribute for all other objects held on that domain controller.</span></span> <span data-ttu-id="226d2-115">Di conseguenza, un'applicazione può trovare l'oggetto modificato più di recente in un controller di dominio individuando l'oggetto con il valore **uSNChanged** più grande.</span><span class="sxs-lookup"><span data-stu-id="226d2-115">As a consequence, an application can find the most recently changed object on a domain controller by finding the object with the largest **uSNChanged** value.</span></span> <span data-ttu-id="226d2-116">Il secondo oggetto modificato più di recente in un controller di dominio avrà il secondo valore **uSNChanged** più grande e così via.</span><span class="sxs-lookup"><span data-stu-id="226d2-116">The second most recently changed object on a domain controller will have the second largest **uSNChanged** value, and so on.</span></span>

<span data-ttu-id="226d2-117">L'attributo [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) non viene replicato, pertanto la lettura dell'attributo **uSNChanged** di un oggetto in due controller di dominio diversi fornirà in genere valori diversi.</span><span class="sxs-lookup"><span data-stu-id="226d2-117">The [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute is not replicated, therefore reading an object's **uSNChanged** attribute at two different domain controllers will typically give different values.</span></span>

<span data-ttu-id="226d2-118">Ad esempio, l'attributo [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) può essere usato per tenere traccia delle modifiche in un sottoalbero. Eseguire prima di tutto una "sincronizzazione completa" del sottoalbero. si supponga che il valore **uSNChanged** più grande per qualsiasi oggetto in S sia U. periodicamente eseguire una query per tutti gli oggetti nel sottoalbero s il cui valore **uSNChanged** è maggiore di U. La query restituirà tutti gli oggetti che sono stati modificati dopo la sincronizzazione completa. Impostare la **uSNChanged** più grande tra questi oggetti modificati e si è pronti per eseguire nuovamente il polling.</span><span class="sxs-lookup"><span data-stu-id="226d2-118">For example, the [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute can be used to track changes in a subtree S. First, perform a "full sync" of the subtree S. Suppose the largest **uSNChanged** value for any object in S is U. Periodically query for all objects in subtree S whose **uSNChanged** value is greater than U. The query will return all objects that have changed since the full sync. Set U to the largest **uSNChanged** among these changed objects, and you are ready to poll again.</span></span>

<span data-ttu-id="226d2-119">Le sottigliezze dell'implementazione di un'applicazione di sincronizzazione [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) includono:</span><span class="sxs-lookup"><span data-stu-id="226d2-119">The subtleties of implementing a [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) synchronization application include:</span></span>

-   <span data-ttu-id="226d2-120">Usare l'attributo **highestCommittedUSN** di RootDSE per associare i filtri [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) .</span><span class="sxs-lookup"><span data-stu-id="226d2-120">Use the **highestCommittedUSN** attribute of rootDSE to bound your [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) filters.</span></span> <span data-ttu-id="226d2-121">Ovvero, prima di avviare una sincronizzazione completa, leggere il **highestCommittedUSN** del controller di dominio affiliato.</span><span class="sxs-lookup"><span data-stu-id="226d2-121">That is, before starting a full sync, read the **highestCommittedUSN** of your affiliated domain controller.</span></span> <span data-ttu-id="226d2-122">Eseguire quindi una query di sincronizzazione completa (usando i risultati di paging) per inizializzare il database.</span><span class="sxs-lookup"><span data-stu-id="226d2-122">Then, perform a full synchronization query (using paged results) to initialize the database.</span></span> <span data-ttu-id="226d2-123">Al termine dell'operazione, archiviare il valore **highestCommittedUSN** letto prima della query di sincronizzazione completa; da utilizzare come limiti inferiori dell'attributo **uSNChanged** per la sincronizzazione successiva.</span><span class="sxs-lookup"><span data-stu-id="226d2-123">When this is complete, store the **highestCommittedUSN** value read before the full sync query; to use as the lower bounds of the **uSNChanged** attribute for the next synchronization.</span></span> <span data-ttu-id="226d2-124">Successivamente, per eseguire una sincronizzazione incrementale, rileggere l'attributo RootDSE di **highestCommittedUSN** .</span><span class="sxs-lookup"><span data-stu-id="226d2-124">Later, to perform an incremental synchronization, reread the **highestCommittedUSN** rootDSE attribute.</span></span> <span data-ttu-id="226d2-125">Quindi eseguire una query per gli oggetti rilevanti, usando i risultati di paging, il cui **uSNChanged** è maggiore dei limiti inferiori del valore dell'attributo **uSNChanged** salvato dalla sincronizzazione precedente.</span><span class="sxs-lookup"><span data-stu-id="226d2-125">Then query for relevant objects, using paged results, whose **uSNChanged** is greater than the lower bounds of the **uSNChanged** attribute value saved from the previous synchronization.</span></span> <span data-ttu-id="226d2-126">Aggiornare il database usando queste informazioni.</span><span class="sxs-lookup"><span data-stu-id="226d2-126">Update the database using this information.</span></span> <span data-ttu-id="226d2-127">Al termine, aggiornare i limiti inferiori dell'attributo **uSNChanged** dal valore **highestCommittedUSN** letto prima della query di sincronizzazione incrementale.</span><span class="sxs-lookup"><span data-stu-id="226d2-127">When complete, update the lower bounds of the **uSNChanged** attribute from the **highestCommittedUSN** value read before the incremental synchronization query.</span></span> <span data-ttu-id="226d2-128">Archiviare sempre i limiti inferiori del valore dell'attributo **uSNChanged** nella stessa archiviazione che l'applicazione sta sincronizzando con il contenuto del controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="226d2-128">Always store the lower bounds of the **uSNChanged** attribute value in the same storage that the application is synchronizing with the domain controller content.</span></span>

    <span data-ttu-id="226d2-129">Attenendosi a questa procedura, anziché a quella basata sui valori [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) sugli oggetti recuperati, evita di riesaminare gli oggetti aggiornati che non rientrano nel set applicabile all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="226d2-129">Following this procedure, rather than that based on [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) values on retrieved objects, avoids making the server reexamine updated objects that fall outside the set that is applicable to the application.</span></span>

-   <span data-ttu-id="226d2-130">Poiché [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) è un attributo non replicato, l'applicazione deve essere associata allo stesso controller di dominio ogni volta che viene eseguita.</span><span class="sxs-lookup"><span data-stu-id="226d2-130">Because [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) is a non-replicated attribute, the application must bind to the same domain controller every time it runs.</span></span> <span data-ttu-id="226d2-131">Se non è possibile eseguire l'associazione a tale controller di dominio, è necessario attendere fino a quando non è possibile eseguire questa operazione oppure affiliare un nuovo controller di dominio ed eseguire una sincronizzazione completa con tale controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="226d2-131">If it cannot bind to that domain controller it must either wait until it can do so, or affiliate with some new domain controller and perform a full synchronization with that domain controller.</span></span> <span data-ttu-id="226d2-132">Quando l'applicazione è affiliata a un controller di dominio, registra il nome DNS del controller di dominio in una risorsa di archiviazione stabile, ovvero lo stesso spazio di archiviazione mantenuto coerente con il contenuto del controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="226d2-132">When the application affiliates with a domain controller it records the DNS name of that domain controller in stable storage, which is the same storage it is keeping consistent with the domain controller content.</span></span> <span data-ttu-id="226d2-133">USA quindi il nome DNS archiviato per eseguire il binding allo stesso controller di dominio per le sincronizzazioni successive.</span><span class="sxs-lookup"><span data-stu-id="226d2-133">Then it uses the stored DNS name to bind to the same domain controller for subsequent synchronizations.</span></span>
-   <span data-ttu-id="226d2-134">L'applicazione deve rilevare quando il controller di dominio a cui è attualmente affiliata è stato ripristinato dal backup, perché ciò può causare incoerenze.</span><span class="sxs-lookup"><span data-stu-id="226d2-134">The application must detect when the domain controller it is currently affiliated with has been restored from backup, because this can cause inconsistency.</span></span> <span data-ttu-id="226d2-135">Quando l'applicazione è affiliata a un controller di dominio, memorizza nella cache il "ID chiamata" del controller di dominio in una risorsa di archiviazione stabile, ovvero lo stesso spazio di archiviazione mantenuto coerente con il contenuto del controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="226d2-135">When the application affiliates with a domain controller it caches the "invocation id" of that domain controller in stable storage, that is, the same storage it is keeping consistent with the domain controller content.</span></span> <span data-ttu-id="226d2-136">Il "ID chiamata" di un controller di dominio è un GUID archiviato nell'attributo **invocationID** dell'oggetto servizio del controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="226d2-136">The "invocation id" of a domain controller is a GUID stored in the **invocationID** attribute of the domain controller's service object.</span></span> <span data-ttu-id="226d2-137">Per ottenere il nome distinto di un oggetto servizio del controller di dominio, leggere l'attributo **dsServiceName** di RootDSE.</span><span class="sxs-lookup"><span data-stu-id="226d2-137">To get the distinguished name of a domain controller's service object, read the **dsServiceName** attribute of the rootDSE.</span></span>

    <span data-ttu-id="226d2-138">Tenere presente che quando l'archiviazione stabile dell'applicazione viene ripristinata dal backup, non sono presenti problemi di coerenza perché il nome del controller di dominio, l'ID di chiamata e i limiti inferiori del valore dell'attributo [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) vengono archiviati con i dati sincronizzati con il contenuto del controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="226d2-138">Be aware that when the application's stable storage is restored from backup there are no consistency problems because the domain controller name, invocation id, and lower bounds of the [**uSNChanged**](/windows/desktop/ADSchema/a-usnchanged) attribute value are stored with the data synchronized with the domain controller content.</span></span>

-   <span data-ttu-id="226d2-139">Utilizzare il paging quando si eseguono query sul server, sia le sincronizzazioni complete che quelle incrementali, per evitare la possibilità di recuperare contemporaneamente set di risultati di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="226d2-139">Use paging when querying the server, both full and incremental synchronizations, to avoid the possibility of retrieving large result sets simultaneously.</span></span> <span data-ttu-id="226d2-140">Per ulteriori informazioni, vedere [specifica di altre opzioni di ricerca](specifying-other-search-options.md).</span><span class="sxs-lookup"><span data-stu-id="226d2-140">For more information, see [Specifying Other Search Options](specifying-other-search-options.md).</span></span>
-   <span data-ttu-id="226d2-141">Eseguire query basate sugli indici per evitare di forzare il server a archiviare risultati intermedi di grandi dimensioni quando si utilizzano risultati di paging.</span><span class="sxs-lookup"><span data-stu-id="226d2-141">Perform index-based queries to avoid forcing the server to store large intermediate results when using paged results.</span></span> <span data-ttu-id="226d2-142">Per ulteriori informazioni, vedere [attributi indicizzati](indexed-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="226d2-142">For more information, see [Indexed Attributes](indexed-attributes.md).</span></span>
-   <span data-ttu-id="226d2-143">In generale, non usare l'ordinamento lato server dei risultati della ricerca, che può forzare il server a archiviare e ordinare i risultati intermedi di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="226d2-143">In general, do not use server-side sorting of search results, which can force the server to store and sort large intermediate results.</span></span> <span data-ttu-id="226d2-144">Si applica alle sincronizzazioni complete e incrementali.</span><span class="sxs-lookup"><span data-stu-id="226d2-144">This applies to both full and incremental synchronizations.</span></span> <span data-ttu-id="226d2-145">Per ulteriori informazioni, vedere [specifica di altre opzioni di ricerca](specifying-other-search-options.md).</span><span class="sxs-lookup"><span data-stu-id="226d2-145">For more information, see [Specifying Other Search Options](specifying-other-search-options.md).</span></span>
-   <span data-ttu-id="226d2-146">Non gestire correttamente le condizioni padre.</span><span class="sxs-lookup"><span data-stu-id="226d2-146">Handle no parent conditions gracefully.</span></span> <span data-ttu-id="226d2-147">È possibile che l'applicazione riconosca un oggetto prima di aver riconosciuto il relativo padre.</span><span class="sxs-lookup"><span data-stu-id="226d2-147">The application may recognize an object before it has recognized its parent.</span></span> <span data-ttu-id="226d2-148">A seconda dell'applicazione, questo potrebbe non essere un problema.</span><span class="sxs-lookup"><span data-stu-id="226d2-148">Depending upon the application, this may or may not be a problem.</span></span> <span data-ttu-id="226d2-149">L'applicazione può sempre leggere lo stato corrente dell'elemento padre dalla directory.</span><span class="sxs-lookup"><span data-stu-id="226d2-149">The application can always read the current state of the parent from the directory.</span></span>
-   <span data-ttu-id="226d2-150">Per gestire gli oggetti spostati o eliminati, archiviare l'attributo [**objectGUID**](/windows/desktop/ADSchema/a-objectguid) di ogni oggetto rilevato.</span><span class="sxs-lookup"><span data-stu-id="226d2-150">To handle moved or deleted objects, store the [**objectGUID**](/windows/desktop/ADSchema/a-objectguid) attribute of each tracked object.</span></span> <span data-ttu-id="226d2-151">L'attributo **objectGUID** di un oggetto rimane invariato indipendentemente dalla posizione in cui viene spostato nell'insieme di strutture.</span><span class="sxs-lookup"><span data-stu-id="226d2-151">An object's **objectGUID** attribute remains unchanged regardless of where it is moved throughout the forest.</span></span>
-   <span data-ttu-id="226d2-152">Per gestire gli oggetti spostati, eseguire sincronizzazioni complete periodiche o aumentare l'ambito di ricerca e filtrare le modifiche non interessanti al termine del client.</span><span class="sxs-lookup"><span data-stu-id="226d2-152">To handle moved objects, either perform periodic full synchronizations or increase the search scope and filter out uninteresting changes at the client end.</span></span>
-   <span data-ttu-id="226d2-153">Per gestire gli oggetti eliminati, eseguire sincronizzazioni complete periodiche oppure eseguire una ricerca separata degli oggetti eliminati quando si esegue una sincronizzazione incrementale.</span><span class="sxs-lookup"><span data-stu-id="226d2-153">To handle deleted objects, either perform periodic full synchronizations or perform a separate search for deleted objects when you perform an incremental synchronization.</span></span> <span data-ttu-id="226d2-154">Quando si eseguono query sugli oggetti eliminati, recuperare il [**objectGUID**](/windows/desktop/ADSchema/a-objectguid) degli oggetti eliminati per determinare gli oggetti da eliminare dal database.</span><span class="sxs-lookup"><span data-stu-id="226d2-154">When you query for deleted objects, retrieve the [**objectGUID**](/windows/desktop/ADSchema/a-objectguid) of the deleted objects to determine the objects to delete from your database.</span></span> <span data-ttu-id="226d2-155">Per ulteriori informazioni, vedere [recupero di oggetti eliminati](retrieving-deleted-objects.md).</span><span class="sxs-lookup"><span data-stu-id="226d2-155">For more information, see [Retrieving Deleted Objects](retrieving-deleted-objects.md).</span></span>
-   <span data-ttu-id="226d2-156">Tenere presente che i risultati della ricerca includono solo gli oggetti e gli attributi che il chiamante è autorizzato a leggere (in base ai descrittori di sicurezza e agli elenchi DACL sui vari oggetti).</span><span class="sxs-lookup"><span data-stu-id="226d2-156">Be aware that the search results include only the objects and attributes that the caller has permission to read (based on the security descriptors and DACLs on the various objects).</span></span> <span data-ttu-id="226d2-157">Per ulteriori informazioni, vedere [effetti della protezione sulle query](effects-of-security-on-queries.md).</span><span class="sxs-lookup"><span data-stu-id="226d2-157">For more information, see [Effects of Security on Queries](effects-of-security-on-queries.md).</span></span>

<span data-ttu-id="226d2-158">Per ulteriori informazioni e un esempio di codice in cui vengono illustrate le nozioni di base di un'applicazione di sincronizzazione USNChanged, vedere il [codice di esempio per recuperare le modifiche utilizzando uSNChanged](example-code-to-retrieve-changes-using-usnchanged.md).</span><span class="sxs-lookup"><span data-stu-id="226d2-158">For more information, and a code example that shows the basics of a USNChanged synchronization application, see [Example Code to Retrieve Changes Using USNChanged](example-code-to-retrieve-changes-using-usnchanged.md).</span></span>

 

 