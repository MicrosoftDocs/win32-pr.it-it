---
title: Uso di DsAddSidHistory
description: In questo argomento viene descritto come utilizzare la funzione DsAddSidHistory.
ms.assetid: cbf4983c-551d-4771-870e-a192ed898eb7
ms.tgt_platform: multiple
keywords:
- Uso di DsAddSidHistory Active Directory
- Active Directory Active Directory, usando, usando DsAddSidHistory
- DsAddSidHistory Active Directory, utilizzo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3d45792dbd8c7a2bfa2dd047111a3ed165a2011e
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/16/2019
ms.locfileid: "103707510"
---
# <a name="using-dsaddsidhistory"></a><span data-ttu-id="9f6b6-106">Uso di DsAddSidHistory</span><span class="sxs-lookup"><span data-stu-id="9f6b6-106">Using DsAddSidHistory</span></span>

<span data-ttu-id="9f6b6-107">La funzione [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) Ottiene l'ID di sicurezza (SID) dell'account primario di un'entità di sicurezza da un dominio (il dominio di origine) e lo aggiunge all'attributo **sIDHistory** di un'entità di sicurezza in un altro dominio (di destinazione) in un'altra foresta.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-107">The [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) function gets the primary account security identifier (SID) of a security principal from one domain (the source domain) and adds it to the **sIDHistory** attribute of a security principal in another (destination) domain in a different forest.</span></span> <span data-ttu-id="9f6b6-108">Quando il dominio di origine è in modalità nativa di Windows 2000, questa funzione recupera anche i valori **sIDHistory** dell'entità di origine e li aggiunge al **sIDHistory** dell'entità di destinazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-108">When the source domain is in Windows 2000 native mode, this function also retrieves the **sIDHistory** values of the source principal and adds them to the destination principal's **sIDHistory**.</span></span>

<span data-ttu-id="9f6b6-109">L'aggiunta di SID a una **sIDHistory** dell'entità di sicurezza è un'operazione sensibile alla sicurezza che concede all'entità di destinazione l'accesso a tutte le risorse accessibili all'entità di origine, purché esistano dei trust dai domini delle risorse applicabili al dominio di destinazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-109">Adding SIDs to a security principal's **sIDHistory** is a security-sensitive operation that effectively grants to the destination principal access to all resources accessible to the source principal, provided that trusts exist from applicable resource domains to the destination domain.</span></span>

<span data-ttu-id="9f6b6-110">In un dominio Windows 2000 in modalità nativa un accesso utente crea un token di accesso che contiene il SID dell'account primario utente e i SID di gruppo, nonché l'utente **sIDHistory** e il **sIDHistory** dei gruppi di cui l'utente è membro.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-110">In a native mode Windows 2000 domain a user logon creates an access token that contains the user primary account SID and group SIDs, as well as the user **sIDHistory** and the **sIDHistory** of the groups of which the user is a member.</span></span> <span data-ttu-id="9f6b6-111">Con questi primi SID (valori **sIDHistory** ) nel token dell'utente viene concesso all'utente l'accesso alle risorse protette da elenchi di controllo di accesso (ACL) contenenti i SID precedenti.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-111">Having these former SIDs (**sIDHistory** values) in the user's token grants the user access to resources protected by access-control lists (ACLs) containing the former SIDs.</span></span>

<span data-ttu-id="9f6b6-112">Questa operazione facilita alcuni scenari di distribuzione di Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-112">This operation facilitates certain Windows 2000 deployment scenarios.</span></span> <span data-ttu-id="9f6b6-113">In particolare, supporta uno scenario in cui gli account in una nuova foresta di Windows 2000 vengono creati per gli utenti e i gruppi già presenti in un ambiente di produzione Windows NT 4,0.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-113">In particular, it supports a scenario in which accounts in a new Windows 2000 forest are created for users and groups that already exist in an Windows NT 4.0 production environment.</span></span> <span data-ttu-id="9f6b6-114">Inserendo il SID dell'account Windows NT 4,0 nell'account Windows 2000 **sIDHistory**, l'accesso alle risorse di rete viene mantenuto per l'accesso dell'utente al nuovo account Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-114">By placing the Windows NT 4.0 account SID in the Windows 2000 account **sIDHistory**, access to network resources is preserved for the user logging onto his new Windows 2000 account.</span></span>

<span data-ttu-id="9f6b6-115">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) supporta inoltre la migrazione di server di risorse i BDC (backup domain controller) windows NT 4,0 (o controller di dominio e server membro in un dominio Windows 2000 in modalità nativa) a un dominio Windows 2000 come server membro.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-115">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) also supports migration of Windows NT 4.0 backup domain controllers (BDCs) resource servers (or DCs and member servers in a native mode Windows 2000 domain) to a Windows 2000 domain as member servers.</span></span> <span data-ttu-id="9f6b6-116">Questa migrazione richiede la creazione, nel dominio Windows 2000 di destinazione, dei gruppi locali di dominio che contengono, nella rispettiva **sIDHistory**, i SID primari dei gruppi locali definiti in BDC (o gruppi locali di dominio a cui si fa riferimento negli ACL nei server Windows 2000) nel dominio di origine.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-116">This migration requires the creation, in the destination Windows 2000 domain, of domain local groups that contain, in their **sIDHistory**, the primary SIDs of the local groups defined on the BDC (or domain local groups referenced in ACLs on the Windows 2000 servers) in the source domain.</span></span> <span data-ttu-id="9f6b6-117">Creando un gruppo locale di destinazione contenente **sIDHistory** e tutti i membri del gruppo locale di origine, l'accesso alle risorse del server migrate, protetto da ACL che fanno riferimento al gruppo locale di origine, viene mantenuto per tutti i membri.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-117">By creating a destination local group containing the **sIDHistory** and all members of the source local group, access to the migrated server resources, protected by ACLs referencing the source local group, is maintained for all members.</span></span>

> [!Note]  
> <span data-ttu-id="9f6b6-118">L'uso di [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) richiede una comprensione delle implicazioni amministrative e di sicurezza più ampie in questi e in altri scenari.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-118">Use of [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires an understanding of its broader administrative and security implications in these and other scenarios.</span></span> <span data-ttu-id="9f6b6-119">Per ulteriori informazioni, vedere il white paper "pianificazione della migrazione da Windows NT a Microsoft Windows 2000", fornito come Dommig.doc negli strumenti di supporto di Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-119">For more information, see the white paper "Planning Migration from Windows NT to Microsoft Windows 2000", delivered as Dommig.doc in the Windows 2000 Support Tools.</span></span> <span data-ttu-id="9f6b6-120">Questa documentazione è disponibile anche nel CD del prodotto in \\ strumenti di supporto \\ .</span><span class="sxs-lookup"><span data-stu-id="9f6b6-120">This documentation may also be found on the product CD under \\support\\tools.</span></span>

 

## <a name="authorization-requirements"></a><span data-ttu-id="9f6b6-121">Requisiti di autorizzazione</span><span class="sxs-lookup"><span data-stu-id="9f6b6-121">Authorization Requirements</span></span>

<span data-ttu-id="9f6b6-122">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) richiede privilegi di amministratore nei domini di origine e di destinazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-122">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires administrator privileges in the source and destination domains.</span></span> <span data-ttu-id="9f6b6-123">In particolare, il chiamante di questa API deve essere membro del gruppo Domain Admins nel dominio di destinazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-123">Specifically, the caller of this API must be a member of the Domain Administrators group in the destination domain.</span></span> <span data-ttu-id="9f6b6-124">Viene eseguito un controllo hardcoded per l'appartenenza.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-124">A hard-coded check for this membership is performed.</span></span> <span data-ttu-id="9f6b6-125">Inoltre, il chiamante o l'account fornito nel parametro *SrcDomainCreds* , se non **null**, deve essere un membro del gruppo Administrators o Domain Administrators nel dominio di origine.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-125">Also, the caller or the account provided in the *SrcDomainCreds* parameter, if not **NULL**, must be a member of either the Administrators or Domain Administrators group in the source domain.</span></span>

## <a name="domain-and-trust-requirements"></a><span data-ttu-id="9f6b6-126">Requisiti di dominio e trust</span><span class="sxs-lookup"><span data-stu-id="9f6b6-126">Domain and Trust Requirements</span></span>

<span data-ttu-id="9f6b6-127">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) richiede che il dominio di destinazione sia in modalità nativa di Windows 2000 o versione successiva, perché solo questo tipo di dominio supporta l'attributo **sIDHistory** .</span><span class="sxs-lookup"><span data-stu-id="9f6b6-127">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires that the destination domain be in Windows 2000 native mode or later, because only this domain type supports the **sIDHistory** attribute.</span></span> <span data-ttu-id="9f6b6-128">Il dominio di origine può essere Windows NT 4,0 o Windows 2000, modalità mista o nativa.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-128">The source domain may be either Windows NT 4.0 or Windows 2000, mixed or native mode.</span></span> <span data-ttu-id="9f6b6-129">I domini di origine e di destinazione non devono trovarsi nella stessa foresta.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-129">The source and destination domains must not be in the same forest.</span></span> <span data-ttu-id="9f6b6-130">I domini di Windows NT 4,0 sono per definizione non in una foresta.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-130">Windows NT 4.0 domains are by definition not in a forest.</span></span> <span data-ttu-id="9f6b6-131">Questo vincolo tra foreste garantisce che i SID duplicati, che appaiono come SID primari o **sIDHistory** , non vengano creati nella stessa foresta.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-131">This inter-forest constraint ensures that duplicate SIDs, whether appearing as primary SIDs or **sIDHistory** values, are not created in the same forest.</span></span>

<span data-ttu-id="9f6b6-132">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) richiede un trust esterno dal dominio di origine al dominio di destinazione nei casi elencati nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-132">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires an external trust from the source domain to the destination domain in the cases listed in the following table.</span></span>



| <span data-ttu-id="9f6b6-133">Caso</span><span class="sxs-lookup"><span data-stu-id="9f6b6-133">Case</span></span>                                                                             | <span data-ttu-id="9f6b6-134">Descrizione</span><span class="sxs-lookup"><span data-stu-id="9f6b6-134">Description</span></span>                                                                                                                                                                                                                                                                 |
|----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="9f6b6-135">Il dominio di origine è Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-135">The source domain is Windows 2000.</span></span><br/>                                    | <span data-ttu-id="9f6b6-136">L'attributo di origine **sIDHistory** , disponibile solo nei domini di origine di Windows 2000, può essere letto solo usando LDAP, che richiede questo trust per la protezione dell'integrità.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-136">The source **sIDHistory** attribute, available only in Windows 2000 source domains, may be read only using LDAP, which requires this trust for integrity protection.</span></span><br/>                                                                                             |
| <span data-ttu-id="9f6b6-137">Il dominio di origine è Windows NT 4,0 e *SrcDomainCreds* è **null**.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-137">The source domain is Windows NT 4.0 and *SrcDomainCreds* is **NULL**.</span></span><br/> | <span data-ttu-id="9f6b6-138">La rappresentazione, necessaria per supportare le operazioni del dominio di origine usando le credenziali del chiamante, dipende da questa relazione di trust.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-138">The impersonation, required to support source domain operations using the caller's credentials, depends on this trust.</span></span> <span data-ttu-id="9f6b6-139">Per impostazione predefinita, la rappresentazione richiede anche che il controller di dominio di destinazione disponga di "trusted per la delega" abilitato per impostazione predefinita nei controller di dominio.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-139">Impersonation also requires that the destination domain controller has "Trusted for Delegation" enabled by default on domain controllers.</span></span><br/> |



 

<span data-ttu-id="9f6b6-140">Tuttavia, non è richiesta alcuna relazione di trust tra i domini di origine e di destinazione se il dominio di origine è Windows NT 4,0 e *SrcDomainCreds* non è **null**.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-140">However, there is no trust required between the source and destination domains if the source domain is Windows NT 4.0 and *SrcDomainCreds* is not **NULL**.</span></span>

## <a name="source-domain-controller-requirements"></a><span data-ttu-id="9f6b6-141">Requisiti del controller di dominio di origine</span><span class="sxs-lookup"><span data-stu-id="9f6b6-141">Source Domain Controller Requirements</span></span>

<span data-ttu-id="9f6b6-142">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) richiede che il controller di dominio, selezionato come destinazione per le operazioni nel dominio di origine, sia il PDC nei domini di windows NT 4,0 o l'emulatore PDC nei domini di Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-142">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) requires that the domain controller, selected as the target for operations in the source domain, be the PDC in Windows NT 4.0 domains or the PDC Emulator in Windows 2000 domains.</span></span> <span data-ttu-id="9f6b6-143">Il controllo del dominio di origine viene generato tramite operazioni di scrittura, pertanto il PDC è necessario nei domini di origine di Windows NT 4,0 e la restrizione solo PDC garantisce che i controlli **DsAddSidHistory** vengano generati in un singolo computer.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-143">Source domain auditing is generated by way of write operations, therefore, the PDC is required in Windows NT 4.0 source domains, and the PDC-only restriction ensures that **DsAddSidHistory** audits are generated on a single computer.</span></span> <span data-ttu-id="9f6b6-144">In questo modo si riduce la necessità di esaminare i log di controllo di tutti i controller di dominio per monitorare l'utilizzo di questa operazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-144">This reduces the need to review the audit logs of all DCs to monitor use of this operation.</span></span>

> [!Note]  
> <span data-ttu-id="9f6b6-145">Nei domini di origine di Windows NT 4,0, il PDC, ovvero la destinazione delle operazioni nel dominio di origine, deve eseguire Service Pack 4 (SP4) e versioni successive per garantire un corretto supporto del controllo.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-145">In Windows NT 4.0 source domains, the PDC (target of operations in the source domain) must be running Service Pack 4 (SP4) and later to ensure proper auditing support.</span></span>

 

<span data-ttu-id="9f6b6-146">Il valore del registro di sistema seguente deve essere creato come \_ valore reg DWORD e impostato su 1 sul controller di dominio di origine per i controller di dominio di origine Windows NT 4,0 e windows 2000.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-146">The following registry value must be created as a REG\_DWORD value and set to 1 on the source domain controller for both Windows NT 4.0 and Windows 2000 source DCs.</span></span>

```
HKEY_LOCAL_MACHINE
   System
      CurrentControlSet
         Control
            Lsa
               TcpipClientSupport
```

<span data-ttu-id="9f6b6-147">L'impostazione di questo valore Abilita le chiamate RPC sul trasporto TCP.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-147">Setting this value enables RPC calls over the TCP transport.</span></span> <span data-ttu-id="9f6b6-148">Questa operazione è necessaria perché, per impostazione predefinita, le interfacce SAMRPC sono utilizzabili in remoto solo su named pipe.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-148">This is required because, by default, SAMRPC interfaces are remotable only on named pipes.</span></span> <span data-ttu-id="9f6b6-149">L'utilizzo di named pipe genera un sistema di gestione delle credenziali appropriato per gli utenti connessi in modo interattivo che effettuano chiamate di rete, ma non è flessibile per un processo di sistema che effettua chiamate di rete con credenziali fornite dall'utente.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-149">Using named pipes results in a credential management system suitable for interactively logged-on users making networked calls, but is not flexible for a system process that makes network calls with user-supplied credentials.</span></span> <span data-ttu-id="9f6b6-150">RPC su TCP è più adatto a tale scopo.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-150">RPC over TCP is more suitable for that purpose.</span></span> <span data-ttu-id="9f6b6-151">L'impostazione di questo valore non diminuisce la sicurezza del sistema.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-151">Setting this value does not diminish system security.</span></span> <span data-ttu-id="9f6b6-152">Se questo valore viene creato o modificato, il controller di dominio di origine deve essere riavviato per rendere effettiva questa impostazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-152">If this value is created or changed, the source domain controller must be restarted for this setting to take effect.</span></span>

<span data-ttu-id="9f6b6-153">Un nuovo gruppo locale, " <SrcDomainName> $ $ $", deve essere creato nel dominio di origine a scopo di controllo.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-153">A new local group, "<SrcDomainName>$$$", must be created in the source domain for auditing purposes.</span></span>

## <a name="auditing"></a><span data-ttu-id="9f6b6-154">Controllo</span><span class="sxs-lookup"><span data-stu-id="9f6b6-154">Auditing</span></span>

<span data-ttu-id="9f6b6-155">Le operazioni [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) vengono controllate per assicurarsi che gli amministratori di dominio di origine e di destinazione siano in grado di rilevare il momento in cui questa funzione è stata eseguita.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-155">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) operations are audited to ensure that both source and destination domain administrators are able to detect when this function has been run.</span></span> <span data-ttu-id="9f6b6-156">Il controllo è obbligatorio nei domini di origine e di destinazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-156">Auditing is mandatory in both the source and destination domains.</span></span> <span data-ttu-id="9f6b6-157">**DsAddSidHistory** verifica che la modalità di controllo sia attiva in ogni dominio e che il controllo della gestione degli account degli eventi di esito positivo o negativo sia attiva.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-157">**DsAddSidHistory** verifies that the Audit Mode is on in each domain and that Account Management auditing of Success/Failure events is on.</span></span> <span data-ttu-id="9f6b6-158">Nel dominio di destinazione viene generato un evento di controllo "Aggiungi cronologia SID" univoco per ogni operazione **DsAddSidHistory** riuscita o non riuscita.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-158">In the destination domain, a unique "Add Sid History" audit event is generated for each successful or failed **DsAddSidHistory** operation.</span></span>

<span data-ttu-id="9f6b6-159">Gli eventi di controllo "Aggiungi cronologia SID" non sono disponibili nei sistemi Windows NT 4,0.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-159">Unique "Add Sid History" audit events are not available on Windows NT 4.0 systems.</span></span> <span data-ttu-id="9f6b6-160">Per generare eventi di controllo che riflettono in modo non ambiguo l'utilizzo di [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) nel dominio di origine, vengono eseguite operazioni su un gruppo speciale il cui nome è l'identificatore univoco nel log di controllo.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-160">To generate audit events that unambiguously reflect use of [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) against the source domain, it performs operations on a special group whose name is the unique identifier in the audit log.</span></span> <span data-ttu-id="9f6b6-161">Un gruppo locale, " <SrcDomainName> $ $ $", il cui nome è composto dal nome NetBIOS del dominio di origine aggiunto con tre simboli del dollaro ($) (codice ASCII = 0x24 e Unicode = U + 0024), deve essere creato nel controller di dominio di origine prima di chiamare **DsAddSidHistory**.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-161">A local group, "<SrcDomainName>$$$", whose name is composed of the source domain NetBIOS name appended with three dollar signs ($) (ASCII code = 0x24 and Unicode = U+0024), must be created on the source domain controller prior to calling **DsAddSidHistory**.</span></span> <span data-ttu-id="9f6b6-162">Ogni utente di origine e gruppo globale che è la destinazione di questa operazione viene aggiunto e quindi rimosso dall'appartenenza di questo gruppo.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-162">Each source user and global group that is a target of this operation is added to and then removed from the membership of this group.</span></span> <span data-ttu-id="9f6b6-163">In questo modo vengono generati gli eventi di controllo Aggiungi membro ed Elimina membro nel dominio di origine, che può essere monitorato cercando gli eventi che fanno riferimento al nome del gruppo.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-163">This generates Add Member and Delete Member audit events in the source domain, which can be monitored by searching for events that reference the group name.</span></span>

> [!Note]  
> <span data-ttu-id="9f6b6-164">Non è possibile controllare le operazioni [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) sui gruppi locali in un dominio di origine in modalità mista windows NT 4,0 o Windows 2000 perché i gruppi locali non possono essere membri di un altro gruppo locale e pertanto non possono essere aggiunti allo speciale <SrcDomainName> gruppo locale "$ $ $".</span><span class="sxs-lookup"><span data-stu-id="9f6b6-164">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) operations on local groups in a Windows NT 4.0, or Windows 2000 mixed-mode source domain cannot be audited because local groups cannot be made members of another local group and therefore cannot be added to the special "<SrcDomainName>$$$" local group.</span></span> <span data-ttu-id="9f6b6-165">Questa mancanza di controllo non presenta un problema di sicurezza per il dominio di origine, perché l'accesso alle risorse del dominio di origine non è influenzato da questa operazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-165">This lack of auditing does not present a security issue to the source domain, because source domain resource access is not affected by this operation.</span></span> <span data-ttu-id="9f6b6-166">L'aggiunta del SID di un gruppo locale di origine a un gruppo locale di destinazione non concede l'accesso alle risorse di origine, protette da tale gruppo locale, a tutti gli utenti aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-166">Adding the SID of a source local group to a destination local group does not grant access to source resources, protected by that local group, to any additional users.</span></span> <span data-ttu-id="9f6b6-167">L'aggiunta di membri al gruppo locale di destinazione non concede l'accesso alle risorse di origine.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-167">Adding members to the destination local group does not grant them access to source resources.</span></span> <span data-ttu-id="9f6b6-168">Ai membri aggiunti viene concesso l'accesso solo ai server nel dominio di destinazione migrati dal dominio di origine, che può avere risorse protette dal SID del gruppo locale di origine.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-168">Added members are granted access only to servers in the destination domain migrated from the source domain, which may have resources protected by the source local group SID.</span></span>

 

## <a name="data-transmission-security"></a><span data-ttu-id="9f6b6-169">Sicurezza della trasmissione dei dati</span><span class="sxs-lookup"><span data-stu-id="9f6b6-169">Data Transmission Security</span></span>

<span data-ttu-id="9f6b6-170">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) impone le misure di sicurezza seguenti:</span><span class="sxs-lookup"><span data-stu-id="9f6b6-170">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) enforces the following security measures:</span></span>

-   <span data-ttu-id="9f6b6-171">Chiamato da una workstation Windows 2000, le credenziali del chiamante vengono usate per l'autenticazione e la protezione della privacy per la chiamata RPC al controller di dominio di destinazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-171">Called from a Windows 2000 workstation, the caller's credentials are used to authenticate and privacy-protect the RPC call to the destination domain controller.</span></span> <span data-ttu-id="9f6b6-172">Se *SrcDomainCreds* non è **null**, sia la workstation che il controller di dominio di destinazione devono supportare la crittografia a 128 bit per la protezione della privacy.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-172">If *SrcDomainCreds* is not **NULL**, both the workstation and the destination DC must support 128-bit encryption to privacy-protect the credentials.</span></span> <span data-ttu-id="9f6b6-173">Se la crittografia a 128 bit non è disponibile e vengono specificati *SrcDomainCreds* , è necessario effettuare la chiamata nel controller di dominio di destinazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-173">If 128-bit encryption is not available and *SrcDomainCreds* are provided, then the call must be made on the destination DC.</span></span>
-   <span data-ttu-id="9f6b6-174">Il controller di dominio di destinazione comunica con il controller di dominio di origine utilizzando *SrcDomainCreds* o le credenziali del chiamante per autenticare reciprocamente e proteggere l'integrità la lettura del SID dell'account di origine (usando una ricerca Sam) e **sIDHistory** (usando una lettura LDAP).</span><span class="sxs-lookup"><span data-stu-id="9f6b6-174">The destination domain controller communicates with the source domain controller using either *SrcDomainCreds* or the caller's credentials to mutually authenticate and integrity-protect the read of the source account SID (using a SAM lookup) and **sIDHistory** (using an LDAP read).</span></span>

## <a name="threat-models"></a><span data-ttu-id="9f6b6-175">Modelli di rischio</span><span class="sxs-lookup"><span data-stu-id="9f6b6-175">Threat Models</span></span>

<span data-ttu-id="9f6b6-176">La tabella seguente elenca le minacce potenziali associate alla chiamata [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) e risolve le misure di sicurezza attinenti alla minaccia specifica.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-176">The following table lists the potential threats associated with the [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) call and addresses the security measures pertinent to the particular threat.</span></span>



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="9f6b6-177">Potenziale minaccia</span><span class="sxs-lookup"><span data-stu-id="9f6b6-177">Potential threat</span></span></th>
<th><span data-ttu-id="9f6b6-178">Misura di sicurezza</span><span class="sxs-lookup"><span data-stu-id="9f6b6-178">Security measure</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="9f6b6-179">Attacco man-in-the-Middle</span><span class="sxs-lookup"><span data-stu-id="9f6b6-179">Man in the Middle Attack</span></span><br/> <span data-ttu-id="9f6b6-180">Un utente non autorizzato intercetta il <em>SID di ricerca della chiamata return dell'oggetto di origine</em> , sostituendo il SID dell'oggetto di origine con un SID arbitrario per l'inserimento in un oggetto di destinazione sIDHistory.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-180">An unauthorized user intercepts the <em>lookup SID of source object</em> return call, replacing the source object SID with an arbitrary SID for insertion into a target object SIDhistory.</span></span><br/></td>
<td><span data-ttu-id="9f6b6-181">Il <em>SID di ricerca dell'oggetto di origine</em> è una RPC autenticata, usando le credenziali di amministratore del chiamante, con la protezione dei messaggi di integrità dei pacchetti.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-181">The <em>lookup SID of source object</em> is an authenticated RPC, using the caller's administrator credentials, with packet integrity message protection.</span></span> <span data-ttu-id="9f6b6-182">Ciò garantisce che la chiamata return non possa essere modificata senza rilevamento.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-182">This ensures that the return call cannot be modified without detection.</span></span> <span data-ttu-id="9f6b6-183">Il controller di dominio di destinazione crea un &quot; evento di controllo di aggiunta della cronologia SID univoco &quot; che riflette il SID aggiunto all'account di destinazione <strong>sIDHistory</strong>.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-183">The destination domain controller creates a unique &quot;Add SID History&quot; audit event that reflects the SID added to the destination account <strong>sIDHistory</strong>.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="9f6b6-184">Dominio di origine Trojan</span><span class="sxs-lookup"><span data-stu-id="9f6b6-184">Trojan Source Domain</span></span><br/> <span data-ttu-id="9f6b6-185">Un utente non autorizzato crea un &quot; dominio di origine Trojan Horse &quot; in una rete privata con lo stesso SID di dominio e alcuni degli stessi SID di account del dominio di origine legittimo.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-185">An unauthorized user creates a &quot;Trojan Horse&quot; source domain on a private network that has the same domain SID and some of the same account SIDs as the legitimate source domain.</span></span> <span data-ttu-id="9f6b6-186">L'utente non autorizzato tenta quindi di eseguire <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> in un dominio di destinazione per ottenere il SID di un account di origine.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-186">The unauthorized user then attempts to run <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> in a destination domain to obtain the SID of a source account.</span></span> <span data-ttu-id="9f6b6-187">Questa operazione viene eseguita senza la necessità di credenziali di amministratore di dominio di origine reale e senza uscire da un audit trail nel dominio di origine reale.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-187">This is done without the need for the real source Domain Administrator credentials and without leaving an audit trail in the real source domain.</span></span> <span data-ttu-id="9f6b6-188">Il metodo dell'utente non autorizzato per la creazione del dominio di origine Trojan Horse può essere uno dei seguenti:</span><span class="sxs-lookup"><span data-stu-id="9f6b6-188">The unauthorized user's method for creating the Trojan Horse source domain could be one of the following:</span></span>
<ul>
<li><span data-ttu-id="9f6b6-189">Ottenere una copia (backup BDC) del dominio di origine SAM.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-189">Obtain a copy (BDC backup) of the source domain SAM.</span></span></li>
<li><span data-ttu-id="9f6b6-190">Creare un nuovo dominio, modificare il SID di dominio su disco in modo che corrisponda al SID del dominio di origine legittimo, quindi creare un numero sufficiente di utenti per creare un'istanza di un account con il SID desiderato.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-190">Create a new domain, altering the domain SID on disk to match the legitimate source domain SID, then create enough users to instantiate an account with the desired SID.</span></span></li>
<li><span data-ttu-id="9f6b6-191">Creare una replica di integrazione applicativa dei dati.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-191">Create a BDC replica.</span></span> <span data-ttu-id="9f6b6-192">Sono necessarie le credenziali di amministratore del dominio di origine.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-192">This requires source domain Administrator credentials.</span></span> <span data-ttu-id="9f6b6-193">Quindi, l'utente non autorizzato porta la replica in una rete privata per implementare l'attacco.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-193">Then the unauthorized user takes the replica to a private network to implement the attack.</span></span></li>
</ul>
<br/></td>
<td><span data-ttu-id="9f6b6-194">Sebbene esistano molti modi per consentire a un utente non autorizzato di recuperare o creare un SID dell'oggetto di origine desiderato, l'utente non autorizzato non può utilizzarlo per aggiornare <strong>sIDHistory</strong> di un account senza essere membro del gruppo di amministratori del dominio di destinazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-194">Although there are many ways for an unauthorized user to retrieve or create a desired source object SID, the unauthorized user cannot use it to update an account's <strong>sIDHistory</strong> without being a member of the destination Domain Administrators group.</span></span> <span data-ttu-id="9f6b6-195">Poiché il controllo del controller di dominio di destinazione per l'appartenenza dell'amministratore di dominio è hardcoded, nel controller di dominio di destinazione non è disponibile alcun metodo per modificare i dati di controllo di accesso che proteggono questa funzione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-195">Because the check, on the destination domain controller, for Domain Administrator membership is hard-coded, on the target DC, there is no method for doing a disk modification to change the access control data protecting this function.</span></span> <span data-ttu-id="9f6b6-196">Il tentativo di clonare un account di origine Trojan Horse viene controllato nel dominio di destinazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-196">An attempt to clone a Trojan Horse source account is audited in the destination domain.</span></span> <span data-ttu-id="9f6b6-197">Questo attacco viene mitigato riservando l'appartenenza al gruppo Domain Administrators solo per individui altamente attendibili.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-197">This attack is mitigated by reserving membership in the Domain Administrators group for only highly trusted individuals.</span></span><br/></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="9f6b6-198">Modifica su disco della cronologia SID</span><span class="sxs-lookup"><span data-stu-id="9f6b6-198">On-disk Modification of SID History</span></span><br/> <span data-ttu-id="9f6b6-199">Un utente non autorizzato sofisticato, con credenziali di amministratore di dominio e con accesso fisico a un controller di dominio nel dominio di destinazione, potrebbe modificare un valore di account <strong>sIDHistory</strong> su disco.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-199">A sophisticated unauthorized user, with Domain Administrator credentials and with physical access to a DC in the destination domain, could modify an account <strong>sIDHistory</strong> value on disk.</span></span><br/></td>
<td><span data-ttu-id="9f6b6-200">Questo tentativo non è abilitato dall'uso di <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-200">This attempt is not enabled by use of <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>.</span></span> <span data-ttu-id="9f6b6-201">Questo attacco è mitigato impedendo l'accesso fisico ai controller di dominio a tutti gli amministratori tranne quelli altamente attendibili.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-201">This attack is mitigated by preventing physical access to domain controllers to all except highly trusted administrators.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="9f6b6-202">Codice non autorizzato usato per rimuovere le protezioni</span><span class="sxs-lookup"><span data-stu-id="9f6b6-202">Rogue Code Used to Remove Protections</span></span><br/> <span data-ttu-id="9f6b6-203">Un utente non autorizzato o un amministratore non autorizzato con accesso fisico al codice del servizio directory potrebbe creare codice non autorizzato che:</span><span class="sxs-lookup"><span data-stu-id="9f6b6-203">An unauthorized user or rogue administrator with physical access to the Directory Service code could create rogue code that:</span></span>
<ol>
<li><span data-ttu-id="9f6b6-204">Rimuove il controllo per l'appartenenza al gruppo Domain Administrators nel codice.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-204">Removes the check for membership in the Domain Administrators group in the code.</span></span></li>
<li><span data-ttu-id="9f6b6-205">Modifica le chiamate sul controller di dominio di origine che punta il SID a una LookupSidFromName non controllata.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-205">Changes the calls on the source domain controller that points the SID to a LookupSidFromName that is not audited.</span></span></li>
<li><span data-ttu-id="9f6b6-206">Rimuove le chiamate al log di controllo.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-206">Removes audit log calls.</span></span></li>
</ol>
<br/></td>
<td><span data-ttu-id="9f6b6-207">Un utente con accesso fisico al codice DS e sufficientemente esperto per creare codice non autorizzato ha la possibilità di modificare in modo arbitrario l'attributo <strong>sIDHistory</strong> di un account.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-207">Someone with physical access to the DS code and knowledgeable enough to create rogue code has the capability of arbitrarily modifying the <strong>sIDHistory</strong> attribute of an account.</span></span> <span data-ttu-id="9f6b6-208">L'API <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> non aumenta questo rischio per la sicurezza.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-208">The <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> API does not increase this security risk.</span></span><br/></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="9f6b6-209">Risorse vulnerabili ai SID rubati</span><span class="sxs-lookup"><span data-stu-id="9f6b6-209">Resources Vulnerable to Stolen SIDs</span></span><br/> <span data-ttu-id="9f6b6-210">Se un utente non autorizzato ha avuto esito positivo utilizzando uno dei metodi descritti qui per modificare un account <strong>sIDHistory</strong>e se i domini delle risorse di interesse considerano attendibile il dominio dell'account utente non autorizzato, l'utente non autorizzato può ottenere l'accesso non autorizzato alle risorse del SID rubato, potenzialmente senza uscire da un audit trail nel dominio dell'account da cui il SID è stato rubato.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-210">If an unauthorized user has succeeded in using one of the methods described here to modify an account <strong>sIDHistory</strong>, and if the resource domains of interest trust the unauthorized user account domain, then the unauthorized user can get unauthorized access to the stolen SID's resources, potentially without leaving an audit trail in the account domain from which the SID was stolen.</span></span><br/></td>
<td><span data-ttu-id="9f6b6-211">Gli amministratori del dominio delle risorse proteggono le proprie risorse impostando solo le relazioni di trust che hanno senso dal punto di vista della sicurezza.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-211">Resource domain administrators protect their resources by setting up only those trust relationships that make sense from a security perspective.</span></span> <span data-ttu-id="9f6b6-212">L'utilizzo di <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> è limitato, nel dominio di destinazione attendibile, ai membri del gruppo Domain Administrators che dispongono già di autorizzazioni ampie nell'ambito delle rispettive responsabilità.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-212">Use of <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a> is restricted, in the trusted target domain, to members of the Domain Administrators group who already have broad permissions within the scope of their responsibilities.</span></span><br/></td>
</tr>
<tr class="even">
<td><span data-ttu-id="9f6b6-213">Dominio di destinazione non autorizzato</span><span class="sxs-lookup"><span data-stu-id="9f6b6-213">Rogue Target Domain</span></span><br/> <span data-ttu-id="9f6b6-214">Un utente non autorizzato crea un dominio di Windows 2000 con un account il cui <strong>sIDHistory</strong> contiene un SID che è stato rubato da un dominio di origine.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-214">An unauthorized user creates a Windows 2000 domain with an account whose <strong>sIDHistory</strong> contains a SID that has been stolen from a source domain.</span></span> <span data-ttu-id="9f6b6-215">L'utente non autorizzato utilizza questo account per l'accesso non autorizzato alle risorse.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-215">The unauthorized user uses this account for unauthorized access to resources.</span></span><br/></td>
<td><span data-ttu-id="9f6b6-216">Per poter utilizzare <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>, l'utente non autorizzato richiede le credenziali di amministratore per il dominio di origine e lascia un audit trail sul controller di dominio di origine.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-216">The unauthorized user requires Administrator credentials for the source domain in order to use <a href="/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya"><strong>DsAddSidHistory</strong></a>, and leaves an audit trail on the source domain controller.</span></span> <span data-ttu-id="9f6b6-217">Il dominio di destinazione non autorizzato ottiene accesso non autorizzato solo in altri domini che considerano attendibile il dominio non autorizzato, che richiede privilegi di amministratore in tali domini di risorse.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-217">The rogue target domain gains unauthorized access only in other domains that trust the rogue domain, which requires Administrator privileges in those resource domains.</span></span><br/></td>
</tr>
</tbody>
</table>



 

## <a name="operational-constraints"></a><span data-ttu-id="9f6b6-218">Vincoli operativi</span><span class="sxs-lookup"><span data-stu-id="9f6b6-218">Operational Constraints</span></span>

<span data-ttu-id="9f6b6-219">In questa sezione vengono descritti i vincoli operativi dell'utilizzo della funzione [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) .</span><span class="sxs-lookup"><span data-stu-id="9f6b6-219">This section describes the operational constraints of using the [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) function.</span></span>

<span data-ttu-id="9f6b6-220">Il SID di *SrcPrincipal* non deve essere già presente nella foresta di destinazione, come SID dell'account primario o nel **sIDHistory** di un account.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-220">The SID of *SrcPrincipal* must not already exist in the destination forest, either as a primary account SID or in the **sIDHistory** of an account.</span></span> <span data-ttu-id="9f6b6-221">L'eccezione è che [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) non genera un errore quando si tenta di aggiungere un SID a un **sIDHistory** che contiene un SID identico.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-221">The exception is that [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) does not generate an error when attempting to add a SID to a **sIDHistory** that contains an identical SID.</span></span> <span data-ttu-id="9f6b6-222">Questo comportamento consente a **DsAddSidHistory** di essere eseguito più volte con un input identico, ottenendo risultati positivi e uno stato finale coerente, per semplificare l'utilizzo dello strumento.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-222">This behavior enables **DsAddSidHistory** to be run multiple times with identical input, resulting in success and a consistent end state, for tool developer ease-of-use.</span></span>

> [!Note]  
> <span data-ttu-id="9f6b6-223">La latenza di replica del catalogo globale può fornire una finestra durante la quale possono essere creati SID duplicati.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-223">Global Catalog replication latency may provide a window during which duplicate SIDs may be created.</span></span> <span data-ttu-id="9f6b6-224">Tuttavia, i SID duplicati possono essere eliminati facilmente da un amministratore.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-224">However, duplicate SIDs can be easily deleted by an administrator.</span></span>

 

<span data-ttu-id="9f6b6-225">*SrcPrincipal* e *DstPrincipal* devono essere di uno dei tipi seguenti:</span><span class="sxs-lookup"><span data-stu-id="9f6b6-225">*SrcPrincipal* and *DstPrincipal* must be one of the following types:</span></span>

-   <span data-ttu-id="9f6b6-226">User</span><span class="sxs-lookup"><span data-stu-id="9f6b6-226">User</span></span>
-   <span data-ttu-id="9f6b6-227">Gruppo con sicurezza abilitata, tra cui:</span><span class="sxs-lookup"><span data-stu-id="9f6b6-227">Security Enabled Group, including:</span></span>

    <dl> <span data-ttu-id="9f6b6-228">Gruppo locale</span><span class="sxs-lookup"><span data-stu-id="9f6b6-228">Local group</span></span>  
    <span data-ttu-id="9f6b6-229">Gruppo globale</span><span class="sxs-lookup"><span data-stu-id="9f6b6-229">Global group</span></span>  
    <span data-ttu-id="9f6b6-230">Gruppo locale di dominio (solo modalità nativa di Windows 2000)</span><span class="sxs-lookup"><span data-stu-id="9f6b6-230">Domain local group (Windows 2000 native mode only)</span></span>  
    <span data-ttu-id="9f6b6-231">Gruppo universale (solo modalità nativa di Windows 2000)</span><span class="sxs-lookup"><span data-stu-id="9f6b6-231">Universal group (Windows 2000 native mode only)</span></span>  
    </dl>

<span data-ttu-id="9f6b6-232">I tipi di oggetto *SrcPrincipal* e *DstPrincipal* devono corrispondere.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-232">The object types of *SrcPrincipal* and *DstPrincipal* must match.</span></span>

-   <span data-ttu-id="9f6b6-233">Se *SrcPrincipal* è un utente, *DstPrincipal* deve essere un utente.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-233">If *SrcPrincipal* is a User, *DstPrincipal* must be a User.</span></span>
-   <span data-ttu-id="9f6b6-234">Se *SrcPrincipal* è un gruppo locale o di dominio locale, *DstPrincipal* deve essere un gruppo locale di dominio.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-234">If *SrcPrincipal* is a Local or Domain Local Group, *DstPrincipal* must be a Domain Local Group.</span></span>
-   <span data-ttu-id="9f6b6-235">Se *SrcPrincipal* è un gruppo globale o universale, *DstPrincipal* deve essere un gruppo globale o universale.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-235">If *SrcPrincipal* is a Global or Universal Group, *DstPrincipal* must be a Global or Universal Group.</span></span>

<span data-ttu-id="9f6b6-236">*SrcPrincipal* e *DstPrincipal* non possono essere di uno dei tipi seguenti: ([**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) ha esito negativo con un errore in questi casi)</span><span class="sxs-lookup"><span data-stu-id="9f6b6-236">*SrcPrincipal* and *DstPrincipal* cannot be one of the following types: ([**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) fails with an error in these cases)</span></span>

-   <span data-ttu-id="9f6b6-237">Computer (workstation o controller di dominio)</span><span class="sxs-lookup"><span data-stu-id="9f6b6-237">Computer (workstation or domain controller)</span></span>
-   <span data-ttu-id="9f6b6-238">Trust tra domini</span><span class="sxs-lookup"><span data-stu-id="9f6b6-238">Inter-domain trust</span></span>
-   <span data-ttu-id="9f6b6-239">Account duplicato temporaneo (funzionalità praticamente inutilizzata, legacy di LANman)</span><span class="sxs-lookup"><span data-stu-id="9f6b6-239">Temporary duplicate account (virtually unused feature, a legacy of LANman)</span></span>
-   <span data-ttu-id="9f6b6-240">Account con SID ben noti.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-240">Accounts with Well Known SIDs.</span></span> <span data-ttu-id="9f6b6-241">I SID ben noti sono identici in ogni dominio; in questo modo, l'aggiunta a un **sIDHistory** viola il requisito di unicità dei SID di una foresta di Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-241">Well Known SIDs are identical in every domain; thus adding them to a **sIDHistory** would violate the SID uniqueness requirement of a Windows 2000 forest.</span></span> <span data-ttu-id="9f6b6-242">Gli account con SID ben noti includono i seguenti gruppi locali:</span><span class="sxs-lookup"><span data-stu-id="9f6b6-242">Accounts with Well Known SIDs include the following local groups:</span></span>

    <dl> <span data-ttu-id="9f6b6-243">Operatori account</span><span class="sxs-lookup"><span data-stu-id="9f6b6-243">Account operators</span></span>  
    <span data-ttu-id="9f6b6-244">Administrators</span><span class="sxs-lookup"><span data-stu-id="9f6b6-244">Administrators</span></span>  
    <span data-ttu-id="9f6b6-245">Operatori di backup</span><span class="sxs-lookup"><span data-stu-id="9f6b6-245">Backup operators</span></span>  
    <span data-ttu-id="9f6b6-246">Guests</span><span class="sxs-lookup"><span data-stu-id="9f6b6-246">Guests</span></span>  
    <span data-ttu-id="9f6b6-247">Operatori di stampa</span><span class="sxs-lookup"><span data-stu-id="9f6b6-247">Print operators</span></span>  
    <span data-ttu-id="9f6b6-248">Replicator</span><span class="sxs-lookup"><span data-stu-id="9f6b6-248">Replicator</span></span>  
    <span data-ttu-id="9f6b6-249">Operatori server</span><span class="sxs-lookup"><span data-stu-id="9f6b6-249">Server operators</span></span>  
    <span data-ttu-id="9f6b6-250">Utenti</span><span class="sxs-lookup"><span data-stu-id="9f6b6-250">Users</span></span>  
    </dl>

<span data-ttu-id="9f6b6-251">Se *SrcPrincipal* dispone di un identificatore relativo (RID) noto e di un prefisso specifico del dominio, ovvero gli amministratori di dominio, gli utenti di dominio e i computer del dominio, *DstPrincipal* deve avere lo stesso RID noto per consentire il corretto funzionamento di [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) .</span><span class="sxs-lookup"><span data-stu-id="9f6b6-251">If *SrcPrincipal* has a well-known relative identifier (RID) and a domain specific prefix, that is, Domain Administrators, Domain Users, and Domain Computers, then *DstPrincipal* must possess the same well-known RID in order for [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) to succeed.</span></span> <span data-ttu-id="9f6b6-252">Gli account con RID noto includono gli utenti e i gruppi globali seguenti:</span><span class="sxs-lookup"><span data-stu-id="9f6b6-252">Accounts with well-known RIDs include the following users and global groups:</span></span>

-   <span data-ttu-id="9f6b6-253">Amministratore</span><span class="sxs-lookup"><span data-stu-id="9f6b6-253">Administrator</span></span>
-   <span data-ttu-id="9f6b6-254">Guest</span><span class="sxs-lookup"><span data-stu-id="9f6b6-254">Guest</span></span>
-   <span data-ttu-id="9f6b6-255">Amministratori di dominio</span><span class="sxs-lookup"><span data-stu-id="9f6b6-255">Domain administrators</span></span>
-   <span data-ttu-id="9f6b6-256">Guest di dominio</span><span class="sxs-lookup"><span data-stu-id="9f6b6-256">Domain guests</span></span>
-   <span data-ttu-id="9f6b6-257">Utenti del dominio</span><span class="sxs-lookup"><span data-stu-id="9f6b6-257">Domain users</span></span>

## <a name="setting-the-registry-value"></a><span data-ttu-id="9f6b6-258">Impostazione del valore del registro di sistema</span><span class="sxs-lookup"><span data-stu-id="9f6b6-258">Setting the Registry Value</span></span>

<span data-ttu-id="9f6b6-259">Nella procedura seguente viene illustrato come impostare il valore del registro di sistema TcpipClientSupport.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-259">The following procedure shows how to set the TcpipClientSupport registry value.</span></span>

<span data-ttu-id="9f6b6-260">**Per impostare il valore del registro di sistema TcpipClientSupport**</span><span class="sxs-lookup"><span data-stu-id="9f6b6-260">**To Set the TcpipClientSupport Registry Value**</span></span>

1.  <span data-ttu-id="9f6b6-261">Creare il valore del registro di sistema seguente come \_ valore reg DWORD sul controller di dominio di origine e impostarne il valore su 1.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-261">Create the following registry value as a REG\_DWORD value on the source domain controller and set its value to 1.</span></span>

    <span data-ttu-id="9f6b6-262">**HKEY \_ Local \_ computer \\ System \\ CurrentControlSet \\ Control \\ LSA \\ TcpipClientSupport**</span><span class="sxs-lookup"><span data-stu-id="9f6b6-262">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Lsa\\TcpipClientSupport**</span></span>

2.  <span data-ttu-id="9f6b6-263">Riavviare quindi il controller di dominio di origine.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-263">Then, restart the source domain controller.</span></span> <span data-ttu-id="9f6b6-264">Questo valore del registro di sistema causa l'ascolto da parte di SAM su TCP/IP.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-264">This registry value causes the SAM to listen on TCP/IP.</span></span> <span data-ttu-id="9f6b6-265">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) avrà esito negativo se il valore non è impostato sul controller di dominio di origine.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-265">[**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) will fail if this value is not set on the source domain controller.</span></span>

## <a name="enabling-auditing-of-usergroup-management-events"></a><span data-ttu-id="9f6b6-266">Abilitazione del controllo degli eventi di gestione di utenti/gruppi</span><span class="sxs-lookup"><span data-stu-id="9f6b6-266">Enabling Auditing of User/Group Management Events</span></span>

<span data-ttu-id="9f6b6-267">Nella procedura seguente viene illustrato come abilitare il controllo degli eventi di gestione di utenti/gruppi in un dominio di origine o di destinazione di Windows 2000 o Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-267">The following procedure shows how to enable auditing of User/Group management events in a Windows 2000 or Windows Server 2003 source or destination domain.</span></span>

<span data-ttu-id="9f6b6-268">**Per abilitare il controllo degli eventi di gestione di utenti/gruppi in un dominio di origine o di destinazione di Windows 2000 o Windows Server 2003**</span><span class="sxs-lookup"><span data-stu-id="9f6b6-268">**To enable auditing of User/Group management events in a Windows 2000 or Windows Server 2003 source or destination domain**</span></span>

1.  <span data-ttu-id="9f6b6-269">Nello snap-in MMC utenti e computer Active Directory selezionare il contenitore controller di dominio di destinazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-269">In the Active Directory Users and Computers MMC Snap-in, select the destination domain Domain Controllers container.</span></span>
2.  <span data-ttu-id="9f6b6-270">Fare clic con il pulsante destro del mouse su **controller di dominio** e scegliere **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-270">Right-click **Domain Controllers** and choose **Properties**.</span></span>
3.  <span data-ttu-id="9f6b6-271">Fare clic sulla scheda **criteri di gruppo** .</span><span class="sxs-lookup"><span data-stu-id="9f6b6-271">Click the **Group Policy** tab.</span></span>
4.  <span data-ttu-id="9f6b6-272">Selezionare il **criterio controller di dominio predefiniti** e fare clic su **modifica**.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-272">Select the **Default Domain Controllers Policy** and click **Edit**.</span></span>
5.  <span data-ttu-id="9f6b6-273">In **Configurazione computer \\ impostazioni di Windows impostazioni di \\ sicurezza \\ \\ criteri locali controlla**, fare doppio clic su **Controlla gestione account**.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-273">Under **Computer Configuration\\Windows Settings\\Security Settings\\Local Policies\\Audit Policy**, double-click **Audit Account Management**.</span></span>
6.  <span data-ttu-id="9f6b6-274">Nella finestra **Controlla gestione account** selezionare il controllo di **esito positivo** e **negativo** .</span><span class="sxs-lookup"><span data-stu-id="9f6b6-274">In the **Audit Account Management** window, select both **Success** and **Failure** auditing.</span></span> <span data-ttu-id="9f6b6-275">Gli aggiornamenti dei criteri diventano effettivi dopo un riavvio o dopo un aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-275">Policy updates take effect after a restart or after a refresh occurs.</span></span>
7.  <span data-ttu-id="9f6b6-276">Verificare che il controllo sia abilitato visualizzando i criteri di controllo effettivi nello snap-in MMC Criteri di gruppo.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-276">Verify that auditing is enabled by viewing the effective audit policy in the Group Policy MMC Snap-in.</span></span>

<span data-ttu-id="9f6b6-277">Nella procedura seguente viene illustrato come abilitare il controllo degli eventi di gestione di utenti/gruppi in un dominio Windows NT 4,0.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-277">The following procedure shows how to enable auditing of User/Group management events in a Windows NT 4.0 domain.</span></span>

<span data-ttu-id="9f6b6-278">**Per abilitare il controllo degli eventi di gestione di utenti/gruppi in un dominio Windows NT 4,0**</span><span class="sxs-lookup"><span data-stu-id="9f6b6-278">**To enable auditing of User/Group management events in a Windows NT 4.0 domain**</span></span>

1.  <span data-ttu-id="9f6b6-279">In **User Manager for Domains** fare clic sul menu **Policies** e selezionare **Audit**.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-279">In **User Manager for Domains**, click the **Policies** menu and select **Audit**.</span></span>
2.  <span data-ttu-id="9f6b6-280">Selezionare **Controlla questi eventi**.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-280">Select **Audit These Events**.</span></span>
3.  <span data-ttu-id="9f6b6-281">Per la **gestione di utenti e gruppi**, verificare l' **esito positivo e negativo**.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-281">For **User and Group Management**, check **Success and Failure**.</span></span>

<span data-ttu-id="9f6b6-282">Nella procedura seguente viene illustrato come abilitare il controllo degli eventi di gestione di utenti/gruppi in un dominio di origine Windows NT 4,0, Windows 2000 o Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-282">The following procedure shows how to enable auditing of User/Group management events in a Windows NT 4.0, Windows 2000, or Windows Server 2003 source domain.</span></span>

<span data-ttu-id="9f6b6-283">**Per abilitare il controllo degli eventi di gestione di utenti/gruppi in un dominio di origine Windows NT 4,0, Windows 2000 o Windows Server 2003**</span><span class="sxs-lookup"><span data-stu-id="9f6b6-283">**To enable auditing of User/Group management events in a Windows NT 4.0, Windows 2000, or Windows Server 2003 source domain**</span></span>

1.  <span data-ttu-id="9f6b6-284">In **Gestione utenti per domini** fare clic sul menu **utente** e selezionare **nuovo gruppo locale**.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-284">In **User Manager for Domains**, click the **User** menu and select **New Local Group**.</span></span>
2.  <span data-ttu-id="9f6b6-285">Immettere un nome di gruppo composto dal nome NetBIOS del dominio di origine aggiunto con tre simboli di dollaro ($), ad esempio FABRIKAM $ $ $.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-285">Enter a group name composed of the source domain NetBIOS name appended with three dollar signs ($), for example, FABRIKAM$$$.</span></span> <span data-ttu-id="9f6b6-286">Il campo descrizione deve indicare che questo gruppo viene usato per controllare l'uso di [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) o di operazioni di clonazione.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-286">The description field should indicate that this group is used to audit use of [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) or cloning operations.</span></span> <span data-ttu-id="9f6b6-287">Verificare che non vi siano membri nel gruppo.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-287">Ensure there are no members in the group.</span></span> <span data-ttu-id="9f6b6-288">Fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-288">Click **OK**.</span></span>

<span data-ttu-id="9f6b6-289">L'operazione [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) ha esito negativo se il controllo di origine e di destinazione non è abilitato come descritto qui.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-289">The [**DsAddSidHistory**](/windows/desktop/api/Ntdsapi/nf-ntdsapi-dsaddsidhistorya) operation fails if source and destination auditing are not enabled as described here.</span></span>

## <a name="set-up-trust-if-required"></a><span data-ttu-id="9f6b6-290">Imposta attendibilità se necessario</span><span class="sxs-lookup"><span data-stu-id="9f6b6-290">Set up Trust if Required</span></span>

<span data-ttu-id="9f6b6-291">Se viene soddisfatta una delle condizioni seguenti, è necessario stabilire una relazione di trust dal dominio di origine al dominio di destinazione (questo deve verificarsi in una foresta diversa):</span><span class="sxs-lookup"><span data-stu-id="9f6b6-291">If one of the following is true, a trust must be established from the source domain to the destination domain (this must occur in a different forest):</span></span>

-   <span data-ttu-id="9f6b6-292">Il dominio di origine è Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-292">The source domain is Windows Server 2003.</span></span>
-   <span data-ttu-id="9f6b6-293">Il dominio di origine è Windows NT 4,0 e *SrcDomainCreds* è **null**.</span><span class="sxs-lookup"><span data-stu-id="9f6b6-293">The source domain is Windows NT 4.0 and *SrcDomainCreds* is **NULL**.</span></span>

 

 





