---
title: Creazione di descrittori di sicurezza per i nuovi oggetti directory
description: È possibile utilizzare ADSI per creare un descrittore di sicurezza e impostarlo come proprietà nTSecurityDescriptor di un nuovo oggetto o utilizzarlo per sostituire la proprietà nTSecurityDescriptor di un oggetto esistente.
ms.assetid: b9ff626f-17f1-4fc1-9d6e-4f47e29a5aeb
ms.tgt_platform: multiple
keywords:
- Creazione di un descrittore di sicurezza per un nuovo oggetto directory
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78265d27c52023d669e27fc9890fd2d5273e2ffd
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/17/2020
ms.locfileid: "104472627"
---
# <a name="creating-security-descriptors-for-new-directory-objects"></a><span data-ttu-id="70fbb-104">Creazione di descrittori di sicurezza per i nuovi oggetti directory</span><span class="sxs-lookup"><span data-stu-id="70fbb-104">Creating Security Descriptors for new directory objects</span></span>

<span data-ttu-id="70fbb-105">È possibile utilizzare ADSI per creare un descrittore di sicurezza e impostarlo come proprietà **ntSecurityDescriptor** di un nuovo oggetto o utilizzarlo per sostituire la proprietà **ntSecurityDescriptor** di un oggetto esistente.</span><span class="sxs-lookup"><span data-stu-id="70fbb-105">You can use ADSI to create a security descriptor and set it as a new object's **nTSecurityDescriptor** property or use it to replace an existing object's **nTSecurityDescriptor** property.</span></span>

<span data-ttu-id="70fbb-106">Per creare un descrittore di sicurezza per un oggetto:</span><span class="sxs-lookup"><span data-stu-id="70fbb-106">To create a security descriptor for an object:</span></span>

1.  <span data-ttu-id="70fbb-107">Utilizzare [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) per creare l'oggetto ADSI com per il nuovo descrittore di sicurezza e ottenere un puntatore di interfaccia [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) a tale oggetto.</span><span class="sxs-lookup"><span data-stu-id="70fbb-107">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the new security descriptor and get an [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) interface pointer to that object.</span></span> <span data-ttu-id="70fbb-108">Tenere presente che l'ID di classe è **CLSID \_ securityDescriptor**.</span><span class="sxs-lookup"><span data-stu-id="70fbb-108">Be aware that the class ID is **CLSID\_SecurityDescriptor**.</span></span>
2.  <span data-ttu-id="70fbb-109">Usare il metodo [**IADsSecurityDescriptor::p UT \_ owner**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) per impostare il proprietario dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="70fbb-109">Use the [**IADsSecurityDescriptor::put\_Owner**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the owner of the object.</span></span> <span data-ttu-id="70fbb-110">Il fiduciario è un utente, un gruppo o un'altra entità di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="70fbb-110">The trustee is a user, group, or other security principal.</span></span> <span data-ttu-id="70fbb-111">Un'applicazione deve usare il valore della proprietà appropriata dall'oggetto utente o gruppo del trustee a cui applicare la voce ACE.</span><span class="sxs-lookup"><span data-stu-id="70fbb-111">An application should use the value from the appropriate property from the user or group object of the trustee to which to apply the ACE.</span></span>
3.  <span data-ttu-id="70fbb-112">Usare il metodo [**IADsSecurityDescriptor::p UT \_ Control**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) per controllare se i DACL e i SACL vengono ereditati dall'oggetto dal relativo contenitore padre.</span><span class="sxs-lookup"><span data-stu-id="70fbb-112">Use the [**IADsSecurityDescriptor::put\_Control**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to control whether DACLs and SACLs are inherited by the object from its parent container.</span></span>
4.  <span data-ttu-id="70fbb-113">Utilizzare [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) per creare l'oggetto ADSI com per l'elenco DACL per il nuovo descrittore di sicurezza e ottenere un puntatore di interfaccia [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) a tale oggetto.</span><span class="sxs-lookup"><span data-stu-id="70fbb-113">Use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the DACL for the new security descriptor and get an [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) interface pointer to that object.</span></span> <span data-ttu-id="70fbb-114">Tenere presente che l'ID di classe è **CLSID \_ AccessControlList**.</span><span class="sxs-lookup"><span data-stu-id="70fbb-114">Be aware that the class ID is **CLSID\_AccessControlList**.</span></span>
5.  <span data-ttu-id="70fbb-115">Per ogni voce ACE da aggiungere all'elenco DACL, utilizzare [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) per creare l'oggetto ADSI com per la nuova voce ACE e ottenere un puntatore di interfaccia [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) a tale oggetto.</span><span class="sxs-lookup"><span data-stu-id="70fbb-115">For each ACE to add to the DACL, use [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) to create the ADSI COM object for the new ACE and get an [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) interface pointer to that object.</span></span> <span data-ttu-id="70fbb-116">Tenere presente che l'ID di classe è CLSID \_ AccessControlEntry.</span><span class="sxs-lookup"><span data-stu-id="70fbb-116">Be aware that the class ID is CLSID\_AccessControlEntry.</span></span>
6.  <span data-ttu-id="70fbb-117">Per ogni voce ACE da aggiungere all'elenco DACL, impostare le proprietà della voce ACE usando i metodi della proprietà dell'oggetto [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) della voce ACE.</span><span class="sxs-lookup"><span data-stu-id="70fbb-117">For each ACE to add to the DACL, set the properties of the ACE using the property methods of the ACE's [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) object.</span></span> <span data-ttu-id="70fbb-118">Per ulteriori informazioni sulle proprietà da impostare in una voce ACE, vedere [impostazione dei diritti di accesso per un oggetto](setting-access-rights-on-an-object.md).</span><span class="sxs-lookup"><span data-stu-id="70fbb-118">For more information about the properties to set on an ACE, see [Setting Access Rights on an Object](setting-access-rights-on-an-object.md).</span></span>
7.  <span data-ttu-id="70fbb-119">Per ogni voce ACE da aggiungere all'elenco DACL, usare il metodo **QueryInterface** sull'oggetto [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) per ottenere un puntatore [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="70fbb-119">For each ACE to add to the DACL, use the **QueryInterface** method on the [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) object to get an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) pointer.</span></span> <span data-ttu-id="70fbb-120">Il metodo [**IADsAccessControlList:: AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) richiede un puntatore di interfaccia **IDispatch** alla voce ACE.</span><span class="sxs-lookup"><span data-stu-id="70fbb-120">The [**IADsAccessControlList::AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) method requires an **IDispatch** interface pointer to the ACE.</span></span>
8.  <span data-ttu-id="70fbb-121">Per ogni voce ACE da aggiungere all'elenco DACL, utilizzare [**IADsAccessControlList:: AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) per aggiungere la nuova voce ACE all'elenco DACL.</span><span class="sxs-lookup"><span data-stu-id="70fbb-121">For each ACE to add to the DACL, use [**IADsAccessControlList::AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) to add the new ACE to the DACL.</span></span> <span data-ttu-id="70fbb-122">Tenere presente che l'ordine delle voci ACE nell'ACL può influire sulla valutazione dell'accesso all'oggetto.</span><span class="sxs-lookup"><span data-stu-id="70fbb-122">Be aware that the order of the ACEs within the ACL can affect the evaluation of access to the object.</span></span> <span data-ttu-id="70fbb-123">Per accedere correttamente all'oggetto, potrebbe essere necessario creare un nuovo ACL, aggiungere le voci ACE dall'ACL esistente nell'ordine corretto al nuovo ACL, quindi sostituire l'ACL esistente nel descrittore di sicurezza con il nuovo ACL.</span><span class="sxs-lookup"><span data-stu-id="70fbb-123">The correct access to the object may require you to create a new ACL, add the ACEs from the existing ACL in the correct order to the new ACL, and then replace the existing ACL in the security descriptor with the new ACL.</span></span> <span data-ttu-id="70fbb-124">Per ulteriori informazioni, vedere [Order of ACE in a DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).</span><span class="sxs-lookup"><span data-stu-id="70fbb-124">For more information, see [Order of ACEs in a DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).</span></span>
9.  <span data-ttu-id="70fbb-125">Seguire i passaggi 4-8 per creare il SACL per il nuovo descrittore di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="70fbb-125">Follow Steps 4-8 to create the SACL for the new security descriptor.</span></span>
10. <span data-ttu-id="70fbb-126">Usare il metodo [**IADsSecurityDescriptor::p UT \_ DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) per impostare l'elenco DACL.</span><span class="sxs-lookup"><span data-stu-id="70fbb-126">Use the [**IADsSecurityDescriptor::put\_DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the DACL.</span></span> <span data-ttu-id="70fbb-127">Per ulteriori informazioni sugli elenchi DACL, vedere [DACL null e elenchi DACL vuoti](null-dacls-and-empty-dacls.md).</span><span class="sxs-lookup"><span data-stu-id="70fbb-127">For more information about DACLs, see [Null DACLs and Empty DACLs](null-dacls-and-empty-dacls.md).</span></span>
11. <span data-ttu-id="70fbb-128">Usare il metodo [**IADsSecurityDescriptor::p UT \_ SystemAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) per impostare il SACL.</span><span class="sxs-lookup"><span data-stu-id="70fbb-128">Use the [**IADsSecurityDescriptor::put\_SystemAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) method to set the SACL.</span></span>
12. <span data-ttu-id="70fbb-129">Convertire l'oggetto [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) in una [**variante**](/windows/win32/api/oaidl/ns-oaidl-variant) usando il metodo **QueryInterface** dell'oggetto **IADsSecurityDescriptor** per ottenere un'interfaccia [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) .</span><span class="sxs-lookup"><span data-stu-id="70fbb-129">Convert the [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) object to a [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) by using the **QueryInterface** method of the **IADsSecurityDescriptor** object to obtain an [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) interface.</span></span> <span data-ttu-id="70fbb-130">Impostare quindi il membro **VT** della **variante** su **VT \_ Dispatch** e impostare il membro **pdispVal** della **variante** uguale al puntatore **IDispatch** .</span><span class="sxs-lookup"><span data-stu-id="70fbb-130">Then set the **vt** member of the **VARIANT** to **VT\_DISPATCH** and set the **pdispVal** member of the **VARIANT** equal to the **IDispatch** pointer.</span></span>
13. <span data-ttu-id="70fbb-131">Ottenere un puntatore di interfaccia [**IADs**](/windows/desktop/api/iads/nn-iads-iads) all'oggetto.</span><span class="sxs-lookup"><span data-stu-id="70fbb-131">Obtain an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer to the object.</span></span>
14. <span data-ttu-id="70fbb-132">Usare il metodo [**IADs::P UT**](/windows/desktop/api/iads/nf-iads-iads-put) con "ntSecurityDescriptor" e la [**variante**](/windows/win32/api/oaidl/ns-oaidl-variant) creata in precedenza per scrivere il nuovo descrittore di sicurezza nella cache delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="70fbb-132">Use the [**IADs::Put**](/windows/desktop/api/iads/nf-iads-iads-put) method with "nTSecurityDescriptor" and the [**VARIANT**](/windows/win32/api/oaidl/ns-oaidl-variant) created above to write the new security descriptor to the property cache.</span></span>
15. <span data-ttu-id="70fbb-133">Usare il metodo [**IADs:: SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) per aggiornare la proprietà nell'oggetto nella directory.</span><span class="sxs-lookup"><span data-stu-id="70fbb-133">Use the [**IADs::SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) method to update the property on the object in the directory.</span></span>

 

 