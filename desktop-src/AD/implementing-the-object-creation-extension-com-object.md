---
title: Implementazione dell'oggetto COM di estensione per la creazione di oggetti
description: Un'estensione per la creazione di oggetti è un oggetto COM implementato come server in-process. Le estensioni per la creazione di oggetti primari e secondari devono implementare l'interfaccia IDsAdminNewObjExt.
ms.assetid: 0a8ed0ed-9dcb-4373-b549-7da3f3d9f641
ms.tgt_platform: multiple
keywords:
- Implementazione dell'oggetto COM dell'estensione per la creazione di oggetti
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 05c1a9da94caa300c1277cf6f6030357ca9d573d
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/17/2020
ms.locfileid: "104046503"
---
# <a name="implementing-the-object-creation-extension-com-object"></a><span data-ttu-id="9f72b-105">Implementazione dell'oggetto COM di estensione per la creazione di oggetti</span><span class="sxs-lookup"><span data-stu-id="9f72b-105">Implementing the Object Creation Extension COM Object</span></span>

<span data-ttu-id="9f72b-106">Un'estensione per la creazione di oggetti è un oggetto COM implementato come server in-process.</span><span class="sxs-lookup"><span data-stu-id="9f72b-106">An object creation extension is a COM object implemented as an in-proc server.</span></span> <span data-ttu-id="9f72b-107">Le estensioni per la creazione di oggetti primari e secondari devono implementare l'interfaccia [**IDsAdminNewObjExt**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjext) .</span><span class="sxs-lookup"><span data-stu-id="9f72b-107">Both primary and secondary object creation extensions must implement the [**IDsAdminNewObjExt**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjext) interface.</span></span>

## <a name="implementing-idsadminnewobjext"></a><span data-ttu-id="9f72b-108">Implementazione di IDsAdminNewObjExt</span><span class="sxs-lookup"><span data-stu-id="9f72b-108">Implementing IDsAdminNewObjExt</span></span>

<span data-ttu-id="9f72b-109">Quando viene creata la creazione guidata oggetto, viene inizializzata ogni estensione per la creazione di oggetti chiamando il metodo [**IDsAdminNewObjExt:: Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize) dell'estensione.</span><span class="sxs-lookup"><span data-stu-id="9f72b-109">When the object creation wizard is created, it initializes each object creation extension by calling the extension's [**IDsAdminNewObjExt::Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize) method.</span></span> <span data-ttu-id="9f72b-110">Il metodo **Initialize** fornisce l'estensione con informazioni sul contenitore in cui viene creato l'oggetto, il nome della classe del nuovo oggetto e le informazioni sulla procedura guidata stessa.</span><span class="sxs-lookup"><span data-stu-id="9f72b-110">The **Initialize** method supplies the extension with information about the container the object is being created in, the class name of the new object and information about the wizard itself.</span></span> <span data-ttu-id="9f72b-111">Se la creazione guidata oggetto viene avviata per creare un nuovo oggetto da un oggetto esistente, il parametro *pADsCopySource* non sarà **null**.</span><span class="sxs-lookup"><span data-stu-id="9f72b-111">If the object creation wizard is started to create a new object from an existing object, the *pADsCopySource* parameter will not be **NULL**.</span></span> <span data-ttu-id="9f72b-112">In questo caso, l'estensione deve tentare di ottenere tutti i dati dall'oggetto copiato come possibile.</span><span class="sxs-lookup"><span data-stu-id="9f72b-112">In this case, the extension should attempt to obtain as much data from the object being copied as is feasible.</span></span>

<span data-ttu-id="9f72b-113">Dopo l'inizializzazione dell'estensione, viene chiamato il metodo [**IDsAdminNewObjExt:: AddPages**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-addpages) .</span><span class="sxs-lookup"><span data-stu-id="9f72b-113">After the extension is initialized, the [**IDsAdminNewObjExt::AddPages**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-addpages) method is called.</span></span> <span data-ttu-id="9f72b-114">Durante questo metodo, l'estensione deve aggiungere la pagina o le pagine alla procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="9f72b-114">The extension must add the page or pages to the wizard during this method.</span></span> <span data-ttu-id="9f72b-115">Una pagina della procedura guidata viene creata compilando una struttura [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) e passando la struttura alla funzione [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) .</span><span class="sxs-lookup"><span data-stu-id="9f72b-115">A wizard page is created by filling in a [**PROPSHEETPAGE**](/windows/win32/api/prsht/ns-prsht-propsheetpagea_v2) structure and then passing this structure to the [**CreatePropertySheetPage**](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) function.</span></span> <span data-ttu-id="9f72b-116">La pagina viene quindi aggiunta alla procedura guidata chiamando la funzione di callback che viene passata a **AddPages** nel parametro *lpfnAddPage* .</span><span class="sxs-lookup"><span data-stu-id="9f72b-116">The page is then added to the wizard by calling the callback function that is passed to **AddPages** in the *lpfnAddPage* parameter.</span></span>

<span data-ttu-id="9f72b-117">Prima che venga visualizzata la pagina di estensione, viene chiamato [**IDsAdminNewObjExt:: seobject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) .</span><span class="sxs-lookup"><span data-stu-id="9f72b-117">Before the extension page is displayed, [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) is called.</span></span> <span data-ttu-id="9f72b-118">Questa operazione fornisce l'estensione con un puntatore di interfaccia [**IADs**](/windows/desktop/api/iads/nn-iads-iads) per l'oggetto da creare.</span><span class="sxs-lookup"><span data-stu-id="9f72b-118">This supplies the extension with an [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface pointer for the object being created.</span></span>

<span data-ttu-id="9f72b-119">Quando viene visualizzata la pagina della procedura guidata, la pagina deve gestire e rispondere a tutti i messaggi di notifica necessari della procedura guidata, ad esempio [**PSN \_ seactive**](../controls/psn-setactive.md) e [**PSN \_ WIZNEXT**](../controls/psn-wiznext.md).</span><span class="sxs-lookup"><span data-stu-id="9f72b-119">While the wizard page is displayed, the page should handle and respond to any necessary wizard notification messages, such as [**PSN\_SETACTIVE**](../controls/psn-setactive.md) and [**PSN\_WIZNEXT**](../controls/psn-wiznext.md).</span></span>

<span data-ttu-id="9f72b-120">Al termine di tutte le pagine della procedura guidata, la procedura guidata visualizzerà una pagina di completamento che fornisce un riepilogo dei dati immessi.</span><span class="sxs-lookup"><span data-stu-id="9f72b-120">When the user completes all of the wizard pages, the wizard will display a "Finish" page that provides a summary of the data entered.</span></span> <span data-ttu-id="9f72b-121">Questa procedura guidata consente di ottenere questi dati chiamando il metodo [**IDsAdminNewObjExt:: GetSummaryInfo**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-getsummaryinfo) per ognuna delle estensioni.</span><span class="sxs-lookup"><span data-stu-id="9f72b-121">The wizard obtains this data by calling the [**IDsAdminNewObjExt::GetSummaryInfo**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-getsummaryinfo) method for each of the extensions.</span></span> <span data-ttu-id="9f72b-122">Il metodo **GetSummaryInfo** fornisce un **BSTR** che contiene i dati di testo visualizzati nella pagina "Finish".</span><span class="sxs-lookup"><span data-stu-id="9f72b-122">The **GetSummaryInfo** method provides a **BSTR** that contains the text data displayed in the "Finish" page.</span></span> <span data-ttu-id="9f72b-123">Non è necessario che un'estensione per la creazione di oggetti fornisca dati di riepilogo.</span><span class="sxs-lookup"><span data-stu-id="9f72b-123">An object creation extension does not have to supply summary data.</span></span> <span data-ttu-id="9f72b-124">In questo caso, **GetSummaryInfo** deve restituire **E \_ NOTIMPL**.</span><span class="sxs-lookup"><span data-stu-id="9f72b-124">In this case, **GetSummaryInfo** should return **E\_NOTIMPL**.</span></span> <span data-ttu-id="9f72b-125">**GetSummaryInfo** viene chiamato solo una volta per ogni estensione, non per pagina, pertanto se l'estensione per la creazione di oggetti aggiunge più di una pagina, l'estensione deve combinare i dati di riepilogo in una sola stringa.</span><span class="sxs-lookup"><span data-stu-id="9f72b-125">**GetSummaryInfo** is only called one time for each extension, not per page, so if the object creation extension adds more than one page, the extension must combine the summary data into one string.</span></span>

<span data-ttu-id="9f72b-126">Quando l'utente fa clic sul pulsante **fine** nella pagina "Finish" (fine), la procedura guidata chiama ognuno dei metodi [**IDsAdminNewObjExt:: WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) dell'estensione con il contesto di **\_ \_ \_ precommit DSA NEWOBJ CTX** .</span><span class="sxs-lookup"><span data-stu-id="9f72b-126">When the user clicks the **Finish** button in the "Finish" page, the wizard calls each of the extension's [**IDsAdminNewObjExt::WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) methods with the **DSA\_NEWOBJ\_CTX\_PRECOMMIT** context.</span></span> <span data-ttu-id="9f72b-127">In questo caso, l'estensione deve scrivere i dati raccolti nelle proprietà appropriate usando il metodo [**IADs::P UT**](/windows/desktop/api/iads/nf-iads-iads-put) o [**IADs::P UTEX**](/windows/desktop/api/iads/nf-iads-iads-putex) .</span><span class="sxs-lookup"><span data-stu-id="9f72b-127">When this occurs, the extension should write the gathered data into the appropriate properties using the [**IADs::Put**](/windows/desktop/api/iads/nf-iads-iads-put) or [**IADs::PutEx**](/windows/desktop/api/iads/nf-iads-iads-putex) method.</span></span> <span data-ttu-id="9f72b-128">L'interfaccia [**IADs**](/windows/desktop/api/iads/nn-iads-iads) viene fornita all'estensione nel metodo [**IDsAdminNewObjExt::**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) SetValue.</span><span class="sxs-lookup"><span data-stu-id="9f72b-128">The [**IADs**](/windows/desktop/api/iads/nn-iads-iads) interface is provided to the extension in the [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) method.</span></span> <span data-ttu-id="9f72b-129">L'estensione non deve eseguire il commit delle proprietà memorizzate nella cache chiamando [**IADs:: seinfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo).</span><span class="sxs-lookup"><span data-stu-id="9f72b-129">The extension should not commit the cached properties by calling [**IADs::SetInfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo).</span></span> <span data-ttu-id="9f72b-130">Quando tutte le proprietà sono state scritte, l'estensione per la creazione di oggetti primari esegue il commit delle modifiche chiamando **IADs:: SetInfo**.</span><span class="sxs-lookup"><span data-stu-id="9f72b-130">When all of the properties have been written, the primary object creation extension commits the changes by calling **IADs::SetInfo**.</span></span> <span data-ttu-id="9f72b-131">Questo argomento viene trattato in modo più dettagliato di seguito.</span><span class="sxs-lookup"><span data-stu-id="9f72b-131">This is discussed in more detail below.</span></span>

<span data-ttu-id="9f72b-132">Se si verifica un errore, l'estensione riceverà una notifica dell'errore e durante il quale l'operazione si è verificata quando viene chiamato il metodo [**IDsAdminNewObjExt:: OnError**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-onerror) .</span><span class="sxs-lookup"><span data-stu-id="9f72b-132">If an error occurs, the extension will be notified of the error and during which operation it occurred when the [**IDsAdminNewObjExt::OnError**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-onerror) method is called.</span></span>

## <a name="implementing-a-primary-object-creation-wizard"></a><span data-ttu-id="9f72b-133">Implementazione di una procedura guidata di creazione di oggetti primari</span><span class="sxs-lookup"><span data-stu-id="9f72b-133">Implementing a Primary Object Creation Wizard</span></span>

<span data-ttu-id="9f72b-134">L'implementazione di una procedura guidata di creazione di un oggetto primario è identica a una procedura guidata di creazione di un oggetto secondario, con la differenza che una procedura guidata di creazione di oggetti primari deve eseguire alcuni passaggi.</span><span class="sxs-lookup"><span data-stu-id="9f72b-134">The implementation of a primary object creation wizard is identical to a secondary object creation wizard, except that a primary object creation wizard must perform a few more steps.</span></span>

<span data-ttu-id="9f72b-135">Prima che la prima pagina venisse rilasciata, la creazione guidata oggetto deve creare l'oggetto directory temporanea.</span><span class="sxs-lookup"><span data-stu-id="9f72b-135">Prior to the first page being dismissed, the object creation wizard must create the temporary directory object.</span></span> <span data-ttu-id="9f72b-136">A tale scopo, chiamare il metodo [**IDsAdminNewObjPrimarySite:: CreateNew**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-createnew) .</span><span class="sxs-lookup"><span data-stu-id="9f72b-136">To do this, call the [**IDsAdminNewObjPrimarySite::CreateNew**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-createnew) method.</span></span> <span data-ttu-id="9f72b-137">Un puntatore all'interfaccia [**IDsAdminNewObjPrimarySite**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjprimarysite) viene ottenuto chiamando [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) con **IID \_ IDsAdminNewObjPrimarySite** sull'interfaccia [**IDsAdminNewObj**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobj) passata a [**IDsAdminNewObjExt:: Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize).</span><span class="sxs-lookup"><span data-stu-id="9f72b-137">A pointer to the [**IDsAdminNewObjPrimarySite**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobjprimarysite) interface is obtained by calling [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) with **IID\_IDsAdminNewObjPrimarySite** on the [**IDsAdminNewObj**](/windows/desktop/api/DSAdmin/nn-dsadmin-idsadminnewobj) interface that is passed to [**IDsAdminNewObjExt::Initialize**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-initialize).</span></span> <span data-ttu-id="9f72b-138">Il metodo **CreateNew** crea un nuovo oggetto temporaneo e chiama [**IDsAdminNewObjExt:: seobject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) per ogni estensione.</span><span class="sxs-lookup"><span data-stu-id="9f72b-138">The **CreateNew** method creates a new temporary object and calls [**IDsAdminNewObjExt::SetObject**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-setobject) for each extension.</span></span>

<span data-ttu-id="9f72b-139">Quando una procedura guidata di creazione di un oggetto contiene più di una pagina, il sistema implementa una pagina di completamento che visualizza un riepilogo delle informazioni sull'oggetto da salvare.</span><span class="sxs-lookup"><span data-stu-id="9f72b-139">When an object creation wizard contains more than one page, the system implements a "Finish" page that displays a summary of the object information to be saved.</span></span> <span data-ttu-id="9f72b-140">Quando si fa clic sul pulsante **fine** nella pagina "Finish" (fine), il sistema chiamerà ogni metodo [**IDsAdminNewObjExt:: WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) dell'estensione per la creazione di oggetti e quindi eseguirà il commit dell'oggetto temporaneo nella memoria persistente.</span><span class="sxs-lookup"><span data-stu-id="9f72b-140">When the **Finish** button on the "Finish" page is clicked, the system will call each of the object creation extension's [**IDsAdminNewObjExt::WriteData**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjext-writedata) method and then commit the temporary object to persistent memory.</span></span> <span data-ttu-id="9f72b-141">Se, tuttavia, la creazione guidata oggetto contiene solo una pagina, nella pagina verranno visualizzati i pulsanti **OK** e **Annulla** anziché i pulsanti **indietro**, **Avanti** e **Annulla** normalmente presenti in una procedura guidata e non viene fornita alcuna pagina "fine".</span><span class="sxs-lookup"><span data-stu-id="9f72b-141">If, however, the object creation wizard only contains one page, the page will have **OK** and **Cancel** buttons instead of the **Back**, **Next** and **Cancel** buttons normally found in a wizard and no "Finish" page is provided.</span></span> <span data-ttu-id="9f72b-142">Per questo motivo, una procedura guidata per l'estensione per la creazione di oggetti a pagina singola deve chiamare [**IDsAdminNewObjPrimarySite:: commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) per eseguire le operazioni di scrittura e salvataggio.</span><span class="sxs-lookup"><span data-stu-id="9f72b-142">Because of this, a single-page object creation extension wizard must call [**IDsAdminNewObjPrimarySite::Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) to perform the write and save operations.</span></span> <span data-ttu-id="9f72b-143">Un'estensione per la creazione di oggetti primari a pagina singola deve chiamare il **commit** in risposta alla notifica [**\_ WIZFINISH PSN**](../controls/psn-wizfinish.md) .</span><span class="sxs-lookup"><span data-stu-id="9f72b-143">A single-page primary object creation extension should call **Commit** in response to the [**PSN\_WIZFINISH**](../controls/psn-wizfinish.md) notification.</span></span>

<span data-ttu-id="9f72b-144">Poiché altre estensioni per la creazione di oggetti possono aggiungere pagine alla procedura guidata, l'estensione per la creazione di oggetti primari potrebbe non essere in grado di stabilire se sono presenti più pagine nella procedura guidata.</span><span class="sxs-lookup"><span data-stu-id="9f72b-144">Because other object creation extensions can add pages to the wizard, the primary object creation extension may not know if there is more than one page in the wizard.</span></span> <span data-ttu-id="9f72b-145">Questo non è un problema per due motivi: prima di tutto, se il sistema implementa la pagina "fine", l'estensione per la creazione di oggetti primari riceverà la notifica [**\_ WIZNEXT PSN**](../controls/psn-wiznext.md) invece della notifica **\_ WIZNEXT PSN** .</span><span class="sxs-lookup"><span data-stu-id="9f72b-145">This is not an issue for two reasons: First, if the system implements the "Finish" page, the primary object creation extension will receive the [**PSN\_WIZNEXT**](../controls/psn-wiznext.md) notification instead of the **PSN\_WIZNEXT** notification.</span></span> <span data-ttu-id="9f72b-146">In secondo luogo, il [**commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) non verrà eseguito in modalità innocua se la procedura guidata contiene più di una pagina.</span><span class="sxs-lookup"><span data-stu-id="9f72b-146">Second, [**Commit**](/windows/desktop/api/DSAdmin/nf-dsadmin-idsadminnewobjprimarysite-commit) will fail harmlessly if the wizard contains more than one page.</span></span>

 

 