---
title: Impostazione dei diritti di accesso per un oggetto
description: In questo argomento viene descritto come creare una voce ACE per un diritto di accesso e impostare tale voce sull'elenco DACL di un oggetto.
ms.assetid: c0b45709-4652-46c7-8d52-44076802d109
ms.tgt_platform: multiple
keywords:
- Impostazione dei diritti di accesso per un annuncio di un oggetto
- Oggetti AD, impostazione dei diritti di accesso per un oggetto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2bcf54de381dab2af1dab4ea44654fb0a5682f06
ms.sourcegitcommit: 803f3ccd65bdefe36bd851b9c6e7280be9489016
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/17/2020
ms.locfileid: "104472467"
---
# <a name="setting-access-rights-on-an-object"></a>Impostazione dei diritti di accesso per un oggetto

Quando si usano gli oggetti ADSI COM [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) (descrittore di sicurezza), [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) (DACL e SACL) e [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) (ACE) per aggiungere una voce ACE a un ACL, si apportano modifiche alla proprietà **ntSecurityDescriptor** dell'oggetto specificato nella cache delle proprietà. Ciò significa che è necessario chiamare i metodi sugli oggetti che contengono la nuova voce ACE e il metodo [**IADs. Seinfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) per scrivere il descrittore di sicurezza aggiornato nella directory dalla cache delle proprietà.

Per ulteriori informazioni e un esempio di codice che imposta una voce ACE su un oggetto in Active Directory Domain Services, vedere il [codice di esempio per l'impostazione di una voce ACE in un oggetto directory](example-code-for-setting-an-ace-on-a-directory-object.md).

Utilizzare il seguente processo generale per creare una voce ACE per un diritto di accesso e impostare tale voce sull'elenco DACL di un oggetto.

1.  Ottiene un puntatore di interfaccia [**IADs**](/windows/desktop/api/iads/nn-iads-iads) all'oggetto.
2.  Usare il metodo [**IADs. Get**](/windows/desktop/api/iads/nf-iads-iads-get) per ottenere il descrittore di sicurezza dell'oggetto. Il nome della proprietà che contiene il descrittore di sicurezza è **ntSecurityDescriptor**. La proprietà verrà restituita come [**Variant**](/windows/win32/api/oaidl/ns-oaidl-variant) contenente un puntatore [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) (il membro **VT** è **VT \_ Dispatch**). Chiamare **QueryInterface** su tale puntatore **IDispatch** per ottenere un'interfaccia [**IADsSecurityDescriptor**](/windows/desktop/api/iads/nn-iads-iadssecuritydescriptor) per usare i metodi su tale interfaccia per accedere all'ACL del descrittore di sicurezza.
3.  Usare la proprietà [**IADsSecurityDescriptor. DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) per ottenere l'elenco DACL. Il metodo restituisce un puntatore [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) . Chiamare **QueryInterface** su tale puntatore **IDispatch** per ottenere un'interfaccia [**IADsAccessControlList**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrollist) per usare i metodi su tale interfaccia per accedere alle singole voci ACE nell'ACL.
4.  Utilizzare [**CoCreateInstance**](/windows/win32/api/combaseapi/nf-combaseapi-cocreateinstance) per creare l'oggetto ADSI com per la nuova voce ACE e ottenere un puntatore di interfaccia [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) a tale oggetto. Tenere presente che l'ID di classe è CLSID \_ AccessControlEntry.
5.  Impostare le proprietà della voce ACE usando i metodi [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) :

    1.  Usare [**IADsAccessControlEntry::p il \_ trustee UT**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) per impostare il trustee a cui si applica questa voce ACE. Il fiduciario è un utente, un gruppo o un'altra entità di sicurezza. L'applicazione deve usare il valore della proprietà appropriata dall'oggetto utente o gruppo del trustee a cui si vuole applicare la voce ACE. Il trustee viene specificato come **BSTR** e può assumere le forme seguenti:
        -   Account di dominio (il nome di accesso utilizzato in una versione precedente di Windows NT) nel formato " <domain> \\ <user account> ", dove " &lt; dominio &gt; " è il nome del dominio Windows NT che contiene l'utente e " &lt; account utente &gt; " è la proprietà **sAMAccountName** dell'utente specificato. Ad esempio: "Fabrikam \\ SergioMelchiori".
        -   Entità di sicurezza nota che rappresenta le identità speciali definite dal sistema di sicurezza di Windows NT, ad esempio Everyone, sistema locale, entità autonoma, utente autenticato, proprietario dell'autore e così via. Gli oggetti che rappresentano le entità di sicurezza note vengono archiviati nel contenitore delle entità di sicurezza noto sotto il contenitore di configurazione. Ad esempio, accesso anonimo.
        -   Gruppo incorporato che rappresenta i gruppi di utenti predefiniti definiti dal sistema di sicurezza di Windows NT. Il formato è "BUILTin \\ <group name> ", dove " &lt; nome gruppo &gt; " è il nome del gruppo di utenti predefinito. Gli oggetti che rappresentano i gruppi predefiniti vengono archiviati nel contenitore incorporato sotto il contenitore di dominio. Ad esempio, "BUILTin \\ Administrators".
        -   SID (formato stringa) dell'utente specificato, ovvero la proprietà **objectSID** dell'utente specificato. È possibile eseguire la conversione in formato stringa usando la funzione [**ConvertSidToStringSid**](/windows/desktop/api/sddl/nf-sddl-convertsidtostringsida) nell'API di sicurezza Win32. Ad esempio: "S-1-5-32-548".
    2.  Usare la proprietà [**IADsAccessControlEntry. AccessMask**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) per impostare la maschera che specifica il diritto di accesso. L'enumerazione [**Ads \_ Rights \_ enum**](/windows/win32/api/iads/ne-iads-ads_rights_enum) specifica i diritti di accesso che è possibile impostare in un oggetto directory.
    3.  Usare la proprietà [**IADsAccessControlEntry. AceType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) per specificare se consentire o negare i diritti di accesso impostati da **accessMask**. Per i diritti standard, questo può essere **Ads \_ ACETYPE \_ accesso \_ consentito** o **Ads \_ ACETYPE \_ accesso \_ negato**. Per i diritti specifici dell'oggetto, ovvero i diritti che si applicano a una parte specifica di un oggetto o a un tipo specifico di oggetto, usare **Ads \_ ACETYPE \_ Access \_ allowed \_ Object** o **Ads \_ ACETYPE \_ Access \_ Denied \_** Object. L'enumerazione [**Ads \_ ACETYPE \_ enum**](/windows/win32/api/iads/ne-iads-ads_acetype_enum) specifica i tipi di accesso che è possibile impostare in una voce ACE.
    4.  Usare la proprietà [**IADsAccessControlEntry. AceFlags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) per specificare se gli altri contenitori o oggetti sotto l'oggetto specificato possono ereditare la voce ACE. L'enumerazione [**Ads \_ ACEFLAG \_ enum**](/windows/win32/api/iads/ne-iads-ads_aceflag_enum) specifica i flag di ereditarietà che è possibile impostare in una voce ACE.
    5.  Usare la proprietà [**IADsAccessControlEntry. Flags**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) per specificare se il diritto si applica a una parte specifica dell'oggetto, a un tipo di oggetto ereditato o a entrambi.
    6.  Se **Flags** è impostato **sul \_ tipo di oggetto flag Ads \_ \_ \_ presente**, impostare la proprietà [**IADSACCESSCONTROLENTRY. ObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) o specificare una stringa contenente il GUID della classe di oggetti (per **Ads \_ Rights \_ DS \_ Create \_ figlio** o **Ads \_ right \_ DS \_ Delete \_ child**), Property, Property set, convalidated Write o Extended right che la voce ACE si applica a. Il GUID deve essere specificato come una stringa del formato prodotto dalla funzione [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) nella libreria com.
    7.  Se **Flags** è impostato **sul \_ flag ADS il tipo di \_ \_ oggetto ereditato \_ \_ presente**, impostare la proprietà [**IADSACCESSCONTROLENTRY. InheritedObjectType**](/windows/desktop/ADSI/iadsaccesscontrolentry-property-methods) per specificare una stringa che contiene il GUID della classe di oggetti ereditata a cui si applica la voce ACE. Il GUID deve essere specificato come una stringa del formato prodotto dalla funzione [**StringFromGUID2**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromguid2) nella libreria com.

6.  Usare il metodo **QueryInterface** sull'oggetto [**IADsAccessControlEntry**](/windows/desktop/api/iads/nn-iads-iadsaccesscontrolentry) per ottenere un puntatore [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch) . Il metodo [**IADsAccessControlList. AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) richiede un puntatore di interfaccia **IDispatch** alla voce ACE.
7.  Usare [**IADsAccessControlList. AddAce**](/windows/desktop/api/iads/nf-iads-iadsaccesscontrollist-addace) per aggiungere la nuova voce ACE all'elenco DACL. Tenere presente che l'ordine delle voci ACE nell'ACL può influire sulla valutazione dell'accesso all'oggetto. Per accedere correttamente all'oggetto, potrebbe essere necessario creare un nuovo ACL, aggiungere le voci ACE dall'ACL esistente nell'ordine corretto al nuovo ACL, quindi sostituire l'ACL esistente nel descrittore di sicurezza con il nuovo ACL. Per ulteriori informazioni, vedere [Order of ACE in a DACL](/windows/desktop/SecAuthZ/order-of-aces-in-a-dacl).
8.  Utilizzare la proprietà [**IADsSecurityDescriptor. DiscretionaryAcl**](/windows/desktop/ADSI/iadssecuritydescriptor-property-methods) per scrivere l'elenco DACL contenente la nuova voce ACE nel descrittore di sicurezza. Per ulteriori informazioni sugli elenchi DACL, vedere [DACL null e elenchi DACL vuoti](null-dacls-and-empty-dacls.md).
9.  Usare il metodo [**IADs. Put**](/windows/desktop/api/iads/nf-iads-iads-put) per scrivere il descrittore di sicurezza nella proprietà **ntSecurityDescriptor** dell'oggetto nella cache delle proprietà.
10. Usare il metodo [**IADs. seinfo**](/windows/desktop/api/iads/nf-iads-iads-setinfo) per aggiornare la proprietà nell'oggetto nella directory.

 

 