---
title: Come eseguire la ricerca con VLV
description: Active Directory supporta le ricerche VLV (Virtual List View). Questo stile di ricerca è progettato appositamente per set di risultati di grandi dimensioni e consente a un'applicazione di visualizzare un subset di migliaia di voci senza dover recuperare ogni voce.
ms.assetid: fea04190-0846-4b62-99f4-7d8fb35fd510
ms.tgt_platform: multiple
keywords:
- Come eseguire la ricerca con VLV
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8f4a24250c8e54ccb7917f86b193152c62810b93
ms.sourcegitcommit: b0ebdefc3dcd5c04bede94091833aa1015a2f95c
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/21/2020
ms.locfileid: "103963461"
---
# <a name="how-to-search-using-vlv"></a><span data-ttu-id="be1b6-105">Come eseguire la ricerca con VLV</span><span class="sxs-lookup"><span data-stu-id="be1b6-105">How to Search Using VLV</span></span>

<span data-ttu-id="be1b6-106">Active Directory supporta le ricerche VLV (Virtual List View).</span><span class="sxs-lookup"><span data-stu-id="be1b6-106">Active Directory supports virtual list view (VLV) searches.</span></span> <span data-ttu-id="be1b6-107">Questo stile di ricerca è progettato appositamente per set di risultati di grandi dimensioni e consente a un'applicazione di visualizzare un subset di migliaia di voci senza dover recuperare ogni voce.</span><span class="sxs-lookup"><span data-stu-id="be1b6-107">This style of search is specifically designed for large result sets and enables an application to display a subset of thousands of entries without actually having to retrieve every entry.</span></span>

<span data-ttu-id="be1b6-108">È possibile utilizzare una ricerca VLV in due modi distinti.</span><span class="sxs-lookup"><span data-stu-id="be1b6-108">There are two distinct ways that a VLV search can be used.</span></span> <span data-ttu-id="be1b6-109">Il primo consiste nel recuperare gli attributi per voci specifiche in base a un offset numerico.</span><span class="sxs-lookup"><span data-stu-id="be1b6-109">The first is to retrieve the attributes for particular entries based on a numeric offset.</span></span> <span data-ttu-id="be1b6-110">Questo metodo è utile quando si recuperano i risultati della ricerca in risposta a un'operazione di scorrimento.</span><span class="sxs-lookup"><span data-stu-id="be1b6-110">This method is useful when retrieving search results in response to a scrolling operation.</span></span>

<span data-ttu-id="be1b6-111">Il secondo modo per usare le ricerche VLV consiste nel cercare parte o tutti gli attributi testuali e visualizzare solo i risultati della ricerca.</span><span class="sxs-lookup"><span data-stu-id="be1b6-111">The second way to use VLV searches is to search for part or all of a textual attribute and only display the results of the search.</span></span> <span data-ttu-id="be1b6-112">Un esempio di utilizzo di questa è una rubrica.</span><span class="sxs-lookup"><span data-stu-id="be1b6-112">An example usage of this is an address book.</span></span> <span data-ttu-id="be1b6-113">Se l'utente digita una "s", l'applicazione può usare una ricerca VLV per cercare le voci con un nome comune che inizia con "s".</span><span class="sxs-lookup"><span data-stu-id="be1b6-113">If the user types an "s", then the application can use a VLV search to search for entries that have a common-name that begins with "s".</span></span> <span data-ttu-id="be1b6-114">Se l'utente aggiunge una "m" alla "s", l'applicazione può usare un'altra ricerca VLV per cercare le voci con un nome comune che inizia con "SM".</span><span class="sxs-lookup"><span data-stu-id="be1b6-114">If the user then adds an "m" to the "s", the application can use another VLV search to search for entries that have a common-name that begins with "sm".</span></span>

<span data-ttu-id="be1b6-115">Per eseguire una ricerca VLV, indicare a ADSI di usare il controllo VLV.</span><span class="sxs-lookup"><span data-stu-id="be1b6-115">To perform a VLV search, instruct ADSI to use the VLV control.</span></span> <span data-ttu-id="be1b6-116">A tale scopo, chiamare il metodo [**IDirectorySearch:: SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) con un'opzione di ricerca **Ads \_ SEARCHPREF \_ VLV** con un valore **specifico di ADSTYPE \_ prov \_** .</span><span class="sxs-lookup"><span data-stu-id="be1b6-116">To do this, call the [**IDirectorySearch::SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) method with an **ADS\_SEARCHPREF\_VLV** search option with an **ADSTYPE\_PROV\_SPECIFIC** value.</span></span> <span data-ttu-id="be1b6-117">Il **valore \_ \_ specifico di ADSTYPE prov** è un puntatore a una struttura [**\_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) che contiene i dati relativi alla ricerca.</span><span class="sxs-lookup"><span data-stu-id="be1b6-117">The **ADSTYPE\_PROV\_SPECIFIC** value is a pointer to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure that contains data about the search.</span></span> <span data-ttu-id="be1b6-118">La funzione di esempio [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) Mostra come impostare entrambe le preferenze di ricerca.</span><span class="sxs-lookup"><span data-stu-id="be1b6-118">The [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) example function shows how to set both of these search preferences.</span></span>

<span data-ttu-id="be1b6-119">Tutte le ricerche VLV devono usare l'ordinamento dei risultati sul lato server, che viene eseguito impostando le preferenze di ricerca di **\_ SEARCHPREF \_ \_ per gli annunci** .</span><span class="sxs-lookup"><span data-stu-id="be1b6-119">All VLV searches must use server-side result sorting, which is performed by setting the **ADS\_SEARCHPREF\_SORT\_ON** search preference.</span></span> <span data-ttu-id="be1b6-120">Per altre informazioni sulle preferenze di ricerca per gli **annunci \_ SEARCHPREF \_ \_** , vedere [ordinamento dei risultati della ricerca con IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span><span class="sxs-lookup"><span data-stu-id="be1b6-120">For more information about the **ADS\_SEARCHPREF\_SORT\_ON** search preference, see [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span></span>

<span data-ttu-id="be1b6-121">Quando viene eseguita una ricerca VLV, una determinata quantità di metadati relativi alla ricerca viene restituita in una colonna recuperata chiamando [**IDirectorySearch:: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) con l'identificatore **di \_ \_ risposta VLV ADS** .</span><span class="sxs-lookup"><span data-stu-id="be1b6-121">When a VLV search is performed, a certain amount of metadata about the search is returned in a column that is retrieved by calling [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the **ADS\_VLV\_RESPONSE** identifier.</span></span> <span data-ttu-id="be1b6-122">Questi dati sono contenuti in una [**struttura \_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="be1b6-122">This data is contained in an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span> <span data-ttu-id="be1b6-123">Di particolare importanza sono i membri **dwContentCount** e **lpContextID** .</span><span class="sxs-lookup"><span data-stu-id="be1b6-123">Of particular importance are the **dwContentCount** and **lpContextID** members.</span></span> <span data-ttu-id="be1b6-124">Il membro **dwContentCount** conterrà il numero di risultati che soddisfano i criteri di ricerca VLV.</span><span class="sxs-lookup"><span data-stu-id="be1b6-124">The **dwContentCount** member will contain the number of results that meet the VLV search criteria.</span></span> <span data-ttu-id="be1b6-125">Questo valore può essere utilizzato come stima del numero totale di elementi che verrebbero restituiti per una ricerca di quel tipo.</span><span class="sxs-lookup"><span data-stu-id="be1b6-125">This value can be used as an estimate of the total number of items that would be returned for a search of that type.</span></span> <span data-ttu-id="be1b6-126">Il membro **lpContextID** contiene un valore definito dal server che può essere passato alla ricerca successiva per identificare la ricerca.</span><span class="sxs-lookup"><span data-stu-id="be1b6-126">The **lpContextID** member contains a server-defined value that can be passed to the next search to identify the search.</span></span> <span data-ttu-id="be1b6-127">L'uso di **lpContextID** può migliorare le prestazioni di ricerca.</span><span class="sxs-lookup"><span data-stu-id="be1b6-127">Using the **lpContextID** can enhance the search performance.</span></span> <span data-ttu-id="be1b6-128">Tenere presente che **lpContextID** è un valore definito dal server e che la sua lunghezza è contenuta nel membro **dwContextIDLength** .</span><span class="sxs-lookup"><span data-stu-id="be1b6-128">Be aware that the **lpContextID** is a server-defined value and its length is contained in the **dwContextIDLength** member.</span></span> <span data-ttu-id="be1b6-129">Questo buffer viene liberato quando viene chiamato il metodo [**IDirectorySearch:: FreeColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-freecolumn) , quindi il chiamante deve allocare un buffer di dimensioni appropriate e copiare e salvare il contenuto del buffer tra le ricerche.</span><span class="sxs-lookup"><span data-stu-id="be1b6-129">This buffer is freed when the [**IDirectorySearch::FreeColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-freecolumn) method is called, so the caller must allocate a buffer of the appropriate size and copy and save the contents of the buffer between searches.</span></span>

<span data-ttu-id="be1b6-130">Per ulteriori informazioni sul controllo LDAP VLV, vedere [ricerca con il controllo LDAP VLV](/previous-versions/windows/desktop/ldap/searching-with-the-ldap-vlv-control).</span><span class="sxs-lookup"><span data-stu-id="be1b6-130">For more information about the LDAP VLV control, see [Searching with the LDAP VLV Control](/previous-versions/windows/desktop/ldap/searching-with-the-ldap-vlv-control).</span></span>

<span data-ttu-id="be1b6-131">Per altre informazioni, vedere:</span><span class="sxs-lookup"><span data-stu-id="be1b6-131">For more information, see:</span></span>

-   <span data-ttu-id="be1b6-132">Recupero del numero di elementi</span><span class="sxs-lookup"><span data-stu-id="be1b6-132">Obtaining the Number of Items</span></span>
-   <span data-ttu-id="be1b6-133">Ricerca per offset</span><span class="sxs-lookup"><span data-stu-id="be1b6-133">Searching by Offset</span></span>
-   <span data-ttu-id="be1b6-134">Ricerca per stringa</span><span class="sxs-lookup"><span data-stu-id="be1b6-134">Searching by String</span></span>
-   [<span data-ttu-id="be1b6-135">Codice di esempio per l'uso di una ricerca VLV</span><span class="sxs-lookup"><span data-stu-id="be1b6-135">Example Code for Using a VLV Search</span></span>](example-code-for-using-a-vlv-search.md)

## <a name="obtaining-the-number-of-items"></a><span data-ttu-id="be1b6-136">Recupero del numero di elementi</span><span class="sxs-lookup"><span data-stu-id="be1b6-136">Obtaining the Number of Items</span></span>

<span data-ttu-id="be1b6-137">**Per ottenere una stima del numero di elementi che verranno restituiti per una particolare ricerca, seguire questa procedura.**</span><span class="sxs-lookup"><span data-stu-id="be1b6-137">**To obtain an estimate of the number of items that will be returned for a particular search, perform the following steps.**</span></span>

1.  <span data-ttu-id="be1b6-138">Compilare una struttura [**Ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) con tutti i valori zero o **null** .</span><span class="sxs-lookup"><span data-stu-id="be1b6-138">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with all zero or **NULL** values.</span></span>
2.  <span data-ttu-id="be1b6-139">Compilare un [**annuncio \_ SEARCHPREF \_ info**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) con i valori seguenti.</span><span class="sxs-lookup"><span data-stu-id="be1b6-139">Fill an [**ADS\_SEARCHPREF\_INFO**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) with the following values.</span></span>

    -   <span data-ttu-id="be1b6-140">Impostare il membro **dwSearchPref** su **Ads \_ SEARCHPREF \_ VLV**.</span><span class="sxs-lookup"><span data-stu-id="be1b6-140">Set the **dwSearchPref** member to **ADS\_SEARCHPREF\_VLV**.</span></span>
    -   <span data-ttu-id="be1b6-141">Impostare il membro **vValue. dwType** su **ADSTYPE \_ prov \_ specific**.</span><span class="sxs-lookup"><span data-stu-id="be1b6-141">Set the **vValue.dwType** member to **ADSTYPE\_PROV\_SPECIFIC**.</span></span>
    -   <span data-ttu-id="be1b6-142">Impostare il membro **vValue. ProviderSpecific. dwLength** sulla dimensione della struttura [**Ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="be1b6-142">Set the **vValue.ProviderSpecific.dwLength** member to the size of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span>
    -   <span data-ttu-id="be1b6-143">Impostare il membro **vValue. ProviderSpecific. lpValue** sull'indirizzo della struttura [**Ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) del passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="be1b6-143">Set the **vValue.ProviderSpecific.lpValue** member to the address of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure from Step 1.</span></span>

3.  <span data-ttu-id="be1b6-144">Compilare una struttura di [**\_ SORTKEY ADS**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) come illustrato nell' [ordinamento dei risultati della ricerca con IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md) per ordinare l'attributo desiderato.</span><span class="sxs-lookup"><span data-stu-id="be1b6-144">Fill an [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure as shown in [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md) to sort on the desired attribute.</span></span>
4.  <span data-ttu-id="be1b6-145">Compilare un altro [**annuncio \_ SEARCHPREF \_ info**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) per aggiungere la struttura di [**\_ SORTKEY ADS**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) alle preferenze di ricerca, come illustrato nell' [ordinamento dei risultati della ricerca con IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span><span class="sxs-lookup"><span data-stu-id="be1b6-145">Fill another [**ADS\_SEARCHPREF\_INFO**](/windows/desktop/api/Iads/ns-iads-ads_searchpref_info) to add the [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure to the search preferences as shown in [Sorting the Search Results with IDirectorySearch](sorting-the-search-results-with-idirectorysearch.md).</span></span>
5.  <span data-ttu-id="be1b6-146">Aggiungere le altre preferenze di ricerca desiderate e chiamare [**IDirectorySearch:: SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) per impostare le preferenze di ricerca.</span><span class="sxs-lookup"><span data-stu-id="be1b6-146">Add any other desired search preferences and call [**IDirectorySearch::SetSearchPreference**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-setsearchpreference) to set the search preferences.</span></span>
6.  <span data-ttu-id="be1b6-147">Eseguire la ricerca con [**IDirectorySearch:: ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span><span class="sxs-lookup"><span data-stu-id="be1b6-147">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
7.  <span data-ttu-id="be1b6-148">Ottenere la prima riga di risultati chiamando [**IDirectorySearch:: GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span><span class="sxs-lookup"><span data-stu-id="be1b6-148">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
8.  <span data-ttu-id="be1b6-149">Chiamare [**IDirectorySearch:: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) con **Ads \_ VLV \_ Response** per ottenere i metadati di ricerca VLV.</span><span class="sxs-lookup"><span data-stu-id="be1b6-149">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
9.  <span data-ttu-id="be1b6-150">Eseguire il cast di **pADsValues->ProviderSpecific. lpValue** della struttura della [**\_ \_ colonna di ricerca ADS**](/windows/desktop/api/Iads/ns-iads-ads_search_column) a un puntatore alla struttura [**Ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="be1b6-150">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span> <span data-ttu-id="be1b6-151">Il membro **dwContentCount** della struttura **Ads \_ VLV** contiene il numero approssimativo di elementi che verrebbero restituiti da una ricerca di quel tipo.</span><span class="sxs-lookup"><span data-stu-id="be1b6-151">The **dwContentCount** member of this **ADS\_VLV** structure contains the approximate number of items that would be returned by a search of that type.</span></span>
10. <span data-ttu-id="be1b6-152">Se verranno eseguite altre ricerche VLV dello stesso tipo, creare una copia dei dati **lpContextID** e conservarla per la successiva ricerca VLV.</span><span class="sxs-lookup"><span data-stu-id="be1b6-152">If other VLV searches of the same type will be performed, make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span>

<span data-ttu-id="be1b6-153">La funzione di esempio [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) illustra come eseguire questa operazione.</span><span class="sxs-lookup"><span data-stu-id="be1b6-153">The [**GetVLVItemCount**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

## <a name="searching-by-offset"></a><span data-ttu-id="be1b6-154">Ricerca per offset</span><span class="sxs-lookup"><span data-stu-id="be1b6-154">Searching by Offset</span></span>

<span data-ttu-id="be1b6-155">Una cosa che rende le ricerche VLV in modo rapido è che è possibile cercare un risultato specifico in base a un offset numerico.</span><span class="sxs-lookup"><span data-stu-id="be1b6-155">One thing that makes VLV searches so quick is that it is possible to search for a specific result by a numerical offset.</span></span> <span data-ttu-id="be1b6-156">Se, ad esempio, una ricerca restituisce 10.000 elementi restituiti, una ricerca di VLV consente di ottenere le informazioni per approssimativamente l'elemento 4072nd senza dover recuperare tutti gli elementi prima dell'elemento in questione.</span><span class="sxs-lookup"><span data-stu-id="be1b6-156">For example, if a search would result in 10,000 items being returned, a VLV search makes it possible to obtain the information for approximately the 4072nd item without having to retrieve all of the items before the item in question.</span></span>

<span data-ttu-id="be1b6-157">Gli offset vengono specificati come rapporto tra l'offset e il conteggio del contenuto.</span><span class="sxs-lookup"><span data-stu-id="be1b6-157">Offsets are specified as a ratio between the offset and the content count.</span></span> <span data-ttu-id="be1b6-158">I rapporti sono utili perché è possibile che il server non disponga di una stima accurata del numero di voci presenti nell'elenco oppure che le dimensioni dell'elenco possano variare durante il periodo di esplorazione dell'utente.</span><span class="sxs-lookup"><span data-stu-id="be1b6-158">Ratios are useful because the server may not have an accurate estimate of the number of entries that exist in the list or the list size may be changing during the time the user is browsing it.</span></span> <span data-ttu-id="be1b6-159">Poiché è necessario indicare l'inizio e la fine dell'elenco, è possibile usare un valore stimato per il conteggio contenuto nella prima richiesta di ricerca, insieme a un valore di offset.</span><span class="sxs-lookup"><span data-stu-id="be1b6-159">Because you must indicate the beginning and end of the list, you can use an estimated value for the content count in the first search request, along with an offset value.</span></span> <span data-ttu-id="be1b6-160">Il server usa questi dati per calcolare gli offset corrispondenti all'interno dell'elenco, in base all'idea del conteggio contenuto, che viene inviato in risposta al client tramite il membro **dwContentCount** della struttura [**\_ VLV ADS**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="be1b6-160">The server uses this data to compute the corresponding offsets within the list, based on its idea of content count, which is sent in its response to the client through the **dwContentCount** member of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure.</span></span> <span data-ttu-id="be1b6-161">Se ad esempio si stima che le dimensioni dell'elenco siano pari a 3000 e si desidera che l'offset sia la voce di elenco 1500, è necessario impostare **dwContentCount** su 3000 e **dwOffset** su 1500.</span><span class="sxs-lookup"><span data-stu-id="be1b6-161">For example, if you estimate the list size to be 3000, and you want the offset to be list entry 1500, you would set **dwContentCount** to 3000 and **dwOffset** to 1500.</span></span> <span data-ttu-id="be1b6-162">Se il server stima le dimensioni effettive dell'elenco come 4500, l'offset verrà ricalcolato a 2250 e verranno restituite le nuove stime in **dwContentCount** e **dwOffset**.</span><span class="sxs-lookup"><span data-stu-id="be1b6-162">If the server estimates the actual list size to be 4500, it will recalculate the offset to 2250, and return the new estimates in **dwContentCount** and **dwOffset**.</span></span>

> [!Note]
>
> <span data-ttu-id="be1b6-163">Tutti i valori numerici in una ricerca VLV sono approssimazioni e non devono essere usati per i valori assoluti.</span><span class="sxs-lookup"><span data-stu-id="be1b6-163">All of the numeric values in a VLV search are approximations and should not be used for absolute values.</span></span> <span data-ttu-id="be1b6-164">Se, ad esempio, si esegue una ricerca VLV per il cinquantesimo elemento in una razione di 100, non è garantito l'ottenimento dell'elemento intermedio esatto.</span><span class="sxs-lookup"><span data-stu-id="be1b6-164">For example, if you issue a VLV search for the 50th item in a ration of 100, you are not guaranteed to get the exact middle item.</span></span>
>
> <span data-ttu-id="be1b6-165">**Per cercare un determinato elemento in base all'offset, seguire questa procedura.**</span><span class="sxs-lookup"><span data-stu-id="be1b6-165">**To search for a particular item by offset, perform the following steps.**</span></span>
>
> 1.  <span data-ttu-id="be1b6-166">Compilare una struttura [**Ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) con i valori seguenti.</span><span class="sxs-lookup"><span data-stu-id="be1b6-166">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with the following values.</span></span> <span data-ttu-id="be1b6-167">I membri aggiuntivi della struttura devono essere impostati su zero o **null**.</span><span class="sxs-lookup"><span data-stu-id="be1b6-167">Additional members of the structure should be set to zero or **NULL**.</span></span>
>
>     -   <span data-ttu-id="be1b6-168">Impostare il membro **dwContentCount** sul valore massimo del rapporto tra gli elementi da recuperare.</span><span class="sxs-lookup"><span data-stu-id="be1b6-168">Set the **dwContentCount** member to the maximum value of the ratio of items to retrieve.</span></span>
>     -   <span data-ttu-id="be1b6-169">Impostare il membro **dwOffset** sul rapporto rispetto a **dwContentCount** per l'elemento o gli elementi da recuperare.</span><span class="sxs-lookup"><span data-stu-id="be1b6-169">Set the **dwOffset** member to the ratio, relative to **dwContentCount**, of the item or items to retrieve.</span></span>
>     -   <span data-ttu-id="be1b6-170">Impostare il membro **lpContextID** sull'indirizzo della copia del buffer dell'ID del contesto e il **dwContextIDLength** sulla lunghezza, in byte, del buffer dell'ID del contesto.</span><span class="sxs-lookup"><span data-stu-id="be1b6-170">Set the **lpContextID** member to the address of the copy of the context ID buffer and the **dwContextIDLength** to the length, in bytes, of the context ID buffer.</span></span> <span data-ttu-id="be1b6-171">Se non è stato salvato alcun ID contesto, entrambi i membri devono essere zero o **null**.</span><span class="sxs-lookup"><span data-stu-id="be1b6-171">If no context ID has been saved, both of the these members should be zero or **NULL**.</span></span>
>
> 2.  <span data-ttu-id="be1b6-172">Impostare le preferenze di ricerca come illustrato nei passaggi da 2 a 5 della procedura recupero del numero di elementi.</span><span class="sxs-lookup"><span data-stu-id="be1b6-172">Set the search preferences as shown in Steps 2 through 5 of the Obtaining the Number of Items procedure.</span></span>
> 3.  <span data-ttu-id="be1b6-173">Eseguire la ricerca con [**IDirectorySearch:: ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span><span class="sxs-lookup"><span data-stu-id="be1b6-173">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
> 4.  <span data-ttu-id="be1b6-174">Ottenere la prima riga di risultati chiamando [**IDirectorySearch:: GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span><span class="sxs-lookup"><span data-stu-id="be1b6-174">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
> 5.  <span data-ttu-id="be1b6-175">Chiamare [**IDirectorySearch:: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) con il nome dell'attributo da recuperare per ottenere i dati effettivi per l'elemento richiesto.</span><span class="sxs-lookup"><span data-stu-id="be1b6-175">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the name of the attribute to retrieve to get the actual data for the requested item.</span></span>
> 6.  <span data-ttu-id="be1b6-176">Chiamare [**IDirectorySearch:: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) con **Ads \_ VLV \_ Response** per ottenere i metadati di ricerca VLV.</span><span class="sxs-lookup"><span data-stu-id="be1b6-176">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
> 7.  <span data-ttu-id="be1b6-177">Eseguire il cast di **pADsValues->ProviderSpecific. lpValue** della struttura della [**\_ \_ colonna di ricerca ADS**](/windows/desktop/api/Iads/ns-iads-ads_search_column) a un puntatore alla struttura [**Ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="be1b6-177">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span>
> 8.  <span data-ttu-id="be1b6-178">Creare una copia dei dati di **lpContextID** e conservarla per la successiva ricerca di VLV.</span><span class="sxs-lookup"><span data-stu-id="be1b6-178">Make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span>

 

<span data-ttu-id="be1b6-179">La funzione di esempio [**GetVLVItemText**](example-code-for-using-a-vlv-search.md) illustra come eseguire questa operazione.</span><span class="sxs-lookup"><span data-stu-id="be1b6-179">The [**GetVLVItemText**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

<span data-ttu-id="be1b6-180">È anche possibile recuperare più di una riga di dati con una singola chiamata di ricerca.</span><span class="sxs-lookup"><span data-stu-id="be1b6-180">It is also possible to retrieve more than one row of data with a single search call.</span></span> <span data-ttu-id="be1b6-181">Questa operazione viene eseguita nel passaggio 1 impostando in modo appropriato i membri **dwBeforeCount** e **DwAfterCount** della struttura [**Ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="be1b6-181">This is done in Step 1 by setting the **dwBeforeCount** and **dwAfterCount** members of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure appropriately.</span></span> <span data-ttu-id="be1b6-182">Il membro **dwBeforeCount** contiene il numero di elementi visualizzati nell'elenco prima dell'elemento in questione e il membro **dwAfterCount** contiene il numero di elementi visualizzati nell'elenco dopo l'elemento in questione.</span><span class="sxs-lookup"><span data-stu-id="be1b6-182">The **dwBeforeCount** member contains the number of items that appear in the list prior to the item in question and the **dwAfterCount** member contains the number of items that appear in the list after to the item in question.</span></span> <span data-ttu-id="be1b6-183">Entrambi i conteggi escludono l'elemento stesso, quindi impostando **dwBeforeCount** su 10 e **dwAfterCount** su 10 si otterrà un totale di 21 elementi restituiti.</span><span class="sxs-lookup"><span data-stu-id="be1b6-183">Both of these counts exclude the item itself, so setting **dwBeforeCount** to 10 and **dwAfterCount** to 10 will result in a total of 21 items returned.</span></span> <span data-ttu-id="be1b6-184">Questa opzione consente di memorizzare nella cache i risultati della ricerca sul lato client.</span><span class="sxs-lookup"><span data-stu-id="be1b6-184">This option enables caching the search results on the client side.</span></span>

## <a name="searching-by-string"></a><span data-ttu-id="be1b6-185">Ricerca per stringa</span><span class="sxs-lookup"><span data-stu-id="be1b6-185">Searching by String</span></span>

<span data-ttu-id="be1b6-186">È anche possibile usare una ricerca VLV per trovare gli elementi che hanno un attributo di stringa il cui valore corrisponde a tutta o parte di una stringa senza dover recuperare tutti gli elementi.</span><span class="sxs-lookup"><span data-stu-id="be1b6-186">It is also possible to use a VLV search to find items that have a string attribute whose value matches all or part of a string without having to retrieve all items.</span></span> <span data-ttu-id="be1b6-187">La corrispondenza di stringa viene eseguita in base all'attributo specificato nella struttura [**\_ SORTKEY ADS**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) della **preferenza \_ SEARCHPREF \_ Sort \_ on** search.</span><span class="sxs-lookup"><span data-stu-id="be1b6-187">The string matching is performed against the attribute specified in the [**ADS\_SORTKEY**](/windows/desktop/api/Iads/ns-iads-ads_sortkey) structure of the **ADS\_SEARCHPREF\_SORT\_ON** search preference.</span></span>

<span data-ttu-id="be1b6-188">**Per cercare un particolare elemento in base alla stringa, seguire questa procedura.**</span><span class="sxs-lookup"><span data-stu-id="be1b6-188">**To search for a particular item by string, perform the following steps.**</span></span>

1.  <span data-ttu-id="be1b6-189">Compilare una struttura [**Ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) con i valori seguenti.</span><span class="sxs-lookup"><span data-stu-id="be1b6-189">Fill an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure with the following values.</span></span> <span data-ttu-id="be1b6-190">I membri aggiuntivi della struttura devono essere impostati su zero o **null**.</span><span class="sxs-lookup"><span data-stu-id="be1b6-190">Additional members of the structure should be set to zero or **NULL**.</span></span>

    -   <span data-ttu-id="be1b6-191">Impostare il membro **pszTarget verranno rimosse** su un puntatore a una stringa con terminazione null che contiene la stringa da cercare.</span><span class="sxs-lookup"><span data-stu-id="be1b6-191">Set the **pszTarget** member to a pointer to a NULL-terminated string that contains the string to search for.</span></span>
    -   <span data-ttu-id="be1b6-192">Impostare il membro **lpContextID** sull'indirizzo della copia del buffer dell'ID del contesto e il **dwContextIDLength** sulla lunghezza, in byte, del buffer dell'ID del contesto.</span><span class="sxs-lookup"><span data-stu-id="be1b6-192">Set the **lpContextID** member to the address of the copy of the context ID buffer and the **dwContextIDLength** to the length, in bytes, of the context ID buffer.</span></span> <span data-ttu-id="be1b6-193">Se non è stato salvato alcun ID contesto, entrambi i membri devono essere zero o **null**.</span><span class="sxs-lookup"><span data-stu-id="be1b6-193">If no context ID has been saved, both of the these members should be zero or **NULL**.</span></span>

2.  <span data-ttu-id="be1b6-194">Impostare le preferenze di ricerca come illustrato nei passaggi da 2 a 5 della procedura recupero del numero di elementi.</span><span class="sxs-lookup"><span data-stu-id="be1b6-194">Set the search preferences as shown in Steps 2 through 5 of the Obtaining the Number of Items procedure.</span></span>
3.  <span data-ttu-id="be1b6-195">Eseguire la ricerca con [**IDirectorySearch:: ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span><span class="sxs-lookup"><span data-stu-id="be1b6-195">Perform the search with [**IDirectorySearch::ExecuteSearch**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-executesearch).</span></span>
4.  <span data-ttu-id="be1b6-196">Ottenere la prima riga di risultati chiamando [**IDirectorySearch:: GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span><span class="sxs-lookup"><span data-stu-id="be1b6-196">Get the first row of results by calling [**IDirectorySearch::GetFirstRow**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getfirstrow).</span></span>
5.  <span data-ttu-id="be1b6-197">Chiamare [**IDirectorySearch:: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) con il nome dell'attributo da recuperare per ottenere i dati effettivi per l'elemento richiesto.</span><span class="sxs-lookup"><span data-stu-id="be1b6-197">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with the name of the attribute to retrieve to get the actual data for the requested item.</span></span>
6.  <span data-ttu-id="be1b6-198">Chiamare [**IDirectorySearch:: GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) con **Ads \_ VLV \_ Response** per ottenere i metadati di ricerca VLV.</span><span class="sxs-lookup"><span data-stu-id="be1b6-198">Call [**IDirectorySearch::GetColumn**](/windows/desktop/api/Iads/nf-iads-idirectorysearch-getcolumn) with **ADS\_VLV\_RESPONSE** to obtain the VLV search metadata.</span></span>
7.  <span data-ttu-id="be1b6-199">Eseguire il cast di **pADsValues->ProviderSpecific. lpValue** della struttura della [**\_ \_ colonna di ricerca ADS**](/windows/desktop/api/Iads/ns-iads-ads_search_column) a un puntatore alla struttura [**Ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="be1b6-199">Cast the **pADsValues->ProviderSpecific.lpValue** of the [**ADS\_SEARCH\_COLUMN**](/windows/desktop/api/Iads/ns-iads-ads_search_column) structure to an [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure pointer.</span></span>
8.  <span data-ttu-id="be1b6-200">Creare una copia dei dati di **lpContextID** e conservarla per la successiva ricerca di VLV.</span><span class="sxs-lookup"><span data-stu-id="be1b6-200">Make a copy of the **lpContextID** data and preserve it for the next VLV search.</span></span> <span data-ttu-id="be1b6-201">Se necessario, il membro **dwOffset** contiene l'indice in base uno del primo elemento il cui attributo String inizia con il valore specificato in **pszTarget verranno rimosse**.</span><span class="sxs-lookup"><span data-stu-id="be1b6-201">If required, the **dwOffset** member contains the one-based index of the first item whose string attribute begins with the value specified in **pszTarget**.</span></span>

<span data-ttu-id="be1b6-202">La funzione di esempio [**GetVLVItemsByString**](example-code-for-using-a-vlv-search.md) illustra come eseguire questa operazione.</span><span class="sxs-lookup"><span data-stu-id="be1b6-202">The [**GetVLVItemsByString**](example-code-for-using-a-vlv-search.md) example function shows how to do this.</span></span>

<span data-ttu-id="be1b6-203">Analogamente alla ricerca in base all'indice, è anche possibile recuperare più di una riga di dati con una singola chiamata di ricerca.</span><span class="sxs-lookup"><span data-stu-id="be1b6-203">Similarly to searching by index, it is also possible to retrieve more than one row of data with a single search call.</span></span> <span data-ttu-id="be1b6-204">Questa operazione viene eseguita nello stesso modo impostando in modo appropriato i membri **dwBeforeCount** e **DwAfterCount** della struttura [**Ads \_ VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) .</span><span class="sxs-lookup"><span data-stu-id="be1b6-204">This is accomplished in the same manner by setting the **dwBeforeCount** and **dwAfterCount** members of the [**ADS\_VLV**](/windows/desktop/api/Iads/ns-iads-ads_vlv) structure appropriately.</span></span>

 

 