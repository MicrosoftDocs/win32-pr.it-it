---
title: Installazione su richiesta per giochi
description: Questo articolo tecnico illustra due tecniche, installazione su richiesta e installazione in background, usando Windows Installer.
ms.assetid: abaaa7bf-8ed8-0425-6845-3671a56fe7fc
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 064dc58c563c372d1320a21040920e492e4e65e4
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "106300107"
---
# <a name="install-on-demand-for-games"></a>Installazione su richiesta per giochi

Questo articolo tecnico illustra due tecniche, installazione su richiesta e installazione in background, usando [Windows Installer](/windows/desktop/Msi/windows-installer-portal). I giochi possono usare queste tecniche di installazione per offrire un'esperienza di gioco migliore e più gradevole per i giocatori riducendo il tempo di installazione.

-   [Overview](#overview)
-   [Supporto per l'applicazione di patch](#patching-support)
-   [Esempio di InstallOnDemand SDK](#the-installondemand-sdk-sample)
-   [Funzionalità e componenti dell'esempio](#the-samples-features-and-components)
-   [Installazione](#installation)
-   [Limitazione](#limitation)

## <a name="overview"></a>Panoramica

L'installazione è un elemento di applicazioni basate su computer per molto tempo. Per la maggior parte delle applicazioni, oggi è necessario che vengano installate sul disco rigido locale dell'utente prima di poterle usare. I giochi per computer non sono un'eccezione; Quando un consumer acquista un gioco Microsoft Windows e tenta di eseguirlo, deve eseguire prima di tutto un processo di installazione che copia i file necessari dal disco del gioco sul disco rigido. Questo processo di installazione è in genere lungo e può richiedere fino a un'ora per il completamento. Il tempo di installazione è un fattore che rende più appetibili i giochi di console rispetto ai giochi basati su computer per alcuni lettori, perché sono in grado di riprodurre immediatamente un gioco console dopo aver inserito il disco del gioco. La tecnologia illustrata in questo articolo tenterà di risolvere il problema riducendo drasticamente il tempo di installazione.

Tradizionalmente, i giochi richiedono che tutti o la maggior parte dei file vengano installati prima dell'avvio. Per ottenere l'installazione su richiesta, è necessario che le risorse del gioco siano modulari. ovvero lo sviluppatore deve dividere le risorse dell'applicazione (grafica, audio e così via) in componenti. Ogni componente è un set di risorse che possono essere installate o rimosse come unità. Al termine di questa operazione, lo sviluppatore del gioco definisce una o più funzionalità, in genere una o più per ogni livello o zona. Ogni funzionalità di un'applicazione specifica un set di componenti necessari per l'esecuzione di una determinata funzionalità. Quando si installa un'applicazione, le relative funzionalità possono essere contrassegnate come "Installa" (componenti copiati sul disco rigido locale al momento dell'installazione) o "annunciate" (componenti copiati sul disco rigido locale dopo l'installazione iniziale quando l'applicazione usa tale funzionalità). Uno sviluppatore di giochi può ridurre il tempo di installazione progettando il gioco per l'avvio e l'esecuzione con un set minimo di funzionalità installate. Il resto delle sue funzionalità può essere contrassegnato come annunciato e installato su richiesta quando l'applicazione deve effettivamente usare le funzionalità fornite da tali funzionalità.

I giochi possono chiamare [Windows Installer](/windows/desktop/Msi/windows-installer-portal) per installare una funzionalità specifica che potrebbe non essere stata installata. Per fare in modo che l'installazione venga visualizzata in background, è possibile usare un thread di lavoro per effettuare le chiamate al programma di installazione mentre il thread primario continua a gestire la logica del gioco e a eseguire il rendering dello schermo. In questo modo si riduce al minimo l'alterazione del gameplay causato dall'installazione. Il gioco può avviare l'installazione in qualsiasi momento. Tuttavia, poiché l'installazione usa cicli del processore, non è in genere consigliabile eseguire l'installazione quando il thread primario è in una necessità critica di potenza di elaborazione, ad esempio quando l'utente è al centro dell'azione. Ad esempio, un momento opportuno per eseguire l'installazione può essere quando l'utente si trova nel menu del gioco, quando il gioco viene sospeso o ridotto a icona oppure quando l'utente Guarda il filmato introduttivo o la sequenza di filmati.

## <a name="patching-support"></a>Supporto per l'applicazione di patch

La maggior parte dei giochi attualmente deve essere aggiornata anche dopo che sono stati risolti e sono state aggiunte nuove funzionalità. L'aggiornamento richiede spesso l'applicazione di patch, che è tradizionalmente una procedura semplice per i giochi. Poiché tutti i file necessari vengono installati nel disco rigido dell'utente, l'applicazione di patch a un gioco comporta la copia dei file modificati sul disco rigido, sovrascrivendo i file esistenti. Quando viene utilizzata l'installazione su richiesta, non tutti i file vengono installati e copiati al momento dell'applicazione di patch. Pertanto, il Patcher non può semplicemente scrivere file aggiornati nella cartella del gioco.

[Windows Installer](/windows/desktop/Msi/windows-installer-portal) dispone di funzionalità per l'applicazione di patch alle applicazioni che usano l'installazione su richiesta. Quando si applica una patch, il programma di installazione memorizza nella cache la patch nel sistema. Questa funzionalità funziona bene per le patch con Delta di piccole dimensioni. I file originariamente rilasciati non devono più trovarsi sul disco al momento dell'applicazione di patch, quindi è possibile annunciare tali file. Successivamente, quando l'applicazione viene eseguita e deve accedere ai file, il programma di installazione installa la versione più recente di tali file copiando la versione rilasciata in origine dal supporto (ad esempio, CDs) e applicando la patch dopo la lettura dei dati della patch salvati.

## <a name="the-installondemand-sdk-sample"></a>Esempio di InstallOnDemand SDK

L'esempio di installazione su richiesta per i giochi illustra le tecniche di installazione su richiesta descritte in questo articolo. A differenza di altri esempi, non è possibile eseguire l'installazione su richiesta dei giochi direttamente dal browser di esempio. Poiché l'esempio usa il [Windows Installer](/windows/desktop/Msi/windows-installer-portal) per gestirne l'installazione, è necessario che sia incluso nel database del programma di installazione delle applicazioni installate.

**Per avviare l'esempio**

1.  Usare il collegamento Installa progetto nel browser di esempio per copiare i file dell'esempio in una cartella.
2.  Fare doppio clic su InstallOnDemand.msi per installare l'esempio.
3.  Selezionare installazione tipica.
4.  Avviare l'esempio avviando il InstallOnDemand.exe nella cartella installata (in genere file di programma \\ InstallOnDemand) o avviando da programmi del menu Start \\ .

InstallOnDemand.msi è un database riconosciuto dal programma di installazione. Definisce l'intero processo di installazione: la struttura di directory, gli elementi che non verranno copiati, le risorse che verranno copiate insieme, i valori del registro di sistema da scrivere, i collegamenti da creare e così via.

Quando viene avviata, l'esempio riproduce una sequenza introduttiva. Il lettore può terminare e immettere il menu principale premendo ESC. In seguito all'introduzione, il lettore può avviare un nuovo gioco immettendo un nome di carattere e scorrendo le statistiche. Prima di iniziare a riprodurre la sequenza di introduzione, l'esempio chiama una funzione del programma di installazione per verificare se è installata la funzionalità per il livello 1. Se la funzionalità di livello 1 non è stata installata, nell'esempio viene usato un thread in background per richiedere al programma di installazione di installare il gioco, mentre il thread principale esegue un'altra operazione, ad esempio la riproduzione della sequenza di introduzione, il rendering del menu o l'interazione con il lettore alla creazione di caratteri. L'esperienza è diversa dall'installazione tradizionale dei giochi in quanto l'utente è occupato nel gioco (guardando l'introduzione o la creazione di un nuovo carattere) mentre è in corso l'installazione. Al termine della creazione di un carattere da parte del giocatore, nell'esempio vengono caricate le risorse per il livello 1.

Sul lato destro della schermata di esempio sono presenti cinque pulsanti contrassegnati come "Play Level 1" e "Play Level 5". Questi pulsanti simulano il completamento del giocatore del livello corrente e l'avanzamento fino a quello successivo. Quando si fa clic su uno di questi pulsanti, viene visualizzata una schermata delle statistiche che mostra le informazioni sul livello appena terminato. L'esempio richiede anche questo tempo per richiedere al programma di installazione di controllare e installare il livello successivo, se non è già installato. L'installazione si verifica quando il lettore legge la schermata delle statistiche, in modo che quando l'utente fa clic su OK per immettere il livello successivo, le risorse del livello sono tutte installate e pronte per essere caricate.

## <a name="the-samples-features-and-components"></a>Funzionalità e componenti dell'esempio

Tradizionalmente, i giochi richiedono che tutti o la maggior parte dei file vengano installati prima dell'avvio. Per ottenere l'installazione su richiesta, è necessario che le risorse del gioco siano modulari. ovvero lo sviluppatore deve dividere le risorse dell'applicazione (grafica, audio e così via) in componenti. Ogni componente è un set di risorse che possono essere installate o rimosse come unità. Al termine di questa operazione, lo sviluppatore del gioco definisce una o più funzionalità, in genere una o più per ogni livello o zona. Ogni funzionalità di un'applicazione specifica un set di componenti necessari per l'esecuzione di una determinata funzionalità. Quando si installa un'applicazione, le relative funzionalità possono essere contrassegnate come "Installa" (componenti copiati sul disco rigido locale al momento dell'installazione) o "annunciate" (componenti copiati sul disco rigido locale quando l'applicazione usa tale funzionalità). Uno sviluppatore di giochi può ridurre il tempo di installazione progettando il gioco da avviare e avviando l'esecuzione con un set minimo di funzionalità installate. Il resto delle sue funzionalità può essere contrassegnato come annunciato e installato su richiesta quando l'applicazione deve effettivamente usare le funzionalità fornite da tali funzionalità.

Nella tabella seguente sono elencate le sei funzionalità di primo livello definite dall'esempio.



| Nome funzionalità | Funzionalità                                                                                                                                                                                                             | Componenti  | File                                                                     |
|--------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|---------------------------------------------------------------------------|
| Core         | Include le risorse necessarie in qualsiasi momento, indipendentemente dal livello. Queste risorse sono: eseguibile di esempio, supporti necessari per la schermata di introduzione e caricamento e il file. FX che gestisce tutto il rendering nell'esempio. | Core        | InstallOnDemand.exe, InstallOnDemand. FX, Loading.bmp, Level. x             |
| Core         | (come sopra)                                                                                                                                                                                                           | CoreUI      | \\Interfaccia utente multimediale \\ dxutcontrols. DDS, media \\ UI \\ DXUTShared. FX, media \\ UI \\ Arrow. x |
| Core         | (come sopra)                                                                                                                                                                                                           | CoreMisc    | Media \\ varie \\ fondo. x, media \\ varie \\seafloor.bmp                        |
| Core         | (come sopra)                                                                                                                                                                                                           | CoreSpeeder | Media \\ PRT demo \\ Landshark. x, media \\ PRT demo \\ Speeder \_diff.jpg          |
| Core         | (come sopra)                                                                                                                                                                                                           | CoreReg     | N/d (valore del registro di sistema)                                                      |
| Level1       | Fornisce le risorse utilizzate dal livello 1.                                                                                                                                                                                       | Level1      | Level1.jpg                                                                |
| Level1       | (uguale a precedente)                                                                                                                                                                                                        | L1Skybox    | \\Probe luce media \\ Galileo \_ Cross. DDS                                   |
| Level2       | Fornisce le risorse utilizzate dal livello 2.                                                                                                                                                                                       | Level2      | Level2.jpg                                                                |
| Level2       | (uguale a precedente)                                                                                                                                                                                                        | L2Skybox    | \\Probe chiaro multimediale \\ Grace \_ Cross. DDS                                     |
| Level3       | Fornisce le risorse utilizzate dal livello 3.                                                                                                                                                                                       | Level3      | Level3.jpg                                                                |
| Level3       | (uguale a precedente)                                                                                                                                                                                                        | L3Skybox    | \\Probe Light Media \\ RNL \_ Cross. DDS                                       |
| Level4       | Fornisce le risorse utilizzate dal livello 4.                                                                                                                                                                                       | Level4      | Level4.jpg                                                                |
| Level4       | (uguale a precedente)                                                                                                                                                                                                        | L4Skybox    | \\Probe Light Media \\ stpeters \_ Cross. DDS                                  |
| Level5       | Fornisce le risorse utilizzate dal livello 5.                                                                                                                                                                                       | Level5      | Level5.jpg                                                                |
| Level5       | (uguale a precedente)                                                                                                                                                                                                        | L5Skybox    | \\Probe luce multimediale \\ Uffizi \_ Cross. DDS                                    |



 

Le funzionalità di Level1 tramite Level5 presentano funzionalità secondarie aggiuntive contenenti file non direttamente usati dall'esempio. Questi file di funzionalità secondarie sono stati aggiunti per rendere più lunga l'installazione. Questa operazione viene eseguita per illustrare l'operazione di installazione in corso in esecuzione in background mentre l'esempio è in esecuzione.

Nella tabella seguente sono elencate le funzionalità secondarie.



| Funzionalità | Funzionalità secondarie                      | File                                                                                                                                                                          |
|---------|-----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Level1  | L1PH1, L1PH2, L1PH3, L1PH4, L1PH5 | Level1 segnaposto data \\ L1PH1. dat Level1 segnaposto \\ L1PH2. dat Level1 dati segnaposto L1PH3 \\ . dat Level1 dati segnaposto L1PH4. \\ dat Level1 dati segnaposto L1PH5 \\ . dat |
| Level2  | L2PH1, L2PH2, L2PH3, L2PH4, L2PH5 | Level2 segnaposto data \\ L2PH1. dat Level2 segnaposto \\ L2PH2. dat Level2 dati segnaposto L2PH3 \\ . dat Level2 dati segnaposto L2PH4. \\ dat Level2 dati segnaposto L2PH5 \\ . dat |
| Level3  | L3PH1, L3PH2, L3PH3, L3PH4, L3PH5 | Level3 segnaposto data \\ L3PH1. dat Level3 segnaposto \\ L3PH2. dat Level3 dati segnaposto L3PH3 \\ . dat Level3 dati segnaposto L3PH4. \\ dat Level3 dati segnaposto L3PH5 \\ . dat |
| Level4  | L4PH1, L4PH2, L4PH3, L4PH4, L4PH5 | Level4 segnaposto data \\ L4PH1. dat Level4 segnaposto \\ L4PH2. dat Level4 dati segnaposto L4PH3 \\ . dat Level4 dati segnaposto L4PH4. \\ dat Level4 dati segnaposto L4PH5 \\ . dat |
| Level5  | L5PH1, L5PH2, L5PH3, L5PH4, L5PH5 | Level5 segnaposto data \\ L5PH1. dat Level5 segnaposto \\ L5PH2. dat Level5 dati segnaposto L5PH3 \\ . dat Level5 dati segnaposto L5PH4. \\ dat Level5 dati segnaposto L5PH5 \\ . dat |



 

Durante l'installazione, la funzionalità di base deve essere contrassegnata come "Installa" e tutte le altre funzionalità devono essere contrassegnate come "pubblicizzate". Installando una sola funzionalità anziché sei, il tempo che il lettore deve attendere fino al lancio del gioco è notevolmente ridotto.

## <a name="installation"></a>Installazione

Il [Windows Installer](/windows/desktop/Msi/windows-installer-portal) fornisce un meccanismo che consente a un'applicazione di richiedere l'installazione di una funzionalità annunciata. Tuttavia, il meccanismo è una chiamata sincrona Application Programming Interface (API), il che significa che l'applicazione deve attendere l'interno della chiamata fino al completamento dell'installazione. Per ottenere l'installazione in background, è necessario un thread di lavoro, in modo che il thread dell'applicazione principale sia libero di eseguire altre attività importanti, ad esempio il rendering sullo schermo, per continuare a fornire il feedback visivo del lettore.

Nell'esempio sono presenti tre stati di installazione che si verificano durante l'esecuzione dell'esempio: installazione attiva, installazione passiva e nessuna installazione.

-   L'installazione attiva è una richiesta avviata dall'esempio quando deve accedere alle risorse fornite da una o più funzionalità o caricarle. L'esempio esegue questa operazione quando non è possibile continuare fino a quando la risorsa non viene installata.
-   L'installazione passiva viene avviata quando nell'esempio non viene eseguita un'attività critica, ad esempio quando il lettore si trova in un menu o Guarda una scena tagliata. In tal caso, il thread di lavoro verifica se una funzionalità dell'esempio è ancora annunciata. Se è possibile trovarne uno, viene chiamato il programma di installazione per installare tale funzionalità. Questo processo viene ripetuto fino a quando non viene installata ogni funzionalità dell'esempio. In pratica, l'installazione passiva USA cicli di elaborazione aggiuntivi per eseguire l'installazione in background quando è meno intrusivo nell'esempio principale.
-   Non viene eseguita alcuna installazione quando il giocatore è attivamente impegnato nel gioco; in questo modo si evita un calo della frequenza fotogrammi che interrompe l'esperienza utente.

Nell'esempio viene definita una classe CMsiUtil per la gestione di tutte le attività correlate all'installazione. In sostanza, CMsiUtil usa un thread di lavoro che richiama il programma di installazione per installare le funzionalità dell'esempio in un ciclo. La classe dispone di due code che archiviano le richieste di installazione: una coda ad alta priorità per l'installazione attiva e una coda con priorità bassa per l'installazione passiva. Durante l'inizializzazione, la classe enumera tutte le funzionalità del prodotto e le aggiunge alla coda di installazione passiva. Poiché l'intero prodotto viene accodato in questo modo, l'intero prodotto verrà installato se l'esempio dispone di un numero sufficiente di cicli del processore.

Quando l'esempio deve richiedere un'installazione attiva, l'esempio può chiamare CMsiUtil:: UseFeatureSet () e passare il nome della funzionalità di primo livello. UseFeatureSet () accoda la funzionalità richiesta e tutte le relative funzionalità secondarie nella coda di installazione attiva, in modo che il thread di lavoro possa installarli.

Durante l'esecuzione di una richiesta di installazione, il thread di lavoro verificherà la coda di installazione attiva e la coda di installazione passiva per verificare se una delle due code ha richieste aggiuntive. Ogni volta che il thread trova una richiesta, chiamerà l'API del programma di installazione per eseguire l'installazione effettiva. Una volta che entrambe le code sono vuote, il thread di lavoro passerà a sospensione con una chiamata a [**WaitForSingleObject**](/windows/desktop/api/synchapi/nf-synchapi-waitforsingleobject). Poiché l'intero prodotto viene inserito nella coda di installazione passiva durante l'inizializzazione, una coda vuota implica l'installazione dell'intero prodotto.

Nell'esempio viene chiamato CMsiUtil:: EnablePassiveInstall () per abilitare o disabilitare l'installazione passiva. EnablePassiveInstall (true) incrementa il numero di attivazioni per l'installazione passiva e EnablePassiveInstall (false) la decrementa. Se il conteggio di abilitazione è maggiore di 0, la classe elaborerà la coda di installazione passiva. L'esempio consente l'installazione passiva quando si verifica una delle condizioni seguenti:

-   L'utente sta visualizzando la sequenza introduttiva iniziale.
-   L'utente si sposta nel menu di esempio.
-   L'utente sta visualizzando le statistiche alla fine di un livello.
-   L'applicazione di esempio perde lo stato attivo e passa allo sfondo.

I metodi di CMsiUtil sono elencati di seguito:



| Metodo                | Descrizione                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| AbortAllRequests      | Fa in modo che l'installazione corrente interrompa e svuoti la coda delle richieste di installazione attive.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| AbortCurrentRequest   | Causa l'interruzione dell'installazione in corso. Il thread di lavoro elabora quindi la richiesta successiva nella coda, se ne esiste una.                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| EnablePassiveInstall  | Incrementa o decrementa il conteggio di abilitazione dell'installazione passiva. L'esempio usa questa chiamata per controllare quando l'installazione passiva può e non può verificarsi.                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| GetCurrentFeatureName | Restituisce il nome della funzionalità che viene installata attivamente.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| GetFeatureProgress    | Restituisce la posizione corrente del ciclo per la funzionalità in fase di installazione.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| GetFeatureProgressMax | Restituisce il numero massimo di cicli di avanzamento per la funzionalità in fase di installazione.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| GetLastError          | Utilizzare questo metodo per recuperare il codice restituito dalla richiesta di installazione precedente.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| GetPassiveProgress    | Restituisce la posizione del segno di avanzamento dell'indicatore di stato per l'installazione passiva.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| GetPassiveProgressMax | Restituisce la posizione corrente del segno di selezione e il numero massimo di cicli per l'installazione passiva. Insieme, l'esempio può utilizzarle per mostrare lo stato di avanzamento generale dell'installazione passiva.                                                                                                                                                                                                                                                                                                                                                                                               |
| GetProgress           | Restituisce la posizione del segno di avanzamento dell'indicatore di stato per l'installazione del set di funzionalità attivo. Viene utilizzato quando l'esempio esegue il rendering dell'indicatore di stato dell'installazione. Poiché il Windows Installer fornisce solo le informazioni sullo stato di avanzamento per l'installazione di una funzionalità, il metodo divide l'indicatore di stato tra le funzionalità richieste in modo che l'utente veda ancora l'intera installazione come un'unica attività.                                                                                                                                                                                           |
| GetProgressMax        | Restituisce il numero massimo di cicli dell'indicatore di stato per l'installazione del set di funzionalità attivo. Viene utilizzato quando l'esempio esegue il rendering dell'indicatore di stato dell'installazione.                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Inizializzare            | Inizializza la classe con l'identificatore univoco globale (GUID) del prodotto. Questo metodo enumera inoltre tutte le funzionalità dell'applicazione che sono state annunciate ma non ancora installate e le inserisce nella coda di installazione passiva per impostare l'installazione passiva.                                                                                                                                                                                                                                                                                                           |
| IsInstallInProgress   | Utilizzare questo metodo per verificare se è in corso l'elaborazione di un'installazione attiva.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| UseFeature            | Metodo privato chiamato da UseFeatureSet. Controlla se è installata una funzionalità. Se la funzionalità richiesta è installata, il metodo restituisce. Se la funzionalità non è ancora installata (annunciata), il metodo Accoda una nuova richiesta di installazione attiva per il thread di lavoro e quindi restituisce. Handle di evento facoltativo che verrà segnalato al completamento dell'installazione richiesta.                                                                                                                                                                                                        |
| UseFeatureSet         | Chiamato dall'esempio quando è necessario accedere alle funzionalità fornite da una particolare funzionalità o da una delle relative funzionalità secondarie. Il metodo enumera tutte le funzionalità dell'esempio e chiama UseFeature () per le funzionalità secondarie della funzionalità radice specificata. L'esempio può passare un handle di evento che verrà segnalato quando viene installato l'intero set di funzionalità. Poiché tutte le funzionalità di sono installate come set, l'handle viene specificato per l'ultima funzionalità accodata da UseFeature () invece di ogni funzionalità, in modo che l'esempio riceva una notifica una volta dopo l'installazione di tutte le funzionalità richieste. |
| UseProduct            | Accoda una richiesta di installazione attiva per il thread di lavoro per chiamare il programma di installazione per eseguire un'installazione completa del prodotto. Handle di evento facoltativo che verrà segnalato al completamento dell'installazione richiesta.                                                                                                                                                                                                                                                                                                                                                                |



 

## <a name="limitation"></a>Limitazione

La versione corrente del programma di installazione non è progettata per l'accesso simultaneo da parte di più thread. Pertanto, quando il thread di lavoro chiama il programma di installazione, il thread principale non deve chiamare il programma di installazione. Un esempio di questa limitazione si verifica nell'esempio quando il thread principale richiede una funzionalità, quindi richiede nuovamente la stessa funzionalità prima che il thread di lavoro completi l'installazione. La seconda richiesta chiama MsiQueryFeatureState () per verificare se la funzionalità richiesta è già installata, perché il programma di installazione può talvolta indicare che la funzionalità è stata installata completamente quando il thread di lavoro sta ancora copiando i file.

Fortunatamente, esiste una soluzione alternativa facile. CMsiUtil controllerà se una funzionalità viene installata dal thread di lavoro prima di chiamare funzioni come MsiQueryFeatureState () o MsiUseFeature () per richiedere lo stato di installazione della funzionalità in questione. Tenere presente che questa limitazione può anche diventare un problema altrove.

L'applicazione di patch può influire sul funzionamento dell'installazione su richiesta sul computer di un utente finale. L'applicazione di una patch che contiene solo dati modificati rispetto alla versione precedente potrebbe richiedere l'installazione della versione precedente del file aggiornato per applicare il Delta. In questa situazione, la patch deve richiedere che il programma di installazione abbia interessato le funzionalità annunciate prima di applicare la patch al gioco.

L'esempio viene installato avviando InstallOnDemand.msi perché presuppone che il [Windows Installer](/windows/desktop/Msi/windows-installer-portal) sia presente nel computer. Se il programma di installazione è assente, i file con estensione msi non vengono riconosciuti e l'avvio non funzionerà. Per ovviare a questo problema, è necessario che un'applicazione utilizzi un programma di installazione per eseguire l'attività. Questo programma deve prima verificare se il programma di installazione è presente e, in tal caso, la relativa versione. Se la versione non soddisfa i requisiti dell'applicazione, il programma di installazione installerà il Windows Installer, quindi avvierà il file con estensione msi. Questo processo è noto come bootstrap. Le applicazioni in genere denominano il programma di installazione di bootstrap Setup.exe. L'esempio non gestisce il bootstrap. Tuttavia, i dettagli completi sul bootstrap sono disponibili nella Windows Installer.

Gli sviluppatori devono inoltre prestare attenzione alle dimensioni di ogni funzionalità nei giochi. Quando si annulla un'installazione in corso, il programma di installazione ripristina lo stato del computer prima dell'installazione. Ciò significa che l'installazione della funzionalità è completamente annullata e non è prevista alcuna installazione della funzionalità parziale. Una funzionalità di grandi dimensioni richiede più tempo per l'installazione, che aumenta la probabilità che l'installazione venga interrotta e annullata o che l'installazione interferisca con l'applicazione principale. Un esempio potrebbe consentire l'installazione passiva quando l'utente Visualizza il menu del gioco durante il gioco. Se una funzionalità viene installata e l'utente torna alla riproduzione, il gioco può eseguire una delle due operazioni seguenti: può consentire il completamento dell'installazione passiva oppure annullare l'installazione passiva. Una funzionalità di grandi dimensioni si adatterebbe in modo non corretto a entrambi i modelli. Se il gioco consente il completamento dell'installazione di grandi dimensioni, l'installazione potrebbe ostacolare le prestazioni di rendering del gioco per molto tempo. Viceversa, se il gioco Annulla l'installazione, l'utente deve rimanere nel menu per molto tempo prima di tornare al gioco. Gli sviluppatori dovrebbero trovare una dimensione di funzionalità bilanciata che funzioni meglio per i singoli giochi.

 

 