---
title: Problemi principali per i titoli di Windows
description: In questo articolo vengono illustrati molti dei problemi comuni riscontrati nei giochi per PC di generazione corrente.
ms.assetid: 89b83473-1aa9-9a2d-8778-15cfb91cdea4
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 547c977f7d8e4895ef73ba229a9012854a7c6d27
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "106300162"
---
# <a name="top-issues-for-windows-titles"></a><span data-ttu-id="2da56-103">Problemi principali per i titoli di Windows</span><span class="sxs-lookup"><span data-stu-id="2da56-103">Top Issues for Windows Titles</span></span>

<span data-ttu-id="2da56-104">Il gruppo Microsoft Windows Gaming and graphics Technologies Developer Relations esegue un'analisi delle prestazioni per molti giochi di Windows ogni anno.</span><span class="sxs-lookup"><span data-stu-id="2da56-104">The Microsoft Windows Gaming and Graphics Technologies Developer Relations group performs performance analysis for many Windows games each year.</span></span> <span data-ttu-id="2da56-105">Durante queste sessioni, si ottiene un'esperienza pratica per associare il feedback degli sviluppatori e le query ricevute ogni giorno.</span><span class="sxs-lookup"><span data-stu-id="2da56-105">During these sessions, we get hands-on experience to tie into the developer feedback and queries we receive daily.</span></span> <span data-ttu-id="2da56-106">In alcuni casi è utile tenere traccia di un arresto anomalo o di un altro problema in un titolo, che ci fornisce informazioni approfondite sui problemi riscontrati dagli sviluppatori.</span><span class="sxs-lookup"><span data-stu-id="2da56-106">Occasionally we help track down a mysterious crash or other problem in a title, which gives us further insight into problems that developers are encountering.</span></span>

<span data-ttu-id="2da56-107">In questo articolo vengono illustrati molti dei problemi comuni riscontrati nei giochi per PC di generazione corrente.</span><span class="sxs-lookup"><span data-stu-id="2da56-107">This article highlights many of the common issues we've seen in current-generation PC games.</span></span>

-   [<span data-ttu-id="2da56-108">Prestazioni limitate alla CPU</span><span class="sxs-lookup"><span data-stu-id="2da56-108">CPU-Limited Performance</span></span>](#cpu-limited-performance)
-   [<span data-ttu-id="2da56-109">Gestione batch scadente</span><span class="sxs-lookup"><span data-stu-id="2da56-109">Poor Batch Management</span></span>](#poor-batch-management)
-   [<span data-ttu-id="2da56-110">Copia eccessiva della memoria</span><span class="sxs-lookup"><span data-stu-id="2da56-110">Excessive Memory Copying</span></span>](#excessive-memory-copying)
-   [<span data-ttu-id="2da56-111">Utilizzo eccessivo dell'invio di disegni dinamici</span><span class="sxs-lookup"><span data-stu-id="2da56-111">Excessive Use of Dynamic Draw Submission</span></span>](#excessive-use-of-dynamic-draw-submission)
-   [<span data-ttu-id="2da56-112">Sovraccarico elevato nell'elaborazione dei file</span><span class="sxs-lookup"><span data-stu-id="2da56-112">High Overhead in File Processing</span></span>](#high-overhead-in-file-processing)
-   [<span data-ttu-id="2da56-113">Installazione lenta e frustrante</span><span class="sxs-lookup"><span data-stu-id="2da56-113">Slow and Frustrating Installation</span></span>](#slow-and-frustrating-installation)
-   [<span data-ttu-id="2da56-114">Mancanza di considerazioni sulla memoria fisica</span><span class="sxs-lookup"><span data-stu-id="2da56-114">Lack of Consideration of Physical Memory</span></span>](#lack-of-consideration-of-physical-memory)
-   [<span data-ttu-id="2da56-115">Conversione di frequenza di campionamento audio Real-Time</span><span class="sxs-lookup"><span data-stu-id="2da56-115">Over-Reliance on Real-Time Audio Sample Rate Conversion</span></span>](#over-reliance-on-real-time-audio-sample-rate-conversion)
-   [<span data-ttu-id="2da56-116">Frammentazione della memoria virtuale</span><span class="sxs-lookup"><span data-stu-id="2da56-116">Fragmention of Virtual Memory</span></span>](#fragmention-of-virtual-memory)
-   [<span data-ttu-id="2da56-117">Manipolazione della parola di controllo Floating-Point</span><span class="sxs-lookup"><span data-stu-id="2da56-117">Manipulation of the Floating-Point Control Word</span></span>](#manipulation-of-the-floating-point-control-word)
-   [<span data-ttu-id="2da56-118">Installazione facoltativa di DirectX Runtime</span><span class="sxs-lookup"><span data-stu-id="2da56-118">Optional Installation of the DirectX Runtime</span></span>](#optional-installation-of-the-directx-runtime)
-   [<span data-ttu-id="2da56-119">Utilizzo eccessivo della sincronizzazione dei thread</span><span class="sxs-lookup"><span data-stu-id="2da56-119">Excessive Use of Thread Synchronization</span></span>](#excessive-use-of-thread-synchronization)
-   [<span data-ttu-id="2da56-120">Uso di RDTSC</span><span class="sxs-lookup"><span data-stu-id="2da56-120">Use of RDTSC</span></span>](#use-of-rdtsc)

## <a name="cpu-limited-performance"></a><span data-ttu-id="2da56-121">Prestazioni CPU-Limited</span><span class="sxs-lookup"><span data-stu-id="2da56-121">CPU-Limited Performance</span></span>

<span data-ttu-id="2da56-122">La maggior parte dei giochi è limitata dalle prestazioni della CPU nei sistemi con GPU (Graphics Processing Unit) ad alte prestazioni.</span><span class="sxs-lookup"><span data-stu-id="2da56-122">The vast majority of games are limited by CPU performance on systems with high-performance graphics processing units (GPUs).</span></span> <span data-ttu-id="2da56-123">Questo problema si verifica a volte a causa di un utilizzo non elevato di batch per gli invii di un progetto, ma in genere è dovuto ad altri sistemi di gioco che utilizzano una parte elevata dei cicli CPU disponibili.</span><span class="sxs-lookup"><span data-stu-id="2da56-123">This is sometimes due to poor use of batching for draw submissions, but more typically, this is due to other game systems consuming a large portion of the available CPU cycles.</span></span> <span data-ttu-id="2da56-124">Nei pochi casi in cui è stata rilevata la GPU come limitazione, la ragione è una frequenza di riempimento molto elevata o pixel shader richiesta, in impostazioni ad alta risoluzione o prestazioni di vertex shader ridotte da una scheda video.</span><span class="sxs-lookup"><span data-stu-id="2da56-124">In the few cases in which we have seen the GPU as the limitation, the cause is very high fill rates or pixel shader demand, in high-resolution settings, or low vertex-shader performance by a video card.</span></span>

<span data-ttu-id="2da56-125">Poiché la maggior parte dei titoli è limitata alla CPU, i principali risultati delle prestazioni derivano dall'ottimizzazione dei sistemi di gioco con utilizzo intensivo della CPU.</span><span class="sxs-lookup"><span data-stu-id="2da56-125">Because most titles are CPU-limited, the biggest performance wins come from optimizing CPU-intensive game systems.</span></span> <span data-ttu-id="2da56-126">In genere, i sistemi di intelligenza artificiale o fisica e la logica di rilevamento collisione associata sono i principali consumer di cicli della CPU in cui sono presenti applicazioni Microsoft Direct3D.</span><span class="sxs-lookup"><span data-stu-id="2da56-126">Typically, the AI or physics systems and the associated collision-detection logic are the primary consumers of CPU cycles in well-behaving Microsoft Direct3D applications.</span></span> <span data-ttu-id="2da56-127">Qualsiasi lavoro per migliorare questi sistemi può migliorare le prestazioni complessive del gioco.</span><span class="sxs-lookup"><span data-stu-id="2da56-127">Any work to improve these systems can improve the overall performance of the game.</span></span>

## <a name="poor-batch-management"></a><span data-ttu-id="2da56-128">Gestione batch scadente</span><span class="sxs-lookup"><span data-stu-id="2da56-128">Poor Batch Management</span></span>

<span data-ttu-id="2da56-129">Per ottenere un buon parallelismo con la GPU, è necessario che i batch di traccia contengano una geometria sufficiente, mentre gli shader hanno la complessità giusta, per garantire la disponibilità della scheda video, senza usare così tanti batch che il buffer dei comandi è invaso.</span><span class="sxs-lookup"><span data-stu-id="2da56-129">Achieving good parallelism with the GPU requires that draw batches contain enough geometry — and the shaders have the right complexity — to keep the video card busy, while not using so many batches that the command buffer is flooded.</span></span> <span data-ttu-id="2da56-130">Per l'hardware di generazione corrente, è consigliabile circa 300 o meno invii di batch di estrazione per frame (un minor numero di CPU con prestazioni inferiori) per impedire che l'elaborazione del driver del buffer dei comandi diventi un collo di bottiglia delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="2da56-130">On current-generation hardware, we recommend approximately 300 or fewer draw-batch submissions per frame (fewer on lower-performance CPUs) to prevent the driver's processing of the command-buffer from becoming a performance bottleneck.</span></span> <span data-ttu-id="2da56-131">Alcune altre chiamate di stato API e combinazioni di driver possono comportare una costosa elaborazione della CPU (ad esempio, la compilazione di driver di shader), quindi si consiglia vivamente di eseguire l'analisi delle prestazioni di routine.</span><span class="sxs-lookup"><span data-stu-id="2da56-131">Some other API state calls and driver combinations can result in costly CPU processing (driver compiling of shaders, for example), so we highly recommend routine performance analysis.</span></span>

## <a name="excessive-memory-copying"></a><span data-ttu-id="2da56-132">Copia eccessiva della memoria</span><span class="sxs-lookup"><span data-stu-id="2da56-132">Excessive Memory Copying</span></span>

<span data-ttu-id="2da56-133">Durante lo sviluppo della maggior parte dei titoli di PC, gli sviluppatori usano strutture di dati e stringhe utili per la gestione dei contenuti.</span><span class="sxs-lookup"><span data-stu-id="2da56-133">During the development of most PC titles, developers use convenient data structures and strings for content management.</span></span> <span data-ttu-id="2da56-134">Il lavoro della CPU necessario per il confronto di stringhe, la copia e altre manipolazioni spesso presenta un sovraccarico misurabile, in particolare quando si considerano i riscontri delle prestazioni associati al sottosistema della cache e della memoria.</span><span class="sxs-lookup"><span data-stu-id="2da56-134">The CPU work required for string comparison, copying, and other manipulations often has a measurable overhead, particularly when taking into account the performance hits associated with the cache and memory subsystem.</span></span> <span data-ttu-id="2da56-135">È necessario pianificare i piani quando si sviluppano questi sistemi per rimuovere o ridurre al minimo la dipendenza dall'elaborazione di stringhe quando il prodotto entra nelle fasi principali di test e rilascio.</span><span class="sxs-lookup"><span data-stu-id="2da56-135">Plans should be made when developing these systems for removing or minimizing the reliance on string processing once the product enters into the primary testing and release phases.</span></span>

## <a name="excessive-use-of-dynamic-draw-submission"></a><span data-ttu-id="2da56-136">Utilizzo eccessivo dell'invio di disegni dinamici</span><span class="sxs-lookup"><span data-stu-id="2da56-136">Excessive Use of Dynamic Draw Submission</span></span>

<span data-ttu-id="2da56-137">L'hardware video moderno offre prestazioni ottimali quando si gestiscono dati statici.</span><span class="sxs-lookup"><span data-stu-id="2da56-137">Modern video hardware performs well when dealing with static data.</span></span> <span data-ttu-id="2da56-138">Per gli adapter di fascia alta è spesso presente una quantità molto elevata di memoria video, ma questa memoria non può essere utilizzata in modo efficace da dati dinamici.</span><span class="sxs-lookup"><span data-stu-id="2da56-138">High-end adapters often have a very large amount of video memory, but this memory cannot be effectively utilized by dynamic data.</span></span>

<span data-ttu-id="2da56-139">Sebbene i modelli di utilizzo ragionevolmente efficienti dei buffer dei vertici dinamici o degli indici possano essere implementati per il contenuto dinamico, molti titoli hanno un utilizzo eccessivo di questo idioma per il contenuto statico altrimenti.</span><span class="sxs-lookup"><span data-stu-id="2da56-139">While reasonably efficient usage patterns of dynamic vertex buffers/index buffers can be implemented for dynamic content, many titles overuse this idiom for what is otherwise static content.</span></span> <span data-ttu-id="2da56-140">Questa operazione è spesso visibile con gli alberi del partizionamento dello spazio binario (BSP) e i sistemi basati su portale che archiviano la geometria in una struttura di dati che non è mappata all'hardware e deve essere elaborata in buffer per ogni frame.</span><span class="sxs-lookup"><span data-stu-id="2da56-140">We most often see this with binary space partitioning (BSP) trees and portal-based systems that store geometry in a data structure that does not map to the hardware and must be processed into buffers for every frame.</span></span> <span data-ttu-id="2da56-141">L'inserimento di un maggior quantità di contenuto nelle risorse statiche può ridurre notevolmente il sovraccarico della larghezza di banda del trasferimento dei dati alla scheda video, sfruttare al meglio la VRAM in corso e ridurre il sovraccarico della CPU/cache dovuto all'elaborazione del contenuto.</span><span class="sxs-lookup"><span data-stu-id="2da56-141">Putting as much content into static resources as possible can greatly reduce the bandwidth overhead of transferring data to the video card, make better use of on-board VRAM, and reduce the CPU/cache overhead involved in processing this content.</span></span>

## <a name="high-overhead-in-file-processing"></a><span data-ttu-id="2da56-142">Sovraccarico elevato nell'elaborazione dei file</span><span class="sxs-lookup"><span data-stu-id="2da56-142">High Overhead in File Processing</span></span>

<span data-ttu-id="2da56-143">I giochi per PC hanno ottenuto una reputazione per i tempi di caricamento lunghi, in particolare in caso di confronto con i titoli di console con requisiti di tempo di caricamento rigorosi.</span><span class="sxs-lookup"><span data-stu-id="2da56-143">PC games have gotten a reputation for long loading times, particular when compared with console titles with strict loading-time requirements.</span></span> <span data-ttu-id="2da56-144">L'analisi del modo in cui molti titoli usano il sottosistema di file rivela alcuni problemi comuni.</span><span class="sxs-lookup"><span data-stu-id="2da56-144">Our analysis of the way that many titles make use of the file subsystem reveals some common issues.</span></span>

<span data-ttu-id="2da56-145">Il sovraccarico dell'apertura di un file è in genere molto più elevato rispetto a quanto previsto dagli sviluppatori.</span><span class="sxs-lookup"><span data-stu-id="2da56-145">The overhead of opening a file is usually much higher than developers expect.</span></span> <span data-ttu-id="2da56-146">Con l'uso generalizzato di scanner antivirus su richiesta e la funzionalità aggiuntiva di NTFS, l'apertura di un file è un'operazione piuttosto dispendiosa.</span><span class="sxs-lookup"><span data-stu-id="2da56-146">With on-demand virus scanners in widespread use, and the additional functionality of NTFS, opening a file is a fairly expensive operation.</span></span> <span data-ttu-id="2da56-147">Aprire più file contemporaneamente o aprire e chiudere ripetutamente lo stesso file è pertanto un metodo scarso per gestire la gestione dei file.</span><span class="sxs-lookup"><span data-stu-id="2da56-147">Opening many files at once or opening and closing the same file repeatedly is therefore a poor method of dealing with file management.</span></span> <span data-ttu-id="2da56-148">Alcuni giochi hanno tentato di ridurre il costo delle prestazioni testando l'esistenza di un file prima di aprirlo.</span><span class="sxs-lookup"><span data-stu-id="2da56-148">Some games have attempted to mitigate this performance cost by testing for the existence of a file before opening it.</span></span> <span data-ttu-id="2da56-149">La realtà è che il test per l'esistenza di un file in NTFS richiede l'apertura del file, quindi il test prima di aprire i risultati pagando il costo due volte.</span><span class="sxs-lookup"><span data-stu-id="2da56-149">The reality is that testing for the existence of a file on NTFS requires opening the file, so testing before opening results in paying the cost twice.</span></span>

<span data-ttu-id="2da56-150">I giochi che consentono modifiche o mods di componenti aggiuntivi o che ancora includono l'impalcatura di sviluppo per verificare la presenza di file di dati di sostituzione possono causare ritardi significativi nel caricamento del gioco a causa del controllo di questi file, anche quando tali file non sono presenti.</span><span class="sxs-lookup"><span data-stu-id="2da56-150">Games that allow add-on modifications, or mods, or that still include development scaffolding to check for override data files, can have significant delays in loading the game because of checking for these files, even when those files are not present.</span></span> <span data-ttu-id="2da56-151">Si consiglia ai giochi di controllare solo questi file quando vengono eseguiti con un'opzione speciale della riga di comando o un altro indicatore di modalità, in modo che solo gli utenti che utilizzano questa funzionalità paghino effettivamente il costo delle prestazioni di questi controlli (spesso estesi).</span><span class="sxs-lookup"><span data-stu-id="2da56-151">We recommend that games only check for these files when run with a special command-line switch, or other mode indicator, so that only those users who make use of this functionality actually pay the performance cost of these (often extensive) checks.</span></span>

<span data-ttu-id="2da56-152">Le prestazioni aggiuntive possono essere ottenute dalla file system da quanto segue:</span><span class="sxs-lookup"><span data-stu-id="2da56-152">Additional performance can be obtained from the file system by the following:</span></span>

-   <span data-ttu-id="2da56-153">Uso appropriato del flag di FILE hint di file system l' \_ \_ \_ accesso casuale e l' \_ \_ analisi sequenziale del flag file \_</span><span class="sxs-lookup"><span data-stu-id="2da56-153">Appropriate use of the file system hints FILE\_FLAG\_RANDOM\_ACCESS and FILE\_FLAG\_SEQUENTIAL\_SCAN</span></span>
-   <span data-ttu-id="2da56-154">Ridimensionamento dei buffer per evitare una grande quantità di chiamate alle API di lettura/scrittura del sistema operativo</span><span class="sxs-lookup"><span data-stu-id="2da56-154">Sizing buffers to avoid a large quantity of calls to the read/write APIs of the OS</span></span>
-   <span data-ttu-id="2da56-155">Accesso asincrono ai file</span><span class="sxs-lookup"><span data-stu-id="2da56-155">Accessing files asynchronously</span></span>
-   <span data-ttu-id="2da56-156">Caricamento di thread in background</span><span class="sxs-lookup"><span data-stu-id="2da56-156">Loading threads in the background</span></span>

<span data-ttu-id="2da56-157">Si consiglia anche di convertire i dati offline (in fase di compilazione o di installazione) invece di basarsi sulla conversione quando il gioco viene eseguito per la prima volta, in quanto questa operazione impone una significativa tassazione delle prestazioni per ogni utente.</span><span class="sxs-lookup"><span data-stu-id="2da56-157">We also strongly recommend converting data offline (at build or installation time) rather than relying on conversion when the game is first run, as doing so imposes a significant performance tax for every user.</span></span>

## <a name="slow-and-frustrating-installation"></a><span data-ttu-id="2da56-158">Installazione lenta e frustrante</span><span class="sxs-lookup"><span data-stu-id="2da56-158">Slow and Frustrating Installation</span></span>

<span data-ttu-id="2da56-159">Un altro problema comune riscontrato sono tempi di installazione molto lunghi necessari per molti giochi per PC moderni.</span><span class="sxs-lookup"><span data-stu-id="2da56-159">Another common issue we've seen is very long installation times required for many modern PC games.</span></span> <span data-ttu-id="2da56-160">I programmi di installazione richiedono l'utente più volte, a volte semplicemente per indicare all'utente, ad esempio, che non è necessario che DirectX sia installato.</span><span class="sxs-lookup"><span data-stu-id="2da56-160">The installers prompt the user many times, sometimes simply to tell the user, for example, "You do not need DirectX installed."</span></span> <span data-ttu-id="2da56-161">In genere, questi programmi di installazione che danneggiano gli utenti richiedono che l'utente scelga **Avanti** o **OK** molte volte prima che inizi l'installazione del gioco.</span><span class="sxs-lookup"><span data-stu-id="2da56-161">Generally, these offending installers require the user to select **Next** or **OK** many times before installation of the game actually begins.</span></span> <span data-ttu-id="2da56-162">Una volta iniziato, abbiamo visto che alcuni titoli hanno più di un'ora prima che l'utente abbia la possibilità di riprodurre il gioco.</span><span class="sxs-lookup"><span data-stu-id="2da56-162">Once it does begin, we've seen some titles take an hour or more before the user gets the opportunity to play the game.</span></span> <span data-ttu-id="2da56-163">Si è convinti che la prima ora di un'esperienza di gioco non dovrebbe essere l'installazione.</span><span class="sxs-lookup"><span data-stu-id="2da56-163">We feel strongly that the first hour of game play experience should not be the installation.</span></span>

<span data-ttu-id="2da56-164">Per la gestione dell'installazione è consigliabile usare diversi approcci.</span><span class="sxs-lookup"><span data-stu-id="2da56-164">We recommend a number of approaches for dealing with installation.</span></span> <span data-ttu-id="2da56-165">Per prima cosa, è possibile usare le istruzioni semplici e minime.</span><span class="sxs-lookup"><span data-stu-id="2da56-165">First, keep the prompts simple and to a minimum.</span></span> <span data-ttu-id="2da56-166">In secondo luogo, progettare i dati del gioco in modo che alcuni o tutti i file di dati possano essere usati direttamente dal disco di distribuzione, laddove possibile, le unità DVD moderne hanno una larghezza di banda molto elevata.</span><span class="sxs-lookup"><span data-stu-id="2da56-166">Second, architect your game data such that some or all the data files can be used directly from the distribution disk where possible — modern DVD drives have very high bandwidth.</span></span> <span data-ttu-id="2da56-167">In terzo luogo, è consigliabile implementare l'installazione su richiesta nei titoli per ridurre o eliminare il processo di installazione e consentire agli utenti di entrare nel gioco nel minor tempo possibile.</span><span class="sxs-lookup"><span data-stu-id="2da56-167">Third, consider implementing install-on-demand in your titles to reduce or eliminate the installation process and allow users to get into the game as quickly as possible.</span></span> <span data-ttu-id="2da56-168">Per ulteriori informazioni sull'installazione su richiesta, vedere [Install-on-demand per i giochi](/windows/desktop/DxTechArts/install-on-demand-for-games).</span><span class="sxs-lookup"><span data-stu-id="2da56-168">(For more information about installing on demand, see [Install-on-Demand for Games](/windows/desktop/DxTechArts/install-on-demand-for-games).)</span></span>

<span data-ttu-id="2da56-169">Per altre indicazioni sull'installazione dei giochi, vedere [semplificare l'installazione del gioco](/windows/desktop/DxTechArts/simplifying-game-installation).</span><span class="sxs-lookup"><span data-stu-id="2da56-169">For more recommendations about game installation, see [Simplifying Game Installation](/windows/desktop/DxTechArts/simplifying-game-installation).</span></span>

## <a name="lack-of-consideration-of-physical-memory"></a><span data-ttu-id="2da56-170">Mancanza di considerazioni sulla memoria fisica</span><span class="sxs-lookup"><span data-stu-id="2da56-170">Lack of Consideration of Physical Memory</span></span>

<span data-ttu-id="2da56-171">A causa della grande variabilità dell'hardware del PC sul mercato, i titoli usano in genere i test di configurazione ad hoc per selezionare le impostazioni predefinite per il livello di dettaglio grafico.</span><span class="sxs-lookup"><span data-stu-id="2da56-171">Because of the wide variability of PC hardware in the market, titles typically make use of ad hoc configuration tests to select default settings for the level of graphical detail.</span></span> <span data-ttu-id="2da56-172">Alcuni dei titoli che abbiamo visto usano le dimensioni della memoria video in questi test, ma non è possibile metterli in correlazione con le dimensioni della memoria fisica.</span><span class="sxs-lookup"><span data-stu-id="2da56-172">Some of the titles we've seen are using video memory size in these tests, but failing to correlate this with physical memory size.</span></span> <span data-ttu-id="2da56-173">Per gestire le situazioni di dispositivo smarrito, la maggior parte della memoria del video (la VRAM locale sulla scheda e l'apertura della memoria AGP non locale) deve essere supportata dalla memoria fisica, tramite l'uso di risorse gestite o strutture di dati personalizzate.</span><span class="sxs-lookup"><span data-stu-id="2da56-173">In order to handle lost-device situations, the majority of the video memory (both local VRAM on the card and the non-local AGP memory aperture) must be backed by physical memory, either through the use of managed resources or custom data structures.</span></span> <span data-ttu-id="2da56-174">Alcune schede video di fascia alta hanno dimensioni di VRAM che comportano la dimensione delle memorie della CPU di fascia bassa.</span><span class="sxs-lookup"><span data-stu-id="2da56-174">Some high-end video cards have VRAM sizes rivaling the size of low-end CPU memories.</span></span> <span data-ttu-id="2da56-175">In situazioni in cui il sistema ha una quantità di memoria fisica limitata rispetto alla scheda video, la maggior parte di tale VRAM non può essere utilizzata in modo efficace e devono essere configurate le impostazioni del dettaglio più basso.</span><span class="sxs-lookup"><span data-stu-id="2da56-175">In situations where the system has limited physical memory compared to the video card, most of that VRAM cannot be effectively utilized, and lower detail settings should be configured.</span></span>

## <a name="over-reliance-on-real-time-audio-sample-rate-conversion"></a><span data-ttu-id="2da56-176">Over-Reliance sulla conversione della frequenza di campionamento audio Real-Time</span><span class="sxs-lookup"><span data-stu-id="2da56-176">Over-Reliance on Real-Time Audio Sample Rate Conversion</span></span>

<span data-ttu-id="2da56-177">Un'altra fonte comune di ustione del ciclo della CPU si verifica quando il sistema audio è necessario per convertire la velocità di riproduzione durante la combinazione nel buffer hardware.</span><span class="sxs-lookup"><span data-stu-id="2da56-177">Another common source of CPU cycle burn we've seen occurs when the audio system is required to convert the playback rate during mix into the hardware buffer.</span></span> <span data-ttu-id="2da56-178">Con i driver Windows Driver Model (WDM), il formato del buffer hardware non è sotto il controllo dell'applicazione diretta, perché si tratta di una risorsa a livello di kernel. il formato viene invece selezionato in base al formato di qualità superiore di tutte le origini e alle capacità dell'hardware.</span><span class="sxs-lookup"><span data-stu-id="2da56-178">With Windows Driver Model (WDM) drivers, the hardware buffer format is not under direct application control, because it is a kernel-level resource; instead, the format is selected based on the highest-quality format of all sources and the capabilities of the hardware.</span></span> <span data-ttu-id="2da56-179">Per impostazione predefinita, in Windows XP viene utilizzata una conversione della frequenza di campionamento di alta qualità per questo processo. se la maggior parte degli esempi audio richiedono una conversione della frequenza, verrà utilizzata una parte significativa dei cicli della CPU.</span><span class="sxs-lookup"><span data-stu-id="2da56-179">By default, Windows XP uses a high-quality sample rate conversion for this process, and if the majority of the audio samples require a rate conversion, a significant portion of the CPU cycles will be consumed.</span></span>

<span data-ttu-id="2da56-180">È consigliabile creare tutti i buffer DirectSound con la stessa frequenza di campionamento.</span><span class="sxs-lookup"><span data-stu-id="2da56-180">We recommend creating all of your DirectSound buffers with the same sample rate.</span></span> <span data-ttu-id="2da56-181">Se si usano le funzioni di **Wave** di Microsoft Win32, è necessario usare anche una frequenza di campionamento coerente.</span><span class="sxs-lookup"><span data-stu-id="2da56-181">If you make any use of Microsoft Win32 **waveOut** functions, you should use a consistent sample rate with these, too.</span></span> <span data-ttu-id="2da56-182">Con i driver WDM, i buffer verranno tutti combinati dal kernel e se si usa una frequenza di campionamento superiore per alcuni di essi, le frequenze di campionamento di tutte le altre verranno convertite in modo da corrispondere.</span><span class="sxs-lookup"><span data-stu-id="2da56-182">With WDM drivers, the buffers will all be mixed by the kernel, and if you use a higher sampling rate on some of them, the sample rates of all of the rest will be converted to match.</span></span> <span data-ttu-id="2da56-183">Si noti che ciò implica l'uso della stessa frequenza di riproduzione per tutti gli esempi audio, inclusi i buffer di decompressione audio di streaming.</span><span class="sxs-lookup"><span data-stu-id="2da56-183">Note that this implies using the same playback rate for all your audio samples, including any streaming audio decompression buffers.</span></span> <span data-ttu-id="2da56-184">L'impostazione della frequenza del buffer primario non ha alcun effetto a meno che non si tratti di una destinazione Windows 98 o Windows Millennium Edition.</span><span class="sxs-lookup"><span data-stu-id="2da56-184">Setting the primary buffer rate has no effect unless you are targeting either Windows 98 or Windows Millennium Edition.</span></span>

> [!Note]  
> <span data-ttu-id="2da56-185">In Windows Vista e versioni successive del sistema operativo, DirectSound e **Wave** out usano l' [API di sessione audio (WASAPI) di Windows](/windows/desktop/CoreAudio/wasapi) per tutti gli output audio.</span><span class="sxs-lookup"><span data-stu-id="2da56-185">On Windows Vista and later versions of the operating system, DirectSound and **waveOut** use the [Windows Audio Session API (WASAPI)](/windows/desktop/CoreAudio/wasapi) for all audio output.</span></span>

 

## <a name="fragmention-of-virtual-memory"></a><span data-ttu-id="2da56-186">Frammentazione della memoria virtuale</span><span class="sxs-lookup"><span data-stu-id="2da56-186">Fragmention of Virtual Memory</span></span>

<span data-ttu-id="2da56-187">Sono stati riscontrati numerosi problemi recenti relativi al limite di 32 bit per lo spazio di memoria del processo.</span><span class="sxs-lookup"><span data-stu-id="2da56-187">We've seen a number of recent issues related to the 32-bit limit on process memory space.</span></span> <span data-ttu-id="2da56-188">Sebbene i 2 GB di spazio degli indirizzi virtuali per i processi in modalità utente siano stati più che adeguati storicamente, l'utilizzo elevato di file mappati alla memoria di grandi dimensioni, allocatori di memoria personalizzati e dimensioni di VRAM crescenti (che devono essere mappate nello spazio del processo) ha iniziato a causare situazioni in cui le allocazioni dello spazio di memoria virtuale hanno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="2da56-188">While 2 GB of virtual address space for user-mode processes has been more than adequate historically, the increased use of large memory-mapped files, custom memory allocators, and increasing VRAM size (which must be mapped into process space) has started to cause situations where allocations of virtual memory space are failing.</span></span> <span data-ttu-id="2da56-189">Alcune dll non Microsoft usano posizioni di avvio fisso al centro dello spazio degli indirizzi virtuali, causando la frammentazione che comporta allocazioni non riuscite.</span><span class="sxs-lookup"><span data-stu-id="2da56-189">Some non-Microsoft DLLs are using fixed-start locations in the middle of the virtual address space, which is causing fragmentation that results in failed allocations.</span></span>

<span data-ttu-id="2da56-190">Questi problemi vengono spesso visualizzati quando il gioco usa uno schema di allocazione di memoria personalizzato che tenta di allocare un grande blocco continuo di spazio di memoria virtuale.</span><span class="sxs-lookup"><span data-stu-id="2da56-190">These problems most often appear when the game makes use of a custom memory allocation scheme that attempts to allocate a large continuous chunk of virtual memory space.</span></span> <span data-ttu-id="2da56-191">Si consiglia di scrivere gli allocatori in modo che richiedano parti più ragionevolmente dimensionate dello spazio degli indirizzi virtuali in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="2da56-191">Our recommendation is to write allocators such that they request more reasonably sized portions of the virtual address space as needed.</span></span> <span data-ttu-id="2da56-192">Ad esempio, richiedendo 64 o 256 MB alla volta, ma non 1 GB.</span><span class="sxs-lookup"><span data-stu-id="2da56-192">For example, requesting 64 or 256 MB at a time, but not 1 GB.</span></span> <span data-ttu-id="2da56-193">È tuttavia necessario prestare attenzione a non causare ulteriori frammenti.</span><span class="sxs-lookup"><span data-stu-id="2da56-193">However, care should be taken to not cause further fragmentation.</span></span> <span data-ttu-id="2da56-194">L'avvento di sistemi operativi e hardware a 64 bit contribuirà a questi problemi in futuro, ma è necessario prestare attenzione ai sistemi a 32 bit correnti.</span><span class="sxs-lookup"><span data-stu-id="2da56-194">The advent of 64-bit operating systems and hardware will greatly help these issues in the future, but care must be taken on current-generation 32-bit systems.</span></span>

## <a name="manipulation-of-the-floating-point-control-word"></a><span data-ttu-id="2da56-195">Manipolazione della parola di controllo Floating-Point</span><span class="sxs-lookup"><span data-stu-id="2da56-195">Manipulation of the Floating-Point Control Word</span></span>

<span data-ttu-id="2da56-196">Come supporto per il debug, alcuni sviluppatori hanno attivato le eccezioni sull'unità a virgola mobile (FPU) tramite modifiche della parola di controllo a virgola mobile.</span><span class="sxs-lookup"><span data-stu-id="2da56-196">As a debugging aid, some developers have been enabling exceptions on the floating-point unit (FPU) via manipulations of the floating-point control word.</span></span> <span data-ttu-id="2da56-197">Questa operazione è molto problematica e potrebbe causare l'arresto anomalo del processo.</span><span class="sxs-lookup"><span data-stu-id="2da56-197">Doing this is highly problematic and will likely cause the process to crash.</span></span> <span data-ttu-id="2da56-198">Proprio come la convenzione di chiamata richiede che il registro ebx venga mantenuto, la maggior parte del sistema presuppone che la FPU si trovi in uno stato predefinito, restituirà risultati ragionevoli e non genererà eccezioni.</span><span class="sxs-lookup"><span data-stu-id="2da56-198">Just like the calling convention requires that the ebx register be preserved, the majority of the system assumes that the FPU is in a default state, will give reasonable results, and won't generate exceptions.</span></span> <span data-ttu-id="2da56-199">I driver e altri componenti di sistema spesso calcolano i risultati in base al presupposto che i valori di errore standard verranno visualizzati nei registri per le condizioni non valide, ma se le eccezioni sono abilitate, queste non verranno gestite e provocheranno arresti anomali.</span><span class="sxs-lookup"><span data-stu-id="2da56-199">Drivers and other system components will often compute results based on the assumption that standard error values will appear in the registers for bad conditions, but if exceptions are enabled, these will go unhandled and result in crashes.</span></span>

<span data-ttu-id="2da56-200">Direct3D imposterà l'unità a virgola mobile su precisione singola, arrotondata al più vicino come parte dell'inizializzazione per il thread chiamante, a meno che non \_ \_ venga usato il flag D3DCREATE FPU Preserve, nel qual caso la parola di controllo a virgola mobile non viene toccata.</span><span class="sxs-lookup"><span data-stu-id="2da56-200">Direct3D will set the floating-point unit to single-precision, round-to-nearest as part of initialization for the calling thread, unless the D3DCREATE\_FPU\_PRESERVE flag is used, in which case, the floating-point control word is untouched.</span></span> <span data-ttu-id="2da56-201">Poiché la parola di controllo è un'impostazione per thread, assicurarsi che tutti i thread dell'applicazione siano impostati sulla modalità a precisione singola per ottimizzare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="2da56-201">Since the control word is a per-thread setting, ensuring that all of your application threads are set to single-precision mode may optimize performance.</span></span> <span data-ttu-id="2da56-202">Tenere presente che la chiamata a [**\_ control87**](https://msdn.microsoft.com/library/e9b52ceh(v=VS.71).aspx) non è valida per la codifica x64 nativa, che usa esclusivamente SSE ed è estremamente costosa nell'architettura basata su PowerPC della CPU Xbox 360.</span><span class="sxs-lookup"><span data-stu-id="2da56-202">Remember that calling [**\_control87**](https://msdn.microsoft.com/library/e9b52ceh(v=VS.71).aspx) is not valid for x64-native coding, which uses SSE exclusively instead, and it is extremely expensive on the PowerPC-based architecture of the Xbox 360 CPU.</span></span>

> [!Note]  
> <span data-ttu-id="2da56-203">Se si modifica la parola di controllo, usare [**\_ controlfp \_ s**](https://msdn.microsoft.com/library/c9676k6h(v=VS.80).aspx) e tenere presente che per le piattaforme x64 non è possibile modificare la precisione a virgola mobile tramite la parola di controllo.</span><span class="sxs-lookup"><span data-stu-id="2da56-203">If you modify the control word, use [**\_controlfp\_s**](https://msdn.microsoft.com/library/c9676k6h(v=VS.80).aspx) and be aware that for x64 platforms you can't change the floating-point precision via the control word.</span></span>

 

<span data-ttu-id="2da56-204">In tutte le librerie in cui è necessario avere regole di arrotondamento diverse o altri comportamenti, ad esempio la gestione di vertex shader o la compilazione di software, viene salvata e ripristinata la parola di controllo.</span><span class="sxs-lookup"><span data-stu-id="2da56-204">In any libraries where we need to have different rounding rules or other behavior — such as dealing with software vertex shaders or compilation — we save and restore the control word.</span></span> <span data-ttu-id="2da56-205">Se un gioco deve usare l'arrotondamento non standard o le eccezioni FPU, deve salvare e ripristinare la parola di controllo a virgola mobile ed è necessario assicurarsi che non chiami codice esterno che non è stato dimostrato di essere sicuro da questi problemi, incluse le API di sistema.</span><span class="sxs-lookup"><span data-stu-id="2da56-205">If a game needs to make use of non-standard rounding or FPU exceptions, it should save and restore the floating-point control word, and you should be sure that it does not call any external code that has not been proven to be safe from these problems, including system APIs.</span></span>

## <a name="optional-installation-of-the-directx-runtime"></a><span data-ttu-id="2da56-206">Installazione facoltativa di DirectX Runtime</span><span class="sxs-lookup"><span data-stu-id="2da56-206">Optional Installation of the DirectX Runtime</span></span>

<span data-ttu-id="2da56-207">Un numero di giochi chiede all'utente se installare DirectX.</span><span class="sxs-lookup"><span data-stu-id="2da56-207">A number of games ask the user whether to install DirectX.</span></span> <span data-ttu-id="2da56-208">Questa operazione può causare problemi se l'utente presuppone che il sistema abbia installato la versione più recente di DirectX Redistributable e ne ignori l'installazione e, successivamente, l'installazione continua correttamente.</span><span class="sxs-lookup"><span data-stu-id="2da56-208">This can cause problems if the user assumes that the system has the latest DirectX redistributable installed and skips installation, and subsequently, the installation continues successfully.</span></span> <span data-ttu-id="2da56-209">Se il gioco richiede una versione specifica di D3DX o altre funzionalità aggiornate che non sono state installate, il gioco non funzionerà e l'utente sarà molto frustrato.</span><span class="sxs-lookup"><span data-stu-id="2da56-209">If the game requires a specific version of D3DX, or other updated functionality that was not installed, then the game won't work, and the user will get very frustrated.</span></span>

<span data-ttu-id="2da56-210">Si consiglia vivamente al programma di installazione del gioco di installare in modo invisibile all'utente DirectX ridistribuibile su cui è stato compilato il gioco.</span><span class="sxs-lookup"><span data-stu-id="2da56-210">It is strongly recommended that the game's installer silently install the DirectX redistributable that the game was built against.</span></span> <span data-ttu-id="2da56-211">Il processo di installazione di DirectX è progettato in modo da verificare se è necessario aggiornare qualsiasi elemento e restituisce rapidamente un risultato in caso contrario.</span><span class="sxs-lookup"><span data-stu-id="2da56-211">The DirectX installation process is designed so that it verifies whether anything needs to be updated and quickly returns if it doesn't.</span></span> <span data-ttu-id="2da56-212">Non è quindi necessario richiedere all'utente di installare DirectX.</span><span class="sxs-lookup"><span data-stu-id="2da56-212">So, there is no need to ask the user about installing DirectX.</span></span>

<span data-ttu-id="2da56-213">Un'installazione invisibile all'utente di DirectX può essere eseguita eseguendo questo comando dal pacchetto di installazione: **dxsetup.exe/Silent**</span><span class="sxs-lookup"><span data-stu-id="2da56-213">A silent installation of DirectX can be done by running this command from your installation package: **dxsetup.exe /silent**</span></span>

<span data-ttu-id="2da56-214">Inoltre, le dimensioni effettive della cartella ridistribuibile possono essere configurate in modo da includere solo i file CAB effettivamente necessari per le piattaforme di destinazione del gioco e l'utilizzo.</span><span class="sxs-lookup"><span data-stu-id="2da56-214">Furthermore, the actual size of the redistributable folder can be configured to include only those cabinet files (.cab) that are actually needed for the game's target platforms and usage.</span></span>

> [!Note]  
> <span data-ttu-id="2da56-215">Prima di usare **Dxsetup**, leggere [installazione non diretta](https://walbourn.github.io/).</span><span class="sxs-lookup"><span data-stu-id="2da56-215">Before you use **dxsetup**, read [Not So Direct Setup](https://walbourn.github.io/).</span></span>

 

## <a name="excessive-use-of-thread-synchronization"></a><span data-ttu-id="2da56-216">Utilizzo eccessivo della sincronizzazione dei thread</span><span class="sxs-lookup"><span data-stu-id="2da56-216">Excessive Use of Thread Synchronization</span></span>

<span data-ttu-id="2da56-217">Durante la profilatura dei giochi, spesso gli hotspot più frequenti sono correlati all'immissione e all'uscita dalle sezioni critiche.</span><span class="sxs-lookup"><span data-stu-id="2da56-217">When profiling games, the top hotspots are often found to be related to entering and leaving critical sections.</span></span> <span data-ttu-id="2da56-218">Con la prevalenza delle CPU multicore, l'uso del multithreading nei giochi è aumentato notevolmente e molte implementazioni si basano su un utilizzo intensivo della sincronizzazione dei thread.</span><span class="sxs-lookup"><span data-stu-id="2da56-218">With the prevalence of multi-core CPUs, the use of multithreading in games has increased dramatically, and many implementations rely on heavy use of thread synchronization.</span></span> <span data-ttu-id="2da56-219">Il tempo di CPU necessario per eseguire una sezione critica anche senza conflitti è piuttosto significativo e tutte le altre forme di sincronizzazione dei thread sono ancora più onerose.</span><span class="sxs-lookup"><span data-stu-id="2da56-219">The CPU time to take a critical section even without any contention is quite significant, and all other forms of thread synchronization are even more expensive.</span></span> <span data-ttu-id="2da56-220">Quindi, è necessario prestare attenzione per ridurre al minimo l'uso di queste primitive.</span><span class="sxs-lookup"><span data-stu-id="2da56-220">So, care must be taken to minimize the use of these primitives.</span></span>

<span data-ttu-id="2da56-221">Un'origine comune di una sincronizzazione eccessiva nei giochi è l'uso di [D3DCREATE \_ multithreading](/windows/desktop/direct3d9/d3dcreate).</span><span class="sxs-lookup"><span data-stu-id="2da56-221">A common source of excessive synchronization in games is the use of [D3DCREATE\_MULTITHREADED](/windows/desktop/direct3d9/d3dcreate).</span></span> <span data-ttu-id="2da56-222">Questo flag, rendendo thread-safe Direct3D per il rendering da più thread, accetta un approccio molto prudente, ottenendo un sovraccarico di sincronizzazione elevato.</span><span class="sxs-lookup"><span data-stu-id="2da56-222">This flag, while making Direct3D thread-safe for rendering from multiple threads, takes a very conservative approach, resulting in high synchronization overhead.</span></span> <span data-ttu-id="2da56-223">I giochi devono evitare questo flag.</span><span class="sxs-lookup"><span data-stu-id="2da56-223">Games should avoid this flag.</span></span> <span data-ttu-id="2da56-224">Progettare invece il motore in modo che tutte le comunicazioni con Direct3D provengano da un singolo thread e che tutte le comunicazioni tra i thread vengano gestite direttamente.</span><span class="sxs-lookup"><span data-stu-id="2da56-224">Instead, architect the engine so that all communication with Direct3D is from a single thread and any communication between threads is handled directly.</span></span> <span data-ttu-id="2da56-225">Per ulteriori informazioni sulla progettazione di giochi multithread, vedere l'articolo relativo alla [codifica di più core in Xbox 360 e Microsoft Windows](/windows/desktop/DxTechArts/coding-for-multiple-cores).</span><span class="sxs-lookup"><span data-stu-id="2da56-225">For more information about designing multi-threaded games, see the article [Coding For Multiple Cores on Xbox 360 and Microsoft Windows](/windows/desktop/DxTechArts/coding-for-multiple-cores).</span></span>

## <a name="use-of-rdtsc"></a><span data-ttu-id="2da56-226">Uso di RDTSC</span><span class="sxs-lookup"><span data-stu-id="2da56-226">Use of RDTSC</span></span>

<span data-ttu-id="2da56-227">Non è consigliabile usare l'istruzione x86 **RDTSC** .</span><span class="sxs-lookup"><span data-stu-id="2da56-227">Use of the x86 instruction **RDTSC** is not recommended.</span></span> <span data-ttu-id="2da56-228">**RDTSC** non riesce a calcolare correttamente l'intervallo di tempo in alcuni schemi di risparmio energia che modificano la frequenza della CPU in modo dinamico e in molte CPU multicore per le quali il contatore del ciclo non è sincronizzato tra i core.</span><span class="sxs-lookup"><span data-stu-id="2da56-228">**RDTSC** fails to correctly compute timing on some power management schemes that change the CPU frequency dynamically and on many multi-core CPUs for which the cycle counter is not synchronized between cores.</span></span> <span data-ttu-id="2da56-229">I giochi devono invece usare l'API [**QueryPerformanceCounter**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancecounter) .</span><span class="sxs-lookup"><span data-stu-id="2da56-229">Games should instead use the [**QueryPerformanceCounter**](/windows/desktop/api/profileapi/nf-profileapi-queryperformancecounter) API.</span></span> <span data-ttu-id="2da56-230">Per ulteriori informazioni sui problemi relativi a **RDTSC** e sull'implementazione della temporizzazione ad alta risoluzione con **QueryPerformanceCounter**, vedere l'articolo relativo alla [temporizzazione dei giochi e ai processori multicore](/windows/desktop/DxTechArts/game-timing-and-multicore-processors).</span><span class="sxs-lookup"><span data-stu-id="2da56-230">For more information about issues with **RDTSC** and implementing high-resolution timing with **QueryPerformanceCounter**, see the article [Game Timing and Multicore Processors](/windows/desktop/DxTechArts/game-timing-and-multicore-processors).</span></span>

 

 