---
description: In questa sezione viene fornita una panoramica del modello di threading con manipolazione diretta, della modalità di elaborazione dei messaggi della finestra tramite manipolazione diretta e del modo in cui viene modificato lo stato di un viewport quando viene eseguito il mapping dell'input ai movimenti di output.
ms.assetid: 0818E34E-990E-4C36-9954-EF87EB226AF6
title: Elaborazione dell'input con DirectManipulation
ms.topic: article
ms.date: 02/03/2020
ms.openlocfilehash: 284a0a1866a2082e2c34c65de347b0dcdfab3a64
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/06/2021
ms.locfileid: "106303940"
---
# <a name="processing-input-with-directmanipulation"></a><span data-ttu-id="48685-103">Elaborazione dell'input con DirectManipulation</span><span class="sxs-lookup"><span data-stu-id="48685-103">Processing input with DirectManipulation</span></span>

<span data-ttu-id="48685-104">In questa sezione viene fornita una panoramica del modello di threading con [manipolazione diretta](direct-manipulation-portal.md) , della modalità di elaborazione dei messaggi della finestra tramite manipolazione diretta e del modo in cui viene modificato lo stato di un viewport quando viene eseguito il mapping dell'input ai movimenti di output.</span><span class="sxs-lookup"><span data-stu-id="48685-104">This section provides an overview of the [Direct Manipulation](direct-manipulation-portal.md) threading model, how window messages are processed by Direct Manipulation, and how the state of a viewport changes as input is mapped to output motions.</span></span>

- [<span data-ttu-id="48685-105">Flusso di input</span><span class="sxs-lookup"><span data-stu-id="48685-105">Input flow</span></span>](#input-flow)
- [<span data-ttu-id="48685-106">Osservazioni:</span><span class="sxs-lookup"><span data-stu-id="48685-106">Remarks</span></span>](#remarks)

<span data-ttu-id="48685-107">La [manipolazione diretta](direct-manipulation-portal.md) usa due thread per coordinare le operazioni asincrone:</span><span class="sxs-lookup"><span data-stu-id="48685-107">[Direct Manipulation](direct-manipulation-portal.md) uses two threads to coordinate asynchronous operations:</span></span>

<span data-ttu-id="48685-108">*Thread UI* : il thread proprietario dell'elemento **HWND** associato all'input.</span><span class="sxs-lookup"><span data-stu-id="48685-108">*UI thread* - the thread that owns the **HWND** associated with input.</span></span> <span data-ttu-id="48685-109">Questo thread è proprietario dell'inizializzazione della [manipolazione diretta](direct-manipulation-portal.md).</span><span class="sxs-lookup"><span data-stu-id="48685-109">This thread owns initialization of [Direct Manipulation](direct-manipulation-portal.md).</span></span> <span data-ttu-id="48685-110">L'elaborazione dell'input da tastiera e mouse si verifica anche sul thread dell'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="48685-110">Mouse and keyboard input processing also happens on the UI thread.</span></span>

<span data-ttu-id="48685-111">*Thread delegato* : thread creato e di proprietà della [manipolazione diretta](direct-manipulation-portal.md).</span><span class="sxs-lookup"><span data-stu-id="48685-111">*Delegate thread* - the thread created and owned by [Direct Manipulation](direct-manipulation-portal.md).</span></span> <span data-ttu-id="48685-112">L'elaborazione dell'input tocco viene eseguita nel thread delegato.</span><span class="sxs-lookup"><span data-stu-id="48685-112">Touch input processing happens on the delegate thread.</span></span>

## <a name="input-flow"></a><span data-ttu-id="48685-113">Flusso di input</span><span class="sxs-lookup"><span data-stu-id="48685-113">Input flow</span></span>

<span data-ttu-id="48685-114">In una configurazione tipica in cui l'hit testing viene eseguito sul thread dell'interfaccia utente, i messaggi della finestra vengono elaborati tramite [manipolazione diretta](direct-manipulation-portal.md) nell'ordine seguente:</span><span class="sxs-lookup"><span data-stu-id="48685-114">In a typical configuration where hit testing is done on the UI thread, window messages are processed by [Direct Manipulation](direct-manipulation-portal.md) in the following order:</span></span>

![diagramma che illustra l'ordine in cui vengono elaborati i messaggi.](images/inputprocessing.png)

<span data-ttu-id="48685-116">Per un viewport inattivo:</span><span class="sxs-lookup"><span data-stu-id="48685-116">For a viewport at rest:</span></span>

1. <span data-ttu-id="48685-117">Una serie di messaggi finestra raggiunge il thread delegato.</span><span class="sxs-lookup"><span data-stu-id="48685-117">A series of window messages reach the delegate thread.</span></span>
2. <span data-ttu-id="48685-118">[WM_POINTERDOWN](../inputmsg/wm-pointerdown.md) e [DM_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) i messaggi vengono inviati dal thread delegato al thread di hit test indipendente (IHT).</span><span class="sxs-lookup"><span data-stu-id="48685-118">[WM_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages are sent by the delegate thread to the Independent Hit Test (IHT) thread.</span></span>
3. <span data-ttu-id="48685-119">Se il metodo [**secontact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) viene chiamato dal thread IHT, i messaggi potrebbero essere inviati al thread dell'interfaccia utente dal thread delegato, a seconda del valore [**del \_ \_ tipo di DIRECTMANIPULATION HITTEST**](/windows/win32/api/directmanipulation/ne-directmanipulation-directmanipulation_hittest_type) quando è stato chiamato [**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget) .</span><span class="sxs-lookup"><span data-stu-id="48685-119">If [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) is called from the IHT thread, messages might get sent to the UI thread by the delegate thread, depending on the value of [**DIRECTMANIPULATION\_HITTEST\_TYPE**](/windows/win32/api/directmanipulation/ne-directmanipulation-directmanipulation_hittest_type) when [**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget) was called.</span></span>
4. <span data-ttu-id="48685-120">Se [**secontact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) non viene chiamato dal thread IHT, i messaggi vengono sempre inviati dal thread delegato al thread dell'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="48685-120">If [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) is not called from the IHT thread, messages are always sent by the delegate thread to the UI thread.</span></span>
5. <span data-ttu-id="48685-121">Il client può chiamare [**secontact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) dal thread UI per consentire alla [manipolazione diretta](direct-manipulation-portal.md) di rilevare una manipolazione.</span><span class="sxs-lookup"><span data-stu-id="48685-121">The client can call [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) from the UI thread to let [Direct Manipulation](direct-manipulation-portal.md) detect a manipulation.</span></span>
6. <span data-ttu-id="48685-122">Se viene rilevata una manipolazione, la [manipolazione diretta](direct-manipulation-portal.md) Invia un messaggio [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) per notificare al client che l'input è gestito da manipolazione diretta.</span><span class="sxs-lookup"><span data-stu-id="48685-122">If a manipulation is detected, [Direct Manipulation](direct-manipulation-portal.md) sends a [WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) message to notify the client that the input is being handled by Direct Manipulation.</span></span> <span data-ttu-id="48685-123">Lo stato del viewport è impostato su **in esecuzione** e la trasformazione di output verrà aggiornata.</span><span class="sxs-lookup"><span data-stu-id="48685-123">The viewport status is set to **RUNNING** and the output transform will be updated.</span></span>
7. <span data-ttu-id="48685-124">Se viene rilevata un'interazione diversa da una manipolazione, la [manipolazione diretta](direct-manipulation-portal.md) invia messaggi rimanenti al thread dell'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="48685-124">If an interaction other than a manipulation is detected, [Direct Manipulation](direct-manipulation-portal.md) sends remaining messages to the UI thread.</span></span>

<span data-ttu-id="48685-125">Per un viewport in movimento (con stato in esecuzione o inerzia), il messaggio di finestra raggiunge prima il thread del delegato, in cui l'hit test della [manipolazione diretta](direct-manipulation-portal.md) viene eseguito su tutti i viewport in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="48685-125">For a viewport in motion (with a status of RUNNING or INERTIA), the window message reaches the delegate thread first, where [Direct Manipulation](direct-manipulation-portal.md) hit tests against all running viewports.</span></span> <span data-ttu-id="48685-126">La manipolazione diretta assegna automaticamente il contatto ai viewport appropriati identificati dall'hit testing.</span><span class="sxs-lookup"><span data-stu-id="48685-126">Direct Manipulation automatically assigns the contact to the appropriate viewports identified by hit testing.</span></span> <span data-ttu-id="48685-127">Lo stato del viewport è in esecuzione e la trasformazione di output verrà aggiornata.</span><span class="sxs-lookup"><span data-stu-id="48685-127">The viewport status is RUNNING and the output transform will be updated.</span></span>

<span data-ttu-id="48685-128">In alcuni casi, un thread dell'interfaccia utente dell'applicazione può essere troppo lento per rispondere all'hit testing.</span><span class="sxs-lookup"><span data-stu-id="48685-128">In some cases, an application UI thread may be too slow to respond to hit testing.</span></span> <span data-ttu-id="48685-129">È possibile usare un thread di hit test ([**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget)) per consentire al client di spostare i messaggi [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) e [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) in un thread specifico per consentire l'hit testing.</span><span class="sxs-lookup"><span data-stu-id="48685-129">A hit test thread may be used ([**RegisterHitTestTarget**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationmanager-registerhittesttarget)) to allow the client to move [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages to a specific thread to allow for hit testing.</span></span>

## <a name="remarks"></a><span data-ttu-id="48685-130">Commenti</span><span class="sxs-lookup"><span data-stu-id="48685-130">Remarks</span></span>

<span data-ttu-id="48685-131">In genere, la [manipolazione diretta](direct-manipulation-portal.md) invia al thread dell'interfaccia utente solo i messaggi [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) e [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) , trattenendo i messaggi successivi in attesa di una risposta dal client.</span><span class="sxs-lookup"><span data-stu-id="48685-131">Typically, [Direct Manipulation](direct-manipulation-portal.md) sends only [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages to the UI thread, withholding later messages while waiting for a response from the client.</span></span> <span data-ttu-id="48685-132">Se il client chiama [**secontact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact), gli unici messaggi ricevuti dal thread UI quando viene rilevata una manipolazione sono [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) e [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md)e il [messaggio WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md).</span><span class="sxs-lookup"><span data-stu-id="48685-132">If the client calls [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact), the only messages the UI thread receives when a manipulation is detected are [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md), and [WM/_POINTERCAPTURECHANGED message](../inputmsg/wm-pointercapturechanged.md).</span></span>

<span data-ttu-id="48685-133">È possibile che il client [**non chiami il**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) callback durante l'elaborazione di messaggi [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) e [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) .</span><span class="sxs-lookup"><span data-stu-id="48685-133">The client might not call [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) when processing [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) and [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) messages.</span></span> <span data-ttu-id="48685-134">In questo caso, la [manipolazione diretta](direct-manipulation-portal.md) Invia tutti i messaggi al thread dell'interfaccia utente senza analizzare i messaggi per verificare se è presente una manipolazione.</span><span class="sxs-lookup"><span data-stu-id="48685-134">In this case, [Direct Manipulation](direct-manipulation-portal.md) sends all messages to the UI thread without analyzing the messages to see if there is a manipulation.</span></span> <span data-ttu-id="48685-135">Il client può quindi scegliere qualsiasi punto per chiamare il **secontatto** e fare in modo che la manipolazione diretta inizi a rilevare le manipolazioni e inviare messaggi di [messaggio WM/_POINTERCAPTURECHANGED](../inputmsg/wm-pointercapturechanged.md) quando ne viene rilevata una.</span><span class="sxs-lookup"><span data-stu-id="48685-135">The client can then choose any point to call **SetContact** and have Direct Manipulation start detecting manipulations, and send [WM/_POINTERCAPTURECHANGED message](../inputmsg/wm-pointercapturechanged.md) messages when one is detected.</span></span>

<span data-ttu-id="48685-136">**Windows 10 e versioni successive:** È possibile decidere quali manipolazioni si desidera gestire chiamando [**DeferContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationdefercontactservice-defercontact) prima di chiamare il [**secontatto**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) in un messaggio [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) o [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) .</span><span class="sxs-lookup"><span data-stu-id="48685-136">**Windows 10 and later:** You can decide which manipulations you want to handle by calling [**DeferContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationdefercontactservice-defercontact) before calling [**SetContact**](/windows/win32/api/DirectManipulation/nf-directmanipulation-idirectmanipulationviewport-setcontact) on a [WM/_POINTERDOWN](../inputmsg/wm-pointerdown.md) or [DM/_POINTERHITTEST](../inputmsg/dm-pointerhittest.md) message.</span></span> <span data-ttu-id="48685-137">**DeferContact** garantisce che tutti i messaggi successivi vengano inviati al thread dell'interfaccia utente per il periodo di tempo specificato.</span><span class="sxs-lookup"><span data-stu-id="48685-137">**DeferContact** ensures all subsequent messages are sent to the UI thread for the specified period of time.</span></span>
