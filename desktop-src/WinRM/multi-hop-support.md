---
title: Supporto di più hop in WinRM
description: Gestione remota Windows (WinRM) supporta la delega delle credenziali utente tra più computer remoti.
ms.assetid: 0e6c8966-bb05-4dfb-b154-300fa76e8d9c
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f22c3d66e8605e932fe15b812f92d51350da2d69
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104482805"
---
# <a name="multi-hop-support-in-winrm"></a><span data-ttu-id="68dcd-103">Supporto di più hop in WinRM</span><span class="sxs-lookup"><span data-stu-id="68dcd-103">Multi-Hop Support in WinRM</span></span>

<span data-ttu-id="68dcd-104">Gestione remota Windows (WinRM) supporta la delega delle credenziali utente tra più computer remoti.</span><span class="sxs-lookup"><span data-stu-id="68dcd-104">Windows Remote Management (WinRM) supports the delegation of user credentials across multiple remote computers.</span></span> <span data-ttu-id="68dcd-105">La funzionalità di supporto di più hop ora può usare Credential Security Service Provider (CredSSP) per l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="68dcd-105">The multi-hop support functionality can now use Credential Security Service Provider (CredSSP) for authentication.</span></span> <span data-ttu-id="68dcd-106">CredSSP consente a un'applicazione di delegare le credenziali dell'utente dal computer client al server di destinazione.</span><span class="sxs-lookup"><span data-stu-id="68dcd-106">CredSSP enables an application to delegate the user's credentials from the client computer to the target server.</span></span>

<span data-ttu-id="68dcd-107">L'autenticazione CredSSP è destinata agli ambienti in cui non è possibile usare la delega Kerberos.</span><span class="sxs-lookup"><span data-stu-id="68dcd-107">CredSSP authentication is intended for environments where Kerberos delegation cannot be used.</span></span> <span data-ttu-id="68dcd-108">È stato aggiunto il supporto per CredSSP per consentire a un utente di connettersi a un server remoto e avere la possibilità di accedere a un computer con un secondo hop, ad esempio una condivisione file.</span><span class="sxs-lookup"><span data-stu-id="68dcd-108">Support for CredSSP was added to allow a user to connect to a remote server and have the ability to access a second-hop machine, such as a file share.</span></span>

<span data-ttu-id="68dcd-109">Per ulteriori informazioni su CredSSP, vedere [KB 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="68dcd-109">For more information about CredSSP, see [KB 951608](https://support.microsoft.com/kb/951608).</span></span>

> [!Note]  
> <span data-ttu-id="68dcd-110">I client e i server WinRM supporteranno l'autenticazione CredSSP solo con le credenziali esplicite.</span><span class="sxs-lookup"><span data-stu-id="68dcd-110">WinRM clients and servers will support CredSSP authentication only with explicit credentials.</span></span>

 

## <a name="multi-hop-support-configuration-setup-and-details"></a><span data-ttu-id="68dcd-111">Installazione e dettagli della configurazione del supporto multihop</span><span class="sxs-lookup"><span data-stu-id="68dcd-111">Multi-Hop Support Configuration Setup and Details</span></span>

<span data-ttu-id="68dcd-112">Sono disponibili diversi meccanismi per la configurazione delle impostazioni WinRM.</span><span class="sxs-lookup"><span data-stu-id="68dcd-112">There are multiple mechanisms for configuring WinRM settings.</span></span> <span data-ttu-id="68dcd-113">Nella procedura seguente vengono utilizzati l'utilità **WinRM** e l'Editor criteri di gruppo (**gpedit. msc**).</span><span class="sxs-lookup"><span data-stu-id="68dcd-113">In the following procedure, the **winrm** utility and Group Policy editor (**GPEdit.msc**) are used.</span></span> <span data-ttu-id="68dcd-114">CredSSP può essere abilitato anche per WinRM usando Windows PowerShell.</span><span class="sxs-lookup"><span data-stu-id="68dcd-114">CredSSP can also be enabled for WinRM by using Windows PowerShell.</span></span> <span data-ttu-id="68dcd-115">Per informazioni dettagliate sulla configurazione e sugli esempi di utilizzo, vedere i cmdlet di Windows PowerShell [Enable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Enable-WSManCredSSP?view=powershell-5.1&preserve-view=true), [Get-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Get-WSManCredSSP?view=powershell-5.1&preserve-view=true)e [Disable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Disable-WSManCredSSP?view=powershell-5.1&preserve-view=true) .</span><span class="sxs-lookup"><span data-stu-id="68dcd-115">See the [Enable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Enable-WSManCredSSP?view=powershell-5.1&preserve-view=true), [Get-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Get-WSManCredSSP?view=powershell-5.1&preserve-view=true), and [Disable-WSManCredSSP](/powershell/module/Microsoft.WsMan.Management/Disable-WSManCredSSP?view=powershell-5.1&preserve-view=true) Windows PowerShell cmdlets for detailed configuration information and usage examples.</span></span>

<span data-ttu-id="68dcd-116">La delega CredSSP deve essere abilitata nelle impostazioni client e nelle impostazioni del servizio nel computer remoto.</span><span class="sxs-lookup"><span data-stu-id="68dcd-116">CredSSP delegation must be enabled in the client settings and in the service settings on the remote computer.</span></span> <span data-ttu-id="68dcd-117">Inoltre, l'uso di CredSSP richiede la configurazione di un [*listener*](windows-remote-management-glossary.md) http o HTTPS sul server.</span><span class="sxs-lookup"><span data-stu-id="68dcd-117">In addition, using CredSSP requires setting up an HTTP or HTTPS [*listener*](windows-remote-management-glossary.md) on the server.</span></span>

<span data-ttu-id="68dcd-118">**Per configurare il supporto di più hop usando l'autenticazione CredSSP per WinRM**</span><span class="sxs-lookup"><span data-stu-id="68dcd-118">**To configure multi-hop support using CredSSP authentication for WinRM**</span></span>

1.  <span data-ttu-id="68dcd-119">CredSSP deve essere abilitato nelle impostazioni di configurazione del client.</span><span class="sxs-lookup"><span data-stu-id="68dcd-119">CredSSP must be enabled in the client configuration settings.</span></span> <span data-ttu-id="68dcd-120">Questo flag può essere abilitato manualmente o tramite un'impostazione Criteri di gruppo.</span><span class="sxs-lookup"><span data-stu-id="68dcd-120">This flag can be enabled manually or through a Group Policy setting.</span></span> <span data-ttu-id="68dcd-121">L'impostazione predefinita è **False**.</span><span class="sxs-lookup"><span data-stu-id="68dcd-121">The default setting is **False**.</span></span> <span data-ttu-id="68dcd-122">Il criterio di **autenticazione Consenti CredSSP** si trova nel percorso seguente: Configurazione computer \\ modello amministrativo di \\ Windows Components \\ gestione remota Windows (WinRM) \\ WinRM client.</span><span class="sxs-lookup"><span data-stu-id="68dcd-122">The **Allow CredSSP authentication** policy is located at the following path: Computer Configuration\\Administrative template\\Windows Components\\Windows Remote Management (WinRM)\\WinRM Client.</span></span>

    <span data-ttu-id="68dcd-123">Il comando seguente illustra come usare l'utilità WinRM per abilitare CredSSP nel client WinRM:</span><span class="sxs-lookup"><span data-stu-id="68dcd-123">The following command demonstrates how to use the winrm utility to enable CredSSP on the WinRM client:</span></span>

    <span data-ttu-id="68dcd-124">**winrm set winrm/config/client/auth @ {CredSSP = "true"}**</span><span class="sxs-lookup"><span data-stu-id="68dcd-124">**winrm set winrm/config/client/auth @{CredSSP="true"}**</span></span>

2.  <span data-ttu-id="68dcd-125">CredSSP deve essere abilitato nelle impostazioni di configurazione del servizio gestione remota Windows.</span><span class="sxs-lookup"><span data-stu-id="68dcd-125">CredSSP must be enabled in the WinRM service configuration settings.</span></span> <span data-ttu-id="68dcd-126">Questo flag può essere abilitato manualmente o tramite un'impostazione Criteri di gruppo.</span><span class="sxs-lookup"><span data-stu-id="68dcd-126">This flag can be enabled manually or through a Group Policy setting.</span></span> <span data-ttu-id="68dcd-127">L'impostazione predefinita è **False**.</span><span class="sxs-lookup"><span data-stu-id="68dcd-127">The default setting is **False**.</span></span> <span data-ttu-id="68dcd-128">Il criterio di **autenticazione Consenti CredSSP** si trova nel percorso seguente: Configurazione computer \\ modello amministrativo di \\ Windows Components \\ gestione remota Windows (WinRM) \\ WinRM service.</span><span class="sxs-lookup"><span data-stu-id="68dcd-128">The **Allow CredSSP authentication** policy is located at the following path: Computer Configuration\\Administrative template\\Windows Components\\Windows Remote Management (WinRM)\\WinRM Service.</span></span>

    <span data-ttu-id="68dcd-129">Il comando seguente illustra come usare l'utilità WinRM per abilitare CredSSP nel servizio gestione remota Windows:</span><span class="sxs-lookup"><span data-stu-id="68dcd-129">The following command demonstrates how to use the winrm utility to enable CredSSP on the WinRM service:</span></span>

    <span data-ttu-id="68dcd-130">**winrm set winrm/config/Service/auth @ {CredSSP = "true"}**</span><span class="sxs-lookup"><span data-stu-id="68dcd-130">**winrm set winrm/config/service/auth @{CredSSP="true"}**</span></span>

3.  <span data-ttu-id="68dcd-131">È necessario abilitare l'impostazione dei criteri Consenti delega nuove credenziali (**AllowFreshCredentials**) nel client WinRM ed è necessario aggiungere al criterio un nome dell'entità servizio (SPN) con il prefisso WSMan.</span><span class="sxs-lookup"><span data-stu-id="68dcd-131">The Allow Delegating Fresh Credentials (**AllowFreshCredentials**) policy setting must be enabled on the WinRM client, and a Service Principal Name (SPN) with the WSMAN prefix must be added to the policy.</span></span> <span data-ttu-id="68dcd-132">Il nome SPN rappresenta il computer di destinazione a cui è possibile delegare le credenziali utente.</span><span class="sxs-lookup"><span data-stu-id="68dcd-132">The SPN represents the target computer to which the user credentials can be delegated.</span></span> <span data-ttu-id="68dcd-133">Il nome SPN può essere impostato su uno o più computer.</span><span class="sxs-lookup"><span data-stu-id="68dcd-133">The SPN can be set to one or more computers.</span></span> <span data-ttu-id="68dcd-134">Nella tabella seguente sono riportati alcuni esempi di formati validi per i nomi SPN.</span><span class="sxs-lookup"><span data-stu-id="68dcd-134">The following table contains examples of valid formats for SPNs.</span></span>

    

    | <span data-ttu-id="68dcd-135">SPN</span><span class="sxs-lookup"><span data-stu-id="68dcd-135">SPN</span></span>                                       | <span data-ttu-id="68dcd-136">Descrizione</span><span class="sxs-lookup"><span data-stu-id="68dcd-136">Description</span></span>                                                                         |
    |-------------------------------------------|-------------------------------------------------------------------------------------|
    | <span data-ttu-id="68dcd-137">WSMAN/nomecomputer. dominio. com</span><span class="sxs-lookup"><span data-stu-id="68dcd-137">WSMAN/myComputer.myDomain.com</span></span><br/>  | <span data-ttu-id="68dcd-138">Server WinRM in esecuzione in myComputer.myDomain.com.</span><span class="sxs-lookup"><span data-stu-id="68dcd-138">WinRM server running on myComputer.myDomain.com.</span></span><br/>                         |
    | <span data-ttu-id="68dcd-139">WSMAN/ \* . mydomain.com</span><span class="sxs-lookup"><span data-stu-id="68dcd-139">WSMAN/\*.myDomain.com</span></span><br/>          | <span data-ttu-id="68dcd-140">Tutti i server WinRM in esecuzione in myDomain.com.</span><span class="sxs-lookup"><span data-stu-id="68dcd-140">All WinRM servers running in myDomain.com.</span></span><br/>                               |
    | <span data-ttu-id="68dcd-141">WSMAN/ \* . fabrikam.mydomain.com</span><span class="sxs-lookup"><span data-stu-id="68dcd-141">WSMAN/\*.fabrikam.myDomain.com</span></span><br/> | <span data-ttu-id="68dcd-142">Tutti i server WinRM in esecuzione in su tutti i computer in. fabrikam.myDomain.com.</span><span class="sxs-lookup"><span data-stu-id="68dcd-142">All WinRM servers running in on all computers in .fabrikam.myDomain.com.</span></span><br/> |

    

     

    <span data-ttu-id="68dcd-143">Per ulteriori informazioni sull'impostazione dei criteri di gruppo, vedere [installazione e configurazione per gestione remota Windows](installation-and-configuration-for-windows-remote-management.md).</span><span class="sxs-lookup"><span data-stu-id="68dcd-143">For more information about setting Group Policies, see [Installation and Configuration for Windows Remote Management](installation-and-configuration-for-windows-remote-management.md).</span></span>

    <span data-ttu-id="68dcd-144">Per ulteriori informazioni sui criteri **AllowFreshCredentials** , vedere la descrizione dei criteri fornita dall'Editor criteri di gruppo e dalla [kb 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="68dcd-144">For more information about the **AllowFreshCredentials** policy, see the policy description provided by the Group Policy editor and [KB 951608](https://support.microsoft.com/kb/951608).</span></span> <span data-ttu-id="68dcd-145">Il criterio **AllowFreshCredentials** si trova nel percorso seguente: configurazione computer \\ modelli amministrativi la \\ delega delle credenziali di sistema \\ .</span><span class="sxs-lookup"><span data-stu-id="68dcd-145">The **AllowFreshCredentials** policy is located at the following path: Computer Configuration\\Administrative Templates\\System\\Credentials Delegation.</span></span>

4.  <span data-ttu-id="68dcd-146">Nel server deve essere configurato un [*listener*](windows-remote-management-glossary.md) HTTPS o http.</span><span class="sxs-lookup"><span data-stu-id="68dcd-146">An HTTPS or HTTP [*listener*](windows-remote-management-glossary.md) must be configured on the server.</span></span> <span data-ttu-id="68dcd-147">L'identificazione personale del certificato utilizzata per la configurazione del *listener* HTTPS viene inoltre utilizzata per configurare l'impostazione CertificateThumbprint nelle impostazioni del servizio gestione remota Windows.</span><span class="sxs-lookup"><span data-stu-id="68dcd-147">The certificate thumbprint used for configuring the HTTPS *listener* is also used to configure the CertificateThumbprint setting under the WinRM service settings.</span></span>

    <span data-ttu-id="68dcd-148">Il comando seguente illustra come usare l'utilità WinRM per configurare un [*listener*](windows-remote-management-glossary.md)https:</span><span class="sxs-lookup"><span data-stu-id="68dcd-148">The following command demonstrates how to use the winrm utility to configure an HTTPS [*listener*](windows-remote-management-glossary.md):</span></span>

    <span data-ttu-id="68dcd-149">**quickconfig WinRM-trasporto: https**</span><span class="sxs-lookup"><span data-stu-id="68dcd-149">**winrm quickconfig -transport:https**</span></span>

<span data-ttu-id="68dcd-150">Se l'autenticazione Kerberos tra il client e il server non è possibile, l'utente deve configurare una delle impostazioni seguenti per il supporto di più hop:</span><span class="sxs-lookup"><span data-stu-id="68dcd-150">If Kerberos authentication between the client and server is not possible, the user must configure one of the following settings for multi-hop support:</span></span>

-   <span data-ttu-id="68dcd-151">Per una maggiore sicurezza, l'utente deve aggiungere l'attributo **CertificateThumbprint** all'impostazione del servizio gestione remota Windows.</span><span class="sxs-lookup"><span data-stu-id="68dcd-151">For better security, the user should add the **CertificateThumbprint** attribute to the WinRM service setting.</span></span> <span data-ttu-id="68dcd-152">Se il servizio WinRM è configurato con un attributo **CertificateThumbprint** , il servizio tenterà di individuare il certificato corrispondente nell'archivio del computer locale e utilizzerà il certificato per l'autenticazione CredSSP.</span><span class="sxs-lookup"><span data-stu-id="68dcd-152">If the WinRM service is configured with a **CertificateThumbprint** attribute, the service attempts to locate the corresponding certificate in the Local Machine store and uses this certificate for the CredSSP authentication.</span></span> <span data-ttu-id="68dcd-153">Se il servizio WinRM utilizza un certificato dell'archivio del computer locale per autenticare il server, l'account del servizio di rete deve essere autorizzato ad accedere alla chiave privata del certificato.</span><span class="sxs-lookup"><span data-stu-id="68dcd-153">If the WinRM service uses a certificate from the Local Machine store to authenticate the server, the Network Service account must be allowed access to the private key of the certificate.</span></span>

    > [!Note]  
    > <span data-ttu-id="68dcd-154">Se l'impostazione del servizio non è configurata, il server WinRM utilizza un certificato autofirmato creato in memoria per crittografare i messaggi inviati al client.</span><span class="sxs-lookup"><span data-stu-id="68dcd-154">If the service setting is not configured, the WinRM server uses a self-signed certificate that is created in memory to encrypt messages sent to the client.</span></span> <span data-ttu-id="68dcd-155">Questo certificato, tuttavia, non viene utilizzato per l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="68dcd-155">However, this certificate is not used for authentication.</span></span>

     

-   <span data-ttu-id="68dcd-156">Se l'autenticazione Kerberos e le identificazioni personali del certificato non sono disponibili, l'utente può abilitare l'autenticazione NTLM.</span><span class="sxs-lookup"><span data-stu-id="68dcd-156">If neither Kerberos authentication nor certificate thumbprints are available, the user can enable NTLM authentication.</span></span> <span data-ttu-id="68dcd-157">Se viene utilizzata l'autenticazione NTLM, è necessario che il criterio Consenti credenziali aggiornate con autenticazione server solo NTLM (**AllowFreshCredentialsWhenNTLMOnly**) sia abilitato e che al criterio venga aggiunto un nome SPN con il prefisso WSMan.</span><span class="sxs-lookup"><span data-stu-id="68dcd-157">If NTLM authentication is used, the Allow Fresh Credentials with NTLM-only Server Authentication (**AllowFreshCredentialsWhenNTLMOnly**) policy must be enabled, and an SPN with the WSMAN prefix must be added to the policy.</span></span> <span data-ttu-id="68dcd-158">Questa impostazione è meno sicura dell'autenticazione Kerberos e delle identificazioni personali del certificato, perché le credenziali vengono inviate a un server non autenticato.</span><span class="sxs-lookup"><span data-stu-id="68dcd-158">This setting is less secure than both Kerberos authentication and certificate thumbprints, because credentials are sent to an unauthenticated server.</span></span>

    <span data-ttu-id="68dcd-159">Per ulteriori informazioni sui criteri **AllowFreshCredentialsWhenNTLMOnly** , vedere la descrizione dei criteri fornita dall'Editor criteri di gruppo e dalla [kb 951608](https://support.microsoft.com/kb/951608).</span><span class="sxs-lookup"><span data-stu-id="68dcd-159">For more information about the **AllowFreshCredentialsWhenNTLMOnly** policy, see the policy description provided by the Group Policy editor and [KB 951608](https://support.microsoft.com/kb/951608).</span></span> <span data-ttu-id="68dcd-160">Il criterio **AllowFreshCredentialsWhenNTLMOnly** si trova nel percorso seguente: configurazione computer \\ modelli amministrativi la \\ delega delle credenziali di sistema \\ .</span><span class="sxs-lookup"><span data-stu-id="68dcd-160">The **AllowFreshCredentialsWhenNTLMOnly** policy is located at the following path: Computer Configuration\\Administrative Templates\\System\\Credentials Delegation.</span></span>

## <a name="using-credssp-authentication-with-explicit-credentials"></a><span data-ttu-id="68dcd-161">Uso dell'autenticazione CredSSP con le credenziali esplicite</span><span class="sxs-lookup"><span data-stu-id="68dcd-161">Using CredSSP Authentication with Explicit Credentials</span></span>

<span data-ttu-id="68dcd-162">Un utente può specificare le credenziali esplicite sia per HTTP che per HTTPS.</span><span class="sxs-lookup"><span data-stu-id="68dcd-162">A user can specify explicit credentials over both HTTP and HTTPS.</span></span> <span data-ttu-id="68dcd-163">Il comando seguente illustra come usare l'utilità WinRM per eseguire un'operazione remota usando l'autenticazione CredSSP con le credenziali esplicite su HTTPS:</span><span class="sxs-lookup"><span data-stu-id="68dcd-163">The following command demonstrates how to use the winrm utility to perform a remote operation using CredSSP authentication with explicit credentials over HTTPS:</span></span>

<span data-ttu-id="68dcd-164">**OPERAZIONE WinRM-Remote: https://myMachine -Authentication: CredSSP-username: nome utente-password: password**</span><span class="sxs-lookup"><span data-stu-id="68dcd-164">**winrm OPERATION -remote:https://myMachine -authentication:CredSSP -username:myUsername -password:myPassword**</span></span>

 

