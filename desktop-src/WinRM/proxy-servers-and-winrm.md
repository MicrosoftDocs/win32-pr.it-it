---
title: Server proxy e WinRM
description: Gestione remota Windows (WinRM) Usa HTTP e HTTPS per inviare messaggi tra i computer client e server. In generale, il client WinRM invia messaggi direttamente al server WinRM. I client WinRM possono inoltre essere configurati per l'utilizzo di un server proxy.
ms.assetid: f8137b3a-7704-4b21-a923-6e2692e18d90
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e07bbfebb4c8f0eb9e77a8942d54677b55c60006
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "103727399"
---
# <a name="proxy-servers-and-winrm"></a><span data-ttu-id="4aa4d-105">Server proxy e WinRM</span><span class="sxs-lookup"><span data-stu-id="4aa4d-105">Proxy Servers and WinRM</span></span>

<span data-ttu-id="4aa4d-106">Gestione remota Windows (WinRM) Usa HTTP e HTTPS per inviare messaggi tra i computer client e server.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-106">Windows Remote Management (WinRM) uses HTTP and HTTPS to send messages between the client and server computers.</span></span> <span data-ttu-id="4aa4d-107">In generale, il client WinRM invia messaggi direttamente al server WinRM.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-107">In general, the WinRM client sends messages directly to the WinRM server.</span></span> <span data-ttu-id="4aa4d-108">I client WinRM possono inoltre essere configurati per l'utilizzo di un server proxy.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-108">WinRM clients can be also configured to use a proxy server.</span></span>

<span data-ttu-id="4aa4d-109">Per altre informazioni, vedere le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="4aa4d-109">For more information, see the following sections:</span></span>

-   [<span data-ttu-id="4aa4d-110">Configurazione di un server proxy per WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="4aa4d-110">Configuring a Proxy Server for WinRM 2.0</span></span>](#configuring-a-proxy-server-for-winrm-20)
    -   [<span data-ttu-id="4aa4d-111">Connessioni proxy basate su HTTPS</span><span class="sxs-lookup"><span data-stu-id="4aa4d-111">HTTPS-Based Proxy Connections</span></span>](#https-based-proxy-connections)
    -   [<span data-ttu-id="4aa4d-112">Connessioni proxy basate su HTTP</span><span class="sxs-lookup"><span data-stu-id="4aa4d-112">HTTP-Based Proxy Connections</span></span>](#http-based-proxy-connections)
-   [<span data-ttu-id="4aa4d-113">Configurazione di un server proxy per WinRM 1,1 e versioni precedenti</span><span class="sxs-lookup"><span data-stu-id="4aa4d-113">Configuring a Proxy Server for WinRM 1.1 and Earlier</span></span>](#configuring-a-proxy-server-for-winrm-11-and-earlier)

## <a name="configuring-a-proxy-server-for-winrm-20"></a><span data-ttu-id="4aa4d-114">Configurazione di un server proxy per WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="4aa4d-114">Configuring a Proxy Server for WinRM 2.0</span></span>

<span data-ttu-id="4aa4d-115">WinRM 2,0 supporta un'ampia gamma di configurazioni proxy.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-115">WinRM 2.0 supports a wide range of proxy configurations.</span></span> <span data-ttu-id="4aa4d-116">Ad esempio, WinRM supporta i proxy per i trasporti HTTP e HTTPS e per i server proxy autenticati e non autenticati.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-116">For example, WinRM supports proxies for HTTP and HTTPS transports and for authenticated and unauthenticated proxy servers.</span></span>

### <a name="https-based-proxy-connections"></a><span data-ttu-id="4aa4d-117">Connessioni proxy HTTPS-Based</span><span class="sxs-lookup"><span data-stu-id="4aa4d-117">HTTPS-Based Proxy Connections</span></span>

<span data-ttu-id="4aa4d-118">Per una migliore sicurezza e affinità basata sulla connessione, HTTPS deve essere utilizzato come meccanismo di trasporto.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-118">For better security and connection-based affinity, HTTPS should be used as the transport mechanism.</span></span>

<span data-ttu-id="4aa4d-119">Se il server proxy richiede l'autenticazione, è necessario che i client e i server WinRM usino HTTPS.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-119">If the proxy server requires authentication, the WinRM clients and servers must use HTTPS.</span></span>

> [!Note]  
> <span data-ttu-id="4aa4d-120">L'autenticazione per il server proxy è indipendente dall'autenticazione al server di destinazione.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-120">Authentication to the proxy server is independent from the authentication to the destination server.</span></span>

 

### <a name="http-based-proxy-connections"></a><span data-ttu-id="4aa4d-121">Connessioni proxy HTTP-Based</span><span class="sxs-lookup"><span data-stu-id="4aa4d-121">HTTP-Based Proxy Connections</span></span>

<span data-ttu-id="4aa4d-122">Se non è richiesta l'autenticazione del server proxy, è possibile usare HTTP o HTTPs per il trasporto.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-122">If no proxy server authentication is required, either HTTP or HTTPs can be used for transport.</span></span> <span data-ttu-id="4aa4d-123">Tuttavia, le connessioni basate su HTTP da un client WinRM a un server WinRM tramite un server proxy possono risultare problematiche.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-123">However, HTTP-based connections from a WinRM client to a WinRM server through a proxy server can be problematic.</span></span>

<span data-ttu-id="4aa4d-124">Quando si utilizzano connessioni basate su HTTP, potrebbero verificarsi i problemi seguenti:</span><span class="sxs-lookup"><span data-stu-id="4aa4d-124">The following issues might be encountered when using HTTP-based connections:</span></span>

-   <span data-ttu-id="4aa4d-125">Il server proxy non supporta l'autenticazione basata sulla connessione, che può impedire l'esecuzione dell'autenticazione nel server di destinazione con un errore di accesso negato.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-125">The proxy server does not support connection-based authentication, which can cause the authentication against the destination server to fail with an access denied error.</span></span>
-   <span data-ttu-id="4aa4d-126">Per la connessione al server di destinazione e al server proxy è necessario disporre di più di un set di credenziali.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-126">More than one set of credentials is needed to connect to the destination server and to the proxy server.</span></span>
-   <span data-ttu-id="4aa4d-127">I server proxy basati su HTTP potrebbero non supportare la capacità di gestire le connessioni basate su client e basate su server associate.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-127">HTTP-based proxy servers might not support the ability to maintain the associated client-based and server-based connections.</span></span> <span data-ttu-id="4aa4d-128">Se il proxy non collega fortemente un client a un server e mantiene la connessione TCP/IP, i client non autenticati potrebbero ottenere l'accesso ai dati.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-128">If the proxy does not strongly link a client to a server and maintain the TCP/IP connection, unauthenticated clients might gain access to data.</span></span> <span data-ttu-id="4aa4d-129">Inoltre, la mancanza di affinità di connessione potrebbe causare l'esito negativo dell'autenticazione sul server.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-129">Also, the lack of connection affinity might cause the authentication to fail against the server.</span></span>

<span data-ttu-id="4aa4d-130">Se è necessario utilizzare HTTP come trasporto, il server proxy deve supportare la configurazione seguente per ottenere una risposta WinRM migliore ed evitare errori di accesso negato per i client WinRM:</span><span class="sxs-lookup"><span data-stu-id="4aa4d-130">If HTTP must be used as the transport, the proxy server should support the following configuration to achieve a better WinRM response and to prevent access denied failures for WinRM clients:</span></span>

-   <span data-ttu-id="4aa4d-131">Supporto per HTTP/1.1.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-131">Support for HTTP/1.1.</span></span> <span data-ttu-id="4aa4d-132">HTTP/1.1 è più rigoroso nel mapping dell'affinità di connessione tra client e server.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-132">HTTP/1.1 is more stringent in mapping connection affinity between client and server.</span></span>
-   <span data-ttu-id="4aa4d-133">Autenticazione basata sulla connessione per l'autenticazione Negotiate, Kerberos e CredSSP.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-133">Connection-based authentication for Negotiate, Kerberos, and CredSSP authentication.</span></span>

    <span data-ttu-id="4aa4d-134">Per l'autenticazione di una richiesta sono necessari più round trip tra il client e il server.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-134">Authentication of a request requires multiple round-trips between the client and server.</span></span> <span data-ttu-id="4aa4d-135">La maggior parte della negoziazione per l'autenticazione è completa dopo che il server di autenticazione (WinRM) Invia una risposta al client che non è una risposta 401 (non autorizzato).</span><span class="sxs-lookup"><span data-stu-id="4aa4d-135">Most negotiation for authentication is complete after the authenticating (WinRM) server sends a response to the client that is not a 401 response (Unauthorized).</span></span> <span data-ttu-id="4aa4d-136">Se il server WinRM restituisce una risposta al client che non è una risposta 401, il proxy non deve chiudere la connessione.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-136">If the WinRM server returns a response to the client that is not a 401 response, the proxy should not close the connection.</span></span>

    <span data-ttu-id="4aa4d-137">È possibile inviare più coppie di richiesta/risposta tra il client e il server prima che vengano inviati i dati dei pacchetti effettivi.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-137">Multiple request/response pairs can be sent between client and server before the actual packet data is sent.</span></span> <span data-ttu-id="4aa4d-138">WinRM 2,0 utilizza gli schemi di autenticazione Negotiate e Kerberos con la crittografia, che può aggiungere round trip aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-138">WinRM 2.0 uses the Negotiate and Kerberos authentication schemes with encryption, which can add extra round-trips.</span></span> <span data-ttu-id="4aa4d-139">I dati non possono essere inviati al server fino al completamento dell'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-139">Data cannot be sent to the server until the authentication is complete.</span></span>

    <span data-ttu-id="4aa4d-140">Il server WinRM restituisce una risposta a livello di 200 che indica che l'autenticazione è stata completata.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-140">The WinRM server returns a 200-level response that indicates that the authentication is complete.</span></span> <span data-ttu-id="4aa4d-141">I server proxy basati su HTTP potrebbero terminare l'affinità di autenticazione basata sulla connessione e chiudere la connessione TCP/IP dopo aver ricevuto la risposta a livello di 200 dal server WinRM.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-141">HTTP-based proxy servers might end the connection-based authentication affinity and close the TCP/IP connection after receiving the 200-level response from the WinRM server.</span></span> <span data-ttu-id="4aa4d-142">Il round trip finale dal client al server non include il pacchetto di richiesta originale.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-142">The final round-trip from client to server does not include the original request packet.</span></span> <span data-ttu-id="4aa4d-143">Se il server proxy chiude la connessione, il server tenterà di eseguire di nuovo l'autenticazione del client e la richiesta client potrebbe non essere mai inviata al server.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-143">If the proxy server closes the connection, the server will attempt to re-authenticate the client and the client request might never be sent to the server.</span></span> <span data-ttu-id="4aa4d-144">Se l'affinità basata sulla connessione non viene mantenuta, l'autenticazione nel server di destinazione può avere esito negativo con un errore di accesso negato.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-144">If the connection-based affinity is not maintained, authentication against the destination server can fail with an access denied error.</span></span>

-   <span data-ttu-id="4aa4d-145">Persistenza della connessione.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-145">Connection persistence.</span></span> <span data-ttu-id="4aa4d-146">La connessione TCP/IP del client al proxy deve continuare a eseguire il mapping alla stessa connessione TCP/IP dal proxy al server.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-146">The client TCP/IP connection to the proxy should continue to map to the same TCP/IP connection from the proxy to the server.</span></span> <span data-ttu-id="4aa4d-147">La gestione di questa connessione consente di ottenere un livello di prestazioni superiore.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-147">Maintaining this connection helps to achieve a higher level of performance.</span></span> <span data-ttu-id="4aa4d-148">Se la connessione non viene mantenuta, è necessario ripetere l'autenticazione di ogni richiesta, che potrebbe influire sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-148">If the connection is not maintained, every request must be re-authenticated, which might affect performance.</span></span>

### <a name="encryption-and-winrm-20"></a><span data-ttu-id="4aa4d-149">Crittografia e WinRM 2,0</span><span class="sxs-lookup"><span data-stu-id="4aa4d-149">Encryption and WinRM 2.0</span></span>

<span data-ttu-id="4aa4d-150">WinRM 2,0 supporta la crittografia su HTTP tramite gli schemi di autenticazione Negotiate, Kerberos e CredSSP.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-150">WinRM 2.0 supports encryption over HTTP by using the Negotiate, Kerberos, and CredSSP authentication schemes.</span></span> <span data-ttu-id="4aa4d-151">Se un server WinRM supporta HTTP ed è accessibile tramite un proxy, il server WinRM deve applicare la crittografia e non consentire il traffico di rete non crittografato.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-151">If a WinRM server supports HTTP and is accessed through a proxy, the WinRM server must enforce encryption and not allow unencrypted network traffic.</span></span>

<span data-ttu-id="4aa4d-152">In nessuna circostanza, le richieste HTTP non crittografate devono essere inviate tramite server proxy.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-152">Under no circumstances should unencrypted HTTP requests be sent through proxy servers.</span></span> <span data-ttu-id="4aa4d-153">Quando i dati devono passare attraverso un server proxy prima di essere inviati al server di destinazione, sono molto importanti i seguenti problemi di sicurezza:</span><span class="sxs-lookup"><span data-stu-id="4aa4d-153">When data must pass through a proxy server before being sent to the destination server, the following security issues are very important:</span></span>

-   <span data-ttu-id="4aa4d-154">È possibile che un server proxy dannoso possa esaminare ogni coppia richiesta-risposta, incluse le credenziali.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-154">It is possible that a malicious proxy server could examine every request/response pair, including credentials.</span></span>
-   <span data-ttu-id="4aa4d-155">Se le connessioni TCP/IP non sono fortemente mappate tra il client WinRM e il server proxy e tra il server proxy e il server di destinazione, un client non autorizzato può connettersi al server di destinazione utilizzando la stessa connessione autenticata dal server proxy al server di destinazione.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-155">If the TCP/IP connections are not strongly mapped between both the WinRM client and the proxy server and between the proxy server and the destination server, an unauthorized client could connect to the destination server by using the same authenticated connection from the proxy server to the destination server.</span></span> <span data-ttu-id="4aa4d-156">Il server di destinazione potrebbe consentire al client non autenticato di accedere ai dati.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-156">The destination server might allow the unauthenticated client access to data.</span></span> <span data-ttu-id="4aa4d-157">Se la crittografia viene applicata, il server di destinazione Invia un messaggio di accesso negato al client non autenticato.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-157">If encryption is enforced, the destination server sends an access denied message to the unauthenticated client.</span></span>

<span data-ttu-id="4aa4d-158">L'uso della crittografia potrebbe attenuare questi potenziali problemi di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-158">Using encryption would mitigate these potential security issues.</span></span>

## <a name="configuring-a-proxy-server-for-winrm-11-and-earlier"></a><span data-ttu-id="4aa4d-159">Configurazione di un server proxy per WinRM 1,1 e versioni precedenti</span><span class="sxs-lookup"><span data-stu-id="4aa4d-159">Configuring a Proxy Server for WinRM 1.1 and Earlier</span></span>

<span data-ttu-id="4aa4d-160">Se è necessario un proxy per raggiungere il server WinRM, il client WinRM si affida alla configurazione proxy di servizi HTTP Windows (WinHTTP).</span><span class="sxs-lookup"><span data-stu-id="4aa4d-160">If a proxy is required to reach the WinRM server, the WinRM client relies on the Windows HTTP services (WinHTTP) proxy configuration.</span></span> <span data-ttu-id="4aa4d-161">Per impostazione predefinita, WinHTTP non è configurato per l'uso di un server proxy.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-161">By default, WinHTTP is not configured to use a proxy server.</span></span> <span data-ttu-id="4aa4d-162">È possibile modificare la configurazione del proxy WinHTTP utilizzando le utilità della riga di comando [ProxyCfg.exe](/previous-versions/windows/desktop/ms761351(v=vs.85)) o [netsh](/previous-versions/windows/it-pro/windows-server-2003/cc785383(v=ws.10)) .</span><span class="sxs-lookup"><span data-stu-id="4aa4d-162">WinHTTP proxy configuration can be changed by using the [ProxyCfg.exe](/previous-versions/windows/desktop/ms761351(v=vs.85)) or [netsh](/previous-versions/windows/it-pro/windows-server-2003/cc785383(v=ws.10)) command-line utilities.</span></span>

<span data-ttu-id="4aa4d-163">**WinRM 1,1 e versioni precedenti:** WinRM non utilizza le impostazioni proxy di Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="4aa4d-163">**WinRM 1.1 and Earlier:** WinRM does not use the Internet Explorer proxy settings.</span></span>

 

 