---
title: Interazione del punto di accesso e del protocollo di autenticazione durante l'autenticazione
description: La funzione RasEapMakeMessage controlla la maggior parte dell'interazione tra il protocollo di autenticazione e il punto di accesso (AP).
ms.assetid: edc128e0-3104-4df9-80f4-b2aebcfe1087
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0e486e3a10e323f28bc2f6fef4c131acfc095b48
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/19/2020
ms.locfileid: "104046584"
---
# <a name="access-point-and-authentication-protocol-interaction-during-authentication"></a><span data-ttu-id="b88a1-103">Interazione del punto di accesso e del protocollo di autenticazione durante l'autenticazione</span><span class="sxs-lookup"><span data-stu-id="b88a1-103">Access Point and Authentication Protocol Interaction During Authentication</span></span>

<span data-ttu-id="b88a1-104">La funzione [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) controlla la maggior parte dell'interazione tra il protocollo di autenticazione e il punto di accesso (AP).</span><span class="sxs-lookup"><span data-stu-id="b88a1-104">The [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) function controls the majority of the interaction between the authentication protocol and the Access Point (AP).</span></span> <span data-ttu-id="b88a1-105">**RasEapMakeMessage** elabora i pacchetti EAP in ingresso e crea pacchetti EAP per la trasmissione al peer remoto.</span><span class="sxs-lookup"><span data-stu-id="b88a1-105">**RasEapMakeMessage** processes incoming EAP packets and creates EAP packets for transmission to the remote peer.</span></span> <span data-ttu-id="b88a1-106">Elabora anche eventi quali i timeout e il completamento dell'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="b88a1-106">It also processes events such as time outs and authentication completion.</span></span>

<span data-ttu-id="b88a1-107">Se viene ricevuto un messaggio dal peer remoto, il servizio di autenticazione AP chiama [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), passando un puntatore al messaggio ricevuto nel parametro *pReceivePacket* .</span><span class="sxs-lookup"><span data-stu-id="b88a1-107">If a message is received from the remote peer, the AP authentication service calls [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), passing a pointer to the received message in the *pReceivePacket* parameter.</span></span>

<span data-ttu-id="b88a1-108">Se il servizio chiama [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) con *PReceivePacket* impostato su **null**, l'AP avvia la finestra di dialogo con il protocollo di autenticazione oppure richiede che il protocollo invii di nuovo l'ultimo pacchetto.</span><span class="sxs-lookup"><span data-stu-id="b88a1-108">If the service calls [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) with *pReceivePacket* set to **NULL**, the AP is either initiating the dialog with the authentication protocol, or requesting that the protocol resend the last packet.</span></span> <span data-ttu-id="b88a1-109">Il protocollo di autenticazione deve determinare quale azione sta prendendo il servizio in base al relativo stato e al contesto del messaggio.</span><span class="sxs-lookup"><span data-stu-id="b88a1-109">The authentication protocol should determine which action the service is taking based on its state and from the message context.</span></span>

<span data-ttu-id="b88a1-110">Al ritorno da [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), il valore del membro dell' **azione** della struttura [**di \_ \_ output EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) indica quale azione viene eseguita dal servizio di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="b88a1-110">On return from [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)), the value of the **Action** member of the [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) structure indicates what action, if any, the authentication service takes.</span></span> <span data-ttu-id="b88a1-111">Il membro dell' **azione** accetta valori dal tipo enumerato dell' [**\_ \_ azione EAP PPP**](/windows/desktop/api/Raseapif/ne-raseapif-ppp_eap_action) .</span><span class="sxs-lookup"><span data-stu-id="b88a1-111">The **Action** member takes values from the [**PPP\_EAP\_ACTION**](/windows/desktop/api/Raseapif/ne-raseapif-ppp_eap_action) enumerated type.</span></span>

<span data-ttu-id="b88a1-112">Se **Action** è **EAPACTION \_ Send**, **EAPACTION \_ SendAndDone**, **EAPACTION \_ SendWithTimeout** o **EAPACTION SendWithTimeoutInteractive \_**, il servizio trasmette il pacchetto a cui punta il parametro *pSendPacket* al peer remoto.</span><span class="sxs-lookup"><span data-stu-id="b88a1-112">If **Action** is **EAPACTION\_Send**, **EAPACTION\_SendAndDone**, **EAPACTION\_SendWithTimeout**, or **EAPACTION\_SendWithTimeoutInteractive**, the service transmits the packet that is pointed to by the *pSendPacket* parameter to the remote peer.</span></span>

<span data-ttu-id="b88a1-113">Il **valore \_ SendWithTimeout di EAPACTION** consente un timeout, dopo il quale il servizio di autenticazione presuppone che il collegamento sia stato perso e disconnette la sessione.</span><span class="sxs-lookup"><span data-stu-id="b88a1-113">The **EAPACTION\_SendWithTimeout** value allows for a time out, after which time the authentication service assumes the link was lost, and disconnects the session.</span></span>

<span data-ttu-id="b88a1-114">Il **valore \_ SendWithTimeoutInteractive di EAPACTION** consente di eseguire una quantità infinita di timeout.</span><span class="sxs-lookup"><span data-stu-id="b88a1-114">The **EAPACTION\_SendWithTimeoutInteractive** value allows an infinite amount of time out to occur.</span></span> <span data-ttu-id="b88a1-115">L'autenticatore deve usare questo valore quando prevede l'input dell'utente nel client.</span><span class="sxs-lookup"><span data-stu-id="b88a1-115">The authenticator should use this value when expecting user input on the client.</span></span> <span data-ttu-id="b88a1-116">Questo timeout consente all'utente un periodo di tempo non specificato per completare l'input richiesto.</span><span class="sxs-lookup"><span data-stu-id="b88a1-116">This time out allows the user an unspecified amount of time to complete the required input.</span></span>

<span data-ttu-id="b88a1-117">Se **Action** è **EAPACTION \_ SendWithTimeout** o **EAPACTION \_ SendWithTimeoutInteractive**, il protocollo di autenticazione deve impostare il membro **dwIdExpected** della struttura di [**\_ \_ output EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) sull'identificatore del pacchetto successivo previsto dal peer remoto.</span><span class="sxs-lookup"><span data-stu-id="b88a1-117">If **Action** is **EAPACTION\_SendWithTimeout** or **EAPACTION\_SendWithTimeoutInteractive**, the authentication protocol should set the **dwIdExpected** member of the [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) structure to the identifier of the next packet that is expected from the remote peer.</span></span> <span data-ttu-id="b88a1-118">Indipendentemente dal fatto che il pacchetto successivo ricevuto dal peer corrisponda a questo valore, il servizio di autenticazione passa il pacchetto al protocollo di autenticazione in una chiamata successiva a [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="b88a1-118">Regardless of whether the next packet received from the peer matches this value, the authentication service passes the packet to the authentication protocol in a subsequent call to [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)).</span></span> <span data-ttu-id="b88a1-119">Il protocollo di autenticazione può rimuovere automaticamente il pacchetto semplicemente restituendo **l' \_ errore \_ PPP \_ non valido**.</span><span class="sxs-lookup"><span data-stu-id="b88a1-119">The authentication protocol may silently discard the packet by simply returning **ERROR\_PPP\_INVALID\_PACKET**.</span></span> <span data-ttu-id="b88a1-120">Se un pacchetto con l'identificatore previsto non viene ricevuto entro il periodo di timeout configurato, il servizio di autenticazione chiama ancora **RasEapMakeMessage**.</span><span class="sxs-lookup"><span data-stu-id="b88a1-120">If a packet with the expected identifier is not received within the configured time-out period, the authentication service still calls **RasEapMakeMessage**.</span></span> <span data-ttu-id="b88a1-121">In questo caso, la chiamata viene eseguita con il parametro *pReceivePacket* impostato su **null**, per indicare che è necessario inviare nuovamente il pacchetto precedente.</span><span class="sxs-lookup"><span data-stu-id="b88a1-121">In this case, the call is made with the *pReceivePacket* parameter set to **NULL**, to indicate that the previous packet needs to be sent again.</span></span>

<span data-ttu-id="b88a1-122">Se il membro dell' **azione** è **EAPACTION \_ done** o **EAPACTION \_ SendAndDone**, il servizio di autenticazione esamina  il membro dwAuthResultCode [**dell' \_ \_ output EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span><span class="sxs-lookup"><span data-stu-id="b88a1-122">If the **Action** member is **EAPACTION\_Done** or **EAPACTION\_SendAndDone**, the authentication service examines the **dwAuthResultCode** member of [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span></span> <span data-ttu-id="b88a1-123">Se **dwAuthResultCode** non è un \_ errore, l'autenticazione ha avuto esito positivo.</span><span class="sxs-lookup"><span data-stu-id="b88a1-123">If **dwAuthResultCode** is NO\_ERROR, the authentication succeeded.</span></span> <span data-ttu-id="b88a1-124">Se **dwAuthResultCode** è un valore diverso da nessun \_ errore, l'autenticazione non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="b88a1-124">If **dwAuthResultCode** is a value other than NO\_ERROR, the authentication failed.</span></span> <span data-ttu-id="b88a1-125">Il codice di errore restituito per il caso di errore deve provenire da Raserror. h, Mprerror. h o Winerror. h.</span><span class="sxs-lookup"><span data-stu-id="b88a1-125">The error code returned for the failure case should come from Raserror.h, Mprerror.h, or Winerror.h.</span></span> <span data-ttu-id="b88a1-126">I codici restituiti possibili includono, ma non sono limitati a, quanto segue:</span><span class="sxs-lookup"><span data-stu-id="b88a1-126">Possible return codes include, but are not limited to, the following:</span></span>

-   <span data-ttu-id="b88a1-127">ERRORE \_ Nessuna \_ autorizzazione dialin \_</span><span class="sxs-lookup"><span data-stu-id="b88a1-127">ERROR\_NO\_DIALIN\_PERMISSION</span></span>
-   <span data-ttu-id="b88a1-128">ERRORE \_ passwd \_ scaduto</span><span class="sxs-lookup"><span data-stu-id="b88a1-128">ERROR\_PASSWD\_EXPIRED</span></span>
-   <span data-ttu-id="b88a1-129">ERRORE \_ Acct \_ disabilitato</span><span class="sxs-lookup"><span data-stu-id="b88a1-129">ERROR\_ACCT\_DISABLED</span></span>
-   <span data-ttu-id="b88a1-130">\_ore di \_ accesso con restrizioni errori \_</span><span class="sxs-lookup"><span data-stu-id="b88a1-130">ERROR\_RESTRICTED\_LOGON\_HOURS</span></span>
-   <span data-ttu-id="b88a1-131">ERRORE \_ \_ interno auth</span><span class="sxs-lookup"><span data-stu-id="b88a1-131">ERROR\_AUTH\_INTERNAL</span></span>

<span data-ttu-id="b88a1-132">Nel caso in cui **Action** sia **EAPACTION \_ done** o **EAPACTION \_ SendAndDone**, il membro **pUserAttributes** deve puntare agli attributi che eseguono l'override degli attributi dello stesso tipo passati al server nella chiamata a [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="b88a1-132">In the case where **Action** is **EAPACTION\_Done** or **EAPACTION\_SendAndDone**, the **pUserAttributes** member should point to attributes that override attributes of the same type that were passed to the server in the call to [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span></span>

<span data-ttu-id="b88a1-133">Il protocollo di autenticazione nel server può richiedere che il servizio di autenticazione richiami il provider di autenticazione corrente restituendo **EAPACTION \_ Authenticate** nel membro dell' **azione** nell' [**\_ \_ output EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span><span class="sxs-lookup"><span data-stu-id="b88a1-133">The authentication protocol on the server can request that the authentication service invoke the current authentication provider by returning **EAPACTION\_Authenticate** in the **Action** member in [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output).</span></span> <span data-ttu-id="b88a1-134">In questo caso, il puntatore **pUserAttributes** nell' **\_ \_ output EAP PPP** punta solo agli attributi generati dal protocollo di autenticazione nel server.</span><span class="sxs-lookup"><span data-stu-id="b88a1-134">In this case, the **pUserAttributes** pointer in **PPP\_EAP\_OUTPUT** points only to attributes that were generated by the authentication protocol on the server.</span></span> <span data-ttu-id="b88a1-135">Non include alcuno degli attributi passati al server nella chiamata a [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="b88a1-135">It does not include any of the attributes that were passed to the server in the call to [**RasEapBegin**](/previous-versions/windows/desktop/legacy/aa363520(v=vs.85)).</span></span> <span data-ttu-id="b88a1-136">Il provider di autenticazione non richiede questi attributi iniziali perché le credenziali di autenticazione si trovano all'interno del messaggio EAP stesso, non in un attributo RADIUS separato.</span><span class="sxs-lookup"><span data-stu-id="b88a1-136">The authentication provider does not require these initial attributes because the authentication credentials are inside the EAP message itself, not in a separate RADIUS attribute.</span></span> <span data-ttu-id="b88a1-137">Quando il servizio di autenticazione risponde all'azione di autenticazione **EAPACTION \_** , **PUserAttributes** nell' [**\_ \_ input EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input), punta a tutti gli attributi generati durante l'autenticazione.</span><span class="sxs-lookup"><span data-stu-id="b88a1-137">When the authentication service responds to the **EAPACTION\_Authenticate** action, **pUserAttributes** in [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input), points to all attributes generated during authentication.</span></span> <span data-ttu-id="b88a1-138">Questi attributi vengono restituiti al protocollo di autenticazione nel client.</span><span class="sxs-lookup"><span data-stu-id="b88a1-138">These attributes are returned to the authentication protocol on the client.</span></span>

<span data-ttu-id="b88a1-139">Se il protocollo di autenticazione usa **EAPACTION \_ Authenticate**, il provider di autenticazione esegue PAP o MD5-CHAP.</span><span class="sxs-lookup"><span data-stu-id="b88a1-139">If the authentication protocol uses **EAPACTION\_Authenticate**, the authentication provider performs either PAP or MD5-CHAP.</span></span> <span data-ttu-id="b88a1-140">Questo metodo di autenticazione può essere utilizzato solo con i client Windows.</span><span class="sxs-lookup"><span data-stu-id="b88a1-140">This authentication method can be used only with Windows clients.</span></span>

<span data-ttu-id="b88a1-141">Se il protocollo di autenticazione autentica l'utente senza basarsi su un provider di autenticazione, non è necessario che il protocollo imposti mai l' **azione** su **EAPACTION \_ Authenticate**.</span><span class="sxs-lookup"><span data-stu-id="b88a1-141">If the authentication protocol authenticates the user without relying on an authentication provider, there is no need for the protocol to ever set **Action** to **EAPACTION\_Authenticate**.</span></span> <span data-ttu-id="b88a1-142">Un esempio di questo caso è EAP-Transport Layer Security (TLS).</span><span class="sxs-lookup"><span data-stu-id="b88a1-142">An example of this case is EAP-Transport Layer Security (TLS).</span></span>

<span data-ttu-id="b88a1-143">Il pacchetto EAP Success è un pacchetto non riconosciuto.</span><span class="sxs-lookup"><span data-stu-id="b88a1-143">The EAP success packet is a non-acknowledged packet.</span></span> <span data-ttu-id="b88a1-144">Pertanto, può essere persa e non rinviata dal server.</span><span class="sxs-lookup"><span data-stu-id="b88a1-144">Therefore, it can be lost and not resent by the server.</span></span> <span data-ttu-id="b88a1-145">Se il servizio di autenticazione nel client riceve un pacchetto NCP (Network Control Protocol), il servizio di autenticazione sul lato server procede come se l'autenticazione avesse avuto esito positivo.</span><span class="sxs-lookup"><span data-stu-id="b88a1-145">If the authentication service on the client receives a Network Control Protocol (NCP) packet, the server-side authentication service proceeds as though the authentication was successful.</span></span> <span data-ttu-id="b88a1-146">Questo è dovuto al fatto che il server è stato spostato nella fase NCP di PPP.</span><span class="sxs-lookup"><span data-stu-id="b88a1-146">This is because the server has moved on to the NCP phase of PPP.</span></span> <span data-ttu-id="b88a1-147">Di conseguenza, il servizio di autenticazione chiama [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) con il membro **fSuccessPacketReceived** della struttura di [**\_ \_ input EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) impostato su **true**.</span><span class="sxs-lookup"><span data-stu-id="b88a1-147">Accordingly, the authentication service calls [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) with the **fSuccessPacketReceived** member of the [**PPP\_EAP\_INPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_input) structure set to **TRUE**.</span></span>

<span data-ttu-id="b88a1-148">Nel corso della sessione di autenticazione, il protocollo di autenticazione può richiedere l'interazione diretta con l'utente nel client.</span><span class="sxs-lookup"><span data-stu-id="b88a1-148">During the course of the authentication session, the authentication protocol may require interaction directly with the user on the client.</span></span> <span data-ttu-id="b88a1-149">Il fornitore del protocollo di autenticazione può fornire un'interfaccia utente interattiva a questo scopo.</span><span class="sxs-lookup"><span data-stu-id="b88a1-149">The authentication protocol vendor can provide an interactive user interface for this purpose.</span></span> <span data-ttu-id="b88a1-150">Il protocollo di autenticazione può richiedere che il servizio visualizzi l'interfaccia utente interattiva impostando i membri **fInvokeInteractiveUI**, **pUIContextData** e **dwSizeOfUIContextData** nella struttura di [**\_ \_ output EAP PPP**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) .</span><span class="sxs-lookup"><span data-stu-id="b88a1-150">The authentication protocol can request that the service display the interactive UI by setting the **fInvokeInteractiveUI**, **pUIContextData**, and **dwSizeOfUIContextData** members in the [**PPP\_EAP\_OUTPUT**](/windows/desktop/api/Raseapif/ns-raseapif-ppp_eap_output) structure.</span></span> <span data-ttu-id="b88a1-151">Per ulteriori informazioni sull'utilizzo di un'interfaccia utente interattiva, vedere [interfaccia utente interattiva](interactive-user-interface.md).</span><span class="sxs-lookup"><span data-stu-id="b88a1-151">For more information on using an interactive UI, see [Interactive User Interface](interactive-user-interface.md).</span></span>

<span data-ttu-id="b88a1-152">Il protocollo di autenticazione dovrebbe visualizzare un'interfaccia utente solo tramite il meccanismo descritto in [interfaccia utente interattiva](interactive-user-interface.md).</span><span class="sxs-lookup"><span data-stu-id="b88a1-152">The authentication protocol should display a user interface only through the mechanism described under [Interactive User Interface](interactive-user-interface.md).</span></span> <span data-ttu-id="b88a1-153">Se il protocollo di autenticazione Visualizza l'interfaccia utente, il thread PPP si blocca fino a quando l'interfaccia utente non viene rilasciata.</span><span class="sxs-lookup"><span data-stu-id="b88a1-153">If the authentication protocol itself displays the user interface, the PPP thread blocks until the user interface is dismissed.</span></span>

<span data-ttu-id="b88a1-154">Se durante il processo di autenticazione, [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) restituisce un valore diverso da un **\_ \_ \_ pacchetto non valido** per il PPP **\_ errore** o errore, la sessione viene disconnessa e l'errore viene registrato (sul server) o visualizzato all'utente (sul client).</span><span class="sxs-lookup"><span data-stu-id="b88a1-154">If during the authentication process, [**RasEapMakeMessage**](/previous-versions/windows/desktop/legacy/aa363532(v=vs.85)) returns any value other than **NO\_ERROR** or **ERROR\_PPP\_INVALID\_PACKET**, the session is disconnected and the error is logged (on the server) or displayed to the user (on the client).</span></span>

 

 