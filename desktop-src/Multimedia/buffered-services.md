---
title: Servizi memorizzati nel buffer
description: Servizi memorizzati nel buffer
ms.assetid: 4816ab05-42fc-4c22-b753-8fd153d88c27
keywords:
- I/O di file multimediali, servizi memorizzati nel buffer
- I/O di file, servizi memorizzati nel buffer
- input e output (I/O), servizi memorizzati nel buffer
- I/O (input e output), servizi memorizzati nel buffer
- I/O memorizzato nel buffer
- mmioOpen (funzione)
- buffer I/O interno
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d014ed765609dd43886cc7b33987f8fd5ac7e65a
ms.sourcegitcommit: 7ef31bf778e76ce4196205d4c4c632fbdc649805
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/05/2021
ms.locfileid: "103968799"
---
# <a name="buffered-services"></a><span data-ttu-id="27254-110">Servizi memorizzati nel buffer</span><span class="sxs-lookup"><span data-stu-id="27254-110">Buffered Services</span></span>

<span data-ttu-id="27254-111">La maggior parte del sovraccarico nell'I/O dei file si verifica quando si accede al dispositivo multimediale.</span><span class="sxs-lookup"><span data-stu-id="27254-111">Most of the overhead in file I/O occurs when accessing the media device.</span></span> <span data-ttu-id="27254-112">Se si stanno leggendo o scrivendo molti piccoli blocchi di informazioni, il dispositivo può dedicare molto tempo al passaggio alla posizione fisica sui supporti per ogni operazione di lettura o scrittura.</span><span class="sxs-lookup"><span data-stu-id="27254-112">If you are reading or writing many small blocks of information, the device can spend a lot of time moving to the physical location on the media for each read or write operation.</span></span> <span data-ttu-id="27254-113">In questo caso, è possibile ottenere prestazioni migliori usando I servizi di I/O dei file memorizzati nel buffer.</span><span class="sxs-lookup"><span data-stu-id="27254-113">In this case, you can achieve better performance by using buffered file I/O services.</span></span> <span data-ttu-id="27254-114">Con l'I/O memorizzato nel buffer, il gestore di I/O dei file mantiene un buffer intermedio maggiore dei blocchi di informazioni che vengono letti o scritti.</span><span class="sxs-lookup"><span data-stu-id="27254-114">With buffered I/O, the file I/O manager maintains an intermediate buffer larger than the blocks of information you are reading or writing.</span></span> <span data-ttu-id="27254-115">Accede al dispositivo solo quando il buffer deve essere compilato o scritto sul disco.</span><span class="sxs-lookup"><span data-stu-id="27254-115">It accesses the device only when the buffer must be filled from or written to the disk.</span></span>

<span data-ttu-id="27254-116">Prima di configurare e utilizzare l'I/O dei file memorizzati nel buffer, è necessario decidere se si desidera che l'applicazione o l'allocazione del buffer da parte di gestione i/O file.</span><span class="sxs-lookup"><span data-stu-id="27254-116">Before you set up and use buffered file I/O, you must decide whether you want the file I/O manager or the application to allocate the buffer.</span></span> <span data-ttu-id="27254-117">È più semplice consentire al gestore di I/O dei file di allocare il buffer.</span><span class="sxs-lookup"><span data-stu-id="27254-117">It is simpler to let the file I/O manager allocate the buffer.</span></span> <span data-ttu-id="27254-118">Tuttavia, è possibile consentire all'applicazione di allocare il buffer se si desidera accedere direttamente al buffer o aprire un file di memoria.</span><span class="sxs-lookup"><span data-stu-id="27254-118">However, you can let the application allocate the buffer if you want to directly access the buffer or open a memory file.</span></span> <span data-ttu-id="27254-119">Per ulteriori informazioni sull'utilizzo dei file di memoria, vedere [esecuzione di operazioni di i/O su file di memoria](performing-memory-file-i-o.md).</span><span class="sxs-lookup"><span data-stu-id="27254-119">For more information about using memory files, see [Performing Memory File I/O](performing-memory-file-i-o.md).</span></span> <span data-ttu-id="27254-120">Per un esempio di accesso diretto a un buffer di I/O, vedere [accesso a un buffer di i/o di file](accessing-a-file-i-o-buffer.md)</span><span class="sxs-lookup"><span data-stu-id="27254-120">For an example of directly accessing an I/O buffer, see [Accessing a File I/O Buffer](accessing-a-file-i-o-buffer.md)</span></span>

<span data-ttu-id="27254-121">Un buffer allocato dal gestore di I/O dei file è denominato buffer di I/O interno.</span><span class="sxs-lookup"><span data-stu-id="27254-121">A buffer allocated by the file I/O manager is called an internal I/O buffer.</span></span> <span data-ttu-id="27254-122">Per aprire un file per l'I/O memorizzato nel buffer usando un buffer interno, specificare il \_ flag MMIO ALLOCBUF quando si apre il file con la funzione [**mmioOpen**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioopen) .</span><span class="sxs-lookup"><span data-stu-id="27254-122">To open a file for buffered I/O using an internal buffer, specify the MMIO\_ALLOCBUF flag when you open the file with the [**mmioOpen**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioopen) function.</span></span> <span data-ttu-id="27254-123">Nella figura seguente viene illustrato lo stato iniziale del buffer di I/O dei file dopo l'apertura di un file per un'operazione di lettura memorizzata nel buffer.</span><span class="sxs-lookup"><span data-stu-id="27254-123">The following illustration shows the initial state of the file I/O buffer after a file is opened for a buffered read operation.</span></span> <span data-ttu-id="27254-124">Il buffering è trasparente: è possibile leggere e cercare come se si stesse usando l'I/O non memorizzato nel buffer.</span><span class="sxs-lookup"><span data-stu-id="27254-124">The buffering is transparent — you read and seek as if you were using unbuffered I/O.</span></span> <span data-ttu-id="27254-125">La funzione **mmioOpen** ha impostato PchNext e *pchEndRead* in modo che punti all'inizio del buffer di i/O del file.</span><span class="sxs-lookup"><span data-stu-id="27254-125">The **mmioOpen** function has set pchNext and *pchEndRead* to point to the beginning of the file I/O buffer.</span></span>

![Screenshot che mostra "pchEndRead" e "pchNext" che punta all'inizio del buffer di I/O del file.](images/mmio7.gif)

<span data-ttu-id="27254-127">Nella figura seguente viene illustrato lo stato iniziale del buffer di I/O dei file dopo l'apertura di un file per un'operazione di scrittura nel buffer.</span><span class="sxs-lookup"><span data-stu-id="27254-127">The following illustration shows the initial state of the file I/O buffer after a file is opened for a buffered write operation.</span></span> <span data-ttu-id="27254-128">La funzione **mmioOpen** ha impostato **pchNext** in modo che punti all'inizio del buffer di i/O dei file e **pchEndWrite** per puntare alla fine del buffer.</span><span class="sxs-lookup"><span data-stu-id="27254-128">The **mmioOpen** function has set **pchNext** to point to the beginning of the file I/O buffer and **pchEndWrite** to point to the end of the buffer.</span></span>

![Screenshot che mostra ' pchNext ' all'inizio del buffer di I/O dei file è pchEndWrite ' alla fine.](images/mmio11.gif)

<span data-ttu-id="27254-130">Le dimensioni predefinite del buffer di I/O interno sono pari a 8 KB.</span><span class="sxs-lookup"><span data-stu-id="27254-130">The default size of the internal I/O buffer is 8K.</span></span> <span data-ttu-id="27254-131">Se questa dimensione non è adeguata, è possibile usare la funzione [**mmioSetBuffer**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiosetbuffer) per modificare la dimensione del buffer.</span><span class="sxs-lookup"><span data-stu-id="27254-131">If this size is not adequate, you can use the [**mmioSetBuffer**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiosetbuffer) function to change the buffer size.</span></span> <span data-ttu-id="27254-132">È anche possibile usare questa funzione per abilitare il buffering su un file aperto per I/O senza buffer o per fornire un buffer personalizzato da usare come file di memoria.</span><span class="sxs-lookup"><span data-stu-id="27254-132">You can also use this function to enable buffering on a file opened for unbuffered I/O, or to supply your own buffer for use as a memory file.</span></span>

<span data-ttu-id="27254-133">È possibile forzare la scrittura su disco del contenuto di un buffer di I/O tramite la funzione [**mmioFlush**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioflush) .</span><span class="sxs-lookup"><span data-stu-id="27254-133">You can force the contents of an I/O buffer to be written to disk by using the [**mmioFlush**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioflush) function.</span></span> <span data-ttu-id="27254-134">Tuttavia, quando si chiude un file usando la funzione [**mmioClose**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioclose) , non è necessario chiamare **mmioFlush** per scaricare un buffer di I/O, la funzione **mmioClose** lo scarica automaticamente.</span><span class="sxs-lookup"><span data-stu-id="27254-134">However, when you close a file by using the [**mmioClose**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioclose) function, you do not have to call **mmioFlush** to flush an I/O buffer — the **mmioClose** function automatically flushes it.</span></span> <span data-ttu-id="27254-135">Se lo spazio su disco è esaurito, **mmioFlush** potrebbe avere esito negativo, anche se le chiamate precedenti alla funzione [**mmioWrite**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiowrite) sono state completate.</span><span class="sxs-lookup"><span data-stu-id="27254-135">If you run out of disk space, **mmioFlush** could fail, even if the preceding calls to the [**mmioWrite**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiowrite) function were successful.</span></span> <span data-ttu-id="27254-136">Analogamente, **mmioClose** potrebbe non riuscire a eseguire lo scaricamento del buffer di i/O.</span><span class="sxs-lookup"><span data-stu-id="27254-136">Similarly, **mmioClose** could fail when it is flushing its I/O buffer.</span></span>

<span data-ttu-id="27254-137">Le applicazioni che sono sensibili alle prestazioni, ad esempio quelle che inviano dati in tempo reale da un CD-ROM, possono ottimizzare le prestazioni di I/O dei file accedendo direttamente al buffer di I/O.</span><span class="sxs-lookup"><span data-stu-id="27254-137">Applications that are performance-sensitive, such as those that stream data in real time from a CD-ROM, can optimize file I/O performance by directly accessing the I/O buffer.</span></span> <span data-ttu-id="27254-138">È necessario prestare attenzione se si sceglie di eseguire questa operazione, perché si ignorano alcune delle misure di sicurezza e il controllo degli errori forniti dal gestore di I/O file.</span><span class="sxs-lookup"><span data-stu-id="27254-138">You should be careful if you choose to do this, because you bypass some of the safeguards and error checking provided by the file I/O manager.</span></span>

<span data-ttu-id="27254-139">Il gestore di I/O dei file multimediali usa la struttura [**MMIOINFO**](/previous-versions//dd757322(v=vs.85)) per mantenere le informazioni sullo stato di un file aperto.</span><span class="sxs-lookup"><span data-stu-id="27254-139">The multimedia file I/O manager uses the [**MMIOINFO**](/previous-versions//dd757322(v=vs.85)) structure to maintain state information about an open file.</span></span> <span data-ttu-id="27254-140">Si utilizzano tre membri in questa struttura per leggere e scrivere il buffer di I/O: **pchNext**, **pchEndRead** e **pchEndWrite**.</span><span class="sxs-lookup"><span data-stu-id="27254-140">You use three members in this structure to read and write the I/O buffer: **pchNext**, **pchEndRead**, and **pchEndWrite**.</span></span> <span data-ttu-id="27254-141">Il membro **pchNext** punta alla posizione successiva nel buffer per la lettura o la scrittura.</span><span class="sxs-lookup"><span data-stu-id="27254-141">The **pchNext** member points to the next location in the buffer to read or write.</span></span> <span data-ttu-id="27254-142">È necessario incrementare questo membro durante la lettura e la scrittura del buffer.</span><span class="sxs-lookup"><span data-stu-id="27254-142">You must increment this member as you read and write the buffer.</span></span> <span data-ttu-id="27254-143">Il membro **pchEndRead** identifica l'ultimo carattere valido che è possibile leggere dal buffer.</span><span class="sxs-lookup"><span data-stu-id="27254-143">The **pchEndRead** member identifies the last valid character you can read from the buffer.</span></span> <span data-ttu-id="27254-144">Analogamente, questo membro identifica l'ultima posizione nel buffer che è possibile scrivere.</span><span class="sxs-lookup"><span data-stu-id="27254-144">Likewise, this member identifies the last location in the buffer you can write.</span></span> <span data-ttu-id="27254-145">Più precisamente, **pchEndRead** e **pchEndWrite** puntano alla posizione di memoria che segue gli ultimi dati validi nel buffer.</span><span class="sxs-lookup"><span data-stu-id="27254-145">More precisely, both **pchEndRead** and **pchEndWrite** point to the memory location that follows the last valid data in the buffer.</span></span> <span data-ttu-id="27254-146">Usare le funzioni [**mmioGetInfo**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiogetinfo) e [**mmioSetInfo**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiosetinfo) per recuperare e impostare le informazioni sullo stato relative al buffer di i/O dei file.</span><span class="sxs-lookup"><span data-stu-id="27254-146">Use the [**mmioGetInfo**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiogetinfo) and [**mmioSetInfo**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmiosetinfo) functions to retrieve and set state information about the file I/O buffer.</span></span> <span data-ttu-id="27254-147">Nella figura seguente viene illustrato lo stato del buffer di I/O dopo che l'applicazione chiama **mmioAdvance** durante un'operazione di lettura.</span><span class="sxs-lookup"><span data-stu-id="27254-147">The following illustration shows the state of the I/O buffer after the application calls **mmioAdvance** during a read operation.</span></span> <span data-ttu-id="27254-148">La funzione **mmioAdvance** riempie il buffer e imposta il puntatore **pchEndRead** alla fine del buffer.</span><span class="sxs-lookup"><span data-stu-id="27254-148">The **mmioAdvance** function fills the buffer and sets the **pchEndRead** pointer to the end of the buffer.</span></span>

![Screenshot che mostra ' pchNext ' all'inizio del buffer di I/O dei file è pchEndRead ' alla fine.](images/mmio8.gif)

<span data-ttu-id="27254-150">Nella figura seguente l'applicazione legge dal buffer di I/O nella posizione specificata da **pchNext** e fa avanzare il puntatore.</span><span class="sxs-lookup"><span data-stu-id="27254-150">In the following illustration, the application reads from the I/O buffer at the location specified by **pchNext**, and advances the pointer.</span></span>

![Screenshot che mostra ' pchNext ' al centro del buffer di I/O dei file è pchEndRead ' alla fine.](images/mmio9.gif)

<span data-ttu-id="27254-152">Analogamente, per un'operazione di scrittura, l'applicazione scrive nel buffer di I/O e sposta in avanti il puntatore **pchNext** , come illustrato nella figura seguente.</span><span class="sxs-lookup"><span data-stu-id="27254-152">Similarly, for a write operation, the application writes to the I/O buffer and advances the **pchNext** pointer, as shown in the following illustration.</span></span>

![Screenshot che mostra ' pchNext ' al centro del buffer di I/O dei file è pchEndWrite ' alla fine.](images/mmio12.gif)

<span data-ttu-id="27254-154">Dopo che l'applicazione riempie il buffer, chiama **mmioAdvance** per svuotare il buffer su disco.</span><span class="sxs-lookup"><span data-stu-id="27254-154">After the application fills the buffer, it calls **mmioAdvance** to flush the buffer to disk.</span></span> <span data-ttu-id="27254-155">La funzione **mmioAdvance** Reimposta **pchNext** in modo che punti all'inizio del buffer, come illustrato nella figura seguente.</span><span class="sxs-lookup"><span data-stu-id="27254-155">The **mmioAdvance** function resets **pchNext** to point to the beginning of the buffer, as shown in the following illustration.</span></span>

![Screenshot che mostra ' pchNext ' all'inizio del buffer di I/O dei file, il buffer al centro di E O F è pchEndWrite ' alla fine del buffer.](images/mmio13.gif)

<span data-ttu-id="27254-157">Quando si raggiunge la fine del buffer di I/O, è necessario far avanzare il buffer per riempirlo dal disco, se si sta leggendo o scaricarlo sul disco, se si sta scrivendo.</span><span class="sxs-lookup"><span data-stu-id="27254-157">When you reach the end of the I/O buffer, you must advance the buffer to fill it from the disk, if you are reading, or flush it to the disk, if you are writing.</span></span> <span data-ttu-id="27254-158">Utilizzare la funzione [**mmioAdvance**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioadvance) per avanzare un buffer di I/O.</span><span class="sxs-lookup"><span data-stu-id="27254-158">Use the [**mmioAdvance**](/windows/win32/api/mmiscapi/nf-mmiscapi-mmioadvance) function to advance an I/O buffer.</span></span> <span data-ttu-id="27254-159">Per riempire un buffer di I/O dal disco, usare **mmioAdvance** con il \_ flag di lettura MMIO.</span><span class="sxs-lookup"><span data-stu-id="27254-159">To fill an I/O buffer from disk, use **mmioAdvance** with the MMIO\_READ flag.</span></span> <span data-ttu-id="27254-160">Se il file non contiene dati sufficienti per riempire il buffer, il membro **pchEndRead** della struttura **MMIOINFO** punta alla posizione successiva all'ultimo byte valido nel buffer.</span><span class="sxs-lookup"><span data-stu-id="27254-160">If there is not enough data remaining in the file to fill the buffer, the **pchEndRead** member of the **MMIOINFO** structure points to the location following the last valid byte in the buffer.</span></span> <span data-ttu-id="27254-161">Per svuotare un buffer su disco, impostare il \_ flag MMIO Dirty nel membro **dwFlags** della struttura **MMIOINFO** e quindi chiamare **mmioAdvance** con il flag MMIO \_ Write.</span><span class="sxs-lookup"><span data-stu-id="27254-161">To flush a buffer to disk, set the MMIO\_DIRTY flag in the **dwFlags** member of the **MMIOINFO** structure and then call **mmioAdvance** with the MMIO\_WRITE flag.</span></span>

<span data-ttu-id="27254-162">Durante un'operazione di lettura, ad esempio, la funzione **mmioAdvance** imposta **pchEndRead** in modo che punti alla fine dei dati validi nel buffer, come illustrato nella figura seguente.</span><span class="sxs-lookup"><span data-stu-id="27254-162">For example, during a read operation, the **mmioAdvance** function sets **pchEndRead** to point to the end of valid data in the buffer, as shown in the following illustration.</span></span>

![Screenshot che mostra ' pchNext ' all'inizio del buffer di I/O dei file, il buffer alla fine di E O F è pchEndRead ' alla fine del buffer.](images/mmio10.gif)

<span data-ttu-id="27254-164">Analogamente, durante un'operazione di scrittura, l'applicazione chiama **mmioAdvance** per svuotare il buffer e avanzare **pchNext** alla fine dei dati validi nel buffer, come illustrato nella figura seguente.</span><span class="sxs-lookup"><span data-stu-id="27254-164">Similarly, during a write operation, the application calls **mmioAdvance** to flush the buffer and advance **pchNext** to the end of valid data in the buffer, as shown in the following illustration.</span></span>

![immagine del buffer di i/o dei file](images/mmio14.gif)

 

 