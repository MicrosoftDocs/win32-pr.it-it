---
title: Istanze di driver
description: Istanze di driver
ms.assetid: 93dba9e8-bfb3-4714-9466-cf5c78babcf2
keywords:
- driver installabili, istanze
- driver installabili, più istanze
- più istanze di driver
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 37148dcb12fbfa2984d4e55424102b5985165d9d
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/16/2019
ms.locfileid: "103709589"
---
# <a name="driver-instances"></a><span data-ttu-id="21f4f-106">Istanze di driver</span><span class="sxs-lookup"><span data-stu-id="21f4f-106">Driver Instances</span></span>

<span data-ttu-id="21f4f-107">Windows consente di eseguire più istanze di un driver installabile.</span><span class="sxs-lookup"><span data-stu-id="21f4f-107">Windows allows for multiples instances of an installable driver.</span></span> <span data-ttu-id="21f4f-108">Il sistema crea un'istanza del driver ogni volta che il driver viene aperto ed Elimina l'istanza quando il driver viene chiuso.</span><span class="sxs-lookup"><span data-stu-id="21f4f-108">The system creates an instance of the driver each time the driver is opened and destroys the instance when the driver is closed.</span></span> <span data-ttu-id="21f4f-109">Le istanze del driver sono particolarmente utili per i driver installabili che supportano più dispositivi o aperti da più applicazioni o dalla stessa applicazione più volte.</span><span class="sxs-lookup"><span data-stu-id="21f4f-109">Driver instances are especially useful for installable drivers that support multiple devices or that are opened by multiple applications or by the same application multiple times.</span></span>

<span data-ttu-id="21f4f-110">Per consentire al driver di tenere traccia delle istanze, il sistema invia un handle di istanza di driver con ogni messaggio di driver dopo la creazione dell'istanza.</span><span class="sxs-lookup"><span data-stu-id="21f4f-110">To help the driver keep track of the instances, the system sends a driver instance handle with each driver message after the instance has been created.</span></span> <span data-ttu-id="21f4f-111">Poiché questo handle identifica in modo univoco l'istanza, i driver installabili spesso associano l'handle alla memoria e ad altre risorse allocate in modo specifico per l'istanza.</span><span class="sxs-lookup"><span data-stu-id="21f4f-111">Because this handle uniquely identifies the instance, installable drivers often associate the handle with memory and other resources that they have specifically allocated for the instance.</span></span>

<span data-ttu-id="21f4f-112">Quando viene aperta la prima istanza, il sistema invia al driver i messaggi di [**\_ caricamento DRV**](drv-load.md), [**\_ Abilita DRV**](drv-enable.md)e [**drv \_**](drv-open.md) , in questo ordine.</span><span class="sxs-lookup"><span data-stu-id="21f4f-112">When the first instance is opened, the system sends the [**DRV\_LOAD**](drv-load.md), [**DRV\_ENABLE**](drv-enable.md), and [**DRV\_OPEN**](drv-open.md) messages to the driver in that order.</span></span> <span data-ttu-id="21f4f-113">I \_ messaggi di attivazione DRV Load e DRV \_ segnalano al driver che è ora in memoria ed è abilitata per l'operazione.</span><span class="sxs-lookup"><span data-stu-id="21f4f-113">The DRV\_LOAD and DRV\_ENABLE messages notify the driver that it is now in memory and is enabled for operation.</span></span> <span data-ttu-id="21f4f-114">Il \_ messaggio aperto DRV identifica l'handle dell'istanza e può includere informazioni di configurazione per l'istanza.</span><span class="sxs-lookup"><span data-stu-id="21f4f-114">The DRV\_OPEN message identifies the instance handle and may include configuration information for the instance.</span></span> <span data-ttu-id="21f4f-115">A ogni apertura successiva di un'istanza dello stesso driver, il sistema invia solo un messaggio di \_ apertura DRV.</span><span class="sxs-lookup"><span data-stu-id="21f4f-115">On each subsequent opening of an instance of the same driver, the system sends only a DRV\_OPEN message.</span></span>

<span data-ttu-id="21f4f-116">Quando si elabora un \_ messaggio di caricamento DRV, un driver legge in genere le impostazioni di configurazione dal registro di sistema, configura il driver e qualsiasi hardware associato e alloca memoria per l'utilizzo da parte di tutte le istanze del driver.</span><span class="sxs-lookup"><span data-stu-id="21f4f-116">When processing a DRV\_LOAD message, a driver typically reads configuration settings from the registry, configures the driver and any associated hardware, and allocates memory for use by all instances of the driver.</span></span> <span data-ttu-id="21f4f-117">Se un driver non è in grado di completare la configurazione o di allocare memoria, restituisce zero per indicare al sistema di rimuovere immediatamente il driver dalla memoria e impedire l'invio di messaggi successivi.</span><span class="sxs-lookup"><span data-stu-id="21f4f-117">If a driver cannot complete the configuration or allocate memory, it returns zero to direct the system to immediately remove the driver from memory and prevent any subsequent messages from being sent.</span></span> <span data-ttu-id="21f4f-118">Quando si elabora il \_ messaggio di abilitazione DRV, il driver prepara l'hardware per la ricezione e l'elaborazione delle richieste di input e output (I/O).</span><span class="sxs-lookup"><span data-stu-id="21f4f-118">When processing the DRV\_ENABLE message, the driver prepares the hardware to receive and process input and output (I/O) requests.</span></span> <span data-ttu-id="21f4f-119">La preparazione può includere l'installazione di gestori di interrupt.</span><span class="sxs-lookup"><span data-stu-id="21f4f-119">The preparation may include installing interrupt handlers.</span></span>

<span data-ttu-id="21f4f-120">Quando si elabora il \_ messaggio aperto DRV, il driver alloca memoria o risorse richieste dall'istanza specificata del driver e quindi restituisce un valore diverso da zero.</span><span class="sxs-lookup"><span data-stu-id="21f4f-120">When processing the DRV\_OPEN message, the driver allocates memory or resources required by the given instance of the driver and then returns a nonzero value.</span></span> <span data-ttu-id="21f4f-121">Il sistema utilizza questo valore diverso da zero come *identificatore del driver* nei messaggi di driver successivi per l'istanza.</span><span class="sxs-lookup"><span data-stu-id="21f4f-121">The system uses this nonzero value as the *driver identifier* in subsequent driver messages for the instance.</span></span> <span data-ttu-id="21f4f-122">Il driver può utilizzare questo identificatore per qualsiasi scopo.</span><span class="sxs-lookup"><span data-stu-id="21f4f-122">The driver can use this identifier for any purpose.</span></span> <span data-ttu-id="21f4f-123">Alcuni driver, ad esempio, utilizzano un handle di memoria per l'identificatore per ottenere accesso rapido alla memoria contenente le informazioni sull'istanza specificata.</span><span class="sxs-lookup"><span data-stu-id="21f4f-123">For example, some drivers use a memory handle for the identifier to gain quick access to memory containing information about the given instance.</span></span>

<span data-ttu-id="21f4f-124">Molti driver installabili elaborano il secondo parametro del \_ messaggio di apertura DRV, fornendo al sistema e alle applicazioni il mezzo per inviare informazioni aggiuntive al driver all'apertura di un'istanza.</span><span class="sxs-lookup"><span data-stu-id="21f4f-124">Many installable drivers process the second parameter of the DRV\_OPEN message, giving the system and applications the means to send additional information to the driver when opening an instance.</span></span> <span data-ttu-id="21f4f-125">Il parametro può essere un singolo valore o un indirizzo di una struttura che contiene un set di valori.</span><span class="sxs-lookup"><span data-stu-id="21f4f-125">The parameter can be a single value or an address of a structure containing a set of values.</span></span> <span data-ttu-id="21f4f-126">Quando si elabora DRV \_ aperto, il driver controlla il parametro per determinare se è un valore e utilizza i valori specificati, se presenti, per completare la creazione dell'istanza.</span><span class="sxs-lookup"><span data-stu-id="21f4f-126">When processing DRV\_OPEN, the driver checks the parameter to determine whether it is a value and uses the given values, if any, to complete the creation of the instance.</span></span>

<span data-ttu-id="21f4f-127">Il sistema invia un messaggio di [**\_ chiusura DRV**](drv-close.md) ogni volta che un'istanza viene chiusa.</span><span class="sxs-lookup"><span data-stu-id="21f4f-127">The system sends a [**DRV\_CLOSE**](drv-close.md) message each time an instance is closed.</span></span> <span data-ttu-id="21f4f-128">L'handle dell'istanza inviato con il messaggio identifica l'istanza da chiudere.</span><span class="sxs-lookup"><span data-stu-id="21f4f-128">The instance handle sent with the message identifies which instance to close.</span></span> <span data-ttu-id="21f4f-129">Quando viene chiusa l'ultima istanza rimanente, il sistema invia i \_ messaggi DRV Close, [**drv \_ Disable**](drv-disable.md)e [**drv \_ disponibili**](drv-free.md) nell'ordine specificato.</span><span class="sxs-lookup"><span data-stu-id="21f4f-129">When the last remaining instance is closed, the system sends the DRV\_CLOSE, [**DRV\_DISABLE**](drv-disable.md), and [**DRV\_FREE**](drv-free.md) messages in that order.</span></span> <span data-ttu-id="21f4f-130">Il \_ messaggio di chiusura di DRV indica al driver di chiudere l'istanza di e i \_ messaggi di disabilitazione e di DRV non sono in grado di \_ notificare al driver che è ora disabilitato e che verranno immediatamente liberati dalla memoria.</span><span class="sxs-lookup"><span data-stu-id="21f4f-130">The DRV\_CLOSE message directs the driver to close the instance, and the DRV\_DISABLE and DRV\_FREE messages notify the driver that it is now disabled and will be immediately freed from memory.</span></span>

<span data-ttu-id="21f4f-131">Quando si elabora il \_ messaggio di chiusura DRV, il driver libera in genere qualsiasi memoria o risorsa allocata per l'istanza.</span><span class="sxs-lookup"><span data-stu-id="21f4f-131">When processing the DRV\_CLOSE message, the driver typically frees any memory or resources allocated for the instance.</span></span> <span data-ttu-id="21f4f-132">Quando si elabora il \_ messaggio di disabilitazione DRV, il driver posiziona qualsiasi hardware in uno stato inattivo, che può includere la rimozione dei gestori di interrupt.</span><span class="sxs-lookup"><span data-stu-id="21f4f-132">When processing the DRV\_DISABLE message, the driver places any hardware in an inactive state, which may include the removal of interrupt handlers.</span></span> <span data-ttu-id="21f4f-133">Quando si elabora il \_ messaggio privo di DRV, il driver libera la memoria o le risorse ancora allocate.</span><span class="sxs-lookup"><span data-stu-id="21f4f-133">When processing the DRV\_FREE message, the driver frees any memory or resources that are still allocated.</span></span>

<span data-ttu-id="21f4f-134">I driver installabili non sono necessari per supportare più istanze.</span><span class="sxs-lookup"><span data-stu-id="21f4f-134">Installable drivers are not required to support multiple instances.</span></span> <span data-ttu-id="21f4f-135">Un driver può impedire la creazione di un'istanza restituendo zero per il [**messaggio \_ aperto DRV**](drv-open.md) .</span><span class="sxs-lookup"><span data-stu-id="21f4f-135">A driver can prevent any instance from being created by returning zero for the [**DRV\_OPEN**](drv-open.md) message.</span></span>

 

 




