---
description: È possibile utilizzare le funzioni del registro di sistema per raccogliere dati sulle prestazioni.
ms.assetid: feac7b8d-1dee-462c-89dc-bec1ba045da2
title: Utilizzo delle funzioni del registro di sistema per utilizzare i dati del contatore
ms.topic: article
ms.date: 08/17/2020
ms.openlocfilehash: ce2a4ba9992510cb296b037cfd98965410c48939
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106312074"
---
# <a name="using-the-registry-functions-to-consume-counter-data"></a><span data-ttu-id="ab5dc-103">Utilizzo delle funzioni del registro di sistema per utilizzare i dati del contatore</span><span class="sxs-lookup"><span data-stu-id="ab5dc-103">Using the Registry Functions to Consume Counter Data</span></span>

<span data-ttu-id="ab5dc-104">Utilizzare le [funzioni del registro](/windows/desktop/SysInfo/registry-functions) di sistema per raccogliere dati sulle prestazioni dalla `HKEY_PERFORMANCE_DATA` chiave del registro di sistema speciale.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-104">Use the [registry functions](/windows/desktop/SysInfo/registry-functions) to collect performance data from the special `HKEY_PERFORMANCE_DATA` registry key.</span></span>

<span data-ttu-id="ab5dc-105">I dati sulle prestazioni non vengono effettivamente archiviati nel registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-105">Performance data is not actually stored in the registry.</span></span> <span data-ttu-id="ab5dc-106">Chiamando le funzioni del registro di sistema, il sistema raccoglie i dati dal provider di dati prestazioni appropriato.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-106">Calling the registry functions causes the system to collect the data from the appropriate performance data provider.</span></span>

> [!Note]
> <span data-ttu-id="ab5dc-107">Le funzioni del registro di sistema non devono essere utilizzate normalmente per utilizzare i dati del contatore.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-107">You should not normally use the registry functions to consume counter data.</span></span> <span data-ttu-id="ab5dc-108">È invece consigliabile [utilizzare le funzioni PDH (Performance Data Helper)](using-the-pdh-functions-to-consume-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="ab5dc-108">Instead, you should [use the Performance Data Helper (PDH) functions](using-the-pdh-functions-to-consume-counter-data.md).</span></span> <span data-ttu-id="ab5dc-109">Le funzioni PDH sono più facili da usare ed evitano molti problemi di prestazioni e affidabilità che possono verificarsi tramite l'uso errato delle funzioni del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-109">The PDH functions are easier to use and avoid many performance and reliability problems that can occur through incorrect use of the registry functions.</span></span>

> [!Note]
> <span data-ttu-id="ab5dc-110">Non è possibile usare le funzioni del registro di sistema se si scrivono app OneCore di Windows.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-110">You cannot use the registry functions if you are writing Windows OneCore apps.</span></span> <span data-ttu-id="ab5dc-111">Usare invece le [funzioni consumer Perflib V2](using-the-perflib-functions-to-consume-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="ab5dc-111">Instead, use [PerfLib V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md).</span></span>

<span data-ttu-id="ab5dc-112">Le funzioni del registro di sistema sono l'API di basso livello per la raccolta dei dati dai **provider v1**.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-112">The registry functions are the low-level API for collecting data from **V1 providers**.</span></span> <span data-ttu-id="ab5dc-113">Le funzioni del registro di sistema supportano anche la raccolta dei dati dai **provider v2** tramite un livello di conversione che chiama le [funzioni consumer V2](using-the-perflib-functions-to-consume-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="ab5dc-113">The registry functions also support collecting data from **V2 providers** via a translation layer that calls into the [V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md).</span></span>

<span data-ttu-id="ab5dc-114">Per ottenere i dati sulle prestazioni dal sistema locale, chiamare la funzione [**RegQueryValueEx**](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) .</span><span class="sxs-lookup"><span data-stu-id="ab5dc-114">To obtain performance data from the local system, call the [**RegQueryValueEx**](/windows/win32/api/winreg/nf-winreg-regqueryvalueexw) function.</span></span> <span data-ttu-id="ab5dc-115">Utilizzare `HKEY_PERFORMANCE_DATA` come chiave.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-115">Use `HKEY_PERFORMANCE_DATA` as the key.</span></span> <span data-ttu-id="ab5dc-116">La prima chiamata apre la chiave.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-116">The first call opens the key.</span></span> <span data-ttu-id="ab5dc-117">Non è necessario aprire prima la chiave in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-117">You do not need to explicitly open the key first.</span></span>

<span data-ttu-id="ab5dc-118">Per ottenere dati sulle prestazioni da un sistema remoto, chiamare la funzione [**RegConnectRegistry**](/windows/desktop/api/winreg/nf-winreg-regconnectregistryw) .</span><span class="sxs-lookup"><span data-stu-id="ab5dc-118">To obtain performance data from a remote system, call the [**RegConnectRegistry**](/windows/desktop/api/winreg/nf-winreg-regconnectregistryw) function.</span></span> <span data-ttu-id="ab5dc-119">Usare il nome computer del sistema remoto e usare `HKEY_PERFORMANCE_DATA` come chiave.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-119">Use the computer name of the remote system and use `HKEY_PERFORMANCE_DATA` as the key.</span></span> <span data-ttu-id="ab5dc-120">Questa chiamata recupera una chiave che rappresenta i dati sulle prestazioni per il sistema remoto.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-120">This call retrieves a key representing the performance data for the remote system.</span></span> <span data-ttu-id="ab5dc-121">Usare questa chiave invece di `HKEY_PERFORMANCE_DATA` Key per recuperare i dati.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-121">Use this key rather than `HKEY_PERFORMANCE_DATA` key to retrieve the data.</span></span>

<span data-ttu-id="ab5dc-122">Assicurarsi di usare la funzione [**RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey) per chiudere l'handle alla chiave al termine del recupero dei dati sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-122">Be sure to use the [**RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey) function to close the handle to the key when you are finished obtaining the performance data.</span></span> <span data-ttu-id="ab5dc-123">Questo è importante per i casi locali e remoti:</span><span class="sxs-lookup"><span data-stu-id="ab5dc-123">This is important for both the local and remote cases:</span></span>

- <span data-ttu-id="ab5dc-124">`RegCloseKey(HKEY_PERFORMANCE_DATA)` non chiude effettivamente un handle del registro di sistema, ma cancella tutti i dati memorizzati nella cache e libera le DLL delle prestazioni caricate.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-124">`RegCloseKey(HKEY_PERFORMANCE_DATA)` does not actually close a registry handle, but it clears all cached data and frees the loaded performance DLLs.</span></span>
- <span data-ttu-id="ab5dc-125">`RegCloseKey(hkeyRemotePerformanceData)` chiude l'handle al registro di sistema del computer remoto.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-125">`RegCloseKey(hkeyRemotePerformanceData)` closes the handle to the remote machine's registry.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ab5dc-126">Non chiamare `RegCloseKey(HKEY_PERFORMANCE_DATA)` durante `DLL_PROCESS_DETACH` .</span><span class="sxs-lookup"><span data-stu-id="ab5dc-126">Do not call `RegCloseKey(HKEY_PERFORMANCE_DATA)` during `DLL_PROCESS_DETACH`.</span></span>

<span data-ttu-id="ab5dc-127">Usare il `lpValueName` parametro della funzione [**RegQueryValueEx**](/windows/desktop/api/winreg/nf-winreg-regqueryvalueexa) per indicare le informazioni da recuperare.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-127">You use the `lpValueName` parameter of the [**RegQueryValueEx**](/windows/desktop/api/winreg/nf-winreg-regqueryvalueexa) function to indicate the information to retrieve.</span></span> <span data-ttu-id="ab5dc-128">Nella tabella seguente sono elencati i valori che è possibile specificare per `lpValueName` .</span><span class="sxs-lookup"><span data-stu-id="ab5dc-128">The following table lists the values you can specify for `lpValueName`.</span></span> <span data-ttu-id="ab5dc-129">Si noti che le stringhe di valore non fanno distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-129">Note that the value strings are not case-sensitive.</span></span>

|<span data-ttu-id="ab5dc-130">Valore</span><span class="sxs-lookup"><span data-stu-id="ab5dc-130">Value</span></span>|<span data-ttu-id="ab5dc-131">Descrizione</span><span class="sxs-lookup"><span data-stu-id="ab5dc-131">Description</span></span>
|-----|-----------
|`Global`| <span data-ttu-id="ab5dc-132">Recupera i dati sulle prestazioni per tutti gli oggetti prestazioni registrati nel computer, ad eccezione di quelli inclusi nella `Costly` categoria.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-132">Retrieves performance data for all performance objects registered on the computer except for those included in the `Costly` category.</span></span>
|`OLD_Global`| <span data-ttu-id="ab5dc-133">**Windows Vista e versioni successive:** Recupera i dati sulle prestazioni per tutti gli oggetti prestazioni **V1** registrati nel computer, ad eccezione di quelli inclusi nella `Costly` categoria.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-133">**Windows Vista and later:** Retrieves performance data for all **V1** performance objects registered on the computer except for those included in the `Costly` category.</span></span> <span data-ttu-id="ab5dc-134">Usare questo valore anziché `Global` per evitare di raccogliere dati del provider v2 superflui quando si è certi che i dati di interesse provengono da un provider v1.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-134">Use this instead of `Global` to avoid collecting unnecessary V2 provider data when you know that the data of interest comes from a V1 provider.</span></span>
|`n1 n2 ...`| <span data-ttu-id="ab5dc-135">Recupera i dati sulle prestazioni per uno o più oggetti prestazione.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-135">Retrieves performance data for one or more performance objects.</span></span> <span data-ttu-id="ab5dc-136">Specificare l'indice decimale associato a ogni oggetto che si desidera recuperare in un elenco separato da spazi.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-136">Specify the decimal index associated with each object that you want to retrieve in a space-separated list.</span></span> <span data-ttu-id="ab5dc-137">Se ad esempio si desidera recuperare gli oggetti di sistema e di memoria e si è determinato che gli indici delle stringhe dei nomi corrispondenti sono 2 e 4, specificare la stringa `"2 4"` .</span><span class="sxs-lookup"><span data-stu-id="ab5dc-137">For example, if you want to retrieve System and Memory objects and you have determined that the indexes of the corresponding name strings are 2 and 4, specify the string `"2 4"`.</span></span> <span data-ttu-id="ab5dc-138">Si noti che la query può restituire un numero di oggetti diverso da quello richiesto.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-138">Note that the query can return a different number of objects than you requested.</span></span> <span data-ttu-id="ab5dc-139">Questo problema può verificarsi se l'oggetto specificato non è disponibile, se l'oggetto specificato dipende da un altro tipo di oggetto o se un provider restituisce dati non direttamente richiesti.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-139">This can happen if the specified object is unavailable, if the specified object depends on another object type, or if a provider otherwise returns data that was not directly requested.</span></span> <span data-ttu-id="ab5dc-140">Ad esempio, i thread dipendono dai processi, pertanto se si richiedono dati dall' `Thread` oggetto, i risultati includeranno i dati dell' `Process` oggetto.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-140">For example, threads depend on processes, so if you request data from the `Thread` object, the results will include data from the `Process` object.</span></span>
|`Counter n`| <span data-ttu-id="ab5dc-141">Recupera le stringhe di nome per l'identificatore di lingua specificato, ad esempio l'inglese per `Counter 9` .</span><span class="sxs-lookup"><span data-stu-id="ab5dc-141">Retrieves name strings for the specified language identifier, e.g. English for `Counter 9`.</span></span> <span data-ttu-id="ab5dc-142">Utilizzare le stringhe nome restituite per trovare l'indice corrispondente a un determinato nome o per trovare il nome corrispondente a un indice specificato.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-142">Use the returned name strings to find the index corresponding to a given name or to find the name corresponding to a given index.</span></span> <span data-ttu-id="ab5dc-143">Per informazioni dettagliate, vedere [recupero dei nomi dei contatori e del testo della Guida](retrieving-counter-names-and-help-text.md) .</span><span class="sxs-lookup"><span data-stu-id="ab5dc-143">See [Retrieving Counter Names and Help Text](retrieving-counter-names-and-help-text.md) for details.</span></span> <span data-ttu-id="ab5dc-144">Si noti che nell'elenco restituito sono inclusi sia i nomi di oggetto (contatore) che i nomi dei contatori, non esiste un modo semplice per determinare se un nome è un nome di oggetto o un nome di contatore.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-144">Note that the returned list includes both object (counterset) names and counter names -- there is no simple way to determine whether a name is an object name or a counter name.</span></span>
|`Help n`| <span data-ttu-id="ab5dc-145">Recupera le stringhe della Guida per l'identificatore di lingua specificato, ad esempio l'inglese per `Help 9` .</span><span class="sxs-lookup"><span data-stu-id="ab5dc-145">Retrieves help strings for the specified language identifier, e.g. English for `Help 9`.</span></span> <span data-ttu-id="ab5dc-146">Utilizzare le stringhe della Guida restituite per trovare le descrizioni corrispondenti agli indici dell'oggetto (contatore) o della guida del contatore.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-146">Use the returned help strings to find descriptions corresponding to object (counterset) or counter help indexes.</span></span> <span data-ttu-id="ab5dc-147">Per informazioni dettagliate, vedere [recupero dei nomi dei contatori e del testo della Guida](retrieving-counter-names-and-help-text.md) .</span><span class="sxs-lookup"><span data-stu-id="ab5dc-147">See [Retrieving Counter Names and Help Text](retrieving-counter-names-and-help-text.md) for details.</span></span>
|`Costly`| <span data-ttu-id="ab5dc-148">**Deprecato:** Recupera i dati sulle prestazioni per i tipi di oggetto i cui dati sono costosi da raccogliere in termini di tempo del processore o utilizzo della memoria.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-148">**Deprecated:** Retrieves performance data for object types whose data is expensive to collect in terms of processor time or memory usage.</span></span> <span data-ttu-id="ab5dc-149">Questa raccolta può richiedere alcuni minuti in un computer molto caricato.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-149">This collection may take several minutes on a heavily-loaded machine.</span></span> <span data-ttu-id="ab5dc-150">È consigliabile eseguire la raccolta in un thread di lavoro se l'applicazione deve rispondere all'utente durante la raccolta dei dati.</span><span class="sxs-lookup"><span data-stu-id="ab5dc-150">You should perform the collection on a worker thread if your application needs to respond to the user during this data collection.</span></span>

<span data-ttu-id="ab5dc-151">Per informazioni dettagliate sul formato dei dati sulle prestazioni restituiti dal registro di sistema, vedere [formato dei dati sulle prestazioni](performance-data-format.md).</span><span class="sxs-lookup"><span data-stu-id="ab5dc-151">For details on the format of the performance data that the registry returns, see [Performance Data Format](performance-data-format.md).</span></span>

<span data-ttu-id="ab5dc-152">Per un esempio in cui vengono ottenuti i nomi e le descrizioni dei contatori registrati nel computer, vedere [recupero di nomi di contatori e testo della Guida](retrieving-counter-names-and-help-text.md).</span><span class="sxs-lookup"><span data-stu-id="ab5dc-152">For an example that gets the names and descriptions of the registered counters on the computer, see [Retrieving Counter Names and Help Text](retrieving-counter-names-and-help-text.md).</span></span>

<span data-ttu-id="ab5dc-153">Per un esempio di accesso ai componenti dei dati sulle prestazioni, vedere [visualizzazione di nomi di oggetti, istanze e contatori](displaying-object-instance-and-counter-names.md).</span><span class="sxs-lookup"><span data-stu-id="ab5dc-153">For an example that accesses the components of the performance data, see [Displaying Object, Instance, and Counter Names](displaying-object-instance-and-counter-names.md).</span></span>

<span data-ttu-id="ab5dc-154">Per un esempio in cui vengono recuperati, calcolati e stampati i valori dei contatori, vedere [recupero di dati del contatore](retrieving-counter-data.md) e calcolo dei valori dei [contatori](calculating-counter-values.md).</span><span class="sxs-lookup"><span data-stu-id="ab5dc-154">For an example that retrieves, computes, and prints counter values, see [Retrieving Counter Data](retrieving-counter-data.md) and [Calculating Counter Values](calculating-counter-values.md).</span></span>
