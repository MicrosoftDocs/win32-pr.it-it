---
description: Per creare una nuova query che raccoglie i dati sulle prestazioni da un file di origine o di log in tempo reale, chiamare la funzione PdhOpenQuery. La funzione restituisce un handle per la query usata nelle chiamate di funzione PDH successive.
ms.assetid: 6fd4716e-b163-47a3-b0cb-5f9599f8681f
title: Creazione di una query
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5a9d50ec52966529a3476a6d375606ba3d0b538b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104131682"
---
# <a name="creating-a-query"></a><span data-ttu-id="f7c7e-104">Creazione di una query</span><span class="sxs-lookup"><span data-stu-id="f7c7e-104">Creating a Query</span></span>

<span data-ttu-id="f7c7e-105">Per creare una nuova query che raccoglie i dati sulle prestazioni da un file di origine o di log in tempo reale, chiamare la funzione [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) .</span><span class="sxs-lookup"><span data-stu-id="f7c7e-105">To create a new query that collects performance data from a real-time source or log file, call the [**PdhOpenQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhopenquerya) function.</span></span> <span data-ttu-id="f7c7e-106">La funzione restituisce un handle per la query usata nelle chiamate di funzione PDH successive.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-106">The function returns a handle to the query that you use in subsequent PDH function calls.</span></span>

<span data-ttu-id="f7c7e-107">Dopo aver creato la query, chiamare la funzione [**chiamata PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) per ogni contatore che si desidera aggiungere alla query.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-107">After creating the query, call the [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) function for each counter that you want to add to the query.</span></span> <span data-ttu-id="f7c7e-108">Per specificare il percorso completo del contatore, è possibile utilizzare uno dei metodi seguenti.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-108">You can use one of the following methods to provide the fully qualified counter path.</span></span>

-   <span data-ttu-id="f7c7e-109">Definire il percorso del contatore come stringa statica.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-109">Define the counter path as a static string.</span></span> <span data-ttu-id="f7c7e-110">Utilizzare questo metodo se si monitora sempre lo stesso contatore e se si ha familiarità con la sintassi corretta di un percorso del contatore.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-110">Use this method if you always monitor the same counter, and if you are familiar with the correct syntax of a counter path.</span></span> <span data-ttu-id="f7c7e-111">Per informazioni sulla sintassi corretta utilizzata per specificare un contatore, vedere [specifica di un percorso del contatore](specifying-a-counter-path.md).</span><span class="sxs-lookup"><span data-stu-id="f7c7e-111">For information on the correct syntax used to specify a counter, see [Specifying a Counter Path](specifying-a-counter-path.md).</span></span>
-   <span data-ttu-id="f7c7e-112">Inizializzare una struttura [**\_ \_ \_ degli elementi del percorso del contatore PDH**](/windows/desktop/api/Pdh/ns-pdh-pdh_counter_path_elements_a) con i nomi di computer, oggetto, contatore e istanza.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-112">Initialize a [**PDH\_COUNTER\_PATH\_ELEMENTS**](/windows/desktop/api/Pdh/ns-pdh-pdh_counter_path_elements_a) structure with the names of the computer, object, counter, and instance.</span></span> <span data-ttu-id="f7c7e-113">Passare questa struttura a [**PdhMakeCounterPath**](/windows/desktop/api/Pdh/nf-pdh-pdhmakecounterpatha) che restituirà un percorso del contatore per gli elementi specificati.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-113">Pass this structure to [**PdhMakeCounterPath**](/windows/desktop/api/Pdh/nf-pdh-pdhmakecounterpatha) which will return a counter path for the specified elements.</span></span>
-   <span data-ttu-id="f7c7e-114">Specificare un percorso del contatore che contenga caratteri jolly e chiamare [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) per ottenere un elenco dei nomi dei contatori che corrispondono ai caratteri jolly nel percorso.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-114">Specify a counter path that contains wildcard characters and call [**PdhExpandWildCardPath**](/windows/desktop/api/Pdh/nf-pdh-pdhexpandwildcardpatha) to get a list of counter names that match the wildcard characters in the path.</span></span> <span data-ttu-id="f7c7e-115">Analizzare l'elenco dei nomi dei contatori e aggiungere alla query i contatori desiderati da questo elenco.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-115">Scan through the list of counter names and add to the query the counters that you want from this list.</span></span>
-   <span data-ttu-id="f7c7e-116">Chiamare la funzione [**PdhBrowseCounters**](/windows/desktop/api/Pdh/nf-pdh-pdhbrowsecountersa) per visualizzare una finestra di dialogo che consente all'utente di esplorare e selezionare i contatori delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-116">Call the [**PdhBrowseCounters**](/windows/desktop/api/Pdh/nf-pdh-pdhbrowsecountersa) function to display a dialog box that lets the user browse and select performance counters.</span></span> <span data-ttu-id="f7c7e-117">Per ulteriori informazioni, vedere l' [esplorazione dei contatori](browsing-counters.md).</span><span class="sxs-lookup"><span data-stu-id="f7c7e-117">For more information, see [Browsing Counters](browsing-counters.md).</span></span>

<span data-ttu-id="f7c7e-118">Si noti che se si specifica un'istanza del contatore che non esiste, [**chiamata PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) non segnala una condizione di errore.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-118">Note that if a counter instance is specified that does not exist, [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) does not report an error condition.</span></span> <span data-ttu-id="f7c7e-119">Viene invece restituito ERROR \_ Success.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-119">Instead, it returns ERROR\_SUCCESS.</span></span> <span data-ttu-id="f7c7e-120">Il motivo di questo comportamento è che non è noto se è stata specificata un'istanza del contatore inesistente o se ne esiste una che non è ancora stata creata.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-120">The reason for this behavior is that it is not known if a nonexistent counter instance has been specified or one that will exist but has not yet been created.</span></span>

<span data-ttu-id="f7c7e-121">L'istanza del contatore mancante verrà segnalata da [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata), [**PdhGetRawCounterValue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetrawcountervalue)o [**PdhGetFormattedCounterValue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetformattedcountervalue).</span><span class="sxs-lookup"><span data-stu-id="f7c7e-121">The missing counter instance will be reported by either [**PdhCollectQueryData**](/windows/desktop/api/Pdh/nf-pdh-pdhcollectquerydata), [**PdhGetRawCounterValue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetrawcountervalue), or [**PdhGetFormattedCounterValue**](/windows/desktop/api/Pdh/nf-pdh-pdhgetformattedcountervalue).</span></span> <span data-ttu-id="f7c7e-122">Quando si chiama **PdhCollectQueryData** solo per un'istanza del contatore e l'istanza del contatore non esiste ancora, si presuppone che l'istanza del contatore non esista e che la funzione restituisca PDH \_ senza \_ dati.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-122">When calling **PdhCollectQueryData** for one counter instance only, and the counter instance still does not exist, it is assumed that the counter instance will not exist and the function returns PDH\_NO\_DATA.</span></span> <span data-ttu-id="f7c7e-123">Tuttavia, se viene eseguita una query su più di un contatore, **PdhCollectQueryData** può comunque restituire l'errore con \_ esito positivo anche se una delle istanze del contatore non esiste ancora.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-123">However, if more than one counter is queried, **PdhCollectQueryData** may still return ERROR\_SUCCESS even if one of the counter instances does not yet exist.</span></span> <span data-ttu-id="f7c7e-124">In questo caso, chiamare **PdhGetRawCounterValue** o **PdhGetFormattedCounterValue** per ognuna delle istanze del contatore di interesse.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-124">In this case, call **PdhGetRawCounterValue** or **PdhGetFormattedCounterValue** for each of the counter instances of interest.</span></span> <span data-ttu-id="f7c7e-125">Se l'istanza non esiste quando si chiama **PdhGetRawCounterValue**, la funzione restituisce Error \_ Success e imposta il membro **CStatus** del [**\_ \_ contatore PDH RAW**](/windows/desktop/api/Pdh/ns-pdh-pdh_raw_counter) \_ sullo stato PDH \_ Nessuna \_ istanza.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-125">If the instance does not exist when calling **PdhGetRawCounterValue**, the function returns ERROR\_SUCCESS and sets the **CStatus** member of [**PDH\_RAW\_COUNTER**](/windows/desktop/api/Pdh/ns-pdh-pdh_raw_counter) to PDH\_STATUS\_NO\_INSTANCE.</span></span> <span data-ttu-id="f7c7e-126">Se l'istanza non esiste quando si chiama **PdhGetFormattedCounterValue**, la funzione restituisce \_ dati non validi PDH \_ e imposta il membro **CStatus** di [**PDH \_ FMT \_ COUNTERVALUE**](/windows/desktop/api/Pdh/ns-pdh-pdh_fmt_countervalue) su PDH \_ CStatus \_ Nessuna \_ istanza.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-126">If the instance does not exist when calling **PdhGetFormattedCounterValue**, the function returns PDH\_INVALID\_DATA and sets the **CStatus** member of the [**PDH\_FMT\_COUNTERVALUE**](/windows/desktop/api/Pdh/ns-pdh-pdh_fmt_countervalue) to PDH\_CSTATUS\_NO\_INSTANCE.</span></span>

<span data-ttu-id="f7c7e-127">Si noti che è necessario localizzare il percorso del contatore specificato nella funzione [**chiamata PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) .</span><span class="sxs-lookup"><span data-stu-id="f7c7e-127">Note that the counter path specified in the [**PdhAddCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddcountera) function must be localized.</span></span> <span data-ttu-id="f7c7e-128">La funzione [**PdhAddEnglishCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddenglishcountera) fornisce una modalità indipendente dalle impostazioni locali per aggiungere i contatori delle prestazioni alla query.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-128">The [**PdhAddEnglishCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhaddenglishcountera) function provides a locale-neutral way to add performance counters to the query.</span></span> <span data-ttu-id="f7c7e-129">Questa funzione è la modalità consigliata per aggiungere contatori indipendenti dalle impostazioni locali a una query.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-129">This function is the recommended way to add locale-neutral counters to a query.</span></span>

<span data-ttu-id="f7c7e-130">Per rimuovere un contatore da una query, chiamare la funzione [**PdhRemoveCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhremovecounter) .</span><span class="sxs-lookup"><span data-stu-id="f7c7e-130">To remove a counter from a query, call the [**PdhRemoveCounter**](/windows/desktop/api/Pdh/nf-pdh-pdhremovecounter) function.</span></span>

<span data-ttu-id="f7c7e-131">Al termine della raccolta dei dati per una query, chiamare la funzione [**PdhCloseQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) per chiudere la query e rilasciare tutte le risorse di sistema allocate.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-131">After you finish collecting data for a query, call the [**PdhCloseQuery**](/windows/desktop/api/Pdh/nf-pdh-pdhclosequery) function to close the query and release all allocated system resources.</span></span> <span data-ttu-id="f7c7e-132">**PdhCloseQuery** chiude tutti gli handle di contatore associati alla query.</span><span class="sxs-lookup"><span data-stu-id="f7c7e-132">**PdhCloseQuery** closes all counter handles associated with the query.</span></span>

 

 



