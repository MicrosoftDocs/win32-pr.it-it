---
description: I contatori vengono utilizzati per fornire informazioni sulle prestazioni del sistema operativo o di un'applicazione, un servizio o un driver.
ms.assetid: d172a131-61d3-4fc1-8e0c-b07b2bd34f80
title: Informazioni sui contatori delle prestazioni
ms.topic: article
ms.date: 08/17/2020
ms.openlocfilehash: dec7c71e99ab614ee64e3d1e8c9620f0be78c14a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103881781"
---
# <a name="about-performance-counters"></a><span data-ttu-id="f8c58-103">Informazioni sui contatori delle prestazioni</span><span class="sxs-lookup"><span data-stu-id="f8c58-103">About Performance Counters</span></span>

<span data-ttu-id="f8c58-104">I contatori delle prestazioni di Windows forniscono un livello di astrazione generale con un'interfaccia coerente per la raccolta di diversi tipi di dati di sistema, come CPU, memoria e statistiche di utilizzo del disco.</span><span class="sxs-lookup"><span data-stu-id="f8c58-104">Windows Performance Counters provide a high-level abstraction layer with a consistent interface for collecting various kinds of system data such as CPU, memory, and disk usage statistics.</span></span> <span data-ttu-id="f8c58-105">Gli amministratori di sistema utilizzano i contatori delle prestazioni per monitorare i problemi di prestazioni o di comportamento.</span><span class="sxs-lookup"><span data-stu-id="f8c58-105">System administrators use performance counters to monitor for performance or behavior problems.</span></span> <span data-ttu-id="f8c58-106">Gli sviluppatori di software utilizzano i contatori delle prestazioni per esaminare l'utilizzo delle risorse dei propri componenti.</span><span class="sxs-lookup"><span data-stu-id="f8c58-106">Software developers use performance counters to inspect the resource usage of their components.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f8c58-107">I contatori delle prestazioni di Windows sono ottimizzati per l'individuazione e la raccolta dei dati di amministrazione/diagnostica.</span><span class="sxs-lookup"><span data-stu-id="f8c58-107">Windows Performance Counters are optimized for administrative/diagnostic data discovery and collection.</span></span> <span data-ttu-id="f8c58-108">Non sono appropriati per la raccolta di dati ad alta frequenza o per la profilatura dell'applicazione perché non sono progettati per essere raccolti più di una volta al secondo.</span><span class="sxs-lookup"><span data-stu-id="f8c58-108">They are not appropriate for high-frequency data collection or for application profiling since they are not designed to be collected more than once per second.</span></span> <span data-ttu-id="f8c58-109">Per un minor overhead di accesso alle informazioni di sistema, è possibile preferire API dirette, ad esempio [**Helper stato processo**](../psapi/process-status-helper.md), [**GlobalMemoryStatusEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex), [**GetSystemTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getsystemtimes)o [**GetProcessTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocesstimes).</span><span class="sxs-lookup"><span data-stu-id="f8c58-109">For lower-overhead access to system information, you might prefer more direct APIs such as [**Process Status Helper**](../psapi/process-status-helper.md), [**GlobalMemoryStatusEx**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-globalmemorystatusex), [**GetSystemTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getsystemtimes), or [**GetProcessTimes**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getprocesstimes).</span></span> <span data-ttu-id="f8c58-110">Per la profilatura, è possibile raccogliere i log ETW con i dati di profilatura di sistema utilizzando [**tracelog.exe**](/windows-hardware/drivers/devtest/tracelog) con le `-critsec` `-dpcisr` Opzioni,, o oppure `-eflag` `-ProfileSource` è possibile utilizzare la [**profilatura del contatore hardware**](/previous-versions/windows/desktop/hcp/hcp-reference).</span><span class="sxs-lookup"><span data-stu-id="f8c58-110">For profiling, you might collect ETW logs with system profiling data using [**tracelog.exe**](/windows-hardware/drivers/devtest/tracelog) with `-critsec`, `-dpcisr`, `-eflag`, or `-ProfileSource` options, or you might use [**Hardware Counter Profiling**](/previous-versions/windows/desktop/hcp/hcp-reference).</span></span>

> [!NOTE]
> <span data-ttu-id="f8c58-111">Non confondere i contatori delle prestazioni di Windows con l'API [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) .</span><span class="sxs-lookup"><span data-stu-id="f8c58-111">Do not confuse Windows Performance Counters with the [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) API.</span></span> <span data-ttu-id="f8c58-112">I contatori delle prestazioni di Windows forniscono un'astrazione di alto livello per molti tipi di informazioni di sistema.</span><span class="sxs-lookup"><span data-stu-id="f8c58-112">Windows Performance Counters provide a high-level abstraction for many kinds of system information.</span></span> <span data-ttu-id="f8c58-113">La funzione QueryPerformanceCounter fornisce l'accesso ottimizzato a un timestamp ad alta precisione.</span><span class="sxs-lookup"><span data-stu-id="f8c58-113">The QueryPerformanceCounter function provides optimized access to a high-precision timestamp.</span></span>

## <a name="getting-started"></a><span data-ttu-id="f8c58-114">Introduzione</span><span class="sxs-lookup"><span data-stu-id="f8c58-114">Getting Started</span></span>

- <span data-ttu-id="f8c58-115">Utilizzare [gli strumenti del contatore delle prestazioni](performance-counters-tools.md) quando si desidera raccogliere o visualizzare i dati sulle prestazioni da un sistema.</span><span class="sxs-lookup"><span data-stu-id="f8c58-115">Use [Performance Counter Tools](performance-counters-tools.md) when you want to collect or view the performance data from a system.</span></span>
- <span data-ttu-id="f8c58-116">Utilizzare le [API di raccolta del contatore delle prestazioni](consuming-counter-data.md) quando si desidera scrivere uno script o un programma che raccoglie i dati sulle prestazioni dal sistema locale.</span><span class="sxs-lookup"><span data-stu-id="f8c58-116">Use [Performance Counter Collection APIs](consuming-counter-data.md) when you want to write a script or a program that collects performance data from the local system.</span></span>
- <span data-ttu-id="f8c58-117">Utilizzare [le classi del contatore delle prestazioni WMI](/windows/desktop/WmiSdk/monitoring-performance-data) quando si desidera raccogliere dati sulle prestazioni da un sistema locale o remoto utilizzando WMI.</span><span class="sxs-lookup"><span data-stu-id="f8c58-117">Use [WMI Performance Counter Classes](/windows/desktop/WmiSdk/monitoring-performance-data) when you want to collect performance data from a local or remote system using WMI.</span></span>
- <span data-ttu-id="f8c58-118">Utilizzare le [API del provider del contatore delle prestazioni](providing-counter-data.md) quando si desidera pubblicare dati sulle prestazioni dal componente software.</span><span class="sxs-lookup"><span data-stu-id="f8c58-118">Use [Performance Counter Provider APIs](providing-counter-data.md) when you want to publish performance data from your software component.</span></span>

## <a name="concepts"></a><span data-ttu-id="f8c58-119">Concetti</span><span class="sxs-lookup"><span data-stu-id="f8c58-119">Concepts</span></span>

<span data-ttu-id="f8c58-120">Il sistema di contatori delle prestazioni di Windows è organizzato in **consumer**, **provider**, **CounterSet**, **contatori**, **istanze** e **valori dei** contatori.</span><span class="sxs-lookup"><span data-stu-id="f8c58-120">The Windows Performance Counter system is organized into **consumers**, **providers**, **countersets**, **counters**, **instances**, and **counter values**.</span></span>

<span data-ttu-id="f8c58-121">Un **consumer** è un componente software che utilizza i dati sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8c58-121">A **consumer** is a software component that makes use of performance data.</span></span> <span data-ttu-id="f8c58-122">Windows include diversi [strumenti predefiniti](performance-counters-tools.md) che consentono di utilizzare i dati sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8c58-122">Windows includes several [built-in tools](performance-counters-tools.md) that make use of performance data.</span></span> <span data-ttu-id="f8c58-123">Quali gestione attività, Monitoraggio risorse, performance monitor, typeperf.exe, logman.exe e relog.exe.</span><span class="sxs-lookup"><span data-stu-id="f8c58-123">These include Task Manager, Resource Monitor, Performance Monitor, typeperf.exe, logman.exe, and relog.exe.</span></span> <span data-ttu-id="f8c58-124">Gli sviluppatori possono scrivere script e applicazioni che accedono ai contatori delle prestazioni tramite le [API del contatore delle prestazioni](consuming-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="f8c58-124">Developers can write scripts and applications that access performance counters via [performance counter APIs](consuming-counter-data.md).</span></span>

<span data-ttu-id="f8c58-125">Un **provider** è un componente software che [genera e pubblica i dati sulle prestazioni](providing-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="f8c58-125">A **provider** is a software component that [generates and publishes performance data](providing-counter-data.md).</span></span> <span data-ttu-id="f8c58-126">Un provider pubblicherà i dati per uno o più *CounterSet*.</span><span class="sxs-lookup"><span data-stu-id="f8c58-126">A provider will publish data for one or more *countersets*.</span></span> <span data-ttu-id="f8c58-127">È ad esempio possibile che un sistema di database si registri come provider di dati delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8c58-127">For example, a database system might register itself as a performance data provider.</span></span>

- <span data-ttu-id="f8c58-128">Un **provider v1** è un componente software che pubblica i dati sulle prestazioni tramite una [dll di prestazioni](providing-counter-data-using-a-performance-dll.md) eseguita nel processo del consumer.</span><span class="sxs-lookup"><span data-stu-id="f8c58-128">A **V1 provider** is a software component that publishes performance data via a [performance DLL](providing-counter-data-using-a-performance-dll.md) that runs in the process of the consumer.</span></span> <span data-ttu-id="f8c58-129">Un provider v1 viene installato su un sistema tramite un `.ini` file.</span><span class="sxs-lookup"><span data-stu-id="f8c58-129">A V1 provider is installed onto a system via an `.ini` file.</span></span> <span data-ttu-id="f8c58-130">L'architettura del provider v1 è deprecata.</span><span class="sxs-lookup"><span data-stu-id="f8c58-130">The V1 provider architecture is deprecated.</span></span> <span data-ttu-id="f8c58-131">I nuovi provider devono usare l'architettura del provider v2.</span><span class="sxs-lookup"><span data-stu-id="f8c58-131">New providers should use the V2 provider architecture.</span></span>
- <span data-ttu-id="f8c58-132">Un **provider v2** è un componente software che pubblica i dati sulle prestazioni tramite le [API del provider del contatore delle prestazioni](providing-counter-data-using-version-2-0.md).</span><span class="sxs-lookup"><span data-stu-id="f8c58-132">A **V2 provider** is a software component that publishes performance data via the [performance counter provider APIs](providing-counter-data-using-version-2-0.md).</span></span> <span data-ttu-id="f8c58-133">Un provider v2 viene installato su un sistema tramite un `.man` file (manifesto XML).</span><span class="sxs-lookup"><span data-stu-id="f8c58-133">A V2 provider is installed onto a system via a `.man` (XML manifest) file.</span></span>

<span data-ttu-id="f8c58-134">Un **contatore** è un raggruppamento di dati sulle prestazioni all'interno di un provider.</span><span class="sxs-lookup"><span data-stu-id="f8c58-134">A **counterset** is a grouping of performance data within a provider.</span></span> <span data-ttu-id="f8c58-135">Un contatore ha un nome e uno o più *contatori*.</span><span class="sxs-lookup"><span data-stu-id="f8c58-135">A counterset has a name and one or more *counters*.</span></span> <span data-ttu-id="f8c58-136">La raccolta dei dati da un contatore restituisce un numero di *istanze*.</span><span class="sxs-lookup"><span data-stu-id="f8c58-136">Collecting the data from a counterset returns a number of *instances*.</span></span> <span data-ttu-id="f8c58-137">In alcune API Windows, CounterSet sono denominati **oggetti prestazioni**.</span><span class="sxs-lookup"><span data-stu-id="f8c58-137">In some Windows APIs, countersets are called **performance objects**.</span></span> <span data-ttu-id="f8c58-138">Un provider di dati sulle prestazioni di un sistema di database, ad esempio, potrebbe fornire un contatore per le statistiche per database.</span><span class="sxs-lookup"><span data-stu-id="f8c58-138">For example, a performance data provider for a database system might provide a counterset for per-database statistics.</span></span>

<span data-ttu-id="f8c58-139">Un **contatore** è la definizione di un singolo elemento di dati sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8c58-139">A **counter** is the definition of single piece of performance data.</span></span> <span data-ttu-id="f8c58-140">Un contatore ha un nome e un tipo.</span><span class="sxs-lookup"><span data-stu-id="f8c58-140">A counter has a name and a type.</span></span> <span data-ttu-id="f8c58-141">Un contatore "statistiche per database", ad esempio, potrebbe contenere un contatore denominato "transazioni al secondo" con tipo `PERF_COUNTER_COUNTER` .</span><span class="sxs-lookup"><span data-stu-id="f8c58-141">For example, a "per-database statistics" counterset might contain a counter named "transactions per second" with type `PERF_COUNTER_COUNTER`.</span></span>

<span data-ttu-id="f8c58-142">Un' **istanza** è un'entità per la quale vengono segnalati i dati sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8c58-142">An **instance** is an entity about which performance data is reported.</span></span> <span data-ttu-id="f8c58-143">Un'istanza ha un nome (stringa) e uno o più *valori dei contatori*.</span><span class="sxs-lookup"><span data-stu-id="f8c58-143">An instance has a name (string) and one or more *counter values*.</span></span> <span data-ttu-id="f8c58-144">Un contatore "statistiche per database", ad esempio, può contenere un'istanza per ogni database.</span><span class="sxs-lookup"><span data-stu-id="f8c58-144">For example, a "per-database statistics" counterset might contain one instance per database.</span></span> <span data-ttu-id="f8c58-145">Il nome dell'istanza sarà il nome del database e ogni istanza conterrebbe i valori dei contatori per i contatori "transazioni al secondo", "utilizzo memoria" e "utilizzo disco".</span><span class="sxs-lookup"><span data-stu-id="f8c58-145">The instance name would be the database name, and each instance would contain counter values for "transactions per second", "memory usage", and "disk usage" counters.</span></span>

<span data-ttu-id="f8c58-146">Un **valore del contatore** è il valore di un singolo elemento di dati del contatore delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8c58-146">A **counter value** is the value of a single piece of performance counter data.</span></span> <span data-ttu-id="f8c58-147">Un valore del contatore è un Unsigned Integer, a 32 bit o a 64 bit, a seconda del tipo del contatore corrispondente.</span><span class="sxs-lookup"><span data-stu-id="f8c58-147">A counter value is an unsigned integer, either 32-bit or 64-bit depending on the type of the corresponding counter.</span></span> <span data-ttu-id="f8c58-148">Quando si parla di un' *istanza*, un *valore del contatore* può talvolta essere chiamato *contatore* o *valore*.</span><span class="sxs-lookup"><span data-stu-id="f8c58-148">When talking about an *instance*, a *counter value* might sometimes be called a *counter* or a *value*.</span></span>

> [!TIP]
> <span data-ttu-id="f8c58-149">Potrebbe essere utile correlare i termini del contatore delle prestazioni a termini più comuni del foglio di calcolo.</span><span class="sxs-lookup"><span data-stu-id="f8c58-149">It might be helpful to relate performance counter terms to more familiar spreadsheet terms.</span></span> <span data-ttu-id="f8c58-150">Un **contatore** è analogo a una tabella.</span><span class="sxs-lookup"><span data-stu-id="f8c58-150">A **counterset** is like a table.</span></span> <span data-ttu-id="f8c58-151">Un **contatore** è analogo a una colonna.</span><span class="sxs-lookup"><span data-stu-id="f8c58-151">A **counter** is like a column.</span></span> <span data-ttu-id="f8c58-152">Un' **istanza** è simile a una riga.</span><span class="sxs-lookup"><span data-stu-id="f8c58-152">An **instance** is like a row.</span></span> <span data-ttu-id="f8c58-153">Un **valore del contatore** è analogo a una cella della tabella.</span><span class="sxs-lookup"><span data-stu-id="f8c58-153">A **counter value** is like a cell in the table.</span></span>

<span data-ttu-id="f8c58-154">**CounterSet a istanza singola** contengono sempre i dati per una sola istanza.</span><span class="sxs-lookup"><span data-stu-id="f8c58-154">**Single-instance countersets** always contain data for exactly one instance.</span></span> <span data-ttu-id="f8c58-155">Si tratta di un problema comune per CounterSet che segnala le statistiche globali del sistema.</span><span class="sxs-lookup"><span data-stu-id="f8c58-155">This is common for countersets that report system-global statistics.</span></span> <span data-ttu-id="f8c58-156">Windows, ad esempio, dispone di un contatore incorporato a istanza singola denominato "Memory" che segnala l'utilizzo della memoria globale.</span><span class="sxs-lookup"><span data-stu-id="f8c58-156">For example, Windows has a built-in single-instance counterset named "Memory" that reports on global memory usage.</span></span>

<span data-ttu-id="f8c58-157">**CounterSet** a più istanze contengono dati per un numero variabile di istanze.</span><span class="sxs-lookup"><span data-stu-id="f8c58-157">**Multi-instance countersets** contain data for a variable number of instances.</span></span> <span data-ttu-id="f8c58-158">Questa operazione è comune per CounterSet che segnalano le entità all'interno del sistema.</span><span class="sxs-lookup"><span data-stu-id="f8c58-158">This is common for countersets that report about entities within the system.</span></span> <span data-ttu-id="f8c58-159">Windows, ad esempio, dispone di un contatore incorporato a più istanze denominato "informazioni sul processore" che segnala un'istanza per ogni CPU installata.</span><span class="sxs-lookup"><span data-stu-id="f8c58-159">For example, Windows has a built-in multi-instance counterset named "Processor Information" that reports one instance for each installed CPU.</span></span>

<span data-ttu-id="f8c58-160">I consumer raccoglieranno e registreranno periodicamente i dati da un contatore del provider.</span><span class="sxs-lookup"><span data-stu-id="f8c58-160">Consumers will periodically collect and record the data from a provider's counterset.</span></span> <span data-ttu-id="f8c58-161">Ad esempio, il consumer potrebbe raccogliere dati una volta al secondo o una volta al minuto.</span><span class="sxs-lookup"><span data-stu-id="f8c58-161">For example, the consumer might collect data once per second or once per minute.</span></span> <span data-ttu-id="f8c58-162">I dati raccolti sono detti **esempi**.</span><span class="sxs-lookup"><span data-stu-id="f8c58-162">The data collected is called a **sample**.</span></span> <span data-ttu-id="f8c58-163">Un esempio è costituito da timestamp insieme ai dati per le istanze del contatore.</span><span class="sxs-lookup"><span data-stu-id="f8c58-163">A sample consists of timestamps along with the data for instances of the counterset.</span></span> <span data-ttu-id="f8c58-164">I dati per ogni istanza includono il nome dell'istanza (stringa) e un set di valori dei contatori (Integer, un valore per ogni contatore nel set di contatori).</span><span class="sxs-lookup"><span data-stu-id="f8c58-164">The data for each instance includes the instance name (string) and a set of counter values (integers, one value for each counter in the counterset).</span></span>

<span data-ttu-id="f8c58-165">I nomi delle istanze devono essere in genere univoci all'interno di un campione, ovvero un provider non deve restituire due istanze con lo stesso nome come parte di un singolo campione.</span><span class="sxs-lookup"><span data-stu-id="f8c58-165">Instance names should normally be unique within a sample, i.e. a provider should not return two instances with the same name as part of a single sample.</span></span> <span data-ttu-id="f8c58-166">Alcuni provider meno recenti non seguono questa regola, quindi gli [utenti devono essere in grado di tollerare nomi di istanza non univoci](handling-duplicate-instance-names.md).</span><span class="sxs-lookup"><span data-stu-id="f8c58-166">Some older providers do not follow this rule, so [consumers must be able to tolerate non-unique instance names](handling-duplicate-instance-names.md).</span></span> <span data-ttu-id="f8c58-167">Per i nomi di istanza non viene fatta distinzione tra maiuscole e minuscole, pertanto le istanze non devono avere nomi che differiscono solo nel caso.</span><span class="sxs-lookup"><span data-stu-id="f8c58-167">Instance names are not case-sensitive, so instances should not have names that differ only in case.</span></span>

> [!NOTE]
> <span data-ttu-id="f8c58-168">Per motivi di compatibilità con le versioni precedenti, il contatore "processo" restituisce nomi di istanza non univoci in base al nome file EXE.</span><span class="sxs-lookup"><span data-stu-id="f8c58-168">For backwards-compatibility reasons, the "Process" counterset returns non-unique instance names based on the EXE filename.</span></span> <span data-ttu-id="f8c58-169">Ciò può causare confusione nei risultati, soprattutto quando viene avviato o arrestato un processo con un nome non univoco, in quanto in genere si verificheranno glitch per i dati a causa di una corrispondenza errata dei nomi di istanza tra i campioni.</span><span class="sxs-lookup"><span data-stu-id="f8c58-169">This can cause confusing results, especially when a process with a non-unique name starts up or shuts down, as this will typically result in data glitches due to incorrect matching of instance names between samples.</span></span> <span data-ttu-id="f8c58-170">I consumer di del contatore di "processo" devono essere in grado di tollerare questi nomi di istanza non univoci e le anomalie dei dati risultanti.</span><span class="sxs-lookup"><span data-stu-id="f8c58-170">Consumers of of the "Process" counterset must be able to tolerate these non-unique instance names and the resulting data glitches.</span></span>

<span data-ttu-id="f8c58-171">I nomi delle istanze devono essere stabili tra gli esempi, ovvero un provider deve usare lo stesso nome di istanza per la stessa entità ogni volta che viene raccolto il contatore.</span><span class="sxs-lookup"><span data-stu-id="f8c58-171">Instance names must be stable across samples, i.e. a provider should use the same instance name for the same entity each time the counterset is collected.</span></span>

<span data-ttu-id="f8c58-172">Ogni contatore ha un tipo.</span><span class="sxs-lookup"><span data-stu-id="f8c58-172">Each counter has a type.</span></span> <span data-ttu-id="f8c58-173">Il tipo di contatore indica il tipo di valore non **elaborato** del contatore, ovvero un intero senza segno a 32 bit o un intero senza segno a 64 bit.</span><span class="sxs-lookup"><span data-stu-id="f8c58-173">The counter type indicates the type of the counter's **raw value** (either unsigned 32-bit integer or unsigned 64-bit integer).</span></span> <span data-ttu-id="f8c58-174">Il tipo di contatore indica inoltre ciò che rappresenta il valore non elaborato del contatore, che determina la modalità di elaborazione del valore non elaborato per generare statistiche utili.</span><span class="sxs-lookup"><span data-stu-id="f8c58-174">The counter type also indicates what the counter's raw value represents, which determines how the raw value should be processed to generate useful statistics.</span></span>

<span data-ttu-id="f8c58-175">Anche se alcuni tipi di contatori sono semplici e hanno un valore non elaborato che è direttamente utile, molti tipi di contatori richiedono un' [elaborazione aggiuntiva](calculating-counter-values.md) per creare un **valore formattato** utile.</span><span class="sxs-lookup"><span data-stu-id="f8c58-175">While some counter types are simple and have a raw value that is directly useful, many counter types require [additional processing](calculating-counter-values.md) to create a useful **formatted value**.</span></span> <span data-ttu-id="f8c58-176">Per produrre il valore formattato, alcuni tipi di contatori richiedono valori non elaborati di due campioni, alcuni tipi di contatori richiedono timestamp e alcuni tipi di contatori richiedono valori non elaborati da più contatori.</span><span class="sxs-lookup"><span data-stu-id="f8c58-176">To produce the formatted value, some counter types require raw values from two samples, some counter types require timestamps, and some counter types require raw values from multiple counters.</span></span> <span data-ttu-id="f8c58-177">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="f8c58-177">For example:</span></span>

- <span data-ttu-id="f8c58-178">`PERF_COUNTER_LARGE_RAWCOUNT` è un valore non elaborato a 64 bit che non richiede l'elaborazione.</span><span class="sxs-lookup"><span data-stu-id="f8c58-178">`PERF_COUNTER_LARGE_RAWCOUNT` is a 64-bit raw value that requires no processing to be useful.</span></span> <span data-ttu-id="f8c58-179">È appropriato per i valori temporizzati, ad esempio "byte di memoria in uso".</span><span class="sxs-lookup"><span data-stu-id="f8c58-179">It is appropriate for point-in-time values such as "Bytes of memory in use".</span></span>
- <span data-ttu-id="f8c58-180">`PERF_COUNTER_RAWCOUNT_HEX` è un valore non elaborato a 32 bit che richiede che sia utile solo la formattazione esadecimale semplice.</span><span class="sxs-lookup"><span data-stu-id="f8c58-180">`PERF_COUNTER_RAWCOUNT_HEX` is a 32-bit raw value that requires only simple hexadecimal formatting to be useful.</span></span> <span data-ttu-id="f8c58-181">È appropriato per le informazioni di identificazione temporizzata o di identificazione, ad esempio "flag" o "indirizzo di base".</span><span class="sxs-lookup"><span data-stu-id="f8c58-181">It is appropriate for point-in-time or identifying information such as "Flags" or "Base Address".</span></span>
- <span data-ttu-id="f8c58-182">`PERF_COUNTER_BULK_COUNT` è un valore non elaborato a 64 bit che indica un conteggio degli eventi e viene utilizzato per calcolare la velocità con cui si verificano gli eventi.</span><span class="sxs-lookup"><span data-stu-id="f8c58-182">`PERF_COUNTER_BULK_COUNT` is a 64-bit raw value that indicates a count of events and is used to compute the rate at which the events occur.</span></span> <span data-ttu-id="f8c58-183">Per essere utile, questo tipo di contatore richiede due esempi separati nel tempo.</span><span class="sxs-lookup"><span data-stu-id="f8c58-183">To be useful, this counter type requires two samples that are separated in time.</span></span> <span data-ttu-id="f8c58-184">Il valore formattato è la frequenza dell'evento, ovvero il numero di volte in cui l'evento si è verificato al secondo nell'intervallo tra i due esempi.</span><span class="sxs-lookup"><span data-stu-id="f8c58-184">The formatted value is the event rate, i.e. the number of times the event occurred per second over the interval between the two samples.</span></span> <span data-ttu-id="f8c58-185">Dato due esempi `s0` e `s1` , il valore formattato (frequenza degli eventi) verrebbe calcolato come `(s1.EventCount - s0.EventCount)/(s1.TimestampInSeconds - s0.TimestampInSeconds)` .</span><span class="sxs-lookup"><span data-stu-id="f8c58-185">Given two samples `s0` and `s1`, the formatted value (event rate) would be computed as `(s1.EventCount - s0.EventCount)/(s1.TimestampInSeconds - s0.TimestampInSeconds)`.</span></span>

<span data-ttu-id="f8c58-186">Si prevede che i provider si comportino come se fossero senza stato, ovvero la raccolta di dati da un contatore non influisce in modo visibile sullo stato del provider.</span><span class="sxs-lookup"><span data-stu-id="f8c58-186">Providers are expected to behave as if they are stateless, i.e. collecting data from a counterset should not visibly affect the state of the provider.</span></span> <span data-ttu-id="f8c58-187">Un provider, ad esempio, non deve reimpostare i valori del contatore su 0 quando viene raccolto un contatore e non deve usare il timestamp di una raccolta precedente per modificare i valori nella raccolta corrente.</span><span class="sxs-lookup"><span data-stu-id="f8c58-187">For example, a provider should not reset counter values to 0 when a counterset is collected and it should not use the timestamp of a previous collection to adjust the values in the current collection.</span></span> <span data-ttu-id="f8c58-188">Al contrario, deve fornire valori di contatori raw semplici con tipi accurati, in modo che il consumer possa calcolare statistiche utili in base ai valori non elaborati e ai relativi timestamp.</span><span class="sxs-lookup"><span data-stu-id="f8c58-188">Instead, it should provide simple raw counter values with accurate types so that the consumer can compute useful statistics based on the raw values and their timestamps.</span></span>

## <a name="performance-api-architecture"></a><span data-ttu-id="f8c58-189">Architettura API per le prestazioni</span><span class="sxs-lookup"><span data-stu-id="f8c58-189">Performance API Architecture</span></span>

![Le applicazioni del contatore delle prestazioni richiamano le API Windows che chiamano i provider per ottenere i dati sulle prestazioni.](images/architecture.png)

<span data-ttu-id="f8c58-191">I consumer dei contatori delle prestazioni includono:</span><span class="sxs-lookup"><span data-stu-id="f8c58-191">Performance counter consumers include:</span></span>

- <span data-ttu-id="f8c58-192">[Applicazioni fornite da Microsoft](performance-counters-tools.md) , ad esempio Gestione attività, monitoraggio risorse, Performance Monitor e typeperf.exe.</span><span class="sxs-lookup"><span data-stu-id="f8c58-192">[Microsoft-provided applications](performance-counters-tools.md) such as Task Manager, Resource Monitor, Performance Monitor, and typeperf.exe.</span></span>
- <span data-ttu-id="f8c58-193">Le aree API di alto livello fornite da Microsoft che espongono i dati dei contatori delle prestazioni, ad esempio [le classi di prestazioni WMI](/windows/desktop/WmiSdk/monitoring-performance-data).</span><span class="sxs-lookup"><span data-stu-id="f8c58-193">Microsoft-provided high-level API surfaces that expose performance counter data such as [WMI Performance Classes](/windows/desktop/WmiSdk/monitoring-performance-data).</span></span>
- <span data-ttu-id="f8c58-194">Le applicazioni o gli script che usano le [API di consumer del contatore delle prestazioni](consuming-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="f8c58-194">Your own applications or scripts that use [performance counter consumer APIs](consuming-counter-data.md).</span></span>

<span data-ttu-id="f8c58-195">La maggior parte degli utenti del contatore delle prestazioni usa le API di [PDH.dll](using-the-pdh-functions-to-consume-counter-data.md) per raccogliere dati sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8c58-195">Most performance counter consumers use APIs from [PDH.dll](using-the-pdh-functions-to-consume-counter-data.md) to collect performance data.</span></span> <span data-ttu-id="f8c58-196">PDH gestisce molti aspetti complessi della raccolta dei contatori delle prestazioni, ad esempio l'analisi delle query, la corrispondenza di istanze tra più campioni e l'elaborazione di valori formattati dai dati del contatore non elaborati.</span><span class="sxs-lookup"><span data-stu-id="f8c58-196">PDH manages many complex aspects of gathering performance counters such as parsing queries, matching up instances across multiple samples, and computing formatted values from the raw counter data.</span></span> <span data-ttu-id="f8c58-197">L'implementazione di PDH usa le API del registro di sistema per l'utilizzo di dati da un provider v1 e usa le API di consumer V2 durante l'utilizzo di dati da un provider v2.</span><span class="sxs-lookup"><span data-stu-id="f8c58-197">The PDH implementation uses the registry APIs when consuming data from a V1 provider and uses the V2 consumer APIs when consuming data from a V2 provider.</span></span>

<span data-ttu-id="f8c58-198">Alcuni utenti del contatore delle prestazioni meno recenti usano le [API del registro di sistema](using-the-registry-functions-to-consume-counter-data.md) per raccogliere dati sulle prestazioni dalla chiave speciale `HKEY_PERFORMANCE_DATA` del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="f8c58-198">Some older performance counter consumers use the [registry APIs](using-the-registry-functions-to-consume-counter-data.md) to collect performance data from the special `HKEY_PERFORMANCE_DATA` registry key.</span></span> <span data-ttu-id="f8c58-199">Questa operazione non è consigliata per il nuovo codice perché l'elaborazione dei dati dal registro di sistema è complessa e soggetta a errori.</span><span class="sxs-lookup"><span data-stu-id="f8c58-199">This is not recommended for new code because processing the data from the registry is complex and error-prone.</span></span> <span data-ttu-id="f8c58-200">L'implementazione dell'API del registro di sistema supporta direttamente la raccolta dei dati dai provider v1.</span><span class="sxs-lookup"><span data-stu-id="f8c58-200">The registry API implementation directly supports collecting data from V1 providers.</span></span> <span data-ttu-id="f8c58-201">Supporta indirettamente la raccolta dei dati dai provider v2 tramite un livello di conversione che usa le API consumer V2.</span><span class="sxs-lookup"><span data-stu-id="f8c58-201">It indirectly supports collecting data from V2 providers through a translation layer that uses the V2 consumer APIs.</span></span>

<span data-ttu-id="f8c58-202">Alcuni utenti del contatore delle prestazioni usano le [funzioni consumer Perflib V2](using-the-perflib-functions-to-consume-counter-data.md) per accedere direttamente ai dati dai provider v2.</span><span class="sxs-lookup"><span data-stu-id="f8c58-202">Some performance counter consumers use the [PerfLib V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md) to directly access data from V2 providers.</span></span> <span data-ttu-id="f8c58-203">Si tratta di un approccio più complesso rispetto all'utilizzo di dati tramite le API PDH, ma questo approccio può essere utile se non è possibile utilizzare le API PDH a causa di problemi relativi alle prestazioni o alle dipendenze.</span><span class="sxs-lookup"><span data-stu-id="f8c58-203">This is more complex than consuming data using the PDH APIs, but this approach can be useful if PDH APIs cannot be used due to performance or dependency concerns.</span></span> <span data-ttu-id="f8c58-204">L'implementazione di PerfLib V2 supporta direttamente la raccolta dei dati dai provider v2.</span><span class="sxs-lookup"><span data-stu-id="f8c58-204">The PerfLib V2 implementation directly supports collecting data from V2 providers.</span></span> <span data-ttu-id="f8c58-205">Non supporta la raccolta dei dati dai provider v1.</span><span class="sxs-lookup"><span data-stu-id="f8c58-205">It does not support collecting data from V1 providers.</span></span>

> [!NOTE]
> <span data-ttu-id="f8c58-206">Windows OneCore non include PDH.dll e non include il supporto per l'utilizzo di dati dei contatori delle prestazioni tramite le API del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="f8c58-206">Windows OneCore does not include PDH.dll and does not include support for consuming performance counter data via the registry APIs.</span></span> <span data-ttu-id="f8c58-207">I consumer in esecuzione su OneCore devono usare le funzioni consumer PerfLib V2.</span><span class="sxs-lookup"><span data-stu-id="f8c58-207">Consumers running on OneCore must use the PerfLib V2 Consumer functions.</span></span>

<span data-ttu-id="f8c58-208">I provider v1 vengono implementati come DLL del provider caricata nel processo del consumer.</span><span class="sxs-lookup"><span data-stu-id="f8c58-208">V1 providers are implemented as a provider DLL that is loaded into the consumer process.</span></span> <span data-ttu-id="f8c58-209">L'implementazione dell'API del registro di sistema gestisce il caricamento della DLL del provider, la chiamata alla DLL per raccogliere i dati sulle prestazioni e lo scaricamento della DLL nel modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="f8c58-209">The registry API implementation manages loading the provider DLL, calling into the DLL to collect performance data, and unloading the DLL as appropriate.</span></span> <span data-ttu-id="f8c58-210">La DLL del provider è responsabile della [raccolta dei dati sulle prestazioni in base alle esigenze](communicating-with-your-application.md), ad esempio tramite API Windows normali, RPC, named pipe, Shared Memory o altri meccanismi di comunicazione interprocesso.</span><span class="sxs-lookup"><span data-stu-id="f8c58-210">The provider DLL is responsible for [collecting performance data as appropriate](communicating-with-your-application.md), e.g. by using normal Windows APIs, RPC, named pipes, shared memory, or other interprocess communication mechanisms.</span></span>

<span data-ttu-id="f8c58-211">I provider v2 vengono implementati come programma in modalità utente (spesso un servizio Windows) o come driver in modalità kernel.</span><span class="sxs-lookup"><span data-stu-id="f8c58-211">V2 providers are implemented as either a user-mode program (often a Windows service) or a kernel-mode driver.</span></span> <span data-ttu-id="f8c58-212">In genere, il codice del provider di dati sulle prestazioni è integrato direttamente in un componente esistente (ovvero il driver o il servizio sta segnalando le statistiche relative a se stesso).</span><span class="sxs-lookup"><span data-stu-id="f8c58-212">Usually the performance data provider code is integrated directly into an existing component (i.e. the driver or service is reporting statistics about itself).</span></span> <span data-ttu-id="f8c58-213">L'implementazione di PerfLib V2 gestisce le richieste e le risposte tramite il PCW.sys estensione del kernel, in modo che il provider non debba in genere implementare alcuna comunicazione interprocesso per fornire i dati sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f8c58-213">The PerfLib V2 implementation manages requests and responses via the PCW.sys kernel extension so the provider usually does not need to implement any interprocess communication to provide the performance data.</span></span>

> [!NOTE]
> <span data-ttu-id="f8c58-214">Gli strumenti e le API dei contatori delle prestazioni di Windows includono supporto limitato per l'accesso ai contatori delle prestazioni da altri computer tramite registro di sistema remoto (per i provider v1) e RPC (per i provider v2).</span><span class="sxs-lookup"><span data-stu-id="f8c58-214">Windows Performance Counter APIs and tools include limited support for accessing performance counters from other machines via Remote Registry (for V1 providers) and RPC (for V2 providers).</span></span> <span data-ttu-id="f8c58-215">Questo supporto è spesso difficile da usare in termini di controlli di autenticazione (gli strumenti e le API possono autenticarsi solo come utente corrente), oltre che in termini di [configurazione del sistema](accessing-remote-counter-data.md) (gli endpoint e i servizi necessari sono disabilitati per impostazione predefinita).</span><span class="sxs-lookup"><span data-stu-id="f8c58-215">This support is often hard to use in terms of authentication controls (the tools and APIs can only authenticate as the current user) as well as in terms of [system configuration](accessing-remote-counter-data.md) (the necessary endpoints and services are disabled by default).</span></span> <span data-ttu-id="f8c58-216">In molti casi, è preferibile accedere ai contatori delle prestazioni dei sistemi remoti tramite [WMI](/windows/desktop/WmiSdk/monitoring-performance-data) anziché tramite il supporto predefinito di accesso remoto.</span><span class="sxs-lookup"><span data-stu-id="f8c58-216">In many cases, it is better to access the performance counters of remote systems via [WMI](/windows/desktop/WmiSdk/monitoring-performance-data) rather than via the built-in remote access support.</span></span>

## <a name="developer-audience"></a><span data-ttu-id="f8c58-217">Sviluppatori</span><span class="sxs-lookup"><span data-stu-id="f8c58-217">Developer audience</span></span>

<span data-ttu-id="f8c58-218">I contatori delle prestazioni vengono spesso utilizzati dagli amministratori per identificare i problemi di prestazioni o il comportamento anomalo dei sistemi, dagli sviluppatori per studiare l'utilizzo delle risorse dei componenti software e dai singoli utenti per comprendere come si comportano i programmi nel proprio sistema.</span><span class="sxs-lookup"><span data-stu-id="f8c58-218">Performance counters are often consumed by administrators to identify performance issues or abnormal behavior of systems, by developers to study resource usage of software components, and by individual users to understand how programs are behaving on their system.</span></span> <span data-ttu-id="f8c58-219">L'utilizzo può essere eseguito tramite strumenti GUI come gestione attività o performance monitor, strumenti da riga di comando come typeperf.exe o logman.exe, tramite scripting tramite WMI e PowerShell oppure tramite le API C/C++ e .NET.</span><span class="sxs-lookup"><span data-stu-id="f8c58-219">Usage may occur via GUI tools like Task Manager or Performance Monitor, command-line tools like typeperf.exe or logman.exe, via scripting via WMI and PowerShell, or through C/C++ and .NET APIs.</span></span>

<span data-ttu-id="f8c58-220">I provider dei contatori delle prestazioni vengono in genere implementati come driver in modalità kernel o in modalità utente.</span><span class="sxs-lookup"><span data-stu-id="f8c58-220">Performance counter providers are usually implemented as kernel-mode drivers or user-mode services.</span></span> <span data-ttu-id="f8c58-221">I provider del contatore delle prestazioni vengono in genere scritti in C o C++.</span><span class="sxs-lookup"><span data-stu-id="f8c58-221">Performance counter providers are usually written in C or C++.</span></span>

## <a name="run-time-requirements"></a><span data-ttu-id="f8c58-222">Requisiti di runtime</span><span class="sxs-lookup"><span data-stu-id="f8c58-222">Run-time requirements</span></span>

<span data-ttu-id="f8c58-223">Per informazioni sui requisiti della fase di esecuzione per un particolare elemento di programmazione, vedere la sezione requisiti della pagina di riferimento per tale elemento.</span><span class="sxs-lookup"><span data-stu-id="f8c58-223">For information about run-time requirements for a particular programming element, see the Requirements section of the reference page for that element.</span></span>

<span data-ttu-id="f8c58-224">Per la cronologia delle versioni [, vedere Novità](performance-counters-what-s-new.md).</span><span class="sxs-lookup"><span data-stu-id="f8c58-224">For version history, see [What's New](performance-counters-what-s-new.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="f8c58-225">Vedi anche</span><span class="sxs-lookup"><span data-stu-id="f8c58-225">See also</span></span>

[<span data-ttu-id="f8c58-226">Utilizzo dei contatori delle prestazioni</span><span class="sxs-lookup"><span data-stu-id="f8c58-226">Using Performance Counters</span></span>](using-performance-counters.md)

[<span data-ttu-id="f8c58-227">Riferimento ai contatori delle prestazioni</span><span class="sxs-lookup"><span data-stu-id="f8c58-227">Performance Counters Reference</span></span>](performance-counters-reference.md)
