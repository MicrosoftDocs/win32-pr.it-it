---
description: Lo strumento CTRPP è un preprocessore che analizza e convalida il manifesto dei contatori.
ms.assetid: 3939f6a1-0a94-429d-a71e-b37f045fea13
title: CTRPP
ms.topic: reference
ms.date: 08/17/2020
topic_type:
- APIRef
- kbSyntax
api_name:
- CTRPP
api_type:
- NA
api_location: ''
ms.openlocfilehash: eacfbb83abd56becc579c6b9bbaedacda96f94b4
ms.sourcegitcommit: b32433cc0394159c7263809ae67615ab5792d40d
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/30/2021
ms.locfileid: "113119106"
---
# <a name="ctrpp"></a><span data-ttu-id="09b24-103">CTRPP</span><span class="sxs-lookup"><span data-stu-id="09b24-103">CTRPP</span></span>

<span data-ttu-id="09b24-104">Lo strumento CTRPP è un preprocessore che analizza e convalida il manifesto per il provider V2.</span><span class="sxs-lookup"><span data-stu-id="09b24-104">The CTRPP tool is a pre-processor that parses and validates the manifest for your V2 provider.</span></span> <span data-ttu-id="09b24-105">Lo strumento genera risorse con le stringhe necessarie per i consumer del provider e genera un'intestazione con il codice utilizzato per `.rc` fornire i dati del `.h` contatore.</span><span class="sxs-lookup"><span data-stu-id="09b24-105">The tool generates `.rc` resources with the strings needed by consumers of your provider, and it generates a `.h` header with code that you use to provide your counter data.</span></span> <span data-ttu-id="09b24-106">È consigliabile eseguire lo strumento CTRPP durante la compilazione del provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-106">You should run the CTRPP tool during the build of your provider.</span></span> <span data-ttu-id="09b24-107">È consigliabile usare il codice generato come punto di partenza per lo sviluppo del provider anziché tentare di generare il codice manualmente.</span><span class="sxs-lookup"><span data-stu-id="09b24-107">You should use the generated code as a starting point when developing your provider instead of trying to generate this code yourself.</span></span>

```syntax
ctrpp -o codeFile -rc rcFile [-legacy] [-MemoryRoutines] [-NotificationCallback] [-prefix prefix] [-ch symFile] [-backcompat] inputFile
```

## <a name="arguments"></a><span data-ttu-id="09b24-108">Argomenti</span><span class="sxs-lookup"><span data-stu-id="09b24-108">Arguments</span></span>

|<span data-ttu-id="09b24-109">Opzione</span><span class="sxs-lookup"><span data-stu-id="09b24-109">Option</span></span>              |<span data-ttu-id="09b24-110">Descrizione</span><span class="sxs-lookup"><span data-stu-id="09b24-110">Description</span></span>
|--------------------|-----------
|<span data-ttu-id="09b24-111">*inputFile*</span><span class="sxs-lookup"><span data-stu-id="09b24-111">*inputFile*</span></span>         |<span data-ttu-id="09b24-112">**Obbligatorio:** Specifica il nome del `.man` file (manifesto XML) che definisce i contatori.</span><span class="sxs-lookup"><span data-stu-id="09b24-112">**Required:** Specifies the name of the `.man` (XML manifest) file that defines your counters.</span></span>
|<span data-ttu-id="09b24-113">**-o** *codeFile*</span><span class="sxs-lookup"><span data-stu-id="09b24-113">**-o** *codeFile*</span></span>   |<span data-ttu-id="09b24-114">**Obbligatorio:** Specifica il nome del `.h` file di codice che deve essere generato da CTRPP.</span><span class="sxs-lookup"><span data-stu-id="09b24-114">**Required:** Specifies the name of the `.h` code file to be generated by CTRPP.</span></span> <span data-ttu-id="09b24-115">Questo file conterrà funzioni helper inline C/C++ che semplificano l'inizializzazione e l'annullamento dell'inizializzazione del provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-115">This file will contain C/C++ inline helper functions that simplify initializing and uninitializing your provider.</span></span>
|<span data-ttu-id="09b24-116">**-rc** *rcFile*</span><span class="sxs-lookup"><span data-stu-id="09b24-116">**-rc** *rcFile*</span></span>    |<span data-ttu-id="09b24-117">**Obbligatorio:** Specifica il nome dell'oggetto `.rc` (file di risorse) che deve essere generato da CTRPP.</span><span class="sxs-lookup"><span data-stu-id="09b24-117">**Required:** Specifies the name of the `.rc` (resource file) to be generated by CTRPP.</span></span> <span data-ttu-id="09b24-118">Questo file conterrà la tabella di stringhe del provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-118">This file will contain the provider's string table.</span></span>
|<span data-ttu-id="09b24-119">**-ch** *symFile*</span><span class="sxs-lookup"><span data-stu-id="09b24-119">**-ch** *symFile*</span></span>   |<span data-ttu-id="09b24-120">Specifica il nome del file di `.h` simboli facoltativo che deve essere generato da CTRPP.</span><span class="sxs-lookup"><span data-stu-id="09b24-120">Specifies the name of the optional `.h` symbol file to be generated by CTRPP.</span></span> <span data-ttu-id="09b24-121">Questo file conterrà i simboli C/C++ per i nomi e i GUID di ogni insieme di contatori nel provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-121">This file will contain C/C++ symbols for the names and GUIDs of each counterset in the provider.</span></span>
|<span data-ttu-id="09b24-122">**Prefisso -prefix** </span><span class="sxs-lookup"><span data-stu-id="09b24-122">**-prefix** *prefix*</span></span>|<span data-ttu-id="09b24-123">Specifica il prefisso da usare per le variabili e le funzioni definite nel file di intestazione generato.</span><span class="sxs-lookup"><span data-stu-id="09b24-123">Specifies the prefix to use for the variables and functions defined in the generated header file.</span></span>
|<span data-ttu-id="09b24-124">**-NotificationCallback**</span><span class="sxs-lookup"><span data-stu-id="09b24-124">**-NotificationCallback**</span></span>|<span data-ttu-id="09b24-125">Modifica la firma predefinita della funzione [**CounterInitialize**](counterinitialize.md) per includere i parametri per specificare il nome delle funzioni di callback [*ControlCallback,*](/windows/desktop/api/Perflib/nc-perflib-perflibrequest) [*AllocateMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc) [*e FreeMemory.*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_free)</span><span class="sxs-lookup"><span data-stu-id="09b24-125">Changes the default signature of the [**CounterInitialize**](counterinitialize.md) function to include parameters for specifying the name of [*ControlCallback*](/windows/desktop/api/Perflib/nc-perflib-perflibrequest), [*AllocateMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc), and [*FreeMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_free) callback functions.</span></span> <span data-ttu-id="09b24-126">Questo argomento ha lo stesso effetto dell'inclusione `callback` dell'attributo [**nell'elemento provider.**](/windows/desktop/PerfCtrs/performance-counters-provider--counters--element)</span><span class="sxs-lookup"><span data-stu-id="09b24-126">This argument has the same effect as including the `callback` attribute in the [**provider**](/windows/desktop/PerfCtrs/performance-counters-provider--counters--element) element.</span></span>
|<span data-ttu-id="09b24-127">**-migrate** *outputFile*</span><span class="sxs-lookup"><span data-stu-id="09b24-127">**-migrate** *outputFile*</span></span>|<span data-ttu-id="09b24-128">Anziché generare i `.h` file e , aggiorna il manifesto inputFile alla versione più recente `.rc` e lo salva in *outputFile*. </span><span class="sxs-lookup"><span data-stu-id="09b24-128">Instead of generating `.h` and `.rc` files, upgrades the *inputFile* manifest to the latest version and saves it to *outputFile*.</span></span> <span data-ttu-id="09b24-129">Questa opzione non può essere utilizzata con altre opzioni.</span><span class="sxs-lookup"><span data-stu-id="09b24-129">This switch cannot be used with other switches.</span></span> <span data-ttu-id="09b24-130">Sintassi: `CTRPP -migrate NewFile.man OldFile.man`</span><span class="sxs-lookup"><span data-stu-id="09b24-130">Usage: `CTRPP -migrate NewFile.man OldFile.man`</span></span>
|<span data-ttu-id="09b24-131">**-BackCompat**</span><span class="sxs-lookup"><span data-stu-id="09b24-131">**-BackCompat**</span></span>     |<span data-ttu-id="09b24-132">**Deprecato:** In Windows 7 è stato aggiunto il supporto per i provider in modalità kernel.</span><span class="sxs-lookup"><span data-stu-id="09b24-132">**Deprecated:** Support for kernel-mode providers was added in Windows 7.</span></span> <span data-ttu-id="09b24-133">Per impostazione predefinita, il codice generato da CTRPP per i provider in modalità kernel non sarà compatibile con le versioni precedenti di Windows (il caricamento del driver non riuscirà a causa di `Pcw***` API mancanti).</span><span class="sxs-lookup"><span data-stu-id="09b24-133">By default, the code generated by CTRPP for kernel-mode providers will be incompatible with earlier versions of Windows (driver will fail to load due to missing `Pcw***` APIs).</span></span> <span data-ttu-id="09b24-134">Impostare `-BackCompat` per abilitare la compatibilità con le versioni precedenti di Windows.</span><span class="sxs-lookup"><span data-stu-id="09b24-134">Set `-BackCompat` to enable compatibility with earlier versions of Windows.</span></span> <span data-ttu-id="09b24-135">Il driver carica dinamicamente le API necessarie e il codice generato disabilita automaticamente il provider se le API non sono disponibili.</span><span class="sxs-lookup"><span data-stu-id="09b24-135">The driver will dynamically load the necessary APIs and the generated code will silently disable the provider if the APIs are not available.</span></span>
|<span data-ttu-id="09b24-136">**-MemoryRoutines**</span><span class="sxs-lookup"><span data-stu-id="09b24-136">**-MemoryRoutines**</span></span> |<span data-ttu-id="09b24-137">**Deprecato:** Se usato con `-Legacy` l'opzione , include i modelli per le routine di memoria nel codice generato.</span><span class="sxs-lookup"><span data-stu-id="09b24-137">**Deprecated:** When used with the `-Legacy` switch, includes templates for memory routines in the generated code.</span></span> <span data-ttu-id="09b24-138">In caso contrario, questo argomento ha lo stesso effetto `-NotificationCallback` dell'opzione .</span><span class="sxs-lookup"><span data-stu-id="09b24-138">Otherwise, this argument has the same effect as the `-NotificationCallback` switch.</span></span>
|<span data-ttu-id="09b24-139">**-Legacy**</span><span class="sxs-lookup"><span data-stu-id="09b24-139">**-Legacy**</span></span>         |<span data-ttu-id="09b24-140">**Deprecato:** Genera file , , e usando i modelli di codice di `*.h` `*.c` Windows Vista `*.rc` `*_r.h` (genera PerfAutoInitialize e PerfAutoCleanup anziché CounterInitialize e CounterCleanup).</span><span class="sxs-lookup"><span data-stu-id="09b24-140">**Deprecated:** Generates `*.h`, `*.c`, `*.rc`, and `*_r.h` files using the Windows Vista code templates (generates PerfAutoInitialize and PerfAutoCleanup instead of CounterInitialize and CounterCleanup).</span></span> <span data-ttu-id="09b24-141">Questa opzione può essere usata con **-MemoryRoutines** e **-NotificationCallback,** ma non con altre opzioni.</span><span class="sxs-lookup"><span data-stu-id="09b24-141">This switch can be used with **-MemoryRoutines** and **-NotificationCallback** but cannot be used with any other switches.</span></span> <span data-ttu-id="09b24-142">Non usare **l'opzione -o** **o -rc** con questa opzione.</span><span class="sxs-lookup"><span data-stu-id="09b24-142">Do not use the **-o** or **-rc** switches with this switch.</span></span> <span data-ttu-id="09b24-143">I file generati verranno denominati in base al nome del manifesto e verranno scritti nella directory che contiene il manifesto.</span><span class="sxs-lookup"><span data-stu-id="09b24-143">The generated files will be named based on the name of the manifest and will be written to the directory that contained the manifest.</span></span> <span data-ttu-id="09b24-144">Sintassi: `CTRPP -legacy OldFile.man`</span><span class="sxs-lookup"><span data-stu-id="09b24-144">Usage: `CTRPP -legacy OldFile.man`</span></span>

## <a name="remarks"></a><span data-ttu-id="09b24-145">Commenti</span><span class="sxs-lookup"><span data-stu-id="09b24-145">Remarks</span></span>

<span data-ttu-id="09b24-146">Lo strumento CTRPP genera un `.h` file di codice, un `.rc` file di risorse e, facoltativamente, un `.h` file di simboli.</span><span class="sxs-lookup"><span data-stu-id="09b24-146">The CTRPP tool generates a `.h` code file, an `.rc` resource file, and optionally generates a `.h` symbol file.</span></span>

### <a name="using-the-generated-resource-file"></a><span data-ttu-id="09b24-147">Uso del file di risorse generato</span><span class="sxs-lookup"><span data-stu-id="09b24-147">Using the generated resource file</span></span>

<span data-ttu-id="09b24-148">Lo strumento CTRPP genererà un file di risorse che contiene le stringhe localizzabili necessarie per i consumer `.rc` dei contatori del provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-148">The CTRPP tool will generate a `.rc` resource file that contains the localizable strings needed by consumers of the provider's countersets.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="09b24-149">Le risorse di questo file devono essere incluse nel file binario del provider e il percorso completo del file binario del provider deve essere registrato durante l'installazione del manifesto del provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-149">The resources from this file must be included into your provider binary and the full path to the provider binary must be registered during the installation of your provider's manifest.</span></span> <span data-ttu-id="09b24-150">I consumer che non sono in grado di individuare e caricare le risorse non potranno usare i contatori del provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-150">Consumers that are unable to locate and load the resources will be unable to use your provider's countersets.</span></span>

<span data-ttu-id="09b24-151">Le risorse stringa devono essere gestite nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="09b24-151">The string resources should be handled as follows:</span></span>

- <span data-ttu-id="09b24-152">Lo sviluppatore modifica il file manifesto del provider ( ) per impostare l'attributo del provider sul nome di un file binario del `.man` provider (.DLL, .SYS o .EXE) che conterrà le risorse stringa per il provider e verrà installato come parte del `applicationIdentity` componente del provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-152">The developer edits the provider manifest (`.man`) file to set the `applicationIdentity` attribute of the provider to the name of a provider binary (.DLL, .SYS, or .EXE) that will contain the string resources for the provider and will be installed as part of the provider component.</span></span>
- <span data-ttu-id="09b24-153">Lo strumento CTRPP legge il manifesto del provider e genera un `.rc` file.</span><span class="sxs-lookup"><span data-stu-id="09b24-153">The CTRPP tool reads the provider manifest and generates an `.rc` file.</span></span>
- <span data-ttu-id="09b24-154">Lo [strumento RC (compilatore di risorse)](../menurc/resource-compiler.md) compila i dati dal file generato da CTRPP per generare un `.rc` file contenente le risorse `.res` binarie.</span><span class="sxs-lookup"><span data-stu-id="09b24-154">The [RC (resource compiler)](../menurc/resource-compiler.md) tool compiles the data from the CTRPP-generated `.rc` file to generate a `.res` file containing the binary resources.</span></span> <span data-ttu-id="09b24-155">Questa operazione può essere eseguita compilando direttamente il file generato da CTRPP oppure compilando un altro file che include il file generato da `.rc` `.rc` CTRPP `.rc` tramite una direttiva `#include` .</span><span class="sxs-lookup"><span data-stu-id="09b24-155">This can be done either by directly compiling the CTRPP-generated `.rc` file OR by compiling another `.rc` file that includes the CTRPP-generated `.rc` file via an `#include` directive.</span></span>
- <span data-ttu-id="09b24-156">Il linker incorpora i dati del file generato da RC `.res` nel file binario del provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-156">The linker embeds the data from the RC-generated `.res` file into the provider binary.</span></span>
- <span data-ttu-id="09b24-157">Durante l'installazione, il file binario del provider viene copiato nel sistema dell'utente e il manifesto del provider viene registrato usando lo [strumento lodctr](/windows-server/administration/windows-commands/lodctr).</span><span class="sxs-lookup"><span data-stu-id="09b24-157">During installation, the provider binary is copied onto the user's system and the provider manifest is registered using the [lodctr tool](/windows-server/administration/windows-commands/lodctr).</span></span> <span data-ttu-id="09b24-158">Lo strumento lodctr converte l'attributo del manifesto del provider in un percorso completo e registra il percorso completo del file `applicationIdentity` binario del provider nel Registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="09b24-158">The lodctr tool converts the `applicationIdentity` attribute of the provider manifest into a full path and records the full path to the provider binary in the registry.</span></span>
  - <span data-ttu-id="09b24-159">Se il file binario del provider si trova nella stessa directory del manifesto, usare: `lodctr.exe /m:"C:\full\manifest\path\manifest.man"` .</span><span class="sxs-lookup"><span data-stu-id="09b24-159">If the provider binary is in the same directory as the manifest, use: `lodctr.exe /m:"C:\full\manifest\path\manifest.man"`.</span></span> <span data-ttu-id="09b24-160">lodctr combinerà il percorso del manifesto specificato con l'attributo `applicationIdentity` del manifesto per formare il percorso completo.</span><span class="sxs-lookup"><span data-stu-id="09b24-160">lodctr will combine the specified manifest path with the manifest's `applicationIdentity` attribute to form the full path.</span></span>
  - <span data-ttu-id="09b24-161">In caso contrario, usare `lodctr.exe /m:"C:\full\manifest\path\manifest.man" "c:\full\binary\path"`.</span><span class="sxs-lookup"><span data-stu-id="09b24-161">Otherwise, use `lodctr.exe /m:"C:\full\manifest\path\manifest.man" "c:\full\binary\path"`.</span></span> <span data-ttu-id="09b24-162">lodctr combinerà il percorso binario specificato con l'attributo `applicationIdentity` del manifesto per formare il percorso completo.</span><span class="sxs-lookup"><span data-stu-id="09b24-162">lodctr will combine the specified binary path with the manifest's `applicationIdentity` attribute to form the full path.</span></span>
  - <span data-ttu-id="09b24-163">A scopo diagnostico, è possibile esaminare il percorso completo registrato controllando il `ApplicationIdentity` valore della chiave del Registro di sistema `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\_V2Providers\{<ProviderGuid>}` .</span><span class="sxs-lookup"><span data-stu-id="09b24-163">For diagnostic purposes, you can inspect the recorded full path by checking the `ApplicationIdentity` value of registry key `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\_V2Providers\{<ProviderGuid>}`.</span></span>
  - <span data-ttu-id="09b24-164">Se il file binario usa MUI per la localizzazione, assicurarsi di copiare il file MUI insieme al file binario.</span><span class="sxs-lookup"><span data-stu-id="09b24-164">If the binary is using MUI for localization, be sure to copy the MUI file along with the binary.</span></span>
- <span data-ttu-id="09b24-165">Durante la raccolta dei contatori, il consumer usa il percorso completo registrato del file binario del provider per individuare e caricare le stringhe necessarie dalle risorse del file binario del provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-165">During counterset collection, the consumer uses the recorded full path to the provider binary to locate and load the necessary strings from the provider binary's resources.</span></span>

### <a name="using-the-generated-code-file-in-a-user-mode-provider"></a><span data-ttu-id="09b24-166">Uso del file di codice generato in un provider in modalità utente</span><span class="sxs-lookup"><span data-stu-id="09b24-166">Using the generated code file in a user-mode provider</span></span>

<span data-ttu-id="09b24-167">Lo strumento CTRPP genererà un `.h` file di codice C/C++.</span><span class="sxs-lookup"><span data-stu-id="09b24-167">The CTRPP tool will generate a `.h` C/C++ code file.</span></span> <span data-ttu-id="09b24-168">Se l'attributo del manifesto del provider è impostato su , il file di codice generato conterrà le definizioni seguenti utili per codificare `providerType` un provider in modalità `userMode` utente:</span><span class="sxs-lookup"><span data-stu-id="09b24-168">If the provider manifest's `providerType` attribute is set to `userMode`, the generated code file will contain the following definitions that are helpful in coding a user-mode provider:</span></span>

- <span data-ttu-id="09b24-169">Una funzione di inizializzazione del provider [ \* **denominata prefix\*CounterInitialize**](counterinitialize.md).</span><span class="sxs-lookup"><span data-stu-id="09b24-169">An provider initialization function named [\***prefix\*CounterInitialize**](counterinitialize.md).</span></span>
- <span data-ttu-id="09b24-170">Una funzione di pulizia del provider [ \* **denominata prefix\*CounterCleanup**](countercleanup.md).</span><span class="sxs-lookup"><span data-stu-id="09b24-170">A provider cleanup function named [\***prefix\*CounterCleanup**](countercleanup.md).</span></span>
- <span data-ttu-id="09b24-171">Variabile \***globale del provider** _ che archivia l'handle del provider aperto dalla funzione _ \*_prefix_CounterInitialize\*\*.</span><span class="sxs-lookup"><span data-stu-id="09b24-171">A global ***provider** _ variable that stores the provider handle opened by the _ *_prefix_CounterInitialize** function.</span></span> <span data-ttu-id="09b24-172">Il nome della variabile è il valore `symbol` dell'attributo `provider` dell'elemento nel manifesto.</span><span class="sxs-lookup"><span data-stu-id="09b24-172">The variable's name is the value of the `symbol` attribute of the `provider` element in the manifest.</span></span> <span data-ttu-id="09b24-173">Questa variabile deve essere usata nelle chiamate a , e altre API per il controllo `PerfCreateInstance` `PerfDeleteInstance` dei dati del provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-173">This variable should be used in calls to `PerfCreateInstance`, `PerfDeleteInstance`, and other APIs for controlling your provider's data.</span></span>
- <span data-ttu-id="09b24-174">Per ogni insieme di contatori, una variabile globale \***counterset\*GUID** con il GUID dell'insieme di contatori.</span><span class="sxs-lookup"><span data-stu-id="09b24-174">For each counterset, a global \***counterset\*GUID** variable with the counterset GUID.</span></span> <span data-ttu-id="09b24-175">Il nome della variabile è il valore `counterSet` dell'attributo dell'elemento più il `symbol` suffisso "GUID", ad esempio `MyCounterSetGUID` .</span><span class="sxs-lookup"><span data-stu-id="09b24-175">The variable's name is the value of the `counterSet` element's `symbol` attribute plus the suffix "GUID", e.g. `MyCounterSetGUID`.</span></span> <span data-ttu-id="09b24-176">Questa variabile deve essere usata nelle chiamate a , e altre API per il controllo `PerfCreateInstance` `PerfDeleteInstance` dei dati del provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-176">This variable should be used in calls to `PerfCreateInstance`, `PerfDeleteInstance`, and other APIs for controlling your provider's data.</span></span>
- <span data-ttu-id="09b24-177">Per ogni contatore, macro ***del*** contatore con il valore del `id` contatore.</span><span class="sxs-lookup"><span data-stu-id="09b24-177">For each counter, a ***counter*** macro with the counter's `id` value.</span></span> <span data-ttu-id="09b24-178">Il nome della macro è il valore `counter` dell'attributo `symbol` dell'elemento.</span><span class="sxs-lookup"><span data-stu-id="09b24-178">The macro's name is the value of the `counter` element's `symbol` attribute.</span></span> <span data-ttu-id="09b24-179">Questa macro deve essere usata nelle chiamate `PerfSetCounterRefValue` a , e altre API per impostare i dati del `PerfSetULongLongCounterValue` provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-179">This macro should be used in calls to `PerfSetCounterRefValue`, `PerfSetULongLongCounterValue`, and other APIs for setting your provider's data.</span></span>

<span data-ttu-id="09b24-180">Nei nomi delle funzioni, ***prefix*** fa riferimento al valore del parametro `-prefix` della riga di comando.</span><span class="sxs-lookup"><span data-stu-id="09b24-180">In the function names, ***prefix*** refers to the value of the `-prefix` command-line parameter.</span></span> <span data-ttu-id="09b24-181">Se il `-prefix` parametro non viene usato, le funzioni verranno denominate `CounterInitialize` e `CounterCleanup` .</span><span class="sxs-lookup"><span data-stu-id="09b24-181">If the `-prefix` parameter is not used the functions will be named `CounterInitialize` and `CounterCleanup`.</span></span>

### <a name="using-the-generated-code-file-in-a-kernel-mode-provider"></a><span data-ttu-id="09b24-182">Uso del file di codice generato in un provider in modalità kernel</span><span class="sxs-lookup"><span data-stu-id="09b24-182">Using the generated code file in a kernel-mode provider</span></span>

<span data-ttu-id="09b24-183">Lo strumento CTRPP genererà un `.h` file di codice C/C++.</span><span class="sxs-lookup"><span data-stu-id="09b24-183">The CTRPP tool will generate a `.h` C/C++ code file.</span></span> <span data-ttu-id="09b24-184">Se l'attributo del manifesto del provider è impostato su , il file di codice generato conterrà le definizioni seguenti utili per codificare i controset di un provider in modalità `providerType` `kernelMode` kernel:</span><span class="sxs-lookup"><span data-stu-id="09b24-184">If the provider manifest's `providerType` attribute is set to `kernelMode`, the generated code file will contain the following definitions that are helpful in coding a kernel-mode provider's countersets:</span></span>

- <span data-ttu-id="09b24-185">Funzione di inizializzazione del contatore denominata <b> *prefisso* Register *Counterset*</b>.</span><span class="sxs-lookup"><span data-stu-id="09b24-185">A counterset initialization function named <b>*prefix* Register *Counterset*</b>.</span></span> <span data-ttu-id="09b24-186">Questa funzione inserisce una [struttura RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) e quindi richiama [PcwRegister,](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwregister)inserendo l'handle di registrazione del contatore risultante nella variabile ***counterset*** globale.</span><span class="sxs-lookup"><span data-stu-id="09b24-186">This function fills in a [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) structure then invokes [PcwRegister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwregister), putting the resulting counterset registration handle into the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="09b24-187">Una funzione di pulizia dell'insieme di contatori <b> *denominata prefix* Unregister *Counterset*</b>.</span><span class="sxs-lookup"><span data-stu-id="09b24-187">A counterset cleanup function named <b>*prefix* Unregister *Counterset*</b>.</span></span> <span data-ttu-id="09b24-188">Questa funzione richiama [PcwUnregister sull'handle](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwunregister) di registrazione del contatore nella variabile ***counterset*** globale.</span><span class="sxs-lookup"><span data-stu-id="09b24-188">This function invokes [PcwUnregister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwunregister) on the counterset registration handle in the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="09b24-189">Una funzione di creazione dell'istanza <b> *denominata create\*\*counterset*</b>.</span><span class="sxs-lookup"><span data-stu-id="09b24-189">An instance creation function named <b>*prefix* Create *Counterset*</b>.</span></span> <span data-ttu-id="09b24-190">Questa funzione inserisce una matrice di [strutture PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) e quindi richiama [PcwCreateInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcreateinstance) usando l'handle di registrazione del contatore nella variabile ***counterset*** globale.</span><span class="sxs-lookup"><span data-stu-id="09b24-190">This function fills in an array of [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) structures then invokes [PcwCreateInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcreateinstance) using the counterset registration handle in the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="09b24-191">Una funzione di pulizia dell'istanza <b> *denominata close\*\*counterset*</b>.</span><span class="sxs-lookup"><span data-stu-id="09b24-191">An instance cleanup function named <b>*prefix* Close *Counterset*</b>.</span></span> <span data-ttu-id="09b24-192">Questa funzione richiama [PcwCloseInstance.](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcloseinstance)</span><span class="sxs-lookup"><span data-stu-id="09b24-192">This function invokes [PcwCloseInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcloseinstance).</span></span>
- <span data-ttu-id="09b24-193">Una funzione di segnalazione dell'istanza <b> *denominata add\*\*Counterset*</b> da usare dalla funzione di callback counterset.</span><span class="sxs-lookup"><span data-stu-id="09b24-193">An instance reporting function named <b>*prefix* Add *Counterset*</b> to be used from the counterset callback function.</span></span> <span data-ttu-id="09b24-194">Questa funzione inserisce una matrice di [strutture PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) e quindi richiama [PcwAddInstance.](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwaddinstance)</span><span class="sxs-lookup"><span data-stu-id="09b24-194">This function fills in an array of [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) structures then invokes [PcwAddInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwaddinstance).</span></span>
- <span data-ttu-id="09b24-195">**Windows SDK 20H1 e versioni successive:** Una funzione di inizializzazione RegInfo <b> *denominata prefix* InitRegistrationInformation *Counterset*</b> per l'uso in scenari avanzati.</span><span class="sxs-lookup"><span data-stu-id="09b24-195">**Windows SDK 20H1 and later:** A RegInfo initialization function named <b>*prefix* InitRegistrationInformation *Counterset*</b> for use in advanced scenarios.</span></span> <span data-ttu-id="09b24-196">Questa funzione inserisce una [struttura RegInfo.](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information)</span><span class="sxs-lookup"><span data-stu-id="09b24-196">This function fills in a [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) structure.</span></span> <span data-ttu-id="09b24-197">Questa funzione può essere usata nei casi in cui il prefisso generato <b> Register *Counterset*</b> non soddisfa le proprie esigenze, ad esempio quando si vogliono personalizzare i valori nella struttura RegInfo o quando si vuole archiviare l'handle restituito in un'altra variabile.</span><span class="sxs-lookup"><span data-stu-id="09b24-197">This function can be used in cases where the generated <b>*prefix* Register *Counterset*</b> does not meet your needs, e.g. when you want to customize the values in the RegInfo structure or when you want to store the returned handle in another variable.</span></span>

<span data-ttu-id="09b24-198">Nei nomi delle funzioni, ***prefix*** fa riferimento al valore del parametro `-prefix` della riga di comando.</span><span class="sxs-lookup"><span data-stu-id="09b24-198">In the function names, ***prefix*** refers to the value of the `-prefix` command-line parameter.</span></span> <span data-ttu-id="09b24-199">Se il `-prefix` parametro non viene usato, le funzioni non avranno alcun prefisso.</span><span class="sxs-lookup"><span data-stu-id="09b24-199">If the `-prefix` parameter is not used the functions will have no prefix.</span></span>

> [!NOTE]
> <span data-ttu-id="09b24-200">La funzione <b> *Add\*\*Counterset*</b> del prefisso generato viene usata quando si dispone di un callback di counterset.</span><span class="sxs-lookup"><span data-stu-id="09b24-200">The generated <b>*prefix* Add *Counterset*</b> function is used when you have a counterset callback.</span></span> <span data-ttu-id="09b24-201">Le <b> *funzioni* Create *Counterset*</b> e <b> *Close\*\*Counterset*</b> del prefisso generate vengono usate quando non è disponibile un callback di counterset.</span><span class="sxs-lookup"><span data-stu-id="09b24-201">The generated <b>*prefix* Create *Counterset*</b> and <b>*prefix* Close *Counterset*</b> functions are used when you do not have a counterset callback.</span></span>

### <a name="using-the-generated-symbol-file"></a><span data-ttu-id="09b24-202">Uso del file di simboli generato</span><span class="sxs-lookup"><span data-stu-id="09b24-202">Using the generated symbol file</span></span>

<span data-ttu-id="09b24-203">Se il **parametro -ch** viene specificato nella riga di comando, lo strumento CTRPP genererà un `.h` file di simboli.</span><span class="sxs-lookup"><span data-stu-id="09b24-203">If the **-ch** parameter is specified on the command line, the CTRPP tool will generate a `.h` symbol file.</span></span> <span data-ttu-id="09b24-204">Questo file contiene i simboli C/C++ per i nomi e i GUID di ogni counterset nel provider.</span><span class="sxs-lookup"><span data-stu-id="09b24-204">This file contains the C/C++ symbols for the names and GUIDs of each counterset in the provider.</span></span> <span data-ttu-id="09b24-205">I simboli possono essere usati quando si scrivono programmi hard-coded per utilizzare i dati di questo counterset usando le funzioni [consumer PerfLib V2](using-the-perflib-functions-to-consume-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="09b24-205">The symbols can be used when writing programs that are hard-coded to consume the data from this counterset using the [PerfLib V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md).</span></span>

## <a name="requirements"></a><span data-ttu-id="09b24-206">Requisiti</span><span class="sxs-lookup"><span data-stu-id="09b24-206">Requirements</span></span>

| <span data-ttu-id="09b24-207">Requisito</span><span class="sxs-lookup"><span data-stu-id="09b24-207">Requirement</span></span>             | <span data-ttu-id="09b24-208">Valore</span><span class="sxs-lookup"><span data-stu-id="09b24-208">Value</span></span> |
|-------------------------|-------|
| <span data-ttu-id="09b24-209">Client minimo supportato</span><span class="sxs-lookup"><span data-stu-id="09b24-209">Minimum supported client</span></span>| <span data-ttu-id="09b24-210">Solo app desktop di Windows Vista \[\]</span><span class="sxs-lookup"><span data-stu-id="09b24-210">Windows Vista \[desktop apps only\]</span></span>
| <span data-ttu-id="09b24-211">Server minimo supportato</span><span class="sxs-lookup"><span data-stu-id="09b24-211">Minimum supported server</span></span>| <span data-ttu-id="09b24-212">Solo app desktop di Windows Server 2008 \[\]</span><span class="sxs-lookup"><span data-stu-id="09b24-212">Windows Server 2008 \[desktop apps only\]</span></span>
