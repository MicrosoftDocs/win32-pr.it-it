---
description: Lo strumento CTRPP è un pre-processore che analizza e convalida il manifesto dei contatori.
ms.assetid: 3939f6a1-0a94-429d-a71e-b37f045fea13
title: CTRPP
ms.topic: reference
ms.date: 08/17/2020
topic_type:
- APIRef
- kbSyntax
api_name:
- CTRPP
api_type:
- NA
api_location: ''
ms.openlocfilehash: dce12de641dda7b07871a4447190772533598748
ms.sourcegitcommit: de72a1294df274b0a71dc0fdc42d757e5f6df0f3
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/05/2021
ms.locfileid: "104351856"
---
# <a name="ctrpp"></a><span data-ttu-id="0795f-103">CTRPP</span><span class="sxs-lookup"><span data-stu-id="0795f-103">CTRPP</span></span>

<span data-ttu-id="0795f-104">Lo strumento CTRPP è un pre-processore che analizza e convalida il manifesto per il provider v2.</span><span class="sxs-lookup"><span data-stu-id="0795f-104">The CTRPP tool is a pre-processor that parses and validates the manifest for your V2 provider.</span></span> <span data-ttu-id="0795f-105">Lo strumento genera `.rc` risorse con le stringhe richieste dagli utenti del provider e genera un' `.h` intestazione con il codice usato per fornire i dati del contatore.</span><span class="sxs-lookup"><span data-stu-id="0795f-105">The tool generates `.rc` resources with the strings needed by consumers of your provider, and it generates a `.h` header with code that you use to provide your counter data.</span></span> <span data-ttu-id="0795f-106">Eseguire lo strumento CTRPP durante la compilazione del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-106">You should run the CTRPP tool during the build of your provider.</span></span> <span data-ttu-id="0795f-107">È consigliabile usare il codice generato come punto di partenza quando si sviluppa il provider anziché provare a generare manualmente questo codice.</span><span class="sxs-lookup"><span data-stu-id="0795f-107">You should use the generated code as a starting point when developing your provider instead of trying to generate this code yourself.</span></span>

```syntax
ctrpp -o codeFile -rc rcFile [-legacy] [-MemoryRoutines] [-NotificationCallback] [-prefix prefix] [-ch symFile] [-backcompat] inputFile
```

## <a name="arguments"></a><span data-ttu-id="0795f-108">Argomenti</span><span class="sxs-lookup"><span data-stu-id="0795f-108">Arguments</span></span>

|<span data-ttu-id="0795f-109">Opzione</span><span class="sxs-lookup"><span data-stu-id="0795f-109">Option</span></span>              |<span data-ttu-id="0795f-110">Descrizione</span><span class="sxs-lookup"><span data-stu-id="0795f-110">Description</span></span>
|--------------------|-----------
|<span data-ttu-id="0795f-111">*inputFile*</span><span class="sxs-lookup"><span data-stu-id="0795f-111">*inputFile*</span></span>         |<span data-ttu-id="0795f-112">**Obbligatorio:** Specifica il nome del `.man` file (manifesto XML) che definisce i contatori.</span><span class="sxs-lookup"><span data-stu-id="0795f-112">**Required:** Specifies the name of the `.man` (XML manifest) file that defines your counters.</span></span>
|<span data-ttu-id="0795f-113">**-o** *CodeFile*</span><span class="sxs-lookup"><span data-stu-id="0795f-113">**-o** *codeFile*</span></span>   |<span data-ttu-id="0795f-114">**Obbligatorio:** Specifica il nome del `.h` file di codice che deve essere generato da CTRPP.</span><span class="sxs-lookup"><span data-stu-id="0795f-114">**Required:** Specifies the name of the `.h` code file to be generated by CTRPP.</span></span> <span data-ttu-id="0795f-115">Questo file conterrà le funzioni di supporto inline C/C++ che semplificano l'inizializzazione e l'annullamento dell'inizializzazione del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-115">This file will contain C/C++ inline helper functions that simplify initializing and uninitializing your provider.</span></span>
|<span data-ttu-id="0795f-116">**-RC** *rcFile*</span><span class="sxs-lookup"><span data-stu-id="0795f-116">**-rc** *rcFile*</span></span>    |<span data-ttu-id="0795f-117">**Obbligatorio:** Specifica il nome del `.rc` file di risorse che deve essere generato da CTRPP.</span><span class="sxs-lookup"><span data-stu-id="0795f-117">**Required:** Specifies the name of the `.rc` (resource file) to be generated by CTRPP.</span></span> <span data-ttu-id="0795f-118">Questo file conterrà la tabella delle stringhe del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-118">This file will contain the provider's string table.</span></span>
|<span data-ttu-id="0795f-119">**-ch** *symFile*</span><span class="sxs-lookup"><span data-stu-id="0795f-119">**-ch** *symFile*</span></span>   |<span data-ttu-id="0795f-120">Specifica il nome del file di `.h` simboli facoltativo che deve essere generato da CTRPP.</span><span class="sxs-lookup"><span data-stu-id="0795f-120">Specifies the name of the optional `.h` symbol file to be generated by CTRPP.</span></span> <span data-ttu-id="0795f-121">Questo file conterrà i simboli C/C++ per i nomi e i GUID di ogni contatore del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-121">This file will contain C/C++ symbols for the names and GUIDs of each counterset in the provider.</span></span>
|<span data-ttu-id="0795f-122">**-** *prefisso prefisso*</span><span class="sxs-lookup"><span data-stu-id="0795f-122">**-prefix** *prefix*</span></span>|<span data-ttu-id="0795f-123">Specifica il prefisso da usare per le variabili e le funzioni definite nel file di intestazione generato.</span><span class="sxs-lookup"><span data-stu-id="0795f-123">Specifies the prefix to use for the variables and functions defined in the generated header file.</span></span>
|<span data-ttu-id="0795f-124">**-NotificationCallback**</span><span class="sxs-lookup"><span data-stu-id="0795f-124">**-NotificationCallback**</span></span>|<span data-ttu-id="0795f-125">Modifica la firma predefinita della funzione [**CounterInitialize**](counterinitialize.md) in modo da includere i parametri per specificare il nome delle funzioni di callback [*ControlCallback*](/windows/desktop/api/Perflib/nc-perflib-perflibrequest), [*AllocateMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc)e [*freememory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_free) .</span><span class="sxs-lookup"><span data-stu-id="0795f-125">Changes the default signature of the [**CounterInitialize**](counterinitialize.md) function to include parameters for specifying the name of [*ControlCallback*](/windows/desktop/api/Perflib/nc-perflib-perflibrequest), [*AllocateMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_alloc), and [*FreeMemory*](/windows/desktop/api/Perflib/nc-perflib-perf_mem_free) callback functions.</span></span> <span data-ttu-id="0795f-126">Questo argomento ha lo stesso effetto dell'inclusione dell' `callback` attributo nell'elemento [**provider**](/windows/desktop/PerfCtrs/performance-counters-provider--counters--element) .</span><span class="sxs-lookup"><span data-stu-id="0795f-126">This argument has the same effect as including the `callback` attribute in the [**provider**](/windows/desktop/PerfCtrs/performance-counters-provider--counters--element) element.</span></span>
|<span data-ttu-id="0795f-127">**-Esegui migrazione di** *outputfile*</span><span class="sxs-lookup"><span data-stu-id="0795f-127">**-migrate** *outputFile*</span></span>|<span data-ttu-id="0795f-128">Anziché generare `.h` file e `.rc` , aggiorna il manifesto *inputfile* alla versione più recente e lo salva in *outputfile*.</span><span class="sxs-lookup"><span data-stu-id="0795f-128">Instead of generating `.h` and `.rc` files, upgrades the *inputFile* manifest to the latest version and saves it to *outputFile*.</span></span> <span data-ttu-id="0795f-129">Questa opzione non può essere usata con altre opzioni.</span><span class="sxs-lookup"><span data-stu-id="0795f-129">This switch cannot be used with other switches.</span></span> <span data-ttu-id="0795f-130">Sintassi: `CTRPP -migrate NewFile.man OldFile.man`</span><span class="sxs-lookup"><span data-stu-id="0795f-130">Usage: `CTRPP -migrate NewFile.man OldFile.man`</span></span>
|<span data-ttu-id="0795f-131">**-BackCompat**</span><span class="sxs-lookup"><span data-stu-id="0795f-131">**-BackCompat**</span></span>     |<span data-ttu-id="0795f-132">**Deprecato:** Il supporto per i provider in modalità kernel è stato aggiunto in Windows 7.</span><span class="sxs-lookup"><span data-stu-id="0795f-132">**Deprecated:** Support for kernel-mode providers was added in Windows 7.</span></span> <span data-ttu-id="0795f-133">Per impostazione predefinita, il codice generato da CTRPP per i provider in modalità kernel non sarà compatibile con le versioni precedenti di Windows (il driver non verrà caricato a causa di `Pcw***` API mancanti).</span><span class="sxs-lookup"><span data-stu-id="0795f-133">By default, the code generated by CTRPP for kernel-mode providers will be incompatible with earlier versions of Windows (driver will fail to load due to missing `Pcw***` APIs).</span></span> <span data-ttu-id="0795f-134">Impostare `-BackCompat` per abilitare la compatibilità con le versioni precedenti di Windows.</span><span class="sxs-lookup"><span data-stu-id="0795f-134">Set `-BackCompat` to enable compatibility with earlier versions of Windows.</span></span> <span data-ttu-id="0795f-135">Il driver caricherà in modo dinamico le API necessarie e il codice generato Disabilita automaticamente il provider se le API non sono disponibili.</span><span class="sxs-lookup"><span data-stu-id="0795f-135">The driver will dynamically load the necessary APIs and the generated code will silently disable the provider if the APIs are not available.</span></span>
|<span data-ttu-id="0795f-136">**-MemoryRoutines**</span><span class="sxs-lookup"><span data-stu-id="0795f-136">**-MemoryRoutines**</span></span> |<span data-ttu-id="0795f-137">**Deprecato:** Se usato con l' `-Legacy` opzione, include i modelli per le routine di memoria nel codice generato.</span><span class="sxs-lookup"><span data-stu-id="0795f-137">**Deprecated:** When used with the `-Legacy` switch, includes templates for memory routines in the generated code.</span></span> <span data-ttu-id="0795f-138">In caso contrario, questo argomento avrà lo stesso effetto dell' `-NotificationCallback` opzione.</span><span class="sxs-lookup"><span data-stu-id="0795f-138">Otherwise, this argument has the same effect as the `-NotificationCallback` switch.</span></span>
|<span data-ttu-id="0795f-139">**-Legacy**</span><span class="sxs-lookup"><span data-stu-id="0795f-139">**-Legacy**</span></span>         |<span data-ttu-id="0795f-140">**Deprecato:** Genera `*.h` `*.c` `*.rc` i file,, e `*_r.h` utilizzando i modelli di codice di Windows Vista (genera PerfAutoInitialize e PerfAutoCleanup anziché CounterInitialize e CounterCleanup).</span><span class="sxs-lookup"><span data-stu-id="0795f-140">**Deprecated:** Generates `*.h`, `*.c`, `*.rc`, and `*_r.h` files using the Windows Vista code templates (generates PerfAutoInitialize and PerfAutoCleanup instead of CounterInitialize and CounterCleanup).</span></span> <span data-ttu-id="0795f-141">Questa opzione può essere usata con **-MemoryRoutines** e **-NotificationCallback** ma non può essere usata con altre opzioni.</span><span class="sxs-lookup"><span data-stu-id="0795f-141">This switch can be used with **-MemoryRoutines** and **-NotificationCallback** but cannot be used with any other switches.</span></span> <span data-ttu-id="0795f-142">Non usare le opzioni **-o** o **-RC** con questa opzione.</span><span class="sxs-lookup"><span data-stu-id="0795f-142">Do not use the **-o** or **-rc** switches with this switch.</span></span> <span data-ttu-id="0795f-143">I file generati verranno denominati in base al nome del manifesto e verranno scritti nella directory che contiene il manifesto.</span><span class="sxs-lookup"><span data-stu-id="0795f-143">The generated files will be named based on the name of the manifest and will be written to the directory that contained the manifest.</span></span> <span data-ttu-id="0795f-144">Sintassi: `CTRPP -legacy OldFile.man`</span><span class="sxs-lookup"><span data-stu-id="0795f-144">Usage: `CTRPP -legacy OldFile.man`</span></span>

## <a name="remarks"></a><span data-ttu-id="0795f-145">Commenti</span><span class="sxs-lookup"><span data-stu-id="0795f-145">Remarks</span></span>

<span data-ttu-id="0795f-146">Lo strumento CTRPP genera un file di `.h` codice, un `.rc` file di risorse e, facoltativamente, genera un `.h` file di simboli.</span><span class="sxs-lookup"><span data-stu-id="0795f-146">The CTRPP tool generates a `.h` code file, an `.rc` resource file, and optionally generates a `.h` symbol file.</span></span>

### <a name="using-the-generated-resource-file"></a><span data-ttu-id="0795f-147">Uso del file di risorse generato</span><span class="sxs-lookup"><span data-stu-id="0795f-147">Using the generated resource file</span></span>

<span data-ttu-id="0795f-148">Lo strumento CTRPP genererà un `.rc` file di risorse che contiene le stringhe localizzabili necessarie per i consumer del CounterSet del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-148">The CTRPP tool will generate a `.rc` resource file that contains the localizable strings needed by consumers of the provider's countersets.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="0795f-149">Le risorse di questo file devono essere incluse nel file binario del provider e il percorso completo del file binario del provider deve essere registrato durante l'installazione del manifesto del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-149">The resources from this file must be included into your provider binary and the full path to the provider binary must be registered during the installation of your provider's manifest.</span></span> <span data-ttu-id="0795f-150">I consumer che non sono in grado di individuare e caricare le risorse non saranno in grado di usare il CounterSet del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-150">Consumers that are unable to locate and load the resources will be unable to use your provider's countersets.</span></span>

<span data-ttu-id="0795f-151">Le risorse di stringa devono essere gestite come segue:</span><span class="sxs-lookup"><span data-stu-id="0795f-151">The string resources should be handled as follows:</span></span>

- <span data-ttu-id="0795f-152">Lo sviluppatore modifica il file del manifesto del provider ( `.man` ) per impostare l' `applicationIdentity` attributo del provider sul nome di un provider binario (. DLL,. SYS o. EXE) che conterrà le risorse di stringa per il provider e verrà installato come parte del componente provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-152">The developer edits the provider manifest (`.man`) file to set the `applicationIdentity` attribute of the provider to the name of a provider binary (.DLL, .SYS, or .EXE) that will contain the string resources for the provider and will be installed as part of the provider component.</span></span>
- <span data-ttu-id="0795f-153">Lo strumento CTRPP legge il manifesto del provider e genera un `.rc` file.</span><span class="sxs-lookup"><span data-stu-id="0795f-153">The CTRPP tool reads the provider manifest and generates an `.rc` file.</span></span>
- <span data-ttu-id="0795f-154">Lo strumento [RC (compilatore di risorse)](../menurc/resource-compiler.md) compila i dati dal file generato da CTRPP `.rc` per generare un `.res` file contenente le risorse binarie.</span><span class="sxs-lookup"><span data-stu-id="0795f-154">The [RC (resource compiler)](../menurc/resource-compiler.md) tool compiles the data from the CTRPP-generated `.rc` file to generate a `.res` file containing the binary resources.</span></span> <span data-ttu-id="0795f-155">Questa operazione può essere eseguita compilando direttamente il file generato da CTRPP `.rc` o compilando un altro `.rc` file che include il file generato da CTRPP `.rc` tramite una `#include` direttiva.</span><span class="sxs-lookup"><span data-stu-id="0795f-155">This can be done either by directly compiling the CTRPP-generated `.rc` file OR by compiling another `.rc` file that includes the CTRPP-generated `.rc` file via an `#include` directive.</span></span>
- <span data-ttu-id="0795f-156">Il linker incorpora i dati dal file generato da RC `.res` nel file binario del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-156">The linker embeds the data from the RC-generated `.res` file into the provider binary.</span></span>
- <span data-ttu-id="0795f-157">Durante l'installazione, il file binario del provider viene copiato nel sistema dell'utente e il manifesto del provider viene registrato utilizzando lo [strumento lodctr](/windows-server/administration/windows-commands/lodctr).</span><span class="sxs-lookup"><span data-stu-id="0795f-157">During installation, the provider binary is copied onto the user's system and the provider manifest is registered using the [lodctr tool](/windows-server/administration/windows-commands/lodctr).</span></span> <span data-ttu-id="0795f-158">Lo strumento lodctr converte l' `applicationIdentity` attributo del manifesto del provider in un percorso completo e registra il percorso completo del file binario del provider nel registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="0795f-158">The lodctr tool converts the `applicationIdentity` attribute of the provider manifest into a full path and records the full path to the provider binary in the registry.</span></span>
  - <span data-ttu-id="0795f-159">Se il file binario del provider si trova nella stessa directory del manifesto, usare: `lodctr.exe /m:"C:\full\manifest\path\manifest.man"` .</span><span class="sxs-lookup"><span data-stu-id="0795f-159">If the provider binary is in the same directory as the manifest, use: `lodctr.exe /m:"C:\full\manifest\path\manifest.man"`.</span></span> <span data-ttu-id="0795f-160">lodctr combinerà il percorso del manifesto specificato con l'attributo del manifesto `applicationIdentity` per formare il percorso completo.</span><span class="sxs-lookup"><span data-stu-id="0795f-160">lodctr will combine the specified manifest path with the manifest's `applicationIdentity` attribute to form the full path.</span></span>
  - <span data-ttu-id="0795f-161">In caso contrario, usare `lodctr.exe /m:"C:\full\manifest\path\manifest.man" "c:\full\binary\path"`.</span><span class="sxs-lookup"><span data-stu-id="0795f-161">Otherwise, use `lodctr.exe /m:"C:\full\manifest\path\manifest.man" "c:\full\binary\path"`.</span></span> <span data-ttu-id="0795f-162">lodctr combinerà il percorso binario specificato con l'attributo del manifesto `applicationIdentity` per formare il percorso completo.</span><span class="sxs-lookup"><span data-stu-id="0795f-162">lodctr will combine the specified binary path with the manifest's `applicationIdentity` attribute to form the full path.</span></span>
  - <span data-ttu-id="0795f-163">Ai fini della diagnostica, è possibile controllare il percorso completo registrato controllando il `ApplicationIdentity` valore della chiave del registro di sistema `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\_V2Providers\{<ProviderGuid>}` .</span><span class="sxs-lookup"><span data-stu-id="0795f-163">For diagnostic purposes, you can inspect the recorded full path by checking the `ApplicationIdentity` value of registry key `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Perflib\_V2Providers\{<ProviderGuid>}`.</span></span>
  - <span data-ttu-id="0795f-164">Se il file binario USA MUI per la localizzazione, assicurarsi di copiare il file MUI insieme al file binario.</span><span class="sxs-lookup"><span data-stu-id="0795f-164">If the binary is using MUI for localization, be sure to copy the MUI file along with the binary.</span></span>
- <span data-ttu-id="0795f-165">Durante la raccolta dei contatori, il consumer usa il percorso completo registrato al file binario del provider per individuare e caricare le stringhe necessarie dalle risorse del binario del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-165">During counterset collection, the consumer uses the recorded full path to the provider binary to locate and load the necessary strings from the provider binary's resources.</span></span>

### <a name="using-the-generated-code-file-in-a-user-mode-provider"></a><span data-ttu-id="0795f-166">Uso del file di codice generato in un provider in modalità utente</span><span class="sxs-lookup"><span data-stu-id="0795f-166">Using the generated code file in a user-mode provider</span></span>

<span data-ttu-id="0795f-167">Lo strumento CTRPP genererà un `.h` file di codice C/C++.</span><span class="sxs-lookup"><span data-stu-id="0795f-167">The CTRPP tool will generate a `.h` C/C++ code file.</span></span> <span data-ttu-id="0795f-168">Se l'attributo del manifesto del provider `providerType` è impostato su `userMode` , il file di codice generato conterrà le seguenti definizioni utili per la codifica di un provider in modalità utente:</span><span class="sxs-lookup"><span data-stu-id="0795f-168">If the provider manifest's `providerType` attribute is set to `userMode`, the generated code file will contain the following definitions that are helpful in coding a user-mode provider:</span></span>

- <span data-ttu-id="0795f-169">Funzione di inizializzazione del provider denominata [ \* **Prefix \* CounterInitialize**](counterinitialize.md).</span><span class="sxs-lookup"><span data-stu-id="0795f-169">An provider initialization function named [\***prefix\*CounterInitialize**](counterinitialize.md).</span></span>
- <span data-ttu-id="0795f-170">Funzione di pulizia del provider denominata [ \* **Prefix \* CounterCleanup**](countercleanup.md).</span><span class="sxs-lookup"><span data-stu-id="0795f-170">A provider cleanup function named [\***prefix\*CounterCleanup**](countercleanup.md).</span></span>
- <span data-ttu-id="0795f-171">Variabile globale \***provider** _ che archivia l'handle del provider aperto dalla funzione _ \*_prefix_CounterInitialize\*\*.</span><span class="sxs-lookup"><span data-stu-id="0795f-171">A global ***provider** _ variable that stores the provider handle opened by the _ *_prefix_CounterInitialize** function.</span></span> <span data-ttu-id="0795f-172">Il nome della variabile è il valore dell' `symbol` attributo dell' `provider` elemento nel manifesto.</span><span class="sxs-lookup"><span data-stu-id="0795f-172">The variable's name is the value of the `symbol` attribute of the `provider` element in the manifest.</span></span> <span data-ttu-id="0795f-173">Questa variabile deve essere usata nelle chiamate a `PerfCreateInstance` , `PerfDeleteInstance` e ad altre API per il controllo dei dati del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-173">This variable should be used in calls to `PerfCreateInstance`, `PerfDeleteInstance`, and other APIs for controlling your provider's data.</span></span>
- <span data-ttu-id="0795f-174">Per ogni contatore, una variabile di **GUID** \* del contatore \* globale con il GUID del contatore.</span><span class="sxs-lookup"><span data-stu-id="0795f-174">For each counterset, a global \***counterset\*GUID** variable with the counterset GUID.</span></span> <span data-ttu-id="0795f-175">Il nome della variabile è il valore dell' `counterSet` attributo dell'elemento `symbol` più il suffisso "GUID", ad esempio `MyCounterSetGUID` .</span><span class="sxs-lookup"><span data-stu-id="0795f-175">The variable's name is the value of the `counterSet` element's `symbol` attribute plus the suffix "GUID", e.g. `MyCounterSetGUID`.</span></span> <span data-ttu-id="0795f-176">Questa variabile deve essere usata nelle chiamate a `PerfCreateInstance` , `PerfDeleteInstance` e ad altre API per il controllo dei dati del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-176">This variable should be used in calls to `PerfCreateInstance`, `PerfDeleteInstance`, and other APIs for controlling your provider's data.</span></span>
- <span data-ttu-id="0795f-177">Per ogni contatore, una macro del ***contatore*** con il valore del contatore `id` .</span><span class="sxs-lookup"><span data-stu-id="0795f-177">For each counter, a ***counter*** macro with the counter's `id` value.</span></span> <span data-ttu-id="0795f-178">Il nome della macro corrisponde al valore dell' `counter` attributo dell'elemento `symbol` .</span><span class="sxs-lookup"><span data-stu-id="0795f-178">The macro's name is the value of the `counter` element's `symbol` attribute.</span></span> <span data-ttu-id="0795f-179">Questa macro deve essere usata nelle chiamate a `PerfSetCounterRefValue` , `PerfSetULongLongCounterValue` e ad altre API per l'impostazione dei dati del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-179">This macro should be used in calls to `PerfSetCounterRefValue`, `PerfSetULongLongCounterValue`, and other APIs for setting your provider's data.</span></span>

<span data-ttu-id="0795f-180">Nei nomi di funzione, ***Prefix*** si riferisce al valore del `-prefix` parametro della riga di comando.</span><span class="sxs-lookup"><span data-stu-id="0795f-180">In the function names, ***prefix*** refers to the value of the `-prefix` command-line parameter.</span></span> <span data-ttu-id="0795f-181">Se il `-prefix` parametro non viene utilizzato, le funzioni verranno denominate `CounterInitialize` e `CounterCleanup` .</span><span class="sxs-lookup"><span data-stu-id="0795f-181">If the `-prefix` parameter is not used the functions will be named `CounterInitialize` and `CounterCleanup`.</span></span>

### <a name="using-the-generated-code-file-in-a-kernel-mode-provider"></a><span data-ttu-id="0795f-182">Uso del file di codice generato in un provider in modalità kernel</span><span class="sxs-lookup"><span data-stu-id="0795f-182">Using the generated code file in a kernel-mode provider</span></span>

<span data-ttu-id="0795f-183">Lo strumento CTRPP genererà un `.h` file di codice C/C++.</span><span class="sxs-lookup"><span data-stu-id="0795f-183">The CTRPP tool will generate a `.h` C/C++ code file.</span></span> <span data-ttu-id="0795f-184">Se l'attributo del manifesto del provider `providerType` è impostato su `kernelMode` , il file di codice generato conterrà le seguenti definizioni utili per la codifica di un CounterSet del provider in modalità kernel:</span><span class="sxs-lookup"><span data-stu-id="0795f-184">If the provider manifest's `providerType` attribute is set to `kernelMode`, the generated code file will contain the following definitions that are helpful in coding a kernel-mode provider's countersets:</span></span>

- <span data-ttu-id="0795f-185">Una funzione di inizializzazione del contatore denominata <b> *PREFIXE* registra il *contatore*</b>.</span><span class="sxs-lookup"><span data-stu-id="0795f-185">A counterset initialization function named <b>*prefix* Register *Counterset*</b>.</span></span> <span data-ttu-id="0795f-186">Questa funzione compila una struttura [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) , quindi richiama [PcwRegister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwregister), inserendo l'handle di registrazione del contatore risultante nella variabile globale del ***contatore*** .</span><span class="sxs-lookup"><span data-stu-id="0795f-186">This function fills in a [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) structure then invokes [PcwRegister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwregister), putting the resulting counterset registration handle into the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="0795f-187">Una funzione di pulizia dei contatori denominata <b> *Prefix* Annulla la registrazione del *contatore*</b>.</span><span class="sxs-lookup"><span data-stu-id="0795f-187">A counterset cleanup function named <b>*prefix* Unregister *Counterset*</b>.</span></span> <span data-ttu-id="0795f-188">Questa funzione richiama [PcwUnregister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwunregister) sull'handle di registrazione del contatore dei contatori nella variabile globale del ***contatore*** .</span><span class="sxs-lookup"><span data-stu-id="0795f-188">This function invokes [PcwUnregister](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwunregister) on the counterset registration handle in the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="0795f-189">Una funzione di creazione dell'istanza denominata <b> *Prefix* crea il *contatore*</b>.</span><span class="sxs-lookup"><span data-stu-id="0795f-189">An instance creation function named <b>*prefix* Create *Counterset*</b>.</span></span> <span data-ttu-id="0795f-190">Questa funzione compila una matrice di strutture [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) , quindi richiama [PcwCreateInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcreateinstance) usando l'handle di registrazione del contatore nella variabile globale del ***contatore*** .</span><span class="sxs-lookup"><span data-stu-id="0795f-190">This function fills in an array of [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) structures then invokes [PcwCreateInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcreateinstance) using the counterset registration handle in the global ***Counterset*** variable.</span></span>
- <span data-ttu-id="0795f-191">Una funzione di pulizia dell'istanza denominata <b> *Prefix* chiude il *contatore*</b>.</span><span class="sxs-lookup"><span data-stu-id="0795f-191">An instance cleanup function named <b>*prefix* Close *Counterset*</b>.</span></span> <span data-ttu-id="0795f-192">Questa funzione richiama [PcwCloseInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcloseinstance).</span><span class="sxs-lookup"><span data-stu-id="0795f-192">This function invokes [PcwCloseInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwcloseinstance).</span></span>
- <span data-ttu-id="0795f-193">Una funzione di creazione di report dell'istanza denominata <b> *Prefix* aggiungere il *contatore*</b> da usare dalla funzione di callback del contatore.</span><span class="sxs-lookup"><span data-stu-id="0795f-193">An instance reporting function named <b>*prefix* Add *Counterset*</b> to be used from the counterset callback function.</span></span> <span data-ttu-id="0795f-194">Questa funzione compila una matrice di strutture [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) , quindi richiama [PcwAddInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwaddinstance).</span><span class="sxs-lookup"><span data-stu-id="0795f-194">This function fills in an array of [PcwData](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_data) structures then invokes [PcwAddInstance](/windows-hardware/drivers/ddi/wdm/nf-wdm-pcwaddinstance).</span></span>
- <span data-ttu-id="0795f-195">**Windows SDK 20H1 e versioni successive:** Funzione di inizializzazione RegInfo denominata <b> *Prefix* InitRegistrationInformation</b> per l'uso in scenari avanzati.</span><span class="sxs-lookup"><span data-stu-id="0795f-195">**Windows SDK 20H1 and later:** A RegInfo initialization function named <b>*prefix* InitRegistrationInformation *Counterset*</b> for use in advanced scenarios.</span></span> <span data-ttu-id="0795f-196">Questa funzione compila una struttura [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) .</span><span class="sxs-lookup"><span data-stu-id="0795f-196">This function fills in a [RegInfo](/windows-hardware/drivers/ddi/wdm/ns-wdm-_pcw_registration_information) structure.</span></span> <span data-ttu-id="0795f-197">Questa funzione può essere usata nei casi in cui il <b>*contatore* dei registri di *prefisso*</b> generato non soddisfi le proprie esigenze, ad esempio quando si vuole personalizzare i valori nella struttura RegInfo o quando si vuole archiviare l'handle restituito in un'altra variabile.</span><span class="sxs-lookup"><span data-stu-id="0795f-197">This function can be used in cases where the generated <b>*prefix* Register *Counterset*</b> does not meet your needs, e.g. when you want to customize the values in the RegInfo structure or when you want to store the returned handle in another variable.</span></span>

<span data-ttu-id="0795f-198">Nei nomi di funzione, ***Prefix*** si riferisce al valore del `-prefix` parametro della riga di comando.</span><span class="sxs-lookup"><span data-stu-id="0795f-198">In the function names, ***prefix*** refers to the value of the `-prefix` command-line parameter.</span></span> <span data-ttu-id="0795f-199">Se il `-prefix` parametro non viene utilizzato, le funzioni non avranno alcun prefisso.</span><span class="sxs-lookup"><span data-stu-id="0795f-199">If the `-prefix` parameter is not used the functions will have no prefix.</span></span>

> [!NOTE]
> <span data-ttu-id="0795f-200">La funzione di <b>aggiunta del *contatore* di *prefisso*</b> generata viene utilizzata quando si dispone di un callback del contatore.</span><span class="sxs-lookup"><span data-stu-id="0795f-200">The generated <b>*prefix* Add *Counterset*</b> function is used when you have a counterset callback.</span></span> <span data-ttu-id="0795f-201">Quando non si dispone di un callback del contatore, vengono utilizzate le funzioni del contatore create del <b> *prefisso*</b> generato e di chiusura del <b> *prefisso*</b> .</span><span class="sxs-lookup"><span data-stu-id="0795f-201">The generated <b>*prefix* Create *Counterset*</b> and <b>*prefix* Close *Counterset*</b> functions are used when you do not have a counterset callback.</span></span>

### <a name="using-the-generated-symbol-file"></a><span data-ttu-id="0795f-202">Uso del file di simboli generato</span><span class="sxs-lookup"><span data-stu-id="0795f-202">Using the generated symbol file</span></span>

<span data-ttu-id="0795f-203">Se il parametro **-ch** viene specificato nella riga di comando, lo strumento CTRPP genererà un `.h` file di simboli.</span><span class="sxs-lookup"><span data-stu-id="0795f-203">If the **-ch** parameter is specified on the command line, the CTRPP tool will generate a `.h` symbol file.</span></span> <span data-ttu-id="0795f-204">Questo file contiene i simboli C/C++ per i nomi e i GUID di ogni contatore del provider.</span><span class="sxs-lookup"><span data-stu-id="0795f-204">This file contains the C/C++ symbols for the names and GUIDs of each counterset in the provider.</span></span> <span data-ttu-id="0795f-205">I simboli possono essere utilizzati per la scrittura di programmi hardcoded per utilizzare i dati di questo contatore usando le [funzioni consumer Perflib V2](using-the-perflib-functions-to-consume-counter-data.md).</span><span class="sxs-lookup"><span data-stu-id="0795f-205">The symbols can be used when writing programs that are hard-coded to consume the data from this counterset using the [PerfLib V2 Consumer functions](using-the-perflib-functions-to-consume-counter-data.md).</span></span>

## <a name="requirements"></a><span data-ttu-id="0795f-206">Requisiti</span><span class="sxs-lookup"><span data-stu-id="0795f-206">Requirements</span></span>

|                         ||
|-------------------------|----
| <span data-ttu-id="0795f-207">Client minimo supportato</span><span class="sxs-lookup"><span data-stu-id="0795f-207">Minimum supported client</span></span>| <span data-ttu-id="0795f-208">\[Solo app desktop di Windows Vista\]</span><span class="sxs-lookup"><span data-stu-id="0795f-208">Windows Vista \[desktop apps only\]</span></span>
| <span data-ttu-id="0795f-209">Server minimo supportato</span><span class="sxs-lookup"><span data-stu-id="0795f-209">Minimum supported server</span></span>| <span data-ttu-id="0795f-210">\[Solo app desktop Windows Server 2008\]</span><span class="sxs-lookup"><span data-stu-id="0795f-210">Windows Server 2008 \[desktop apps only\]</span></span>
