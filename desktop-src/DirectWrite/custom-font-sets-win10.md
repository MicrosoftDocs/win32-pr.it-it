---
title: Set di caratteri personalizzati
description: Questo argomento descrive i vari modi in cui è possibile usare i tipi di carattere personalizzati nell'app.
ms.assetid: 50842838-d150-df9a-f1b7-67ce5ea2bc80
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a79f1ccfcb1dadd355c5f582417aacb5041ecf8b
ms.sourcegitcommit: 89f99926f946dc6c5ea600fb7c41f6b19ceac516
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/21/2020
ms.locfileid: "104399912"
---
# <a name="custom-font-sets"></a><span data-ttu-id="ee17e-103">Set di caratteri personalizzati</span><span class="sxs-lookup"><span data-stu-id="ee17e-103">Custom Font Sets</span></span>

<span data-ttu-id="ee17e-104">Questo argomento descrive i vari modi in cui è possibile usare i tipi di carattere personalizzati nell'app.</span><span class="sxs-lookup"><span data-stu-id="ee17e-104">This topic describes various ways in which you can use custom fonts in your app.</span></span>

-   [<span data-ttu-id="ee17e-105">Introduzione </span><span class="sxs-lookup"><span data-stu-id="ee17e-105">Introduction </span></span>](#introduction)
-   [<span data-ttu-id="ee17e-106">Riepilogo delle API</span><span class="sxs-lookup"><span data-stu-id="ee17e-106">Summary of APIs</span></span>](#summary-of-apis)
-   [<span data-ttu-id="ee17e-107">Concetti chiave</span><span class="sxs-lookup"><span data-stu-id="ee17e-107">Key concepts</span></span>](#key-concepts)
-   [<span data-ttu-id="ee17e-108">Tipi di carattere e formati di file dei tipi di carattere</span><span class="sxs-lookup"><span data-stu-id="ee17e-108">Fonts and font file formats</span></span>](#fonts-and-font-file-formats)
-   [<span data-ttu-id="ee17e-109">Set di caratteri e raccolte di tipi di carattere</span><span class="sxs-lookup"><span data-stu-id="ee17e-109">Font sets and font collections</span></span>](#font-sets-and-font-collections)
-   [<span data-ttu-id="ee17e-110">Scenari comuni</span><span class="sxs-lookup"><span data-stu-id="ee17e-110">Common scenarios</span></span>](#common-scenarios)
    -   [<span data-ttu-id="ee17e-111">Creazione di un set di caratteri utilizzando tipi di carattere arbitrari nell'file system locale</span><span class="sxs-lookup"><span data-stu-id="ee17e-111">Creating a font set using arbitrary fonts in the local file system</span></span>](#creating-a-font-set-using-arbitrary-fonts-in-the-local-file-system)
    -   [<span data-ttu-id="ee17e-112">Creazione di un set di caratteri utilizzando i tipi di carattere noti nella file system locale</span><span class="sxs-lookup"><span data-stu-id="ee17e-112">Creating a font set using known fonts in the local file system</span></span>](#creating-a-font-set-using-known-fonts-in-the-local-file-system)
    -   [<span data-ttu-id="ee17e-113">Creazione di un set di caratteri personalizzato utilizzando caratteri remoti noti sul Web</span><span class="sxs-lookup"><span data-stu-id="ee17e-113">Creating a custom font set using known, remote fonts on the Web</span></span>](#creating-a-custom-font-set-using-known-remote-fonts-on-the-web)
    -   [<span data-ttu-id="ee17e-114">Creazione di un set di caratteri personalizzato usando i dati del tipo di carattere caricati in memoria</span><span class="sxs-lookup"><span data-stu-id="ee17e-114">Creating a custom font set using font data loaded into memory</span></span>](#creating-a-custom-font-set-using-font-data-loaded-into-memory)
-   [<span data-ttu-id="ee17e-115">Scenari avanzati</span><span class="sxs-lookup"><span data-stu-id="ee17e-115">Advanced scenarios</span></span>](#advanced-scenarios)
    -   [<span data-ttu-id="ee17e-116">Combinazione di set di caratteri</span><span class="sxs-lookup"><span data-stu-id="ee17e-116">Combining font sets</span></span>](#combining-font-sets)
    -   [<span data-ttu-id="ee17e-117">Uso di dati di tipo carattere WOFF o WOFF2 locali </span><span class="sxs-lookup"><span data-stu-id="ee17e-117">Using local WOFF or WOFF2 font data </span></span>](#using-local-woff-or-woff2-font-data)
    -   [<span data-ttu-id="ee17e-118">Uso di meccanismi di tipo carattere remoto DirectWrite con implementazione di rete di basso livello personalizzata </span><span class="sxs-lookup"><span data-stu-id="ee17e-118">Using DirectWrite remote font mechanisms with custom low-level network implementation </span></span>](#using-directwrite-remote-font-mechanisms-with-custom-low-level-network-implementation)
    -   [<span data-ttu-id="ee17e-119">Scenari di supporto nelle versioni precedenti di Windows </span><span class="sxs-lookup"><span data-stu-id="ee17e-119">Supporting scenarios on earlier Windows versions </span></span>](#supporting-scenarios-on-earlier-windows-versions)

## <a name="introduction"></a><span data-ttu-id="ee17e-120">Introduzione</span><span class="sxs-lookup"><span data-stu-id="ee17e-120">Introduction</span></span>

<span data-ttu-id="ee17e-121">Nella maggior parte dei casi, le app utilizzano i tipi di carattere installati localmente nel sistema.</span><span class="sxs-lookup"><span data-stu-id="ee17e-121">Most of the time, apps use the fonts that are installed locally on the system.</span></span> <span data-ttu-id="ee17e-122">DirectWrite consente di accedere a questi tipi di carattere usando i metodi [**IDWriteFactory3:: GetSystemFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontset) o [**IDWriteFactory archiviata nei:: GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-122">DirectWrite provides access to these fonts using the [**IDWriteFactory3::GetSystemFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontset) or [**IDWriteFactory::GetSystemFontCollection**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-getsystemfontcollection) methods.</span></span> <span data-ttu-id="ee17e-123">In alcuni casi, le app potrebbero anche voler usare i tipi di carattere inclusi come parte di Windows 10, ma che non sono attualmente installati nel sistema corrente.</span><span class="sxs-lookup"><span data-stu-id="ee17e-123">In some cases, apps may also want to use fonts that are included as part of Windows 10 but that are not currently installed on the current system.</span></span> <span data-ttu-id="ee17e-124">È possibile accedere a questi tipi di carattere dal servizio Windows font usando il metodo **GetSystemFontSet** oppure chiamando [**IDWriteFactory3:: GetSystemFontCollection**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontcollection) con includeDownloadableFonts impostato su true.</span><span class="sxs-lookup"><span data-stu-id="ee17e-124">Such fonts can be accessed from the Windows font service by using the **GetSystemFontSet** method, or by calling [**IDWriteFactory3::GetSystemFontCollection**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getsystemfontcollection) with includeDownloadableFonts set to TRUE.</span></span> 

<span data-ttu-id="ee17e-125">In alcuni scenari di applicazione, tuttavia, le app devono usare i tipi di carattere che non sono installati nel sistema e non vengono forniti dal servizio del tipo di carattere di Windows.</span><span class="sxs-lookup"><span data-stu-id="ee17e-125">In some application scenarios, however, apps need to use fonts that are not installed in the system and are not provided by the Windows Font Service.</span></span> <span data-ttu-id="ee17e-126">Di seguito sono riportati alcuni esempi di scenari di questo tipo:</span><span class="sxs-lookup"><span data-stu-id="ee17e-126">The following are examples of such scenarios:</span></span>

-   <span data-ttu-id="ee17e-127">I tipi di carattere vengono incorporati come risorse in un file binario dell'app.</span><span class="sxs-lookup"><span data-stu-id="ee17e-127">Fonts are embedded as resources within an app binary.</span></span>
-   <span data-ttu-id="ee17e-128">I file del tipo di carattere sono aggregati in un pacchetto dell'app e archiviati su disco nella cartella di installazione dell'app.</span><span class="sxs-lookup"><span data-stu-id="ee17e-128">Font files are bundled within an app package and stored on disk under the app’s installation folder.</span></span>
-   <span data-ttu-id="ee17e-129">L'app è uno strumento di sviluppo di tipi di carattere che deve caricare i file dei tipi di carattere specificati dall'utente.</span><span class="sxs-lookup"><span data-stu-id="ee17e-129">The app is a font-development tool that needs to load user-specified font files.</span></span> 
-   <span data-ttu-id="ee17e-130">I tipi di carattere sono incorporati nei file di documento che possono essere visualizzati o modificati nell'app.</span><span class="sxs-lookup"><span data-stu-id="ee17e-130">Fonts are embedded in document files that can be viewed or edited in the app.</span></span> 
-   <span data-ttu-id="ee17e-131">L'app usa i tipi di carattere ottenuti da un servizio Web pubblico.</span><span class="sxs-lookup"><span data-stu-id="ee17e-131">The app uses fonts obtained from a public Web font service.</span></span> 
-   <span data-ttu-id="ee17e-132">L'app usa i dati del tipo di carattere trasmessi tramite un protocollo di rete privato.</span><span class="sxs-lookup"><span data-stu-id="ee17e-132">The app uses font data streamed via a private network protocol.</span></span> 

<span data-ttu-id="ee17e-133">DirectWrite fornisce le API per l'utilizzo di tipi di carattere personalizzati in questi e in altri scenari simili.</span><span class="sxs-lookup"><span data-stu-id="ee17e-133">DirectWrite provides APIs for working with custom fonts in these and other similar scenarios.</span></span> <span data-ttu-id="ee17e-134">I dati del tipo di carattere personalizzati possono provenire da file nel file system locale; da origini remote basate sul cloud a cui si accede tramite HTTP; o da origini arbitrarie dopo che sono state caricate in un buffer di memoria.</span><span class="sxs-lookup"><span data-stu-id="ee17e-134">The custom font data might come from files in the local file system; from remote, cloud-based sources accessed using HTTP; or from arbitrary sources after having been loaded into a memory buffer.</span></span> 

> [!Note]  
> <span data-ttu-id="ee17e-135">Anche se DirectWrite ha fornito API per l'uso di tipi di carattere personalizzati a partire da Windows 7, le API più recenti sono state aggiunte in Windows 10 e di nuovo in Windows 10 Creators Update (versione di anteprima 15021 o successiva) che semplificano l'implementazione di diversi scenari citati.</span><span class="sxs-lookup"><span data-stu-id="ee17e-135">While DirectWrite has provided APIs for working with custom fonts since Windows 7, newer APIs were added in Windows 10 and again in the Windows 10 Creators Update (preview build 15021 or later) that make it easier to implement several of the scenarios mentioned.</span></span> <span data-ttu-id="ee17e-136">Questo argomento è incentrato sulle API disponibili nella finestra 10.</span><span class="sxs-lookup"><span data-stu-id="ee17e-136">This topic focuses on APIs available in Window 10.</span></span> <span data-ttu-id="ee17e-137">Per le applicazioni che devono funzionare nelle versioni precedenti di Windows, vedere [raccolte di tipi di carattere personalizzati (Windows 7/8)](custom-font-collections.md).</span><span class="sxs-lookup"><span data-stu-id="ee17e-137">For applications that need to work on earlier Windows versions, see [Custom Font Collections (Windows 7/8)](custom-font-collections.md).</span></span> 

 

## <a name="summary-of-apis"></a><span data-ttu-id="ee17e-138">Riepilogo delle API</span><span class="sxs-lookup"><span data-stu-id="ee17e-138">Summary of APIs</span></span>

<span data-ttu-id="ee17e-139">Questo argomento è incentrato sulle funzionalità fornite dalle API seguenti:</span><span class="sxs-lookup"><span data-stu-id="ee17e-139">This topic focuses on functionality provided by the following APIs:</span></span> 

-   <span data-ttu-id="ee17e-140">Interfaccia [**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset)</span><span class="sxs-lookup"><span data-stu-id="ee17e-140">[**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset) interface</span></span>
-   <span data-ttu-id="ee17e-141">Interfaccia [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder)</span><span class="sxs-lookup"><span data-stu-id="ee17e-141">[**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) interface</span></span>
-   <span data-ttu-id="ee17e-142">Interfaccia [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1)</span><span class="sxs-lookup"><span data-stu-id="ee17e-142">[**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface</span></span> 
-   <span data-ttu-id="ee17e-143">Interfaccia [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference)</span><span class="sxs-lookup"><span data-stu-id="ee17e-143">[**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) interface</span></span>
-   <span data-ttu-id="ee17e-144">Interfaccia [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile)</span><span class="sxs-lookup"><span data-stu-id="ee17e-144">[**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) interface</span></span>
-   <span data-ttu-id="ee17e-145">Metodo [**IDWriteFactory archiviata nei:: CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference)</span><span class="sxs-lookup"><span data-stu-id="ee17e-145">[**IDWriteFactory::CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) method</span></span> 
-   <span data-ttu-id="ee17e-146">Metodo [**IDWriteFactory archiviata nei:: CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference)</span><span class="sxs-lookup"><span data-stu-id="ee17e-146">[**IDWriteFactory::CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) method</span></span> 
-   <span data-ttu-id="ee17e-147">Metodi [**IDWriteFactory3:: CreateFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontresource-createfontfacereference)</span><span class="sxs-lookup"><span data-stu-id="ee17e-147">[**IDWriteFactory3::CreateFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontresource-createfontfacereference) methods</span></span> 
-   <span data-ttu-id="ee17e-148">[**DWrite \_ Struttura della \_ proprietà font**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property)</span><span class="sxs-lookup"><span data-stu-id="ee17e-148">[**DWRITE\_FONT\_PROPERTY**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property) structure</span></span> 
-   <span data-ttu-id="ee17e-149">[**DWrite \_ Enumerazione \_ \_ ID proprietà carattere**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id)</span><span class="sxs-lookup"><span data-stu-id="ee17e-149">[**DWRITE\_FONT\_PROPERTY\_ID**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) enumeration</span></span> 
-   <span data-ttu-id="ee17e-150">Interfaccia [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)</span><span class="sxs-lookup"><span data-stu-id="ee17e-150">[**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) interface</span></span> 
-   <span data-ttu-id="ee17e-151">Metodo [**IDWriteFactory archiviata nei:: RegisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontfileloader)</span><span class="sxs-lookup"><span data-stu-id="ee17e-151">[**IDWriteFactory::RegisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-registerfontfileloader) method</span></span> 
-   <span data-ttu-id="ee17e-152">Metodo [**IDWriteFactory archiviata nei:: UnregisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontfileloader)</span><span class="sxs-lookup"><span data-stu-id="ee17e-152">[**IDWriteFactory::UnregisterFontFileLoader**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-unregisterfontfileloader) method</span></span> 
-   <span data-ttu-id="ee17e-153">Metodo [**IDWriteFactory5:: CreateInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createinmemoryfontfileloader)</span><span class="sxs-lookup"><span data-stu-id="ee17e-153">[**IDWriteFactory5::CreateInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createinmemoryfontfileloader) method</span></span> 
-   <span data-ttu-id="ee17e-154">Interfaccia [**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader)</span><span class="sxs-lookup"><span data-stu-id="ee17e-154">[**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader) interface</span></span> 
-   <span data-ttu-id="ee17e-155">Metodo [**IDWriteFactory5:: CreateHttpFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createhttpfontfileloader)</span><span class="sxs-lookup"><span data-stu-id="ee17e-155">[**IDWriteFactory5::CreateHttpFontFileLoader**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-createhttpfontfileloader) method</span></span> 
-   <span data-ttu-id="ee17e-156">Interfaccia [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader)</span><span class="sxs-lookup"><span data-stu-id="ee17e-156">[**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader) interface</span></span> 
-   <span data-ttu-id="ee17e-157">Interfaccia [**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue)</span><span class="sxs-lookup"><span data-stu-id="ee17e-157">[**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue) interface</span></span> 
-   <span data-ttu-id="ee17e-158">Interfaccia [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener)</span><span class="sxs-lookup"><span data-stu-id="ee17e-158">[**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface</span></span> 
-   <span data-ttu-id="ee17e-159">Interfaccia [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)</span><span class="sxs-lookup"><span data-stu-id="ee17e-159">[**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) interface</span></span> 
-   <span data-ttu-id="ee17e-160">Interfaccia [**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream)</span><span class="sxs-lookup"><span data-stu-id="ee17e-160">[**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream) interface</span></span> 
-   <span data-ttu-id="ee17e-161">Interfaccia [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult)</span><span class="sxs-lookup"><span data-stu-id="ee17e-161">[**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult) interface</span></span> 
-   <span data-ttu-id="ee17e-162">Metodo [**IDWriteFactory5:: AnalyzeContainerType**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-analyzecontainertype)</span><span class="sxs-lookup"><span data-stu-id="ee17e-162">[**IDWriteFactory5::AnalyzeContainerType**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-analyzecontainertype) method</span></span> 
-   <span data-ttu-id="ee17e-163">Metodo [**IDWriteFactory5:: UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile)</span><span class="sxs-lookup"><span data-stu-id="ee17e-163">[**IDWriteFactory5::UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile) method</span></span> 

 

## <a name="key-concepts"></a><span data-ttu-id="ee17e-164">Concetti chiave</span><span class="sxs-lookup"><span data-stu-id="ee17e-164">Key concepts</span></span>

<span data-ttu-id="ee17e-165">Per comprendere le API DirectWrite per l'uso di tipi di carattere personalizzati, può essere utile comprendere il modello concettuale che sottende tali API.</span><span class="sxs-lookup"><span data-stu-id="ee17e-165">To understand the DirectWrite APIs for working with custom fonts, it can be helpful to understand the conceptual model that underlies these APIs.</span></span> <span data-ttu-id="ee17e-166">I concetti chiave verranno descritti qui.</span><span class="sxs-lookup"><span data-stu-id="ee17e-166">Key concepts will be described here.</span></span> 

<span data-ttu-id="ee17e-167">Quando DirectWrite esegue il layout o il rendering del testo effettivo, deve accedere ai dati dei tipi di carattere effettivi.</span><span class="sxs-lookup"><span data-stu-id="ee17e-167">When DirectWrite does actual text layout or rendering, it needs to access actual font data.</span></span> <span data-ttu-id="ee17e-168">Un oggetto del tipo di carattere contiene i dati del tipo di carattere effettivi che devono esistere nel sistema locale.</span><span class="sxs-lookup"><span data-stu-id="ee17e-168">A font face object holds actual font data, which must exist in the local system.</span></span> <span data-ttu-id="ee17e-169">Tuttavia, per altre operazioni, ad esempio per controllare la disponibilità di un particolare tipo di carattere o per presentare scelte di tipi di carattere a un utente, è sufficiente un riferimento a un particolare tipo di carattere, non i dati effettivi del tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-169">But for other operations, such as checking availability of a particular font, or presenting font choices to a user, all that is needed is a reference to a particular font, not the actual font data itself.</span></span> <span data-ttu-id="ee17e-170">In DirectWrite un oggetto di riferimento del tipo di carattere include solo le informazioni necessarie per individuare e creare un'istanza di un tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-170">In DirectWrite, a font face reference object holds just the information needed to locate and instantiate a font.</span></span> <span data-ttu-id="ee17e-171">Poiché il riferimento al tipo di carattere non tiene i dati effettivi, DirectWrite può gestire i riferimenti del tipo di carattere per i quali i dati effettivi si trovano in un percorso di rete remoto, nonché quando i dati effettivi sono locali.</span><span class="sxs-lookup"><span data-stu-id="ee17e-171">Because the font face reference doesn’t hold actual data, DirectWrite can deal with font face references for which actual data is in a remote network location as well as when the actual data is local.</span></span>

<span data-ttu-id="ee17e-172">Un set di caratteri è un set di riferimenti del tipo di carattere, insieme ad alcune proprietà informative di base che possono essere utilizzate per fare riferimento al tipo di carattere o per confrontarlo con altri tipi di carattere, ad esempio il nome della famiglia o un valore del tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-172">A font set is a set of font face references, along with certain basic, informational properties that can be used in referring to the font or in comparing it to other fonts, such as the family name, or a font-weight value.</span></span> <span data-ttu-id="ee17e-173">I dati effettivi per i vari tipi di carattere possono essere locali, oppure possono essere tutti remoti o una combinazione.</span><span class="sxs-lookup"><span data-stu-id="ee17e-173">The actual data for the various fonts may be local, or it may all be remote, or some mixture.</span></span>

<span data-ttu-id="ee17e-174">Un set di caratteri può essere usato per ottenere un oggetto della raccolta dei tipi di carattere corrispondente.</span><span class="sxs-lookup"><span data-stu-id="ee17e-174">A font set can be used to obtain a corresponding font collection object.</span></span> <span data-ttu-id="ee17e-175">Per ulteriori informazioni, vedere set di caratteri e raccolte di tipi di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-175">See Font sets and font collections below for more details.</span></span> 

<span data-ttu-id="ee17e-176">L'interfaccia IDWriteFontSet fornisce metodi che consentono di eseguire query per i valori delle proprietà, ad esempio il nome della famiglia o il tipo di carattere, oppure per i riferimenti del tipo di carattere che corrispondono a valori di proprietà specifici.</span><span class="sxs-lookup"><span data-stu-id="ee17e-176">The IDWriteFontSet interface provides methods that allow querying for property values such as family name or font-weight, or for font face references that match particular property values.</span></span> <span data-ttu-id="ee17e-177">Dopo aver filtrato fino a una particolare selezione, è possibile ottenere un'istanza dell'interfaccia [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) , con metodi per il download (se i dati effettivi del tipo di carattere sono attualmente remoti), per ottenere l'oggetto [**IDWriteFontFace3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontface3) corrispondente che può essere utilizzato per il layout e il rendering.</span><span class="sxs-lookup"><span data-stu-id="ee17e-177">After filtering down to a particular selection, an instance of the [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) interface can be obtained, with methods for downloading (if the actual font data is currently remote), for obtaining the corresponding [**IDWriteFontFace3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontface3) object that can be used for layout and rendering.</span></span> 

<span data-ttu-id="ee17e-178">L'interfaccia IDWriteFontFile è sottostanti ogni tipo di carattere o riferimento al tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-178">The IDWriteFontFile interface underlies each font face or font face reference.</span></span> <span data-ttu-id="ee17e-179">Rappresenta il percorso di un file del tipo di carattere e presenta due componenti: un caricatore di file del tipo di carattere e una chiave del file del tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-179">This represents the location of a font file, and has two components: a font file loader, and a font file key.</span></span> <span data-ttu-id="ee17e-180">Il caricatore di file del tipo di carattere ([**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)) viene usato per aprire un file, se necessario, e restituisce un flusso con i dati ([**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)).</span><span class="sxs-lookup"><span data-stu-id="ee17e-180">The font file loader ([**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader)) is used to open a file if needed, and returns a stream with the data ([**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream)).</span></span> <span data-ttu-id="ee17e-181">A seconda del caricatore, i dati possono trovarsi in un percorso di file locale, in un URL remoto o in un buffer di memoria.</span><span class="sxs-lookup"><span data-stu-id="ee17e-181">Depending on the loader, the data may be located at a local file path, a remote URL, or in a memory buffer.</span></span> <span data-ttu-id="ee17e-182">La chiave è un valore definito dal caricatore che identifica in modo univoco il file all'interno del contesto del caricatore, consentendo al caricatore di individuare i dati e creare un flusso per tale file.</span><span class="sxs-lookup"><span data-stu-id="ee17e-182">The key is a loader-defined value that uniquely identifies the file within the loader context, allowing the loader to locate the data and create a stream for it.</span></span> 

<span data-ttu-id="ee17e-183">I tipi di carattere personalizzati possono essere facilmente aggiunti a un set di caratteri personalizzato, che a sua volta può essere utilizzato per filtrare o organizzare informazioni sui tipi di carattere per scopi quali la creazione di un'interfaccia utente di selezione del tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-183">Custom fonts can easily be added to a custom font set, which in turn can be used for filtering or organizing font information for purposes such as creating a font-picker user interface.</span></span> <span data-ttu-id="ee17e-184">Il set di caratteri può essere usato anche per creare una raccolta di tipi di carattere da usare in API di livello superiore, ad esempio [**IDWriteTextFormat**](/windows/win32/api/dwrite/nn-dwrite-idwritetextformat) e [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout).</span><span class="sxs-lookup"><span data-stu-id="ee17e-184">The font set can also be used to create a font collection for use in higher-level APIs like [**IDWriteTextFormat**](/windows/win32/api/dwrite/nn-dwrite-idwritetextformat) and [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout).</span></span> <span data-ttu-id="ee17e-185">L'interfaccia [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) può essere usata per creare un set di caratteri personalizzato che include diversi tipi di carattere personalizzati.</span><span class="sxs-lookup"><span data-stu-id="ee17e-185">The [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) interface can be used to create a custom font set that includes several custom fonts.</span></span> <span data-ttu-id="ee17e-186">Può anche essere usato per creare un set di caratteri personalizzato che combina tipi di carattere personalizzati e tipi di carattere forniti dal sistema; o che combina i tipi di carattere con origini diverse per i dati effettivi, ovvero archiviazione locale, URL remoti e memoria.</span><span class="sxs-lookup"><span data-stu-id="ee17e-186">It can also be used to create a custom font set that mixes custom fonts and system-provided fonts; or that mixes fonts with different sources for the actual data — local storage, remote URLs, and memory.</span></span> 

<span data-ttu-id="ee17e-187">Come indicato in precedenza, un riferimento del tipo di carattere può fare riferimento ai dati del tipo di carattere in un'origine remota, ma i dati devono essere locali per ottenere un oggetto del tipo di carattere che può essere utilizzato per il layout e il rendering.</span><span class="sxs-lookup"><span data-stu-id="ee17e-187">As mentioned, a font face reference may refer to font data at a remote source, but the data must be local in order to obtain a font face object that can be used for layout and rendering.</span></span> <span data-ttu-id="ee17e-188">Il download dei dati remoti viene gestito da una coda di download del tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-188">Downloading of remote data is handled by a font download queue.</span></span> <span data-ttu-id="ee17e-189">Le app possono usare l'interfaccia [**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue) per accodare le richieste di download dei tipi di carattere remoti per avviare il processo di download e per registrare un oggetto [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) per eseguire un'azione al termine del processo di download.</span><span class="sxs-lookup"><span data-stu-id="ee17e-189">Apps can use the [**IDWriteFontDownloadQueue**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadqueue) interface to enqueue requests to download remote fonts to initiate the download process, and to register an [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) object to take action when the download process has completed.</span></span> 

<span data-ttu-id="ee17e-190">Per la maggior parte delle interfacce descritte di seguito, DirectWrite fornisce le implementazioni di sistema.</span><span class="sxs-lookup"><span data-stu-id="ee17e-190">For most of the interfaces described here, DirectWrite provides system implementations.</span></span> <span data-ttu-id="ee17e-191">L'unica eccezione è l'interfaccia [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) , implementata da un'app per eseguire azioni specifiche dell'app quando i tipi di carattere remoti sono stati scaricati localmente.</span><span class="sxs-lookup"><span data-stu-id="ee17e-191">The one exception is the [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface, which an app implements to take app-specific actions when remote fonts have been downloaded locally.</span></span> <span data-ttu-id="ee17e-192">Le app possono avere un motivo per fornire le proprie implementazioni personalizzate per determinate altre interfacce, sebbene siano necessarie solo in scenari specifici e più avanzati.</span><span class="sxs-lookup"><span data-stu-id="ee17e-192">Apps may have reason to provide their own custom implementations for certain other interfaces, though that would only be needed in specific, more advanced scenarios.</span></span> <span data-ttu-id="ee17e-193">Ad esempio, un'app deve fornire un'implementazione personalizzata dell'interfaccia [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) per gestire i file del tipo di carattere nell'archivio locale che usano il formato del contenitore WOFF2.</span><span class="sxs-lookup"><span data-stu-id="ee17e-193">For example, an app would need to provide a custom implementation of the [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) interface to handle font files in local storage that use the WOFF2 container format.</span></span> <span data-ttu-id="ee17e-194">Di seguito sono riportati altri dettagli.</span><span class="sxs-lookup"><span data-stu-id="ee17e-194">Additional details will be provided below.</span></span> 

## <a name="fonts-and-font-file-formats"></a><span data-ttu-id="ee17e-195">Tipi di carattere e formati di file dei tipi di carattere</span><span class="sxs-lookup"><span data-stu-id="ee17e-195">Fonts and font file formats</span></span>

<span data-ttu-id="ee17e-196">Un altro concetto chiave utile da comprendere è la relazione tra i singoli tipi di carattere e i file del tipo di carattere che li contengono.</span><span class="sxs-lookup"><span data-stu-id="ee17e-196">Another key concept that is helpful to understand is the relationship between individual font faces and font files that contain them.</span></span> <span data-ttu-id="ee17e-197">L'idea di un file del tipo di carattere OpenType (. ttf o. otf) che contiene un solo tipo di carattere è familiare.</span><span class="sxs-lookup"><span data-stu-id="ee17e-197">The idea of an OpenType font file (.ttf or .otf) containing a single font is familiar.</span></span> <span data-ttu-id="ee17e-198">Il formato del carattere OpenType, tuttavia, consente anche una raccolta di tipi di carattere OpenType (. TTC o. OTC), che è un singolo file che contiene più tipi di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-198">But the OpenType font format also allows for an OpenType Font Collection (.ttc or .otc), which is a single file that contains multiple fonts.</span></span> <span data-ttu-id="ee17e-199">I file di raccolta OpenType vengono spesso usati per i tipi di carattere di grandi dimensioni strettamente correlati e hanno valori identici per determinati dati del tipo di carattere: combinando i tipi di carattere in un singolo file, i dati comuni possono essere deduplicati.</span><span class="sxs-lookup"><span data-stu-id="ee17e-199">OpenType Collection files are often used for large fonts that are closely related and have identical values for certain font data: by combining the fonts in a single file, the common data can be de-duplicated.</span></span> <span data-ttu-id="ee17e-200">Per questo motivo, un tipo di carattere o un riferimento al tipo di carattere deve riferirsi non solo a un file del tipo di carattere (o a un'origine dati equivalente), ma deve anche specificare un indice del tipo di carattere all'interno di tale file, per il caso generale in cui il file può essere un file di raccolta.</span><span class="sxs-lookup"><span data-stu-id="ee17e-200">For this reason, a font face or font face reference needs to refer not only to a font file (or equivalent data source), but it must also specify a font index within that file, for the general case in which the file may be a Collection file.</span></span> 

<span data-ttu-id="ee17e-201">Per i tipi di carattere utilizzati sul Web, i dati del tipo di carattere vengono spesso compressi in determinati formati di contenitore, WOFF o WOFF2, che forniscono una compressione dei dati del tipo di carattere e un certo livello di protezione contro la pirateria e la violazione delle licenze dei tipi di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-201">For fonts used on the Web, font data is often packed into certain container formats, WOFF or WOFF2, which provide some compression of the font data and some level of protection against piracy and violation of font licenses.</span></span> <span data-ttu-id="ee17e-202">Dal punto di vista funzionale, un file WOFF o WOFF2 equivale a un file di tipo carattere o di raccolta di tipi di carattere OpenType, ma i dati vengono codificati in un formato diverso che richiede la decompressione prima di poterlo usare.</span><span class="sxs-lookup"><span data-stu-id="ee17e-202">Functionally, a WOFF or WOFF2 file is equivalent to an OpenType font or Font Collection file, but the data is encoded in a different format that requires unpacking before it can be used.</span></span> 

<span data-ttu-id="ee17e-203">Alcune API DirectWrite possono gestire i singoli tipi di carattere, mentre altre API possono gestire file che potrebbero includere file di raccolta OpenType che contengono più visi.</span><span class="sxs-lookup"><span data-stu-id="ee17e-203">Certain DirectWrite APIs may deal with individual font faces, while other APIs can handle files that might include OpenType Collection files that contain multiple faces.</span></span> <span data-ttu-id="ee17e-204">Analogamente, alcune API gestiscono solo i dati in formato OpenType non elaborati, mentre altre API possono gestire i formati di contenitori compressi, WOFF e WOFF2.</span><span class="sxs-lookup"><span data-stu-id="ee17e-204">Similarly, certain APIs deal only with raw, OpenType-format data, while other APIs can handle the packed, WOFF and WOFF2 container formats.</span></span> <span data-ttu-id="ee17e-205">Questi dettagli sono riportati nella discussione riportata di seguito.</span><span class="sxs-lookup"><span data-stu-id="ee17e-205">These details are provided in the discussion below.</span></span> 

## <a name="font-sets-and-font-collections"></a><span data-ttu-id="ee17e-206">Set di caratteri e raccolte di tipi di carattere</span><span class="sxs-lookup"><span data-stu-id="ee17e-206">Font sets and font collections</span></span>

<span data-ttu-id="ee17e-207">Alcune applicazioni possono essere implementate per lavorare con i tipi di carattere usando l'interfaccia [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-207">Some applications may be implemented to work with fonts using the [**IDWriteFontCollection**](/windows/win32/api/dwrite/nn-dwrite-idwritefontcollection) interface.</span></span> <span data-ttu-id="ee17e-208">Esiste una corrispondenza diretta tra una raccolta di tipi di carattere e un set di caratteri.</span><span class="sxs-lookup"><span data-stu-id="ee17e-208">There is a direct correspondence between a font collection and a font set.</span></span> <span data-ttu-id="ee17e-209">Ognuno può mantenere gli stessi tipi di carattere, ma li presenta con un'altra organizzazione.</span><span class="sxs-lookup"><span data-stu-id="ee17e-209">Each can hold the same fonts, but they present them with a different organization.</span></span> <span data-ttu-id="ee17e-210">Da qualsiasi raccolta di tipi di carattere, è possibile ottenere un set di caratteri corrispondente e viceversa.</span><span class="sxs-lookup"><span data-stu-id="ee17e-210">From any font collection, a corresponding font set can be obtained, and vice versa.</span></span>

<span data-ttu-id="ee17e-211">Quando si lavora con un numero di tipi di carattere personalizzati, è più semplice usare un'interfaccia del generatore di set di caratteri per creare un set di caratteri personalizzato e quindi ottenere una raccolta di tipi di carattere dopo la creazione del set di caratteri.</span><span class="sxs-lookup"><span data-stu-id="ee17e-211">When working with a number of custom fonts, it is easiest to use a font set builder interface to create a custom font set, and then obtain a font collection after the font set is created.</span></span> <span data-ttu-id="ee17e-212">Il processo per la creazione di un set di caratteri personalizzato verrà descritto in dettaglio di seguito.</span><span class="sxs-lookup"><span data-stu-id="ee17e-212">The process for creating a custom font set will be described in detail below.</span></span> <span data-ttu-id="ee17e-213">Per ottenere un'interfaccia [**IDWriteFontCollection1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontcollection1) da un set di caratteri, viene usato il metodo [**IDWriteFactory3:: CreateFontCollectionFromFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-createfontcollectionfromfontset) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-213">To obtain an [**IDWriteFontCollection1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontcollection1) interface from a font set, the [**IDWriteFactory3::CreateFontCollectionFromFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-createfontcollectionfromfontset) method is used.</span></span>

<span data-ttu-id="ee17e-214">Se l'app dispone di un oggetto raccolta ed è necessario ottenere un set di caratteri corrispondente, è possibile eseguire questa operazione usando il metodo [**IDWriteFontCollection1:: Getfontt**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontcollection1-getfontset) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-214">If the app has a collection object and needs to obtain a corresponding font set, this can be done using the [**IDWriteFontCollection1::GetFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontcollection1-getfontset) method.</span></span> 

## <a name="common-scenarios"></a><span data-ttu-id="ee17e-215">Scenari comuni</span><span class="sxs-lookup"><span data-stu-id="ee17e-215">Common scenarios</span></span>

<span data-ttu-id="ee17e-216">In questa sezione vengono descritti alcuni degli scenari più comuni che coinvolgono i set di caratteri personalizzati:</span><span class="sxs-lookup"><span data-stu-id="ee17e-216">This section describes some of the most common scenarios involving custom font sets:</span></span>

-   <span data-ttu-id="ee17e-217">Creazione di un set di caratteri personalizzato utilizzando tipi di carattere arbitrari nei percorsi della file system locale.</span><span class="sxs-lookup"><span data-stu-id="ee17e-217">Creating a custom font set using arbitrary fonts at paths in the local file system.</span></span>
-   <span data-ttu-id="ee17e-218">Creazione di un set di caratteri personalizzato con i tipi di carattere noti, ad esempio in bundle con l'app, archiviati nella file system locale.</span><span class="sxs-lookup"><span data-stu-id="ee17e-218">Creating a custom font set using known fonts (perhaps bundled with the app) that are stored in the local file system.</span></span>
-   <span data-ttu-id="ee17e-219">Creazione di un set di caratteri personalizzato utilizzando tipi di carattere remoti noti sul Web.</span><span class="sxs-lookup"><span data-stu-id="ee17e-219">Creating a custom font set using known, remote fonts on the Web.</span></span>
-   <span data-ttu-id="ee17e-220">Creazione di un set di caratteri personalizzato utilizzando i dati del tipo di carattere caricati in memoria.</span><span class="sxs-lookup"><span data-stu-id="ee17e-220">Creating a custom font set using font data loaded into memory.</span></span>

<span data-ttu-id="ee17e-221">Le implementazioni complete per questi scenari sono disponibili nell' [esempio di set di caratteri personalizzati DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span><span class="sxs-lookup"><span data-stu-id="ee17e-221">Complete implementations for these scenarios are provided in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span></span> <span data-ttu-id="ee17e-222">Questo esempio illustra anche uno scenario più avanzato per la gestione dei dati del tipo di carattere compressi nei formati di contenitore WOFF o WOFF2, che verranno illustrati di seguito.</span><span class="sxs-lookup"><span data-stu-id="ee17e-222">That sample also illustrates one more advanced scenario for handling font data packed in WOFF or WOFF2 container formats, which will be discussed below.</span></span> 

### <a name="creating-a-font-set-using-arbitrary-fonts-in-the-local-file-system"></a><span data-ttu-id="ee17e-223">Creazione di un set di caratteri utilizzando tipi di carattere arbitrari nell'file system locale</span><span class="sxs-lookup"><span data-stu-id="ee17e-223">Creating a font set using arbitrary fonts in the local file system</span></span>

<span data-ttu-id="ee17e-224">Quando si gestisce un set arbitrario di file di tipi di carattere nella risorsa di archiviazione locale, il metodo [**IDWriteFontSetBuilder1:: AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) è utile in quanto, in una singola chiamata, può gestire tutti i visi dei tipi di carattere all'interno di un file di raccolta dei tipi di carattere OpenType, nonché tutte le istanze per un tipo di carattere della variabile OpenType.</span><span class="sxs-lookup"><span data-stu-id="ee17e-224">When dealing with an arbitrary set of font files in local storage, the [**IDWriteFontSetBuilder1::AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method is convenient since, in a single call, it can handle all of the font faces within an OpenType Font Collection file, as well as all instances for an OpenType variable font.</span></span> <span data-ttu-id="ee17e-225">Questa opzione è disponibile in Windows 10 Creators Update (versione di anteprima 15021 o successiva) ed è consigliata ogni volta che è disponibile.</span><span class="sxs-lookup"><span data-stu-id="ee17e-225">This is available in the Windows 10 Creators Update (preview build 15021 or later), and is recommended whenever available.</span></span> 

<span data-ttu-id="ee17e-226">Per usare questo metodo, usare il processo seguente.</span><span class="sxs-lookup"><span data-stu-id="ee17e-226">To use this method, use the following process.</span></span>

<dl> <span data-ttu-id="ee17e-227">1. Per iniziare, creare l'interfaccia <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5">IDWriteFactory5</a> :</span><span class="sxs-lookup"><span data-stu-id="ee17e-227">1. Start by creating the <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5">IDWriteFactory5</a> interface:</span></span> 


```C++
IDWriteFactory5* pDWriteFactory; 
HRESULT hr = DWriteCreateFactory( 
  DWRITE_FACTORY_TYPE_SHARED, 
  __uuidof(IDWriteFactory5), 
  reinterpret_cast<IUnknown**>(&pDWriteFactory) 
); 
```



   
2. <span data-ttu-id="ee17e-228">Usare la factory per ottenere l' <a href=""></a> interfaccia [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) :</span><span class="sxs-lookup"><span data-stu-id="ee17e-228">Use the factory to obtain the <a href=""></a>[**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface:</span></span> 


```C++
IDWriteFontSetBuilder1* pFontSetBuilder; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontSetBuilder(&pFontSetBuilder); 
}  
                
```



  
3. <span data-ttu-id="ee17e-229">Per ogni file del tipo di carattere nel file system locale, creare un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) che vi faccia riferimento:</span><span class="sxs-lookup"><span data-stu-id="ee17e-229">For each font file in the local file system, create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) that refers to it:</span></span> 


```C++
IDWriteFontFile* pFontFile; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontFileReference(pFilePath, /* lastWriteTime*/ nullptr, &pFontFile); 
} 
```



   
4. <span data-ttu-id="ee17e-230">Aggiungere l'oggetto [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) al generatore del set di caratteri usando il metodo [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) :</span><span class="sxs-lookup"><span data-stu-id="ee17e-230">Add the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object to the font set builder using the [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method:</span></span> 


```C++
hr = pFontSetBuilder->AddFontFile(pFontFile); 
```

<span data-ttu-id="ee17e-231">Se il percorso del file specificato nella chiamata a [**CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) fa riferimento a un elemento diverso da un file OpenType supportato, la chiamata a [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) restituirà un errore, DWrite \_ E \_ FileFormat.</span><span class="sxs-lookup"><span data-stu-id="ee17e-231">If the file path specified in the call to [**CreateFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createfontfilereference) referred to something other than a supported OpenType file, then the call to [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) will return an error, DWRITE\_E\_FILEFORMAT.</span></span>

5. <span data-ttu-id="ee17e-232">Una volta che tutti i file sono stati aggiunti al generatore del set di caratteri, è possibile creare il set di caratteri personalizzato:</span><span class="sxs-lookup"><span data-stu-id="ee17e-232">After all of the files have been added to the font set builder, the custom font set can be created:</span></span> 


```C++
IDWriteFontSet* pFontSet; 
hr = pFontSetBuilder->CreateFontSet(&pFontSet); 
```



   
</dl>

<span data-ttu-id="ee17e-233">Se l'app deve essere eseguita in versioni di Windows 10 precedenti a Windows 10 Creators Update, il metodo AddFontFile non sarà disponibile.</span><span class="sxs-lookup"><span data-stu-id="ee17e-233">If the app needs to run on Windows 10 versions earlier than the Windows 10 Creators Update, then the AddFontFile method will not be available.</span></span> <span data-ttu-id="ee17e-234">La disponibilità può essere rilevata creando un'interfaccia [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) e quindi usando QueryInterface per provare a ottenere un'interfaccia [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) : se l'operazione ha esito positivo, saranno disponibili anche l'interfaccia [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) e il metodo [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-234">Availability can be detected by creating an [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) interface and then using QueryInterface to try to obtain an [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) interface: if this succeeds, then the [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface and [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method will also be available.</span></span>

<span data-ttu-id="ee17e-235">Se il metodo AddFontFile non è disponibile, è necessario usare il metodo [**IDWriteFontSetBuilder:: AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) per aggiungere singoli visi del tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-235">If the AddFontFile method is not available, then the [**IDWriteFontSetBuilder::AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method must be used to add individual font faces.</span></span> <span data-ttu-id="ee17e-236">Per consentire i file della raccolta dei tipi di carattere OpenType che contengono più visi, è possibile usare il metodo [**IDWriteFontFile:: Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) per determinare il numero di visi contenuti all'interno del file.</span><span class="sxs-lookup"><span data-stu-id="ee17e-236">To allow for OpenType Font Collection files that contain multiple faces, the [**IDWriteFontFile::Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) method can be used to determine the number of faces contained within the file.</span></span> <span data-ttu-id="ee17e-237">Il processo è il seguente.</span><span class="sxs-lookup"><span data-stu-id="ee17e-237">The process is as follows.</span></span>

<dl> <span data-ttu-id="ee17e-238">1. Per iniziare, creare l'interfaccia <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3">IDWriteFactory3</a> :</span><span class="sxs-lookup"><span data-stu-id="ee17e-238">1. Start by creating the <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3">IDWriteFactory3</a> interface:</span></span> 


```C++
IDWriteFactory3* pDWriteFactory; 
HRESULT hr = DWriteCreateFactory( 
DWRITE_FACTORY_TYPE_SHARED, 
  __uuidof(IDWriteFactory5), 
  reinterpret_cast<IUnknown**>(&pDWriteFactory) 
); 
```



  
2. <span data-ttu-id="ee17e-239">Usare la factory per ottenere l'interfaccia [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) :</span><span class="sxs-lookup"><span data-stu-id="ee17e-239">Use the factory to obtain the [**IDWriteFontSetBuilder**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder) interface:</span></span> 


```C++
IDWriteFontSetBuilder* pFontSetBuilder; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontSetBuilder(&pFontSetBuilder); 
} 
```



  
3. <span data-ttu-id="ee17e-240">Per ogni file del tipo di carattere, creare un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), come descritto in precedenza:</span><span class="sxs-lookup"><span data-stu-id="ee17e-240">For each font file, create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), as above:</span></span> 


```C++
IDWriteFontFile* pFontFile; 
if (SUCCEEDED(hr)) 
{ 
  hr = pDWriteFactory->CreateFontFileReference(pFilePath, /* lastWriteTime*/ nullptr, &pFontFile); 
} 
```



<span data-ttu-id="ee17e-241">Anziché aggiungere il file direttamente al generatore del set di caratteri, è necessario determinare il numero di visi e creare singoli oggetti [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-241">Instead of adding the file directly to the font set builder, we need to determine the number of faces and create individual [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) objects.</span></span>   
4. <span data-ttu-id="ee17e-242">Usare il metodo [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) per ottenere il numero di visi nel file.</span><span class="sxs-lookup"><span data-stu-id="ee17e-242">Use the [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) method to get the number of faces in the file.</span></span> 


```C++
BOOL isSupported; 
DWRITE_FONT_FILE_TYPE fileType; 
UINT32 numberOfFonts; 
hr = pFontFile->Analyze(&isSupported, &fileType, /* face type */ nullptr, &numberOfFonts); 
```



<span data-ttu-id="ee17e-243">Il metodo [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) imposterà inoltre i valori per i parametri e di FileType supportati.</span><span class="sxs-lookup"><span data-stu-id="ee17e-243">The [**Analyze**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfile-analyze) method will also set values for the isSupported and fileType parameters.</span></span> <span data-ttu-id="ee17e-244">Se il formato del file non è supportato, l'oggetto sarà supportato da FALSE e sarà possibile eseguire un'azione appropriata, ad esempio ignorando il file.</span><span class="sxs-lookup"><span data-stu-id="ee17e-244">If the file is not a supported format, then isSupported will be FALSE, and appropriate action, such as ignoring the file, can be taken.</span></span>   
5. <span data-ttu-id="ee17e-245">Ciclo sul numero di tipi di carattere impostati nel parametro numberOfFonts.</span><span class="sxs-lookup"><span data-stu-id="ee17e-245">Loop over the number of fonts set in the numberOfFonts parameter.</span></span> <span data-ttu-id="ee17e-246">All'interno del ciclo, creare un [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) per ogni coppia di file/indice e aggiungerlo al generatore del set di caratteri.</span><span class="sxs-lookup"><span data-stu-id="ee17e-246">Within the loop, create an [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) for each file/index pair, and add that to the font set builder.</span></span> 


```C++
for (uint32_t fontIndex = 0; fontIndex < numberOfFonts; fontIndex++) 
{ 
  IDWriteFontFaceReference* pFontFaceReference;
  hr = pDWriteFactory->CreateFontFaceReference(pFontFile, fontIndex, DWRITE_FONT_SIMULATIONS_NONE, &pFontFaceReference);

  if (SUCCEEDED(hr))
  {
    hr = pFontSetBuilder->AddFontFaceReference(pFontFaceReference);
  }
} 
```



  
6. <span data-ttu-id="ee17e-247">Una volta aggiunti tutti i visi al generatore del set di caratteri, creare il set di caratteri personalizzato, come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-247">After all the faces have been added to the font set builder, create the custom font set, as shown above.</span></span>  
</dl>

<span data-ttu-id="ee17e-248">Un'app può essere progettata in modo da usare il metodo [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) preferito durante l'esecuzione in Windows 10 Creators Update, ma eseguire il fallback per usare il metodo [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) quando si eseguono versioni precedenti di Windows 10.</span><span class="sxs-lookup"><span data-stu-id="ee17e-248">An app can be designed so that it will use the preferred [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method when running on the Windows 10 Creators Update, but fall back to use the [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method when running on earlier Windows 10 versions.</span></span> <span data-ttu-id="ee17e-249">Verificare la disponibilità dell'interfaccia [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) , come descritto in precedenza, quindi creare un branch di conseguenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-249">Test for availability of the [**IDWriteFactory5**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory5) interface, as described above, and then branch accordingly.</span></span> <span data-ttu-id="ee17e-250">Questo approccio è illustrato nell' [esempio di set di caratteri personalizzati DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span><span class="sxs-lookup"><span data-stu-id="ee17e-250">This approach is illustrated in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span></span> 

### <a name="creating-a-font-set-using-known-fonts-in-the-local-file-system"></a><span data-ttu-id="ee17e-251">Creazione di un set di caratteri utilizzando i tipi di carattere noti nella file system locale</span><span class="sxs-lookup"><span data-stu-id="ee17e-251">Creating a font set using known fonts in the local file system</span></span>

<span data-ttu-id="ee17e-252">Come indicato in precedenza, ogni riferimento al tipo di carattere in un set di caratteri è associato a determinate proprietà informative, ad esempio il nome della famiglia e il peso del carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-252">As mentioned above, each font face reference in a font set is associated with certain informational properties, such as family name and font weight.</span></span> <span data-ttu-id="ee17e-253">Quando si aggiungono tipi di carattere personalizzati a un generatore di set di caratteri usando le chiamate API elencate in precedenza, queste proprietà informative vengono ottenute direttamente dai dati del tipo di carattere effettivi, che viene letto quando viene aggiunto il tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-253">When custom fonts are added to a font set builder using the API calls listed above, these informational properties are obtained directly from the actual font data, which is read as the font is added.</span></span> <span data-ttu-id="ee17e-254">In alcune situazioni, tuttavia, se un'app ha un'altra fonte di informazioni su un tipo di carattere, potrebbe essere necessario fornire i propri valori personalizzati per queste proprietà.</span><span class="sxs-lookup"><span data-stu-id="ee17e-254">In some situations, however, if an app has another source of information about a font, it might wish to provide its own custom values for these properties.</span></span> 

<span data-ttu-id="ee17e-255">Come esempio di questo può essere utile, si supponga che un'app bundle alcuni tipi di carattere usati per presentare particolari elementi dell'interfaccia utente all'interno dell'app.</span><span class="sxs-lookup"><span data-stu-id="ee17e-255">As an example of how this might be useful, suppose an app bundles some fonts that are used for presenting particular user-interface elements within the app.</span></span> <span data-ttu-id="ee17e-256">In alcuni casi, ad esempio con una nuova versione dell'app, potrebbe essere necessario modificare i tipi di carattere specifici usati dall'app per questi elementi.</span><span class="sxs-lookup"><span data-stu-id="ee17e-256">At times, such as with a new app version, the specific fonts that the app uses for these elements may need to change.</span></span> <span data-ttu-id="ee17e-257">Se l'app contiene riferimenti codificati a tipi di carattere specifici, la sostituzione di un tipo di carattere con un altro richiede la modifica di ognuno di questi riferimenti.</span><span class="sxs-lookup"><span data-stu-id="ee17e-257">If the app has encoded references to the specific fonts, then replacement of one font with another will require changing every one of those references.</span></span> <span data-ttu-id="ee17e-258">Al contrario, se l'app usa proprietà personalizzate per assegnare alias funzionali in base al tipo di elemento o al testo di cui viene eseguito il rendering, esegue il mapping di ogni alias a un tipo di carattere specifico in un'unica posizione e quindi usa gli alias in tutti i contesti in cui vengono creati e modificati i tipi di carattere, quindi la sostituzione di un tipo di carattere con un altro richiede solo</span><span class="sxs-lookup"><span data-stu-id="ee17e-258">Instead, if the app uses custom properties to assign functional aliases based on the type of element or text being rendered, maps each alias to a specific font in one place and then uses the aliases in all the contexts where fonts are created and manipulated, then replacing one font with another requires only changing the one place where the alias is mapped to a specific font.</span></span> 

<span data-ttu-id="ee17e-259">I valori personalizzati per le proprietà informative possono essere assegnati quando viene chiamato il metodo [**IDWriteFontSetBuilder:: AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-259">Custom values for informational properties can be assigned when the [**IDWriteFontSetBuilder::AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method is called.</span></span> <span data-ttu-id="ee17e-260">Il metodo per eseguire questa operazione è il seguente: Questa operazione può essere usata in qualsiasi versione di Windows 10.</span><span class="sxs-lookup"><span data-stu-id="ee17e-260">The method for doing this is as follows; this can be used on any Windows 10 version.</span></span> 

<span data-ttu-id="ee17e-261">Come illustrato sopra, iniziare ottenendo le interfacce [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) e [**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-261">As shown above, start by obtaining the [**IDWriteFactory3**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefactory3) and [**IDWriteFontSet**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontset) interfaces.</span></span> <span data-ttu-id="ee17e-262">Per aggiungere un tipo di carattere personalizzato, creare un [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference), come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-262">For each custom font face to be added, create an [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference), as shown above.</span></span> <span data-ttu-id="ee17e-263">Prima che questo venga aggiunto al generatore del set di caratteri (all'interno del ciclo nel passaggio 5, illustrato sopra), tuttavia, l'app definisce i valori delle proprietà personalizzate da usare.</span><span class="sxs-lookup"><span data-stu-id="ee17e-263">Before this is added to the font set builder (within the loop in step 5, shown above), however, the app defines the custom property values to be used.</span></span> 

<span data-ttu-id="ee17e-264">Un set di valori di proprietà personalizzati viene definito utilizzando una matrice di strutture di [**\_ \_ proprietà del tipo di carattere DWrite**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-264">A set of custom property values is defined using an array of [**DWRITE\_FONT\_PROPERTY**](/windows/win32/api/dwrite_3/ns-dwrite_3-dwrite_font_property) structures.</span></span> <span data-ttu-id="ee17e-265">Ognuna di queste identifica una particolare proprietà dall'enumerazione [**dell' \_ \_ \_ ID della proprietà del tipo di carattere DWrite**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) e il valore della proprietà corrispondente da usare.</span><span class="sxs-lookup"><span data-stu-id="ee17e-265">Each of these identifies a particular property from the [**DWRITE\_FONT\_PROPERTY\_ID**](/windows/win32/api/dwrite_3/ne-dwrite_3-dwrite_font_property_id) enum, and the corresponding property value that is to be used.</span></span>  

<span data-ttu-id="ee17e-266">Si noti che tutti i valori delle proprietà sono assegnati come stringhe.</span><span class="sxs-lookup"><span data-stu-id="ee17e-266">Note that all property values are assigned as strings.</span></span> <span data-ttu-id="ee17e-267">Se gli utenti potrebbero essere visualizzati in un secondo momento, è possibile impostare valori alternativi per una determinata proprietà per lingue diverse, ma ciò non è obbligatorio.</span><span class="sxs-lookup"><span data-stu-id="ee17e-267">If these may later be displayed to users, then alternate values for a given property for different languages may be set, but this is not required.</span></span> <span data-ttu-id="ee17e-268">Si noti anche che, se i valori delle proprietà personalizzate vengono impostati dall'app, solo i valori specificati verranno utilizzati all'interno del set di caratteri. DirectWrite non deriverà alcun valore direttamente dal tipo di carattere per le proprietà informative utilizzate in un set di caratteri.</span><span class="sxs-lookup"><span data-stu-id="ee17e-268">Also note that if any custom property values are set by the app, then only those values that are specified will be used within the Font set; DirectWrite will not derive any values directly from the font for informational properties used in a font set.</span></span> 

<span data-ttu-id="ee17e-269">Nell'esempio seguente vengono definiti valori personalizzati per tre proprietà informative: il nome della famiglia, il nome completo e lo spessore del carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-269">The following example defines custom values for three informational properties: family name, full name, and font weight.</span></span> 


```C++
DWRITE_FONT_PROPERTY props[] = 
{ 
  { DWRITE_FONT_PROPERTY_ID_FAMILY_NAME, L"My Icon Font", L"en-US" }, 
  { DWRITE_FONT_PROPERTY_ID_FULL_NAME, L"My Icon Font", L"en-US" }, 
  { DWRITE_FONT_PROPERTY_ID_WEIGHT, L"400", nullptr } 
}; 
               
            
```



<span data-ttu-id="ee17e-270">Dopo aver definito la matrice desiderata di valori di proprietà per un tipo di carattere, effettuare una chiamata a AddFontFaceRefence, passando la matrice di proprietà e il riferimento al tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-270">After defining the desired array of property values for a font, make a call to AddFontFaceRefence, passing the property array as well as the font face reference.</span></span> 


```C++
hr = pFontSetBuilder->AddFontFaceReference(pFontFaceReference, props, ARRAYSIZE(props)); 
```



 

<span data-ttu-id="ee17e-271">Una volta che tutti i tipi di carattere personalizzati sono stati aggiunti al generatore del set di caratteri, insieme alle relative proprietà personalizzate, creare il set di caratteri personalizzato, come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-271">Once all custom font faces have been added to the font set builder, along with their custom properties, create the custom font set, as shown above.</span></span> 

### <a name="creating-a-custom-font-set-using-known-remote-fonts-on-the-web"></a><span data-ttu-id="ee17e-272">Creazione di un set di caratteri personalizzato utilizzando caratteri remoti noti sul Web</span><span class="sxs-lookup"><span data-stu-id="ee17e-272">Creating a custom font set using known, remote fonts on the Web</span></span>

<span data-ttu-id="ee17e-273">Le proprietà personalizzate sono importanti per l'utilizzo di tipi di carattere remoti.</span><span class="sxs-lookup"><span data-stu-id="ee17e-273">Custom properties are important for working with remote fonts.</span></span> <span data-ttu-id="ee17e-274">Ogni riferimento del tipo di carattere deve contenere alcune proprietà informative per caratterizzare il tipo di carattere e distinguerlo da altri tipi di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-274">Each font face reference must have some informational properties to characterize the font and distinguish it from other fonts.</span></span> <span data-ttu-id="ee17e-275">Poiché i dati del tipo di carattere per i tipi di carattere remoti non sono locali, DirectWrite non può derivare proprietà direttamente dai dati del tipo di carattere</span><span class="sxs-lookup"><span data-stu-id="ee17e-275">Since the font data for remote fonts is not local, DirectWrite cannot derive properties directly from the font data.</span></span> <span data-ttu-id="ee17e-276">Pertanto, le proprietà devono essere specificate in modo esplicito quando si aggiunge un tipo di carattere remoto al generatore del set di caratteri.</span><span class="sxs-lookup"><span data-stu-id="ee17e-276">Hence, properties must be provided explicitly when adding a remote font to the font set builder.</span></span>

<span data-ttu-id="ee17e-277">La sequenza di chiamate API per l'aggiunta di tipi di carattere remoti a un set di caratteri è simile alla sequenza descritta per lo scenario precedente.</span><span class="sxs-lookup"><span data-stu-id="ee17e-277">The sequence of API calls for adding remote fonts to a font set is similar to the sequence described for the previous scenario.</span></span> <span data-ttu-id="ee17e-278">Poiché i dati del tipo di carattere sono remoti, tuttavia, le operazioni necessarie per la lettura dei dati del tipo di carattere effettivi saranno diverse rispetto a quando si utilizzano i file nella risorsa di archiviazione locale.</span><span class="sxs-lookup"><span data-stu-id="ee17e-278">Since the font data is remote, however, the operations involved for reading the actual font data will be different than when working with files in local storage.</span></span> <span data-ttu-id="ee17e-279">Per questa situazione, è stata aggiunta una nuova interfaccia di livello inferiore, [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader), in Windows 10 Creators Update.</span><span class="sxs-lookup"><span data-stu-id="ee17e-279">For this situation, a new lower-level interface, [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader), has been added in the Windows 10 Creators Update.</span></span> 

<span data-ttu-id="ee17e-280">Per usare il caricatore di file del tipo di carattere remoto, è necessario prima registrarlo con una factory DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="ee17e-280">To use the remote font file loader, it must first be registered with a DirectWrite factory.</span></span> <span data-ttu-id="ee17e-281">Il caricatore deve essere mantenuto dall'app per tutto il tempo in cui vengono usati i tipi di carattere associati.</span><span class="sxs-lookup"><span data-stu-id="ee17e-281">The loader will need to be held by the app for as long as the fonts associated with it are being used.</span></span> <span data-ttu-id="ee17e-282">Una volta che i tipi di carattere non sono più in uso e, a un certo punto, prima che la Factory venga distrutta, è necessario annullare la registrazione del caricatore.</span><span class="sxs-lookup"><span data-stu-id="ee17e-282">Once the fonts are no longer in use, and at some point before the factory is destroyed, the loader must be unregistered.</span></span> <span data-ttu-id="ee17e-283">Questa operazione può essere eseguita nel distruttore per la classe proprietaria dell'oggetto Loader.</span><span class="sxs-lookup"><span data-stu-id="ee17e-283">This can be done in the destructor for the class that owns the loader object.</span></span> <span data-ttu-id="ee17e-284">Questa procedura verrà illustrata di seguito.</span><span class="sxs-lookup"><span data-stu-id="ee17e-284">These steps will be shown below.</span></span> 

<span data-ttu-id="ee17e-285">Il metodo per la creazione di un set di caratteri personalizzato con i tipi di carattere remoti è il seguente: Questa operazione richiede Windows 10 Creators Update.</span><span class="sxs-lookup"><span data-stu-id="ee17e-285">The method for creating a custom font set using remote fonts is as follows; this requires the Windows 10 Creators Update.</span></span>  

<dl> <span data-ttu-id="ee17e-286">1. Creare un'interfaccia IDWriteFactory5, come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-286">1. Create an IDWriteFactory5 interface, as shown above.</span></span>   
<span data-ttu-id="ee17e-287">2. Creare un'interfaccia <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder">IDWriteFontSetBuilder</a> , come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-287">2. Create an <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder">IDWriteFontSetBuilder</a> interface, as shown above.</span></span>   
<span data-ttu-id="ee17e-288">3. Usare la factory per ottenere un <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader">IDWriteRemoteFontFileLoader</a>.</span><span class="sxs-lookup"><span data-stu-id="ee17e-288">3. Use the factory to obtain an <a href="/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader">IDWriteRemoteFontFileLoader</a>.</span></span> 


```C++
IDWriteRemoteFontFileLoader* pRemoteFontFileLoader; 
if (SUCCEEDED(hr)) 
{ 
    hr = pDWriteFactory->CreateHttpFontFileLoader( 
        /* referrerURL */ nullptr, 
        /* extraHeaders */ nullptr, 
        &pRemoteFontFileLoader 
    ); 
} 
```



<span data-ttu-id="ee17e-289">Viene restituita un'implementazione fornita dal sistema dell'interfaccia del caricatore di file del tipo di carattere remoto che è in grado di gestire le interazioni HTTP per il download dei dati del tipo di carattere per conto dell'app.</span><span class="sxs-lookup"><span data-stu-id="ee17e-289">This returns a system-provided implementation of the remote font file loader interface that is able to handle HTTP interactions for downloading font data on behalf of the app.</span></span> <span data-ttu-id="ee17e-290">È possibile specificare un URL del referrer o intestazioni aggiuntive se richiesto dal servizio del tipo di carattere o dai servizi che sono l'origine per i tipi di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-290">A referrer URL or extra headers can be specified if required by the font service or services that are the source for the fonts.</span></span>    

> [!IMPORTANT]
> <span data-ttu-id="ee17e-291">Nota sulla sicurezza: quando viene effettuato un tentativo di recupero di un tipo di carattere remoto, esiste il rischio che un utente malintenzionato possa falsificare il server previsto che verrà chiamato.</span><span class="sxs-lookup"><span data-stu-id="ee17e-291">Security note: When an attempt is made to fetch a remote font, the potential exists for an attacker to spoof the intended server that will be called.</span></span> <span data-ttu-id="ee17e-292">In tal caso, gli URL di destinazione e referrer e i dettagli dell'intestazione vengono divulgati all'autore dell'attacco.</span><span class="sxs-lookup"><span data-stu-id="ee17e-292">In that case, the target and referrer URLs and header details would be disclosed to the attacker.</span></span> <span data-ttu-id="ee17e-293">Gli sviluppatori di app sono responsabili della mitigazione di questo rischio.</span><span class="sxs-lookup"><span data-stu-id="ee17e-293">App developers are responsible for mitigating this risk.</span></span> <span data-ttu-id="ee17e-294">È consigliabile usare il protocollo HTTPS, anziché HTTP.</span><span class="sxs-lookup"><span data-stu-id="ee17e-294">Use of the HTTPS protocol, rather than HTTP, is recommended.</span></span> 

 

<span data-ttu-id="ee17e-295">Per più tipi di carattere è possibile usare un singolo caricatore di file del tipo di carattere remoto, anche se è possibile usare diversi caricatori se i tipi di carattere vengono ottenuti da più servizi che hanno requisiti diversi per l'URL del referrer o per intestazioni aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="ee17e-295">A single remote font file loader can be used for multiple fonts, though different loaders can be used if fonts are obtained from multiple services that have different requirements for referrer URL or extra headers.</span></span>   
4. <span data-ttu-id="ee17e-296">Registrare il caricatore del file del tipo di carattere remoto con la factory.</span><span class="sxs-lookup"><span data-stu-id="ee17e-296">Register the remote font file loader with the factory.</span></span> 


```C++
 if (SUCCEEDED(hr)) 
 { 
     hr = pDWriteFactory->RegisterFontFileLoader(pRemoteFontFileLoader); 
 } 
```



<span data-ttu-id="ee17e-297">Da questo punto, i passaggi per la creazione del set di caratteri personalizzato sono simili a quelli descritti per i file dei tipi di carattere locali noti, con due eccezioni importanti.</span><span class="sxs-lookup"><span data-stu-id="ee17e-297">From this point, the steps for creating the custom font set are similar to those described for known, local font files, with two important exceptions.</span></span> <span data-ttu-id="ee17e-298">In primo luogo, l'oggetto [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) viene creato usando l'interfaccia del caricatore del file del tipo di carattere remoto anziché usare la factory.</span><span class="sxs-lookup"><span data-stu-id="ee17e-298">First, the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object is created using the remote font file loader interface rather than using the factory.</span></span> <span data-ttu-id="ee17e-299">In secondo luogo, non è possibile usare il metodo Analyze perché i dati del tipo di carattere non sono locali.</span><span class="sxs-lookup"><span data-stu-id="ee17e-299">Second, the Analyze method cannot be used since the font data is not local.</span></span> <span data-ttu-id="ee17e-300">Al contrario, l'app deve sapere se il file del tipo di carattere remoto è un file di raccolta dei tipi di carattere OpenType e, in tal caso, deve sapere quali tipi di carattere all'interno della raccolta verrà usato e l'indice per ciascuno di essi.</span><span class="sxs-lookup"><span data-stu-id="ee17e-300">Instead, the app must know whether the remote font file is an OpenType Font Collection file, and if so, then it must know which of the fonts within the collection it will use, and the index for each.</span></span> <span data-ttu-id="ee17e-301">Di conseguenza, i passaggi rimanenti sono i seguenti.</span><span class="sxs-lookup"><span data-stu-id="ee17e-301">Hence, the remaining steps are as follows.</span></span>   
5. <span data-ttu-id="ee17e-302">Per ogni file del tipo di carattere remoto, usare l'interfaccia del caricatore del file del tipo di carattere remoto per creare un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), specificando l'URL necessario per accedere al file del tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-302">For each remote font file, use the remote font file loader interface to create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile), specifying the URL required to access the font file.</span></span> 


```C++
 IDWriteFontFile* pFontFile; 
 hr = pRemoteFontFileLoader->CreateFontFileReferenceFromUrl( 
     pDWriteFactory, 
     /* baseUrl */ L"https://github.com/", 
     /* fontFileUrl */ L"winjs/winjs/blob/master/src/fonts/Symbols.ttf?raw=true", 
     &pFontFile 
 ); 
```



<span data-ttu-id="ee17e-303">Si noti che l'URL completo può essere specificato nel parametro fontFileUrl o può essere suddiviso in parti di base e relative.</span><span class="sxs-lookup"><span data-stu-id="ee17e-303">Note that the complete URL can be specified in the fontFileUrl parameter, or it can be split into base and relative portions.</span></span> <span data-ttu-id="ee17e-304">Se viene specificato un URL di base, la concatenazione dei valori baseUrl e fontFileUrl deve fornire l'URL completo, DirectWrite non fornirà alcun delimitatore aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="ee17e-304">If a base URL is specified, then the concatenation of the baseUrl and fontFileUrl values must provide the complete URL — DirectWrite will not supply any additional delimiter.</span></span>  

> [!IMPORTANT]
> <span data-ttu-id="ee17e-305">Nota sulla sicurezza/prestazioni: quando viene effettuato un tentativo di recupero di un tipo di carattere remoto, non c'è alcuna garanzia che Windows riceva una risposta dal server.</span><span class="sxs-lookup"><span data-stu-id="ee17e-305">Security / performance note: When an attempt is made to fetch a remote font, there is no guarantee that Windows will receive a response from the server.</span></span> <span data-ttu-id="ee17e-306">In alcuni casi, un server può rispondere con un errore di file non trovato per un URL relativo non valido, ma smettere di rispondere se riceve più richieste non valide.</span><span class="sxs-lookup"><span data-stu-id="ee17e-306">In some cases, a server may respond with a file-not-found error for an invalid relative URL, but stop responding if it receives multiple invalid requests.</span></span> <span data-ttu-id="ee17e-307">Se il server non risponde, si verificherà un timeout di Windows, anche se sono stati avviati più recuperi.</span><span class="sxs-lookup"><span data-stu-id="ee17e-307">If the server does not respond, Windows will eventually time out, though this may take several minutes if multiple fetches are initiated.</span></span> <span data-ttu-id="ee17e-308">È necessario eseguire le operazioni possibili per assicurarsi che gli URL siano validi quando vengono effettuate le chiamate.</span><span class="sxs-lookup"><span data-stu-id="ee17e-308">You should do what you can to ensure that URLs will be valid when calls are made.</span></span> 

 

<span data-ttu-id="ee17e-309">Si noti inoltre che l'URL può puntare a un file del tipo di carattere OpenType non elaborato (. ttf,. otf,. TTC,. OTC), ma può anche puntare a tipi di carattere in un file contenitore WOFF o WOFF2.</span><span class="sxs-lookup"><span data-stu-id="ee17e-309">Also note that the URL can point to a raw OpenType font file (.ttf, .otf, .ttc, .otc), but it can also point to fonts in a WOFF or WOFF2 container file.</span></span> <span data-ttu-id="ee17e-310">Se si fa riferimento a un file WOFF o WOFF2, l'implementazione DirectWrite del caricatore di file del tipo di carattere remoto decomprimerà automaticamente i dati del tipo di carattere dal file contenitore.</span><span class="sxs-lookup"><span data-stu-id="ee17e-310">If a WOFF or WOFF2 file is referenced, then the DirectWrite implementation of the remote font file loader will automatically unpack the font data from the container file.</span></span>   
6. <span data-ttu-id="ee17e-311">Per ogni indice del tipo di carattere all'interno del file del tipo di carattere remoto da usare, creare un [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference).</span><span class="sxs-lookup"><span data-stu-id="ee17e-311">For each font face index within the remote font file that is to be used, create an [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference).</span></span> 


```C++
 IDWriteFontFaceReference* pFontFaceReference; 
 hr = pDWriteFactory->CreateFontFaceReference(pFontFile, /* faceIndex */ 0, DWRITE_FONT_SIMULATIONS_NONE, &pFontFaceReference);
```



  
7. <span data-ttu-id="ee17e-312">Definire le proprietà personalizzate per il tipo di carattere, come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-312">Define custom properties for the font face, as shown above.</span></span>   
8. <span data-ttu-id="ee17e-313">Aggiungere il riferimento al tipo di carattere insieme alle proprietà personalizzate al generatore del set di caratteri, come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-313">Add the font face reference along with custom properties to the font set builder, as shown above.</span></span>   
9. <span data-ttu-id="ee17e-314">Dopo che tutti i tipi di carattere sono stati aggiunti al generatore del set di caratteri, creare il set di caratteri, come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-314">After all fonts have been added to the font set builder, create the font set, as shown above.</span></span>   
10. <span data-ttu-id="ee17e-315">A un certo punto, quando i tipi di carattere remoti non verranno più usati, annullare la registrazione del caricatore del file del tipo di carattere remoto.</span><span class="sxs-lookup"><span data-stu-id="ee17e-315">At some point when the remote fonts will no longer be used, unregister the remote font file loader.</span></span> 


```C++
hr = pDWriteFactory->UnregisterFontFileLoader(pRemoteFontFileLoader); 
```



  
</dl>

<span data-ttu-id="ee17e-316">Una volta creato un set di caratteri personalizzato con tipi di carattere remoti personalizzati, il set di caratteri contiene riferimenti e proprietà informative per i tipi di carattere remoti, ma i dati effettivi sono ancora remoti.</span><span class="sxs-lookup"><span data-stu-id="ee17e-316">Once a custom font set with custom remote fonts is created, the font set contains references and informational properties for the remote fonts, but the actual data is still remote.</span></span> <span data-ttu-id="ee17e-317">Il supporto DirectWrite per i tipi di carattere remoti consente di mantenere un riferimento al tipo di carattere nel set di caratteri e di selezionare un tipo di carattere da utilizzare per il layout e il rendering, ma i dati effettivi non vengono scaricati fino a quando non è necessario utilizzarlo, ad esempio quando verrà eseguito il layout del testo.</span><span class="sxs-lookup"><span data-stu-id="ee17e-317">DirectWrite support for remote fonts allows a font face reference to be maintained in the font set, and for a font to be selected for use in layout and rendering, but that the actual data is not downloaded until there is an actual need to use it, such as when text layout will be performed.</span></span>  

<span data-ttu-id="ee17e-318">Un'app può adottare un approccio iniziale richiedendo che DirectWrite scarichi i dati del tipo di carattere e quindi attendendo la conferma di un download riuscito prima che venga avviata un'elaborazione con il tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-318">An app can take an up-front approach by requesting that DirectWrite download the font data and then waiting for confirmation of a successful download before any processing with the font is begun.</span></span> <span data-ttu-id="ee17e-319">Tuttavia, un download di rete implica una latenza di durata imprevedibile e anche il successo è incerto.</span><span class="sxs-lookup"><span data-stu-id="ee17e-319">But a network download implies some latency of unpredictable duration, and success is also uncertain.</span></span> <span data-ttu-id="ee17e-320">Per questo motivo, in genere è preferibile adottare un approccio diverso, in modo da poter eseguire il layout e il rendering inizialmente usando tipi di carattere alternativi o di fallback già locali, richiedendo il download del tipo di carattere remoto desiderato in parallelo e quindi aggiornando i risultati dopo che il tipo di carattere desiderato è stato scaricato.</span><span class="sxs-lookup"><span data-stu-id="ee17e-320">For this reason, it will usually be better to take a different approach, allowing layout and rendering to be done initially using alternate or fallback fonts that are already local, while requesting download of the desired, remote font in parallel, and then updating the results once the desired font has been downloaded.</span></span> 

<span data-ttu-id="ee17e-321">Per richiedere che l'intero tipo di carattere venga scaricato prima che venga usato, è possibile usare il metodo [**IDWriteFontFaceReference:: EnqueueFontDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuefontdownloadrequest) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-321">To request that the entire font be downloaded before it gets used, the [**IDWriteFontFaceReference::EnqueueFontDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuefontdownloadrequest) method can be used.</span></span> <span data-ttu-id="ee17e-322">Se il tipo di carattere è molto grande, solo una parte dei dati potrebbe essere necessaria per l'elaborazione di stringhe specifiche.</span><span class="sxs-lookup"><span data-stu-id="ee17e-322">If the font is very large, only a portion of the data may be needed for processing particular strings.</span></span> <span data-ttu-id="ee17e-323">DirectWrite fornisce metodi aggiuntivi che possono essere usati per richiedere parti dei dati del tipo di carattere necessari per contenuto particolare, [**EnqueueCharacterDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuecharacterdownloadrequest) e [**EnqueueGlyphDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueueglyphdownloadrequest).</span><span class="sxs-lookup"><span data-stu-id="ee17e-323">DirectWrite provides additional methods that can be used to request portions of the font data needed for particular content, [**EnqueueCharacterDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueuecharacterdownloadrequest) and [**EnqueueGlyphDownloadRequest**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontfacereference-enqueueglyphdownloadrequest).</span></span>  

<span data-ttu-id="ee17e-324">Si supponga che l'approccio da eseguire nell'app consenta di eseguire l'elaborazione inizialmente usando tipi di carattere locali, alternativi o di fallback.</span><span class="sxs-lookup"><span data-stu-id="ee17e-324">Suppose the approach to be taken in the app is to allow processing to be done initially using local, alternate or fallback fonts.</span></span> <span data-ttu-id="ee17e-325">Il metodo IDWriteFontFallback::[**MapCharacters**](idwritefontfallback-mapcharacters.md) può essere usato per identificare i tipi di carattere di fallback locali e verrà automaticamente accodato una richiesta di download del tipo di carattere preferito.</span><span class="sxs-lookup"><span data-stu-id="ee17e-325">The IDWriteFontFallback::[**MapCharacters**](idwritefontfallback-mapcharacters.md) method can be used to identify local fallback fonts, and it will also automatically enqueue a request to download the preferred font.</span></span> <span data-ttu-id="ee17e-326">Se, inoltre, si usa [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) e il testo nel layout è formattato con un riferimento a un tipo di carattere remoto, DirectWrite userà automaticamente il metodo **MapCharacters** per ottenere i tipi di carattere di fallback locali e accodare una richiesta di download dei dati del tipo di carattere remoto.</span><span class="sxs-lookup"><span data-stu-id="ee17e-326">Also, if [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout) is used and some or all of the text in the layout is formatted using a remote font reference, then DirectWrite will automatically use the **MapCharacters** method to get local fallback fonts and to enqueue a request to download the remote font data.</span></span> 

<span data-ttu-id="ee17e-327">DirectWrite gestisce una coda di download dei tipi di carattere per ogni factory e le richieste effettuate usando i metodi indicati in precedenza vengono aggiunte a tale coda.</span><span class="sxs-lookup"><span data-stu-id="ee17e-327">DirectWrite maintains a font download queue for each factory, and the requests made using the methods mentioned above get added to that queue.</span></span> <span data-ttu-id="ee17e-328">La coda di download dei tipi di carattere può essere ottenuta usando il metodo [**IDWriteFactory3:: GetFontDownloadQueue**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getfontdownloadqueue) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-328">The font download queue can be obtained using the [**IDWriteFactory3::GetFontDownloadQueue**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory3-getfontdownloadqueue) method.</span></span> 

<span data-ttu-id="ee17e-329">Se viene eseguita una richiesta di download, ma i dati del tipo di carattere sono già locali, verrà generato un no-op: non verrà aggiunto nulla alla coda di download.</span><span class="sxs-lookup"><span data-stu-id="ee17e-329">If a download request is made but the font data is already local, this will result in a no-op: Nothing will be added to the download queue.</span></span> <span data-ttu-id="ee17e-330">Un'app può verificare se la coda è vuota o se sono presenti richieste di download in sospeso chiamando il metodo [**IDWriteFontDownloadQueue:: IsEmpty**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-isempty) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-330">An app can check whether the queue is empty or there are pending download requests by calling the [**IDWriteFontDownloadQueue::IsEmpty**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-isempty) method.</span></span> 

<span data-ttu-id="ee17e-331">Dopo che sono state aggiunte le richieste del tipo di carattere remoto alla coda, è necessario avviare il processo di download.</span><span class="sxs-lookup"><span data-stu-id="ee17e-331">After remote font requests have been added to the queue, the download process must be initiated.</span></span> <span data-ttu-id="ee17e-332">Quando i tipi di carattere remoti vengono usati in [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout), il download viene avviato automaticamente quando l'app chiama i metodi **IDWriteTextLayout** che forzano le operazioni di layout o rendering, ad esempio GetLineMetrics o i metodi di disegno.</span><span class="sxs-lookup"><span data-stu-id="ee17e-332">When remote fonts are used in [**IDWriteTextLayout**](/windows/win32/api/dwrite/nn-dwrite-idwritetextlayout), the download will be initiated automatically when the app calls **IDWriteTextLayout** methods that force layout or rendering operations, such as the GetLineMetrics or Draw methods.</span></span> <span data-ttu-id="ee17e-333">In altri scenari, l'app deve avviare il download direttamente chiamando [**IDWriteFontDownloadQueue:: BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload).</span><span class="sxs-lookup"><span data-stu-id="ee17e-333">In other scenarios, the app must initiate the download directly by calling [**IDWriteFontDownloadQueue::BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload).</span></span>  

<span data-ttu-id="ee17e-334">Al termine di un download, l'app sarà all'inizio di eseguire le azioni appropriate, ovvero la prosecuzione delle operazioni in sospeso o la ripetizione delle operazioni eseguite inizialmente con i tipi di carattere di fallback.</span><span class="sxs-lookup"><span data-stu-id="ee17e-334">When a download is completed, it will be up to the app to take appropriate actions — proceeding with pending operations, or repeating operations that were done initially with fallback fonts.</span></span> <span data-ttu-id="ee17e-335">Se viene usato il layout del testo di DirectWrite, [**IDWriteTextLayout3:: InvalidateLayout**](idwritetextlayout3-invalidatelayout.md) può essere usato per cancellare i risultati temporanei calcolati con i tipi di carattere di fallback. Per consentire all'app di ricevere una notifica al termine del processo di download e di eseguire le azioni appropriate, l'app deve fornire un'implementazione dell'interfaccia [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) e passarla alla chiamata BeginDownload.</span><span class="sxs-lookup"><span data-stu-id="ee17e-335">(If DirectWrite’s text layout is being used, then [**IDWriteTextLayout3::InvalidateLayout**](idwritetextlayout3-invalidatelayout.md) can be used to clear the temporary results computed using fallback fonts.) In order for the app to be notified when the download process has completed and to take appropriate actions, the app must provide an implementation of the [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface, and pass this into the BeginDownload call.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="ee17e-336">Nota sulla sicurezza/prestazioni: quando viene effettuato un tentativo di recupero di un tipo di carattere remoto, non c'è alcuna garanzia che Windows riceva una risposta dal server.</span><span class="sxs-lookup"><span data-stu-id="ee17e-336">Security / performance note: When an attempt is made to fetch a remote font, there is no guarantee that Windows will receive a response from the server.</span></span> <span data-ttu-id="ee17e-337">Se il server non risponde, si verificherà un timeout di Windows, anche se l'operazione potrebbe richiedere alcuni minuti se vengono recuperati più tipi di carattere remoti, ma con esito negativo.</span><span class="sxs-lookup"><span data-stu-id="ee17e-337">If the server does not respond, Windows will eventually time out, though this may take several minutes if multiple remote fonts are being fetched but failing.</span></span> <span data-ttu-id="ee17e-338">La chiamata a BeginDownload restituirà immediatamente.</span><span class="sxs-lookup"><span data-stu-id="ee17e-338">The BeginDownload call will return immediately.</span></span> <span data-ttu-id="ee17e-339">Le app non devono bloccare l'interfaccia utente durante l'attesa della chiamata di [**IDWriteFontDownloadListener::D ownloadcompleted**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadlistener-downloadcompleted) .</span><span class="sxs-lookup"><span data-stu-id="ee17e-339">Apps should not block UI while waiting for [**IDWriteFontDownloadListener::DownloadCompleted**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadlistener-downloadcompleted) to be called.</span></span> 

 

<span data-ttu-id="ee17e-340">Le implementazioni di esempio di queste interazioni con la coda di download dei tipi di carattere di DirectWrite e dell'interfaccia [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) sono disponibili nell' [esempio di set di caratteri personalizzati DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/)e anche nell'esempio di tipi di carattere [scaricabili DirectWrite](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/DWriteTextLayoutCloudFont).</span><span class="sxs-lookup"><span data-stu-id="ee17e-340">Sample implementations of these interactions with DirectWrite’s font download queue and of the [**IDWriteFontDownloadListener**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontdownloadlistener) interface can be seen in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/), and also in the [DirectWrite Downloadable Fonts sample](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/DWriteTextLayoutCloudFont).</span></span> 

### <a name="creating-a-custom-font-set-using-font-data-loaded-into-memory"></a><span data-ttu-id="ee17e-341">Creazione di un set di caratteri personalizzato usando i dati del tipo di carattere caricati in memoria</span><span class="sxs-lookup"><span data-stu-id="ee17e-341">Creating a custom font set using font data loaded into memory</span></span>

<span data-ttu-id="ee17e-342">Così come le operazioni di basso livello per la lettura dei dati da un file del tipo di carattere sono diverse per i file in un disco locale rispetto ai file remoti sul Web, lo stesso vale anche per i dati del tipo di carattere caricati in un buffer di memoria.</span><span class="sxs-lookup"><span data-stu-id="ee17e-342">Just as the low-level operations for reading data from a font file are different for files on a local disk versus remote files on the Web, the same is also true for font data loaded into a memory buffer.</span></span> <span data-ttu-id="ee17e-343">In Windows 10 Creators Update, [**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader), è stata aggiunta una nuova interfaccia di basso livello per la gestione dei dati di tipo carattere in memoria.</span><span class="sxs-lookup"><span data-stu-id="ee17e-343">A new low-level interface for handling in-memory font data has been added in the Windows 10 Creators Update, [**IDWriteInMemoryFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteinmemoryfontfileloader).</span></span> 

<span data-ttu-id="ee17e-344">Come per un caricatore di file del tipo di carattere remoto, un caricatore di file dei tipi di carattere in memoria deve prima essere registrato con una factory DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="ee17e-344">As with a remote font file loader, an in-memory font file loader must first be registered with a DirectWrite factory.</span></span> <span data-ttu-id="ee17e-345">Il caricatore deve essere mantenuto dall'app per tutto il tempo in cui vengono usati i tipi di carattere associati.</span><span class="sxs-lookup"><span data-stu-id="ee17e-345">The loader will need to be held by the app for as long as the fonts associated with it are being used.</span></span> <span data-ttu-id="ee17e-346">Una volta che i tipi di carattere non sono più in uso e, a un certo punto, prima che la Factory venga distrutta, è necessario annullare la registrazione del caricatore.</span><span class="sxs-lookup"><span data-stu-id="ee17e-346">Once the fonts are no longer in use, and at some point before the factory is destroyed, the loader must be unregistered.</span></span> <span data-ttu-id="ee17e-347">Questa operazione può essere eseguita nel distruttore per la classe proprietaria dell'oggetto Loader.</span><span class="sxs-lookup"><span data-stu-id="ee17e-347">This can be done in the destructor for the class that owns the loader object.</span></span> <span data-ttu-id="ee17e-348">Questa procedura verrà illustrata di seguito.</span><span class="sxs-lookup"><span data-stu-id="ee17e-348">These steps will be shown below.</span></span> 

<span data-ttu-id="ee17e-349">Se l'app dispone di informazioni separate sui visi dei tipi di carattere rappresentati dai dati, può aggiungere singoli riferimenti del tipo di carattere a un generatore di set di caratteri con proprietà personalizzate specificate.</span><span class="sxs-lookup"><span data-stu-id="ee17e-349">If the app has separate information about the font faces represented by the data, it can add individual font face references to a font set builder with custom properties specified.</span></span> <span data-ttu-id="ee17e-350">Poiché i dati del tipo di carattere sono nella memoria locale, tuttavia, questo non è necessario. DirectWrite sarà in grado di leggere direttamente i dati per derivare i valori delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="ee17e-350">Since the font data is in local memory, however, this is not required; DirectWrite will be able to read the data directly to derive the property values.</span></span> 

<span data-ttu-id="ee17e-351">DirectWrite presuppone che i dati del tipo di carattere siano in formato OpenType non elaborato, equivalente a un file OpenType (. ttf,. otf,. TTC,. OTC), ma in memoria anziché su disco.</span><span class="sxs-lookup"><span data-stu-id="ee17e-351">DirectWrite assumes the font data is in raw, OpenType format, equivalent to an OpenType file (.ttf, .otf, .ttc, .otc), but in memory rather than on disk.</span></span> <span data-ttu-id="ee17e-352">I dati non possono trovarsi in un formato di contenitore WOFF o WOFF2.</span><span class="sxs-lookup"><span data-stu-id="ee17e-352">The data cannot be in a WOFF or WOFF2 container format.</span></span> <span data-ttu-id="ee17e-353">I dati possono rappresentare una raccolta di tipi di carattere OpenType.</span><span class="sxs-lookup"><span data-stu-id="ee17e-353">The data can represent an OpenType Font Collection.</span></span> <span data-ttu-id="ee17e-354">Se non si usano proprietà personalizzate, è possibile usare il metodo [**IDWriteFontSetBuilder1:: AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) per aggiungere tutti i tipi di carattere nei dati in un'unica chiamata.</span><span class="sxs-lookup"><span data-stu-id="ee17e-354">If custom properties are not being used, then the [**IDWriteFontSetBuilder1::AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method can be used to add all font faces in the data in a single call.</span></span> 

<span data-ttu-id="ee17e-355">Una considerazione importante per lo scenario in memoria è il ciclo di vita dei dati.</span><span class="sxs-lookup"><span data-stu-id="ee17e-355">An important consideration for the in-memory scenario is the lifetime of the data.</span></span> <span data-ttu-id="ee17e-356">Se viene fornito un puntatore al buffer a DirectWrite senza una chiara indicazione del proprietario, DirectWrite effettuerà una copia dei dati in un nuovo buffer di memoria di cui sarà proprietario.</span><span class="sxs-lookup"><span data-stu-id="ee17e-356">If a pointer to the buffer is provided to DirectWrite without a clear indication that there is an owner, then DirectWrite will make a copy of the data into a new memory buffer that it will own.</span></span> <span data-ttu-id="ee17e-357">Per evitare la copia di dati e l'allocazione di memoria aggiuntiva, l'app può passare un oggetto proprietario di dati che implementa IUnknown e che possiede il buffer di memoria contenente i dati del tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-357">To avoid copying of data and additional memory allocation, the app can pass a data-owner object that implements IUnknown, and that owns the memory buffer containing the font data.</span></span> <span data-ttu-id="ee17e-358">Implementando questa interfaccia, DirectWrite può aggiungere al conteggio dei riferimenti dell'oggetto, garantendo in tal modo la durata dei dati di proprietà.</span><span class="sxs-lookup"><span data-stu-id="ee17e-358">By implementing this interface, DirectWrite can add to the ref count of the object, thereby ensuring the lifetime of the owned data.</span></span> 

<span data-ttu-id="ee17e-359">Il metodo per la creazione di un set di caratteri personalizzato usando i dati di tipo carattere in memoria è il seguente: Questa operazione richiede Windows 10 Creators Update.</span><span class="sxs-lookup"><span data-stu-id="ee17e-359">The method for creating a custom font set using in-memory font data is as follows; this requires the Windows 10 Creators Update.</span></span> <span data-ttu-id="ee17e-360">Si presuppone che un oggetto proprietario di dati implementato dall'app implementi IUnknown e disponga anche di metodi che restituiscono un puntatore al buffer di memoria e la dimensione del buffer.</span><span class="sxs-lookup"><span data-stu-id="ee17e-360">This will assume an app-implemented data-owner object, that implements IUnknown and also has methods that return a pointer to the memory buffer and the size of the buffer.</span></span> 

<dl> <span data-ttu-id="ee17e-361">1. Creare un'interfaccia IDWriteFactory5, come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-361">1. Create an IDWriteFactory5 interface, as shown above.</span></span>  
<span data-ttu-id="ee17e-362">2. Creare un'interfaccia [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) , come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-362">2. Create an [**IDWriteFontSetBuilder1**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontsetbuilder1) interface, as shown above.</span></span>  
<span data-ttu-id="ee17e-363">3. Usare la factory per ottenere un IDWriteInMemoryFontFileLoader.</span><span class="sxs-lookup"><span data-stu-id="ee17e-363">3. Use the factory to obtain an IDWriteInMemoryFontFileLoader.</span></span> 


```C++
 IDWriteInMemoryFontFileLoader* pInMemoryFontFileLoader; 
if (SUCCEEDED(hr)) 
{ 
    hr = pDWriteFactory->CreateInMemoryFontFileLoader(&pInMemoryFontFileLoader); 
}
```



<span data-ttu-id="ee17e-364">Restituisce un'implementazione fornita dal sistema dell'interfaccia del caricatore di file dei tipi di carattere in memoria.</span><span class="sxs-lookup"><span data-stu-id="ee17e-364">This returns a system-provided implementation of the in-memory font file loader interface.</span></span>   
4. <span data-ttu-id="ee17e-365">Registrare il caricatore di file dei tipi di carattere in memoria con la factory.</span><span class="sxs-lookup"><span data-stu-id="ee17e-365">Register the in-memory font file loader with the factory.</span></span> 


```C++
if (SUCCEEDED(hr)) 
{ 
    hr = pDWriteFactory->RegisterFontFileLoader(pInMemoryFontFileLoader); 
}
```



   
5. <span data-ttu-id="ee17e-366">Per ogni file di tipo di carattere in memoria, usare il caricatore di file dei tipi di carattere in memoria per creare un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile).</span><span class="sxs-lookup"><span data-stu-id="ee17e-366">For each in-memory font file, use the in-memory font file loader to create an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile).</span></span> 


```C++
IDWriteFontFile* pFontFile; 
hr = pInMemoryFontFileLoader->CreateInMemoryFontFileReference( 
    pDWriteFactory, 
    pFontDataOwner->fontData /* returns void* */, 
    pFontDataOwner->fontDataSize /* returns UINT32 */, 
    pFontDataOwner /* ownerObject, owns the memory with font data and implements IUknown */, 
    &pFontFile 
); 
```



   
6. <span data-ttu-id="ee17e-367">Aggiungere l'oggetto [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) al generatore del set di caratteri usando il metodo [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) , come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-367">Add the [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) object to the font set builder using the [**AddFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder1-addfontfile) method, as shown above.</span></span>  <span data-ttu-id="ee17e-368">Se è necessario, l'app può invece creare singoli oggetti [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) basati su **IDWriteFontFile**, definire facoltativamente proprietà personalizzate per ogni riferimento al tipo di carattere e quindi aggiungere il riferimento del tipo di carattere con proprietà personalizzate al set di caratteri usando il metodo [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) , come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-368">If there is a need, the app can instead create individual [**IDWriteFontFaceReference**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwritefontfacereference) objects based on the **IDWriteFontFile**, optionally define custom properties for each font face reference, and then add the font face reference with custom properties to the font set using the [**AddFontFaceReference**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontfacereference(idwritefontfacereference)) method, as shown above.</span></span>   
7. <span data-ttu-id="ee17e-369">Dopo che tutti i tipi di carattere sono stati aggiunti al generatore del set di caratteri, creare il set di caratteri personalizzato, come illustrato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-369">After all fonts have been added to the font set builder, create the custom font set, as shown above.</span></span>   
8. <span data-ttu-id="ee17e-370">A un certo punto, quando i tipi di carattere in memoria non verranno più usati, annullare la registrazione del caricatore di file dei tipi di carattere in memoria.</span><span class="sxs-lookup"><span data-stu-id="ee17e-370">At some point when the in-memory fonts will no longer be used, unregister the in-memory font file loader.</span></span> 


```C++
hr = pDWriteFactory->UnregisterFontFileLoader(pInMemoryFontFileLoader);
```



  
</dl>

 

## <a name="advanced-scenarios"></a><span data-ttu-id="ee17e-371">Scenari avanzati</span><span class="sxs-lookup"><span data-stu-id="ee17e-371">Advanced scenarios</span></span>

<span data-ttu-id="ee17e-372">Alcune app possono avere requisiti speciali che richiedono un'elaborazione più avanzata rispetto a quanto descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-372">Some apps may have special requirements that require more advanced processing than is described above.</span></span> 

### <a name="combining-font-sets"></a><span data-ttu-id="ee17e-373">Combinazione di set di caratteri</span><span class="sxs-lookup"><span data-stu-id="ee17e-373">Combining font sets</span></span>

<span data-ttu-id="ee17e-374">Per alcune app potrebbe essere necessario creare un set di caratteri che include una combinazione di elementi di altri set di caratteri.</span><span class="sxs-lookup"><span data-stu-id="ee17e-374">Some apps may need to create a font set that comprises some combination of items from other font sets.</span></span> <span data-ttu-id="ee17e-375">Ad esempio, un'app potrebbe voler creare un set di caratteri che combina tutti i tipi di carattere installati nel sistema con una selezione di tipi di carattere personalizzati o che combina i tipi di carattere installati che corrispondono a determinati criteri con altri tipi di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-375">For example, an app may want to create a font set that combines all the fonts installed on the system with a selection of custom fonts, or that combines installed fonts matching certain criteria with other fonts.</span></span> <span data-ttu-id="ee17e-376">DirectWrite dispone di API per supportare la manipolazione e la combinazione di set di caratteri.</span><span class="sxs-lookup"><span data-stu-id="ee17e-376">DirectWrite has APIs to support manipulation and combining of font sets.</span></span> 

<span data-ttu-id="ee17e-377">Per combinare due o più set di caratteri, il metodo [**IDWriteFontSetBuilder:: AddFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontset) aggiunge tutti i tipi di carattere nel set di caratteri specificato da aggiungere a un generatore di set di caratteri in una singola chiamata.</span><span class="sxs-lookup"><span data-stu-id="ee17e-377">To combine two or more font sets, the [**IDWriteFontSetBuilder::AddFontSet**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontsetbuilder-addfontset) method adds all of the fonts in given font set to be added to a font set builder in a single call.</span></span> <span data-ttu-id="ee17e-378">Se nel nuovo set di caratteri sono desiderati solo determinati tipi di carattere di un set di caratteri esistente, è possibile usare il metodo [**IDWriteFontSet:: GetMatchingFonts**](idwritefontset-getmatchingfonts-overload.md) per derivare un nuovo oggetto set di caratteri che è stato filtrato in modo da includere solo i tipi di carattere corrispondenti alle proprietà specificate.</span><span class="sxs-lookup"><span data-stu-id="ee17e-378">If only certain fonts from an existing font set are wanted in the new font set, the [**IDWriteFontSet::GetMatchingFonts**](idwritefontset-getmatchingfonts-overload.md) method can be used to derive a new font set object that has been filtered to include only fonts matching specified properties.</span></span> <span data-ttu-id="ee17e-379">Questi metodi forniscono un modo semplice per creare un set di caratteri personalizzato che combina i tipi di carattere di due o più set di caratteri esistenti</span><span class="sxs-lookup"><span data-stu-id="ee17e-379">These methods provide an easy way to create a custom font set combining fonts from two or more existing font sets</span></span> 

### <a name="using-local-woff-or-woff2-font-data"></a><span data-ttu-id="ee17e-380">Uso di dati di tipo carattere WOFF o WOFF2 locali</span><span class="sxs-lookup"><span data-stu-id="ee17e-380">Using local WOFF or WOFF2 font data</span></span>

<span data-ttu-id="ee17e-381">Se un'app contiene file di tipo carattere nel file system locale o in un buffer di memoria, ma usano i formati di contenitore WOFF o WOFF2, DirectWrite (Windows 10 Creators Update o versioni successive) fornisce un metodo per decomprimere il formato del contenitore, [**IDWriteFactory5:: UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile), che restituisce un [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream).</span><span class="sxs-lookup"><span data-stu-id="ee17e-381">If an app has font files in the local file system or in a memory buffer, but they use the WOFF or WOFF2 container formats, DirectWrite (Windows 10 Creator Update or later) provides a method for unpacking the container format, [**IDWriteFactory5::UnpackFontFile**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefactory5-unpackfontfile), which returns an [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream).</span></span> 

<span data-ttu-id="ee17e-382">Tuttavia, l'app deve essere in grado di ottenere il [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) in un oggetto del caricatore di file del tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-382">However, the app will need a way to get the [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) into a font file loader object.</span></span> <span data-ttu-id="ee17e-383">Un modo per eseguire questa operazione consiste nel creare un'implementazione [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) personalizzata che esegua il wrapping del flusso.</span><span class="sxs-lookup"><span data-stu-id="ee17e-383">One way to do this is to create a custom [**IDWriteFontFileLoader**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfileloader) implementation that wraps the stream.</span></span> <span data-ttu-id="ee17e-384">Come per gli altri caricatori di file del tipo di carattere, è necessario registrarlo prima di usarlo e annullarne la registrazione prima che la Factory esca dall'ambito.</span><span class="sxs-lookup"><span data-stu-id="ee17e-384">As with other font file loaders, this must be registered before use, and unregistered before the factory goes out of scope.</span></span>  

<span data-ttu-id="ee17e-385">Se il caricatore personalizzato verrà usato anche con i file del tipo di carattere non elaborato (non compresso), l'app dovrà anche fornire un'implementazione personalizzata dell'interfaccia [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) per la gestione di tali file.</span><span class="sxs-lookup"><span data-stu-id="ee17e-385">If the custom loader will also be used with raw (not packed) font files, then the app would also need to provide a custom implementation of the [**IDWriteFontFileStream**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfilestream) interface for handling those files.</span></span> <span data-ttu-id="ee17e-386">Sono disponibili più semplici metodi che usano le API descritte in precedenza per la gestione dei file di tipi di carattere non elaborati.</span><span class="sxs-lookup"><span data-stu-id="ee17e-386">There are easier ways that use APIs discussed above for handling raw font files, however.</span></span> <span data-ttu-id="ee17e-387">La necessità di un'implementazione del flusso personalizzata potrebbe essere evitata usando percorsi di codice distinti per i file di tipo carattere compressi rispetto ai file di tipo carattere non elaborati.</span><span class="sxs-lookup"><span data-stu-id="ee17e-387">The need for a custom stream implementation could be avoided by using separate code paths for packed font files versus raw font files.</span></span> 

<span data-ttu-id="ee17e-388">Dopo la creazione di un oggetto del caricatore di file del tipo di carattere personalizzato, i dati del file del tipo di carattere compresso vengono aggiunti al caricatore da mezzi specifici dell'app.</span><span class="sxs-lookup"><span data-stu-id="ee17e-388">After a custom font file loader object is created, the packed font file data is added to the loader by app-specific means.</span></span> <span data-ttu-id="ee17e-389">Il caricatore può gestire più file di tipi di carattere, ciascuno dei quali viene identificato usando una chiave definita dall'app che è opaca per DirectWrite.</span><span class="sxs-lookup"><span data-stu-id="ee17e-389">The loader can handle multiple font files, each of which is identified using an app-defined key that is opaque to DirectWrite.</span></span> <span data-ttu-id="ee17e-390">Dopo l'aggiunta di un file del tipo di carattere compresso al caricatore, viene usato il metodo [**IDWriteFactory archiviata nei:: CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) per ottenere un [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) in base al caricatore per i dati del tipo di carattere identificati da una chiave specificata.</span><span class="sxs-lookup"><span data-stu-id="ee17e-390">After a packed font file has been added to the loader, the [**IDWriteFactory::CreateCustomFontFileReference**](/windows/win32/api/dwrite/nf-dwrite-idwritefactory-createcustomfontfilereference) method is used to obtain an [**IDWriteFontFile**](/windows/win32/api/dwrite/nn-dwrite-idwritefontfile) based on that loader for the font data identified by a given key.</span></span>  

<span data-ttu-id="ee17e-391">È possibile decomprimere effettivamente i dati del tipo di carattere poiché i tipi di carattere vengono aggiunti al caricatore, ma possono anche essere gestiti nel metodo [**IDWriteFontFileLoader:: CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) , che DirectWrite chiamerà quando è necessario leggere prima i dati del tipo di carattere.</span><span class="sxs-lookup"><span data-stu-id="ee17e-391">The actual unpacking of the font data can be done as fonts are added to the loader, but can also be handled in the [**IDWriteFontFileLoader::CreateStreamFromKey**](/windows/win32/api/dwrite/nf-dwrite-idwritefontfileloader-createstreamfromkey) method, which DirectWrite will call when it first needs to read the font data.</span></span> 

<span data-ttu-id="ee17e-392">Dopo la creazione di un oggetto IDWriteFontFile, i passaggi rimanenti per aggiungere i tipi di carattere a un set di caratteri personalizzato saranno quelli descritti in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ee17e-392">After an IDWriteFontFile object has been created, remaining steps for adding the fonts to a custom font set will be as described above.</span></span> 

<span data-ttu-id="ee17e-393">Un'implementazione che usa questo approccio è illustrata nell' [esempio di set di caratteri personalizzati DirectWrite](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span><span class="sxs-lookup"><span data-stu-id="ee17e-393">An implementation using this approach is illustrated in the [DirectWrite Custom Font Sets sample](https://github.com/Microsoft/Windows-classic-samples/tree/master/Samples/DirectWriteCustomFontSets/).</span></span> 

### <a name="using-directwrite-remote-font-mechanisms-with-custom-low-level-network-implementation"></a><span data-ttu-id="ee17e-394">Uso di meccanismi di tipo carattere remoto DirectWrite con implementazione di rete di basso livello personalizzata</span><span class="sxs-lookup"><span data-stu-id="ee17e-394">Using DirectWrite remote font mechanisms with custom low-level network implementation</span></span>

<span data-ttu-id="ee17e-395">I meccanismi DirectWrite per la gestione dei tipi di carattere remoti possono essere divisi in meccanismi di livello superiore, con set di tipi di carattere che includono riferimenti ai tipi di carattere per i tipi di carattere remoti, verifica della località dei dati del tipo di carattere e gestione della coda per le richieste di download del tipo di carattere e dei meccanismi di basso livello che gestiscono</span><span class="sxs-lookup"><span data-stu-id="ee17e-395">The DirectWrite mechanisms for handling remote fonts can be divided into higher-level mechanisms — having font sets that include font face references for remote fonts, checking locality of the font data, and managing the queue for font download requests — and the lower-level mechanisms that handle actual download.</span></span> <span data-ttu-id="ee17e-396">Alcune app possono voler usare i meccanismi di tipo carattere remoto di livello superiore, ma richiedono anche interazioni di rete personalizzate, ad esempio la comunicazione con i server che usano protocolli diversi da HTTP.</span><span class="sxs-lookup"><span data-stu-id="ee17e-396">Some apps may want to utilize the higher-level remote font mechanisms, but also require custom network interactions, such as communicating with servers using protocols other than HTTP.</span></span> 

<span data-ttu-id="ee17e-397">Per questa situazione, un'app deve creare un'implementazione personalizzata dell'interfaccia [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader) che interagisce con altre interfacce di livello inferiore nei modi richiesti.</span><span class="sxs-lookup"><span data-stu-id="ee17e-397">For this situation, an app will need to create a custom implementation of the [**IDWriteRemoteFontFileLoader**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfileloader) interface that interacts with other lower-level interfaces in the required ways.</span></span> <span data-ttu-id="ee17e-398">L'app dovrà anche fornire implementazioni personalizzate di queste interfacce di basso livello: [**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream)e [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult).</span><span class="sxs-lookup"><span data-stu-id="ee17e-398">The app will also need to provide custom implementations of these lower-level interfaces: [**IDWriteRemoteFontFileStream**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteremotefontfilestream), and [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult).</span></span> <span data-ttu-id="ee17e-399">Queste tre interfacce hanno metodi di callback che DirectWrite chiamerà durante le operazioni di download.</span><span class="sxs-lookup"><span data-stu-id="ee17e-399">These three interfaces have callback methods that DirectWrite will call during download operations.</span></span> 

<span data-ttu-id="ee17e-400">Quando viene chiamato [**IDWriteFontDownloadQueue:: BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload) , DirectWrite esegue query sul caricatore di file del tipo di carattere remoto sulla località dei dati e richiede il flusso remoto.</span><span class="sxs-lookup"><span data-stu-id="ee17e-400">When [**IDWriteFontDownloadQueue::BeginDownload**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwritefontdownloadqueue-begindownload) is called, DirectWrite will make queries to the remote font file loader about locality of the data, and will request the remote stream.</span></span> <span data-ttu-id="ee17e-401">Se i dati non sono locali, chiamerà il Metodo BeginDownload del flusso.</span><span class="sxs-lookup"><span data-stu-id="ee17e-401">If data is not local, then it will call the stream’s BeginDownload method.</span></span> <span data-ttu-id="ee17e-402">L'implementazione del flusso non deve bloccarsi sulla chiamata, ma deve restituire immediatamente un oggetto [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult) che fornisce l'handle di attesa che DirectWrite utilizzerà per attendere l'operazione di download asincrona.</span><span class="sxs-lookup"><span data-stu-id="ee17e-402">The stream implementation should not block on that call, but should immediately return, passing back an [**IDWriteAsyncResult**](/windows/win32/api/dwrite_3/nn-dwrite_3-idwriteasyncresult) object that provides the wait handle DirectWrite will use to wait on the asynchronous download operation.</span></span> <span data-ttu-id="ee17e-403">L'implementazione del flusso personalizzato è responsabile della gestione della comunicazione remota.</span><span class="sxs-lookup"><span data-stu-id="ee17e-403">The custom stream implementation is responsible for handling the remote communication.</span></span> <span data-ttu-id="ee17e-404">Quando si è verificato l'evento di completamento, DirectWrite chiamerà [**IDWriteAsyncResult:: GetResult**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwriteasyncresult-getresult) per determinare il risultato dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="ee17e-404">When the completion event has occurred, then DirectWrite will call [**IDWriteAsyncResult::GetResult**](/windows/win32/api/dwrite_3/nf-dwrite_3-idwriteasyncresult-getresult) to determine the result of the operation.</span></span> <span data-ttu-id="ee17e-405">Se il risultato ha esito positivo, si prevede che le successive chiamate ReadFragment al flusso per gli intervalli scaricati vengano eseguite correttamente.</span><span class="sxs-lookup"><span data-stu-id="ee17e-405">If the result is successful, then it’s expected that subsequent ReadFragment calls to the stream for the downloaded ranges will succeed.</span></span> 

> [!IMPORTANT]
> <span data-ttu-id="ee17e-406">Nota sulla sicurezza/prestazioni: quando viene effettuato un tentativo di recupero di un tipo di carattere remoto, il potenziale esiste in generale perché un utente malintenzionato possa falsificare il server previsto chiamato o che il server non risponde.</span><span class="sxs-lookup"><span data-stu-id="ee17e-406">Security / performance note: When an attempt is made to fetch a remote font, the potential exists in general for an attacker to spoof the intended server being called, or that the server may not respond.</span></span> <span data-ttu-id="ee17e-407">Se si implementano interazioni di rete personalizzate, è possibile che si disponga di un maggiore controllo sulle mitigazioni rispetto a quando si gestiscono server di terze parti.</span><span class="sxs-lookup"><span data-stu-id="ee17e-407">If you are implementing custom network interactions, you may have greater control over mitigations than when dealing with third-party servers.</span></span> <span data-ttu-id="ee17e-408">Tuttavia, spetta all'utente prendere in considerazione le mitigazioni appropriate per evitare la divulgazione di informazioni o un attacco Denial of Service.</span><span class="sxs-lookup"><span data-stu-id="ee17e-408">However, it is up to you to consider appropriate mitigations to avoid information disclosure or denial of service.</span></span> <span data-ttu-id="ee17e-409">Sono consigliati protocolli sicuri, ad esempio HTTPS.</span><span class="sxs-lookup"><span data-stu-id="ee17e-409">Secure protocols such as HTTPS are recommended.</span></span> <span data-ttu-id="ee17e-410">Inoltre, è necessario compilare un timeout in modo che l'handle di evento restituito a DirectWrite venga impostato.</span><span class="sxs-lookup"><span data-stu-id="ee17e-410">Also, you should build in some timeout so that the event handle returned to DirectWrite does eventually get set.</span></span> 

 

### <a name="supporting-scenarios-on-earlier-windows-versions"></a><span data-ttu-id="ee17e-411">Scenari di supporto nelle versioni precedenti di Windows</span><span class="sxs-lookup"><span data-stu-id="ee17e-411">Supporting scenarios on earlier Windows versions</span></span>

<span data-ttu-id="ee17e-412">Gli scenari descritti possono essere supportati in DirectWrite nelle versioni precedenti di Windows, ma richiedono un'implementazione molto più personalizzata della parte dell'app usando le API più limitate disponibili prima di Windows 10.</span><span class="sxs-lookup"><span data-stu-id="ee17e-412">The scenarios that have been described can be supported in DirectWrite on earlier versions of Windows, but would require much more custom implementation on the part of the app using the more limited APIs that were available prior to Windows 10.</span></span> <span data-ttu-id="ee17e-413">Per ulteriori informazioni, vedere [raccolte di tipi di carattere personalizzati (Windows 7/8)](custom-font-collections.md).</span><span class="sxs-lookup"><span data-stu-id="ee17e-413">For more information, see [Custom Font Collections (Windows 7/8)](custom-font-collections.md).</span></span>

 

 