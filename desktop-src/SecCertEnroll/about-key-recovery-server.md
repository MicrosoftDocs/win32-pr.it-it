---
description: È possibile configurare un'autorità di certificazione Microsoft (CA) per archiviare e ripristinare la chiave privata associata alla chiave pubblica inviata nella richiesta di certificato.
ms.assetid: c6535dbf-c3fe-4f70-9a70-02805253a651
title: Server di ripristino chiavi
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b4e9fd60b7ee6596b98953d382978be64695c035
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103881673"
---
# <a name="key-recovery-server"></a><span data-ttu-id="d706c-103">Server di ripristino chiavi</span><span class="sxs-lookup"><span data-stu-id="d706c-103">Key Recovery Server</span></span>

<span data-ttu-id="d706c-104">È possibile configurare un'autorità di certificazione Microsoft (CA) per archiviare e ripristinare la chiave privata associata alla chiave pubblica inviata nella richiesta di certificato.</span><span class="sxs-lookup"><span data-stu-id="d706c-104">A Microsoft certification authority (CA) can be configured to archive and recover the private key associated with the public key submitted in the certificate request.</span></span> <span data-ttu-id="d706c-105">Il ripristino è utile in caso di perdita di una chiave.</span><span class="sxs-lookup"><span data-stu-id="d706c-105">Recovery is useful if a key is lost.</span></span> <span data-ttu-id="d706c-106">Per impostazione predefinita, è possibile archiviare solo le chiavi di crittografia.</span><span class="sxs-lookup"><span data-stu-id="d706c-106">By default, only encryption keys can be archived.</span></span> <span data-ttu-id="d706c-107">Non è necessario archiviare le chiavi destinate solo alla firma perché è necessaria solo la chiave pubblica per verificare una firma se la chiave di firma privata viene persa.</span><span class="sxs-lookup"><span data-stu-id="d706c-107">It is not necessary to archive keys intended only for signing because only the public key is needed to verify a signature if the private signing key is lost.</span></span>

<span data-ttu-id="d706c-108">Per archiviare una chiave, la CA deve essere configurata per emettere certificati di Key Recovery Agent (KRA) e per avere già emesso almeno uno.</span><span class="sxs-lookup"><span data-stu-id="d706c-108">To archive a key, the CA must be configured to issue key recovery agent (KRA) certificates and to have already issued at least one.</span></span> <span data-ttu-id="d706c-109">Un agente di recupero chiavi è un amministratore autorizzato da un'organizzazione a decrittografare le chiavi private.</span><span class="sxs-lookup"><span data-stu-id="d706c-109">A key recovery agent is an administrator authorized by an organization to decrypt private keys.</span></span> <span data-ttu-id="d706c-110">Per migliorare la sicurezza, è consigliabile assegnare l'agente di recupero chiavi e i ruoli di gestione certificati a singoli utenti, che il gestore di certificati sia autorizzato a recuperare ma non decrittografare le chiavi archiviate e che l'agente di recupero chiavi sia autorizzato a decrittografare le chiavi, ma non recuperarle.</span><span class="sxs-lookup"><span data-stu-id="d706c-110">To enhance security, we recommend that the key recovery agent and the certificate manager roles be assigned to different individuals, that the certificate manager be permitted to retrieve but not decrypt archived keys, and that the key recovery agent be permitted to decrypt keys but not retrieve them.</span></span>

## <a name="key-archival"></a><span data-ttu-id="d706c-111">Archiviazione delle chiavi</span><span class="sxs-lookup"><span data-stu-id="d706c-111">Key Archival</span></span>

<span data-ttu-id="d706c-112">Un client richiede in genere un certificato usando un modello.</span><span class="sxs-lookup"><span data-stu-id="d706c-112">A client typically requests a certificate by using a template.</span></span> <span data-ttu-id="d706c-113">Se il modello richiede che la chiave privata venga archiviata, il client e la CA eseguono i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="d706c-113">If the template requires that the private key be archived, the following steps are performed by the client and the CA:</span></span>

1.  <span data-ttu-id="d706c-114">Il client recupera e convalida il certificato di scambio CA per determinare se è stato firmato con la stessa chiave usata per firmare il certificato di firma della CA.</span><span class="sxs-lookup"><span data-stu-id="d706c-114">The client retrieves and validates the CA exchange certificate to determine whether it has been signed by the same key that was used to sign the CA signing certificate.</span></span> <span data-ttu-id="d706c-115">Ciò garantisce che l'unica autorità di certificazione in grado di decrittografare la chiave privata sia la CA da cui viene richiesto un certificato.</span><span class="sxs-lookup"><span data-stu-id="d706c-115">This ensures that the only CA that can decrypt the private key is the CA from which a certificate is being requested.</span></span>
2.  <span data-ttu-id="d706c-116">La chiave pubblica nel certificato di scambio CA viene usata per crittografare la chiave privata associata alla richiesta di certificato e la richiesta viene inviata all'autorità di certificazione.</span><span class="sxs-lookup"><span data-stu-id="d706c-116">The public key in the CA exchange certificate is used to encrypt the private key associated with the certificate request, and the request is sent to the CA.</span></span>
3.  <span data-ttu-id="d706c-117">La CA USA la chiave privata associata al certificato di Exchange per decrittografare la chiave privata inviata dal client e verifica che le chiavi pubbliche e private nella richiesta siano correlate.</span><span class="sxs-lookup"><span data-stu-id="d706c-117">The CA uses the private key associated with its exchange certificate to decrypt the private key sent by the client and verifies that the public and private keys in the request are related.</span></span>
4.  <span data-ttu-id="d706c-118">La CA crittografa la chiave privata utilizzando la chiave pubblica nel certificato KRA.</span><span class="sxs-lookup"><span data-stu-id="d706c-118">The CA encrypts the private key by using the public key in the KRA certificate.</span></span> <span data-ttu-id="d706c-119">Se la CA ha emesso più certificati KRA, crittografa la chiave privata una volta con ogni chiave pubblica disponibile, in modo che qualsiasi agente di recupero chiavi autorizzato possa recuperare una chiave.</span><span class="sxs-lookup"><span data-stu-id="d706c-119">If the CA has issued multiple KRA certificates, it encrypts the private key once with each available public key so that any authorized key recovery agent can recover a key.</span></span> <span data-ttu-id="d706c-120">Le chiavi private crittografate vengono archiviate nel database dei certificati.</span><span class="sxs-lookup"><span data-stu-id="d706c-120">The encrypted private keys are stored in the certificate database.</span></span>
5.  <span data-ttu-id="d706c-121">La CA rilascia tutti i riferimenti alla chiave privata e libera in modo sicuro e azzera tutta la memoria che contiene la chiave.</span><span class="sxs-lookup"><span data-stu-id="d706c-121">The CA releases all references to the private key and securely frees and zeros all memory that contained the key.</span></span> <span data-ttu-id="d706c-122">In questo modo, l'autorità di certificazione non ha più accesso alla chiave in formato testo non crittografato.</span><span class="sxs-lookup"><span data-stu-id="d706c-122">This ensures that the CA has no further access to the key in clear text format.</span></span>

> [!Note]  
> <span data-ttu-id="d706c-123">Solo una richiesta CMC può essere usata per l'archiviazione delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="d706c-123">Only a CMC request can be used for key archival.</span></span> <span data-ttu-id="d706c-124">Le richieste CMC sono rappresentate dall'interfaccia [**IX509CertificateRequestCmc**](/windows/desktop/api/CertEnroll/nn-certenroll-ix509certificaterequestcmc) .</span><span class="sxs-lookup"><span data-stu-id="d706c-124">CMC requests are represented by the [**IX509CertificateRequestCmc**](/windows/desktop/api/CertEnroll/nn-certenroll-ix509certificaterequestcmc) interface.</span></span>

 

## <a name="key-recovery"></a><span data-ttu-id="d706c-125">Recupero chiavi</span><span class="sxs-lookup"><span data-stu-id="d706c-125">Key Recovery</span></span>

<span data-ttu-id="d706c-126">Il recupero delle chiavi non è supportato direttamente da Servizi certificati Active Directory o dall'API di registrazione certificati.</span><span class="sxs-lookup"><span data-stu-id="d706c-126">Key recovery is not directly supported by Active Directory Certificate Services or the Certificate Enrollment API.</span></span> <span data-ttu-id="d706c-127">Microsoft, tuttavia, fornisce le seguenti applicazioni per semplificare il processo:</span><span class="sxs-lookup"><span data-stu-id="d706c-127">Microsoft does, however, provide the following applications to help with the process:</span></span>

-   <span data-ttu-id="d706c-128">Certutil.exe è un programma da riga di comando che può essere usato per recuperare le informazioni di configurazione della CA, verificare i certificati, le coppie di chiavi e le catene di certificati, nonché eseguire il backup e il ripristino delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="d706c-128">Certutil.exe is a command line program that can be used to retrieve CA configuration information, verify certificates, key pairs, and certificate chains, and back up and restore keys.</span></span> <span data-ttu-id="d706c-129">È incluso nei sistemi operativi server a partire da Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="d706c-129">It is included in server operating systems beginning with Windows Server 2003.</span></span>
-   <span data-ttu-id="d706c-130">Krecover.exe è un programma basato su finestra di dialogo che consente il recupero della chiave.</span><span class="sxs-lookup"><span data-stu-id="d706c-130">Krecover.exe is a dialog box–based program that enables key recovery.</span></span> <span data-ttu-id="d706c-131">È incluso nel Resource Kit a partire da Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="d706c-131">It is included with the Resource Kit beginning with Windows Server 2003.</span></span>

<span data-ttu-id="d706c-132">Per recuperare una chiave privata vengono eseguiti i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="d706c-132">The following steps are performed to recover a private key:</span></span>

1.  <span data-ttu-id="d706c-133">Il gestore di certificati individua potenziali candidati per il ripristino della chiave nel database del certificato usando il nome del certificato, del richiedente o dell'utente.</span><span class="sxs-lookup"><span data-stu-id="d706c-133">The certificate manager locates potential candidates for key recovery in the certificate database by using the name of the certificate, requester, or user.</span></span> <span data-ttu-id="d706c-134">A questo scopo, è possibile usare il comando **certutil** **-GetKey** .</span><span class="sxs-lookup"><span data-stu-id="d706c-134">The **Certutil** **-getkey** command can be used for this purpose.</span></span>
2.  <span data-ttu-id="d706c-135">Una volta che il gestore di certificati dispone di un elenco di certificati, il comando **-GetKey** viene richiamato con un numero di serie del certificato specifico o una stampa Thumb per recuperare un \# file PKCS 7 che contiene il certificato Kra, la catena di certificati utente e la chiave privata crittografata durante l'archiviazione tramite la chiave pubblica Kra.</span><span class="sxs-lookup"><span data-stu-id="d706c-135">Once the certificate manager has a list of certificates, the **-getkey** command is called again with a specific certificate serial number or thumb print to retrieve a PKCS \#7 file that contains the KRA certificate, user certificate chain, and the private key that was encrypted during archival by using the KRA public key.</span></span>
3.  <span data-ttu-id="d706c-136">Il gestore di certificati passa il controllo del processo all'agente di recupero chiavi la cui chiave privata corrisponde alla chiave pubblica contenuta nel certificato KRA.</span><span class="sxs-lookup"><span data-stu-id="d706c-136">The certificate manager passes control of the process to the key recovery agent whose private key matches the public key contained in the KRA certificate.</span></span>
4.  <span data-ttu-id="d706c-137">L'agente di recupero chiavi decrittografa la chiave privata archiviata restituita nel \# file PKCS 7 utilizzando la chiave privata Kra.</span><span class="sxs-lookup"><span data-stu-id="d706c-137">The key recovery agent decrypts the archived private key returned in the PKCS \#7 file by using the KRA private key.</span></span> <span data-ttu-id="d706c-138">Questa operazione può essere eseguita usando il comando **certutil** **-recoverkey** che inserisce la chiave in un file PKCS 12 protetto da password \# .</span><span class="sxs-lookup"><span data-stu-id="d706c-138">This can be done by using the **Certutil** **-recoverkey** command which places the key in a password-protected PKCS \#12 file.</span></span> <span data-ttu-id="d706c-139">Al client deve essere assegnata la password tramite un meccanismo fuori banda sicuro.</span><span class="sxs-lookup"><span data-stu-id="d706c-139">The client must be given the password through a secure out-of-band mechanism.</span></span>
5.  <span data-ttu-id="d706c-140">Il client importa il \# file PKCS 12 e usa la password per recuperare la chiave.</span><span class="sxs-lookup"><span data-stu-id="d706c-140">The client imports the PKCS \#12 file and uses the password to retrieve the key.</span></span>

## <a name="related-topics"></a><span data-ttu-id="d706c-141">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="d706c-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d706c-142">Elementi PKI</span><span class="sxs-lookup"><span data-stu-id="d706c-142">PKI Elements</span></span>](about-pki-components.md)
</dt> </dl>

 

 



