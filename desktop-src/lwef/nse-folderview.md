---
title: Implementazione di una visualizzazione cartelle
description: Windows Shell fornisce un'implementazione predefinita della visualizzazione cartelle, colloquialmente noto come DefView, in modo che sia possibile evitare la maggior parte delle operazioni di implementazione dell'estensione dello spazio dei nomi.
ms.assetid: 8c6712d8-c3cb-4450-8277-3a8675622651
keywords:
- oggetto visualizzazione cartella
- IShellView
- IShellBrowser, oggetti visualizzazione cartella
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 48c7b86d587154a034f276d4bdab903e5337ed4b
ms.sourcegitcommit: 469b6de41e2a565b7ead231d7f282ec4071ac158
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/11/2020
ms.locfileid: "104399869"
---
# <a name="implementing-a-folder-view"></a><span data-ttu-id="a3b96-106">Implementazione di una visualizzazione cartelle</span><span class="sxs-lookup"><span data-stu-id="a3b96-106">Implementing a Folder View</span></span>

<span data-ttu-id="a3b96-107">Windows Shell fornisce un'implementazione predefinita della visualizzazione cartelle, colloquialmente noto come DefView, in modo che sia possibile evitare la maggior parte delle operazioni di implementazione dell'estensione dello spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="a3b96-107">Windows Shell provides a default implementation of the folder view, colloquially known as DefView, so that you can avoid much of the work of implementing your own namespace extension.</span></span> <span data-ttu-id="a3b96-108">Poiché alcune funzionalità di visualizzazione non possono essere realizzate tramite visualizzazioni personalizzate, è spesso consigliabile usare l'oggetto visualizzazione cartella di sistema predefinito al posto di una visualizzazione personalizzata.</span><span class="sxs-lookup"><span data-stu-id="a3b96-108">Because some view features cannot be achieved through custom views, it is often recommended that the default system folder view object is used in place of a custom view.</span></span> <span data-ttu-id="a3b96-109">Per ulteriori informazioni, vedere [**SHCreateShellFolderView**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shcreateshellfolderview).</span><span class="sxs-lookup"><span data-stu-id="a3b96-109">For more information, see [**SHCreateShellFolderView**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shcreateshellfolderview).</span></span> <span data-ttu-id="a3b96-110">Nella parte restante di questo argomento viene illustrata l'implementazione di una visualizzazione cartella personalizzata che non supporta le funzionalità di visualizzazione più recenti.</span><span class="sxs-lookup"><span data-stu-id="a3b96-110">The remainder of this topic discusses implementing a custom folder view that cannot support newer view features.</span></span>

<span data-ttu-id="a3b96-111">A differenza della visualizzazione albero, Esplora risorse non gestisce il contenuto di una visualizzazione cartelle.</span><span class="sxs-lookup"><span data-stu-id="a3b96-111">Unlike the tree view, Windows Explorer does not manage the contents of a folder view.</span></span> <span data-ttu-id="a3b96-112">La finestra visualizzazione cartelle ospita invece una finestra figlio fornita dall'oggetto Folder.</span><span class="sxs-lookup"><span data-stu-id="a3b96-112">Instead, the folder view window hosts a child window that is provided by the folder object.</span></span> <span data-ttu-id="a3b96-113">L'oggetto Folder è responsabile della creazione di un oggetto visualizzazione cartella per visualizzare il contenuto della cartella nella finestra figlio.</span><span class="sxs-lookup"><span data-stu-id="a3b96-113">The folder object is responsible for creating a folder view object to display the folder's contents in the child window.</span></span>

<span data-ttu-id="a3b96-114">La chiave per implementare un oggetto visualizzazione cartella è l'interfaccia [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-114">The key to implementing a folder view object is the [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="a3b96-115">Questa interfaccia viene utilizzata da Esplora risorse per comunicare con l'oggetto visualizzazione cartella.</span><span class="sxs-lookup"><span data-stu-id="a3b96-115">This interface is used by Windows Explorer to communicate with the folder view object.</span></span> <span data-ttu-id="a3b96-116">Prima di visualizzare una visualizzazione cartelle, Esplora risorse chiama il metodo [**IShellFolder:: CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) dell'oggetto Folder con *riid* impostato su IID \_ IShellView.</span><span class="sxs-lookup"><span data-stu-id="a3b96-116">Before displaying a folder view, Windows Explorer calls the folder object's [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) method with *riid* set to IID\_IShellView.</span></span> <span data-ttu-id="a3b96-117">Creare un oggetto visualizzazione cartelle e restituire l'interfaccia **IShellView** .</span><span class="sxs-lookup"><span data-stu-id="a3b96-117">Create a folder view object and return its **IShellView** interface.</span></span> <span data-ttu-id="a3b96-118">L'oggetto visualizzazione cartelle deve quindi creare una finestra figlio della finestra visualizzazione cartelle e utilizzare la finestra figlio per visualizzare le informazioni relative al contenuto della cartella.</span><span class="sxs-lookup"><span data-stu-id="a3b96-118">The folder view object must then create a child window of the folder view window and use the child window to display information about the folder's contents.</span></span>

<span data-ttu-id="a3b96-119">Oltre a controllare la modalità di visualizzazione dei dati, le estensioni possono anche personalizzare una serie di funzionalità di Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-119">In addition to controlling how data is displayed, extensions can also customize a number of the features of Windows Explorer.</span></span> <span data-ttu-id="a3b96-120">Ad esempio, un'estensione può aggiungere elementi alla barra degli strumenti o alla barra dei menu o visualizzare informazioni sulla barra di stato.</span><span class="sxs-lookup"><span data-stu-id="a3b96-120">For instance, an extension can add items to the toolbar or menu bar, or display information on the status bar.</span></span>

-   [<span data-ttu-id="a3b96-121">Oggetto visualizzazione cartella</span><span class="sxs-lookup"><span data-stu-id="a3b96-121">The Folder View Object</span></span>](#the-folder-view-object)
-   [<span data-ttu-id="a3b96-122">Inizializzazione dell'oggetto visualizzazione cartella</span><span class="sxs-lookup"><span data-stu-id="a3b96-122">Initializing the Folder View Object</span></span>](#initializing-the-folder-view-object)
-   [<span data-ttu-id="a3b96-123">Visualizzazione della visualizzazione cartelle</span><span class="sxs-lookup"><span data-stu-id="a3b96-123">Displaying the Folder View</span></span>](#displaying-the-folder-view)
-   [<span data-ttu-id="a3b96-124">Implementazione di IShellView</span><span class="sxs-lookup"><span data-stu-id="a3b96-124">Implementing IShellView</span></span>](#implementing-ishellview)
    -   [<span data-ttu-id="a3b96-125">AddPropertySheetPages</span><span class="sxs-lookup"><span data-stu-id="a3b96-125">AddPropertySheetPages</span></span>](#addpropertysheetpages)
    -   [<span data-ttu-id="a3b96-126">GetCurrentInfo</span><span class="sxs-lookup"><span data-stu-id="a3b96-126">GetCurrentInfo</span></span>](#getcurrentinfo)
    -   [<span data-ttu-id="a3b96-127">Aggiorna</span><span class="sxs-lookup"><span data-stu-id="a3b96-127">Refresh</span></span>](#refresh)
    -   [<span data-ttu-id="a3b96-128">SaveViewState</span><span class="sxs-lookup"><span data-stu-id="a3b96-128">SaveViewState</span></span>](#saveviewstate)
    -   [<span data-ttu-id="a3b96-129">TranslateAcelerator</span><span class="sxs-lookup"><span data-stu-id="a3b96-129">TranslateAcelerator</span></span>](#translateacelerator)
-   [<span data-ttu-id="a3b96-130">Uso di IShellBrowser per comunicare con Esplora risorse</span><span class="sxs-lookup"><span data-stu-id="a3b96-130">Using IShellBrowser to Communicate with Windows Explorer</span></span>](#using-ishellbrowser-to-communicate-with-windows-explorer)
    -   [<span data-ttu-id="a3b96-131">Modifica della barra dei menu di Esplora risorse</span><span class="sxs-lookup"><span data-stu-id="a3b96-131">Modifying the Windows Explorer Menu Bar</span></span>](#modifying-the-windows-explorer-menu-bar)
    -   [<span data-ttu-id="a3b96-132">Modifica della barra degli strumenti di Esplora risorse</span><span class="sxs-lookup"><span data-stu-id="a3b96-132">Modifying the Windows Explorer Toolbar</span></span>](#modifying-the-windows-explorer-toolbar)
    -   [<span data-ttu-id="a3b96-133">Modifica della barra di stato di Esplora risorse</span><span class="sxs-lookup"><span data-stu-id="a3b96-133">Modifying the Windows Explorer Status Bar</span></span>](#modifying-the-windows-explorer-status-bar)
    -   [<span data-ttu-id="a3b96-134">Archiviazione di informazioni specifiche della visualizzazione</span><span class="sxs-lookup"><span data-stu-id="a3b96-134">Storing View-specific Information</span></span>](#storing-view-specific-information)

## <a name="the-folder-view-object"></a><span data-ttu-id="a3b96-135">Oggetto visualizzazione cartella</span><span class="sxs-lookup"><span data-stu-id="a3b96-135">The Folder View Object</span></span>

<span data-ttu-id="a3b96-136">Un oggetto visualizzazione cartella è un oggetto Component Object Model (COM) che espone un'interfaccia [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-136">A folder view object is a Component Object Model (COM) object that exposes an [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="a3b96-137">Questo oggetto è responsabile di:</span><span class="sxs-lookup"><span data-stu-id="a3b96-137">This object is responsible for:</span></span>

-   <span data-ttu-id="a3b96-138">Creazione di una finestra figlio della finestra visualizzazione cartelle e relativa utilizzo per visualizzare il contenuto della cartella.</span><span class="sxs-lookup"><span data-stu-id="a3b96-138">Creating a child window of the folder view window and using it to display the contents of the folder.</span></span>
-   <span data-ttu-id="a3b96-139">Gestione della comunicazione con Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-139">Handling communication with Windows Explorer.</span></span>
-   <span data-ttu-id="a3b96-140">Aggiunta di comandi specifici per la cartella alla barra dei menu e della barra degli strumenti di Esplora risorse e gestione di tali comandi quando sono selezionati.</span><span class="sxs-lookup"><span data-stu-id="a3b96-140">Adding folder-specific commands to the Windows Explorer menu bar and toolbar and handling those commands when they are selected.</span></span>
-   <span data-ttu-id="a3b96-141">Gestione dell'interazione utente con la finestra visualizzazione cartelle, ad esempio la visualizzazione di menu di scelta rapida o la gestione delle operazioni di trascinamento della selezione.</span><span class="sxs-lookup"><span data-stu-id="a3b96-141">Managing user interaction with the folder view window, such as displaying shortcut menus or handling drag-and-drop operations.</span></span>

<span data-ttu-id="a3b96-142">In questo documento vengono illustrati i primi tre argomenti.</span><span class="sxs-lookup"><span data-stu-id="a3b96-142">This document discusses the first three topics.</span></span> <span data-ttu-id="a3b96-143">Poiché l'interazione dell'utente con la visualizzazione cartelle avviene all'interno della finestra figlio, l'oggetto visualizzazione cartella è responsabile della relativa gestione come per qualsiasi altra finestra.</span><span class="sxs-lookup"><span data-stu-id="a3b96-143">Because user interaction with the folder view takes place within your child window, your folder view object is responsible for handling it as it would for any other window.</span></span>

<span data-ttu-id="a3b96-144">Esplora risorse richiede un oggetto visualizzazione cartelle chiamando [**IShellFolder:: CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) dell'oggetto Folder con *riid* impostato su IID \_ IShellView.</span><span class="sxs-lookup"><span data-stu-id="a3b96-144">Windows Explorer requests a folder view object by calling your folder object's [**IShellFolder::CreateViewObject**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellfolder-createviewobject) with *riid* set to IID\_IShellView.</span></span> <span data-ttu-id="a3b96-145">La procedura per la creazione di una visualizzazione cartella è la seguente:</span><span class="sxs-lookup"><span data-stu-id="a3b96-145">The procedure for creating a folder view is:</span></span>

1.  <span data-ttu-id="a3b96-146">L'oggetto Folder Crea una nuova istanza dell'oggetto visualizzazione cartella e restituisce un puntatore alla relativa interfaccia [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-146">Your folder object creates a new instance of your folder view object and returns a pointer to its [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span>
2.  <span data-ttu-id="a3b96-147">Esplora risorse Inizializza l'oggetto visualizzazione cartelle chiamando il metodo [**IShellView:: CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-147">Windows Explorer initializes the folder view object by calling the [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) method.</span></span> <span data-ttu-id="a3b96-148">Creare una finestra figlio della finestra visualizzazione cartelle e restituire il relativo handle a Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-148">Create a child window of the folder view window and return its handle to Windows Explorer.</span></span>
3.  <span data-ttu-id="a3b96-149">L'oggetto visualizzazione cartelle utilizza l'interfaccia [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) di Esplora risorse per personalizzare la barra degli strumenti di Esplora risorse, la barra dei menu e la barra di stato.</span><span class="sxs-lookup"><span data-stu-id="a3b96-149">The folder view object uses the Windows Explorer [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface to customize the Windows Explorer toolbar, menu bar, and status bar.</span></span>
4.  <span data-ttu-id="a3b96-150">Nell'oggetto visualizzazione cartella viene visualizzato il contenuto della cartella nella finestra figlio.</span><span class="sxs-lookup"><span data-stu-id="a3b96-150">The folder view object displays the contents of the folder in the child window.</span></span>
5.  <span data-ttu-id="a3b96-151">L'oggetto visualizzazione cartella gestisce l'interazione dell'utente con la visualizzazione cartelle e qualsiasi barra degli strumenti o barra dei menu specifica della cartella.</span><span class="sxs-lookup"><span data-stu-id="a3b96-151">The folder view object handles user interaction with the folder view and any folder-specific toolbar or menu bar items.</span></span>

## <a name="initializing-the-folder-view-object"></a><span data-ttu-id="a3b96-152">Inizializzazione dell'oggetto visualizzazione cartella</span><span class="sxs-lookup"><span data-stu-id="a3b96-152">Initializing the Folder View Object</span></span>

<span data-ttu-id="a3b96-153">Esplora risorse Inizializza l'oggetto visualizzazione cartelle chiamando il metodo [**IShellView:: CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-153">Windows Explorer initializes the folder view object by calling the [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) method.</span></span> <span data-ttu-id="a3b96-154">I parametri del metodo forniscono all'oggetto visualizzazione cartelle le informazioni necessarie per creare la finestra figlio che verrà usata per visualizzare il contenuto della cartella:</span><span class="sxs-lookup"><span data-stu-id="a3b96-154">The method's parameters provide the folder view object with the information it needs to create the child window that will be used to display the folder's contents:</span></span>

-   <span data-ttu-id="a3b96-155">Puntatore all'interfaccia [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) dell'oggetto visualizzazione della cartella precedente.</span><span class="sxs-lookup"><span data-stu-id="a3b96-155">A pointer to the previous folder view object's [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface.</span></span> <span data-ttu-id="a3b96-156">Questo parametro può essere impostato su **null**.</span><span class="sxs-lookup"><span data-stu-id="a3b96-156">This parameter can be set to **NULL**.</span></span>
-   <span data-ttu-id="a3b96-157">Struttura [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) che contiene le impostazioni della visualizzazione della cartella precedente.</span><span class="sxs-lookup"><span data-stu-id="a3b96-157">A [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure that contains the previous folder view's settings.</span></span>
-   <span data-ttu-id="a3b96-158">Puntatore all'interfaccia [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) di Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-158">A pointer to the Windows Explorer [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface.</span></span>
-   <span data-ttu-id="a3b96-159">Struttura [Rect](/previous-versions//ms536136(v=vs.85)) con le dimensioni della finestra di visualizzazione cartelle.</span><span class="sxs-lookup"><span data-stu-id="a3b96-159">A [RECT](/previous-versions//ms536136(v=vs.85)) structure with the dimensions of the folder view window.</span></span>

<span data-ttu-id="a3b96-160">Il metodo [**IShellView:: CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) viene chiamato prima che l'oggetto visualizzazione della cartella precedente venga eliminato definitivamente.</span><span class="sxs-lookup"><span data-stu-id="a3b96-160">The [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) method is called before the previous folder view object is destroyed.</span></span> <span data-ttu-id="a3b96-161">Il puntatore all'interfaccia [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) consente quindi di comunicare con l'oggetto visualizzazione cartella precedente.</span><span class="sxs-lookup"><span data-stu-id="a3b96-161">The [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface pointer thus allows you to communicate with the previous folder view object.</span></span> <span data-ttu-id="a3b96-162">Questa interfaccia è particolarmente utile se la cartella precedente apparteneva all'estensione e usava lo stesso schema di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="a3b96-162">This interface is primarily useful if the previous folder belonged to your extension and used the same display scheme.</span></span> <span data-ttu-id="a3b96-163">In tal caso, è possibile comunicare con l'oggetto visualizzazione cartella precedente a scopo di questo tipo, come lo scambio di impostazioni private.</span><span class="sxs-lookup"><span data-stu-id="a3b96-163">If so, you can communicate with the previous folder view object for such purposes as exchanging private settings.</span></span>

<span data-ttu-id="a3b96-164">Un modo semplice per determinare se il puntatore [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) appartiene all'estensione consiste nel fare in modo che tutti gli oggetti visualizzazione cartella espongano un'interfaccia privata.</span><span class="sxs-lookup"><span data-stu-id="a3b96-164">A simple way to determine whether the [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) pointer belongs to your extension is to have all your folder view objects expose a private interface.</span></span> <span data-ttu-id="a3b96-165">Chiamare [IShellView:: QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) per richiedere l'interfaccia privata ed esaminare il valore restituito per determinare se l'oggetto visualizzazione cartella è uno dei propri.</span><span class="sxs-lookup"><span data-stu-id="a3b96-165">Call [IShellView::QueryInterface](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) to request the private interface, and examine the return value to determine whether the folder view object is one of yours.</span></span> <span data-ttu-id="a3b96-166">È quindi possibile usare un metodo privato su tale interfaccia per scambiare informazioni.</span><span class="sxs-lookup"><span data-stu-id="a3b96-166">You can then use a private method on that interface to exchange information.</span></span>

<span data-ttu-id="a3b96-167">La struttura [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) contiene le impostazioni di visualizzazione della visualizzazione cartella precedente.</span><span class="sxs-lookup"><span data-stu-id="a3b96-167">The [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure contains the previous folder view's display settings.</span></span> <span data-ttu-id="a3b96-168">L'impostazione principale è la modalità di visualizzazione: icona grande, icona piccola, elenco o dettagli.</span><span class="sxs-lookup"><span data-stu-id="a3b96-168">The primary setting is the viewing mode: large icon, small icon, list, or details.</span></span> <span data-ttu-id="a3b96-169">È inoltre disponibile un flag che contiene le impostazioni di un'ampia gamma di opzioni di visualizzazione, ad esempio se la visualizzazione deve essere allineata a sinistra.</span><span class="sxs-lookup"><span data-stu-id="a3b96-169">There is also a flag that contains the settings of a variety of display options, such as whether the view should be left-aligned.</span></span> <span data-ttu-id="a3b96-170">La visualizzazione della cartella deve seguire queste impostazioni nella misura massima consentita per offrire agli utenti un'esperienza coerente mentre passano da una cartella all'altra.</span><span class="sxs-lookup"><span data-stu-id="a3b96-170">Your folder display should follow these settings to the extent possible, to give users a consistent experience as they go from one folder to another.</span></span> <span data-ttu-id="a3b96-171">È consigliabile archiviare questa struttura e aggiornarla in caso di modifica delle impostazioni.</span><span class="sxs-lookup"><span data-stu-id="a3b96-171">You should store this structure and update it as the settings change.</span></span> <span data-ttu-id="a3b96-172">Esplora risorse chiama [**IShellView:: GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) per ottenere il valore più recente di questa struttura prima di aprire la visualizzazione cartella successiva.</span><span class="sxs-lookup"><span data-stu-id="a3b96-172">Windows Explorer calls [**IShellView::GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) to obtain the most recent value of this structure before it opens the next folder view.</span></span>

<span data-ttu-id="a3b96-173">L'interfaccia [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) viene esposta da Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-173">The [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface is exposed by Windows Explorer.</span></span> <span data-ttu-id="a3b96-174">Questa interfaccia è complementare a [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) e consente a un oggetto visualizzazione cartella di comunicare con Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-174">This interface is a companion to [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) and allows a folder view object to communicate with Windows Explorer.</span></span> <span data-ttu-id="a3b96-175">Non esiste un altro modo per recuperare questo puntatore di interfaccia, quindi l'oggetto visualizzazione cartelle deve archiviarlo per un uso successivo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-175">There is no other way to retrieve this interface pointer, so your folder view object should store it for later use.</span></span> <span data-ttu-id="a3b96-176">In particolare, sarà necessario chiamare [IShellBrowser:: GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) per recuperare la finestra di visualizzazione della cartella padre che si userà per creare la finestra figlio.</span><span class="sxs-lookup"><span data-stu-id="a3b96-176">In particular, you will need to call [IShellBrowser::GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) to retrieve the parent folder view window that you will use to create your child window.</span></span> <span data-ttu-id="a3b96-177">Si noti che il metodo IShellBrowser:: GetWindow non è incluso nella documentazione di **IShellBrowser** perché viene ereditato da [IOleWindow](/windows/win32/api/oleidl/nn-oleidl-iolewindow).</span><span class="sxs-lookup"><span data-stu-id="a3b96-177">Note that the IShellBrowser::GetWindow method is not included in the **IShellBrowser** documentation because it is inherited from [IOleWindow](/windows/win32/api/oleidl/nn-oleidl-iolewindow).</span></span> <span data-ttu-id="a3b96-178">Dopo l'archiviazione del puntatore a interfaccia, ricordarsi di chiamare [IShellBrowser:: AddRef](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) per incrementare il conteggio dei riferimenti dell'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="a3b96-178">After storing the interface pointer, remember to call [IShellBrowser::AddRef](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) to increment the interface's reference count.</span></span> <span data-ttu-id="a3b96-179">Quando l'interfaccia non è più necessaria, chiamare [IShellBrowser:: Release](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span><span class="sxs-lookup"><span data-stu-id="a3b96-179">When you no longer need the interface, call [IShellBrowser::Release](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span>

<span data-ttu-id="a3b96-180">Per creare la finestra figlio:</span><span class="sxs-lookup"><span data-stu-id="a3b96-180">To create your child window:</span></span>

1.  <span data-ttu-id="a3b96-181">Esaminare le strutture [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) e [Rect](/previous-versions//ms536136(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-181">Examine the [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) and [RECT](/previous-versions//ms536136(v=vs.85)) structures.</span></span>
2.  <span data-ttu-id="a3b96-182">Se necessario, ottenere le impostazioni private dall'oggetto visualizzazione cartella precedente.</span><span class="sxs-lookup"><span data-stu-id="a3b96-182">If needed, obtain private settings from the previous folder view object.</span></span>
3.  <span data-ttu-id="a3b96-183">Chiamare [IShellBrowser:: GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) per recuperare la finestra di visualizzazione della cartella padre.</span><span class="sxs-lookup"><span data-stu-id="a3b96-183">Call [IShellBrowser::GetWindow](/windows/win32/api/oleidl/nf-oleidl-iolewindow-getwindow) to retrieve the parent folder view window.</span></span>
4.  <span data-ttu-id="a3b96-184">Creare un elemento figlio della finestra di visualizzazione cartelle ottenuta nel passaggio precedente e restituirlo a Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-184">Create a child of the folder view window obtained in the previous step and return it to Windows Explorer.</span></span>

## <a name="displaying-the-folder-view"></a><span data-ttu-id="a3b96-185">Visualizzazione della visualizzazione cartelle</span><span class="sxs-lookup"><span data-stu-id="a3b96-185">Displaying the Folder View</span></span>

<span data-ttu-id="a3b96-186">Dopo aver creato la finestra figlio e averla restituita a Esplora risorse, è possibile visualizzare il contenuto della cartella.</span><span class="sxs-lookup"><span data-stu-id="a3b96-186">Once you have created the child window and returned it to Windows Explorer, you can display the folder's contents.</span></span> <span data-ttu-id="a3b96-187">In genere, le estensioni visualizzano le informazioni con la finestra figlio che ospita un [controllo visualizzazione elenco](../controls/list-view-control-reference.md) o un **controllo WebBrowser**.</span><span class="sxs-lookup"><span data-stu-id="a3b96-187">Typically, extensions display their information by having the child window host either a [list view control](../controls/list-view-control-reference.md) or a **WebBrowser control**.</span></span> <span data-ttu-id="a3b96-188">Il controllo visualizzazione elenco consente di replicare la [visualizzazione classica](web-view.md)di Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-188">The list view control allows you to replicate the Windows Explorer [classic view](web-view.md).</span></span> <span data-ttu-id="a3b96-189">Il controllo WebBrowser consente di usare un documento DHTML (Dynamic HTML) per visualizzare le informazioni, molto simile alla visualizzazione Web di Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-189">The WebBrowser control allows you to use a Dynamic HTML (DHTML) document to display your information, much like the Windows Explorer Web view.</span></span> <span data-ttu-id="a3b96-190">Per ulteriori informazioni, fare riferimento alla documentazione di tali controlli.</span><span class="sxs-lookup"><span data-stu-id="a3b96-190">For further information, refer to the documentation of those controls.</span></span>

<span data-ttu-id="a3b96-191">La finestra di visualizzazione cartelle esiste sempre, anche se non ha lo stato attivo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-191">The folder view window always exists, even if it does not have focus.</span></span> <span data-ttu-id="a3b96-192">È pertanto necessario mantenere tre stati per la finestra figlio:</span><span class="sxs-lookup"><span data-stu-id="a3b96-192">You should therefore maintain three states for your child window:</span></span>

-   <span data-ttu-id="a3b96-193">Attivato con lo stato attivo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-193">Activated with focus.</span></span> <span data-ttu-id="a3b96-194">La visualizzazione cartelle è stata creata e ha lo stato attivo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-194">The folder view has been created and has focus.</span></span> <span data-ttu-id="a3b96-195">Impostare la barra dei menu o gli elementi della barra degli strumenti appropriati per uno stato attivo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-195">Set the menu bar or toolbar items that are appropriate for a focused state.</span></span>
-   <span data-ttu-id="a3b96-196">Attivato senza lo stato attivo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-196">Activated without focus.</span></span> <span data-ttu-id="a3b96-197">La visualizzazione cartelle è stata creata ed è attiva, ma non ha lo stato attivo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-197">The folder view has been created and is active, but it does not have focus.</span></span> <span data-ttu-id="a3b96-198">Imposta la barra dei menu o gli elementi della barra degli strumenti appropriati per uno stato non attivo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-198">Set the menu bar or toolbar items that are appropriate for a nonfocused state.</span></span> <span data-ttu-id="a3b96-199">Omettere tutti gli elementi che si applicano alla selezione di elementi nella visualizzazione cartelle.</span><span class="sxs-lookup"><span data-stu-id="a3b96-199">Omit any items that apply to the selection of items within the folder view.</span></span>
-   <span data-ttu-id="a3b96-200">Disattivato.</span><span class="sxs-lookup"><span data-stu-id="a3b96-200">Deactivated.</span></span> <span data-ttu-id="a3b96-201">La visualizzazione cartelle sta per essere eliminata definitivamente.</span><span class="sxs-lookup"><span data-stu-id="a3b96-201">The folder view is about to be destroyed.</span></span> <span data-ttu-id="a3b96-202">Rimuovere tutte le voci di menu specifiche della cartella.</span><span class="sxs-lookup"><span data-stu-id="a3b96-202">Remove all folder-specific menu items.</span></span>

<span data-ttu-id="a3b96-203">Esplora risorse invia una notifica all'oggetto visualizzazione cartella quando lo stato della finestra viene modificato chiamando [**IShellView:: UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate).</span><span class="sxs-lookup"><span data-stu-id="a3b96-203">Windows Explorer notifies your folder view object when the window state changes by calling [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate).</span></span> <span data-ttu-id="a3b96-204">A sua volta, l'oggetto visualizzazione cartelle deve notificare a Esplora risorse quando un utente attiva la finestra di visualizzazione cartelle chiamando [**IShellBrowser:: OnViewWindowActive**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-onviewwindowactive).</span><span class="sxs-lookup"><span data-stu-id="a3b96-204">In turn, the folder view object should notify Windows Explorer when a user activates the folder view window by calling [**IShellBrowser::OnViewWindowActive**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-onviewwindowactive).</span></span> <span data-ttu-id="a3b96-205">Per ulteriori informazioni su questa interfaccia, vedere [utilizzo di IShellBrowser per comunicare con Esplora risorse](#using-ishellbrowser-to-communicate-with-windows-explorer).</span><span class="sxs-lookup"><span data-stu-id="a3b96-205">For further discussion of this interface, see [Using IShellBrowser to Communicate with Windows Explorer](#using-ishellbrowser-to-communicate-with-windows-explorer).</span></span>

<span data-ttu-id="a3b96-206">Mentre la visualizzazione cartella è attiva, è necessario elaborare tutti i messaggi di Windows, ad esempio le [ \_ dimensioni WM](../winmsg/wm-size.md), che appartengono alla finestra figlio.</span><span class="sxs-lookup"><span data-stu-id="a3b96-206">While the folder view is active, you need to process any Windows messages, such as [WM\_SIZE](../winmsg/wm-size.md), that belong to your child window.</span></span> <span data-ttu-id="a3b96-207">La routine della finestra riceverà anche i messaggi di [ \_ comando WM](../menurc/wm-command.md) per tutti gli elementi aggiunti alla barra dei menu o alla barra degli strumenti di Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-207">Your window procedure will also receive [WM\_COMMAND](../menurc/wm-command.md) messages for any items you have added to the Windows Explorer menu bar or toolbar.</span></span>

<span data-ttu-id="a3b96-208">Dopo aver creato la visualizzazione cartelle, Esplora risorse chiama l'interfaccia [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) dell'oggetto visualizzazione cartella per passare un'ampia gamma di informazioni.</span><span class="sxs-lookup"><span data-stu-id="a3b96-208">After creating the folder view, Windows Explorer calls the folder view object's [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) interface to pass it a variety of information.</span></span> <span data-ttu-id="a3b96-209">L'oggetto deve modificare la visualizzazione di conseguenza.</span><span class="sxs-lookup"><span data-stu-id="a3b96-209">Your object must modify its display accordingly.</span></span> <span data-ttu-id="a3b96-210">Quando la visualizzazione cartelle sta per essere distrutta, Esplora risorse invia una notifica all'oggetto visualizzazione cartelle chiamando il metodo [**IShellView::D estroyviewwindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-destroyviewwindow) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-210">When the folder view is about to be destroyed, Windows Explorer notifies the folder view object by calling its [**IShellView::DestroyViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-destroyviewwindow) method.</span></span>

## <a name="implementing-ishellview"></a><span data-ttu-id="a3b96-211">Implementazione di IShellView</span><span class="sxs-lookup"><span data-stu-id="a3b96-211">Implementing IShellView</span></span>

<span data-ttu-id="a3b96-212">Dopo che l'oggetto Folder è stato creato, Esplora risorse chiama diversi metodi [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) per richiedere informazioni o notificare all'oggetto una modifica nello stato di Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-212">After the folder object has been created, Windows Explorer calls various [**IShellView**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellview) methods to either request information or notify the object of a change in the state of Windows Explorer.</span></span> <span data-ttu-id="a3b96-213">In questa sezione viene descritto come implementare tali metodi **IShellView** .</span><span class="sxs-lookup"><span data-stu-id="a3b96-213">This section outlines how to implement those **IShellView** methods.</span></span> <span data-ttu-id="a3b96-214">I metodi rimanenti vengono utilizzati per scopi più specializzati, ad esempio la finestra di dialogo Apri file comune.</span><span class="sxs-lookup"><span data-stu-id="a3b96-214">The remaining methods are used for more specialized purposes, such as the File Open common dialog box.</span></span> <span data-ttu-id="a3b96-215">Per informazioni dettagliate, vedere la documentazione di **IShellView** .</span><span class="sxs-lookup"><span data-stu-id="a3b96-215">For details, see the **IShellView** documentation.</span></span>

### <a name="addpropertysheetpages"></a><span data-ttu-id="a3b96-216">AddPropertySheetPages</span><span class="sxs-lookup"><span data-stu-id="a3b96-216">AddPropertySheetPages</span></span>

<span data-ttu-id="a3b96-217">Quando un utente seleziona **Opzioni cartella** dal menu **strumenti** di Esplora risorse, viene visualizzata una finestra delle proprietà che consente all'utente di modificare le opzioni della cartella.</span><span class="sxs-lookup"><span data-stu-id="a3b96-217">When a user selects **Folder Options** from the Windows Explorer **Tools** menu, a property sheet is displayed that allows the user to modify the folder options.</span></span> <span data-ttu-id="a3b96-218">Esplora risorse chiama il metodo [**IShellView:: AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages) dell'oggetto visualizzazione cartella per consentire l'aggiunta di una pagina a questa finestra delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="a3b96-218">Windows Explorer calls your folder view object's [**IShellView::AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages) method to allow you to add a page to this property sheet.</span></span>

<span data-ttu-id="a3b96-219">Esplora risorse passa un puntatore a una funzione di callback [AddPropSheetPageProc](/windows/win32/api/prsht/nc-prsht-lpfnaddpropsheetpage) nel parametro *lpfn* di [**IShellView:: AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages).</span><span class="sxs-lookup"><span data-stu-id="a3b96-219">Windows Explorer passes a pointer to an [AddPropSheetPageProc](/windows/win32/api/prsht/nc-prsht-lpfnaddpropsheetpage) callback function in the *lpfn* parameter of [**IShellView::AddPropertySheetPages**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-addpropertysheetpages).</span></span> <span data-ttu-id="a3b96-220">Chiamare [CreatePropertySheetPage](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) per creare la pagina e quindi chiamare il AddPropSheetPageProc per aggiungerlo alla finestra delle proprietà.</span><span class="sxs-lookup"><span data-stu-id="a3b96-220">Call [CreatePropertySheetPage](/windows/win32/api/prsht/nf-prsht-createpropertysheetpagea) to create the page, and then call the AddPropSheetPageProc to add it to the property sheet.</span></span> <span data-ttu-id="a3b96-221">Per ulteriori informazioni sulla gestione delle finestre delle proprietà, vedere [finestre delle proprietà](../controls/property-sheets.md).</span><span class="sxs-lookup"><span data-stu-id="a3b96-221">For further discussion of how to handle property sheets, see [Property Sheets](../controls/property-sheets.md).</span></span>

### <a name="getcurrentinfo"></a><span data-ttu-id="a3b96-222">GetCurrentInfo</span><span class="sxs-lookup"><span data-stu-id="a3b96-222">GetCurrentInfo</span></span>

<span data-ttu-id="a3b96-223">Quando l'utente passa da una cartella a un'altra, Esplora risorse tenta di mantenere una visualizzazione di cartella simile.</span><span class="sxs-lookup"><span data-stu-id="a3b96-223">When the user switches from one folder to another, Windows Explorer attempts to maintain a similar folder view.</span></span> <span data-ttu-id="a3b96-224">Se, ad esempio, nella visualizzazione cartella precedente sono state visualizzate icone grandi, sarà necessario anche il successivo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-224">For instance, if the previous folder view showed large icons, the next should as well.</span></span> <span data-ttu-id="a3b96-225">Quando Esplora risorse chiama [**IShellView:: CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) per inizializzare l'oggetto visualizzazione cartella, il metodo riceve una struttura [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-225">When Windows Explorer calls [**IShellView::CreateViewWindow**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-createviewwindow) to initialize your folder view object, the method receives a [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure.</span></span> <span data-ttu-id="a3b96-226">Questa struttura contiene informazioni che consentono di rendere la visualizzazione della cartella coerente con la visualizzazione della cartella precedente.</span><span class="sxs-lookup"><span data-stu-id="a3b96-226">This structure contains information that allows you to make your folder view display consistent with the previous folder view.</span></span>

<span data-ttu-id="a3b96-227">Per garantire che la visualizzazione successiva sia coerente con la visualizzazione corrente, archiviare la struttura [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-227">To help ensure that the next view is consistent with the current view, store the [**FOLDERSETTINGS**](/windows/desktop/api/shobjidl_core/ns-shobjidl_core-foldersettings) structure.</span></span> <span data-ttu-id="a3b96-228">Se la vista viene modificata, ad esempio dalle icone grandi a piccole, aggiornare la struttura di conseguenza.</span><span class="sxs-lookup"><span data-stu-id="a3b96-228">If the view changes, for instance from large to small icons, update the structure accordingly.</span></span> <span data-ttu-id="a3b96-229">Prima di cambiare le viste, Esplora risorse chiamerà [**IShellView:: GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) per richiedere i valori **FOLDERSETTINGS** correnti per passarli all'oggetto visualizzazione cartella successiva.</span><span class="sxs-lookup"><span data-stu-id="a3b96-229">Prior to switching views, Windows Explorer will call [**IShellView::GetCurrentInfo**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-getcurrentinfo) to request the current **FOLDERSETTINGS** values to pass them to the next folder view object.</span></span>

### <a name="refresh"></a><span data-ttu-id="a3b96-230">Aggiorna</span><span class="sxs-lookup"><span data-stu-id="a3b96-230">Refresh</span></span>

<span data-ttu-id="a3b96-231">L'utente può assicurarsi che la visualizzazione cartelle rifletta lo stato corrente della cartella selezionando **Aggiorna** dal menu **Visualizza** o premendo F5.</span><span class="sxs-lookup"><span data-stu-id="a3b96-231">The user can ensure that the folder view reflects the current state of the folder by selecting **Refresh** from the **View** menu or pressing the F5 key.</span></span> <span data-ttu-id="a3b96-232">Quando l'utente esegue questa operazione, Esplora risorse chiama il metodo [**IShellView:: Refresh**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-refresh) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-232">When the user does so, Windows Explorer calls the [**IShellView::Refresh**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-refresh) method.</span></span> <span data-ttu-id="a3b96-233">L'oggetto visualizzazione cartella dovrebbe aggiornare immediatamente la visualizzazione delle cartelle.</span><span class="sxs-lookup"><span data-stu-id="a3b96-233">Your folder view object should immediately update the folder view display.</span></span>

### <a name="saveviewstate"></a><span data-ttu-id="a3b96-234">SaveViewState</span><span class="sxs-lookup"><span data-stu-id="a3b96-234">SaveViewState</span></span>

<span data-ttu-id="a3b96-235">Esplora risorse chiama il metodo [**IShellView:: SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate) per richiedere all'oggetto visualizzazione cartella di salvare lo stato di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="a3b96-235">Windows Explorer calls the [**IShellView::SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate) method to prompt your folder view object to save its view state.</span></span> <span data-ttu-id="a3b96-236">Sarà quindi possibile recuperare lo stato la volta successiva che la cartella viene visualizzata.</span><span class="sxs-lookup"><span data-stu-id="a3b96-236">You can then recover the state the next time the folder is viewed.</span></span> <span data-ttu-id="a3b96-237">Il modo migliore per salvare uno stato di visualizzazione consiste nel chiamare il metodo [**IShellBrowser:: GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-237">The preferred way to save a view state is by calling the [**IShellBrowser::GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream) method.</span></span> <span data-ttu-id="a3b96-238">Questo metodo restituisce un'interfaccia [IStream](/windows/win32/api/objidl/nn-objidl-istream) che può essere utilizzata dall'oggetto visualizzazione cartella per salvarne lo stato.</span><span class="sxs-lookup"><span data-stu-id="a3b96-238">This method returns an [IStream](/windows/win32/api/objidl/nn-objidl-istream) interface that your folder view object can use to save its state.</span></span> <span data-ttu-id="a3b96-239">Quando si crea un'altra visualizzazione di cartelle, è possibile chiamare lo stesso metodo **IShellBrowser:: GetViewStateStream** per ottenere un puntatore IStream che consente di leggere le impostazioni salvate dalle visualizzazioni di cartelle precedenti.</span><span class="sxs-lookup"><span data-stu-id="a3b96-239">When you create another folder view, you can call the same **IShellBrowser::GetViewStateStream** method to obtain an IStream pointer that allows you to read the settings saved by previous folder views.</span></span>

### <a name="translateacelerator"></a><span data-ttu-id="a3b96-240">TranslateAcelerator</span><span class="sxs-lookup"><span data-stu-id="a3b96-240">TranslateAcelerator</span></span>

<span data-ttu-id="a3b96-241">Quando l'utente preme un tasto di scelta rapida, Esplora risorse passa il messaggio all'oggetto visualizzazione cartella chiamando [**IShellView:: TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator).</span><span class="sxs-lookup"><span data-stu-id="a3b96-241">When the user presses a shortcut key, Windows Explorer passes the message to the folder view object by calling [**IShellView::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator).</span></span> <span data-ttu-id="a3b96-242">Restituisce \_ false per fare in modo che Esplora risorse elabori il messaggio.</span><span class="sxs-lookup"><span data-stu-id="a3b96-242">Return S\_FALSE to have Windows Explorer process the message.</span></span> <span data-ttu-id="a3b96-243">Se il messaggio è stato elaborato dall'oggetto visualizzazione cartella, restituire S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="a3b96-243">If your folder view object has processed the message, return S\_OK.</span></span>

<span data-ttu-id="a3b96-244">Quando la finestra visualizzazione cartelle ha lo stato attivo, Esplora risorse chiama [**IShellView:: TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator) prima di elaborare il messaggio.</span><span class="sxs-lookup"><span data-stu-id="a3b96-244">When the folder view window has focus, Windows Explorer calls [**IShellView::TranslateAccelerator**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-translateaccelerator) before it processes the message.</span></span> <span data-ttu-id="a3b96-245">Poiché la maggior parte dei messaggi è in genere associata alla barra dei menu o ai comandi della barra degli strumenti di Esplora risorse, l'oggetto visualizzazione cartella deve normalmente restituire S \_ false.</span><span class="sxs-lookup"><span data-stu-id="a3b96-245">Because most of the messages are typically associated with Windows Explorer menu bar or toolbar commands, your folder view object should normally return S\_FALSE.</span></span> <span data-ttu-id="a3b96-246">Esplora risorse può quindi elaborare il messaggio normalmente.</span><span class="sxs-lookup"><span data-stu-id="a3b96-246">Windows Explorer can then process the message normally.</span></span> <span data-ttu-id="a3b96-247">Restituire S \_ OK solo se il messaggio è specifico della cartella e non si desidera che Esplora risorse esegua ulteriori elaborazioni.</span><span class="sxs-lookup"><span data-stu-id="a3b96-247">Return S\_OK only if the message is folder-specific and you do not want Windows Explorer to do any further processing.</span></span> <span data-ttu-id="a3b96-248">Se la visualizzazione cartelle non ha lo stato attivo, Esplora risorse elabora innanzitutto il messaggio.</span><span class="sxs-lookup"><span data-stu-id="a3b96-248">If the folder view does not have focus, Windows Explorer processes the message first.</span></span> <span data-ttu-id="a3b96-249">Chiama [**IShellBrowser:: TranslateAcceleratorSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-translateacceleratorsb) solo se non gestisce il messaggio.</span><span class="sxs-lookup"><span data-stu-id="a3b96-249">It calls [**IShellBrowser::TranslateAcceleratorSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-translateacceleratorsb) only if it does not handle the message.</span></span>

## <a name="using-ishellbrowser-to-communicate-with-windows-explorer"></a><span data-ttu-id="a3b96-250">Uso di IShellBrowser per comunicare con Esplora risorse</span><span class="sxs-lookup"><span data-stu-id="a3b96-250">Using IShellBrowser to Communicate with Windows Explorer</span></span>

<span data-ttu-id="a3b96-251">L'interfaccia [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) viene utilizzata dall'oggetto visualizzazione cartelle per comunicare con Esplora risorse per diversi scopi, tra cui:</span><span class="sxs-lookup"><span data-stu-id="a3b96-251">The [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser) interface is used by the folder view object to communicate with Windows Explorer for a variety of purposes, including:</span></span>

-   [<span data-ttu-id="a3b96-252">Modifica della barra dei menu di Esplora risorse</span><span class="sxs-lookup"><span data-stu-id="a3b96-252">Modifying the Windows Explorer Menu Bar</span></span>](#modifying-the-windows-explorer-menu-bar)
-   [<span data-ttu-id="a3b96-253">Modifica della barra degli strumenti di Esplora risorse</span><span class="sxs-lookup"><span data-stu-id="a3b96-253">Modifying the Windows Explorer Toolbar</span></span>](#modifying-the-windows-explorer-toolbar)
-   [<span data-ttu-id="a3b96-254">Modifica della barra di stato di Esplora risorse</span><span class="sxs-lookup"><span data-stu-id="a3b96-254">Modifying the Windows Explorer Status Bar</span></span>](#modifying-the-windows-explorer-status-bar)
-   [<span data-ttu-id="a3b96-255">Archiviazione di informazioni specifiche della visualizzazione</span><span class="sxs-lookup"><span data-stu-id="a3b96-255">Storing View-specific Information</span></span>](#storing-view-specific-information)

### <a name="modifying-the-windows-explorer-menu-bar"></a><span data-ttu-id="a3b96-256">Modifica della barra dei menu di Esplora risorse</span><span class="sxs-lookup"><span data-stu-id="a3b96-256">Modifying the Windows Explorer Menu Bar</span></span>

<span data-ttu-id="a3b96-257">La barra dei menu di Esplora risorse consente all'utente di avviare un'ampia gamma di comandi.</span><span class="sxs-lookup"><span data-stu-id="a3b96-257">The Windows Explorer menu bar allows the user to launch a variety of commands.</span></span> <span data-ttu-id="a3b96-258">Per impostazione predefinita, la barra dei menu supporta solo i comandi specifici di Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-258">By default, the menu bar only supports commands that are specific to Windows Explorer.</span></span> <span data-ttu-id="a3b96-259">I messaggi [di \_ comando WM](../menurc/wm-command.md) correlati vengono elaborati da Esplora risorse e non vengono passati all'oggetto visualizzazione cartella.</span><span class="sxs-lookup"><span data-stu-id="a3b96-259">The related [WM\_COMMAND](../menurc/wm-command.md) messages are processed by Windows Explorer and are not passed to your folder view object.</span></span> <span data-ttu-id="a3b96-260">Tuttavia, è possibile modificare la barra dei menu in modo da includere una o più voci di menu specifiche della cartella con [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser).</span><span class="sxs-lookup"><span data-stu-id="a3b96-260">However, you can modify the menu bar to include one or more folder-specific menu items with [**IShellBrowser**](/windows/desktop/api/shobjidl_core/nn-shobjidl_core-ishellbrowser).</span></span> <span data-ttu-id="a3b96-261">Esplora risorse passa i \_ messaggi di comando WM associati di tali elementi alla routine della finestra dell'oggetto cartella per l'elaborazione.</span><span class="sxs-lookup"><span data-stu-id="a3b96-261">Windows Explorer passes the associated WM\_COMMAND messages of those items to your folder object's window procedure for processing.</span></span> <span data-ttu-id="a3b96-262">È anche possibile rimuovere o disabilitare i comandi standard che non si applicano all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="a3b96-262">You can also remove or disable any standard commands that do not apply to your application.</span></span>

<span data-ttu-id="a3b96-263">In genere, gli oggetti di visualizzazione cartelle modificano la barra dei menu prima che la visualizzazione della cartella venga visualizzata.</span><span class="sxs-lookup"><span data-stu-id="a3b96-263">Folder view objects typically modify the menu bar before the folder view is first displayed.</span></span> <span data-ttu-id="a3b96-264">Devono restituire la barra dei menu allo stato originale quando la visualizzazione cartelle viene distrutta.</span><span class="sxs-lookup"><span data-stu-id="a3b96-264">They must return the menu bar to its original state when the folder view is destroyed.</span></span> <span data-ttu-id="a3b96-265">Potrebbe anche essere necessario modificare la barra dei menu ogni volta che la visualizzazione cartella acquisisce o perde lo stato attivo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-265">You might also need to modify the menu bar each time your folder view gains or loses focus.</span></span>

<span data-ttu-id="a3b96-266">Poiché Esplora risorse chiama [**IShellView:: UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) ogni volta che lo stato della finestra visualizzazione cartella viene modificato, la modifica della barra dei menu viene in genere inclusa nell'implementazione del metodo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-266">Because Windows Explorer calls [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) each time the folder view window's state changes, menu bar modification is normally included in that method's implementation.</span></span> <span data-ttu-id="a3b96-267">La procedura di base per modificare la barra dei menu di Esplora risorse è la seguente:</span><span class="sxs-lookup"><span data-stu-id="a3b96-267">The basic procedure for modifying the Windows Explorer menu bar is:</span></span>

1.  <span data-ttu-id="a3b96-268">Chiamare [CreateMenu](/windows/win32/api/winuser/nf-winuser-createmenu) per creare un handle di menu.</span><span class="sxs-lookup"><span data-stu-id="a3b96-268">Call [CreateMenu](/windows/win32/api/winuser/nf-winuser-createmenu) to create a menu handle.</span></span>
2.  <span data-ttu-id="a3b96-269">Passare l'handle del menu a Esplora risorse chiamando [**IShellBrowser:: InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb).</span><span class="sxs-lookup"><span data-stu-id="a3b96-269">Pass that menu handle to Windows Explorer by calling [**IShellBrowser::InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb).</span></span> <span data-ttu-id="a3b96-270">Esplora risorse compilerà le informazioni di menu.</span><span class="sxs-lookup"><span data-stu-id="a3b96-270">Windows Explorer will fill in its menu information.</span></span>
3.  <span data-ttu-id="a3b96-271">Modificare il menu in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="a3b96-271">Modify the menu as needed.</span></span>
4.  <span data-ttu-id="a3b96-272">Chiamare [**IShellBrowser:: SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) per fare in modo che Esplora risorse visualizzi la barra dei menu modificata.</span><span class="sxs-lookup"><span data-stu-id="a3b96-272">Call [**IShellBrowser::SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) to have Windows Explorer display the modified menu bar.</span></span>

<span data-ttu-id="a3b96-273">In Esplora risorse sono presenti sei menu popup sulla barra dei menu.</span><span class="sxs-lookup"><span data-stu-id="a3b96-273">Windows Explorer has six pop-up menus on its menu bar.</span></span> <span data-ttu-id="a3b96-274">Come per tutti i contenitori OLE, il menu Esplora risorse è diviso in sei gruppi: file, modifica, contenitore, oggetto, finestra e guida.</span><span class="sxs-lookup"><span data-stu-id="a3b96-274">As with all OLE containers, the Windows Explorer menu is divided into six groups: File, Edit, Container, Object, Window, and Help.</span></span> <span data-ttu-id="a3b96-275">Nella tabella seguente sono elencati i menu a comparsa di Esplora risorse e il gruppo associato, insieme agli ID menu.</span><span class="sxs-lookup"><span data-stu-id="a3b96-275">The following table lists the Windows Explorer pop-up menus and their associated group, along with the menu IDs.</span></span>



| <span data-ttu-id="a3b96-276">Menu a comparsa</span><span class="sxs-lookup"><span data-stu-id="a3b96-276">Pop-up menu</span></span> | <span data-ttu-id="a3b96-277">ID</span><span class="sxs-lookup"><span data-stu-id="a3b96-277">ID</span></span>                     | <span data-ttu-id="a3b96-278">Group</span><span class="sxs-lookup"><span data-stu-id="a3b96-278">Group</span></span>     |
|-------------|------------------------|-----------|
| <span data-ttu-id="a3b96-279">File</span><span class="sxs-lookup"><span data-stu-id="a3b96-279">File</span></span>        | <span data-ttu-id="a3b96-280">\_file di menu FCIDM \_</span><span class="sxs-lookup"><span data-stu-id="a3b96-280">FCIDM\_MENU\_FILE</span></span>      | <span data-ttu-id="a3b96-281">File</span><span class="sxs-lookup"><span data-stu-id="a3b96-281">File</span></span>      |
| <span data-ttu-id="a3b96-282">Modifica</span><span class="sxs-lookup"><span data-stu-id="a3b96-282">Edit</span></span>        | <span data-ttu-id="a3b96-283">\_modifica menu \_ FCIDM</span><span class="sxs-lookup"><span data-stu-id="a3b96-283">FCIDM\_MENU\_EDIT</span></span>      | <span data-ttu-id="a3b96-284">File</span><span class="sxs-lookup"><span data-stu-id="a3b96-284">File</span></span>      |
| <span data-ttu-id="a3b96-285">Visualizzazione</span><span class="sxs-lookup"><span data-stu-id="a3b96-285">View</span></span>        | <span data-ttu-id="a3b96-286">\_visualizzazione del menu FCIDM \_</span><span class="sxs-lookup"><span data-stu-id="a3b96-286">FCIDM\_MENU\_VIEW</span></span>      | <span data-ttu-id="a3b96-287">Contenitore</span><span class="sxs-lookup"><span data-stu-id="a3b96-287">Container</span></span> |
| <span data-ttu-id="a3b96-288">Preferiti</span><span class="sxs-lookup"><span data-stu-id="a3b96-288">Favorites</span></span>   | <span data-ttu-id="a3b96-289">FCIDM \_ menu \_ Preferiti</span><span class="sxs-lookup"><span data-stu-id="a3b96-289">FCIDM\_MENU\_FAVORITES</span></span> | <span data-ttu-id="a3b96-290">Contenitore</span><span class="sxs-lookup"><span data-stu-id="a3b96-290">Container</span></span> |
| <span data-ttu-id="a3b96-291">Strumenti</span><span class="sxs-lookup"><span data-stu-id="a3b96-291">Tools</span></span>       | <span data-ttu-id="a3b96-292">\_strumenti di menu FCIDM \_</span><span class="sxs-lookup"><span data-stu-id="a3b96-292">FCIDM\_MENU\_TOOLS</span></span>     | <span data-ttu-id="a3b96-293">Contenitore</span><span class="sxs-lookup"><span data-stu-id="a3b96-293">Container</span></span> |
| <span data-ttu-id="a3b96-294">Help</span><span class="sxs-lookup"><span data-stu-id="a3b96-294">Help</span></span>        | <span data-ttu-id="a3b96-295">\_Guida del menu FCIDM \_</span><span class="sxs-lookup"><span data-stu-id="a3b96-295">FCIDM\_MENU\_HELP</span></span>      | <span data-ttu-id="a3b96-296">Finestra</span><span class="sxs-lookup"><span data-stu-id="a3b96-296">Window</span></span>    |



 

<span data-ttu-id="a3b96-297">Quando si passa l'handle di menu a Esplora risorse chiamando [**IShellBrowser:: InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb), è necessario passare anche un puntatore a una struttura [OLEMENUGROUPWIDTHS](/windows/win32/api/oleidl/ns-oleidl-olemenugroupwidths) i cui membri sono stati inizializzati su zero.</span><span class="sxs-lookup"><span data-stu-id="a3b96-297">When you pass the menu handle to Windows Explorer by calling [**IShellBrowser::InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb), you must also pass a pointer to an [OLEMENUGROUPWIDTHS](/windows/win32/api/oleidl/ns-oleidl-olemenugroupwidths) structure whose members have been initialized to zero.</span></span>

<span data-ttu-id="a3b96-298">Quando [**IShellBrowser:: InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb) restituisce, Esplora risorse avrà aggiunto le voci di menu.</span><span class="sxs-lookup"><span data-stu-id="a3b96-298">When [**IShellBrowser::InsertMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-insertmenussb) returns, Windows Explorer will have added its menu items.</span></span> <span data-ttu-id="a3b96-299">È quindi possibile usare l'handle di menu restituito con le funzioni di menu standard di Windows, ad esempio [InsertMenuItem](/windows/win32/api/winuser/nf-winuser-insertmenuitema) , per:</span><span class="sxs-lookup"><span data-stu-id="a3b96-299">You can then use the returned menu handle with standard Windows menu functions such as [InsertMenuItem](/windows/win32/api/winuser/nf-winuser-insertmenuitema) to:</span></span>

-   <span data-ttu-id="a3b96-300">Consente di aggiungere elementi ai menu a comparsa di Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-300">Add items to the Windows Explorer pop-up menus.</span></span>
-   <span data-ttu-id="a3b96-301">Modificare o eliminare gli elementi esistenti nei menu a comparsa di Esplora risorse.</span><span class="sxs-lookup"><span data-stu-id="a3b96-301">Modify or delete existing items in the Windows Explorer pop-up menus.</span></span>
-   <span data-ttu-id="a3b96-302">Aggiungere nuovi menu popup.</span><span class="sxs-lookup"><span data-stu-id="a3b96-302">Add new pop-up menus.</span></span>

<span data-ttu-id="a3b96-303">Usare gli ID elencati nella tabella per identificare i vari menu a comparsa di Esplora risorse di Windows.</span><span class="sxs-lookup"><span data-stu-id="a3b96-303">Use the IDs listed in the table to identify the various Windows Explorer pop-up menus.</span></span>

> [!Note]  
> <span data-ttu-id="a3b96-304">Per evitare conflitti con gli ID dei comandi di Esplora risorse, gli ID di tutte le voci di menu aggiunte devono essere compresi tra FCIDM \_ SHVIEWFIRST e FCIDM \_ SHVIEWLAST.</span><span class="sxs-lookup"><span data-stu-id="a3b96-304">To avoid conflicts with Windows Explorer command IDs, the IDs of any menu items that you add must fall between FCIDM\_SHVIEWFIRST and FCIDM\_SHVIEWLAST.</span></span> <span data-ttu-id="a3b96-305">Questi due valori sono definiti in Shlobj. h.</span><span class="sxs-lookup"><span data-stu-id="a3b96-305">These two values are defined in Shlobj.h.</span></span>

 

<span data-ttu-id="a3b96-306">Una volta completata la modifica del menu, chiamare [**IShellBrowser:: SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) in modo che Esplora risorse visualizzi la nuova barra dei menu.</span><span class="sxs-lookup"><span data-stu-id="a3b96-306">Once you have finished modifying the menu, call [**IShellBrowser::SetMenuSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setmenusb) to have Windows Explorer display the new menu bar.</span></span>

<span data-ttu-id="a3b96-307">Dopo la visualizzazione iniziale della visualizzazione cartelle, Esplora risorse chiama [**IShellView:: UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) ogni volta che la visualizzazione cartella acquisisce o perde lo stato attivo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-307">After the folder view is initially displayed, Windows Explorer calls [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) each time the folder view gains or loses focus.</span></span> <span data-ttu-id="a3b96-308">Se sono presenti voci di menu sensibili allo stato della visualizzazione cartelle, è necessario modificare il menu di conseguenza, ogni volta che lo stato cambia.</span><span class="sxs-lookup"><span data-stu-id="a3b96-308">If you have any menu items that are sensitive to the state of the folder view, you should modify the menu accordingly, each time the state changes.</span></span> <span data-ttu-id="a3b96-309">Ad esempio, è possibile disporre di una voce di menu che agisce su un elemento nella visualizzazione cartelle selezionata dall'utente.</span><span class="sxs-lookup"><span data-stu-id="a3b96-309">For instance, you might have a menu item that acts on an item in the folder view that has been selected by the user.</span></span> <span data-ttu-id="a3b96-310">È necessario disabilitare o rimuovere questa voce di menu quando la visualizzazione cartelle perde lo stato attivo.</span><span class="sxs-lookup"><span data-stu-id="a3b96-310">You should disable or remove this menu item when the folder view loses focus.</span></span>

<span data-ttu-id="a3b96-311">Quando Esplora risorse chiama [**IShellView:: UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) per indicare che la visualizzazione cartelle viene disattivata, ripristinare lo stato originale della barra dei menu chiamando [**IShellBrowser:: RemoveMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-removemenussb).</span><span class="sxs-lookup"><span data-stu-id="a3b96-311">When Windows Explorer calls [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) to indicate that the folder view is being deactivated, restore the menu bar to its original state by calling [**IShellBrowser::RemoveMenusSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-removemenussb).</span></span>

### <a name="modifying-the-windows-explorer-toolbar"></a><span data-ttu-id="a3b96-312">Modifica della barra degli strumenti di Esplora risorse</span><span class="sxs-lookup"><span data-stu-id="a3b96-312">Modifying the Windows Explorer Toolbar</span></span>

<span data-ttu-id="a3b96-313">Oltre a modificare la barra dei menu di Esplora risorse, è anche possibile aggiungere pulsanti alla barra degli strumenti.</span><span class="sxs-lookup"><span data-stu-id="a3b96-313">In addition to modifying the Windows Explorer menu bar, you can also add buttons to the toolbar.</span></span> <span data-ttu-id="a3b96-314">Come per la barra dei menu, la modifica della barra degli strumenti è in genere inclusa nell'implementazione di [**IShellView:: UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-314">As with the menu bar, toolbar modification is usually part of the [**IShellView::UIActivate**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-uiactivate) implementation.</span></span> <span data-ttu-id="a3b96-315">La procedura per aggiungere pulsanti alla barra degli strumenti di Esplora risorse è la seguente:</span><span class="sxs-lookup"><span data-stu-id="a3b96-315">The procedure for adding buttons to the Windows Explorer toolbar is:</span></span>

1.  <span data-ttu-id="a3b96-316">Aggiungere la bitmap del pulsante all'elenco immagini della barra degli strumenti.</span><span class="sxs-lookup"><span data-stu-id="a3b96-316">Add the button's bitmap to the toolbar's image list.</span></span>
2.  <span data-ttu-id="a3b96-317">Definire la stringa di testo del pulsante.</span><span class="sxs-lookup"><span data-stu-id="a3b96-317">Define the button's text string.</span></span>
3.  <span data-ttu-id="a3b96-318">Aggiungere il pulsante alla barra degli strumenti.</span><span class="sxs-lookup"><span data-stu-id="a3b96-318">Add the button to the toolbar.</span></span>

<span data-ttu-id="a3b96-319">Per aggiungere una bitmap all'elenco di immagini di una barra degli strumenti, inviare la barra degli strumenti un messaggio [TB \_ ADDBITMAP](../controls/tb-addbitmap.md) chiamando [**IShellBrowser:: SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span><span class="sxs-lookup"><span data-stu-id="a3b96-319">To add a bitmap to a toolbar's image list, send the toolbar a [TB\_ADDBITMAP](../controls/tb-addbitmap.md) message by calling [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span></span> <span data-ttu-id="a3b96-320">Per specificare il controllo Toolbar, impostare il parametro *ID* del metodo sulla **\_ barra degli strumenti FCW**.</span><span class="sxs-lookup"><span data-stu-id="a3b96-320">To specify the toolbar control, set the method's *id* parameter to **FCW\_TOOLBAR**.</span></span> <span data-ttu-id="a3b96-321">Impostare *wParam* sul numero di immagini dei pulsanti nella bitmap e *lParam* sull'indirizzo di una struttura [TBADDBITMAP](/windows/win32/api/commctrl/ns-commctrl-tbaddbitmap) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-321">Set *wParam* to the number of button images in the bitmap, and *lParam* to the address of a [TBADDBITMAP](/windows/win32/api/commctrl/ns-commctrl-tbaddbitmap) structure.</span></span> <span data-ttu-id="a3b96-322">L'indice dell'immagine viene restituito nel parametro *Pret* .</span><span class="sxs-lookup"><span data-stu-id="a3b96-322">The image index is returned in the *pret* parameter.</span></span>

<span data-ttu-id="a3b96-323">Esistono due modi per definire una stringa per il pulsante:</span><span class="sxs-lookup"><span data-stu-id="a3b96-323">There are two ways to define a string for the button:</span></span>

-   <span data-ttu-id="a3b96-324">Assegnare la stringa **al membro della** struttura [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) del pulsante.</span><span class="sxs-lookup"><span data-stu-id="a3b96-324">Assign the string to the **iString** member of the button's [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) structure.</span></span>
-   <span data-ttu-id="a3b96-325">Chiamare [**IShellBrowser:: SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) per inviare il controllo Toolbar a un messaggio [TB \_ ADDSTRING](../controls/tb-addstring.md) .</span><span class="sxs-lookup"><span data-stu-id="a3b96-325">Call [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) to send the toolbar control a [TB\_ADDSTRING](../controls/tb-addstring.md) message.</span></span> <span data-ttu-id="a3b96-326">Il parametro *wParam* deve essere impostato su zero e il parametro *lParam* sulla stringa.</span><span class="sxs-lookup"><span data-stu-id="a3b96-326">The *wParam* parameter should be set to zero and the *lParam* parameter to the string.</span></span> <span data-ttu-id="a3b96-327">L'indice della stringa viene restituito nel parametro *Pret* .</span><span class="sxs-lookup"><span data-stu-id="a3b96-327">The string index is returned in the *pret* parameter.</span></span>

<span data-ttu-id="a3b96-328">Per aggiungere il pulsante alla barra degli strumenti, compilare una struttura [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) e passarla a [**IShellBrowser:: SetToolbarItems**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-settoolbaritems).</span><span class="sxs-lookup"><span data-stu-id="a3b96-328">To add the button to the toolbar, fill in a [TBBUTTON](/windows/win32/api/commctrl/ns-commctrl-tbbutton) structure and pass it to [**IShellBrowser::SetToolbarItems**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-settoolbaritems).</span></span> <span data-ttu-id="a3b96-329">Come nel menu, l'ID del comando deve essere compreso tra FCIDM \_ SHVIEWFIRST e FCIDM \_ SHVIEWLAST.</span><span class="sxs-lookup"><span data-stu-id="a3b96-329">As with the menu, your command ID must fall between FCIDM\_SHVIEWFIRST and FCIDM\_SHVIEWLAST.</span></span> <span data-ttu-id="a3b96-330">La barra degli strumenti aggiungerà quindi il pulsante a destra dei pulsanti esistenti.</span><span class="sxs-lookup"><span data-stu-id="a3b96-330">The toolbar will then append the button to the right of the existing buttons.</span></span>

<span data-ttu-id="a3b96-331">Il frammento di codice seguente, ad esempio, aggiunge un pulsante standard alla barra degli strumenti di Esplora risorse con l'ID del comando IDB \_ .</span><span class="sxs-lookup"><span data-stu-id="a3b96-331">For instance, the following code fragment adds one standard button to the Windows Explorer toolbar with a command ID of IDB\_MYBUTTON.</span></span>


```
TBADDBITMAP tbadbm;
int iButtonIndex;
TBBUTTON tbb;

tbadbm.hInst = g_hInstance;    // The module's instance handle
tbadbm.nID = IDB_BUTTONIMAGE;  // The bitmap's resource ID

psb->SendControlMsg(FCW_TOOLBAR, TB_ADDBITMAP, 1,
                    reinterpret_cast<LPARAM>(&tbadbm), &iButtonIndex);

psb->SendControlMsg(FCW_TOOLBAR, TB_ADDSTRING, NULL,
                    reinterpret_cast<LPARAM>(szLabel), &iStringIndex);

ZeroMemory(&tbb, sizeof(TBBUTTON));
tbb.iBitmap = iButtonIndex;
tbb.iCommand = IDB_MYBUTTON;
tbb.iString = iStringIndex;
tbb.fsState = TBSTATE_ENABLED;
tbb.fsStyle = TBSTYLE_BUTTON;

psb->SetToolbarItems(&tbb, 1, FCT_MERGE);
```



<span data-ttu-id="a3b96-332">Per ulteriori informazioni su come gestire i controlli della barra degli strumenti, vedere [controlli della barra](../controls/toolbar-control-reference.md)degli strumenti.</span><span class="sxs-lookup"><span data-stu-id="a3b96-332">For further discussion of how to handle toolbar controls, see [Toolbar Controls](../controls/toolbar-control-reference.md).</span></span>

### <a name="modifying-the-windows-explorer-status-bar"></a><span data-ttu-id="a3b96-333">Modifica della barra di stato di Esplora risorse</span><span class="sxs-lookup"><span data-stu-id="a3b96-333">Modifying the Windows Explorer Status Bar</span></span>

<span data-ttu-id="a3b96-334">È possibile utilizzare la barra di stato di Esplora risorse per visualizzare una serie di informazioni utili.</span><span class="sxs-lookup"><span data-stu-id="a3b96-334">You can use the Windows Explorer status bar to display a variety of useful information.</span></span> <span data-ttu-id="a3b96-335">Esistono due modi per usare la barra di stato:</span><span class="sxs-lookup"><span data-stu-id="a3b96-335">There are two ways to use the status bar:</span></span>

-   <span data-ttu-id="a3b96-336">Usare [**IShellBrowser:: SetStatusTextSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setstatustextsb) per visualizzare una stringa di testo sulla barra di stato.</span><span class="sxs-lookup"><span data-stu-id="a3b96-336">Use [**IShellBrowser::SetStatusTextSB**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-setstatustextsb) to display a text string on the status bar.</span></span>
-   <span data-ttu-id="a3b96-337">Inviare i messaggi direttamente al controllo barra di stato con [**IShellBrowser:: SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span><span class="sxs-lookup"><span data-stu-id="a3b96-337">Send messages directly to the status bar control with [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg).</span></span>

<span data-ttu-id="a3b96-338">Il primo metodo è semplice ma sufficiente per molti scopi.</span><span class="sxs-lookup"><span data-stu-id="a3b96-338">The first method is straightforward but sufficient for many purposes.</span></span> <span data-ttu-id="a3b96-339">Per maggiore flessibilità, è possibile inviare messaggi direttamente al controllo barra di stato chiamando [**IShellBrowser:: SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) con il parametro *ID* impostato **\_ sullo stato FCW**.</span><span class="sxs-lookup"><span data-stu-id="a3b96-339">For greater flexibility, you can send messages directly to the status bar control by calling [**IShellBrowser::SendControlMsg**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-sendcontrolmsg) with the *id* parameter set to **FCW\_STATUS**.</span></span> <span data-ttu-id="a3b96-340">Per ulteriori informazioni sui controlli barra di stato, vedere [barre di stato](../controls/status-bars.md).</span><span class="sxs-lookup"><span data-stu-id="a3b96-340">For further discussion of status bar controls, see [Status Bars](../controls/status-bars.md).</span></span>

### <a name="storing-view-specific-information"></a><span data-ttu-id="a3b96-341">Archiviazione di informazioni specifiche della visualizzazione</span><span class="sxs-lookup"><span data-stu-id="a3b96-341">Storing View-specific Information</span></span>

<span data-ttu-id="a3b96-342">Quando una visualizzazione sta per essere distrutta, è spesso utile archiviare informazioni quali lo stato o le impostazioni della vista.</span><span class="sxs-lookup"><span data-stu-id="a3b96-342">When a view is about to be destroyed, it is often useful to store information such as the view's state or settings.</span></span> <span data-ttu-id="a3b96-343">Esplora risorse richiede di eseguire questa attività chiamando [**IShellView:: SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate).</span><span class="sxs-lookup"><span data-stu-id="a3b96-343">Windows Explorer prompts you to do this task by calling [**IShellView::SaveViewState**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellview-saveviewstate).</span></span> <span data-ttu-id="a3b96-344">Il modo migliore per salvare le informazioni specifiche della visualizzazione consiste nel chiamare [**IShellBrowser:: GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream).</span><span class="sxs-lookup"><span data-stu-id="a3b96-344">The preferred way to save view-specific information is to call [**IShellBrowser::GetViewStateStream**](/windows/desktop/api/shobjidl_core/nf-shobjidl_core-ishellbrowser-getviewstatestream).</span></span> <span data-ttu-id="a3b96-345">Questo metodo fornisce un'interfaccia [IStream](/windows/win32/api/objidl/nn-objidl-istream) che è possibile usare per archiviare le informazioni.</span><span class="sxs-lookup"><span data-stu-id="a3b96-345">This method provides you with an [IStream](/windows/win32/api/objidl/nn-objidl-istream) interface that you can use to store the information.</span></span> <span data-ttu-id="a3b96-346">È possibile utilizzare qualsiasi formato dati appropriato.</span><span class="sxs-lookup"><span data-stu-id="a3b96-346">You are free to use any suitable data format.</span></span>

 

 
