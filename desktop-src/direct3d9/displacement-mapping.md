---
description: Le mappe di spostamento sono simili alle mappe di trama, ma sono accessibili dal motore di vertici.
ms.assetid: d6f16ff2-5a66-48a3-82c4-523faaafa6ae
title: Mapping di spostamento (Direct3D 9)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b687583b0109223d8c2dac807425e235ddf280e4
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/06/2021
ms.locfileid: "104482077"
---
# <a name="displacement-mapping-direct3d-9"></a><span data-ttu-id="63cfa-103">Mapping di spostamento (Direct3D 9)</span><span class="sxs-lookup"><span data-stu-id="63cfa-103">Displacement Mapping (Direct3D 9)</span></span>

<span data-ttu-id="63cfa-104">Le mappe di spostamento sono simili alle mappe di trama, ma sono accessibili dal motore di vertici.</span><span class="sxs-lookup"><span data-stu-id="63cfa-104">Displacement maps are similar to texture maps but are accessed by the vertex engine.</span></span>

## <a name="block-diagram"></a><span data-ttu-id="63cfa-105">Diagramma a blocchi</span><span class="sxs-lookup"><span data-stu-id="63cfa-105">Block Diagram</span></span>

<span data-ttu-id="63cfa-106">Una fase del campionatore aggiuntiva è presente nella parte iniziale della pipe dei vertici, come illustrato nel diagramma seguente, in cui è possibile campionare una mappa di spostamento per fornire i dati di spostamento del vertice.</span><span class="sxs-lookup"><span data-stu-id="63cfa-106">An additional sampler stage is present in the early part of the vertex pipe, as shown in the following diagram, which can sample a displacement map to provide vertex displacement data.</span></span>

![diagramma della fase del campionatore nella pipe del vertice](images/tessellatordx9.png)

<span data-ttu-id="63cfa-108">Lo stato del campionatore della mappa di spostamento può essere impostato da [**SetSamplerState**](/windows/desktop/api) usando la fase numero 256, che è un nuovo numero di fase.</span><span class="sxs-lookup"><span data-stu-id="63cfa-108">The displacement map sampler state can be set by the [**SetSamplerState**](/windows/desktop/api) using stage number 256, which is a new stage number.</span></span> <span data-ttu-id="63cfa-109">La trama della mappa di spostamento viene impostata da [**texture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture).</span><span class="sxs-lookup"><span data-stu-id="63cfa-109">The displacement map texture is set by [**SetTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-settexture).</span></span>

<span data-ttu-id="63cfa-110">La mappa può essere precampionata o meno, il che significa che può essere ordinata in modo da consentire la ricerca dei valori di spostamento senza filtrare.</span><span class="sxs-lookup"><span data-stu-id="63cfa-110">The map can be presampled or not, which means that it can be ordered in a way that enables the lookup of the displacement values without filtering.</span></span>

-   <span data-ttu-id="63cfa-111">Le mappe di spostamento sono analoghe alle mappe di trama, ma sono accessibili dal motore di vertici.</span><span class="sxs-lookup"><span data-stu-id="63cfa-111">Displacement maps are analogous to texture maps but are accessed by the vertex engine.</span></span>
-   <span data-ttu-id="63cfa-112">Una fase del campionatore aggiuntiva è presente nella parte iniziale della pipe dei vertici che può campionare una mappa di spostamento.</span><span class="sxs-lookup"><span data-stu-id="63cfa-112">An additional sampler stage is present in the early part of the vertex pipe that can sample a displacement map.</span></span> <span data-ttu-id="63cfa-113">Questa fase è accessibile dalla consueta API SetSamplerState, ma il numero di fase è D3DDMAPSAMPLER = 256.</span><span class="sxs-lookup"><span data-stu-id="63cfa-113">This stage is accessed by the usual SetSamplerState API but the stage number is D3DDMAPSAMPLER = 256.</span></span>
-   <span data-ttu-id="63cfa-114">Lo stato del campionatore della mappa di spostamento può essere impostato da SetSamplerState (D3DDMAPSAMPLER,...) API.</span><span class="sxs-lookup"><span data-stu-id="63cfa-114">The displacement map sampler state can be set by the SetSamplerState(D3DDMAPSAMPLER, ...) API.</span></span>
-   <span data-ttu-id="63cfa-115">La trama della mappa di spostamento viene impostata dall'API setrame (D3DDMAPSAMPLER, texture).</span><span class="sxs-lookup"><span data-stu-id="63cfa-115">The displacement map texture is set by the SetTexture(D3DDMAPSAMPLER, texture) API.</span></span>
-   <span data-ttu-id="63cfa-116">La mappa può essere pre-campionata o meno.</span><span class="sxs-lookup"><span data-stu-id="63cfa-116">The map can be pre-sampled or not.</span></span> <span data-ttu-id="63cfa-117">Ciò significa che può essere ordinato in un modo specifico che consente la ricerca dei valori di spostamento senza filtro.</span><span class="sxs-lookup"><span data-stu-id="63cfa-117">This means that it can be ordered in a particular way that enables the lookup of the displacement values without filtering.</span></span>
-   <span data-ttu-id="63cfa-118">Le modifiche nella struttura della dichiarazione consentono la specifica della coordinata di trama utilizzata per cercare la mappa della trama.</span><span class="sxs-lookup"><span data-stu-id="63cfa-118">The changes in the declaration structure allow the specification of the texture coordinate used to look up the texture map.</span></span> <span data-ttu-id="63cfa-119">Ad esempio, Stream0, offset, FLOAT2, LOOKUP, valore di spostamento \_ .</span><span class="sxs-lookup"><span data-stu-id="63cfa-119">For example, Stream0, Offset, FLOAT2, LOOKUP, Displacement\_value.</span></span> <span data-ttu-id="63cfa-120">Ciò indica a mosaico di usare il vettore float 2D in stream0 in un determinato offset come coordinata di trama per cercare la mappa di spostamento e associare la relativa \_ semantica di utilizzo al valore di spostamento.</span><span class="sxs-lookup"><span data-stu-id="63cfa-120">This tells the tessellator to use the 2D float vector in stream0 at a certain offset as a texture coordinate to look up the displacement map and associate the Displacement\_value usage semantic to it.</span></span> <span data-ttu-id="63cfa-121">La dichiarazione vertex shader contiene una riga simile a {DCL \_ Texture0, V0} che indica che la semantica Texture0 deve essere associata al registro di input V0.</span><span class="sxs-lookup"><span data-stu-id="63cfa-121">The vertex shader declaration would contain a line similar to {dcl\_texture0, v0} indicating that the texture0 semantic is to be associated with the v0 input register.</span></span> <span data-ttu-id="63cfa-122">Il valore di spostamento cercato viene copiato nel registro di input V0.</span><span class="sxs-lookup"><span data-stu-id="63cfa-122">The displacement value looked up is copied into input register v0.</span></span>
-   <span data-ttu-id="63cfa-123">È disponibile un tipo speciale di mapping di spostamento, quando la mappa di trama è pre-campionata.</span><span class="sxs-lookup"><span data-stu-id="63cfa-123">There is a special type of displacement mapping, when the texture map is pre-sampled.</span></span> <span data-ttu-id="63cfa-124">L'indice sequenziale dei vertici generati viene usato come coordinata di trama a una mappa di trama.</span><span class="sxs-lookup"><span data-stu-id="63cfa-124">Sequential index of generated vertices is used as a texture coordinate to a texture map.</span></span> <span data-ttu-id="63cfa-125">Ad esempio, 0, 0, (D3DDECLTYPE) 0, D3DDECLMETHOD \_ LOOKUPPRESAMPLED, Usage, UsageIndex.</span><span class="sxs-lookup"><span data-stu-id="63cfa-125">For example, 0,0,(D3DDECLTYPE)0,D3DDECLMETHOD\_LOOKUPPRESAMPLED, Usage, UsageIndex.</span></span>
-   <span data-ttu-id="63cfa-126">L'output della ricerca è 4 float.</span><span class="sxs-lookup"><span data-stu-id="63cfa-126">The output of the lookup is 4 floats.</span></span>
-   <span data-ttu-id="63cfa-127">Il mapping di spostamento è supportato solo con N-patch.</span><span class="sxs-lookup"><span data-stu-id="63cfa-127">Displacement mapping is supported only with N-patches.</span></span>
-   <span data-ttu-id="63cfa-128">I driver devono ignorare D3DDMAPSAMPLER in SetTextureStageState se non gestiscono le mappe di spostamento.</span><span class="sxs-lookup"><span data-stu-id="63cfa-128">Drivers need to ignore D3DDMAPSAMPLER in SetTextureStageState if they do not handle displacement maps.</span></span>
-   <span data-ttu-id="63cfa-129">\_La modalità filtro D3DTEXF anisotropico non è supportata.</span><span class="sxs-lookup"><span data-stu-id="63cfa-129">D3DTEXF\_ANISOTROPIC filter mode is not supported.</span></span>
-   <span data-ttu-id="63cfa-130">Quando D3DSAMP \_ MIPFILTER nel campionatore della mappa di spostamento non è D3DTEXF \_ nessuno, il livello di dettaglio viene calcolato come segue (si noti che lo stato del mosaico adattivo viene usato anche se D3DRS \_ ENABLEADAPTIVETESSELLATION è **false**): tmax = render state D3DRS \_ MAXTESSELLATIONLEVEL</span><span class="sxs-lookup"><span data-stu-id="63cfa-130">When D3DSAMP\_MIPFILTER in the displacement map sampler is not D3DTEXF\_NONE, the level of detail is computed as follows (Note that the adaptive tessellation state is used even if the D3DRS\_ENABLEADAPTIVETESSELLATION is **FALSE**): Tmax = render state D3DRS\_MAXTESSELLATIONLEVEL</span></span>
-   <span data-ttu-id="63cfa-131">Livello mosaico di calcolo te per un vertice vi: (XI, Yi, Zi) come descritto nella sezione "mosaico adattivo".</span><span class="sxs-lookup"><span data-stu-id="63cfa-131">Compute tessellation level Te for a vertex Vi: (Xi, Yi, Zi) the same way as described in the "Adaptive tessellation" section.</span></span> <span data-ttu-id="63cfa-132">Livello di dettaglio L = log2 (tmax)-log2 (te).</span><span class="sxs-lookup"><span data-stu-id="63cfa-132">Level of detail L = log2(Tmax) - log2 (Te).</span></span>
-   <span data-ttu-id="63cfa-133">Le operazioni di filtro e campionamento della trama seguono le stesse regole della pipeline pixel (il livello di dettaglio (LOD) viene applicato e così via).</span><span class="sxs-lookup"><span data-stu-id="63cfa-133">Texture filtering and sampling operations follow the same rules as the pixel pipeline (level of detail (LOD) bias is applied, etc.).</span></span>
-   <span data-ttu-id="63cfa-134">Non tutti i formati possono essere usati come mappe di spostamento, ma solo quelli che supportano il \_ DMAP D3DUSAGE.</span><span class="sxs-lookup"><span data-stu-id="63cfa-134">Not all formats can be used as displacement maps but only those that support the D3DUSAGE\_DMAP.</span></span> <span data-ttu-id="63cfa-135">L'applicazione può eseguire una query con il [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat)CheckDeviceFormat.</span><span class="sxs-lookup"><span data-stu-id="63cfa-135">The application can query that with the CheckDeviceFormat [**CheckDeviceFormat**](/windows/win32/api/d3d9/nf-d3d9-idirect3d9-checkdeviceformat).</span></span>
-   <span data-ttu-id="63cfa-136">\_È necessario specificare D3DUSAGE DMAP in [**createTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) per notificare al driver che questa trama deve essere utilizzata come mappa di spostamento.</span><span class="sxs-lookup"><span data-stu-id="63cfa-136">D3DUSAGE\_DMAP must be specified in [**CreateTexture**](/windows/win32/api/d3d9helper/nf-d3d9helper-idirect3ddevice9-createtexture) to notify the driver that this texture is to be used as a displacement map.</span></span>
-   <span data-ttu-id="63cfa-137">D3DUSAGE \_ DMAP può essere usato solo con le trame.</span><span class="sxs-lookup"><span data-stu-id="63cfa-137">D3DUSAGE\_DMAP can only be used with textures.</span></span> <span data-ttu-id="63cfa-138">Non può essere utilizzato con mappe o volumi del cubo.</span><span class="sxs-lookup"><span data-stu-id="63cfa-138">It cannot be used with cube maps or volumes.</span></span>
-   <span data-ttu-id="63cfa-139">Le trame e le destinazioni di rendering create con D3DUSAGE \_ DMAP possono essere impostate in fasi normali del campionatore e come destinazioni di rendering.</span><span class="sxs-lookup"><span data-stu-id="63cfa-139">Textures and render targets created with D3DUSAGE\_DMAP can be set at regular sampler stages and as render targets.</span></span>
-   <span data-ttu-id="63cfa-140">Gli Stati di rendering per impostare la modalità di wrapping per le coordinate di trama vengono ignorati nel mapping di spostamento.</span><span class="sxs-lookup"><span data-stu-id="63cfa-140">The render states to set the wrap mode for the texture coordinates are ignored in displacement mapping.</span></span> <span data-ttu-id="63cfa-141">In generale, non sono disponibili modalità a capo per il motore mosaico.</span><span class="sxs-lookup"><span data-stu-id="63cfa-141">In general, there are no wrap modes for the tessellator engine.</span></span>
-   <span data-ttu-id="63cfa-142">Un Sampler della mappa di spostamento presenta un comportamento identico a quello dei campionatori di trama pixel.</span><span class="sxs-lookup"><span data-stu-id="63cfa-142">A displacement map sampler has behavior identical to that of the pixel texture samplers.</span></span> <span data-ttu-id="63cfa-143">Se viene cercata una trama con meno di quattro canali (ad esempio R32f), i valori di ricerca vengono indirizzati ai canali appropriati del registro di destinazione (il registro di input del vertex shader contrassegnato con la \_ semantica di esempio), mentre gli altri canali vengono predefiniti (1, 1, 1).</span><span class="sxs-lookup"><span data-stu-id="63cfa-143">If a texture with less than four channels (like R32f) is looked up, the looked-up values go to the appropriate channels of the destination register (the vertex shader input register tagged with the \_sample semantic), while the other channels default to (1, 1, 1).</span></span> <span data-ttu-id="63cfa-144">Una volta cercato, D3DFMT \_ L8 viene trasmesso nei canali R, G, B e un valore predefinito è 1.</span><span class="sxs-lookup"><span data-stu-id="63cfa-144">When looked up, D3DFMT\_L8 gets broadcast into the R, G, B channels and A defaults to 1.</span></span> <span data-ttu-id="63cfa-145">L'rasterizzazione dei riferimenti presenta i dettagli di implementazione completi.</span><span class="sxs-lookup"><span data-stu-id="63cfa-145">The reference rasterizer has the full implementation details.</span></span>

## <a name="pre-sampled-displacement-mapping"></a><span data-ttu-id="63cfa-146">Mapping di spostamento pre-campionato</span><span class="sxs-lookup"><span data-stu-id="63cfa-146">Pre-Sampled Displacement Mapping</span></span>

-   <span data-ttu-id="63cfa-147">Viene introdotto il nuovo stato del campionatore: D3DSAMP \_ DMAPOFFSET (DWORD)-offset (in vertici) in una mappa di spostamento pre-campionata.</span><span class="sxs-lookup"><span data-stu-id="63cfa-147">New sampler state is introduced: D3DSAMP\_DMAPOFFSET (DWORD) - offset (in vertices) in a pre-sampled displacement map.</span></span>
-   <span data-ttu-id="63cfa-148">È stato introdotto il nuovo metodo di dichiarazione: D3DDECLMETHOD \_ LOOKUPPRESAMPLED.</span><span class="sxs-lookup"><span data-stu-id="63cfa-148">New declaration method is introduced: D3DDECLMETHOD\_LOOKUPPRESAMPLED.</span></span>
-   <span data-ttu-id="63cfa-149">Il mosaico adattivo deve essere disabilitato.</span><span class="sxs-lookup"><span data-stu-id="63cfa-149">Adaptive tessellation should be disabled.</span></span>
-   <span data-ttu-id="63cfa-150">Le impostazioni del filtro di trama vengono ignorate.</span><span class="sxs-lookup"><span data-stu-id="63cfa-150">Texture filter settings are ignored.</span></span> <span data-ttu-id="63cfa-151">Il campionamento di punti è terminato.</span><span class="sxs-lookup"><span data-stu-id="63cfa-151">Point sampling is done.</span></span> <span data-ttu-id="63cfa-152">Si presuppone che il filtro di trama MIP sia D3DTEXF \_ None.</span><span class="sxs-lookup"><span data-stu-id="63cfa-152">The mip texture filter is assumed to be D3DTEXF\_NONE.</span></span> <span data-ttu-id="63cfa-153">Si presuppone che tutte le altre modalità di filtro di trama siano D3DTEXF \_ punto.</span><span class="sxs-lookup"><span data-stu-id="63cfa-153">All other texture filter modes are assumed to be D3DTEXF\_POINT.</span></span>
-   <span data-ttu-id="63cfa-154">Le coordinate di trama vengono calcolate come: U = (indice% TextureWidthInPixeles)/(float) (TextureWidthInPixeles) V = (index/TextureWidthInPixeles)/(float) (TextureHeightInPixeles) dove index è un indice sequenziale dei vertici generati più TSS \[ D3DSAMP \_ DMAPOFFSET \] .</span><span class="sxs-lookup"><span data-stu-id="63cfa-154">Texture coordinates are computed as: U = (Index % TextureWidthInPixeles) / (float)(TextureWidthInPixeles) V = (Index / TextureWidthInPixeles) / (float)(TextureHeightInPixeles) where Index is a sequential index of generated vertices plus TSS\[D3DSAMP\_DMAPOFFSET\].</span></span> <span data-ttu-id="63cfa-155">L'indice sequenziale è impostato su zero all'inizio di ogni primitiva e viene aumentato dopo la generazione di un vertice.</span><span class="sxs-lookup"><span data-stu-id="63cfa-155">The sequential index is set to zero at the start of each primitive and is increased after a vertex is generated.</span></span>

<span data-ttu-id="63cfa-156">Si tratta delle modifiche apportate all'API che supportano il mapping di spostamento.</span><span class="sxs-lookup"><span data-stu-id="63cfa-156">These are the API changes that support displacement mapping.</span></span>

-   <span data-ttu-id="63cfa-157">È stato aggiunto un solo formato di canale, D3DFMT \_ L16.</span><span class="sxs-lookup"><span data-stu-id="63cfa-157">A single channel format added, D3DFMT\_L16.</span></span>
-   <span data-ttu-id="63cfa-158">Un nuovo flag di utilizzo, D3DUSAGE \_ dmap.</span><span class="sxs-lookup"><span data-stu-id="63cfa-158">A new usage flag, D3DUSAGE\_DMAP.</span></span>
-   <span data-ttu-id="63cfa-159">Una fase di trama speciale, utilizzata per impostare una trama della mappa di spostamento, D3DDMAPSAMPLER.</span><span class="sxs-lookup"><span data-stu-id="63cfa-159">A special texture stage, used to set a displacement map texture, D3DDMAPSAMPLER.</span></span>
-   <span data-ttu-id="63cfa-160">Sono stati aggiunti nuovi tappi hardware, D3DDEVCAPS2 \_ DMAPNPATCH e D3DDEVCAPS2 \_ PRESAMPLEDDMAPNPATCH.</span><span class="sxs-lookup"><span data-stu-id="63cfa-160">New hardware caps have been added, D3DDEVCAPS2\_DMAPNPATCH and D3DDEVCAPS2\_PRESAMPLEDDMAPNPATCH.</span></span> <span data-ttu-id="63cfa-161">Vedere [D3DDEVCAPS2](d3ddevcaps2.md).</span><span class="sxs-lookup"><span data-stu-id="63cfa-161">See [D3DDEVCAPS2](d3ddevcaps2.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="63cfa-162">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="63cfa-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="63cfa-163">Pipeline Vertex</span><span class="sxs-lookup"><span data-stu-id="63cfa-163">Vertex Pipeline</span></span>](vertex-pipeline.md)
</dt> </dl>

 

 
