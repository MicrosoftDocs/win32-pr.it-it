---
description: Un oggetto semaforo è un oggetto di sincronizzazione che mantiene un conteggio compreso tra zero e un valore massimo specificato.
ms.assetid: d9da1d98-a306-4e2d-a149-1eef6a724751
title: Oggetti semaforo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a77f36313d76c5d98c786a76f10ad8439965f180
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106317663"
---
# <a name="semaphore-objects"></a><span data-ttu-id="14872-103">Oggetti semaforo</span><span class="sxs-lookup"><span data-stu-id="14872-103">Semaphore Objects</span></span>

<span data-ttu-id="14872-104">Un *oggetto semaforo* è un oggetto di sincronizzazione che mantiene un conteggio compreso tra zero e un valore massimo specificato.</span><span class="sxs-lookup"><span data-stu-id="14872-104">A *semaphore object* is a synchronization object that maintains a count between zero and a specified maximum value.</span></span> <span data-ttu-id="14872-105">Il conteggio viene decrementato ogni volta che un thread completa un'attesa per l'oggetto semaforo e viene incrementato ogni volta che un thread rilascia il semaforo.</span><span class="sxs-lookup"><span data-stu-id="14872-105">The count is decremented each time a thread completes a wait for the semaphore object and incremented each time a thread releases the semaphore.</span></span> <span data-ttu-id="14872-106">Quando il conteggio raggiunge lo zero, nessun altro thread può attendere che lo stato dell'oggetto semaforo venga segnalato.</span><span class="sxs-lookup"><span data-stu-id="14872-106">When the count reaches zero, no more threads can successfully wait for the semaphore object state to become signaled.</span></span> <span data-ttu-id="14872-107">Lo stato di un semaforo denominato è impostato come segnalato quando il relativo conteggio è maggiore di zero e come non segnalato quando il relativo conteggio è zero.</span><span class="sxs-lookup"><span data-stu-id="14872-107">The state of a semaphore is set to signaled when its count is greater than zero, and nonsignaled when its count is zero.</span></span>

<span data-ttu-id="14872-108">L'oggetto semaforo è utile per il controllo di una risorsa condivisa in grado di supportare un numero limitato di utenti.</span><span class="sxs-lookup"><span data-stu-id="14872-108">The semaphore object is useful in controlling a shared resource that can support a limited number of users.</span></span> <span data-ttu-id="14872-109">Funge da Gate che limita il numero di thread che condividono la risorsa a un numero massimo specificato.</span><span class="sxs-lookup"><span data-stu-id="14872-109">It acts as a gate that limits the number of threads sharing the resource to a specified maximum number.</span></span> <span data-ttu-id="14872-110">Ad esempio, un'applicazione può inserire un limite per il numero di finestre che crea.</span><span class="sxs-lookup"><span data-stu-id="14872-110">For example, an application might place a limit on the number of windows that it creates.</span></span> <span data-ttu-id="14872-111">Usa un semaforo con un conteggio massimo uguale al limite della finestra, decrementa il conteggio ogni volta che viene creata una finestra e la incrementa a ogni chiusura di una finestra.</span><span class="sxs-lookup"><span data-stu-id="14872-111">It uses a semaphore with a maximum count equal to the window limit, decrementing the count whenever a window is created and incrementing it whenever a window is closed.</span></span> <span data-ttu-id="14872-112">L'applicazione specifica l'oggetto semaforo nella chiamata a una delle [funzioni di attesa](wait-functions.md) prima della creazione di ogni finestra.</span><span class="sxs-lookup"><span data-stu-id="14872-112">The application specifies the semaphore object in call to one of the [wait functions](wait-functions.md) before each window is created.</span></span> <span data-ttu-id="14872-113">Quando il conteggio è zero, a indicare che è stato raggiunto il limite della finestra, la funzione wait blocca l'esecuzione del codice di creazione della finestra.</span><span class="sxs-lookup"><span data-stu-id="14872-113">When the count is zero—indicating that the window limit has been reached—the wait function blocks execution of the window-creation code.</span></span>

<span data-ttu-id="14872-114">Un thread usa la funzione [**CreateSemaphore**](/windows/desktop/api/WinBase/nf-winbase-createsemaphorea) o [**CreateSemaphoreEx**](/windows/desktop/api/WinBase/nf-winbase-createsemaphoreexa) per creare un oggetto semaforo.</span><span class="sxs-lookup"><span data-stu-id="14872-114">A thread uses the [**CreateSemaphore**](/windows/desktop/api/WinBase/nf-winbase-createsemaphorea) or [**CreateSemaphoreEx**](/windows/desktop/api/WinBase/nf-winbase-createsemaphoreexa) function to create a semaphore object.</span></span> <span data-ttu-id="14872-115">Il thread di creazione specifica il numero iniziale e il valore massimo del conteggio per l'oggetto.</span><span class="sxs-lookup"><span data-stu-id="14872-115">The creating thread specifies the initial count and the maximum value of the count for the object.</span></span> <span data-ttu-id="14872-116">Il numero iniziale deve essere minore di zero o maggiore del valore massimo.</span><span class="sxs-lookup"><span data-stu-id="14872-116">The initial count must be neither less than zero nor greater than the maximum value.</span></span> <span data-ttu-id="14872-117">Il thread di creazione può inoltre specificare un nome per l'oggetto semaforo.</span><span class="sxs-lookup"><span data-stu-id="14872-117">The creating thread can also specify a name for the semaphore object.</span></span> <span data-ttu-id="14872-118">I thread di altri processi possono aprire un handle per un oggetto semaforo esistente specificandone il nome in una chiamata alla funzione [**OpenSemaphore**](/windows/win32/api/synchapi/nf-synchapi-opensemaphorew) .</span><span class="sxs-lookup"><span data-stu-id="14872-118">Threads in other processes can open a handle to an existing semaphore object by specifying its name in a call to the [**OpenSemaphore**](/windows/win32/api/synchapi/nf-synchapi-opensemaphorew) function.</span></span> <span data-ttu-id="14872-119">Per ulteriori informazioni sui nomi per gli oggetti mutex, Event, Semaphore e timer, vedere [sincronizzazione interprocesso](interprocess-synchronization.md).</span><span class="sxs-lookup"><span data-stu-id="14872-119">For additional information about names for mutex, event, semaphore, and timer objects, see [Interprocess Synchronization](interprocess-synchronization.md).</span></span>

<span data-ttu-id="14872-120">Se più di un thread è in attesa su un semaforo, viene selezionato un thread in attesa.</span><span class="sxs-lookup"><span data-stu-id="14872-120">If more than one thread is waiting on a semaphore, a waiting thread is selected.</span></span> <span data-ttu-id="14872-121">Non presupporre un ordine FIFO (First-in, First-out).</span><span class="sxs-lookup"><span data-stu-id="14872-121">Do not assume a first-in, first-out (FIFO) order.</span></span> <span data-ttu-id="14872-122">Gli eventi esterni, ad esempio APC in modalità kernel, possono modificare l'ordine di attesa.</span><span class="sxs-lookup"><span data-stu-id="14872-122">External events such as kernel-mode APCs can change the wait order.</span></span>

<span data-ttu-id="14872-123">Ogni volta che una delle [funzioni di attesa](wait-functions.md) restituisce perché lo stato di un semaforo è stato impostato su segnalato, il conteggio del semaforo viene ridotto di uno.</span><span class="sxs-lookup"><span data-stu-id="14872-123">Each time one of the [wait functions](wait-functions.md) returns because the state of a semaphore was set to signaled, the count of the semaphore is decreased by one.</span></span> <span data-ttu-id="14872-124">La funzione [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) aumenta il conteggio di un semaforo in base a un importo specificato.</span><span class="sxs-lookup"><span data-stu-id="14872-124">The [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) function increases a semaphore's count by a specified amount.</span></span> <span data-ttu-id="14872-125">Il conteggio non può mai essere minore di zero o maggiore del valore massimo.</span><span class="sxs-lookup"><span data-stu-id="14872-125">The count can never be less than zero or greater than the maximum value.</span></span>

<span data-ttu-id="14872-126">Il numero iniziale di un semaforo viene in genere impostato sul valore massimo.</span><span class="sxs-lookup"><span data-stu-id="14872-126">The initial count of a semaphore is typically set to the maximum value.</span></span> <span data-ttu-id="14872-127">Il conteggio viene quindi decrementato da tale livello man mano che la risorsa protetta viene utilizzata.</span><span class="sxs-lookup"><span data-stu-id="14872-127">The count is then decremented from that level as the protected resource is consumed.</span></span> <span data-ttu-id="14872-128">In alternativa, è possibile creare un semaforo con un conteggio iniziale pari a zero per bloccare l'accesso alla risorsa protetta mentre è in corso l'inizializzazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="14872-128">Alternatively, you can create a semaphore with an initial count of zero to block access to the protected resource while the application is being initialized.</span></span> <span data-ttu-id="14872-129">Dopo l'inizializzazione, è possibile usare [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) per incrementare il conteggio fino al valore massimo.</span><span class="sxs-lookup"><span data-stu-id="14872-129">After initialization, you can use [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) to increment the count to the maximum value.</span></span>

<span data-ttu-id="14872-130">Un thread proprietario di un oggetto mutex può attendere ripetutamente che lo stesso oggetto mutex venga segnalato senza che l'esecuzione venga bloccata.</span><span class="sxs-lookup"><span data-stu-id="14872-130">A thread that owns a mutex object can wait repeatedly for the same mutex object to become signaled without its execution becoming blocked.</span></span> <span data-ttu-id="14872-131">Un thread che attende ripetutamente lo stesso oggetto semaforo, tuttavia, decrementa il conteggio del semaforo ogni volta che viene completata un'operazione di attesa. il thread viene bloccato quando il conteggio raggiunge lo zero.</span><span class="sxs-lookup"><span data-stu-id="14872-131">A thread that waits repeatedly for the same semaphore object, however, decrements the semaphore's count each time a wait operation is completed; the thread is blocked when the count gets to zero.</span></span> <span data-ttu-id="14872-132">Analogamente, solo il thread proprietario di un mutex può chiamare correttamente la funzione [**ReleaseMutex**](/windows/win32/api/synchapi/nf-synchapi-releasemutex) , anche se qualsiasi thread può utilizzare [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) per aumentare il numero di un oggetto semaforo.</span><span class="sxs-lookup"><span data-stu-id="14872-132">Similarly, only the thread that owns a mutex can successfully call the [**ReleaseMutex**](/windows/win32/api/synchapi/nf-synchapi-releasemutex) function, though any thread can use [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) to increase the count of a semaphore object.</span></span>

<span data-ttu-id="14872-133">Un thread può decrementare il conteggio di un semaforo più di una volta, specificando ripetutamente lo stesso oggetto semaforo nelle chiamate a una qualsiasi delle [funzioni di attesa](wait-functions.md).</span><span class="sxs-lookup"><span data-stu-id="14872-133">A thread can decrement a semaphore's count more than once by repeatedly specifying the same semaphore object in calls to any of the [wait functions](wait-functions.md).</span></span> <span data-ttu-id="14872-134">Tuttavia, la chiamata di una delle funzioni di attesa di più oggetti con una matrice che contiene più handle dello stesso semaforo non comporta decrementi multipli.</span><span class="sxs-lookup"><span data-stu-id="14872-134">However, calling one of the multiple-object wait functions with an array that contains multiple handles of the same semaphore does not result in multiple decrements.</span></span>

<span data-ttu-id="14872-135">Al termine dell'utilizzo dell'oggetto semaforo, chiamare la funzione [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) per chiudere l'handle.</span><span class="sxs-lookup"><span data-stu-id="14872-135">When you have finished using the semaphore object, call the [**CloseHandle**](/windows/win32/api/handleapi/nf-handleapi-closehandle) function to close the handle.</span></span> <span data-ttu-id="14872-136">L'oggetto semaforo viene eliminato definitivamente quando l'ultimo handle è stato chiuso.</span><span class="sxs-lookup"><span data-stu-id="14872-136">The semaphore object is destroyed when its last handle has been closed.</span></span> <span data-ttu-id="14872-137">La chiusura dell'handle non influisce sul conteggio dei semafori; Assicurarsi pertanto di chiamare [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) prima di chiudere l'handle o prima che il processo venga terminato.</span><span class="sxs-lookup"><span data-stu-id="14872-137">Closing the handle does not affect the semaphore count; therefore, be sure to call [**ReleaseSemaphore**](/windows/win32/api/synchapi/nf-synchapi-releasesemaphore) before closing the handle or before the process terminates.</span></span> <span data-ttu-id="14872-138">In caso contrario, le operazioni di attesa in sospeso verranno interrotte o continueranno a tempo indefinito, a seconda che sia stato specificato un valore di timeout.</span><span class="sxs-lookup"><span data-stu-id="14872-138">Otherwise, pending wait operations will either time out or continue indefinitely, depending on whether a time-out value has been specified.</span></span>

## <a name="related-topics"></a><span data-ttu-id="14872-139">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="14872-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="14872-140">Uso di oggetti semaforo</span><span class="sxs-lookup"><span data-stu-id="14872-140">Using Semaphore Objects</span></span>](using-semaphore-objects.md)
</dt> </dl>

 

 
