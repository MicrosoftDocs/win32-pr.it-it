---
title: Conversione di un file di DRM-Protected in un flusso Windows Media DRM 10 per dispositivi di rete
description: Conversione di un file di DRM-Protected in un flusso Windows Media DRM 10 per dispositivi di rete
ms.assetid: 11aa0cfd-6d87-4ec4-82d8-db2507402911
keywords:
- Windows Media Format SDK, conversione di file protetti da DRM
- Windows Media Format SDK, file protetti da DRM
- ASF (Advanced Systems Format), conversione di file protetti da DRM
- ASF (Advanced Systems Format), conversione di file protetti da DRM
- ASF (Advanced Systems Format), file protetti da DRM
- ASF (Advanced Systems Format), file protetti da DRM
- Digital Rights Management (DRM), conversione di file protetti da DRM
- DRM (Digital Rights Management), conversione di file protetti da DRM
- Digital Rights Management (DRM), file protetti da DRM
- DRM (Digital Rights Management), file protetti da DRM
- Windows Media Format SDK, Windows Media DRM 10 per i dispositivi di rete
- Windows Media Format SDK, DRM 10 per i dispositivi di rete
- ASF (Advanced Systems Format), Windows Media DRM 10 per i dispositivi di rete
- ASF (Advanced Systems Format), Windows Media DRM 10 per i dispositivi di rete
- ASF (Advanced Systems Format), DRM 10 per i dispositivi di rete
- ASF (Advanced Systems Format), DRM 10 per i dispositivi di rete
- Digital Rights Management (DRM), Windows Media DRM 10 per i dispositivi di rete
- DRM (Digital Rights Management), Windows Media DRM 10 per i dispositivi di rete
- Digital Rights Management (DRM), DRM 10 per i dispositivi di rete
- DRM (Digital Rights Management), DRM 10 per i dispositivi di rete
- Windows Media DRM 10 per i dispositivi di rete, conversione di file protetti da DRM
- DRM 10 per i dispositivi di rete, conversione di file protetti da DRM
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 644c1b4f7ede688434fbb1dde11b7051c6f644a5
ms.sourcegitcommit: 48d1c892045445bcbd0f22bafa2fd3861ffaa6e7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/19/2020
ms.locfileid: "103723599"
---
# <a name="converting-a-drm-protected-file-to-a-windows-media-drm-10-for-network-devices-stream"></a><span data-ttu-id="cd674-125">Conversione di un file di DRM-Protected in un flusso Windows Media DRM 10 per dispositivi di rete</span><span class="sxs-lookup"><span data-stu-id="cd674-125">Converting a DRM-Protected File to a Windows Media DRM 10 for Network Devices Stream</span></span>

<span data-ttu-id="cd674-126">Dopo la registrazione e la convalida di un dispositivo, è possibile iniziare l'elaborazione dei messaggi di richiesta di licenza.</span><span class="sxs-lookup"><span data-stu-id="cd674-126">After a device is registered and validated, you can begin processing license request messages from it.</span></span> <span data-ttu-id="cd674-127">I messaggi di richiesta di licenza vengono inviati dai dispositivi quando è necessaria un'azione da parte dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="cd674-127">License request messages are sent by devices when action from the application is needed.</span></span> <span data-ttu-id="cd674-128">L'unica azione attualmente supportata è "Play", che è una richiesta di dati protetti per la riproduzione.</span><span class="sxs-lookup"><span data-stu-id="cd674-128">The only action currently supported is "Play", which is a request for secure data for playback.</span></span>

<span data-ttu-id="cd674-129">Quando si riceve un messaggio di richiesta di licenza, attenersi alla procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="cd674-129">When you receive a license request message, you should perform the following steps:</span></span>

1.  <span data-ttu-id="cd674-130">Analizzare il messaggio di richiesta di licenza chiamando il metodo [**IWMDRMMessageParser::P arselicenserequestmsg**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmmessageparser-parselicenserequestmsg) .</span><span class="sxs-lookup"><span data-stu-id="cd674-130">Parse the license request message by calling the [**IWMDRMMessageParser::ParseLicenseRequestMsg**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmmessageparser-parselicenserequestmsg) method.</span></span>
2.  <span data-ttu-id="cd674-131">Ottenere l'interfaccia [**IWMRegisteredDevice**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmregistereddevice) per il dispositivo chiamando il metodo [**IWMDeviceRegistration:: GetRegisteredDeviceByID**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdeviceregistration-getregistereddevicebyid) , passando il certificato e il numero di serie ottenuti nel passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="cd674-131">Get the [**IWMRegisteredDevice**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmregistereddevice) interface for the device by calling the [**IWMDeviceRegistration::GetRegisteredDeviceByID**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdeviceregistration-getregistereddevicebyid) method, passing in the certificate and serial number obtained in step 1.</span></span>
3.  <span data-ttu-id="cd674-132">Verificare che il dispositivo sia pronto per ricevere dati protetti:</span><span class="sxs-lookup"><span data-stu-id="cd674-132">Verify that the device is ready to receive secure data:</span></span>
    -   <span data-ttu-id="cd674-133">Chiamare [**IWMRegisteredDevice:: unapproved**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isapproved) per verificare che il dispositivo sia stato approvato.</span><span class="sxs-lookup"><span data-stu-id="cd674-133">Call [**IWMRegisteredDevice::IsApproved**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isapproved) to verify that the device has been approved.</span></span> <span data-ttu-id="cd674-134">L'approvazione deve essere sempre basata sulla preferenza dell'utente.</span><span class="sxs-lookup"><span data-stu-id="cd674-134">Approval should always be based on user preference.</span></span>
    -   <span data-ttu-id="cd674-135">Chiamare [**IWMRegisteredDevice:: IsValid**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isvalid) per verificare che il dispositivo sia stato convalidato entro le ultime 48 ore.</span><span class="sxs-lookup"><span data-stu-id="cd674-135">Call [**IWMRegisteredDevice::IsValid**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isvalid) to verify that the device has been validated within the last 48 hours.</span></span> <span data-ttu-id="cd674-136">Se il dispositivo non è valido, è necessario eseguire il rilevamento della prossimità.</span><span class="sxs-lookup"><span data-stu-id="cd674-136">If the device is not valid, you need to perform proximity detection.</span></span> <span data-ttu-id="cd674-137">Per ulteriori informazioni, vedere [esecuzione del rilevamento della prossimità](performing-proximity-detection.md).</span><span class="sxs-lookup"><span data-stu-id="cd674-137">For more information, see [Performing Proximity Detection](performing-proximity-detection.md).</span></span>
    -   <span data-ttu-id="cd674-138">Chiamare [**IWMRegisteredDevice:: di apertura**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isopened) per verificare che il dispositivo sia stato aperto.</span><span class="sxs-lookup"><span data-stu-id="cd674-138">Call [**IWMRegisteredDevice::IsOpened**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-isopened) to verify that the device has been opened.</span></span> <span data-ttu-id="cd674-139">Se il dispositivo non è aperto, è possibile aprirlo chiamando [**IWMRegisteredDevice:: Open**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-open).</span><span class="sxs-lookup"><span data-stu-id="cd674-139">If the device is not open, you can open it by calling [**IWMRegisteredDevice::Open**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-open).</span></span> <span data-ttu-id="cd674-140">Nel computer è possibile aprire solo 10 dispositivi alla volta.</span><span class="sxs-lookup"><span data-stu-id="cd674-140">You can only have 10 devices open on the computer at a time.</span></span> <span data-ttu-id="cd674-141">È possibile che sia necessario chiudere un altro dispositivo prima di poter aprire quello per cui si sta elaborando la richiesta.</span><span class="sxs-lookup"><span data-stu-id="cd674-141">It is possible that you may need to close another device before you can open the one for which you are processing the request.</span></span> <span data-ttu-id="cd674-142">Per chiudere un dispositivo, chiamare il metodo [**IWMRegisteredDevice:: Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-close) .</span><span class="sxs-lookup"><span data-stu-id="cd674-142">To close a device, call the [**IWMRegisteredDevice::Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmregistereddevice-close) method.</span></span>
4.  <span data-ttu-id="cd674-143">Creare un'istanza dell'oggetto transcryptor DRM chiamando la funzione [**WMCreateDRMTranscryptor**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatedrmtranscryptor) .</span><span class="sxs-lookup"><span data-stu-id="cd674-143">Create an instance of the DRM transcryptor object by calling the [**WMCreateDRMTranscryptor**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-wmcreatedrmtranscryptor) function.</span></span>
5.  <span data-ttu-id="cd674-144">Chiamare il metodo [**IWMDRMTranscryptor:: Initialize**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-initialize) per inizializzare il transcryptor.</span><span class="sxs-lookup"><span data-stu-id="cd674-144">Call the [**IWMDRMTranscryptor::Initialize**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-initialize) method to initialize the transcryptor.</span></span> <span data-ttu-id="cd674-145">Questo metodo accetta un puntatore all'implementazione dell'interfaccia [**IWMStatusCallback**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstatuscallback) , che usa per recapitare i messaggi di stato.</span><span class="sxs-lookup"><span data-stu-id="cd674-145">This method takes a pointer to your implementation of the [**IWMStatusCallback**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstatuscallback) interface, which it uses to deliver status messages.</span></span> <span data-ttu-id="cd674-146">Questo metodo restituisce anche un messaggio di richiesta di licenza che deve essere inviato al dispositivo prima di continuare.</span><span class="sxs-lookup"><span data-stu-id="cd674-146">This method also returns a license request message that must be sent to the device before continuing.</span></span>
6.  <span data-ttu-id="cd674-147">Quando il metodo [**IWMStatusCallback:: OnStatus**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmstatuscallback-onstatus) dell'applicazione riceve il \_ messaggio di stato init di WMT Transcriptor \_ , chiamare il metodo [**IWMDRMTranscryptor:: Seek**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-seek) per cercare la posizione iniziale appropriata nel file.</span><span class="sxs-lookup"><span data-stu-id="cd674-147">When your application's [**IWMStatusCallback::OnStatus**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmstatuscallback-onstatus) method receives the WMT\_TRANSCRYPTOR\_INIT status message, call the [**IWMDRMTranscryptor::Seek**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-seek) method to seek to the appropriate start position in the file.</span></span> <span data-ttu-id="cd674-148">Per iniziare all'inizio del file, è necessario chiamare **Seek** con Time 0.</span><span class="sxs-lookup"><span data-stu-id="cd674-148">To start at the beginning of the file, you must call **Seek** with time 0.</span></span>
7.  <span data-ttu-id="cd674-149">Il Transcriptor Invia un \_ \_ messaggio ricercato di transcryptor WMT quando è pronto per il recapito dei dati dal file alla nuova ora di presentazione.</span><span class="sxs-lookup"><span data-stu-id="cd674-149">The transcryptor sends a WMT\_TRANSCRYPTOR\_SEEKED message when it is ready to deliver data from the file at the new presentation time.</span></span> <span data-ttu-id="cd674-150">Eseguire chiamate ripetute al metodo [**IWMDRMTranscryptor:: Read**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-read) per ottenere blocchi convertiti di dati multimediali.</span><span class="sxs-lookup"><span data-stu-id="cd674-150">Make repeated calls to the [**IWMDRMTranscryptor::Read**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-read) method to get converted chunks of media data.</span></span> <span data-ttu-id="cd674-151">Ogni chiamata è asincrona e non è completa fino a quando non \_ viene ricevuto un messaggio di lettura WMT TRANScryptor \_ .</span><span class="sxs-lookup"><span data-stu-id="cd674-151">Each call is asynchronous and is not complete until a WMT\_TRANSCRYPTOR\_READ message is received.</span></span> <span data-ttu-id="cd674-152">Quando si riceve il messaggio, è possibile inviare i dati al dispositivo di destinazione.</span><span class="sxs-lookup"><span data-stu-id="cd674-152">When you receive the message, you can send the data to the receiving device.</span></span>
8.  <span data-ttu-id="cd674-153">Quando si riceve un messaggio di lettura di WMT \_ TRANScryptor \_ con il parametro *HR* impostato su NS \_ S \_ Transcriptor \_ EOF, viene letto l'intero file.</span><span class="sxs-lookup"><span data-stu-id="cd674-153">When you receive a WMT\_TRANSCRYPTOR\_READ message with the *hr* parameter set to NS\_S\_TRANSCRYPTOR\_EOF, the entire file has been read.</span></span> <span data-ttu-id="cd674-154">A questo punto, chiamare il metodo [**IWMDRMTranscryptor:: Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-close) per chiudere il file e liberare risorse.</span><span class="sxs-lookup"><span data-stu-id="cd674-154">At this point, call the [**IWMDRMTranscryptor::Close**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmdrmtranscryptor-close) method to close the file and free resources.</span></span>
9.  <span data-ttu-id="cd674-155">Quando \_ viene ricevuto il messaggio WMT TRANScriptor \_ Closed, è possibile rilasciare l'interfaccia [**IWMDRMTranscryptor**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmtranscryptor) .</span><span class="sxs-lookup"><span data-stu-id="cd674-155">When the WMT\_TRANSCRYPTOR\_CLOSED message is received, you can release the [**IWMDRMTranscryptor**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmdrmtranscryptor) interface.</span></span>

> [!Note]  
> <span data-ttu-id="cd674-156">Il DRM non è supportato dalla versione basata su x64 di questo SDK.</span><span class="sxs-lookup"><span data-stu-id="cd674-156">DRM is not supported by the x64-based version of this SDK.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="cd674-157">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="cd674-157">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="cd674-158">**Uso del protocollo Windows Media DRM 10 per i dispositivi di rete**</span><span class="sxs-lookup"><span data-stu-id="cd674-158">**Using the Windows Media DRM 10 for Network Devices Protocol**</span></span>](using-the-windows-media-drm-10-for-network-devices-protocol.md)
</dt> </dl>

 

 




