---
title: Configurazione di flussi audio
description: Configurazione di flussi audio
ms.assetid: 6ddd9bc1-3fde-4098-afce-fdda461ced62
keywords:
- flussi, configurazione di flussi audio
- codec, configurazione di flussi audio
- flussi audio, configurazione
- codec, formati
- flussi, interfaccia IWMCodecInfo
- IWMCodecInfo, flussi audio
- flussi, sincronizzazione A/V
- flussi audio, sincronizzazione A/V
- Sincronizzazione A/V
- flussi, sincronizzazione A/V
- flussi audio, sincronizzazione A/V
- flussi, formati audio a ritardo ridotto
- flussi audio, formati audio a ritardo ridotto
- codec, formati audio a ritardo ridotto
- flussi, velocità in bit variabile (VBR)
- flussi audio, velocità in bit variabile (VBR)
- codec, velocità in bit variabile (VBR)
- velocità in bit variabile (VBR), configurazione
- VBR (velocità in bit variabile), configurazione
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ad3931ec41e73c125417d39cdd177dc16056e9e
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "106300232"
---
# <a name="configuring-audio-streams"></a><span data-ttu-id="74862-122">Configurazione di flussi audio</span><span class="sxs-lookup"><span data-stu-id="74862-122">Configuring Audio Streams</span></span>

<span data-ttu-id="74862-123">I flussi audio sono in genere i più semplici da configurare.</span><span class="sxs-lookup"><span data-stu-id="74862-123">Audio streams are generally the most straightforward to configure.</span></span> <span data-ttu-id="74862-124">Ottenere una configurazione di flusso dal codec usando i metodi di [**IWMCodecInfo**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmcodecinfo) , come descritto in [recupero delle informazioni di configurazione dei flussi dai codec](getting-stream-configuration-information-from-codecs.md).</span><span class="sxs-lookup"><span data-stu-id="74862-124">Get a stream configuration from the codec using the methods of [**IWMCodecInfo**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmcodecinfo) as described in [Getting Stream Configuration Information from Codecs](getting-stream-configuration-information-from-codecs.md).</span></span> <span data-ttu-id="74862-125">Nella maggior parte dei casi, non è consigliabile modificare le impostazioni da quelle recuperate.</span><span class="sxs-lookup"><span data-stu-id="74862-125">Under most circumstances, you should not alter the settings from those retrieved.</span></span>

<span data-ttu-id="74862-126">Il formato di codec selezionato da quello enumerato dipende dall'uso previsto dei file ASF creati con il profilo.</span><span class="sxs-lookup"><span data-stu-id="74862-126">The codec format that you select from those enumerated depends upon the intended use of the ASF files made with the profile.</span></span> <span data-ttu-id="74862-127">La descrizione del formato di codec recuperata da [**IWMCodecInfo2:: GetCodecFormatDesc**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo2-getcodecformatdesc) riepiloga le caratteristiche del formato.</span><span class="sxs-lookup"><span data-stu-id="74862-127">The codec format description retrieved by [**IWMCodecInfo2::GetCodecFormatDesc**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo2-getcodecformatdesc) summarizes the characteristics of the format.</span></span> <span data-ttu-id="74862-128">Se l'applicazione non Visualizza le descrizioni per sceglierle, è possibile chiamare **QueryInterface** sull'interfaccia [**IWMStreamConfig**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstreamconfig) del formato codec per ottenere l'interfaccia [**IWMMediaProps**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmmediaprops) .</span><span class="sxs-lookup"><span data-stu-id="74862-128">If your application does not display the descriptions to choose between them, you can call **QueryInterface** on the [**IWMStreamConfig**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmstreamconfig) interface of the codec format to get the [**IWMMediaProps**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmmediaprops) interface.</span></span> <span data-ttu-id="74862-129">È quindi possibile recuperare la struttura del [**\_ \_ tipo di supporto WM**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wm_media_type) chiamando [**IWMMediaProps:: GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype).</span><span class="sxs-lookup"><span data-stu-id="74862-129">Then you can retrieve the [**WM\_MEDIA\_TYPE**](/previous-versions/windows/desktop/api/wmsdkidl/ns-wmsdkidl-wm_media_type) structure by calling [**IWMMediaProps::GetMediaType**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmmediaprops-getmediatype).</span></span> <span data-ttu-id="74862-130">Esaminando la struttura **del \_ \_ tipo di supporto WM** e la struttura [**WAVEFORMATEX**](/previous-versions/windows/desktop/legacy/dd757720(v=vs.85)) a cui punta, è possibile determinare le impostazioni del formato di codec e confrontarle con i requisiti.</span><span class="sxs-lookup"><span data-stu-id="74862-130">By examining the **WM\_MEDIA\_TYPE** structure and the [**WAVEFORMATEX**](/previous-versions/windows/desktop/legacy/dd757720(v=vs.85)) structure it points to, you can determine the settings of the codec format and compare them to your requirements.</span></span>

## <a name="getting-audio-formats-for-av-synchronization"></a><span data-ttu-id="74862-131">Recupero di formati audio per la sincronizzazione A/V</span><span class="sxs-lookup"><span data-stu-id="74862-131">Getting Audio Formats for A/V Synchronization</span></span>

<span data-ttu-id="74862-132">Il codec Windows Media Audio e il codec Windows Media Audio Professional supportano entrambi i formati per i file audio e video.</span><span class="sxs-lookup"><span data-stu-id="74862-132">The Windows Media Audio codec and Windows Media Audio Professional codec both support formats for audio-only files and for audio/video files.</span></span> <span data-ttu-id="74862-133">I formati solo audio sono ottimizzati per i file contenenti solo dati audio, mentre i formati audio/video sono ottimizzati per l'audio in un file con un flusso video.</span><span class="sxs-lookup"><span data-stu-id="74862-133">The audio-only formats are optimized for files containing only audio data, while the audio/video formats are optimized for audio that is in a file with a video stream.</span></span> <span data-ttu-id="74862-134">Quando si enumerano i formati di codec per questi codec, i formati audio/video sono disponibili solo per i formati audio.</span><span class="sxs-lookup"><span data-stu-id="74862-134">When enumerating codec formats for these codecs, the audio/video formats come after the audio-only formats.</span></span> <span data-ttu-id="74862-135">Le descrizioni del formato audio/video contengono tutte la stringa "(A/V)".</span><span class="sxs-lookup"><span data-stu-id="74862-135">The audio/video format descriptions all contain the string "(A/V)".</span></span> <span data-ttu-id="74862-136">È possibile identificare i formati progettati per la sincronizzazione audio/video a livello di programmazione controllando il numero di pacchetti al secondo.</span><span class="sxs-lookup"><span data-stu-id="74862-136">You can identify the formats designed for audio/video synchronization programmatically by checking the number of packets per second.</span></span> <span data-ttu-id="74862-137">I formati per la sincronizzazione contengono 5 o più pacchetti al secondo se la velocità in bit è maggiore o uguale a 32.000 bit al secondo.</span><span class="sxs-lookup"><span data-stu-id="74862-137">Formats for synchronization have 5 or more packets per second if the bit rate is greater than or equal to 32,000 bits per second.</span></span> <span data-ttu-id="74862-138">I formati con velocità in bit inferiori a 32.000 bit al secondo possono essere usati con video sincronizzato se usano 3 o più pacchetti al secondo.</span><span class="sxs-lookup"><span data-stu-id="74862-138">Formats with bit rates less than 32,000 bits per second can be used with synchronized video if they use 3 or more packets per second.</span></span> <span data-ttu-id="74862-139">L'esempio di codice nell'argomento [to find audio formats](to-find-audio-formats.md) contiene il codice necessario per eseguire questo controllo:</span><span class="sxs-lookup"><span data-stu-id="74862-139">The code example in the [To Find Audio Formats](to-find-audio-formats.md) topic contains the code required to make this check:</span></span>


```C++
if((pWave->nAvgBytesPerSec / pWave->nBlockAlign) >= 
       ((pWave->nAvgBytesPerSec >= 4000) ? 5.0 : 3.0))
{
    // Set this stream configuration as the new best match.
}
```



## <a name="getting-low-delay-audio-formats"></a><span data-ttu-id="74862-140">Acquisizione di Low-Delay formati audio</span><span class="sxs-lookup"><span data-stu-id="74862-140">Getting Low-Delay Audio Formats</span></span>

<span data-ttu-id="74862-141">Il codec Windows Media 9,1 e il codec Windows Media Audio 9,1 Professional supportano entrambi i formati a ritardo ridotto.</span><span class="sxs-lookup"><span data-stu-id="74862-141">The Windows Media 9.1 codec and the Windows Media Audio 9.1 Professional codec both support low-delay formats.</span></span> <span data-ttu-id="74862-142">Questi formati hanno una finestra buffer più piccola rispetto ad altri formati audio.</span><span class="sxs-lookup"><span data-stu-id="74862-142">These formats have a smaller buffer window than other audio formats.</span></span> <span data-ttu-id="74862-143">L'audio a basso ritardo è progettato per migliorare le prestazioni negli scenari in cui i file o i flussi verranno scambiati di frequente; ad esempio, un'applicazione che elenca diversi brani per lo streaming nell'interfaccia utente e consente agli utenti di spostarsi arbitrariamente tra loro.</span><span class="sxs-lookup"><span data-stu-id="74862-143">Low-delay audio is intended to improve performance in scenarios where files or streams will be switched frequently; for example, an application that lists a number of songs for streaming in the user interface and allows users to arbitrarily switch between them.</span></span>

<span data-ttu-id="74862-144">I formati a ritardo ridotto sono disponibili solo in modalità CBR (un passaggio o due passaggi).</span><span class="sxs-lookup"><span data-stu-id="74862-144">Low-delay formats are available only in CBR mode (one-pass or two-pass).</span></span> <span data-ttu-id="74862-145">Le descrizioni del formato a ritardo basso contengono tutte la stringa "ritardo basso".</span><span class="sxs-lookup"><span data-stu-id="74862-145">The low-delay format descriptions all contain the string "Low Delay".</span></span> <span data-ttu-id="74862-146">È possibile identificare i formati a livello di programmazione controllando il valore della velocità in bit del formato.</span><span class="sxs-lookup"><span data-stu-id="74862-146">You can identify the formats programmatically by checking the bit-rate value of the format.</span></span> <span data-ttu-id="74862-147">Ai formati a basso ritardo vengono assegnate velocità in bit pari a 1 kilobit inferiore rispetto alla velocità in bit del formato normale equivalente.</span><span class="sxs-lookup"><span data-stu-id="74862-147">The low-delay formats are assigned bit rates that are 1 kilobit less than the bit rates of the equivalent normal format.</span></span> <span data-ttu-id="74862-148">Ad esempio, il codec Windows Media Audio 9,1 supporta un formato CBR a passaggio singolo con una velocità in bit di 192 kbps.</span><span class="sxs-lookup"><span data-stu-id="74862-148">For example, the Windows Media Audio 9.1 codec supports a single-pass CBR format with a bit rate of 192 kbps.</span></span> <span data-ttu-id="74862-149">Il formato a basso ritardo equivalente ha una velocità in bit di 191 kbps.</span><span class="sxs-lookup"><span data-stu-id="74862-149">The equivalent low-delay format has a bit rate of 191 kbps.</span></span> <span data-ttu-id="74862-150">Inoltre, con l'eccezione del formato mono a 5 kbps supportato dal codec Windows Media Audio 9,1, i formati a basso ritardo sono gli unici formati che hanno un valore di velocità in bit dispari.</span><span class="sxs-lookup"><span data-stu-id="74862-150">In addition, with the exception of the 5 kbps mono format supported by the Windows Media Audio 9.1 codec, the low-delay formats are the only formats that have an odd bit-rate value.</span></span>

## <a name="configuring-variable-bit-rate-audio"></a><span data-ttu-id="74862-151">Configurazione dell'audio della velocità in bit variabile</span><span class="sxs-lookup"><span data-stu-id="74862-151">Configuring Variable Bit Rate Audio</span></span>

<span data-ttu-id="74862-152">Quando è necessario un formato di velocità in bit variabile (VBR) per uno dei codec audio di Windows Media, è possibile ottenerlo impostando le impostazioni di enumerazione nel metodo [**IWMCodecInfo3:: SetCodecEnumerationSetting**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo3-setcodecenumerationsetting) .</span><span class="sxs-lookup"><span data-stu-id="74862-152">When you need a variable bit rate (VBR) format for one of the Windows Media audio codecs, you can get it by setting the enumeration settings in the [**IWMCodecInfo3::SetCodecEnumerationSetting**](/previous-versions/windows/desktop/api/Wmsdkidl/nf-wmsdkidl-iwmcodecinfo3-setcodecenumerationsetting) method.</span></span> <span data-ttu-id="74862-153">Impostare g \_ wszVBREnabled su true e impostare g \_ wszNumPasses su 1 per VBR basato sulla qualità o 2 per VBR a due passaggi (vincolato o non vincolato).</span><span class="sxs-lookup"><span data-stu-id="74862-153">Set g\_wszVBREnabled to True, and set g\_wszNumPasses to 1 for quality-based VBR or 2 for two-pass VBR (constrained or unconstrained).</span></span> <span data-ttu-id="74862-154">Se si usa un VBR a due passaggi vincolato, è necessario impostare manualmente la velocità in bit massima e la finestra del buffer per il flusso usando i metodi di [**IWMPropertyVault**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmpropertyvault) , come descritto in [configurazione dei flussi VBR](configuring-vbr-streams.md).</span><span class="sxs-lookup"><span data-stu-id="74862-154">If you are using constrained two-pass VBR, you must manually set the maximum bit rate and buffer window for the stream using the methods of [**IWMPropertyVault**](/previous-versions/windows/desktop/api/wmsdkidl/nn-wmsdkidl-iwmpropertyvault) as described in [Configuring VBR Streams](configuring-vbr-streams.md).</span></span>

<span data-ttu-id="74862-155">Nei profili VBR basati sulla qualità, il membro **nAvgBytesPerSec** della struttura **WAVEFORMATEX** contiene il livello di qualità (da 1 a 100) nel byte di ordine inferiore e i tre byte più significativi sono impostati su 0x7fffff.</span><span class="sxs-lookup"><span data-stu-id="74862-155">In quality-based VBR profiles, the **nAvgBytesPerSec** member of the **WAVEFORMATEX** structure contains the quality level (1 through 100) in the low-order byte and the three high-order bytes are set to 0x7fffff.</span></span> <span data-ttu-id="74862-156">Non tentare di modificare l'impostazione di qualità modificando manualmente questo valore. è necessario usare il formato così come viene recuperato dal codec.</span><span class="sxs-lookup"><span data-stu-id="74862-156">Do not attempt to modify the quality setting by modifying this value manually; you must use the format as it is retrieved from the codec.</span></span> <span data-ttu-id="74862-157">Per usare un valore di qualità diverso, è necessario enumerare i formati fino a trovare uno che soddisfi le proprie esigenze.</span><span class="sxs-lookup"><span data-stu-id="74862-157">To use a different quality value, you must enumerate formats until you find one that meets your needs.</span></span> <span data-ttu-id="74862-158">Inoltre, **nAvgBytesPerSec** non verrà mantenuto nel file ASF; Quando si ottiene la struttura **WAVEFORMATEX** per un file aperto con l'oggetto Reader, **nAvgBytesPerSec** contiene un valore approssimativo che rappresenta il numero medio di byte al secondo.</span><span class="sxs-lookup"><span data-stu-id="74862-158">Also, **nAvgBytesPerSec** will not be preserved in the ASF file; when you obtain the **WAVEFORMATEX** structure for a file that has been opened with the reader object, **nAvgBytesPerSec** contains an approximate value representing the average number of bytes per second.</span></span>

> [!Note]  
> <span data-ttu-id="74862-159">Quando si configurano i flussi audio, non è mai necessario avere un valore della finestra buffer audio maggiore del valore per tutti i flussi video nel file.</span><span class="sxs-lookup"><span data-stu-id="74862-159">When configuring audio streams, you should never have an audio buffer window value that is greater than the value for any video streams in the file.</span></span> <span data-ttu-id="74862-160">In genere non si tratta di un problema, poiché i valori della finestra buffer audio devono essere compresi tra 1,5 e 3 secondi e i valori video devono essere compresi tra 3 e 5 secondi.</span><span class="sxs-lookup"><span data-stu-id="74862-160">Normally this is not an issue, as audio buffer window values should range between 1.5 and 3 seconds and video values should range between 3 and 5 seconds.</span></span> <span data-ttu-id="74862-161">Se una finestra buffer audio è maggiore di una finestra buffer video, il file verrà riprodotto con i flussi leggermente fuori dalla sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="74862-161">If an audio buffer window is greater than a video buffer window, the file will play back with the streams slightly out of synchronization.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="74862-162">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="74862-162">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="74862-163">**Configurazione comune a tutti i flussi**</span><span class="sxs-lookup"><span data-stu-id="74862-163">**Configuration Common to All Streams**</span></span>](configuration-common-to-all-streams.md)
</dt> <dt>

[<span data-ttu-id="74862-164">**Configurazione di flussi**</span><span class="sxs-lookup"><span data-stu-id="74862-164">**Configuring Streams**</span></span>](configuring-streams.md)
</dt> <dt>

[<span data-ttu-id="74862-165">**Per trovare i formati audio**</span><span class="sxs-lookup"><span data-stu-id="74862-165">**To Find Audio Formats**</span></span>](to-find-audio-formats.md)
</dt> </dl>

 

 