---
description: È possibile che le applicazioni che portano da WinINet a WinHTTP debbano usare le stesse impostazioni del proxy AutoProxy che possono recuperare in WinINet o Internet Explorer (IE).
ms.assetid: c3e867d8-9d67-4e6a-8551-1fa846e089ed
title: Impostazione delle configurazioni del proxy WinINet in WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91306f6591e0aab0f96fa010ee2a83d3f32c8fb4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "103968550"
---
# <a name="setting-wininet-proxy-configurations-in-winhttp"></a><span data-ttu-id="b8e6a-103">Impostazione delle configurazioni del proxy WinINet in WinHTTP</span><span class="sxs-lookup"><span data-stu-id="b8e6a-103">Setting WinINet Proxy Configurations in WinHTTP</span></span>

## <a name="setting-automatic-proxy-on-winhttp-51"></a><span data-ttu-id="b8e6a-104">Impostazione del proxy automatico in WinHTTP 5,1</span><span class="sxs-lookup"><span data-stu-id="b8e6a-104">Setting Automatic Proxy on WinHTTP 5.1</span></span>

<span data-ttu-id="b8e6a-105">È possibile che le applicazioni che portano da WinINet a WinHTTP debbano usare le stesse impostazioni del proxy AutoProxy che possono recuperare in WinINet o Internet Explorer (IE).</span><span class="sxs-lookup"><span data-stu-id="b8e6a-105">Applications that port from WinINet to WinHTTP may need to use the same autoproxy settings that they can retrieve under WinINet or Internet Explorer (IE).</span></span> <span data-ttu-id="b8e6a-106">L'API WinHTTP versione 5,1 può recuperare e usare queste impostazioni proxy.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-106">The WinHTTP version 5.1 API can retrieve and use these proxy settings.</span></span> <span data-ttu-id="b8e6a-107">In generale, WinHTTP specifica il proxy e i server di bypass proxy per ogni singola sessione al momento della creazione della sessione.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-107">In general, WinHTTP specifies the proxy and proxy bypass servers on a per-session basis when the session is created.</span></span> <span data-ttu-id="b8e6a-108">È possibile eseguire l'override di queste impostazioni in base alle singole richieste.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-108">These settings can be overridden on a per-request basis.</span></span>

<span data-ttu-id="b8e6a-109">Per usare la stessa configurazione proxy di WinINet o IE, il client WinHTTP deve impostare le impostazioni proxy per la sessione.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-109">To use the same proxy configuration as WinINet or IE, the WinHTTP client should set proxy settings for the session.</span></span> <span data-ttu-id="b8e6a-110">Inoltre, se IE o WinINet sono configurati per l'utilizzo del protocollo WPAD (Web Proxy Auto-Discovery), il client WinHTTP che utilizza tali impostazioni deve impostare le impostazioni proxy per ogni singola richiesta.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-110">In addition, if IE or WinINet are configured to use Web Proxy Auto-Discovery (WPAD), the WinHTTP client that uses those settings must set proxy settings on a per-request basis.</span></span> <span data-ttu-id="b8e6a-111">Le sezioni seguenti descrivono come specificare le impostazioni proxy per una sessione e una richiesta:</span><span class="sxs-lookup"><span data-stu-id="b8e6a-111">The following sections describe how to specify the proxy settings for a session and a request:</span></span>

-   [<span data-ttu-id="b8e6a-112">Impostazione della configurazione del proxy in una sessione</span><span class="sxs-lookup"><span data-stu-id="b8e6a-112">Setting the Proxy Configuration on a Session</span></span>](#setting-the-proxy-configuration-on-a-session)
-   [<span data-ttu-id="b8e6a-113">Impostazione della configurazione del proxy su una singola richiesta</span><span class="sxs-lookup"><span data-stu-id="b8e6a-113">Setting the Proxy Configuration on a Single Request</span></span>](#setting-the-proxy-configuration-on-a-single-request)

## <a name="setting-the-proxy-configuration-on-a-session"></a><span data-ttu-id="b8e6a-114">Impostazione della configurazione del proxy in una sessione</span><span class="sxs-lookup"><span data-stu-id="b8e6a-114">Setting the Proxy Configuration on a Session</span></span>

## <a name="the-application-is-running-on-a-user-account"></a><span data-ttu-id="b8e6a-115">L'applicazione è in esecuzione in un account utente</span><span class="sxs-lookup"><span data-stu-id="b8e6a-115">The Application is Running on a User Account</span></span>

<span data-ttu-id="b8e6a-116">Prima di creare una sessione, l'applicazione chiama [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) per ottenere le impostazioni del proxy IE.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-116">Before a session is created, the application calls [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) to get the IE proxy settings.</span></span> <span data-ttu-id="b8e6a-117">Per ottenere queste impostazioni, l'applicazione deve essere in esecuzione come account utente.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-117">The application must be running as a user account to obtain these settings.</span></span> <span data-ttu-id="b8e6a-118">Il *parametro pProxyConfig* è un puntatore a una struttura di configurazione del [**\_ \_ \_ \_ proxy \_ di Internet Explorer dell'utente corrente WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) che contiene i server proxy Name (*lpszProxy*) e proxy bypass (*lpszProxyBypass*).</span><span class="sxs-lookup"><span data-stu-id="b8e6a-118">The *pProxyConfig* parameter is a pointer to a [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure that contains the proxy name (*lpszProxy*) and proxy bypass (*lpszProxyBypass*) servers.</span></span> <span data-ttu-id="b8e6a-119">Il nome proxy e i valori di bypass proxy della struttura di **configurazione del proxy di \_ \_ IE dell'utente \_ \_ \_ corrente WinHTTP** vengono quindi utilizzati per inizializzare la sessione WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-119">The proxy name and proxy bypass values of the **WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG** structure are then used to initialize the WinHTTP session.</span></span> <span data-ttu-id="b8e6a-120">La sessione viene inizializzata chiamando [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) con i parametri *pwszProxyName* e *PwszProxyBypass* ottenuti dai membri **lpszProxy** e **lpszProxyBypass** della struttura **di \_ \_ configurazione del \_ \_ proxy di \_ Internet Explorer dell'utente corrente WinHTTP** .</span><span class="sxs-lookup"><span data-stu-id="b8e6a-120">The session is initialized by calling [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) with the *pwszProxyName* and *pwszProxyBypass* parameters obtained from the **lpszProxy** and **lpszProxyBypass** members of the **WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG** structure.</span></span>

## <a name="the-application-is-running-as-a-service"></a><span data-ttu-id="b8e6a-121">L'applicazione è in esecuzione come servizio</span><span class="sxs-lookup"><span data-stu-id="b8e6a-121">The Application is Running as a Service</span></span>

<span data-ttu-id="b8e6a-122">L'applicazione deve assicurarsi che le impostazioni del registro di sistema per un singolo utente vengano caricate nel registro di sistema prima di chiamare [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span><span class="sxs-lookup"><span data-stu-id="b8e6a-122">The application must ensure that the registry settings for an individual user are loaded into the registry before calling [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span></span> <span data-ttu-id="b8e6a-123">Se queste impostazioni non vengono caricate nel registro di sistema, **WinHttpGetIEProxyConfigForCurrentUser** non è in grado di ottenere le impostazioni del proxy.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-123">If these settings are not loaded into the registry, **WinHttpGetIEProxyConfigForCurrentUser** cannot obtain the proxy settings.</span></span> <span data-ttu-id="b8e6a-124">Le impostazioni del registro di sistema per un singolo utente possono essere caricate nel registro di sistema chiamando la funzione **LoadUserProfile** .</span><span class="sxs-lookup"><span data-stu-id="b8e6a-124">Registry settings for an individual user can be loaded into the registry by calling the **LoadUserProfile** function.</span></span> <span data-ttu-id="b8e6a-125">Se il caricamento delle impostazioni del registro di sistema dell'utente non è un'opzione, l'applicazione può chiamare [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) con il **\_ \_ \_ \_ proxy predefinito del tipo di accesso WinHTTP** specificato nel parametro *dwAcessType* .</span><span class="sxs-lookup"><span data-stu-id="b8e6a-125">If loading the user's registry settings is not an option, the application can call [**WinHttpOpen**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopen) with the **WINHTTP\_ACCESS\_TYPE\_DEFAULT\_PROXY** specified in the *dwAcessType* parameter.</span></span> <span data-ttu-id="b8e6a-126">Se si specifica il proxy predefinito nella chiamata a **WinHttpOpen** , l'API WinHTTP recupererà il set di configurazione proxy utilizzando l'utilità WinHTTP [**proxycfg.exe**](proxycfg-exe--a-proxy-configuration-tool.md) .</span><span class="sxs-lookup"><span data-stu-id="b8e6a-126">Specifying the default proxy in the call to **WinHttpOpen** tells the WinHTTP API to retrieve the proxy configuration set by using the WinHTTP [**proxycfg.exe**](proxycfg-exe--a-proxy-configuration-tool.md) utility.</span></span> <span data-ttu-id="b8e6a-127">Una volta caricate le impostazioni del registro di sistema per un singolo utente, l'applicazione segue i passaggi descritti in [esecuzione dell'applicazione in un account utente](#the-application-is-running-on-a-user-account) per impostare il nome proxy e i server proxy bypass.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-127">After the registry settings for an individual user have been loaded, the application follows the steps outlined under [The application is running on a user account](#the-application-is-running-on-a-user-account) to set the proxy name and proxy bypass servers.</span></span>

## <a name="setting-the-proxy-configuration-on-a-single-request"></a><span data-ttu-id="b8e6a-128">Impostazione della configurazione del proxy su una singola richiesta</span><span class="sxs-lookup"><span data-stu-id="b8e6a-128">Setting the Proxy Configuration on a Single Request</span></span>

<span data-ttu-id="b8e6a-129">Prima della creazione della sessione, l'applicazione chiama [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) per determinare se WinInet e IE sono configurati per l'uso di WPAD.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-129">Before the session is created, the application calls [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) to determine if WinINet and IE are configured to use WPAD.</span></span> <span data-ttu-id="b8e6a-130">**WinHttpGetIEProxyConfigForCurrentUser** restituisce la struttura di [**\_ configurazione del \_ \_ \_ proxy \_ di Internet Explorer dell'utente corrente WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) che contiene il membro **fAutoDetect** .</span><span class="sxs-lookup"><span data-stu-id="b8e6a-130">**WinHttpGetIEProxyConfigForCurrentUser** returns the [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure that contains the **fAutoDetect** member.</span></span> <span data-ttu-id="b8e6a-131">Il valore **true** per questo membro indica che viene utilizzato WPAD e il membro **LPSZAUTOCONFIGURL** contiene l'URL WPAD.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-131">A value of **TRUE** for this member indicates that WPAD is used, and the **lpszAutoConfigUrl** member contains the WPAD URL.</span></span>

## <a name="automatic-proxy-configuration-is-used"></a><span data-ttu-id="b8e6a-132">Viene utilizzata la configurazione automatica del proxy</span><span class="sxs-lookup"><span data-stu-id="b8e6a-132">Automatic Proxy Configuration Is Used</span></span>

<span data-ttu-id="b8e6a-133">Se si utilizza WPAD, l'applicazione chiama [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) per recuperare il proxy per la richiesta.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-133">If WPAD is used, the application calls [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) to retrieve the proxy for the request.</span></span> <span data-ttu-id="b8e6a-134">Il parametro *lpwszUrl* contiene l'URL a cui viene inviata la richiesta e il parametro *pAutoProxyOptions* contiene un puntatore alla struttura ([**\_ \_ Opzioni del proxy AutoProxy WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_autoproxy_options)) che contiene le opzioni del proxy AutoProxy.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-134">The *lpwszUrl* parameter contains the URL that the request is being sent to, and the *pAutoProxyOptions* parameter contains a pointer to the structure ([**WINHTTP\_AUTOPROXY\_OPTIONS**](/windows/win32/api/winhttp/ns-winhttp-winhttp_autoproxy_options)) that contains the autoproxy options.</span></span> <span data-ttu-id="b8e6a-135">L'applicazione Inizializza la struttura delle **\_ \_ Opzioni del proxy AutoProxy WinHTTP** con le impostazioni restituite dalla struttura di [**configurazione del \_ \_ \_ \_ proxy \_ di Internet Explorer dell'utente corrente WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) nella chiamata a [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span><span class="sxs-lookup"><span data-stu-id="b8e6a-135">The application initializes the **WINHTTP\_AUTOPROXY\_OPTIONS** structure with the settings returned from the [**WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG**](/windows/win32/api/winhttp/ns-winhttp-winhttp_current_user_ie_proxy_config) structure in the call to [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser).</span></span> <span data-ttu-id="b8e6a-136">Il **flag \_ \_ \_ URL di configurazione AutoProxy WinHTTP** viene specificato nel **membro DWFLAGS** della struttura **delle \_ \_ Opzioni del proxy automatico WinHTTP** e il membro **lpszAutoconfigUrl** contiene l'URL di configurazione automatica del proxy dalla struttura di configurazione del **\_ \_ \_ \_ proxy \_ di Internet Explorer dell'utente corrente WinHTTP** .</span><span class="sxs-lookup"><span data-stu-id="b8e6a-136">The **WINHTTP\_AUTOPROXY\_CONFIG\_URL** flag is specified in the **dwFlags** member of the **WINHTTP\_AUTOPROXY\_OPTIONS** structure, and the **lpszAutoconfigUrl** member contains the proxy auto-configuration URL from the **WINHTTP\_CURRENT\_USER\_IE\_PROXY\_CONFIG** structure.</span></span> <span data-ttu-id="b8e6a-137">La funzione **WinHttpGetProxyForUrl** restituisce il nome del proxy e l'elenco proxy bypass nei membri **lpszProxy** e **lpszProxyBypass** della struttura [**di \_ \_ informazioni del proxy WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) .</span><span class="sxs-lookup"><span data-stu-id="b8e6a-137">The **WinHttpGetProxyForUrl** function returns the proxy name and the proxy bypass list in the **lpszProxy** and **lpszProxyBypass** members of the [**WINHTTP\_PROXY\_INFO**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) structure.</span></span>

<span data-ttu-id="b8e6a-138">Dopo che il proxy per la richiesta è stato ottenuto da [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl), l'applicazione crea la richiesta con [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span><span class="sxs-lookup"><span data-stu-id="b8e6a-138">After the proxy for the request is obtained from [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl), the application creates the request with [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="b8e6a-139">Viene quindi chiamato [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) per impostare il proxy per la richiesta specificando l'handle di richiesta nel parametro *HINTERNET* .</span><span class="sxs-lookup"><span data-stu-id="b8e6a-139">Then [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) is called to set the proxy for the request by specifying the request handle in the *hInternet* parameter.</span></span> <span data-ttu-id="b8e6a-140">Il parametro *dwOption* nella chiamata a **WinHttpSetOption** deve essere impostato sul **\_ \_ proxy di opzione WinHTTP** e il parametro *lpBuffer* è un puntatore a una struttura di [**\_ \_ informazioni proxy WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) che contiene il proxy e il bypass del proxy da usare per la richiesta.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-140">The *dwOption* parameter in the call to **WinHttpSetOption** should be set to **WINHTTP\_OPTION\_PROXY** and the *lpBuffer* parameter is a pointer to a [**WINHTTP\_PROXY\_INFO**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) structure that contains the proxy and proxy bypass to be used for the request.</span></span>

## <a name="automatic-proxy-configuration-is-not-used"></a><span data-ttu-id="b8e6a-141">La configurazione automatica del proxy non viene utilizzata</span><span class="sxs-lookup"><span data-stu-id="b8e6a-141">Automatic Proxy Configuration Is Not Used</span></span>

<span data-ttu-id="b8e6a-142">Se la chiamata a [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) indica che non viene usato AutoProxy, l'applicazione può semplicemente creare la richiesta con [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span><span class="sxs-lookup"><span data-stu-id="b8e6a-142">If the call to [**WinHttpGetIEProxyConfigForCurrentUser**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetieproxyconfigforcurrentuser) indicates that autoproxy is not used, the application can simply create the request with [**WinHttpOpenRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpopenrequest).</span></span> <span data-ttu-id="b8e6a-143">La configurazione del proxy è la stessa per l'intera sessione e le modifiche per richiesta non sono necessarie.</span><span class="sxs-lookup"><span data-stu-id="b8e6a-143">The proxy configuration is the same for the entire session, and per-request changes are not needed.</span></span>

 

 



