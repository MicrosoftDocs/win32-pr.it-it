---
description: Gestione dei cookie in WinHTTP
ms.assetid: ef0f0847-05f6-4477-8e48-e0bea66314ab
title: Gestione dei cookie in WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8e3b596225dc3c741ab9ed0139a63e343e7afb3d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106319817"
---
# <a name="cookie-handling-in-winhttp"></a><span data-ttu-id="5e53d-103">Gestione dei cookie in WinHTTP</span><span class="sxs-lookup"><span data-stu-id="5e53d-103">Cookie Handling in WinHTTP</span></span>

<span data-ttu-id="5e53d-104">I dati della sessione HTTP vengono passati tra il client e il server nell'intestazione del cookie della richiesta o della risposta.</span><span class="sxs-lookup"><span data-stu-id="5e53d-104">HTTP session data is passed between the client and server in the cookie header of the request or the response.</span></span> <span data-ttu-id="5e53d-105">Il server invia i cookie al client nell'intestazione set-cookie della risposta e l'API WinHTTP invia nuovamente il cookie del server al server nell'intestazione del cookie della richiesta.</span><span class="sxs-lookup"><span data-stu-id="5e53d-105">The server sends cookies to the client in the Set-cookie header of the response and the WinHTTP API resends the server cookie to the server in the cookie header of the request.</span></span> <span data-ttu-id="5e53d-106">Le specifiche di gestione dei cookie, descritte in RFC 2109 (HTTP State Management Mechanism), vengono implementate per impostazione predefinita in WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="5e53d-106">The cookie handling specifications, described in rfc 2109 (HTTP State Management Mechanism), are implemented by default in WinHTTP.</span></span> <span data-ttu-id="5e53d-107">Le specifiche di gestione dei cookie recenti, descritte in RFC 2964, non sono supportate da WinHTTP.</span><span class="sxs-lookup"><span data-stu-id="5e53d-107">Recent cookie handling specifications, described in rfc 2964, are not supported by WinHTTP.</span></span>

<span data-ttu-id="5e53d-108">WinHTTP ottiene il cookie dall'intestazione Server Set-Cookie e lo archivia in una cache per ogni singola sessione.</span><span class="sxs-lookup"><span data-stu-id="5e53d-108">WinHTTP obtains the cookie from the servers Set-Cookie header and stores it in a cache on a per-session basis.</span></span> <span data-ttu-id="5e53d-109">Questo cookie viene inviato nuovamente alle richieste successive nella stessa sessione WinHTTP in cui la destinazione corrisponde all'origine del cookie.</span><span class="sxs-lookup"><span data-stu-id="5e53d-109">This cookie is resent on subsequent requests in the same WinHTTP session where the target matches the source of the cookie.</span></span> <span data-ttu-id="5e53d-110">L'API WinHTTP rigenera l'intestazione del cookie di richiesta per ogni tappa della richiesta.</span><span class="sxs-lookup"><span data-stu-id="5e53d-110">The WinHTTP API regenerates the request cookie header for each leg in the request.</span></span>

<span data-ttu-id="5e53d-111">L'elenco seguente descrive diverse opzioni che le applicazioni client WinHTTP possono usare per gestire i cookie:</span><span class="sxs-lookup"><span data-stu-id="5e53d-111">The follow list describes several options that WinHTTP client applications can use to handle cookies:</span></span>

-   <span data-ttu-id="5e53d-112">Gestione automatica dei cookie: WinHTTP gestisce automaticamente i cookie e l'applicazione client non esegue alcuna gestione personalizzata dei cookie.</span><span class="sxs-lookup"><span data-stu-id="5e53d-112">Automatic Cookie Handling - WinHTTP automatically handles cookies and the client application performs no custom cookie handling.</span></span>
-   <span data-ttu-id="5e53d-113">Disabilita gestione automatica dei cookie: la gestione automatica dei cookie nell'API WinHTTP è disabilitata e non vengono inviati cookie.</span><span class="sxs-lookup"><span data-stu-id="5e53d-113">Disable Automatic Cookie Handling - Automatic cookie handling in the WinHTTP API is disabled and no cookies are sent.</span></span>
-   <span data-ttu-id="5e53d-114">Specificare manualmente tutti i cookie: la gestione automatica dei cookie è disabilitata e l'applicazione client aggiunge o rimuove tutte le intestazioni dei cookie per ogni richiesta nella sessione.</span><span class="sxs-lookup"><span data-stu-id="5e53d-114">Manually specify all Cookies – Automatic cookie handling is disabled and the client application adds or removes all cookie headers for each request in the session.</span></span>
-   <span data-ttu-id="5e53d-115">Gestione automatica dei cookie: combinare la gestione automatica e manuale dei cookie.</span><span class="sxs-lookup"><span data-stu-id="5e53d-115">Manual and Automatic Cookie Handling - Combine automatic and manual cookie handling.</span></span>

## <a name="disabling-automatic-cookie-handling"></a><span data-ttu-id="5e53d-116">Disabilitazione della gestione automatica dei cookie</span><span class="sxs-lookup"><span data-stu-id="5e53d-116">Disabling Automatic Cookie Handling</span></span>

<span data-ttu-id="5e53d-117">Per disabilitare la gestione dei cookie, l'applicazione client WinHTTP chiama la funzione [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) con il parametro *DWOPTION* impostato su WinHTTP \_ opzione \_ Disabilita \_ funzionalità e il parametro *lpBuffer* impostato su WinHTTP \_ disabilitare \_ cookie.</span><span class="sxs-lookup"><span data-stu-id="5e53d-117">To disable cookie handling, the WinHTTP client application calls the [**WinHttpSetOption**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetoption) function with the *dwOption* parameter set to WINHTTP\_OPTION\_DISABLE\_FEATURE, and the *lpBuffer* parameter set to WINHTTP\_DISABLE\_COOKIES.</span></span> <span data-ttu-id="5e53d-118">Il parametro *HINTERNET* può essere un handle di sessione o un handle di richiesta.</span><span class="sxs-lookup"><span data-stu-id="5e53d-118">The *hInternet* parameter can be either a session handle or a request handle.</span></span> <span data-ttu-id="5e53d-119">Quando la gestione dei cookie è disabilitata su un handle di richiesta che ha inviato una richiesta precedente, il client deve rimuovere manualmente le intestazioni dei cookie di richiesta esistenti con la funzione [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) prima di inviare la richiesta successiva.</span><span class="sxs-lookup"><span data-stu-id="5e53d-119">When cookie handling is disabled on a request handle that has sent a previous request, the client should manually remove existing request cookie headers with the [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) function before sending the next request.</span></span> <span data-ttu-id="5e53d-120">Per ulteriori informazioni, vedere [rimozione delle intestazioni dei cookie](#removing-cookie-headers).</span><span class="sxs-lookup"><span data-stu-id="5e53d-120">For more information, see [Removing Cookie Headers](#removing-cookie-headers).</span></span>

<span data-ttu-id="5e53d-121">**Nota**  L'applicazione client deve impostare tutti i cookie della sessione dopo la disabilitazione della modalità automatica.</span><span class="sxs-lookup"><span data-stu-id="5e53d-121">**Note**  The client application must set all cookies on the session after automatic mode has been disabled.</span></span>

## <a name="manually-specifying-all-cookies"></a><span data-ttu-id="5e53d-122">Specifica manuale di tutti i cookie</span><span class="sxs-lookup"><span data-stu-id="5e53d-122">Manually Specifying All Cookies</span></span>

<span data-ttu-id="5e53d-123">Quando la gestione automatica dei cookie è disabilitata, l'applicazione client WinHTTP dispone dell'opzione per specificare manualmente tutti i cookie.</span><span class="sxs-lookup"><span data-stu-id="5e53d-123">When automatic cookie handling is disabled, the WinHTTP client application has the option to manually specify all cookies.</span></span> <span data-ttu-id="5e53d-124">Per impostare manualmente il cookie, l'applicazione chiama [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) specificando l'intestazione del cookie nel parametro *pwszHeaders* .</span><span class="sxs-lookup"><span data-stu-id="5e53d-124">To manually set the cookie, the application calls [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) specifying the cookie header in the *pwszHeaders* parameter.</span></span> <span data-ttu-id="5e53d-125">L'applicazione client deve cancellare tutte le intestazioni dei cookie prima di inviare di nuovo la richiesta.</span><span class="sxs-lookup"><span data-stu-id="5e53d-125">The client application should clear all cookie headers before resending the request.</span></span>

<span data-ttu-id="5e53d-126">L'applicazione client deve anche modificare l'intestazione del cookie quando la richiesta è stata reindirizzata.</span><span class="sxs-lookup"><span data-stu-id="5e53d-126">The client application should also change the cookie header when the request has been redirected.</span></span> <span data-ttu-id="5e53d-127">Per modificare il cookie sulle richieste reindirizzate, il client specifica una funzione di callback con [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) che risponde al caso di callback di reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="5e53d-127">To change the cookie on redirected requests, the client specifies a callback function with [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) that responds to the redirect callback case.</span></span> <span data-ttu-id="5e53d-128">Il gestore di callback deve cancellare il cookie inviato in precedenza sulla richiesta chiamando [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span><span class="sxs-lookup"><span data-stu-id="5e53d-128">The callback handler should clear the cookie previously sent on the request by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span></span> <span data-ttu-id="5e53d-129">Per ulteriori informazioni sulla rimozione delle intestazioni dei cookie, vedere [rimozione delle intestazioni dei cookie](#removing-cookie-headers).</span><span class="sxs-lookup"><span data-stu-id="5e53d-129">For more information about removing cookie headers, see [Removing Cookie Headers](#removing-cookie-headers).</span></span>

## <a name="manual-and-automatic-cookie-handling"></a><span data-ttu-id="5e53d-130">Gestione manuale e automatica dei cookie</span><span class="sxs-lookup"><span data-stu-id="5e53d-130">Manual and Automatic Cookie Handling</span></span>

<span data-ttu-id="5e53d-131">Le applicazioni client WinHTTP possono combinare il meccanismo di gestione automatica dei cookie WinHTTP con la gestione manuale dei cookie.</span><span class="sxs-lookup"><span data-stu-id="5e53d-131">WinHTTP client applications can combine the WinHTTP automatic cookie handling mechanism with manual cookie handling.</span></span> <span data-ttu-id="5e53d-132">L'applicazione aggiunge cookie personalizzati all'intestazione del cookie generata automaticamente prima di inviare la richiesta con la funzione [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) .</span><span class="sxs-lookup"><span data-stu-id="5e53d-132">The application adds custom cookies to the automatically generated cookie header before sending the request with the [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) function.</span></span> <span data-ttu-id="5e53d-133">Il cookie personalizzato deve essere la prima intestazione del cookie nella richiesta per l'API WinHTTP per memorizzare correttamente il cookie nella cache.</span><span class="sxs-lookup"><span data-stu-id="5e53d-133">The custom cookie should be the first cookie header in the request for the WinHTTP API to properly cache the cookie.</span></span> <span data-ttu-id="5e53d-134">L'applicazione client deve anche rimuovere i cookie inviati alle richieste precedenti prima di inviare nuovamente una richiesta sullo stesso handle di richiesta.</span><span class="sxs-lookup"><span data-stu-id="5e53d-134">The client application should also remove cookies sent on previous requests before resending a request on the same request handle.</span></span> <span data-ttu-id="5e53d-135">Per ulteriori informazioni, vedere Rimozione delle intestazioni dei cookie.</span><span class="sxs-lookup"><span data-stu-id="5e53d-135">For more information, see Removing Cookie Headers.</span></span>

<span data-ttu-id="5e53d-136">I cookie aggiunti a una richiesta prima della chiamata a [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) sono inclusi in tutte le richieste WinHTTP inviate per conto delle successive chiamate **WinHttpSendRequest** e [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) .</span><span class="sxs-lookup"><span data-stu-id="5e53d-136">Cookies added to a request before the call to [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest) are included in all WinHTTP requests sent on behalf of the next **WinHttpSendRequest** and [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) calls.</span></span> <span data-ttu-id="5e53d-137">È possibile che l'applicazione client elimini l'intestazione del cookie quando la richiesta è stata reindirizzata.</span><span class="sxs-lookup"><span data-stu-id="5e53d-137">The client application may need to clear the cookie header when the request has been redirected.</span></span> <span data-ttu-id="5e53d-138">Per cancellare il cookie sulle richieste reindirizzate, il client specifica una funzione di callback con [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) che risponde al caso di callback di reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="5e53d-138">To clear the cookie on redirected requests, the client specifies a callback function with [**WinHttpSetStatusCallback**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsetstatuscallback) that responds to the redirect callback case.</span></span> <span data-ttu-id="5e53d-139">Il gestore di callback deve cancellare il cookie inviato in precedenza sulla richiesta chiamando [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span><span class="sxs-lookup"><span data-stu-id="5e53d-139">The callback handler should clear the cookie that was previously sent on the request by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders).</span></span> <span data-ttu-id="5e53d-140">La funzione di callback non può impostare nuovi cookie personalizzati nel callback di reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="5e53d-140">The callback function may not set new custom cookies on the redirect callback.</span></span> <span data-ttu-id="5e53d-141">Il client deve attendere il completamento di **WinHttpReceiveResponse** prima di aggiungere nuovi cookie per la chiamata **WinHttpSendRequest** successiva.</span><span class="sxs-lookup"><span data-stu-id="5e53d-141">The client must wait for **WinHttpReceiveResponse** to complete before adding new cookies for the next **WinHttpSendRequest** call.</span></span>

## <a name="removing-cookie-headers"></a><span data-ttu-id="5e53d-142">Rimozione delle intestazioni cookie</span><span class="sxs-lookup"><span data-stu-id="5e53d-142">Removing Cookie Headers</span></span>

<span data-ttu-id="5e53d-143">È possibile che l'applicazione client WinHTTP debba cancellare il cookie di richiesta esistente prima di inviare nuovamente una richiesta per impedire che i cookie inviati alle richieste precedenti vengano inviati nuovamente alla richiesta corrente. Per ulteriori informazioni, vedere la nota seguente.</span><span class="sxs-lookup"><span data-stu-id="5e53d-143">The WinHTTP client application may need to clear the existing request cookie before resending a request to prevent cookies that were sent on previous requests from being sent again on the current request; for more information, see the following Note.</span></span> <span data-ttu-id="5e53d-144">Tenere inoltre presente che i cookie non devono essere cancellati prima che la prima richiesta venga inviata sull'handle della richiesta.</span><span class="sxs-lookup"><span data-stu-id="5e53d-144">Also be aware that Cookies do not have to be cleared before the first request is sent on the request handle.</span></span> <span data-ttu-id="5e53d-145">Il client può cancellare i cookie esistenti chiamando [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) con un'intestazione cookie vuota nel parametro *pwszHeaders* e il flag \_ \_ di sostituzione del flag ADDREQ WinHTTP \_ impostato nel parametro *dwModifier* .</span><span class="sxs-lookup"><span data-stu-id="5e53d-145">The client can clear existing cookies by calling [**WinHttpAddRequestHeaders**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpaddrequestheaders) with an empty cookie header in the *pwszHeaders* parameter and the WINHTTP\_ADDREQ\_FLAG\_REPLACE flag set in the *dwModifier* parameter.</span></span> <span data-ttu-id="5e53d-146">Nell'esempio di codice seguente viene illustrato come cancellare l'intestazione del cookie nella richiesta.</span><span class="sxs-lookup"><span data-stu-id="5e53d-146">The following code example shows how to clear the cookie header on the request.</span></span>

``` syntax
WinHttpAddRequestHeaders( hRequest, 
                          L"Cookie:", 
                          -1, 
                          WINHTTP_ADDREQ_FLAG_REPLACE);
```

<span data-ttu-id="5e53d-147">L'API WinHTTP presenta diversi comportamenti di gestione dei cookie per le versioni del sistema operativo precedenti a Windows XP con Service Pack 2 (SP2) e Windows Server 2003 con Service Pack 1 (SP1).</span><span class="sxs-lookup"><span data-stu-id="5e53d-147">The WinHTTP API has different cookie handling behaviors for versions of the operating system earlier than Windows XP with Service Pack 2 (SP2) and Windows Server 2003 with Service Pack 1 (SP1).</span></span>

<span data-ttu-id="5e53d-148">\* \* Windows XP con SP2 e versioni successive e Windows Server 2003 con SP1 e versioni successive: \* \*</span><span class="sxs-lookup"><span data-stu-id="5e53d-148">\*\*Windows XP with SP2 and later and Windows Server 2003 with SP1 and later:  \*\*</span></span>

<span data-ttu-id="5e53d-149">L'API WinHTTP Cancella tutti i cookie inviati alle richieste precedenti per l'handle della richiesta.</span><span class="sxs-lookup"><span data-stu-id="5e53d-149">The WinHTTP API clears all cookies sent on previous requests for the request handle.</span></span> <span data-ttu-id="5e53d-150">Il client può aggiungere manualmente nuove intestazioni dei cookie prima di ogni chiamata a WinHttpSendRequest.</span><span class="sxs-lookup"><span data-stu-id="5e53d-150">The client can manually add new cookie headers before each call to WinHttpSendRequest.</span></span> <span data-ttu-id="5e53d-151">Se la funzionalità di gestione automatica dei cookie dell'API WinHTTP non è stata disabilitata, l'API WinHTTP aggiungerà l'intestazione del nuovo cookie (o aggiungerà una nuova intestazione del cookie se l'applicazione client non è stata aggiunta manualmente) al cookie dal server.</span><span class="sxs-lookup"><span data-stu-id="5e53d-151">If the automatic cookie handling functionality of the WinHTTP API has not been disabled, the WinHTTP API will append the new cookie header (or add a new cookie header if the client application did not add one manually) with the cookie from the server.</span></span>

<span data-ttu-id="5e53d-152">\* \* Windows XP con SP2 e Windows Server 2003 con SP1: \* \*</span><span class="sxs-lookup"><span data-stu-id="5e53d-152">\*\*Windows XP with SP2 and Windows Server 2003 with SP1:  \*\*</span></span>

<span data-ttu-id="5e53d-153">L'API WinHTTP non cancella l'intestazione del cookie di richiesta dopo il completamento di [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) .</span><span class="sxs-lookup"><span data-stu-id="5e53d-153">The WinHTTP API does not clear the request cookie header after [**WinHttpReceiveResponse**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpreceiveresponse) completes.</span></span> <span data-ttu-id="5e53d-154">I cookie inviati nelle richieste precedenti verranno inviati nuovamente in chiamate successive a [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest).</span><span class="sxs-lookup"><span data-stu-id="5e53d-154">Cookies sent in previous requests will be resent in subsequent calls to [**WinHttpSendRequest**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpsendrequest).</span></span> <span data-ttu-id="5e53d-155">L'applicazione client WinHTTP deve cancellare le intestazioni dei cookie esistenti prima di inviare nuovamente una richiesta nell'handle di richiesta.</span><span class="sxs-lookup"><span data-stu-id="5e53d-155">The WinHTTP client application should clear existing cookies headers before resending a request on the request handle.</span></span>

 

 



