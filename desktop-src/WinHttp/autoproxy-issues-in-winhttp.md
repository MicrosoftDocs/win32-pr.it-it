---
description: Quando si usa la funzionalità di AutoProxy WinHTTP, tenere presenti i seguenti problemi importanti.
ms.assetid: 9bae89b7-8f54-42ec-a240-998c97e26d25
title: Problemi di proxy AutoProxy in WinHTTP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 22c6edbf56ec1ffc4dfac930a5d4858429cc6447
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "104233118"
---
# <a name="autoproxy-issues-in-winhttp"></a><span data-ttu-id="10c19-103">Problemi di proxy AutoProxy in WinHTTP</span><span class="sxs-lookup"><span data-stu-id="10c19-103">AutoProxy Issues in WinHTTP</span></span>

<span data-ttu-id="10c19-104">Quando si usa la funzionalità di AutoProxy WinHTTP, tenere presenti i seguenti problemi importanti.</span><span class="sxs-lookup"><span data-stu-id="10c19-104">Consider the following important issues when using the WinHTTP autoproxy feature.</span></span>

## <a name="only-one-proxy-server-is-currently-supported"></a><span data-ttu-id="10c19-105">Attualmente è supportato un solo server proxy</span><span class="sxs-lookup"><span data-stu-id="10c19-105">Only One Proxy Server is Currently Supported</span></span>

<span data-ttu-id="10c19-106">WinHTTP attualmente non supporta le configurazioni proxy che specificano più di un server proxy.</span><span class="sxs-lookup"><span data-stu-id="10c19-106">WinHTTP does not currently support proxy configurations that specify more than one proxy server.</span></span> <span data-ttu-id="10c19-107">Se [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) restituisce una struttura di [**\_ \_ informazioni proxy WinHTTP**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) contenente un elenco di server proxy, che l'applicazione imposta quindi sull'handle di richiesta utilizzando l'opzione del **\_ \_ proxy di opzione WinHTTP** , WinHTTP utilizzerà solo il primo server proxy nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="10c19-107">If [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) returns a [**WINHTTP\_PROXY\_INFO**](/windows/win32/api/winhttp/ns-winhttp-winhttp_proxy_info) structure that contains a list of proxy servers, which the application then sets on the request handle using the **WINHTTP\_OPTION\_PROXY** option, WinHTTP uses only the first proxy server in the list.</span></span> <span data-ttu-id="10c19-108">Se il server proxy non è accessibile, WinHTTP non esegue il failover su nessuno degli altri server proxy presenti nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="10c19-108">If that proxy server is not accessible, WinHTTP does not failover to any of the other proxy servers in the list.</span></span> <span data-ttu-id="10c19-109">È necessario che l'applicazione gestisca questa situazione impostando di nuovo l'opzione del **\_ \_ proxy dell'opzione WinHTTP** con il server proxy successivo nell'elenco e inviando nuovamente la richiesta.</span><span class="sxs-lookup"><span data-stu-id="10c19-109">It is up to the application to handle this case by setting the **WINHTTP\_OPTION\_PROXY** option again with the next proxy server in the list, and resending the request.</span></span>

## <a name="security-risk-mitigation"></a><span data-ttu-id="10c19-110">Mitigazione dei rischi di sicurezza</span><span class="sxs-lookup"><span data-stu-id="10c19-110">Security Risk Mitigation</span></span>

<span data-ttu-id="10c19-111">Per elaborare il file di configurazione automatica del proxy è necessario eseguire il codice dello script scaricato.</span><span class="sxs-lookup"><span data-stu-id="10c19-111">Processing the proxy auto-configuration file requires executing downloaded script code.</span></span> <span data-ttu-id="10c19-112">Considerazioni sulla sicurezza: se il server in cui risiede il file PAC è stato compromesso, è possibile che il codice di script PAC sia dannoso.</span><span class="sxs-lookup"><span data-stu-id="10c19-112">Some security concerns to consider: If the server on which the PAC file resides has been compromised, it is possible the PAC script code is malicious.</span></span> <span data-ttu-id="10c19-113">Di conseguenza, WinHTTP usa le precauzioni seguenti per proteggere il client:</span><span class="sxs-lookup"><span data-stu-id="10c19-113">Therefore, WinHTTP uses the following precautions to protect the client:</span></span>

1.  <span data-ttu-id="10c19-114">Il codice di script non è in grado di creare un'istanza di oggetti ActiveX.</span><span class="sxs-lookup"><span data-stu-id="10c19-114">The script code is prevented from instantiating any ActiveX objects.</span></span> <span data-ttu-id="10c19-115">Questo consente di bloccare numerose funzionalità potenzialmente pericolose, ad esempio la possibilità di accedere ai file e di eseguire operazioni di I/O di rete.</span><span class="sxs-lookup"><span data-stu-id="10c19-115">This blocks a lot of potentially dangerous functionality, such as the ability to access files and to perform network I/O.</span></span>
2.  <span data-ttu-id="10c19-116">\* \* Windows Server 2003: \* \*[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) delega l'intera elaborazione WPAD a un servizio esterno al processo esterno, il servizio di individuazione automatica proxy Web WinHTTP, che viene eseguito con l'account utente predefinito servizio locale con privilegi limitati.</span><span class="sxs-lookup"><span data-stu-id="10c19-116">\*\*Windows Server 2003:  \*\*[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) delegates the entire WPAD processing to an external out-of-process service, the WinHTTP Web Proxy Auto-Discovery service, which runs under the low-privileged Local Service built-in user account.</span></span>

3.  <span data-ttu-id="10c19-117">**Windows XP con SP2 e Windows Server 2003:** Non è consentito eseguire uno script PAC per più di 60 secondi, dopo il quale l'esecuzione dello script viene terminata.</span><span class="sxs-lookup"><span data-stu-id="10c19-117">**Windows XP with SP2 and Windows Server 2003:** A PAC script is not permitted to execute for longer than 60 seconds, after which script execution is terminated.</span></span>

4.  <span data-ttu-id="10c19-118">**Windows XP con SP2 e Windows Server 2003:** WinHTTP rifiuta i file PAC di dimensioni superiori a 1 MB.</span><span class="sxs-lookup"><span data-stu-id="10c19-118">**Windows XP with SP2 and Windows Server 2003:** WinHTTP rejects PAC files larger than 1MB.</span></span> <span data-ttu-id="10c19-119">Un tipico file PAC è in genere di dimensioni non superiori a pochi kilobyte.</span><span class="sxs-lookup"><span data-stu-id="10c19-119">A typical PAC file is usually no more than a few kilobytes in size.</span></span>

<span data-ttu-id="10c19-120">Tenere presente che l'elaborazione del codice di script PAC richiede l'uso di COM, perché WinHTTP usa il componente Microsoft JScript per eseguire lo script.</span><span class="sxs-lookup"><span data-stu-id="10c19-120">Be aware that processing the PAC script code requires the use of COM, because WinHTTP uses Microsoft JScript component to execute the script.</span></span> <span data-ttu-id="10c19-121">Se WinHTTP non è in grado di delegare l'elaborazione del protocollo WPAD a un servizio di rilevamento automatico del proxy Web esterno al processo, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) carica il runtime com all'interno del processo dell'applicazione per la durata della chiamata.</span><span class="sxs-lookup"><span data-stu-id="10c19-121">If WinHTTP cannot delegate WPAD protocol processing to an external, out-of-process Web Proxy Auto-Discovery service, [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) loads the COM runtime within the application process for the duration of the call.</span></span> <span data-ttu-id="10c19-122">Se l'applicazione stessa usa già COM, questo non dovrebbe essere un problema.</span><span class="sxs-lookup"><span data-stu-id="10c19-122">If the application itself is already using COM, this should not be a concern.</span></span>

## <a name="performance-considerations"></a><span data-ttu-id="10c19-123">Considerazioni sulle prestazioni</span><span class="sxs-lookup"><span data-stu-id="10c19-123">Performance Considerations</span></span>

<span data-ttu-id="10c19-124">Il processo di rilevamento automatico può essere lento, probabilmente fino a pochi secondi.</span><span class="sxs-lookup"><span data-stu-id="10c19-124">The auto-detection process can be slow, possibly as long as several seconds.</span></span> <span data-ttu-id="10c19-125">Le funzioni [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) e [WinHttpDetectAutoProxyConfigUrl](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) sono bloccanti, funzioni sincrone.</span><span class="sxs-lookup"><span data-stu-id="10c19-125">The [**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) and [WinHttpDetectAutoProxyConfigUrl](/windows/desktop/api/Winhttp/nf-winhttp-winhttpdetectautoproxyconfigurl) functions are blocking, synchronous functions.</span></span> <span data-ttu-id="10c19-126">Potrebbe trattarsi di un meccanismo di rilevamento automatico specifico (ad esempio DHCP) molto più lento rispetto all'altro (ad esempio DNS).</span><span class="sxs-lookup"><span data-stu-id="10c19-126">It could be that one particular auto-detection mechanism (such as DHCP) is much slower than the other (such as DNS).</span></span> <span data-ttu-id="10c19-127">Se in entrambi i tipi di rilevamento automatico di WinHTTP sono specificati i flag di rilevamento automatico **\_ \_ \_ \_ DHCP** e WinHTTP, il protocollo WinHTTP USA prima DHCP, in conformità con la specifica WPAD. **\_ \_ \_ \_ \_**</span><span class="sxs-lookup"><span data-stu-id="10c19-127">If both the **WINHTTP\_AUTO\_DETECT\_TYPE\_DHCP** and **WINHTTP\_AUTO\_DETECT\_TYPE\_DNS\_A** auto-detection flags are specified, WinHTTP uses DHCP first, in accordance with the WPAD specification.</span></span> <span data-ttu-id="10c19-128">Se non viene individuato alcun URL PAC inviando una richiesta DHCP, WinHTTP tenta di individuare il file PAC in un indirizzo DNS noto.</span><span class="sxs-lookup"><span data-stu-id="10c19-128">If no PAC URL is discovered by issuing a DHCP request, then WinHTTP tries to locate the PAC file at a well-known DNS address.</span></span>

<span data-ttu-id="10c19-129">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) usa il parametro dell'handle di sessione WinHTTP per la memorizzazione nella cache del file PAC e i risultati del rilevamento automatico.</span><span class="sxs-lookup"><span data-stu-id="10c19-129">[**WinHttpGetProxyForUrl**](/windows/desktop/api/Winhttp/nf-winhttp-winhttpgetproxyforurl) uses the WinHTTP Session handle parameter for caching the PAC file and the results of auto-detection.</span></span> <span data-ttu-id="10c19-130">È preferibile usare lo stesso handle di sessione per più chiamate **WinHttpGetProxyForUrl** , se possibile, per evitare il rilevamento e il download di file di URL PAC ripetuti.</span><span class="sxs-lookup"><span data-stu-id="10c19-130">It is best to use the same session handle for multiple **WinHttpGetProxyForUrl** calls if possible to avoid repeated PAC URL detection and file downloading.</span></span> <span data-ttu-id="10c19-131">Il file PAC viene memorizzato nella cache solo in memoria e viene rimosso quando l'applicazione chiude l'handle di sessione.</span><span class="sxs-lookup"><span data-stu-id="10c19-131">The PAC file is cached in-memory only, and is discarded when the application closes the session handle.</span></span>

<span data-ttu-id="10c19-132">A causa dell'effetto sulle prestazioni di AutoProxy, è consigliabile usare la funzionalità solo per le applicazioni client desktop o per i servizi. le applicazioni basate su server devono basarsi sull'amministratore del server utilizzando l'utilità "ProxyCfg.exe".</span><span class="sxs-lookup"><span data-stu-id="10c19-132">Because of the performance impact of autoproxy, it is recommended that only desktop client applications or services use the feature; server-based applications should rely on the server administrator using the "ProxyCfg.exe" utility.</span></span>

 

 



