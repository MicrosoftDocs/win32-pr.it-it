---
description: Mostra la relazione tra i parametri di funzione che puntano a strutture o matrici e i relativi dati inizializzati.
ms.assetid: 89caf4d3-727f-472b-9a09-e81b4ff4d127
title: Procedura per la firma dei dati
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ba289928ab39c690e1c44bdbf65c77c18b7edab3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106312797"
---
# <a name="procedure-for-signing-data"></a><span data-ttu-id="16c61-103">Procedura per la firma dei dati</span><span class="sxs-lookup"><span data-stu-id="16c61-103">Procedure for Signing Data</span></span>

<span data-ttu-id="16c61-104">Una singola funzione, [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage), esegue tutte le attività elencate in [creazione di un messaggio firmato](creating-a-signed-message.md).</span><span class="sxs-lookup"><span data-stu-id="16c61-104">A single function, [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage), performs all of the tasks listed in [Creating a Signed Message](creating-a-signed-message.md).</span></span> <span data-ttu-id="16c61-105">Tuttavia, l'inizializzazione di strutture e altri dati è ancora necessaria.</span><span class="sxs-lookup"><span data-stu-id="16c61-105">However, initialization of structures and other data is still necessary.</span></span> <span data-ttu-id="16c61-106">Nella figura seguente viene illustrata la relazione tra i parametri di funzione che puntano a strutture o matrici e i relativi dati inizializzati.</span><span class="sxs-lookup"><span data-stu-id="16c61-106">The following illustration shows the relationship between those function parameters that point to structures or arrays and their initialized data.</span></span> <span data-ttu-id="16c61-107">Nell'illustrazione vengono mostrati solo i parametri di funzione e i membri della struttura derivati da altre strutture o funzioni.</span><span class="sxs-lookup"><span data-stu-id="16c61-107">The illustration shows only the function parameters and structure members that are derived from other structures or functions.</span></span> <span data-ttu-id="16c61-108">Gli altri parametri sono semplici inizializzazioni.</span><span class="sxs-lookup"><span data-stu-id="16c61-108">The rest of the parameters are straightforward initializations.</span></span>

![Mappa di inizializzazione per una chiamata a CryptSignMessage](images/crypsign.png)

<span data-ttu-id="16c61-110">**Per firmare i dati tramite CryptSignMessage**</span><span class="sxs-lookup"><span data-stu-id="16c61-110">**To sign data using CryptSignMessage**</span></span>

1.  <span data-ttu-id="16c61-111">Ottenere un puntatore ai dati che devono essere firmati.</span><span class="sxs-lookup"><span data-stu-id="16c61-111">Get a pointer to the data that is to be signed.</span></span>
2.  <span data-ttu-id="16c61-112">Assegnare il puntatore ai dati per indicizzare zero di una matrice "data da firmare".</span><span class="sxs-lookup"><span data-stu-id="16c61-112">Assign the pointer to the data to index zero of a "data to be signed" array.</span></span>
3.  <span data-ttu-id="16c61-113">Ottenere un handle per il provider del crittografico.</span><span class="sxs-lookup"><span data-stu-id="16c61-113">Get a handle to the cryptographic provider.</span></span>
4.  <span data-ttu-id="16c61-114">Aprire un [*archivio certificati*](../secgloss/c-gly.md) che contiene il certificato del firmatario.</span><span class="sxs-lookup"><span data-stu-id="16c61-114">Open a [*certificate store*](../secgloss/c-gly.md) that contains the signer's certificate.</span></span>
5.  <span data-ttu-id="16c61-115">Ottenere un indirizzo per il certificato del firmatario.</span><span class="sxs-lookup"><span data-stu-id="16c61-115">Get an address to the signer's certificate.</span></span>
6.  <span data-ttu-id="16c61-116">Assegnare l'indirizzo del certificato all'indice zero della matrice *MsgCert* .</span><span class="sxs-lookup"><span data-stu-id="16c61-116">Assign the address of the certificate to the zero index of the *MsgCert* array.</span></span>
7.  <span data-ttu-id="16c61-117">Assegnare gli indirizzi di tutti gli altri certificati da includere nel messaggio alla matrice *MsgCert* .</span><span class="sxs-lookup"><span data-stu-id="16c61-117">Assign the addresses of any other certificates to be included with the message to the *MsgCert* array.</span></span>
8.  <span data-ttu-id="16c61-118">Inizializzare la struttura dell' [**\_ \_ identificatore dell'algoritmo di crittografia**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) , inizializzando il membro **pszObjId** nell'algoritmo hash desiderato e gli altri membri in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="16c61-118">Initialize the [**CRYPT\_ALGORITHM\_IDENTIFIER**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) structure, initializing the **pszObjId** member to the desired hash algorithm and the other members as appropriate.</span></span>
9.  <span data-ttu-id="16c61-119">Inizializzare la struttura del messaggio di firma della crittografia, inizializzando il membro **pSigningCert** nell'indirizzo del certificato del firmatario, il membro della matrice **MsgCert** all'indirizzo del firmatario e altri certificati, il membro **HashAlgorithm** all'indirizzo della struttura dell' [**identificatore dell' \_ algoritmo \_ crypt**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) e gli altri membri in base alle esigenze. [**\_ \_ \_**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para)</span><span class="sxs-lookup"><span data-stu-id="16c61-119">Initialize the [**CRYPT\_SIGN\_MESSAGE\_PARA**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) structure, initializing the **pSigningCert** member to the address of the signer's certificate, the **MsgCert** array member to the address of the signer's and other's certificates, the **HashAlgorithm** member to the address of the [**CRYPT\_ALGORITHM\_IDENTIFIER**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_algorithm_identifier) structure, and the other members as appropriate.</span></span>
10. <span data-ttu-id="16c61-120">Chiamare la funzione [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage) , passando la struttura del [**\_ \_ messaggio \_ di firma del Crypt**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) per il parametro *pSignPara* , l'indirizzo della matrice "data da firmare" per il parametro *rgpbToBeSigned* , un indirizzo per il parametro di output *pbSignedBlob* e i valori per gli altri parametri nel modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="16c61-120">Call the [**CryptSignMessage**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptsignmessage) function, passing the [**CRYPT\_SIGN\_MESSAGE\_PARA**](/windows/desktop/api/Wincrypt/ns-wincrypt-crypt_sign_message_para) structure for the *pSignPara* parameter, the address of the "data to be signed" array for the *rgpbToBeSigned* parameter, an address for the *pbSignedBlob* output parameter, and values for the other parameters as appropriate.</span></span>

 

 
