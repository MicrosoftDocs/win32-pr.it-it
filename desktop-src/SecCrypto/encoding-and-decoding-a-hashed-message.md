---
description: Descrive le attività necessarie per codificare un messaggio con hash.
ms.assetid: c1a65452-c634-4cc6-9afe-d6bf11d999d1
title: Codifica e decodifica di un messaggio con hash
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d91d165634c1ae00a59f2c77b1fc5a36b53dbd96
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106316184"
---
# <a name="encoding-and-decoding-a-hashed-message"></a><span data-ttu-id="3c7b7-103">Codifica e decodifica di un messaggio con hash</span><span class="sxs-lookup"><span data-stu-id="3c7b7-103">Encoding and Decoding a Hashed Message</span></span>

<span data-ttu-id="3c7b7-104">I dati con hash sono costituiti da contenuto di qualsiasi tipo e da un [*hash*](../secgloss/h-gly.md) del contenuto.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-104">Hashed data consists of content of any type and a [*hash*](../secgloss/h-gly.md) of the content.</span></span> <span data-ttu-id="3c7b7-105">Può essere utilizzato quando è necessario solo confermare che il contenuto del messaggio non è stato modificato dopo la creazione dell'hash.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-105">It can be used when it is only necessary to confirm that the message content has not been modified since the hash was created.</span></span>

<span data-ttu-id="3c7b7-106">Quando si crea un messaggio con hash, possono essere presenti più algoritmi hash e più hash.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-106">When creating a hashed message, there can be multiple hash algorithms and multiple hashes.</span></span> <span data-ttu-id="3c7b7-107">Nella figura seguente sono illustrate le attività necessarie per codificare un messaggio con hash.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-107">The following illustration depicts the tasks required to encode a hashed message.</span></span> <span data-ttu-id="3c7b7-108">La procedura viene descritta nel testo che segue la figura.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-108">The procedure is described in the text that follows the illustration.</span></span>

![creazione di un messaggio con hash](images/hashmsg.png)

<span data-ttu-id="3c7b7-110">**Per creare un messaggio con hash**</span><span class="sxs-lookup"><span data-stu-id="3c7b7-110">**To create a hashed message**</span></span>

1.  <span data-ttu-id="3c7b7-111">Ottiene un puntatore ai dati di cui eseguire l'hashing.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-111">Get a pointer to the data to be hashed.</span></span>
2.  <span data-ttu-id="3c7b7-112">Selezionare l'algoritmo hash da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-112">Select the hash algorithm to be used.</span></span>
3.  <span data-ttu-id="3c7b7-113">Inserire i dati tramite una funzione di hashing usando l'algoritmo hash.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-113">Put the data through a hashing function using the hash algorithm.</span></span>
4.  <span data-ttu-id="3c7b7-114">Includere i dati originali per cui eseguire l'hashing, gli algoritmi hash e gli hash nel messaggio codificato.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-114">Include the original data to be hashed, the hashing algorithms, and the hashes in the encoded message.</span></span>

<span data-ttu-id="3c7b7-115">Per utilizzare le funzioni di messaggio di basso livello per completare le attività descritte, attenersi alla procedura riportata di seguito.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-115">To use low-level message functions to accomplish the tasks just outlined, use the following procedure.</span></span>

<span data-ttu-id="3c7b7-116">**Per eseguire l'hashing e codificare un messaggio utilizzando funzioni di messaggio di basso livello**</span><span class="sxs-lookup"><span data-stu-id="3c7b7-116">**To hash and encode a message using low-level message functions**</span></span>

1.  <span data-ttu-id="3c7b7-117">Consente di creare o recuperare il contenuto di cui eseguire l'hashing.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-117">Create or retrieve the content to be hashed.</span></span>
2.  <span data-ttu-id="3c7b7-118">Ottenere un provider di crittografia.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-118">Get a cryptographic provider.</span></span>
3.  <span data-ttu-id="3c7b7-119">Inizializza la struttura delle [**\_ informazioni di \_ codifica \_ con hash CMSG**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) .</span><span class="sxs-lookup"><span data-stu-id="3c7b7-119">Initialize the [**CMSG\_HASHED\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) structure.</span></span>
4.  <span data-ttu-id="3c7b7-120">Chiamare [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength) per ottenere la dimensione del BLOB del messaggio codificato.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-120">Call [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength) to get the size of the encoded message BLOB.</span></span> <span data-ttu-id="3c7b7-121">Allocare memoria per l'it.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-121">Allocate memory for it.</span></span>
5.  <span data-ttu-id="3c7b7-122">Chiamare [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passando CMSG con \_ hash per il parametro *dwMsgType* e un puntatore a [**CMSG \_ Hashed \_ Encode \_ info**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) per il parametro *pvMsgEncodeInfo* .</span><span class="sxs-lookup"><span data-stu-id="3c7b7-122">Call [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passing in CMSG\_HASHED for the *dwMsgType* parameter and a pointer to [**CMSG\_HASHED\_ENCODE\_INFO**](/windows/desktop/api/Wincrypt/ns-wincrypt-cmsg_hashed_encode_info) for the *pvMsgEncodeInfo* parameter.</span></span> <span data-ttu-id="3c7b7-123">In seguito a questa chiamata, si ottiene un handle per il messaggio aperto.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-123">As a result of this call, you get a handle to the opened message.</span></span>
6.  <span data-ttu-id="3c7b7-124">Chiamare [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate), passando l'handle recuperato nel passaggio 5 e un puntatore ai dati per i quali viene eseguito l'hashing e la codifica.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-124">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate), passing in the handle retrieved in step 5 and a pointer to the data that is to be hashed and encoded.</span></span> <span data-ttu-id="3c7b7-125">Questa funzione può essere chiamata il numero di volte necessario per completare il processo di codifica.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-125">This function can be called as many times as necessary to complete the encoding process.</span></span>
7.  <span data-ttu-id="3c7b7-126">Chiamare [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passando l'handle recuperato nel passaggio 5 e i tipi di parametro appropriati per accedere ai dati codificati desiderati.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-126">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passing in the handle retrieved in step 5 and the appropriate parameter types to access the desired, encoded data.</span></span> <span data-ttu-id="3c7b7-127">Ad esempio, passare CMSG \_ Content \_ param per ottenere un puntatore all'intero messaggio [*PKCS \# 7*](../secgloss/p-gly.md) .</span><span class="sxs-lookup"><span data-stu-id="3c7b7-127">For example, pass in CMSG\_CONTENT\_PARAM to get a pointer to the entire [*PKCS \#7*](../secgloss/p-gly.md) message.</span></span>

    <span data-ttu-id="3c7b7-128">Se il risultato di questa codifica deve essere usato come [*dati interni*](../secgloss/i-gly.md) per un altro messaggio codificato, ad esempio un messaggio in busta, è \_ \_ necessario passare il param di contenuto bare CMSG \_ .</span><span class="sxs-lookup"><span data-stu-id="3c7b7-128">If the result of this encoding is to be used as the [*inner data*](../secgloss/i-gly.md) for another encoded message, such as an enveloped message, CMSG\_BARE\_CONTENT\_PARAM must be passed.</span></span> <span data-ttu-id="3c7b7-129">Per un esempio che illustra questo problema, vedere [codice alternativo per la codifica di un messaggio in busta](alternate-code-for-encoding-an-enveloped-message.md)digitale.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-129">For an example showing this, see [Alternate Code for Encoding an Enveloped Message](alternate-code-for-encoding-an-enveloped-message.md).</span></span>

8.  <span data-ttu-id="3c7b7-130">Chiudere il messaggio chiamando [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span><span class="sxs-lookup"><span data-stu-id="3c7b7-130">Close the message by calling [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span></span>

<span data-ttu-id="3c7b7-131">Il risultato di questa procedura è un messaggio codificato che contiene i dati originali, gli algoritmi di hash e l' [*hash*](../secgloss/h-gly.md) di tali dati.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-131">The result of this procedure is an encoded message that contains the original data, the hashing algorithms, and the [*hash*](../secgloss/h-gly.md) of that data.</span></span> <span data-ttu-id="3c7b7-132">Un puntatore al [*BLOB*](../secgloss/b-gly.md) del messaggio codificato viene ottenuto nel passaggio 7.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-132">A pointer to the encoded message [*BLOB*](../secgloss/b-gly.md) is obtained in step 7.</span></span>

<span data-ttu-id="3c7b7-133">Le due procedure seguenti decodificano e quindi verificano i dati con hash.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-133">The following two procedures decode and then verify hashed data.</span></span>

<span data-ttu-id="3c7b7-134">**Per decodificare i dati con hash**</span><span class="sxs-lookup"><span data-stu-id="3c7b7-134">**To decode hashed data**</span></span>

1.  <span data-ttu-id="3c7b7-135">Ottenere un puntatore al BLOB codificato.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-135">Get a pointer to the encoded BLOB.</span></span>
2.  <span data-ttu-id="3c7b7-136">Chiamare [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passando gli argomenti necessari.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-136">Call [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passing the necessary arguments.</span></span>
3.  <span data-ttu-id="3c7b7-137">Chiamare [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) una volta, passando l'handle recuperato nel passaggio 2 e un puntatore ai dati che devono essere decodificati.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-137">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) once, passing in the handle retrieved in step 2 and a pointer to the data that is to be decoded.</span></span> <span data-ttu-id="3c7b7-138">In questo modo vengono eseguite le azioni appropriate per il messaggio, a seconda del tipo di messaggio.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-138">This causes the appropriate actions to be taken on the message, depending on the message type.</span></span>
4.  <span data-ttu-id="3c7b7-139">Chiamare [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passando l'handle recuperato nel passaggio 2 e i tipi di parametro appropriati per accedere ai dati desiderati e decodificati.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-139">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam), passing in the handle retrieved in step 2, and the appropriate parameter types to access the desired, decoded data.</span></span> <span data-ttu-id="3c7b7-140">Ad esempio, passare CMSG \_ Content \_ param per ottenere un puntatore al contenuto decodificato.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-140">For example, pass in CMSG\_CONTENT\_PARAM to get a pointer to the decoded content.</span></span>

<span data-ttu-id="3c7b7-141">**Per verificare l'hash**</span><span class="sxs-lookup"><span data-stu-id="3c7b7-141">**To verify the hash**</span></span>

1.  <span data-ttu-id="3c7b7-142">Chiamare [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passando CMSG \_ CTRL \_ Verify \_ hash per verificare gli hash.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-142">Call [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passing in CMSG\_CTRL\_VERIFY\_HASH to verify the hashes.</span></span>
2.  <span data-ttu-id="3c7b7-143">Chiamare [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) per chiudere il messaggio.</span><span class="sxs-lookup"><span data-stu-id="3c7b7-143">Call [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) to close the message.</span></span>

<span data-ttu-id="3c7b7-144">Per un programma di esempio, vedere [esempio di programma C: codifica e decodifica di un messaggio con hash](example-c-program-encoding-and-decoding-a-hashed-message.md).</span><span class="sxs-lookup"><span data-stu-id="3c7b7-144">For an example program, see [Example C Program: Encoding and Decoding a Hashed Message](example-c-program-encoding-and-decoding-a-hashed-message.md).</span></span>

 

 
