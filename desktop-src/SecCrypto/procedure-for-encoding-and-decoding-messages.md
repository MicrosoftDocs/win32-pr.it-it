---
description: Descrive la procedura per la codifica di un messaggio generale.
ms.assetid: 554cab0d-cfa2-46a7-80d9-f41430eb4b47
title: Procedura per la codifica e la decodifica dei messaggi
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 49da09c2318fffd3d1c92d6012055172709609a7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106310750"
---
# <a name="procedure-for-encoding-and-decoding-messages"></a><span data-ttu-id="959a5-103">Procedura per la codifica e la decodifica dei messaggi</span><span class="sxs-lookup"><span data-stu-id="959a5-103">Procedure for Encoding and Decoding Messages</span></span>

<span data-ttu-id="959a5-104">La procedura per la codifica di un messaggio generale è la seguente:</span><span class="sxs-lookup"><span data-stu-id="959a5-104">The procedure for encoding a general message is as follows.</span></span>

<span data-ttu-id="959a5-105">**Per codificare un messaggio**</span><span class="sxs-lookup"><span data-stu-id="959a5-105">**To encode a message**</span></span>

1.  <span data-ttu-id="959a5-106">Inizializzare le strutture di dati appropriate per il tipo di dati desiderato.</span><span class="sxs-lookup"><span data-stu-id="959a5-106">Initialize the appropriate data structures for the desired data type.</span></span>
2.  <span data-ttu-id="959a5-107">Chiamare [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passando gli argomenti necessari.</span><span class="sxs-lookup"><span data-stu-id="959a5-107">Call [**CryptMsgOpenToEncode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentoencode), passing the necessary arguments.</span></span> <span data-ttu-id="959a5-108">Quando si chiama **CryptMsgOpenToEncode**, se i dati da fornire a [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) sono già stati codificati come messaggi, passare l'identificatore di oggetto appropriato in *pszInnerContentObjID* (ad esempio, "1.2.840.113549.1.7.2" per szOID \_ RSA \_ SignedData).</span><span class="sxs-lookup"><span data-stu-id="959a5-108">When calling **CryptMsgOpenToEncode**, if the data that is to be provided to [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) has already been message-encoded, pass the appropriate object identifier in *pszInnerContentObjID* (for example, "1.2.840.113549.1.7.2" for szOID\_RSA\_signedData).</span></span> <span data-ttu-id="959a5-109">Se *pszInnerContentObjID* è **null**, si presuppone che il tipo di [*contenuto interno*](../secgloss/i-gly.md) non sia stato codificato in precedenza e venga elaborato in modo appropriato.</span><span class="sxs-lookup"><span data-stu-id="959a5-109">If *pszInnerContentObjID* is **NULL**, the [*inner content*](../secgloss/i-gly.md) type is assumed not to have been previously encoded and is processed appropriately.</span></span>
3.  <span data-ttu-id="959a5-110">Chiamare [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) il numero di volte necessario per completare il messaggio.</span><span class="sxs-lookup"><span data-stu-id="959a5-110">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) as many times as necessary to complete the message.</span></span> <span data-ttu-id="959a5-111">Nell'ultima chiamata, impostare il parametro *fFinal* su **true**.</span><span class="sxs-lookup"><span data-stu-id="959a5-111">On the last call, set the *fFinal* parameter to **TRUE**.</span></span> <span data-ttu-id="959a5-112">Per informazioni dettagliate, vedere **CryptMsgUpdate**.</span><span class="sxs-lookup"><span data-stu-id="959a5-112">(For details, see **CryptMsgUpdate**).</span></span>
4.  <span data-ttu-id="959a5-113">Chiamare [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) per ottenere un puntatore ai parametri desiderati, ad esempio il contenuto.</span><span class="sxs-lookup"><span data-stu-id="959a5-113">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) to get a pointer to the desired parameters, such as the content.</span></span> <span data-ttu-id="959a5-114">Per la codifica di dati generali semplici, usare \_ \_ il parametro di contenuto CMSG per *dwParamtype*.</span><span class="sxs-lookup"><span data-stu-id="959a5-114">For encoding simple, general data, use CMSG\_CONTENT\_PARAM for the *dwParamtype*.</span></span>
5.  <span data-ttu-id="959a5-115">Chiudere il messaggio chiamando [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span><span class="sxs-lookup"><span data-stu-id="959a5-115">Close the message by calling [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose).</span></span>

<span data-ttu-id="959a5-116">Questa procedura restituisce un messaggio codificato di un tipo specificato nelle chiamate di funzione.</span><span class="sxs-lookup"><span data-stu-id="959a5-116">This procedure results in an encoded message of a type specified in the function calls.</span></span>

<span data-ttu-id="959a5-117">Di seguito è riportata la procedura per la decodifica di un messaggio generale.</span><span class="sxs-lookup"><span data-stu-id="959a5-117">The procedure for decoding a general message is as follows.</span></span>

<span data-ttu-id="959a5-118">**Per decodificare un messaggio**</span><span class="sxs-lookup"><span data-stu-id="959a5-118">**To decode a message**</span></span>

1.  <span data-ttu-id="959a5-119">Determinare la lunghezza necessaria per il buffer per memorizzare i dati codificati utilizzando [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength).</span><span class="sxs-lookup"><span data-stu-id="959a5-119">Determine the length needed for the buffer to hold the encoded data using [**CryptMsgCalculateEncodedLength**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcalculateencodedlength).</span></span>
2.  <span data-ttu-id="959a5-120">Chiamare [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passando gli argomenti necessari.</span><span class="sxs-lookup"><span data-stu-id="959a5-120">Call [**CryptMsgOpenToDecode**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgopentodecode), passing the necessary arguments.</span></span> <span data-ttu-id="959a5-121">Per mantenere la compatibilità con Internet Explorer versione 3,0, viene fornito il parametro *dwMsgType* .</span><span class="sxs-lookup"><span data-stu-id="959a5-121">To maintain compatibility with Internet Explorer version 3.0, the *dwMsgType* parameter is provided.</span></span> <span data-ttu-id="959a5-122">I dati firmati creati in Internet Explorer 3,0 non contengono informazioni di intestazione.</span><span class="sxs-lookup"><span data-stu-id="959a5-122">Signed data created in Internet Explorer 3.0 does not contain header information.</span></span> <span data-ttu-id="959a5-123">Pertanto, se un messaggio di questo tipo viene estratto dalle firme del file, il tipo di messaggio deve essere passato nella funzione.</span><span class="sxs-lookup"><span data-stu-id="959a5-123">Therefore, if such a message is extracted from file signatures, the message type must be passed into the function.</span></span> <span data-ttu-id="959a5-124">Se viene passato zero al parametro *dwMsgType* , la funzione leggerà il tipo di messaggio dall'intestazione del messaggio.</span><span class="sxs-lookup"><span data-stu-id="959a5-124">If zero is passed into the *dwMsgType* parameter, the function will read the message type from the header on the message.</span></span> <span data-ttu-id="959a5-125">Se l'intestazione non è presente, la chiamata di funzione avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="959a5-125">If the header is missing, the function call will fail.</span></span> <span data-ttu-id="959a5-126">In caso di esito positivo, viene restituito un handle per il messaggio aperto.</span><span class="sxs-lookup"><span data-stu-id="959a5-126">If successful, a handle to the opened message is returned.</span></span>
3.  <span data-ttu-id="959a5-127">Chiamare [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) una volta.</span><span class="sxs-lookup"><span data-stu-id="959a5-127">Call [**CryptMsgUpdate**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgupdate) once.</span></span> <span data-ttu-id="959a5-128">In questo modo vengono eseguite le azioni appropriate per il messaggio, a seconda del tipo di messaggio.</span><span class="sxs-lookup"><span data-stu-id="959a5-128">This causes the appropriate actions to be taken on the message, depending on the message type.</span></span>
4.  <span data-ttu-id="959a5-129">Per un'ulteriore elaborazione del messaggio, ad esempio la decrittografia aggiuntiva o la verifica della firma, chiamare [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passando l'azione desiderata in *dwCtrlType*.</span><span class="sxs-lookup"><span data-stu-id="959a5-129">For additional processing of the message, such as additional decryption or signature verification, call [**CryptMsgControl**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgcontrol), passing the desired action in *dwCtrlType*.</span></span>
5.  <span data-ttu-id="959a5-130">Chiamare [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) per ottenere un puntatore ai parametri desiderati, ad esempio il contenuto.</span><span class="sxs-lookup"><span data-stu-id="959a5-130">Call [**CryptMsgGetParam**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsggetparam) to get a pointer to the desired parameters, such as the content.</span></span> <span data-ttu-id="959a5-131">Per decodificare i dati generali semplici, \_ usare \_ il parametro CMSG Content per il parametro *dwParamtype* .</span><span class="sxs-lookup"><span data-stu-id="959a5-131">To decode simple general data, use CMSG\_CONTENT\_PARAM for the *dwParamtype* parameter.</span></span>
6.  <span data-ttu-id="959a5-132">Chiamare [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) per chiudere il messaggio.</span><span class="sxs-lookup"><span data-stu-id="959a5-132">Call [**CryptMsgClose**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptmsgclose) to close the message.</span></span>

<span data-ttu-id="959a5-133">Per un esempio in cui vengono implementati questi passaggi, vedere il [programma C di esempio: codifica e decodifica dei dati](example-c-program-encoding-and-decoding-data.md).</span><span class="sxs-lookup"><span data-stu-id="959a5-133">For an example that implements these steps, see [Example C Program: Encoding and Decoding Data](example-c-program-encoding-and-decoding-data.md).</span></span> <span data-ttu-id="959a5-134">Per le procedure e un esempio che illustra il processo di codifica, decodifica e verifica della firma di un messaggio firmato, vedere il [programma C di esempio: firma, codifica, decodifica e verifica di un messaggio](example-c-program-signing-encoding-decoding-and-verifying-a-message.md).</span><span class="sxs-lookup"><span data-stu-id="959a5-134">For procedures and an example demonstrating the process of encoding, decoding, and verifying the signature of a signed message, see [Example C Program: Signing, Encoding, Decoding, and Verifying a Message](example-c-program-signing-encoding-decoding-and-verifying-a-message.md).</span></span>

 

 
