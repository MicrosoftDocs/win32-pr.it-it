---
description: Come è possibile utilizzare le funzioni di backup di Servizi certificati per eseguire il backup di un database di Servizi certificati e dei file associati.
ms.assetid: f5c9c9f9-5211-4151-b8e0-3351d462c71b
title: Backup di Servizi certificati
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d1be929fcf3bd9b8b9655b48758a97d19af7abc7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "103885450"
---
# <a name="backing-up-certificate-services"></a><span data-ttu-id="8cac2-103">Backup di Servizi certificati</span><span class="sxs-lookup"><span data-stu-id="8cac2-103">Backing Up Certificate Services</span></span>

<span data-ttu-id="8cac2-104">Di seguito è riportato uno scenario che illustra come è possibile utilizzare le funzioni di backup di Servizi certificati per eseguire il backup di un database di Servizi certificati e dei file associati.</span><span class="sxs-lookup"><span data-stu-id="8cac2-104">The following is a scenario showing how you can use the Certificate Services backup functions to back up a Certificate Services database and its associated files.</span></span>

1.  <span data-ttu-id="8cac2-105">Caricare la libreria Certadm.dll in memoria (chiamando [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)).</span><span class="sxs-lookup"><span data-stu-id="8cac2-105">Load the Certadm.dll library into memory (by calling [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)).</span></span>
2.  <span data-ttu-id="8cac2-106">Recuperare l'indirizzo di ognuna delle funzioni necessarie in Certadm.dll (tramite [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress)).</span><span class="sxs-lookup"><span data-stu-id="8cac2-106">Retrieve the address of each of the necessary functions in Certadm.dll (by means of [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress)).</span></span> <span data-ttu-id="8cac2-107">Usare questi indirizzi quando si chiamano le funzioni nei passaggi rimanenti.</span><span class="sxs-lookup"><span data-stu-id="8cac2-107">Use these addresses when calling the functions in the remaining steps.</span></span>
3.  <span data-ttu-id="8cac2-108">Chiamare [**CertSrvIsServerOnline**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvisserveronlinew) per determinare se Servizi certificati è online.</span><span class="sxs-lookup"><span data-stu-id="8cac2-108">Call [**CertSrvIsServerOnline**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvisserveronlinew) to determine whether Certificate Services is online.</span></span> <span data-ttu-id="8cac2-109">Per il corretto funzionamento delle operazioni di backup, i servizi certificati devono essere online.</span><span class="sxs-lookup"><span data-stu-id="8cac2-109">Certificate Services must be online for the backup operations to be successful.</span></span>
4.  <span data-ttu-id="8cac2-110">Chiamare [**CertSrvBackupPrepare**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackuppreparew) per avviare una sessione di backup.</span><span class="sxs-lookup"><span data-stu-id="8cac2-110">Call [**CertSrvBackupPrepare**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackuppreparew) to start a backup session.</span></span> <span data-ttu-id="8cac2-111">L'handle del contesto di backup di Servizi certificati risultante verrà utilizzato da molte altre funzioni di backup.</span><span class="sxs-lookup"><span data-stu-id="8cac2-111">The resulting Certificate Services backup context handle will be used by many of the other backup functions.</span></span>
5.  <span data-ttu-id="8cac2-112">Chiamare [**CertSrvRestoreGetDatabaseLocations**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvrestoregetdatabaselocationsw) per determinare la mappa di ripristino.</span><span class="sxs-lookup"><span data-stu-id="8cac2-112">Call [**CertSrvRestoreGetDatabaseLocations**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvrestoregetdatabaselocationsw) to determine the restore map.</span></span> <span data-ttu-id="8cac2-113">La mappa di ripristino contiene i percorsi da utilizzare durante il ripristino del backup.</span><span class="sxs-lookup"><span data-stu-id="8cac2-113">The restore map contains the paths to be used when restoring the backup.</span></span> <span data-ttu-id="8cac2-114">Salvare le informazioni recuperate da **CertSrvRestoreGetDatabaseLocations** in un percorso specifico dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="8cac2-114">Save the information retrieved by **CertSrvRestoreGetDatabaseLocations** to an application-specific location.</span></span>
6.  <span data-ttu-id="8cac2-115">Chiamare [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw) per determinare i nomi dei file di database di cui eseguire il backup.</span><span class="sxs-lookup"><span data-stu-id="8cac2-115">Call [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw) to determine the names of the database files to backup.</span></span> <span data-ttu-id="8cac2-116">Per ognuno di questi file, eseguire i passaggi da 7 a 9.</span><span class="sxs-lookup"><span data-stu-id="8cac2-116">For each of these files, execute steps 7 through 9.</span></span>
7.  <span data-ttu-id="8cac2-117">Chiamare [**CertSrvBackupOpenFile**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupopenfilew) per aprire il file per il backup.</span><span class="sxs-lookup"><span data-stu-id="8cac2-117">Call [**CertSrvBackupOpenFile**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupopenfilew) to open the file for backup.</span></span>
8.  <span data-ttu-id="8cac2-118">Chiamare [**CertSrvBackupRead**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupread) per leggere una parte di byte dal file, quindi chiamare una routine specifica dell'applicazione per archiviare i byte su un supporto di backup.</span><span class="sxs-lookup"><span data-stu-id="8cac2-118">Call [**CertSrvBackupRead**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupread) to read a portion of bytes from the file, then call an application-specific routine to store the bytes on a backup medium.</span></span> <span data-ttu-id="8cac2-119">Ripetere questo passaggio fino a quando non viene eseguito il backup di tutti i byte del file.</span><span class="sxs-lookup"><span data-stu-id="8cac2-119">Repeat this step until all of the bytes in the file are backed up.</span></span>
9.  <span data-ttu-id="8cac2-120">Chiamare [**CertSrvBackupClose**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupclose) per chiudere il file.</span><span class="sxs-lookup"><span data-stu-id="8cac2-120">Call [**CertSrvBackupClose**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupclose) to close the file.</span></span>
10. <span data-ttu-id="8cac2-121">Chiamare [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw) per determinare i nomi dei file di log di cui eseguire il backup.</span><span class="sxs-lookup"><span data-stu-id="8cac2-121">Call [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw) to determine the names of the log files to backup.</span></span> <span data-ttu-id="8cac2-122">Per ognuno di questi file, eseguire i passaggi da 7 a 9.</span><span class="sxs-lookup"><span data-stu-id="8cac2-122">For each of these files, execute steps 7 through 9.</span></span>
11. <span data-ttu-id="8cac2-123">Chiamare [**CertSrvBackupTruncateLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackuptruncatelogs) per troncare i file di log di cui è stato eseguito il backup nei passaggi 6 e 10.</span><span class="sxs-lookup"><span data-stu-id="8cac2-123">Call [**CertSrvBackupTruncateLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackuptruncatelogs) to truncate the log files which were backed up in steps 6 and 10.</span></span> <span data-ttu-id="8cac2-124">Questo passaggio è facoltativo. Tuttavia, chiamare **CertSrvBackupTruncateLogs** solo se è stato eseguito il backup di tutti i file restituiti da [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw) e [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw) . in caso contrario, l'operazione di ripristino avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="8cac2-124">This step is optional; however, call **CertSrvBackupTruncateLogs** only if all files returned by [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw) and [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw) have been backed up (otherwise, the restore operation will fail).</span></span> <span data-ttu-id="8cac2-125">Per informazioni dettagliate, vedere la pagina di riferimento di **CertSrvBackupTruncateLogs** .</span><span class="sxs-lookup"><span data-stu-id="8cac2-125">Consult the **CertSrvBackupTruncateLogs** reference page for details.</span></span>
12. <span data-ttu-id="8cac2-126">Chiamare [**CertSrvBackupGetDynamicFileList**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdynamicfilelistw) per determinare i nomi dei file non di database di cui eseguire il backup.</span><span class="sxs-lookup"><span data-stu-id="8cac2-126">Call [**CertSrvBackupGetDynamicFileList**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdynamicfilelistw) to determine the names of the non-database files to backup.</span></span> <span data-ttu-id="8cac2-127">Questi file sono identificati solo dalla funzione ed è necessario eseguirne il backup in altri modi.</span><span class="sxs-lookup"><span data-stu-id="8cac2-127">These files are only identified by the function, and must be backed up by some other means.</span></span>
13. <span data-ttu-id="8cac2-128">Eseguire il backup dei file dinamici identificati nel passaggio 12, usando le routine separate da Certadm.dll.</span><span class="sxs-lookup"><span data-stu-id="8cac2-128">Backup the dynamic files identified in step 12, using routines separate from Certadm.dll.</span></span>
14. <span data-ttu-id="8cac2-129">Chiamare [**CertSrvBackupEnd**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupend) per terminare la sessione di backup.</span><span class="sxs-lookup"><span data-stu-id="8cac2-129">Call [**CertSrvBackupEnd**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupend) to end the backup session.</span></span>
15. <span data-ttu-id="8cac2-130">Chiamare [**CertSrvBackupFree**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupfree) in base alle esigenze per rilasciare i buffer allocati da alcune funzioni di backup di Servizi certificati.</span><span class="sxs-lookup"><span data-stu-id="8cac2-130">Call [**CertSrvBackupFree**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupfree) as needed to release buffers allocated by certain Certificate Services backup functions.</span></span> <span data-ttu-id="8cac2-131">Le chiamate a [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw), [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw)e [**CertSrvBackupGetDynamicFileList**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdynamicfilelistw) assegnerà i buffer che possono essere liberati da una chiamata a **CertSrvBackupFree**.</span><span class="sxs-lookup"><span data-stu-id="8cac2-131">Calls to [**CertSrvBackupGetBackupLogs**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetbackuplogsw), [**CertSrvBackupGetDatabaseNames**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdatabasenamesw), and [**CertSrvBackupGetDynamicFileList**](/windows/desktop/api/Certbcli/nf-certbcli-certsrvbackupgetdynamicfilelistw) will allocate buffers that can be freed by a call to **CertSrvBackupFree**.</span></span>
16. <span data-ttu-id="8cac2-132">Rilasciare le risorse Certadm.dll chiamando [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary).</span><span class="sxs-lookup"><span data-stu-id="8cac2-132">Release the Certadm.dll resources by calling [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary).</span></span>

<span data-ttu-id="8cac2-133">Per informazioni sui privilegi necessari per eseguire il backup del database dei servizi certificati e dei file associati, vedere [impostazione dei privilegi di backup e ripristino](setting-the-backup-and-restore-privileges.md).</span><span class="sxs-lookup"><span data-stu-id="8cac2-133">For information about the privileges required to back up the Certificate Services database and associated files, see [Setting the Backup and Restore Privileges](setting-the-backup-and-restore-privileges.md).</span></span>

 

 
