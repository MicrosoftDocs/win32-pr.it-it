---
description: L'archivio certificati è fondamentale per tutte le operazioni di gestione dei certificati.
ms.assetid: e5c7c882-cbfc-4343-952c-b13c67326756
title: Estensione della funzionalità CertOpenStore
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4cce198578cc482ba0488bd97ae0f1d7f923511b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "104550034"
---
# <a name="extending-certopenstore-functionality"></a><span data-ttu-id="cdb5e-103">Estensione della funzionalità CertOpenStore</span><span class="sxs-lookup"><span data-stu-id="cdb5e-103">Extending CertOpenStore Functionality</span></span>

<span data-ttu-id="cdb5e-104">L' [*archivio certificati*](../secgloss/c-gly.md) è fondamentale per tutte le operazioni di gestione dei certificati.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-104">The [*certificate store*](../secgloss/c-gly.md) is central to all certificate management operations.</span></span> <span data-ttu-id="cdb5e-105">La funzionalità della funzione [**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) può essere estesa tramite l'uso di una funzione installabile (o registrata) del provider di certificati.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-105">The functionality of the [**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) function can be extended through the use of an installable (or registered) certificate-store-provider function.</span></span> <span data-ttu-id="cdb5e-106">Per una panoramica su come installare o registrare le funzioni da usare con CryptoAPI, vedere [Cenni preliminari sull'OID](oid-overview.md).</span><span class="sxs-lookup"><span data-stu-id="cdb5e-106">For an overview of how to install or register functions for use with the CryptoAPI, see [OID Overview](oid-overview.md).</span></span>

> [!Note]  
> <span data-ttu-id="cdb5e-107">Gli archivi certificati personalizzati non vengono migrati automaticamente durante l'esecuzione di distribuzioni automatiche.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-107">Custom certificate stores are not automatically migrated when performing automated deployments.</span></span> <span data-ttu-id="cdb5e-108">Per eseguire la migrazione degli archivi certificati personalizzati, è necessario creare un manifesto per la migrazione degli archivi personalizzati e utilizzare il Utilità di migrazione stato utente Windows (USMT).</span><span class="sxs-lookup"><span data-stu-id="cdb5e-108">To migrate custom certificate stores, you must create a manifest for migrating the custom stores and use the Windows User State Migration Tool (USMT).</span></span> <span data-ttu-id="cdb5e-109">USMT è disponibile per il download dall'area download Microsoft all'indirizzo <https://www.microsoft.com/download/details.aspx?id=10837> .</span><span class="sxs-lookup"><span data-stu-id="cdb5e-109">The USMT is available for download from the Microsoft Download Center at <https://www.microsoft.com/download/details.aspx?id=10837>.</span></span>

 

<span data-ttu-id="cdb5e-110">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) apre un archivio vuoto in memoria e chiama la funzione del provider di archiviazione (se è registrata o installata) usando l' [*identificatore di oggetto*](../secgloss/o-gly.md) (OID) passato nel parametro *lpszStoreProvider* .</span><span class="sxs-lookup"><span data-stu-id="cdb5e-110">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) opens an empty store in memory and calls the store provider function (if it is registered or installed) by using the [*object identifier*](../secgloss/o-gly.md) (OID) that was passed in the *lpszStoreProvider* parameter.</span></span> <span data-ttu-id="cdb5e-111">Per un elenco dei tipi di provider predefiniti forniti con CryptoAPI, vedere **CertOpenStore**.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-111">For a list of the predefined provider types that are supplied with the CryptoAPI, see **CertOpenStore**.</span></span>

<span data-ttu-id="cdb5e-112">La funzione del provider dell'archivio copia i certificati e gli [*elenchi di revoche di certificati*](../secgloss/c-gly.md) (CRL) nell'archivio in memoria specificato dall'handle *hCertStore* passato.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-112">The store provider function copies its certificates and [*certificate revocation lists*](../secgloss/c-gly.md) (CRLs) to the in-memory store specified by the *hCertStore* handle passed to it.</span></span> <span data-ttu-id="cdb5e-113">La nuova funzione del provider dell'archivio può utilizzare una qualsiasi delle funzioni dell'archivio certificati CryptoAPI, ad esempio, [**CertAddCertificateContextToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddcertificatecontexttostore) o [**CertAddSerializedElementToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddserializedelementtostore), per aggiungere i certificati e i CRL all'archivio in memoria.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-113">The new store provider function can use any of the CryptoAPI certificate store functions, such as, [**CertAddCertificateContextToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddcertificatecontexttostore) or [**CertAddSerializedElementToStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certaddserializedelementtostore), to add its certificates and CRLs to the in-memory store.</span></span> <span data-ttu-id="cdb5e-114">Inoltre, la funzione del provider di archiviazione restituisce facoltativamente i valori per tutti i membri dati della struttura [**di \_ \_ \_ informazioni di archivio certificati**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) .</span><span class="sxs-lookup"><span data-stu-id="cdb5e-114">In addition, the store-provider function optionally returns values for all of the data members of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure.</span></span> <span data-ttu-id="cdb5e-115">La funzione deve solo aggiornare questa struttura se supporta funzioni di callback aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-115">The function only needs to update this structure if it supports additional callback functions.</span></span> <span data-ttu-id="cdb5e-116">Se, ad esempio, l'archivio doveva essere di sola lettura, il supporto di altre funzioni di callback potrebbe non essere necessario.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-116">For example, if the store was to be a read-only store, the support of other callback functions probably would not be needed.</span></span> <span data-ttu-id="cdb5e-117">Per informazioni dettagliate e prototipi delle possibili funzioni di callback, vedere [funzioni di callback del provider dell'archivio certificati](cryptography-functions.md).</span><span class="sxs-lookup"><span data-stu-id="cdb5e-117">For details and prototypes of the possible callback functions, see [Certificate Store Provider Callback Functions](cryptography-functions.md).</span></span>

<span data-ttu-id="cdb5e-118">L'archivio TrustedPeople per utente è limitato a archivi fisici predefiniti.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-118">The per user TrustedPeople store is restricted to predefined physical stores.</span></span> <span data-ttu-id="cdb5e-119">Non è possibile estendere l'archivio TrustedPeople per utente.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-119">You cannot extend the per user TrustedPeople store.</span></span> <span data-ttu-id="cdb5e-120">Tuttavia, è possibile estendere l'archivio TrustedPeople del computer locale.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-120">However, you can extend the local machine TrustedPeople store.</span></span>

<span data-ttu-id="cdb5e-121">**Windows XP e Windows Server 2003:** L'archivio TrustedPeople per utente non è limitato agli archivi fisici predefiniti.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-121">**Windows XP and Windows Server 2003:** The per user TrustedPeople store is not restricted to predefined physical stores.</span></span>

<span data-ttu-id="cdb5e-122">Uno dei membri dati della struttura [**Certificate \_ Store \_ di \_ prova**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) è la matrice *rgpvStoreProvFunc* .</span><span class="sxs-lookup"><span data-stu-id="cdb5e-122">One of the data members of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure is the *rgpvStoreProvFunc* array.</span></span> <span data-ttu-id="cdb5e-123">Se la funzione del provider dell'archivio deve supportare una o più funzioni di callback, deve fornire i puntatori per questa matrice.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-123">If the store provider function needs to support one or more of the callback functions, it must provide pointers for this array.</span></span> <span data-ttu-id="cdb5e-124">Questi puntatori devono puntare alle funzioni di callback da usare per altre attività di archivio certificati, ad esempio la chiusura dell'archivio.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-124">These pointers must point to the callback functions that are to be used for other certificate-store activities (such as closing the store).</span></span> <span data-ttu-id="cdb5e-125">Nella figura seguente viene illustrato il flusso di questo processo.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-125">The following illustration shows the flow of this process.</span></span>

![funzionalità CertOpenStore](images/openstor.png)

<span data-ttu-id="cdb5e-127">Come illustrato nella figura seguente, dopo l'apertura dell'archivio, altre funzioni CryptoAPI (ad esempio [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore)) utilizzano la matrice di puntatori per accedere alle funzioni di callback che eseguono l'attività desiderata.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-127">As shown in the following illustration, after the store has been opened, other CryptoAPI functions (such as [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore)) use the array of pointers to access the callback functions that perform the intended task.</span></span> <span data-ttu-id="cdb5e-128">Le [funzioni di callback del provider dell'archivio certificati](cryptography-functions.md)sono visualizzate nella definizione della struttura di [**informazioni di \_ \_ prova \_ dell'archivio**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) certificati e nei prototipi delle funzioni di callback predefinite fornite con CryptoAPI.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-128">The definition of the [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure and the prototypes of the default callback functions that are supplied with the CryptoAPI are shown in [Certificate Store Provider Callback Functions](cryptography-functions.md).</span></span>

![funzionalità certclosestore](images/closstor.png)

<span data-ttu-id="cdb5e-130">Le API Store consentono a un provider di archiviazione di gestire i certificati, i CRL e gli elenchi di certificati [*attendibili*](../secgloss/c-gly.md) (scopi consentiti) all'esterno della cache dell'archivio (ad esempio, un database esterno di certificati, ad esempio fornito dal database del server di certificati Microsoft).</span><span class="sxs-lookup"><span data-stu-id="cdb5e-130">The store APIs allow a store provider to maintain the certificates, CRLs, and [*certificate trust lists*](../secgloss/c-gly.md) (CTLs) outside the cache of the store (for example, an external database of certificates, such as provided by the Microsoft Certificate Server Database).</span></span>

<span data-ttu-id="cdb5e-131">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) invia il parametro *pszStoreProvider* alla funzione del provider installabile [**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) appropriata.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-131">[**CertOpenStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certopenstore) dispatches through the *pszStoreProvider* parameter to the appropriate [**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) installable provider function.</span></span> <span data-ttu-id="cdb5e-132">Il provider restituisce le informazioni nel parametro *pStoreProvInfo* che punta a una struttura di informazioni di [**prova dell' \_ archivio \_ \_ certificati**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) .</span><span class="sxs-lookup"><span data-stu-id="cdb5e-132">The provider returns information in the *pStoreProvInfo* parameter that points to a [**CERT\_STORE\_PROV\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_store_prov_info) structure.</span></span> <span data-ttu-id="cdb5e-133">La struttura dei **dati di \_ prova dell'archivio \_ \_ certificati** contiene un membro **dwStoreProvFlags** .</span><span class="sxs-lookup"><span data-stu-id="cdb5e-133">The **CERT\_STORE\_PROV\_INFO** structure contains a **dwStoreProvFlags** member.</span></span> <span data-ttu-id="cdb5e-134">\_ \_ \_ \_ È stato aggiunto il flag del flag esterno per l'archivio certificati per consentire al provider di indicare che i certificati, i CRL e scopi consentiti sono esterni alla cache dell'archivio.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-134">The CERT\_STORE\_PROV\_EXTERNAL\_FLAG flag was added to allow the provider to indicate that the certificates, CRLs, and CTLs are external to the cache of the store.</span></span>

<span data-ttu-id="cdb5e-135">[**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) restituisce una matrice di funzioni di callback.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-135">[**CertDllOpenStoreProv**](/windows/win32/api/Wincrypt/nc-wincrypt-pfn_cert_dll_open_store_prov_func) returns an array of callback functions.</span></span> <span data-ttu-id="cdb5e-136">Un provider può implementare le funzioni di callback seguenti:</span><span class="sxs-lookup"><span data-stu-id="cdb5e-136">A provider can implement the following callback functions:</span></span>

-   <span data-ttu-id="cdb5e-137">punto di ripristino del certificato di \_ \_ prova \_ Close \_</span><span class="sxs-lookup"><span data-stu-id="cdb5e-137">CERT\_STORE\_PROV\_CLOSE\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-138">CERT per la lettura dell' \_ archivio certificati \_ \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="cdb5e-138">CERT\_STORE\_PROV\_READ\_CERT\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-139">CERT \_ Store \_ prova \_ Write \_ CERT \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-139">CERT\_STORE\_PROV\_WRITE\_CERT\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-140">CERT \_ Store \_ prova \_ Delete \_ CERT \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-140">CERT\_STORE\_PROV\_DELETE\_CERT\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-141">\_Proprietà CERT dell'archivio certificati \_ prov \_ set \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="cdb5e-141">CERT\_STORE\_PROV\_SET\_CERT\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-142">\_archivio certificati \_ prova a \_ leggere \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-142">CERT\_STORE\_PROV\_READ\_CRL\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-143">\_archivio certificati \_ prova a \_ scrivere \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-143">CERT\_STORE\_PROV\_WRITE\_CRL\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-144">\_archivio certificati \_ prov \_ Delete \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-144">CERT\_STORE\_PROV\_DELETE\_CRL\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-145">il set di certificati della \_ \_ \_ \_ \_ proprietà \_ CRL dell'archivio certificati</span><span class="sxs-lookup"><span data-stu-id="cdb5e-145">CERT\_STORE\_PROV\_SET\_CRL\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-146">\_archivio certificati \_ prova a \_ leggere \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-146">CERT\_STORE\_PROV\_READ\_CTL\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-147">\_archivio certificati \_ prova a \_ scrivere \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-147">CERT\_STORE\_PROV\_WRITE\_CTL\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-148">\_archivio certificati \_ prova \_ Delete \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-148">CERT\_STORE\_PROV\_DELETE\_CTL\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-149">\_Proprietà CTL dell'archivio certificati \_ prova \_ set \_ \_ \_</span><span class="sxs-lookup"><span data-stu-id="cdb5e-149">CERT\_STORE\_PROV\_SET\_CTL\_PROPERTY\_FUNC</span></span>

<span data-ttu-id="cdb5e-150">Durante le chiamate alle \_ funzioni di callback Write certificate, Write \_ CRL e Write \_ CTL quando si imposta il flag di aggiunta della scrittura di certificati per l'archivio dei certificati \_ \_ \_ \_ \_ , i 16 bit superiori del parametro *dwFlags* contengono il valore *dwAddDisposition* .</span><span class="sxs-lookup"><span data-stu-id="cdb5e-150">On calls to the WRITE\_CERT, WRITE\_CRL, and WRITE\_CTL callback functions when the CERT\_STORE\_PROV\_WRITE\_ADD\_FLAG is set, the upper 16 bits of the *dwFlags* parameter contains the *dwAddDisposition* value.</span></span> <span data-ttu-id="cdb5e-151">Per supportare gli archivi esterni, un provider può implementare le funzioni di callback seguenti:</span><span class="sxs-lookup"><span data-stu-id="cdb5e-151">To support external stores, a provider can implement the following callback functions:</span></span>

-   <span data-ttu-id="cdb5e-152">CERT \_ Store \_ prov \_ Find \_ CERT \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-152">CERT\_STORE\_PROV\_FIND\_CERT\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-153">CERT \_ Store \_ prove \_ Free \_ Find \_ CERT \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-153">CERT\_STORE\_PROV\_FREE\_FIND\_CERT\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-154">funzione CERT \_ Store prove \_ \_ get \_ CERT \_ Property \_</span><span class="sxs-lookup"><span data-stu-id="cdb5e-154">CERT\_STORE\_PROV\_GET\_CERT\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-155">\_archivio certificati \_ prov \_ Find \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-155">CERT\_STORE\_PROV\_FIND\_CRL\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-156">l' \_ archivio certificati \_ prova a trovare il \_ \_ \_ CRL \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-156">CERT\_STORE\_PROV\_FREE\_FIND\_CRL\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-157">\_archivio certificati \_ prova \_ get \_ \_ Proprietà CRL \_</span><span class="sxs-lookup"><span data-stu-id="cdb5e-157">CERT\_STORE\_PROV\_GET\_CRL\_PROPERTY\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-158">\_archivio certificati \_ prov \_ Find \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-158">CERT\_STORE\_PROV\_FIND\_CTL\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-159">l' \_ archivio certificati \_ prova la \_ \_ ricerca gratuita \_ CTL \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-159">CERT\_STORE\_PROV\_FREE\_FIND\_CTL\_FUNC</span></span>
-   <span data-ttu-id="cdb5e-160">\_archivio certificati \_ prova \_ get \_ CTL \_ proprietà \_ Func</span><span class="sxs-lookup"><span data-stu-id="cdb5e-160">CERT\_STORE\_PROV\_GET\_CTL\_PROPERTY\_FUNC</span></span>

<span data-ttu-id="cdb5e-161">Le funzioni di callback del certificato hanno le firme seguenti:</span><span class="sxs-lookup"><span data-stu-id="cdb5e-161">The certificate callback functions have the following signatures:</span></span>

``` syntax
typedef struct _CERT_STORE_PROV_FIND_INFO {
    DWORD               cbSize;
    DWORD               dwMsgAndCertEncodingType;
    DWORD               dwFindFlags;
    DWORD               dwFindType;
    const void          *pvFindPara;
} CERT_STORE_PROV_FIND_INFO, *PCERT_STORE_PROV_FIND_INFO;
typedef const CERT_STORE_PROV_FIND_INFO CCERT_STORE_PROV_FIND_INFO,
    *PCCERT_STORE_PROV_FIND_INFO;

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_FIND_CERT)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_STORE_PROV_FIND_INFO pFindInfo,
        IN PCCERT_CONTEXT pPrevCertContext,
        IN DWORD dwFlags,
        IN OUT void **ppvStoreProvFindInfo,
        OUT PCCERT_CONTEXT *ppProvCertContext
        );

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_FREE_FIND_CERT)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_CONTEXT pCertContext,
        IN void *pvStoreProvFindInfo,
        IN DWORD dwFlags
        );

typedef BOOL (WINAPI *PFN_CERT_STORE_PROV_GET_CERT_PROPERTY)(
        IN HCERTSTOREPROV hStoreProv,
        IN PCCERT_CONTEXT pCertContext,
        IN DWORD dwPropId,
        IN DWORD dwFlags,
        OUT void *pvData,
        IN OUT DWORD *pcbData
        );
```

<span data-ttu-id="cdb5e-162">Le firme per le funzioni di callback CRL e CTL sono identiche a quelle riportate sopra con il puntatore al [**\_ contesto del certificato**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) sostituito da un puntatore a un contesto [**CRL \_**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) o a un [**\_ contesto CTL**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context).</span><span class="sxs-lookup"><span data-stu-id="cdb5e-162">The signatures for the CRL and CTL callback functions are identical to the above with the pointer to the [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) replaced with a pointer to a [**CRL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) or [**CTL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context).</span></span>

<span data-ttu-id="cdb5e-163">Il \_ callback Find Cert viene chiamato quando le API dell'archivio enumerano, trovano o aggiungono i certificati.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-163">The FIND\_CERT callback is called when the store APIs enumerate, find, or add certificates.</span></span> <span data-ttu-id="cdb5e-164">*pPrevCertContext* e *ppvStoreProvFindInfo* sono impostati su **null** per avviare una nuova ricerca.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-164">*pPrevCertContext* and *ppvStoreProvFindInfo* are set to **NULL** to initiate a new FIND.</span></span> <span data-ttu-id="cdb5e-165">Il *ppvStoreProvFindInfo* restituito viene restituito alla ricerca successiva, a cui può essere liberato dal provider.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-165">The returned *ppvStoreProvFindInfo* is passed back on the next find at which time it may be freed by the provider.</span></span> <span data-ttu-id="cdb5e-166">Il provider può impostare tutte, alcune o nessuna delle proprietà del certificato.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-166">The provider may set all, some, or none of the certificate properties.</span></span> <span data-ttu-id="cdb5e-167">Il provider ha la possibilità di rinviare fino a quando non \_ \_ viene chiamato il callback della proprietà Get cert.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-167">The provider has the option to defer until the GET\_CERT\_PROPERTY callback is called.</span></span> <span data-ttu-id="cdb5e-168">È consigliabile per i provider impostare il maggior numero possibile di proprietà per consentire la copia in un altro archivio.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-168">It is recommended for providers to set as many properties as possible to allow copying to another store.</span></span>

<span data-ttu-id="cdb5e-169">I tipi di ricerca dei certificati seguenti sono supportati in [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore):</span><span class="sxs-lookup"><span data-stu-id="cdb5e-169">The following certificate find types are supported in [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore):</span></span>

-   <span data-ttu-id="cdb5e-170">CERT \_ trova \_ qualsiasi</span><span class="sxs-lookup"><span data-stu-id="cdb5e-170">CERT\_FIND\_ANY</span></span>
-   <span data-ttu-id="cdb5e-171">\_ \_ Hash SHA1 Find \_ CERT</span><span class="sxs-lookup"><span data-stu-id="cdb5e-171">CERT\_FIND\_SHA1\_HASH</span></span>
-   <span data-ttu-id="cdb5e-172">\_ \_ Hash MD5 Find \_ CERT</span><span class="sxs-lookup"><span data-stu-id="cdb5e-172">CERT\_FIND\_MD5\_HASH</span></span>
-   <span data-ttu-id="cdb5e-173">\_Proprietà CERT Find \_</span><span class="sxs-lookup"><span data-stu-id="cdb5e-173">CERT\_FIND\_PROPERTY</span></span>
-   <span data-ttu-id="cdb5e-174">\_ \_ chiave pubblica CERT \_ Find</span><span class="sxs-lookup"><span data-stu-id="cdb5e-174">CERT\_FIND\_PUBLIC\_KEY</span></span>
-   <span data-ttu-id="cdb5e-175">\_ \_ nome soggetto ricerca \_ certificato</span><span class="sxs-lookup"><span data-stu-id="cdb5e-175">CERT\_FIND\_SUBJECT\_NAME</span></span>
-   <span data-ttu-id="cdb5e-176">\_attr trovare l' \_ oggetto \_ attr</span><span class="sxs-lookup"><span data-stu-id="cdb5e-176">CERT\_FIND\_SUBJECT\_ATTR</span></span>
-   <span data-ttu-id="cdb5e-177">\_nome dell' \_ autorità emittente \_ trovare il certificato</span><span class="sxs-lookup"><span data-stu-id="cdb5e-177">CERT\_FIND\_ISSUER\_NAME</span></span>
-   <span data-ttu-id="cdb5e-178">autorità di certificazione per trovare l'autorità di certificazione \_ \_ \_ attr</span><span class="sxs-lookup"><span data-stu-id="cdb5e-178">CERT\_FIND\_ISSUER\_ATTR</span></span>
-   <span data-ttu-id="cdb5e-179">CERT \_ trovare \_ \_ l'oggetto Str \_ A</span><span class="sxs-lookup"><span data-stu-id="cdb5e-179">CERT\_FIND\_SUBJECT\_STR\_A</span></span>
-   <span data-ttu-id="cdb5e-180">CERTIFICATO \_ trovare l' \_ oggetto \_ Str \_ W</span><span class="sxs-lookup"><span data-stu-id="cdb5e-180">CERT\_FIND\_SUBJECT\_STR\_W</span></span>
-   <span data-ttu-id="cdb5e-181">CERT \_ trova \_ emittente \_ Str \_ A</span><span class="sxs-lookup"><span data-stu-id="cdb5e-181">CERT\_FIND\_ISSUER\_STR\_A</span></span>
-   <span data-ttu-id="cdb5e-182">CERT \_ trova \_ emittente \_ Str \_ W</span><span class="sxs-lookup"><span data-stu-id="cdb5e-182">CERT\_FIND\_ISSUER\_STR\_W</span></span>
-   <span data-ttu-id="cdb5e-183">\_ \_ specifica chiave CERT \_ Find</span><span class="sxs-lookup"><span data-stu-id="cdb5e-183">CERT\_FIND\_KEY\_SPEC</span></span>
-   <span data-ttu-id="cdb5e-184">uso di CERT \_ Find \_ ENHKEY \_</span><span class="sxs-lookup"><span data-stu-id="cdb5e-184">CERT\_FIND\_ENHKEY\_USAGE</span></span>

<span data-ttu-id="cdb5e-185">Il \_ callback Find Cert viene chiamato per ognuno dei tipi Find precedenti.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-185">The FIND\_CERT callback is called for each of the above find types.</span></span> <span data-ttu-id="cdb5e-186">I parametri passati a [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore) vengono copiati direttamente nell' \_ archivio certificati \_ prova a trovare la \_ \_ struttura delle informazioni prima della chiamata a Find \_ CERT callback.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-186">The parameters passed to [**CertFindCertificateInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindcertificateinstore) are copied directly to the CERT\_STORE\_PROV\_FIND\_INFO structure before the FIND\_CERT callback is called.</span></span> <span data-ttu-id="cdb5e-187">Per informazioni dettagliate sui valori dei campi per i diversi tipi di ricerca dell' \_ archivio certificati \_ prova a trovare la struttura delle \_ \_ informazioni, vedere **CertFindCertificateInStore**.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-187">For details about the field values for the different find types of the CERT\_STORE\_PROV\_FIND\_INFO structure, see **CertFindCertificateInStore**.</span></span>

<span data-ttu-id="cdb5e-188">I tipi di ricerca dei certificati seguenti supportano le API [**CertGetSubjectCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetsubjectcertificatefromstore) e [**CertGetIssuerCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetissuercertificatefromstore) e consentono di determinare se il certificato esiste già nell'archivio prima di aggiungere:</span><span class="sxs-lookup"><span data-stu-id="cdb5e-188">The following certificate find types support the [**CertGetSubjectCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetsubjectcertificatefromstore) and [**CertGetIssuerCertificateFromStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetissuercertificatefromstore) APIs and help determine whether the certificate already exists in the store before adding:</span></span>

-   <span data-ttu-id="cdb5e-189">\_CERT trova \_ oggetto \_ CERT</span><span class="sxs-lookup"><span data-stu-id="cdb5e-189">CERT\_FIND\_SUBJECT\_CERT</span></span>
-   <span data-ttu-id="cdb5e-190">\_autorità di certificazione Find CERT \_ \_ di</span><span class="sxs-lookup"><span data-stu-id="cdb5e-190">CERT\_FIND\_ISSUER\_OF</span></span>
-   <span data-ttu-id="cdb5e-191">CERT \_ trova \_ esistente</span><span class="sxs-lookup"><span data-stu-id="cdb5e-191">CERT\_FIND\_EXISTING</span></span>

<span data-ttu-id="cdb5e-192">Per CERT \_ Find \_ Subject \_ CERT, il *parametro pvFindPara* punta a una struttura di [**\_ informazioni del certificato**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_info) che contiene l'emittente e SerialNumber dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-192">For CERT\_FIND\_SUBJECT\_CERT, the *pvFindPara* parameter points to a [**CERT\_INFO**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_info) structure that contains the Issuer and SerialNumber of the subject.</span></span> <span data-ttu-id="cdb5e-193">Per CERT \_ Find \_ Issuer \_ di, *pvFindPara* punta a una struttura del [**\_ contesto del certificato**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) , dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-193">For CERT\_FIND\_ISSUER\_OF, *pvFindPara* points to a [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) structure, of the subject.</span></span> <span data-ttu-id="cdb5e-194">Per CERT \_ Find \_ existing, *pvFindPara* punta a **un \_ contesto** del certificato per verificarne l'esistenza nell'archivio.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-194">For CERT\_FIND\_EXISTING, *pvFindPara* points to a **CERT\_CONTEXT** of the certificate to check for its existence in the store.</span></span>

<span data-ttu-id="cdb5e-195">Il callback del certificato \_ Find gratuito \_ viene chiamato quando il certificato restituito dal callback di Find \_ CERT non è stato rilasciato da usato in un successivo certificato di ricerca successivo \_ , quindi il [*conteggio dei riferimenti*](../secgloss/r-gly.md) viene decrementato a zero o rilasciato da una chiamata a [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore).</span><span class="sxs-lookup"><span data-stu-id="cdb5e-195">The FREE\_FIND\_CERT callback is called when the certificate returned by the FIND\_CERT callback was not released by being used in a subsequent next FIND\_CERT, thus having its [*reference count*](../secgloss/r-gly.md) decremented to zero, or by being released by a call to [**CertCloseStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certclosestore).</span></span> <span data-ttu-id="cdb5e-196">Prima che venga chiamato il callback di chiusura, tutti i certificati restituiti dal \_ callback Find CERT devono essere rilasciati al provider tramite il passaggio a una chiamata al \_ callback Find CERT o a una chiamata al callback della ricerca gratuita del \_ \_ certificato.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-196">Before the CLOSE callback is called, all certificates returned by the FIND\_CERT callback should be released to the provider by being passed to a call to the FIND\_CERT callback or a call to the FREE\_FIND\_CERT callback.</span></span> <span data-ttu-id="cdb5e-197">Lo stesso vale per i callback CRL e CTL.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-197">The same applies to the CRL and CTL callbacks.</span></span>

<span data-ttu-id="cdb5e-198">Il \_ callback della proprietà Get CERT \_ viene chiamato da [**CertGetCertificateContextProperty**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetcertificatecontextproperty) se non riesce a trovare la proprietà specificata per il parametro *pCertContext* .</span><span class="sxs-lookup"><span data-stu-id="cdb5e-198">The GET\_CERT\_PROPERTY callback is called by [**CertGetCertificateContextProperty**](/windows/win32/api/Wincrypt/nf-wincrypt-certgetcertificatecontextproperty) if it cannot find the specified property for the *pCertContext* parameter.</span></span> <span data-ttu-id="cdb5e-199">Lo stesso vale per GET \_ CRL \_ Property e Get \_ CTL \_ Property.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-199">The same is true for GET\_CRL\_PROPERTY and GET\_CTL\_PROPERTY.</span></span>

<span data-ttu-id="cdb5e-200">Il \_ callback Find CRL viene chiamato quando le API dell'archivio enumerano o ottengono CRL e prima di aggiungere un CRL.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-200">The FIND\_CRL callback is called when the store APIs enumerate or get CRLs and before adding a CRL.</span></span> <span data-ttu-id="cdb5e-201">Verranno definiti i seguenti tipi di ricerca CRL:</span><span class="sxs-lookup"><span data-stu-id="cdb5e-201">The following CRL find types will be defined:</span></span>

<span data-ttu-id="cdb5e-202">Per \_ la ricerca CRL \_ rilasciata \_ da, *pvFindPara* è un puntatore a un [**\_ contesto del certificato**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) dell'emittente CRL.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-202">For CRL\_FIND\_ISSUED\_BY, *pvFindPara* is a pointer to a [**CERT\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-cert_context) of the CRL issuer.</span></span> <span data-ttu-id="cdb5e-203">Per CRL \_ Find \_ existing, *pvFindPara* è un puntatore a [**un \_ contesto CRL**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) del CRL per determinare se esiste già nell'archivio.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-203">For CRL\_FIND\_EXISTING, *pvFindPara* is a pointer to a [**CRL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-crl_context) of the CRL to determine whether it already exists in the store.</span></span>

<span data-ttu-id="cdb5e-204">Il \_ callback Find CTL viene chiamato quando le API dell'archivio enumerano o trovano scopi consentiti.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-204">The FIND\_CTL callback is called when the store APIs enumerate or find CTLs.</span></span> <span data-ttu-id="cdb5e-205">In [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore)sono supportati i tipi di ricerca CTL seguenti:</span><span class="sxs-lookup"><span data-stu-id="cdb5e-205">The following CTL find types are supported in [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore):</span></span>

-   <span data-ttu-id="cdb5e-206">CTL \_ trovare \_ qualsiasi</span><span class="sxs-lookup"><span data-stu-id="cdb5e-206">CTL\_FIND\_ANY</span></span>
-   <span data-ttu-id="cdb5e-207">\_ \_ Hash SHA1 per Find CTL \_</span><span class="sxs-lookup"><span data-stu-id="cdb5e-207">CTL\_FIND\_SHA1\_HASH</span></span>
-   <span data-ttu-id="cdb5e-208">\_ \_ Hash MD5 Find \_ CTL</span><span class="sxs-lookup"><span data-stu-id="cdb5e-208">CTL\_FIND\_MD5\_HASH</span></span>
-   <span data-ttu-id="cdb5e-209">\_utilizzo ricerca \_ CTL</span><span class="sxs-lookup"><span data-stu-id="cdb5e-209">CTL\_FIND\_USAGE</span></span>
-   <span data-ttu-id="cdb5e-210">\_oggetto trovato \_ CTL</span><span class="sxs-lookup"><span data-stu-id="cdb5e-210">CTL\_FIND\_SUBJECT</span></span>
-   <span data-ttu-id="cdb5e-211">CTL \_ trova \_ esistente</span><span class="sxs-lookup"><span data-stu-id="cdb5e-211">CTL\_FIND\_EXISTING</span></span>

<span data-ttu-id="cdb5e-212">Il \_ callback Find CTL viene chiamato per ognuno dei tipi Find precedenti.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-212">The FIND\_CTL callback is called for each of the above find types.</span></span> <span data-ttu-id="cdb5e-213">I parametri passati a [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore) vengono copiati direttamente nell' \_ archivio certificati \_ prova a trovare la \_ \_ struttura delle informazioni prima della chiamata a Find \_ CTL callback.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-213">The parameters passed to [**CertFindCTLInStore**](/windows/win32/api/Wincrypt/nf-wincrypt-certfindctlinstore) are copied directly to the CERT\_STORE\_PROV\_FIND\_INFO structure before the FIND\_CTL callback is called.</span></span> <span data-ttu-id="cdb5e-214">Per informazioni dettagliate sui valori dei campi per i diversi tipi di ricerca dell' \_ archivio certificati \_ prova a trovare la struttura delle \_ \_ informazioni, vedere **CertFindCTLInStore**.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-214">For details about the field values for the different find types of the CERT\_STORE\_PROV\_FIND\_INFO structure, see **CertFindCTLInStore**.</span></span>

<span data-ttu-id="cdb5e-215">Il \_ tipo CTL Find \_ existing CTL Find consente di determinare se l'elenco di scopi consentiti esiste già nell'archivio prima di eseguire un CTL Add.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-215">The CTL\_FIND\_EXISTING CTL find type helps determine whether the CTL already exists in the store before doing a CTL add.</span></span>

<span data-ttu-id="cdb5e-216">Per CTL \_ Find \_ existing, *pvFindPara* è un puntatore alla struttura del [**\_ contesto CTL**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context) del CTL per determinare se esiste già nell'archivio.</span><span class="sxs-lookup"><span data-stu-id="cdb5e-216">For CTL\_FIND\_EXISTING, *pvFindPara* is a pointer to the [**CTL\_CONTEXT**](/windows/win32/api/Wincrypt/ns-wincrypt-ctl_context) structure of the CTL to determine whether it already exists in the store.</span></span>

 

 
