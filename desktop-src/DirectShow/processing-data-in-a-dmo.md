---
description: Elaborazione di dati in un DMO
ms.assetid: 715482d9-23f4-40d0-9c09-7a81e148c543
title: Elaborazione di dati in un DMO
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ea9f5d5d820dc1467c25f9d411d46a9c66935e8b
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/06/2021
ms.locfileid: "103876653"
---
# <a name="processing-data-in-a-dmo"></a><span data-ttu-id="ba825-103">Elaborazione di dati in un DMO</span><span class="sxs-lookup"><span data-stu-id="ba825-103">Processing Data in a DMO</span></span>

<span data-ttu-id="ba825-104">In questa sezione viene illustrato come elaborare un flusso di dati utilizzando DMO.</span><span class="sxs-lookup"><span data-stu-id="ba825-104">This section explains how to process a stream of data using a DMO.</span></span> <span data-ttu-id="ba825-105">I passaggi elencati in questa sezione rappresentano il comportamento predefinito. tutti DMOs devono supportare i metodi descritti qui.</span><span class="sxs-lookup"><span data-stu-id="ba825-105">The steps listed in this section are the default behavior; all DMOs must support the methods described here.</span></span> <span data-ttu-id="ba825-106">Questi metodi usano buffer distinti per l'input e l'output.</span><span class="sxs-lookup"><span data-stu-id="ba825-106">These methods use separate buffers for input and output.</span></span> <span data-ttu-id="ba825-107">Alcuni DMOs supportano anche l'elaborazione sul posto, usando un singolo buffer.</span><span class="sxs-lookup"><span data-stu-id="ba825-107">Some DMOs also support in-place processing, using a single buffer.</span></span> <span data-ttu-id="ba825-108">Per ulteriori informazioni sull'elaborazione sul posto, vedere [elaborazione sul posto](in-place-processing.md).</span><span class="sxs-lookup"><span data-stu-id="ba825-108">For more information about in-place processing, see [In-Place Processing](in-place-processing.md).</span></span>

<span data-ttu-id="ba825-109">**Allocazione di buffer**</span><span class="sxs-lookup"><span data-stu-id="ba825-109">**Allocating Buffers**</span></span>

<span data-ttu-id="ba825-110">Il client è responsabile di tutte le allocazioni di buffer.</span><span class="sxs-lookup"><span data-stu-id="ba825-110">The client is responsible for all buffer allocation.</span></span> <span data-ttu-id="ba825-111">Dopo aver impostato i tipi di supporto su DMO, eseguire una query su DMO per i requisiti del buffer di ogni flusso.</span><span class="sxs-lookup"><span data-stu-id="ba825-111">After you set the media types on the DMO, query the DMO for each stream's buffer requirements.</span></span> <span data-ttu-id="ba825-112">Questi possono variare a seconda del tipo di supporto.</span><span class="sxs-lookup"><span data-stu-id="ba825-112">These can change depending on the media type.</span></span> <span data-ttu-id="ba825-113">Per ogni flusso, chiamare il metodo [**IMediaObject:: GetInputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputsizeinfo) o [**IMediaObject:: GetOutputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputsizeinfo) .</span><span class="sxs-lookup"><span data-stu-id="ba825-113">For each stream, call the [**IMediaObject::GetInputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputsizeinfo) or [**IMediaObject::GetOutputSizeInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputsizeinfo) method.</span></span> <span data-ttu-id="ba825-114">Questi metodi restituiscono le informazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="ba825-114">These methods return the following information:</span></span>

-   <span data-ttu-id="ba825-115">Dimensioni minime del buffer, in byte.</span><span class="sxs-lookup"><span data-stu-id="ba825-115">Minimum buffer size, in bytes.</span></span>
-   <span data-ttu-id="ba825-116">Eventuali requisiti di allineamento.</span><span class="sxs-lookup"><span data-stu-id="ba825-116">Alignment requirements, if any.</span></span> <span data-ttu-id="ba825-117">Un buffer è allineato se l'indirizzo iniziale è un multiplo di un numero intero specificato.</span><span class="sxs-lookup"><span data-stu-id="ba825-117">A buffer is aligned if the start address is a multiple of some specified integer.</span></span>
-   <span data-ttu-id="ba825-118">Quantità massima di dati che DMO terrà per lookahead.</span><span class="sxs-lookup"><span data-stu-id="ba825-118">The maximum amount of data the DMO will hold for lookahead.</span></span> <span data-ttu-id="ba825-119">Questo numero si applica solo ai flussi di input.</span><span class="sxs-lookup"><span data-stu-id="ba825-119">This number applies only to input streams.</span></span> <span data-ttu-id="ba825-120">Per alcuni tipi di dati (ad esempio, la codifica MPEG), è possibile che un DMO debba essere in attesa nel flusso.</span><span class="sxs-lookup"><span data-stu-id="ba825-120">For some kinds of data (for example, MPEG encoding), a DMO might need to look forward in the stream.</span></span> <span data-ttu-id="ba825-121">Il valore lookahead indica la quantità di dati di input richiesta da DMO prima che possa produrre l'output.</span><span class="sxs-lookup"><span data-stu-id="ba825-121">The lookahead value indicates how much input data the DMO will require before it can produce output.</span></span>

<span data-ttu-id="ba825-122">Il client deve allocare buffer che soddisfano questi requisiti.</span><span class="sxs-lookup"><span data-stu-id="ba825-122">The client must allocate buffers that match these requirements.</span></span> <span data-ttu-id="ba825-123">Inoltre, DMO potrebbe avere requisiti relativi al modo in cui il client include i dati di input.</span><span class="sxs-lookup"><span data-stu-id="ba825-123">In addition, the DMO might have requirements about how the client packages the input data.</span></span> <span data-ttu-id="ba825-124">Ad esempio, DMO potrebbe richiedere a ogni buffer di contenere esattamente un campione (o un fotogramma video).</span><span class="sxs-lookup"><span data-stu-id="ba825-124">For example, the DMO might require each buffer to contain exactly one sample (or video frame).</span></span> <span data-ttu-id="ba825-125">Per determinare questi requisiti, chiamare il metodo [**IMediaObject:: GetInputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstreaminfo) .</span><span class="sxs-lookup"><span data-stu-id="ba825-125">To determine these requirements, call the [**IMediaObject::GetInputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstreaminfo) method.</span></span> <span data-ttu-id="ba825-126">Il metodo [**IMediaObject:: GetOutputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputstreaminfo) restituisce informazioni simili su un flusso di output.</span><span class="sxs-lookup"><span data-stu-id="ba825-126">The [**IMediaObject::GetOutputStreamInfo**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getoutputstreaminfo) method returns similar information about an output stream.</span></span>

<span data-ttu-id="ba825-127">Nel modello di streaming predefinito, il client non passa i puntatori del buffer non elaborato a DMO.</span><span class="sxs-lookup"><span data-stu-id="ba825-127">In the default streaming model, the client does not pass raw buffer pointers to the DMO.</span></span> <span data-ttu-id="ba825-128">USA invece un oggetto COM leggero che espone l'interfaccia [**IMediaBuffer**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediabuffer) .</span><span class="sxs-lookup"><span data-stu-id="ba825-128">Instead, it uses a lightweight COM object that exposes the [**IMediaBuffer**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediabuffer) interface.</span></span> <span data-ttu-id="ba825-129">L'interfaccia **IMediaBuffer** funge da wrapper com per un blocco di memoria.</span><span class="sxs-lookup"><span data-stu-id="ba825-129">The **IMediaBuffer** interface acts as a COM wrapper for a block of memory.</span></span> <span data-ttu-id="ba825-130">Poiché si tratta di un oggetto COM, supporta il conteggio dei riferimenti, che consente di garantire che i buffer non vengano rilasciati mentre sono ancora in uso.</span><span class="sxs-lookup"><span data-stu-id="ba825-130">Because it is a COM object, it supports reference counting, which helps to ensure that buffers are not released while still in use.</span></span>

> [!Note]  
> <span data-ttu-id="ba825-131">L'interfaccia **IMediaBuffer** offre una funzione simile all'interfaccia **IMediaSample** in DirectShow.</span><span class="sxs-lookup"><span data-stu-id="ba825-131">The **IMediaBuffer** interface serves a function similar to the **IMediaSample** interface in DirectShow.</span></span>

 

<span data-ttu-id="ba825-132">Il client deve implementare l'oggetto **IMediaBuffer** .</span><span class="sxs-lookup"><span data-stu-id="ba825-132">The client must implement the **IMediaBuffer** object.</span></span> <span data-ttu-id="ba825-133">Per ulteriori informazioni, vedere [implementazione di IMediaBuffer](implementing-imediabuffer.md).</span><span class="sxs-lookup"><span data-stu-id="ba825-133">For more information, see [Implementing IMediaBuffer](implementing-imediabuffer.md).</span></span>

<span data-ttu-id="ba825-134">**Elaborazione dei dati**</span><span class="sxs-lookup"><span data-stu-id="ba825-134">**Processing the Data**</span></span>

<span data-ttu-id="ba825-135">Per elaborare i dati, eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="ba825-135">To process data, do the following:</span></span>

1.  <span data-ttu-id="ba825-136">Per ogni flusso di input, riempire un buffer con i dati di input.</span><span class="sxs-lookup"><span data-stu-id="ba825-136">For each input stream, fill a buffer with input data.</span></span>
2.  <span data-ttu-id="ba825-137">Chiamare [**IMediaObject::P rocessinput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processinput) per il recapito di ogni buffer.</span><span class="sxs-lookup"><span data-stu-id="ba825-137">Call [**IMediaObject::ProcessInput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processinput) to deliver each buffer.</span></span>
3.  <span data-ttu-id="ba825-138">Chiamare [**IMediaObject::P rocessoutput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processoutput) per elaborare i dati.</span><span class="sxs-lookup"><span data-stu-id="ba825-138">Call [**IMediaObject::ProcessOutput**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-processoutput) to process the data.</span></span> <span data-ttu-id="ba825-139">Questo metodo accetta una matrice di buffer, uno per ogni flusso di output.</span><span class="sxs-lookup"><span data-stu-id="ba825-139">This method takes an array of buffers, one for each output stream.</span></span>
4.  <span data-ttu-id="ba825-140">Ripetere fino a quando non sono presenti altri dati di input.</span><span class="sxs-lookup"><span data-stu-id="ba825-140">Repeat until there is no more input data.</span></span>

<span data-ttu-id="ba825-141">Il metodo **ProcessInput** accetta input per un flusso alla volta.</span><span class="sxs-lookup"><span data-stu-id="ba825-141">The **ProcessInput** method accepts input for one stream at a time.</span></span> <span data-ttu-id="ba825-142">In genere il metodo viene restituito immediatamente e DMO include un conteggio dei riferimenti nell'oggetto **IMediaBuffer** .</span><span class="sxs-lookup"><span data-stu-id="ba825-142">Typically the method returns immediately, and the DMO holds a reference count on the **IMediaBuffer** object.</span></span> <span data-ttu-id="ba825-143">Rilascia l'oggetto dopo l'elaborazione di tutti i dati nel buffer o quando l'applicazione Scarica DMO.</span><span class="sxs-lookup"><span data-stu-id="ba825-143">It releases the object after it processes all of the data in the buffer, or when the application flushes the DMO.</span></span> <span data-ttu-id="ba825-144">Non riutilizzare un buffer finché non viene rilasciato da DMO.</span><span class="sxs-lookup"><span data-stu-id="ba825-144">Do not re-use a buffer until the DMO has released it.</span></span> <span data-ttu-id="ba825-145">Per determinare se un flusso di input può accettare più dati, chiamare il metodo [**IMediaObject:: GetInputStatus**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstatus) .</span><span class="sxs-lookup"><span data-stu-id="ba825-145">To determine whether an input stream can accept more data, call the [**IMediaObject::GetInputStatus**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-getinputstatus) method.</span></span> <span data-ttu-id="ba825-146">Questo metodo restituisce il \_ flag di input DMO \_ STATUSF \_ Accept \_ data se il flusso può accettare più input.</span><span class="sxs-lookup"><span data-stu-id="ba825-146">This method returns the DMO\_INPUT\_STATUSF\_ACCEPT\_DATA flag if the stream can accept more input.</span></span>

<span data-ttu-id="ba825-147">Il metodo **ProcessOutput** genera l'output per tutti i flussi di output in una sola volta.</span><span class="sxs-lookup"><span data-stu-id="ba825-147">The **ProcessOutput** method generates output for all of the output streams at once.</span></span> <span data-ttu-id="ba825-148">L'applicazione passa una matrice di strutture [**del \_ \_ \_ buffer dei dati di output DMO**](/previous-versions/windows/desktop/api/Mediaobj/ns-mediaobj-dmo_output_data_buffer) , una per ogni flusso di output.</span><span class="sxs-lookup"><span data-stu-id="ba825-148">The application passes in an array of [**DMO\_OUTPUT\_DATA\_BUFFER**](/previous-versions/windows/desktop/api/Mediaobj/ns-mediaobj-dmo_output_data_buffer) structures, one for each output stream.</span></span> <span data-ttu-id="ba825-149">Ogni struttura della matrice ha un puntatore a un oggetto **IMediaBuffer** .</span><span class="sxs-lookup"><span data-stu-id="ba825-149">Each structure in the array has a pointer to an **IMediaBuffer** object.</span></span> <span data-ttu-id="ba825-150">DMO scrive il maggior quantità di dati di output possibile nei buffer.</span><span class="sxs-lookup"><span data-stu-id="ba825-150">The DMO writes as much output data as it can into the buffers.</span></span> <span data-ttu-id="ba825-151">Vengono inoltre impostati diversi flag per segnalare lo stato dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="ba825-151">It also sets various flags to report the status of the operation.</span></span> <span data-ttu-id="ba825-152">Il \_ \_ flag di output DMO \_ BUFFERF data \_ incomplete indica che DMO può produrre più output dall'input esistente.</span><span class="sxs-lookup"><span data-stu-id="ba825-152">The DMO\_OUTPUT\_DATA\_BUFFERF\_INCOMPLETE flag indicates the DMO can produce more output from the existing input.</span></span> <span data-ttu-id="ba825-153">In tal caso, il client può chiamare nuovamente **ProcessOutput** .</span><span class="sxs-lookup"><span data-stu-id="ba825-153">In that case, the client can call **ProcessOutput** again.</span></span> <span data-ttu-id="ba825-154">In caso contrario, deve chiamare **ProcessInput** con più dati di input.</span><span class="sxs-lookup"><span data-stu-id="ba825-154">Otherwise, it should call **ProcessInput** with more input data.</span></span> <span data-ttu-id="ba825-155">DMO non modifica mai i dati nei buffer di input. scrive solo nei buffer di output.</span><span class="sxs-lookup"><span data-stu-id="ba825-155">The DMO never modifies the data in the input buffers; it writes only to the output buffers.</span></span>

<span data-ttu-id="ba825-156">Dopo aver recapitato tutti i dati in un flusso di input, chiamare il metodo [**IMediaObject::D di continuità**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-discontinuity) .</span><span class="sxs-lookup"><span data-stu-id="ba825-156">After you have delivered all of the data to an input stream, call the [**IMediaObject::Discontinuity**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-discontinuity) method.</span></span> <span data-ttu-id="ba825-157">DMO non accetta ulteriori input per tale flusso fino a quando non si elabora l'output rimanente (o si Scarica DMO).</span><span class="sxs-lookup"><span data-stu-id="ba825-157">The DMO does not accept further input to that stream until you process the remaining output (or flush the DMO).</span></span>

<span data-ttu-id="ba825-158">In qualsiasi momento dopo l'avvio del flusso, DMO è in grado di ricevere input o produrre output o entrambi.</span><span class="sxs-lookup"><span data-stu-id="ba825-158">At any point after streaming begins, the DMO is able to receive input or produce output, or both.</span></span> <span data-ttu-id="ba825-159">Di conseguenza, **GetInputStatus** restituisce DMO \_ input \_ STATUSF \_ accetta \_ dati oppure **ProcessOutput** restituisce DMO \_ output \_ data \_ BUFFERF \_ incompleto.</span><span class="sxs-lookup"><span data-stu-id="ba825-159">Therefore, either **GetInputStatus** returns DMO\_INPUT\_STATUSF\_ACCEPT\_DATA, or **ProcessOutput** returns DMO\_OUTPUT\_DATA\_BUFFERF\_INCOMPLETE.</span></span> <span data-ttu-id="ba825-160">L'applicazione mantiene il flusso di dati testando questi flag e chiamando di conseguenza **ProcessInput** o **ProcessOutput** .</span><span class="sxs-lookup"><span data-stu-id="ba825-160">The application keeps data flowing by testing for these flags and calling **ProcessInput** or **ProcessOutput** accordingly.</span></span> <span data-ttu-id="ba825-161">Per interrompere il flusso di dati, chiamare il metodo [**IMediaObject:: Flush**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-flush) .</span><span class="sxs-lookup"><span data-stu-id="ba825-161">To interrupt the data flow, call the [**IMediaObject::Flush**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-flush) method.</span></span> <span data-ttu-id="ba825-162">Questo metodo fa in modo che DMO elimini tutti i buffer che contiene internamente.</span><span class="sxs-lookup"><span data-stu-id="ba825-162">This method causes the DMO to discard any buffers it is holding internally.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ba825-163">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="ba825-163">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ba825-164">Hosting diretto di un DMO</span><span class="sxs-lookup"><span data-stu-id="ba825-164">Directly Hosting a DMO</span></span>](directly-hosting-a-dmo.md)
</dt> <dt>

[<span data-ttu-id="ba825-165">Elaborazione sul posto</span><span class="sxs-lookup"><span data-stu-id="ba825-165">In-Place Processing</span></span>](in-place-processing.md)
</dt> </dl>

 

 



