---
description: Uso del modello di classe DMO
ms.assetid: 5193ad08-aaee-47e3-93eb-a126a66d8f23
title: Uso del modello di classe DMO
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4db80017372f11f6c928e0e6a83b591967a84ee7
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "104057833"
---
# <a name="using-the-dmo-class-template"></a><span data-ttu-id="f1fb6-103">Uso del modello di classe DMO</span><span class="sxs-lookup"><span data-stu-id="f1fb6-103">Using the DMO Class Template</span></span>

<span data-ttu-id="f1fb6-104">DirectShow include un modello di classe, [**IMediaObjectImpl**](imediaobjectimpl-class-template.md), per l'implementazione di DMOS.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-104">DirectShow includes a class template, [**IMediaObjectImpl**](imediaobjectimpl-class-template.md), for implementing DMOs.</span></span> <span data-ttu-id="f1fb6-105">Il modello gestisce molte delle attività di "contabilità", ad esempio la convalida dei parametri di input.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-105">The template handles many of the "bookkeeping" tasks, such as validating input parameters.</span></span> <span data-ttu-id="f1fb6-106">Utilizzando il modello, è possibile concentrarsi sulle funzionalità specifiche di DMO.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-106">By using the template, you can focus on the functionality that is specific to your DMO.</span></span> <span data-ttu-id="f1fb6-107">Il modello contribuisce inoltre a garantire la creazione di un'implementazione affidabile.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-107">In addition, the template helps to ensure that you create a robust implementation.</span></span> <span data-ttu-id="f1fb6-108">Il modello è definito nel file di intestazione Dmoimpl. h, che si trova nella directory di inclusione dell'SDK.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-108">The template is defined in the header file Dmoimpl.h, located in the Include directory of the SDK.</span></span>

<span data-ttu-id="f1fb6-109">Il modello **IMediaObjectImpl** eredita l'interfaccia [**IMediaObject**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediaobject) .</span><span class="sxs-lookup"><span data-stu-id="f1fb6-109">The **IMediaObjectImpl** template inherits the [**IMediaObject**](/previous-versions/windows/desktop/api/Mediaobj/nn-mediaobj-imediaobject) interface.</span></span> <span data-ttu-id="f1fb6-110">Per creare un DMO usando il modello, definire una nuova classe che deriva da **IMediaObjectImpl**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-110">To create a DMO using the template, define a new class that derives from **IMediaObjectImpl**.</span></span> <span data-ttu-id="f1fb6-111">Il modello implementa tutti i metodi **IMediaObject** .</span><span class="sxs-lookup"><span data-stu-id="f1fb6-111">The template implements all of the **IMediaObject** methods.</span></span> <span data-ttu-id="f1fb6-112">Nella maggior parte dei casi, il modello chiama un metodo privato corrispondente nella classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-112">In most cases, the template calls a corresponding private method on the derived class.</span></span> <span data-ttu-id="f1fb6-113">Il modello offre le funzionalità seguenti:</span><span class="sxs-lookup"><span data-stu-id="f1fb6-113">The template provides the following features:</span></span>

-   <span data-ttu-id="f1fb6-114">Verifica dei parametri di base.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-114">Basic parameter checking.</span></span> <span data-ttu-id="f1fb6-115">I metodi del modello verificano che i parametri obbligatori non siano **null**, che gli indici di flusso siano compresi nell'intervallo e che i flag siano validi.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-115">The template methods verify that required parameters are not **NULL**, that stream indexes are within range, and that flags are valid.</span></span>
-   <span data-ttu-id="f1fb6-116">Blocco.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-116">Locking.</span></span> <span data-ttu-id="f1fb6-117">I metodi del modello chiamano due metodi interni, **Lock** e **Unlock**, per serializzare le operazioni su DMO.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-117">The template methods call two internal methods, **Lock** and **Unlock**, to serialize operations on the DMO.</span></span> <span data-ttu-id="f1fb6-118">Questa funzionalità garantisce che DMO sia thread-safe.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-118">This feature ensures that the DMO is thread-safe.</span></span>
-   <span data-ttu-id="f1fb6-119">Tipi di supporto.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-119">Media types.</span></span> <span data-ttu-id="f1fb6-120">Il modello archivia i tipi di supporto impostati dal client e fornisce i metodi delle funzioni di accesso per i tipi di supporto.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-120">The template stores the media types set by the client, and provides accessor methods for the media types.</span></span>
-   <span data-ttu-id="f1fb6-121">Streaming.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-121">Streaming.</span></span> <span data-ttu-id="f1fb6-122">Il modello impedisce lo streaming finché il client non ha impostato i tipi di supporto per tutti i flussi non facoltativi.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-122">The template prevents streaming until the client has set media types for all non-optional streams.</span></span> <span data-ttu-id="f1fb6-123">Garantisce inoltre che il metodo [**IMediaObject:: AllocateStreamingResources**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources) venga chiamato prima dell'inizio del flusso, garantendo così l'allocazione delle risorse.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-123">It also ensures that the [**IMediaObject::AllocateStreamingResources**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-allocatestreamingresources) method is called before streaming begins, which guarantees that resources are allocated.</span></span>

<span data-ttu-id="f1fb6-124">La classe derivata deve implementare l'interfaccia **IUnknown** ; il modello non fornisce questa interfaccia.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-124">The derived class must implement the **IUnknown** interface; the template does not provide this interface.</span></span> <span data-ttu-id="f1fb6-125">È possibile utilizzare il Active Template Library (ATL) per implementare **IUnknown** oppure è possibile fornire altre implementazioni.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-125">You can use the Active Template Library (ATL) to implement **IUnknown**, or you can provide some other implementation.</span></span> <span data-ttu-id="f1fb6-126">Il modello non implementa inoltre il meccanismo di blocco.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-126">The template also does not implement the locking mechanism.</span></span> <span data-ttu-id="f1fb6-127">La classe derivata deve implementare i metodi **Lock** e **Unlock** .</span><span class="sxs-lookup"><span data-stu-id="f1fb6-127">The derived class must implement the **Lock** and **Unlock** methods.</span></span> <span data-ttu-id="f1fb6-128">Se si crea la classe utilizzando ATL, è possibile utilizzare le implementazioni ATL predefinite.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-128">If you create your class using ATL, you can use the default ATL implementations.</span></span>

<span data-ttu-id="f1fb6-129">**Dichiarazione della classe derivata**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-129">**Declaring the Derived Class**</span></span>

<span data-ttu-id="f1fb6-130">Il modello di classe **IMediaObjectImpl** viene dichiarato nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="f1fb6-130">The **IMediaObjectImpl** class template is declared as follows:</span></span>


```C++
template <class _DERIVED_, int NUMBEROFINPUTS, int NUMBEROFOUTPUTS>
class IMediaObjectImpl : public ImediaObject
```



<span data-ttu-id="f1fb6-131">I tre parametri di modello sono \_ Derived \_ , NUMBEROFINPUTS e NUMBEROFOUTPUTS.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-131">The three template parameters are \_DERIVED\_, NUMBEROFINPUTS, and NUMBEROFOUTPUTS.</span></span> <span data-ttu-id="f1fb6-132">Impostare \_ derivato \_ uguale al nome della classe.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-132">Set \_DERIVED\_ equal to the name of your class.</span></span> <span data-ttu-id="f1fb6-133">Gli altri due parametri definiscono il numero di flussi di input e di output nell'DMO.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-133">The other two parameters define the number of input streams and output streams on the DMO.</span></span> <span data-ttu-id="f1fb6-134">Ad esempio, per creare una classe DMO denominata CMyDmo che supporta un flusso di input e due flussi di output, usare la dichiarazione seguente:</span><span class="sxs-lookup"><span data-stu-id="f1fb6-134">For example, to create a DMO class named CMyDmo that supports one input stream and two output streams, use the following declaration:</span></span>


```C++
class CMyDmo : public IMediaObjectImpl<CMyDmo, 1, 2>
```



<span data-ttu-id="f1fb6-135">Nella parte restante di questa sezione viene descritto il modo in cui il modello implementa i vari metodi in **IMediaObject**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-135">The remainder of this section describes how the template implements the various methods in **IMediaObject**.</span></span>

<span data-ttu-id="f1fb6-136">**Metodi per l'impostazione di tipi di supporto**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-136">**Methods for Setting Media Types**</span></span>

<span data-ttu-id="f1fb6-137">I metodi seguenti impostano o recuperano i tipi di supporto in DMO:</span><span class="sxs-lookup"><span data-stu-id="f1fb6-137">The following methods set or retrieve media types on the DMO:</span></span>

-   <span data-ttu-id="f1fb6-138">**GetInputType**, **GetOutputType**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-138">**GetInputType**, **GetOutputType**.</span></span> <span data-ttu-id="f1fb6-139">Questi metodi restituiscono i tipi di supporto preferiti, per numero di flusso e indice di tipo.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-139">These methods return preferred media types, by stream number and type index.</span></span> <span data-ttu-id="f1fb6-140">Il modello chiama **InternalGetInputType** o **InternalGetOutputType** sulla classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-140">The template calls **InternalGetInputType** or **InternalGetOutputType** on the derived class.</span></span>
-   <span data-ttu-id="f1fb6-141">**SetInputType**, **SetOutputType**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-141">**SetInputType**, **SetOutputType**.</span></span> <span data-ttu-id="f1fb6-142">Questi metodi impostano il tipo di supporto in un flusso, testano un tipo di supporto o cancellano un tipo di supporto.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-142">These methods set the media type on a stream, test a media type, or clear a media type.</span></span> <span data-ttu-id="f1fb6-143">Per convalidare il tipo di supporto, il modello chiama **InternalCheckInputType** o **InternalCheckOutputType** nella classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-143">To validate the media type, the template calls **InternalCheckInputType** or **InternalCheckOutputType** on the derived class.</span></span> <span data-ttu-id="f1fb6-144">La classe derivata restituisce S \_ OK per accettare il tipo o DMO \_ E \_ INVALIDTYPE per rifiutare il tipo.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-144">The derived class returns S\_OK to accept the type or DMO\_E\_INVALIDTYPE to reject the type.</span></span> <span data-ttu-id="f1fb6-145">Il modello gestisce l'impostazione o la cancellazione del tipo di supporto.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-145">The template handles setting or clearing the media type.</span></span>
-   <span data-ttu-id="f1fb6-146">**GetInputCurrentType**, **GetOutputCurrentType**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-146">**GetInputCurrentType**, **GetOutputCurrentType**.</span></span> <span data-ttu-id="f1fb6-147">Questi metodi restituiscono il tipo di supporto corrente per un flusso o \_ il \_ tipo DMO E \_ non \_ è impostato se non è impostato alcun tipo.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-147">These methods return the current media type for a stream, or DMO\_E\_TYPE\_NOT\_SET if no type is set.</span></span> <span data-ttu-id="f1fb6-148">Il modello implementa completamente questi metodi.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-148">The template completely implements these methods.</span></span>

<span data-ttu-id="f1fb6-149">**Metodi informativi**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-149">**Informational Methods**</span></span>

<span data-ttu-id="f1fb6-150">I metodi seguenti forniscono informazioni su DMO.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-150">The following methods provide information about the DMO.</span></span>

-   <span data-ttu-id="f1fb6-151">**GetInputMaxLatency**, **SetInputMaxLatency**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-151">**GetInputMaxLatency**, **SetInputMaxLatency**.</span></span> <span data-ttu-id="f1fb6-152">Questi metodi recuperano o impostano la latenza massima.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-152">These methods retrieve or set the maximum latency.</span></span> <span data-ttu-id="f1fb6-153">Il modello chiama **InternalGetInputMaxLatency** o **InternalSetInputMaxLatency** sulla classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-153">The template calls **InternalGetInputMaxLatency** or **InternalSetInputMaxLatency** on the derived class.</span></span>
-   <span data-ttu-id="f1fb6-154">**GetInputSizeInfo**, **GetOutputSizeInfo**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-154">**GetInputSizeInfo**, **GetOutputSizeInfo**.</span></span> <span data-ttu-id="f1fb6-155">Questi metodi restituiscono i requisiti del buffer DMO per un flusso specificato.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-155">These methods return the DMO's buffer requirements for a specified stream.</span></span> <span data-ttu-id="f1fb6-156">Se non è stato impostato alcun tipo di supporto per quel flusso, il modello restituisce DMO \_ E \_ Type \_ non \_ impostato.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-156">If no media type has been set on that stream, the template returns DMO\_E\_TYPE\_NOT\_SET.</span></span> <span data-ttu-id="f1fb6-157">In caso contrario, chiama **InternalGetInputSizeInfo** o **InternalGetOutputSizeInfo** sulla classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-157">Otherwise, it calls **InternalGetInputSizeInfo** or **InternalGetOutputSizeInfo** on the derived class.</span></span>
-   <span data-ttu-id="f1fb6-158">**GetInputStreamInfo**, **GetOutputStreamInfo**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-158">**GetInputStreamInfo**, **GetOutputStreamInfo**.</span></span> <span data-ttu-id="f1fb6-159">Questi metodi restituiscono diversi flag che indicano il modo in cui il client deve formattare i dati.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-159">These methods return various flags that indicate how the client should format the data.</span></span> <span data-ttu-id="f1fb6-160">Il modello chiama **InternalGetInputStreamInfo** o **InternalGetOutputStreamInfo** sulla classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-160">The template calls **InternalGetInputStreamInfo** or **InternalGetOutputStreamInfo** on the derived class.</span></span>
-   <span data-ttu-id="f1fb6-161">**GetStreamCount**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-161">**GetStreamCount**.</span></span> <span data-ttu-id="f1fb6-162">Questo metodo restituisce il numero di flussi di input e di output.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-162">This method returns the number of input and output streams.</span></span> <span data-ttu-id="f1fb6-163">Il modello implementa questo metodo, usando i parametri del modello.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-163">The template implements this method, using the template parameters.</span></span>

<span data-ttu-id="f1fb6-164">**Metodi per l'allocazione delle risorse**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-164">**Methods for Resource Allocation**</span></span>

-   <span data-ttu-id="f1fb6-165">Il metodo **AllocateStreamingResources** alloca le risorse necessarie a DMO prima che inizi il flusso.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-165">The **AllocateStreamingResources** method allocates any resources the DMO needs before streaming begins.</span></span> <span data-ttu-id="f1fb6-166">Il metodo **FreeStreamingResources** rilascia le stesse risorse.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-166">The **FreeStreamingResources** method releases the same resources.</span></span> <span data-ttu-id="f1fb6-167">Il modello chiama rispettivamente **InternalAllocateStreamingResources** e **InternalFreeStreamingResources**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-167">The template calls **InternalAllocateStreamingResources** and **InternalFreeStreamingResources**, respectively.</span></span>

<span data-ttu-id="f1fb6-168">Non è necessario che il client di DMO chiami questi metodi, ma il modello chiama automaticamente **AllocateStreamingResources** prima dell'avvio del flusso.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-168">The client of the DMO is not required to call these methods, but the template automatically calls **AllocateStreamingResources** before streaming starts.</span></span> <span data-ttu-id="f1fb6-169">Pertanto, DMO può presumere che le risorse siano state allocate correttamente nel momento in cui viene chiamato **ProcessInput** .</span><span class="sxs-lookup"><span data-stu-id="f1fb6-169">Therefore, the DMO can assume that resources are have been allocated correctly by the time **ProcessInput** is called.</span></span> <span data-ttu-id="f1fb6-170">Il DMO deve chiamare **FreeStreamingResources** nel relativo distruttore.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-170">The DMO should call **FreeStreamingResources** in its destructor.</span></span>

<span data-ttu-id="f1fb6-171">Inoltre, quando il modello chiama **InternalAllocateStreamingResources**, imposta un flag interno, in modo che non chiami di nuovo il metodo fino a quando non viene chiamato **InternalFreeStreamingResources**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-171">Also, when the template calls **InternalAllocateStreamingResources**, it sets an internal flag, so that it does not call that method again until calling **InternalFreeStreamingResources**.</span></span> <span data-ttu-id="f1fb6-172">Ciò garantisce che le risorse non vengano riallocate accidentalmente, causando perdite di memoria.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-172">This ensures that resources are not re-allocated accidentally, which could cause memory leaks.</span></span>

<span data-ttu-id="f1fb6-173">**Metodi per lo streaming**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-173">**Methods for Streaming**</span></span>

<span data-ttu-id="f1fb6-174">Per eseguire lo streaming dei dati, vengono usati i metodi seguenti:</span><span class="sxs-lookup"><span data-stu-id="f1fb6-174">The following methods are used to stream data:</span></span>

-   <span data-ttu-id="f1fb6-175">**GetInputStatus**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-175">**GetInputStatus**.</span></span> <span data-ttu-id="f1fb6-176">Questo metodo indica se l'oggetto DMO è in grado di accettare l'input in questo momento.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-176">This method indicates whether the DMO can accept input at this time.</span></span> <span data-ttu-id="f1fb6-177">Il modello chiama **InternalAcceptingInput** sulla classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-177">The template calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="f1fb6-178">Se DMO è in grado di accettare l'input, la classe derivata restituisce \_ OK e il modello imposta \_ il \_ bit di input DMO STATUSF i \_ \_ dati nel parametro *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="f1fb6-178">If the DMO can accept input, the derived class returns S\_OK and the template sets the DMO\_INPUT\_STATUSF\_ACCEPT\_DATA bit in the *dwFlags* parameter.</span></span> <span data-ttu-id="f1fb6-179">In caso contrario, la classe derivata restituisce \_ false e il modello imposta *dwFlags* su zero.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-179">Otherwise, the derived class returns S\_FALSE and the template sets *dwFlags* to zero.</span></span>
-   <span data-ttu-id="f1fb6-180">**ProcessInput**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-180">**ProcessInput**.</span></span> <span data-ttu-id="f1fb6-181">Questo metodo elabora un buffer di input.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-181">This method processes an input buffer.</span></span> <span data-ttu-id="f1fb6-182">Il modello chiama **AllocateStreamingResources**, descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-182">The template calls **AllocateStreamingResources**, described previously.</span></span> <span data-ttu-id="f1fb6-183">Chiama quindi **InternalAcceptingInput** sulla classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-183">Then it calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="f1fb6-184">Se DMO può accettare nuovo input, il modello chiama **InternalProcessInput**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-184">If the DMO can accept new input, the template calls **InternalProcessInput**.</span></span>
-   <span data-ttu-id="f1fb6-185">**ProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-185">**ProcessOutput**.</span></span> <span data-ttu-id="f1fb6-186">Questo metodo elabora un set di buffer di output, un buffer per ogni flusso di output.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-186">This method processes a set of output buffers, one buffer for each output stream.</span></span> <span data-ttu-id="f1fb6-187">Il modello chiama **AllocateStreamingResources** e quindi **InternalProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-187">The template calls **AllocateStreamingResources** and then **InternalProcessOutput**.</span></span>
-   <span data-ttu-id="f1fb6-188">**Discontinuità**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-188">**Discontinuity**.</span></span> <span data-ttu-id="f1fb6-189">Questo metodo segnala una discontinuità in un flusso di input.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-189">This method signals a discontinuity in an input stream.</span></span> <span data-ttu-id="f1fb6-190">Il modello chiama **InternalAcceptingInput** sulla classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-190">The template calls **InternalAcceptingInput** on the derived class.</span></span> <span data-ttu-id="f1fb6-191">Se il metodo restituisce S \_ OK, il modello chiama **InternalDiscontinuity** sulla classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-191">If that method returns S\_OK, the template calls **InternalDiscontinuity** on the derived class.</span></span>
-   <span data-ttu-id="f1fb6-192">**Scarica**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-192">**Flush**.</span></span> <span data-ttu-id="f1fb6-193">Questo metodo Scarica DMO.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-193">This method flushes the DMO.</span></span> <span data-ttu-id="f1fb6-194">Il modello chiama **InternalFlush** sulla classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-194">The template calls **InternalFlush** on the derived class.</span></span> <span data-ttu-id="f1fb6-195">Il DMO deve rimuovere tutti i buffer di input che ancora conserva per essere elaborati.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-195">The DMO should discard any input buffers that it still holds to be processed.</span></span>

<span data-ttu-id="f1fb6-196">Il modello non fornisce alcun supporto diretto per l'interfaccia [**IMediaObjectInPlace**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobjectinplace) .</span><span class="sxs-lookup"><span data-stu-id="f1fb6-196">The template does not provide any direct support for the [**IMediaObjectInPlace**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobjectinplace) interface.</span></span>

<span data-ttu-id="f1fb6-197">**Metodi per il blocco**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-197">**Methods for Locking**</span></span>

<span data-ttu-id="f1fb6-198">Il blocco viene usato per proteggere lo stato di DMO in un ambiente a thread multipli.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-198">Locking is used to protect the DMO's state in a multithreaded environment.</span></span> <span data-ttu-id="f1fb6-199">In un progetto ATL il metodo [**IMediaObject:: Lock**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-lock) causa un conflitto di nome con il metodo di **blocco** ATL.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-199">In an ATL project, the [**IMediaObject::Lock**](/previous-versions/windows/desktop/api/Mediaobj/nf-mediaobj-imediaobject-lock) method causes a name conflict with the ATL **Lock** method.</span></span> <span data-ttu-id="f1fb6-200">Per risolvere il conflitto, il modello Rinomina il metodo **IMediaObject** in **DMOLock**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-200">To resolve the conflict, the template renames the **IMediaObject** method to **DMOLock**.</span></span> <span data-ttu-id="f1fb6-201">Quando si compila la classe derivata, definire Correggi \_ il \_ nome del blocco prima di includere il file di intestazione DMO. h:</span><span class="sxs-lookup"><span data-stu-id="f1fb6-201">When you compile the derived class, define FIX\_LOCK\_NAME before including the header file Dmo.h:</span></span>


```C++
#define FIX_LOCK_NAME
#include <dmo.h>
```



<span data-ttu-id="f1fb6-202">Questa direttiva fa in modo che il preprocessore sostituisca **DMOLock** per il **blocco** nella dichiarazione dell'interfaccia **IMediaObject** .</span><span class="sxs-lookup"><span data-stu-id="f1fb6-202">This directive causes the preprocessor to substitute **DMOLock** for **Lock** in the declaration of the **IMediaObject** interface.</span></span> <span data-ttu-id="f1fb6-203">Le applicazioni possono comunque richiamare il metodo utilizzando il **blocco** del nome, perché l'ordine vtable non cambia.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-203">Applications can still invoke the method using the name **Lock**, because the vtable order does not change.</span></span> <span data-ttu-id="f1fb6-204">Il metodo **DMOLock** chiama **Lock** o **Unlock** sulla classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-204">The **DMOLock** method calls **Lock** or **Unlock** on the derived class.</span></span> <span data-ttu-id="f1fb6-205">Se si utilizza ATL per implementare la classe derivata, questi metodi sono già definiti da ATL, pertanto non è necessario alcun codice aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-205">If you are using ATL to implement the derived class, these methods are already defined by ATL, so no additional code is necessary.</span></span> <span data-ttu-id="f1fb6-206">Se non si utilizza ATL, è necessario fornire i metodi **Lock** e **Unlock** nella classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-206">If you are not using ATL, you must provide **Lock** and **Unlock** methods in your derived class.</span></span>

<span data-ttu-id="f1fb6-207">Il modello blocca automaticamente il DMO in ognuno dei metodi **IMediaObject** .</span><span class="sxs-lookup"><span data-stu-id="f1fb6-207">The template automatically locks the DMO in each of the **IMediaObject** methods.</span></span> <span data-ttu-id="f1fb6-208">Potrebbe essere necessario che la classe derivata blocchi DMO all'interno di altri metodi pubblici implementati, ad esempio se supporta **IMediaObjectInPlace**.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-208">The derived class might need to lock the DMO inside other public methods that it implements (for example, if it supports **IMediaObjectInPlace**).</span></span> <span data-ttu-id="f1fb6-209">Il modello di classe fornisce anche una classe helper interna, [**IMediaObjectImpl:: Lockit**](imediaobjectimpl-lockit.md), che è utile per bloccare e sbloccare DMO.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-209">The class template also provides an internal helper class, [**IMediaObjectImpl::LockIt**](imediaobjectimpl-lockit.md), which is useful for locking and unlocking the DMO.</span></span>

<span data-ttu-id="f1fb6-210">**Summary**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-210">**Summary**</span></span>

<span data-ttu-id="f1fb6-211">Per i metodi **IMediaObject** seguenti, il modello chiama un metodo corrispondente con la stessa firma nella classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-211">For the following **IMediaObject** methods, the template calls a corresponding method with the same signature on the derived class.</span></span> <span data-ttu-id="f1fb6-212">La classe derivata deve implementare ognuno dei metodi illustrati nella seconda colonna.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-212">The derived class must implement each of the methods shown in the second column.</span></span>



| <span data-ttu-id="f1fb6-213">Metodo IMediaObject</span><span class="sxs-lookup"><span data-stu-id="f1fb6-213">IMediaObject Method</span></span>            | <span data-ttu-id="f1fb6-214">Metodo della classe derivata</span><span class="sxs-lookup"><span data-stu-id="f1fb6-214">Derived Class Method</span></span>                   |
|--------------------------------|----------------------------------------|
| <span data-ttu-id="f1fb6-215">**AllocateStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-215">**AllocateStreamingResources**</span></span> | <span data-ttu-id="f1fb6-216">**InternalAllocateStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-216">**InternalAllocateStreamingResources**</span></span> |
| <span data-ttu-id="f1fb6-217">**Discontinuità**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-217">**Discontinuity**</span></span>              | <span data-ttu-id="f1fb6-218">**InternalDiscontinuity**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-218">**InternalDiscontinuity**</span></span>              |
| <span data-ttu-id="f1fb6-219">**Svuotamento**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-219">**Flush**</span></span>                      | <span data-ttu-id="f1fb6-220">**InternalFlush**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-220">**InternalFlush**</span></span>                      |
| <span data-ttu-id="f1fb6-221">**FreeStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-221">**FreeStreamingResources**</span></span>     | <span data-ttu-id="f1fb6-222">**InternalFreeStreamingResources**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-222">**InternalFreeStreamingResources**</span></span>     |
| <span data-ttu-id="f1fb6-223">**GetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-223">**GetInputMaxLatency**</span></span>         | <span data-ttu-id="f1fb6-224">**InternalGetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-224">**InternalGetInputMaxLatency**</span></span>         |
| <span data-ttu-id="f1fb6-225">**GetInputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-225">**GetInputSizeInfo**</span></span>           | <span data-ttu-id="f1fb6-226">**InternalGetInputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-226">**InternalGetInputSizeInfo**</span></span>           |
| <span data-ttu-id="f1fb6-227">**GetInputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-227">**GetInputStreamInfo**</span></span>         | <span data-ttu-id="f1fb6-228">**InternalGetInputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-228">**InternalGetInputStreamInfo**</span></span>         |
| <span data-ttu-id="f1fb6-229">**GetInputType**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-229">**GetInputType**</span></span>               | <span data-ttu-id="f1fb6-230">**InternalGetInputType**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-230">**InternalGetInputType**</span></span>               |
| <span data-ttu-id="f1fb6-231">**GetOutputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-231">**GetOutputSizeInfo**</span></span>          | <span data-ttu-id="f1fb6-232">**InternalGetOutputSizeInfo**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-232">**InternalGetOutputSizeInfo**</span></span>          |
| <span data-ttu-id="f1fb6-233">**GetOutputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-233">**GetOutputStreamInfo**</span></span>        | <span data-ttu-id="f1fb6-234">**InternalGetOutputStreamInfo**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-234">**InternalGetOutputStreamInfo**</span></span>        |
| <span data-ttu-id="f1fb6-235">**GetOutputType**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-235">**GetOutputType**</span></span>              | <span data-ttu-id="f1fb6-236">**InternalGetOutputType**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-236">**InternalGetOutputType**</span></span>              |
| <span data-ttu-id="f1fb6-237">**ProcessInput**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-237">**ProcessInput**</span></span>               | <span data-ttu-id="f1fb6-238">**InternalProcessInput**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-238">**InternalProcessInput**</span></span>               |
| <span data-ttu-id="f1fb6-239">**ProcessOutput**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-239">**ProcessOutput**</span></span>              | <span data-ttu-id="f1fb6-240">**InternalProcessOutput**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-240">**InternalProcessOutput**</span></span>              |
| <span data-ttu-id="f1fb6-241">**SetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-241">**SetInputMaxLatency**</span></span>         | <span data-ttu-id="f1fb6-242">**InternalSetInputMaxLatency**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-242">**InternalSetInputMaxLatency**</span></span>         |



 

<span data-ttu-id="f1fb6-243">Per i metodi **IMediaObject** rimanenti, non esiste una corrispondenza uno-a-uno tra i metodi dei modelli e i metodi della classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-243">For the remaining **IMediaObject** methods, there is not a one-to-one correspondence between template methods and derived-class methods.</span></span> <span data-ttu-id="f1fb6-244">Nella tabella seguente vengono riepilogati i metodi completamente implementati dal modello e quali metodi chiamano altri metodi sulla classe derivata.</span><span class="sxs-lookup"><span data-stu-id="f1fb6-244">The following table summarizes which methods are fully implemented by the template, and which methods call other methods on the derived class.</span></span>



| <span data-ttu-id="f1fb6-245">Metodo IMediaObject</span><span class="sxs-lookup"><span data-stu-id="f1fb6-245">IMediaObject Method</span></span>                   | <span data-ttu-id="f1fb6-246">Metodo della classe derivata</span><span class="sxs-lookup"><span data-stu-id="f1fb6-246">Derived Class Method</span></span>                                                             |
|---------------------------------------|----------------------------------------------------------------------------------|
| <span data-ttu-id="f1fb6-247">**GetInputCurrentType**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-247">**GetInputCurrentType**</span></span>               | <span data-ttu-id="f1fb6-248">Completamente implementato</span><span class="sxs-lookup"><span data-stu-id="f1fb6-248">Fully implemented</span></span>                                                                |
| <span data-ttu-id="f1fb6-249">**GetOutputCurrentType**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-249">**GetOutputCurrentType**</span></span>              | <span data-ttu-id="f1fb6-250">Completamente implementato</span><span class="sxs-lookup"><span data-stu-id="f1fb6-250">Fully implemented</span></span>                                                                |
| <span data-ttu-id="f1fb6-251">**GetStreamCount**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-251">**GetStreamCount**</span></span>                    | <span data-ttu-id="f1fb6-252">Completamente implementato</span><span class="sxs-lookup"><span data-stu-id="f1fb6-252">Fully implemented</span></span>                                                                |
| <span data-ttu-id="f1fb6-253">**GetInputStatus**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-253">**GetInputStatus**</span></span>                    | <span data-ttu-id="f1fb6-254">[**InternalAcceptingInput**](/previous-versions/ms809095(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="f1fb6-254">[**InternalAcceptingInput**](/previous-versions/ms809095(v=msdn.10))</span></span>        |
| <span data-ttu-id="f1fb6-255">**Lock** (implementato come **DMOLock**)</span><span class="sxs-lookup"><span data-stu-id="f1fb6-255">**Lock** (implemented as **DMOLock**)</span></span> | <span data-ttu-id="f1fb6-256">[**Blocco**](/previous-versions/ms809100(v=msdn.10)), [ **sblocco**](/previous-versions/ms809101(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="f1fb6-256">[**Lock**](/previous-versions/ms809100(v=msdn.10)), [**Unlock**](/previous-versions/ms809101(v=msdn.10))</span></span> |
| <span data-ttu-id="f1fb6-257">**SetInputType**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-257">**SetInputType**</span></span>                      | <span data-ttu-id="f1fb6-258">[**InternalCheckInputType**](/previous-versions/ms809096(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="f1fb6-258">[**InternalCheckInputType**](/previous-versions/ms809096(v=msdn.10))</span></span>        |
| <span data-ttu-id="f1fb6-259">**SetOutputType**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-259">**SetOutputType**</span></span>                     | <span data-ttu-id="f1fb6-260">[**InternalCheckOutputType**](/previous-versions/ms809098(v=msdn.10))</span><span class="sxs-lookup"><span data-stu-id="f1fb6-260">[**InternalCheckOutputType**](/previous-versions/ms809098(v=msdn.10))</span></span>      |



 

## <a name="related-topics"></a><span data-ttu-id="f1fb6-261">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="f1fb6-261">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f1fb6-262">**Modello di classe IMediaObjectImpl**</span><span class="sxs-lookup"><span data-stu-id="f1fb6-262">**IMediaObjectImpl Class Template**</span></span>](imediaobjectimpl-class-template.md)
</dt> <dt>

[<span data-ttu-id="f1fb6-263">Scrittura di un DMO</span><span class="sxs-lookup"><span data-stu-id="f1fb6-263">Writing a DMO</span></span>](writing-a-dmo.md)
</dt> </dl>

 

 
