---
description: Specifica operativa di accelerazione video DirectX IAMVideoAccelerator
ms.assetid: 25ee05d5-8554-4739-9122-e3c0255bf965
title: Specifica operativa di accelerazione video DirectX IAMVideoAccelerator
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3360e18e91197f2a15a36fb112f0419b6382e915
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/06/2021
ms.locfileid: "103965481"
---
# <a name="directx-video-acceleration-iamvideoaccelerator-operational-specification"></a><span data-ttu-id="4aaa4-103">Specifica operativa di accelerazione video DirectX IAMVideoAccelerator</span><span class="sxs-lookup"><span data-stu-id="4aaa4-103">DirectX Video Acceleration IAMVideoAccelerator Operational Specification</span></span>

<span data-ttu-id="4aaa4-104">Il meccanismo preciso di funzionamento è il seguente:</span><span class="sxs-lookup"><span data-stu-id="4aaa4-104">The precise mechanism of operation is as follows:</span></span>

1.  <span data-ttu-id="4aaa4-105">A ogni profilo in modalità limitata definito nel presente documento è associato un GUID di DirectX VA che può essere supportato da un pin di input downstream [**Ipin:: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) e [**Ipin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) ed elencato in [**IAMVideoAccelerator:: GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).</span><span class="sxs-lookup"><span data-stu-id="4aaa4-105">Each restricted mode profile defined herein has an associated DirectX VA GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in [**IAMVideoAccelerator::GetVideoAcceleratorGUIDs**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getvideoacceleratorguids).</span></span>
2.  <span data-ttu-id="4aaa4-106">Analogamente, ogni tipo di protocollo di crittografia per l'uso con DirectX VA deve avere un GUID di tipo protocollo di crittografia associato che può essere supportato da un pin di input downstream [**Ipin:: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) e [**Ipin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) ed elencato in **IAMVideoAccelerator:: GetVideoAcceleratorGUIDs**.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-106">Similarly, each encryption protocol type for use with DirectX VA shall have an associated encryption protocol type GUID which can be supported by a downstream input pin's [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) and [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) and listed in **IAMVideoAccelerator::GetVideoAcceleratorGUIDs**.</span></span> <span data-ttu-id="4aaa4-107">Il GUID "No Encryption" DXVA \_ non deve essere inviato in questo elenco, in quanto il supporto per esso è obbligatorio e pertanto implicito.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-107">The "no encryption" GUID DXVA\_NoEncrypt shall not be sent in this list, as support for it is required and therefore implicit.</span></span>
3.  <span data-ttu-id="4aaa4-108">Dopo la chiamata di [**Ipin:: ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) per tentare una connessione al pin di input downstream, [**IAMVideoAcceleratorNotify:: GetCreateVideoAcceleratorData**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) del decodificatore deve restituire un puntatore a una \_ struttura di dati DXVA connectMode contenente le informazioni sulla modalità di connessione per la connessione.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-108">After calling [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) to attempt a connection to the downstream input pin, the decoder's [**IAMVideoAcceleratorNotify::GetCreateVideoAcceleratorData**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoacceleratornotify-getcreatevideoacceleratordata) shall return a pointer to a DXVA\_ConnectMode data structure containing the connection mode information for the connection.</span></span> <span data-ttu-id="4aaa4-109">[**IAMVideoAccelerator:: GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) deve essere chiamato con \* pdwNumTypesCompBuffers = 16 e deve restituire informazioni sul buffer compresso in base alla convenzione che il numero di tipo di ogni buffer (come definito nella sezione 3,4 della specifica DirectX VA) può essere usato direttamente come indice in base zero nella matrice di strutture di dati **AMVACompBufferInfo** restituite.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-109">[**IAMVideoAccelerator::GetCompBufferInfo**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-getcompbufferinfo) shall be called with \*pdwNumTypesCompBuffers = 16 and shall return compressed buffer information based on the convention that the type number of each buffer (as defined in Section 3.4 of the DirectX VA specification) can be used directly as the zero-based index into the array of **AMVACompBufferInfo** data structures that is returned.</span></span> <span data-ttu-id="4aaa4-110">Questa operazione richiede che per tutti i tipi di buffer che non verranno utilizzati (incluso il tipo di buffer 0, poiché non esiste un utilizzo definito di tale tipo di buffer), il driver Accelerator fornirà le strutture di dati AMVACompBufferInfo con una forma di valori di parametro "fittizio", ad esempio dwNumCompBuffers = 0, dwWidthToCreate = 0, dwHeightToCreate = 0 e dwBytesToAllocate = 0.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-110">This requires that for any buffer types that will not be used (including buffer type 0, since there is no defined use of that buffer type), the accelerator driver will provide AMVACompBufferInfo data structures with some form of "dummy" parameter values (such as dwNumCompBuffers=0, dwWidthToCreate=0, dwHeightToCreate=0, and dwBytesToAllocate=0).</span></span>
4.  <span data-ttu-id="4aaa4-111">Le indicazioni della funzione DXVA e i buffer di dati associati vengono inviati tramite [**IAMVideoAccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span><span class="sxs-lookup"><span data-stu-id="4aaa4-111">DXVA function indications and associated data buffers are sent using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="4aaa4-112">La funzione DXVA è indicata nel parametro dwFunction della chiamata.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-112">The DXVA function is indicated in the dwFunction parameter of the call.</span></span> <span data-ttu-id="4aaa4-113">Le uniche funzioni DXVA che sono rilevanti per l'inizializzazione sono DXVA \_ ConfigQueryOrReplyFunc e DXVA \_ EncryptProtocolFunc.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-113">The only DXVA functions that are relevant for initialization are DXVA\_ConfigQueryOrReplyFunc and DXVA\_EncryptProtocolFunc.</span></span>
    -   <span data-ttu-id="4aaa4-114">Se dwFunction contiene un \_ CONFIGQUERYORREPLYFUNC DXVA, il puntatore lpPrivateInputData per passare i dati all'acceleratore in questa chiamata deve puntare a una struttura di dati di configurazione, il puntatore lpPrivateOutputData per la ricezione di informazioni dall'acceleratore deve puntare a un'area in cui è possibile collocare una struttura di dati di configurazione alternativa o duplicata, il puntatore pamvaBufferInfo per una matrice di AMVABUFFERINFO deve essere **null** e dwNumBuffers deve essere zero.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-114">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="4aaa4-115">Il valore HRESULT restituito contiene l' \_ indicazione s OK o s \_ false oppure e \_ non riesce o e \_ INVALIDARG o un'altra indicazione di errore HRESULT nel caso di un problema grave nell'esecuzione del protocollo, ad esempio un parametro di configurazione non valido.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-115">The returned HRESULT contains the S\_OK or S\_FALSE indication, or E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid configuration parameter).</span></span> <span data-ttu-id="4aaa4-116">Tutte le chiamate a **IAMVideoAccelerator:: Execute** per tutti gli usi di DXVA \_ ConfigQueryOrReplyFunc devono precedere tutte le altre chiamate a **IAMVideoAccelerator:: Execute**.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-116">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="4aaa4-117">Se dwFunction contiene un \_ ENCRYPTPROTOCOLFUNC DXVA, il puntatore lpPrivateInputData per il passaggio dei dati all'acceleratore in questa chiamata deve puntare a una struttura di dati del protocollo di crittografia che inizia con DXVA \_ EncryptProtocolHeader, il puntatore lpPrivateOutputData per la ricezione di informazioni dall'acceleratore deve puntare a un'area in cui i dati da restituire, ad esempio un certificato, dal protocollo di crittografia (che inizierà con DXVA \_ EncryptProtocolHeader) possono essere inseriti, il puntatore pamvaBufferInfo per una matrice di AMVABUFFERINFO deve essere **null** e dwNumBuffers deve essere zero.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-117">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="4aaa4-118">Il valore HRESULT restituito contiene S OK fino a quando \_ il protocollo di crittografia funziona normalmente e contiene e \_ non riesce o e \_ INVALIDARG o un'altra indicazione di errore HRESULT nel caso di un problema grave nell'esecuzione del protocollo.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-118">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>

        <span data-ttu-id="4aaa4-119">Dopo l'inizializzazione dell'operazione nel modo precedente, l'operazione effettiva del decodificatore procede come segue:</span><span class="sxs-lookup"><span data-stu-id="4aaa4-119">After initialization of operation in the above fashion, the actual operation of the decoder proceeds as follows:</span></span>

5.  <span data-ttu-id="4aaa4-120">**IAMVideoAccelerator:: BeginFrame** deve essere chiamato prima di inviare qualsiasi bDXVA \_ Func con i parametri del buffer compressi che provocano Scritture in una superficie di destinazione non compressa.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-120">**IAMVideoAccelerator::BeginFrame** shall be called prior to sending any bDXVA\_Func with compressed buffer parameters which cause writes to an uncompressed destination surface.</span></span> <span data-ttu-id="4aaa4-121">Lo scopo di [**IAMVideoAccelerator:: BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) in DirectX va è associare le aree di destinazione ai valori di indice e inviare una notifica al driver dell'acceleratore video dell'intento di avviare la scrittura di una superficie, in modo che il driver possa rispondere indicando se la superficie è pronta per la sovrascrittura.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-121">The purpose of [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) in DirectX VA is to associate destination surfaces with index values and to notify the video accelerator driver of the intent to initiate writes a surface so that the driver can respond with an indication of whether the surface is ready to be overwritten.</span></span> <span data-ttu-id="4aaa4-122">La struttura **AMVABeginFrameInfo** passata in **IAMVideoAccelerator:: BeginFrame** deve contenere un puntatore PINPUTDATA al parametro Single Word wBeginPictureIndex corrispondente all'indice del frame passato in **IAMVideoAccelerator:: BeginFrame** (e dwSizeInputData sarà 2).</span><span class="sxs-lookup"><span data-stu-id="4aaa4-122">The **AMVABeginFrameInfo** structure passed in **IAMVideoAccelerator::BeginFrame** shall contain a pInputData pointer to single WORD wBeginPictureIndex parameter matching the frame index passed into **IAMVideoAccelerator::BeginFrame** (and dwSizeInputData shall be 2).</span></span> <span data-ttu-id="4aaa4-123">Si tratta dell'indice da usare in un buffer compresso per eseguire il comando di scrittura sull'area (ad esempio, da usare come wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex o wPicResampleDestPicIndex).</span><span class="sxs-lookup"><span data-stu-id="4aaa4-123">This is the index to be used in a compressed buffer to command a write to the surface (for example, to be used as wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="4aaa4-124">Ogni chiamata a **IAMVideoAccelerator:: BeginFrame** deve essere abbinata a una chiamata corrispondente a [**IAMVideoAccelerator:: EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) come descritto di seguito.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-124">Each call to **IAMVideoAccelerator::BeginFrame** shall be paired with a corresponding call to [**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) as described below.</span></span> <span data-ttu-id="4aaa4-125">Se, ad esempio, un'immagine compressa deve essere decodificata e quindi alpha blended using front-end buffer-to-buffer blending con un'immagine grafica, è presente una chiamata a **IAMVideoAccelerator:: BeginFrame** prima di decodificare l'immagine compressa in una superficie specificata in wDecodedPictureIndex, quindi una chiamata a **IAMVideoAccelerator:: EndFrame** dopo aver passato tutti i buffer compressi usati per decodificare l'immagine, quindi una seconda chiamata a **IAMVideoAccelerator:: BeginFrame** prima di eseguire il comando della combinazione di fusione alfa della sorgente grafica con l'immagine decodificata in una superficie specificata in wBlendedDestinationIndex e quindi una seconda chiamata a **IAMVideoAccelerator:: EndFrame** dopo l'operazione di combinazione di Alpha Blend. Il puntatore pOutputData in AMVABeginFrameInfo deve essere **null** (e dwSizeOutputData deve essere "0").</span><span class="sxs-lookup"><span data-stu-id="4aaa4-125">For example, if a compressed picture is to be decoded and then alpha blended using front-end buffer-to-buffer blending with a graphic image, there would be a call to **IAMVideoAccelerator::BeginFrame** prior to decoding the compressed picture into a surface specified in wDecodedPictureIndex, then a call to **IAMVideoAccelerator::EndFrame** after passing all compressed buffers used to decode the picture, then a second call to **IAMVideoAccelerator::BeginFrame** prior to commanding alpha blending combination of the graphic source with the decoded picture into a surface specified in wBlendedDestinationIndex, and then a second call to **IAMVideoAccelerator::EndFrame** after the alpha blend combination operation.The pointer pOutputData in AMVABeginFrameInfo shall be **NULL** (and dwSizeOutputData shall be "0").</span></span> <span data-ttu-id="4aaa4-126">Il valore HRESULT restituito da **IAMVideoAccelerator:: BeginFrame** deve essere:</span><span class="sxs-lookup"><span data-stu-id="4aaa4-126">The HRESULT that is returned by **IAMVideoAccelerator::BeginFrame** shall be:</span></span>
    -   <span data-ttu-id="4aaa4-127">S \_ OK se la superficie non compressa è disponibile e pronta per l'uso.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-127">S\_OK if the uncompressed surface is available and ready for use.</span></span>
    -   <span data-ttu-id="4aaa4-128">E \_ in sospeso se la superficie non compressa non è ancora disponibile per l'uso, ma diventerà disponibile a breve (se la superficie non compressa viene letta per la visualizzazione e la lettura/visualizzazione della superficie non è ancora stata completata).</span><span class="sxs-lookup"><span data-stu-id="4aaa4-128">E\_PENDING if the uncompressed surface is not yet available for use but will become available soon (if the uncompressed surface is being read for display and the reading/display of the surface has not yet been completed).</span></span>
    -   <span data-ttu-id="4aaa4-129">E \_ non riescono o e \_ INVALIDARG un'altra indicazione di errore solo se viene rilevato un errore di protocollo o formato dati, ad esempio un valore non corretto di dwSizeInputData o un POutputData non **null** .</span><span class="sxs-lookup"><span data-stu-id="4aaa4-129">E\_FAIL or E\_INVALIDARG some other error indication only if a data format or protocol error is detected (such as an incorrect value of dwSizeInputData or a non-**NULL** pOutputData).</span></span>
6.  <span data-ttu-id="4aaa4-130">Le indicazioni della funzione DXVA e i buffer di dati associati vengono inviati tramite **IAMVideoAccelerator:: Execute**.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-130">DXVA function indications and associated data buffers are sent using **IAMVideoAccelerator::Execute**.</span></span> <span data-ttu-id="4aaa4-131">\_Nella stessa chiamata a [**IAMVideoAccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute)è possibile indicare più di un valore bDXVA Func.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-131">More than one bDXVA\_Func value may be indicated in the same call to [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute).</span></span> <span data-ttu-id="4aaa4-132">I \_ valori bDXVA Func verranno compressi nel parametro dwFunction della chiamata, con il primo comando Function negli otto MSBS, il comando successivo nei successivi otto bit e così via, con eventuali bit rimanenti con zeri.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-132">The bDXVA\_Func values shall be packed into the dwFunction parameter of the call, with the first function command in the eight MSBs, the next command in the next eight bits, and so on, with any remaining bits padded out with zeros.</span></span> <span data-ttu-id="4aaa4-133">Il valore 0xFF per bDXVA \_ Func indica che bDXVA \_ Func è esteso a due o quattro byte.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-133">The value 0xFF for bDXVA\_Func indicates that the bDXVA\_Func is extended to two or four bytes.</span></span> <span data-ttu-id="4aaa4-134">Se anche il secondo byte è 0xFF, questo indica che bDXVA \_ Func è esteso a quattro byte.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-134">If the second byte is also 0xFF, this indicates that bDXVA\_Func is extended to four bytes.</span></span> <span data-ttu-id="4aaa4-135">Se i quattro bit superiori del terzo byte sono 0xF o 0x0, questo indica che bDXVA \_ Func contiene un DXVA \_ CONFIGQUERYORREPLYFUNC o DXVA \_ EncryptProtocolFunc.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-135">If the upper four bits of the third byte are 0xF or 0x0, this indicates that bDXVA\_Func contains a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc.</span></span> <span data-ttu-id="4aaa4-136">I comandi a più byte non devono indicare la continuazione oltre la fine di dwFunction.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-136">Multi-byte commands shall not indicate continuation past the end of dwFunction.</span></span> <span data-ttu-id="4aaa4-137">È necessario prestare attenzione al decodificatore per assicurarsi che non siano presenti dipendenze sequenziali tra \_ i diversi valori bDXVA Func specificati nella stessa chiamata a **IAMVideoAccelerator:: eseguire** e che tutte le potenziali race condition, ad esempio tra la decodifica delle immagini e la fusione di immagini secondarie, tra il caricamento dell'immagine secondaria e la fusione di immagini secondarie e così via, vengono impedite dalle chiamate appropriate a **IAMVideoAccelerator:: BeginFrame** e [**IAMVideoAccelerator:: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) prima delle chiamate successive a **IAMVideoAccelerator:: Execute**.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-137">Care must be taken by the decoder to ensure that no sequential dependencies are present between different bDXVA\_Func values specified in the same call to **IAMVideoAccelerator::Execute** and that all potential race conditions (such as between picture decoding and sub-picture blending, between sub-picture loading and sub-picture blending, and so on) are prevented by appropriate calls to **IAMVideoAccelerator::BeginFrame** and [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) before subsequent calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="4aaa4-138">Se dwFunction contiene un \_ CONFIGQUERYORREPLYFUNC DXVA, il puntatore lpPrivateInputData per passare i dati all'acceleratore in questa chiamata deve puntare a una struttura di dati di configurazione, il puntatore lpPrivateOutputData per la ricezione di informazioni dall'acceleratore deve puntare a un'area in cui è possibile collocare una struttura di dati di configurazione alternativa o duplicata, il puntatore pamvaBufferInfo per una matrice di AMVABUFFERINFO deve essere **null** e dwNumBuffers deve essere zero.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-138">If dwFunction contains a DXVA\_ConfigQueryOrReplyFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to a configuration data structure, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where an alternative or duplicate configuration data structure can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="4aaa4-139">Il valore HRESULT restituito contiene l' \_ indicazione s OK o s \_ false in risposta alla query oppure e \_ non riesce o e \_ INVALIDARG altre indicazioni di errore HRESULT nel caso di un problema grave nell'esecuzione del protocollo, ad esempio un invalid.configparametro uration.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-139">The returned HRESULT contains the S\_OK or S\_FALSE indication in response to the query, or E\_FAIL or E\_INVALIDARG some other error indication HRESULT in the event of a severe problem in protocol execution (such as an invalid.configuration parameter).</span></span> <span data-ttu-id="4aaa4-140">Tutte le chiamate a **IAMVideoAccelerator:: Execute** per tutti gli usi di DXVA \_ ConfigQueryOrReplyFunc devono precedere tutte le altre chiamate a **IAMVideoAccelerator:: Execute**.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-140">All calls to **IAMVideoAccelerator::Execute** for all uses of DXVA\_ConfigQueryOrReplyFunc shall precede all other calls to **IAMVideoAccelerator::Execute**.</span></span>
    -   <span data-ttu-id="4aaa4-141">Se dwFunction contiene un \_ ENCRYPTPROTOCOLFUNC DXVA, il puntatore lpPrivateInputData per il passaggio dei dati all'acceleratore in questa chiamata deve puntare a una struttura di dati del protocollo di crittografia che inizia con DXVA \_ EncryptProtocolHeader, il puntatore lpPrivateOutputData per la ricezione di informazioni dall'acceleratore deve puntare a un'area in cui i dati da restituire, ad esempio un certificato, dal protocollo di crittografia (che inizierà con DXVA \_ EncryptProtocolHeader) possono essere inseriti, il puntatore pamvaBufferInfo per una matrice di AMVABUFFERINFO deve essere **null** e dwNumBuffers deve essere zero.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-141">If dwFunction contains a DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator in this call shall point to an encryption protocol data structure that begins with DXVA\_EncryptProtocolHeader, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area where the data to be returned (such as a certificate) by the encryption protocol (which will begin with DXVA\_EncryptProtocolHeader) can be placed, the pamvaBufferInfo pointer for an array of AMVABUFFERINFO shall be **NULL**, and dwNumBuffers shall be zero.</span></span> <span data-ttu-id="4aaa4-142">Il valore HRESULT restituito contiene S OK fino a quando \_ il protocollo di crittografia funziona normalmente e contiene e \_ non riesce o e \_ INVALIDARG o un'altra indicazione di errore HRESULT nel caso di un problema grave nell'esecuzione del protocollo.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-142">The returned HRESULT contains S\_OK as long as the encryption protocol is functioning normally and contains E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem in protocol execution.</span></span>
    -   <span data-ttu-id="4aaa4-143">Se dwFunction non contiene un DXVA \_ ConfigQueryOrReplyFunc o DXVA \_ EncryptProtocolFunc, il puntatore lpPrivateInputData per il passaggio dei dati all'acceleratore deve puntare a un elenco di descrizioni del buffer.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-143">If dwFunction does not contain a DXVA\_ConfigQueryOrReplyFunc or DXVA\_EncryptProtocolFunc, the lpPrivateInputData pointer for passing data to the accelerator shall point to a buffer description list.</span></span> <span data-ttu-id="4aaa4-144">Le prime quattro voci nella struttura dell'elenco di descrizioni del buffer per ogni buffer (dwTypeIndex, dwBufferIndex, dwDataOffset e dwDataSize) devono essere uguali a quelle nella struttura dei dati AMVABUFFERINFO per lo stesso buffer.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-144">The first four entries in the buffer description list structure for each buffer (dwTypeIndex, dwBufferIndex, dwDataOffset, and dwDataSize) shall be equal to those in the AMVABUFFERINFO data structure for the same buffer.</span></span> <span data-ttu-id="4aaa4-145">Se bDXVA \_ Func è uguale a "1" viene specificato in dwFunction e bPicReadbackRequests è "1", il puntatore lpPrivateOutputData per la ricezione di informazioni dall'acceleratore deve puntare a un'area della memoria persistente, ad esempio un heap, da compilare con i dati macroblocco di lettura del tasto di scelta rapida (tali dati non sono garantiti fino a quando **IAMVideoAccelerator:: QueryRenderStatus** per la scrittura nello stesso buffer di parametri immagine indica \_ OK come descritto nell'elemento 10 riportato di seguito).</span><span class="sxs-lookup"><span data-stu-id="4aaa4-145">If bDXVA\_Func is equal to "1" is specified within dwFunction and bPicReadbackRequests is "1", the lpPrivateOutputData pointer for receiving information from the accelerator shall point to an area of persistent memory (for example heap) to be filled in with read-back macroblock data from the accelerator (such data not guaranteed to be present until **IAMVideoAccelerator::QueryRenderStatus** for writing to the same picture parameters buffer indicates S\_OK as described in item 10 below).</span></span> <span data-ttu-id="4aaa4-146">In caso contrario, il puntatore lpPrivateOutputData per la ricezione di informazioni dall'acceleratore deve puntare a un singolo valore DWORD da impostare su uno dei valori indicati di seguito (particolarmente utile per la segnalazione degli errori Bitstream nell'operazione VLD all'esterno dell'host).</span><span class="sxs-lookup"><span data-stu-id="4aaa4-146">Otherwise, the lpPrivateOutputData pointer for receiving information from the accelerator shall point to a single DWORD to be set to one of the following indication values (particularly useful for reporting bitstream errors in off-host VLD operation).</span></span>

        | <span data-ttu-id="4aaa4-147">Valore</span><span class="sxs-lookup"><span data-stu-id="4aaa4-147">Value</span></span> | <span data-ttu-id="4aaa4-148">Descrizione</span><span class="sxs-lookup"><span data-stu-id="4aaa4-148">Description</span></span>                                     |
        |-------|-------------------------------------------------|
        | <span data-ttu-id="4aaa4-149">0</span><span class="sxs-lookup"><span data-stu-id="4aaa4-149">0</span></span>     | <span data-ttu-id="4aaa4-150">Esecuzione OK.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-150">Execution OK.</span></span>                                   |
        | <span data-ttu-id="4aaa4-151">1</span><span class="sxs-lookup"><span data-stu-id="4aaa4-151">1</span></span>     | <span data-ttu-id="4aaa4-152">Si è verificato un problema minore nel formato dati.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-152">Minor problem in data format encountered.</span></span>       |
        | <span data-ttu-id="4aaa4-153">2</span><span class="sxs-lookup"><span data-stu-id="4aaa4-153">2</span></span>     | <span data-ttu-id="4aaa4-154">Si è verificato un problema significativo nel formato dati.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-154">Significant problem in data format encountered.</span></span> |
        | <span data-ttu-id="4aaa4-155">3</span><span class="sxs-lookup"><span data-stu-id="4aaa4-155">3</span></span>     | <span data-ttu-id="4aaa4-156">Si è verificato un problema grave nel formato dati.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-156">Severe problem in data format encountered.</span></span>      |
        | <span data-ttu-id="4aaa4-157">4</span><span class="sxs-lookup"><span data-stu-id="4aaa4-157">4</span></span>     | <span data-ttu-id="4aaa4-158">Si è verificato un altro problema grave.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-158">Other severe problem encountered.</span></span>               |

        

         

        <span data-ttu-id="4aaa4-159">Se viene indicato un tipo di problema "grave", il decodificatore software deve smettere di funzionare con le funzioni a meno che non sia possibile eseguire un'azione correttiva.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-159">If either type of "severe" problem is indicated, the software decoder should cease to operate the function(s) unless corrective action can be taken.</span></span> <span data-ttu-id="4aaa4-160">Questi dati restituiti dall'acceleratore non devono essere letti dall'host fino al completamento del rendering del buffer per l'immagine, come può essere testato da [**IAMVideoAccelerator:: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus).</span><span class="sxs-lookup"><span data-stu-id="4aaa4-160">This data returned from the accelerator shall not be read by the host until after the buffer rendering for the picture has completed, as can be tested by [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus).</span></span> <span data-ttu-id="4aaa4-161">Il valore HRESULT restituito contiene S OK fino a quando \_ l'operazione di interfaccia funziona normalmente e può restituire \_ \_ un errore o un INVALIDARG o un altro valore HRESULT di errore nel caso di un problema grave.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-161">The returned HRESULT contains S\_OK as long as the interface operation is functioning normally and may return E\_FAIL or E\_INVALIDARG or some other error indication HRESULT in the event of a severe problem.</span></span>

7.  <span data-ttu-id="4aaa4-162">Il buffer dei parametri di decodifica delle immagini deve essere tra i primi buffer inviati per la decodifica di ogni immagine quando si usa [**IAMVideoAccelerator:: Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) con bDXVA \_ Func uguale a "1" e tutti i buffer per la decodifica di un'immagine in un bitstream verranno inviati prima di tutti i buffer per la decodifica delle immagini successive.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-162">The picture decoding parameters buffer shall be among the first buffers sent for the decoding of each picture when using [**IAMVideoAccelerator::Execute**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-execute) with bDXVA\_Func equal to "1", and all the buffers for decoding a picture in a bitstream shall be sent before any buffers for decoding subsequent pictures.</span></span> <span data-ttu-id="4aaa4-163">Se viene inviato un buffer del comando di controllo macroblocco, viene inviato un buffer dei dati della differenza residua corrispondente (contenente i dati per lo stesso macroblocchi) con la stessa chiamata a **IAMVideoAccelerator:: Execute** .</span><span class="sxs-lookup"><span data-stu-id="4aaa4-163">If a macroblock control command buffer is sent, a corresponding residual difference data buffer shall be sent (containing data for the same macroblocks) with the same **IAMVideoAccelerator::Execute** call.</span></span>
8.  <span data-ttu-id="4aaa4-164">[**IAMVideoAccelerator:: EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) deve essere chiamato dopo l'invio di tutti i buffer compressi che comporteranno la creazione del contenuto di output in una superficie non compressa specificata, ovvero il risultato delle operazioni specificate per WDecodedPictureIndex, WDeblockedPictureIndex, WBlendedDestinationIndex o wPicResampleDestPicIndex.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-164">[**IAMVideoAccelerator::EndFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-endframe) shall be called after all compressed buffers have been sent that will cause the creation of the output content in a specified uncompressed surface (a result of operations specified for wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex).</span></span> <span data-ttu-id="4aaa4-165">Lo scopo di questa chiamata a **IAMVideoAccelerator:: EndFrame** è notificare all'hardware del acceleratore video che tutti i dati necessari per l'operazione specificata sono stati inviati.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-165">The purpose of this call to **IAMVideoAccelerator::EndFrame** is to notify the video accelerator hardware that all data needed for the specified operation has been sent.</span></span> <span data-ttu-id="4aaa4-166">Il puntatore ai dati da inviare a valle tramite **IAMVideoAccelerator:: EndFrame** deve puntare a una singola parola wEndPictureIndex che contiene l'indice del frame che sta terminando.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-166">The pointer to data to send downstream through **IAMVideoAccelerator::EndFrame** shall point to a single WORD wEndPictureIndex containing the index of the frame that is ending.</span></span> <span data-ttu-id="4aaa4-167">Questo parametro deve corrispondere al valore wBeginPictureIndex specificato nella chiamata precedente a [**IAMVideoAccelerator:: BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) prima dell'invio dei buffer compressi pertinenti.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-167">This parameter shall match the wBeginPictureIndex value specified in the prior call to [**IAMVideoAccelerator::BeginFrame**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-beginframe) before the sending of the relevant compressed buffers.</span></span> <span data-ttu-id="4aaa4-168">Successivamente a una chiamata a **IAMVideoAccelerator:: EndFrame**, la superficie non compressa con indice wEndPictureIndex non verrà trovata nei WDecodedPictureIndex, WDeblockedPictureIndex, WBlendedDestinationIndex o wPicResampleDestPicIndex di un'immagine, fino a quando non viene eseguita un'altra chiamata a **IAMVideoAccelerator:: BeginFrame** per annunciare che questa situazione si verificherà ed è \_ stata restituita una funzione s OK.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-168">Subsequent to a call to **IAMVideoAccelerator::EndFrame**, the uncompressed surface with index wEndPictureIndex shall not be found in any picture's wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex until after another call to **IAMVideoAccelerator::BeginFrame** is issued to announce that this will occur and an S\_OK has been returned as a result.</span></span> <span data-ttu-id="4aaa4-169">Tuttavia, l'indice della superficie di destinazione può verificarsi nei comandi di accesso in lettura successivi, ad esempio wForwardRefPictureIndex, wBackwardRefPictureIndex, wPicResampleSourcePicIndex o bRefPicSelect \[ i \] .</span><span class="sxs-lookup"><span data-stu-id="4aaa4-169">However, that destination surface index may occur in subsequent read access commands such as wForwardRefPictureIndex, wBackwardRefPictureIndex, wPicResampleSourcePicIndex, or bRefPicSelect\[i\].</span></span> <span data-ttu-id="4aaa4-170">Il valore HRESULT restituito da **IAMVideoAccelerator:: EndFrame** deve essere S \_ OK, a meno che non esista un tipo di formato dati o di errore di protocollo, nel qual caso può essere e \_ non superato oppure e \_ INVALIDARG o un'altra indicazione di errore.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-170">The HRESULT returned by **IAMVideoAccelerator::EndFrame** shall be S\_OK unless there is some kind of data format or protocol error, in which case it can be E\_FAIL or E\_INVALIDARG or some other error indication.</span></span>
9.  <span data-ttu-id="4aaa4-171">Nel caso della decodifica basata su campi (ad esempio, in un flusso di bit MPEG-2) non sarà presente un mapping uno-a-uno delle immagini funzionali del Bitstream alle superfici non compresse nell'interfaccia dell'acceleratore.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-171">In the case of field based decoding (for example, in MPEG-2 bitstreams) there will not be a one-to-one mapping of functional pictures in the bitstream to uncompressed surfaces in the accelerator interface.</span></span> <span data-ttu-id="4aaa4-172">Quando si decodifica le immagini del campo in un bitstream MPEG-2, saranno presenti due "immagini" decodificate per produrre una superficie di output completa non compressa.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-172">When decoding field pictures in an MPEG-2 bitstream, there will be two "pictures" decoded to produce one complete output uncompressed surface.</span></span> <span data-ttu-id="4aaa4-173">Nella definizione dell'interfaccia di DirectX VA ogni frame corrisponde a ogni uso di wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex o wPicResampleDestPicIndex.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-173">In the DirectX VA interface definition, each frame corresponds to each use of wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex.</span></span> <span data-ttu-id="4aaa4-174">Sono pertanto necessarie due coppie di chiamate a **IAMVideoAccelerator:: BeginFrame** e **IAMVideoAccelerator:: EndFrame** per la decodifica delle immagini dei campi in superfici non compresse di output.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-174">Thus two pairs of calls to **IAMVideoAccelerator::BeginFrame** and **IAMVideoAccelerator::EndFrame** are required for the decoding of field pictures into output uncompressed surfaces.</span></span>
10. <span data-ttu-id="4aaa4-175">Una chiamata a [**IAMVideoAccelerator:: QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) con dwFlags uguale a zero che si verifica talvolta dopo una chiamata a **IAMVideoAccelerator:: EndFrame** con un determinato wEndPictureIndex e controlla lo stato di un buffer inviato che conteneva WEndPictureIndex in WDecodedPictureIndex, WDeblockedPictureIndex, wBlendedDestinationIndex o wPicResampleDestPicIndex restituirà un'indicazione S \_ OK se tutte le operazioni di scrittura dei dati nella superficie non compressa sono state completate e restituiranno e \_ in sospeso se l'operazione non è stata ancora completata.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-175">A call to [**IAMVideoAccelerator::QueryRenderStatus**](/previous-versions/windows/desktop/api/videoacc/nf-videoacc-iamvideoaccelerator-queryrenderstatus) with dwFlags equal to zero which occurs sometime after a call to **IAMVideoAccelerator::EndFrame** with a particular wEndPictureIndex and checks the status of a buffer that was sent that contained the wEndPictureIndex in wDecodedPictureIndex, wDeblockedPictureIndex, wBlendedDestinationIndex, or wPicResampleDestPicIndex will return an S\_OK indication if all of the operations to write the data to the uncompressed surface have completed and will return E\_PENDING if the operation has not yet completed.</span></span> <span data-ttu-id="4aaa4-176">E \_ non riescono o e \_ INVALIDARG o è possibile che venga restituita un'altra indicazione di errore in caso di errore del protocollo.</span><span class="sxs-lookup"><span data-stu-id="4aaa4-176">E\_FAIL or E\_INVALIDARG or some other error indication may be returned in the event of a protocol error.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4aaa4-177">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="4aaa4-177">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4aaa4-178">Mapping dell'accelerazione video DirectX a IAMVideoAccelerator</span><span class="sxs-lookup"><span data-stu-id="4aaa4-178">Mapping DirectX Video Acceleration to IAMVideoAccelerator</span></span>](mapping-directx-video-acceleration-to-iamvideoaccelerator.md)
</dt> </dl>

 

 



