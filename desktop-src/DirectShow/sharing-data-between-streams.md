---
description: Condivisione di dati tra flussi
ms.assetid: e18eecf8-9475-420a-9a60-4b1b5f8fd43a
title: Condivisione di dati tra flussi
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ee0b2f53fe1952bbc16711f7c7e39c3182ba94a7
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/06/2021
ms.locfileid: "104481973"
---
# <a name="sharing-data-between-streams"></a><span data-ttu-id="ce8ce-103">Condivisione di dati tra flussi</span><span class="sxs-lookup"><span data-stu-id="ce8ce-103">Sharing Data Between Streams</span></span>

> [!Note]  
> <span data-ttu-id="ce8ce-104">Queste API sono deprecate.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-104">These APIs are deprecated.</span></span> <span data-ttu-id="ce8ce-105">Le applicazioni devono usare il filtro [**grabber di esempio**](sample-grabber-filter.md) o implementare un filtro personalizzato per ottenere i dati da un grafico filtro DirectShow.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-105">Applications should use the [**Sample Grabber**](sample-grabber-filter.md) filter or implement a custom filter to get data from a DirectShow filter graph.</span></span>

 

<span data-ttu-id="ce8ce-106">L'elaborazione dei dati multimediali richiede in genere una grande quantità di risorse di sistema. Pertanto, è consigliabile evitare di copiare i dati laddove possibile.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-106">Processing multimedia data typically requires a great deal of system resources; therefore, you should avoid copying data whenever possible.</span></span> <span data-ttu-id="ce8ce-107">L'architettura di streaming supporta gli esempi di flussi condivisi, un meccanismo che sposta i dati da un flusso a un altro senza copiarli.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-107">The streaming architecture supports shared stream samples, a mechanism that moves data from one stream to another without copying it.</span></span> <span data-ttu-id="ce8ce-108">Questo buffer consente il trasporto efficiente di dati tra due flussi anche se il flusso di destinazione non supporta in modo specifico il formato dati sottostante.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-108">This buffer enables the efficient transportation of data between two streams even if the destination stream doesn't specifically support the underlying data format.</span></span>

<span data-ttu-id="ce8ce-109">Si supponga, ad esempio, che si disponga di un flusso multimediale con tre flussi di dati: video e audio e che il timestamp dei dati dell'URL corrisponda al contenuto video.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-109">For example, assume that you have a multimedia stream with three data streams: video and audio, and URL data time-stamped to match the video content.</span></span> <span data-ttu-id="ce8ce-110">Si vuole scrivere un'applicazione che aggiunga un avviso sul copyright a ogni fotogramma video e scriva i dati in un altro flusso per l'archiviazione, ma l'applicazione non comprende i formati di dati ad eccezione del flusso video.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-110">You want to write an application that adds a copyright notice on every video frame and writes the data to another stream for storage, but your application doesn't understand any data formats except the video stream.</span></span> <span data-ttu-id="ce8ce-111">Per il flusso video, viene creato un esempio collegato alla superficie DirectDraw desiderata.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-111">For the video stream, you create a sample attached to the desired DirectDraw surface.</span></span> <span data-ttu-id="ce8ce-112">È quindi possibile creare un flusso di output chiamando il metodo [**IDirectDrawMediaStream:: CreateSample**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) con tale puntatore alla stessa area o [**IMediaStream:: CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample).</span><span class="sxs-lookup"><span data-stu-id="ce8ce-112">You can then create an output stream by calling either the [**IDirectDrawMediaStream::CreateSample**](/previous-versions/windows/desktop/api/ddstream/nf-ddstream-idirectdrawmediastream-createsample) method with that pointer to the same surface, or [**IMediaStream::CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample).</span></span> <span data-ttu-id="ce8ce-113">In entrambi i casi, i flussi di input e di output condividono la superficie DirectDraw.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-113">In both cases, the input and output streams share the DirectDraw surface.</span></span> <span data-ttu-id="ce8ce-114">Poiché si comprende il formato video, è possibile accedere a questa superficie in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-114">Because you understand the video format, you can access this surface as needed.</span></span>

<span data-ttu-id="ce8ce-115">Per recuperare gli altri puntatori del flusso di origine (audio e URL), enumerare il flusso del contenitore di origine e selezionare i puntatori ai flussi non video.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-115">To retrieve the other source stream pointers (audio and URL), enumerate the source container stream and grab pointers to the nonvideo streams.</span></span> <span data-ttu-id="ce8ce-116">A ognuno di questi flussi di origine è associato un flusso di output nel contenitore del flusso di output.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-116">Each of these source streams has an associated output stream in the output stream container.</span></span> <span data-ttu-id="ce8ce-117">Recuperare questi puntatori di output chiamando il metodo [**IMultiMediaStream:: GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) sul contenitore di output con ognuno dei puntatori del flusso di origine.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-117">Retrieve these output pointers by calling the [**IMultiMediaStream::GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) method on the output container with each of the source stream pointers.</span></span> <span data-ttu-id="ce8ce-118">Questo processo è descritto nella seguente procedura.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-118">The following steps describe this process.</span></span>

1.  <span data-ttu-id="ce8ce-119">Chiamare [**IMultiMediaStream:: EnumMediaStreams**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) per recuperare un puntatore a un flusso di origine.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-119">Call [**IMultiMediaStream::EnumMediaStreams**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-enummediastreams) to retrieve a pointer to a source stream.</span></span> <span data-ttu-id="ce8ce-120">Assicurarsi che non sia il flusso video, perché l'applicazione ne è già in grado di comprendere il formato.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-120">Make sure that it's not the video stream, because your application already understands its format.</span></span>
2.  <span data-ttu-id="ce8ce-121">Chiamare [**IMultiMediaStream:: GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) nel flusso del contenitore di output con il puntatore del passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-121">Call [**IMultiMediaStream::GetMediaStream**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imultimediastream-getmediastream) on the output container stream with the pointer from step 1.</span></span> <span data-ttu-id="ce8ce-122">Viene restituito un puntatore al flusso di output desiderato.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-122">This returns a pointer to the desired output stream.</span></span>
3.  <span data-ttu-id="ce8ce-123">Chiamare [**AllocateSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) nel flusso di origine.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-123">Call [**AllocateSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-allocatesample) on the source stream.</span></span>
4.  <span data-ttu-id="ce8ce-124">Chiamare [**CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) nel flusso di output.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-124">Call [**CreateSharedSample**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-imediastream-createsharedsample) on the output stream.</span></span>
5.  <span data-ttu-id="ce8ce-125">Chiamare [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) nel flusso di origine per leggere i dati.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-125">Call [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) on the source stream to read the data.</span></span>
6.  <span data-ttu-id="ce8ce-126">Chiamare [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) nel flusso di output per scrivere i dati.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-126">Call [**Update**](/previous-versions/windows/desktop/api/mmstream/nf-mmstream-istreamsample-update) on the output stream to write the data.</span></span>

<span data-ttu-id="ce8ce-127">Ripetere questi passaggi per ogni flusso il cui formato non è supportato.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-127">Repeat these steps for each stream whose format you don't support.</span></span> <span data-ttu-id="ce8ce-128">Quando entrambi gli esempi terminano l'aggiornamento, il flusso di output contiene tutti i dati del flusso di origine e l'operazione è terminata.</span><span class="sxs-lookup"><span data-stu-id="ce8ce-128">When both samples finish updating, the output stream has all data from the source stream and you are done.</span></span>

 

 



