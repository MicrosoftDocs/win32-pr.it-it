---
description: QueryAccept (downstream)
ms.assetid: 3ca30f62-c320-40ea-9bf5-022abad912c4
title: QueryAccept (downstream)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9015e0a246abb9fb996c0771e4bc935cccda054d
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/06/2021
ms.locfileid: "104563602"
---
# <a name="queryaccept-downstream"></a><span data-ttu-id="7abba-103">QueryAccept (downstream)</span><span class="sxs-lookup"><span data-stu-id="7abba-103">QueryAccept (Downstream)</span></span>

<span data-ttu-id="7abba-104">Questo meccanismo consente a un pin di output di proporre un nuovo formato al peer downstream.</span><span class="sxs-lookup"><span data-stu-id="7abba-104">This mechanism enables an output pin to propose a new format to its downstream peer.</span></span> <span data-ttu-id="7abba-105">Il nuovo formato non deve richiedere una dimensione del buffer maggiore.</span><span class="sxs-lookup"><span data-stu-id="7abba-105">The new format must not require a larger buffer size.</span></span> <span data-ttu-id="7abba-106">Il pin di output esegue le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="7abba-106">The output pin does the following:</span></span>

1.  <span data-ttu-id="7abba-107">Chiama [**Ipin:: QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) o [**IPinConnection::D ynamicqueryaccept**](/windows/desktop/api/Strmif/nf-strmif-ipinconnection-dynamicqueryaccept) sul pin downstream, per verificare se l'altro pin può accettare il nuovo tipo di supporto (vedere la figura, passaggio A).</span><span class="sxs-lookup"><span data-stu-id="7abba-107">Calls [**IPin::QueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipin-queryaccept) or [**IPinConnection::DynamicQueryAccept**](/windows/desktop/api/Strmif/nf-strmif-ipinconnection-dynamicqueryaccept) on the downstream pin, to verify whether the other pin can accept the new media type (see illustration, step A).</span></span>
2.  <span data-ttu-id="7abba-108">Se il valore restituito dal passaggio 1 è \_ OK, il pin connette il tipo di supporto all'esempio successivo.</span><span class="sxs-lookup"><span data-stu-id="7abba-108">If the return value from step 1 is S\_OK, the pin attaches the media type to the next sample.</span></span> <span data-ttu-id="7abba-109">A tale scopo, prima di tutto viene chiamato [**IMemAllocator:: GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) per ottenere l'esempio (B).</span><span class="sxs-lookup"><span data-stu-id="7abba-109">To do this, first it calls [**IMemAllocator::GetBuffer**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getbuffer) to obtain the sample (B).</span></span> <span data-ttu-id="7abba-110">Chiama quindi [**IMediaSample:: SetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatype) per alleghiare il tipo di supporto a tale esempio (C).</span><span class="sxs-lookup"><span data-stu-id="7abba-110">Then it calls [**IMediaSample::SetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-setmediatype) to attach the media type to that sample (C).</span></span> <span data-ttu-id="7abba-111">Associando il tipo di supporto all'esempio, il filtro indica che il formato è stato modificato, a partire da tale esempio.</span><span class="sxs-lookup"><span data-stu-id="7abba-111">By attaching the media type to the sample, the filter indicates that the format has changed, starting with that sample.</span></span>
3.  <span data-ttu-id="7abba-112">Il pin recapita l'esempio (D).</span><span class="sxs-lookup"><span data-stu-id="7abba-112">The pin delivers the sample (D).</span></span>
4.  <span data-ttu-id="7abba-113">Quando il filtro downstream riceve l'esempio, chiama [**IMediaSample:: GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) per recuperare il nuovo tipo di supporto.</span><span class="sxs-lookup"><span data-stu-id="7abba-113">When the downstream filter receives the sample, it calls [**IMediaSample::GetMediaType**](/windows/desktop/api/Strmif/nf-strmif-imediasample-getmediatype) to retrieve the new media type.</span></span>

    ![queryaccept (downstream)](images/dynformat3.png)

<span data-ttu-id="7abba-115">Tutti i pin supportano il `QueryAccept` metodo.</span><span class="sxs-lookup"><span data-stu-id="7abba-115">All pins support the `QueryAccept` method.</span></span> <span data-ttu-id="7abba-116">Tuttavia, questo metodo è leggermente ambiguo, perché un valore restituito di S \_ OK non sempre garantisce che sia possibile modificare il formato quando il grafico è attivo.</span><span class="sxs-lookup"><span data-stu-id="7abba-116">However, this method is slightly ambiguous, because a return value of S\_OK does not always guarantee that you can change the format while the graph is active.</span></span> <span data-ttu-id="7abba-117">Alcuni filtri potrebbero restituire S \_ OK, ma rifiutare la modifica se il grafico è attivo.</span><span class="sxs-lookup"><span data-stu-id="7abba-117">Some filters might return S\_OK but reject the change if the graph is active.</span></span> <span data-ttu-id="7abba-118">Il metodo **DynamicQueryAccept** , supportato da alcuni pin di input, definisce in modo esplicito S \_ OK per indicare che il pin può modificare i formati mentre è attivo.</span><span class="sxs-lookup"><span data-stu-id="7abba-118">The **DynamicQueryAccept** method, which is supported by some input pins, explicitly defines S\_OK to mean the pin can change formats while active.</span></span> <span data-ttu-id="7abba-119">Se un pin di input supporta l'interfaccia **IPinConnection** , è necessario chiamare **DynamicQueryAccept** anziché `QueryAccept` .</span><span class="sxs-lookup"><span data-stu-id="7abba-119">If an input pin supports the **IPinConnection** interface, you should call **DynamicQueryAccept** rather than `QueryAccept`.</span></span>

<span data-ttu-id="7abba-120">Nella maggior parte dei casi, questo meccanismo non consente modifiche drastiche al formato, ad esempio la modifica della profondità dei bit.</span><span class="sxs-lookup"><span data-stu-id="7abba-120">In most cases, this mechanism does not allow for drastic changes to the format, such as changing the bit depth.</span></span> <span data-ttu-id="7abba-121">Una situazione in cui può essere utilizzata è quando un decodificatore video passa le tavolozze.</span><span class="sxs-lookup"><span data-stu-id="7abba-121">One situation in which it can be used is when a video decoder switches palettes.</span></span> <span data-ttu-id="7abba-122">I dettagli di base del formato rimanere invariati, ad esempio le dimensioni dell'immagine e la profondità del bit, ma il nuovo tipo di supporto presenta un set diverso di voci della tavolozza.</span><span class="sxs-lookup"><span data-stu-id="7abba-122">The basic details of the format stay the same, such as the image dimensions and the bit depth, but the new media type has a different set of palette entries.</span></span>

<span data-ttu-id="7abba-123">**Nota sull'implementazione**</span><span class="sxs-lookup"><span data-stu-id="7abba-123">**Implementation Note**</span></span>

<span data-ttu-id="7abba-124">Nelle classi base di DirectShow, [**CBasePin:: QueryAccept**](cbasepin-queryaccept.md) chiama il metodo **CheckMediaType** , che viene chiamato anche durante la connessione iniziale del PIN.</span><span class="sxs-lookup"><span data-stu-id="7abba-124">In the DirectShow base classes, [**CBasePin::QueryAccept**](cbasepin-queryaccept.md) calls the **CheckMediaType** method, which is also called during the initial pin connection.</span></span> <span data-ttu-id="7abba-125">Nel caso di un filtro di trasformazione, il metodo **CheckMediaType** del PIN di input deve sempre controllare se il pin di output è connesso e, in tal caso, se il tipo di supporto di input è compatibile con il tipo di supporto di output.</span><span class="sxs-lookup"><span data-stu-id="7abba-125">In the case of a transform filter, the input pin's **CheckMediaType** method should always check whether the output pin is connected, and if so, whether the input media type is compatible with the output media type.</span></span> <span data-ttu-id="7abba-126">Questa implementazione probabilmente sarà quindi valida per `QueryAccept` .</span><span class="sxs-lookup"><span data-stu-id="7abba-126">Therefore, this implementation will likely be valid for `QueryAccept`.</span></span> <span data-ttu-id="7abba-127">In caso contrario, è necessario eseguire l'override `QueryAccept` di per eseguire tutti i controlli aggiuntivi necessari.</span><span class="sxs-lookup"><span data-stu-id="7abba-127">If not, you should override `QueryAccept` in order to perform any additional checks that are needed.</span></span> <span data-ttu-id="7abba-128">Si noti inoltre che la classe [**CTransformFilter**](ctransformfilter.md) incapsula questa logica nei metodi **CheckInputType** e **CheckTransform** .</span><span class="sxs-lookup"><span data-stu-id="7abba-128">Also, note that the [**CTransformFilter**](ctransformfilter.md) class encapsulates this logic within the **CheckInputType** and **CheckTransform** methods.</span></span> <span data-ttu-id="7abba-129">La classe [**CTransInPlaceFilter**](ctransinplacefilter.md) , d'altra parte, chiama sempre `QueryAccept` sul filtro upstream o downstream successivo.</span><span class="sxs-lookup"><span data-stu-id="7abba-129">The [**CTransInPlaceFilter**](ctransinplacefilter.md) class, on the other hand, always calls `QueryAccept` on the next upstream or downstream filter.</span></span>

<span data-ttu-id="7abba-130">Il metodo [**CBaseInputPin:: Receive**](cbaseinputpin-receive.md) verifica la presenza di un tipo di supporto nell'esempio in ingresso e, se presente, chiama **CheckMediaType**.</span><span class="sxs-lookup"><span data-stu-id="7abba-130">The [**CBaseInputPin::Receive**](cbaseinputpin-receive.md) method checks for a media type on the incoming sample, and if there is one, calls **CheckMediaType**.</span></span> <span data-ttu-id="7abba-131">Tuttavia, non aggiorna il membro **\_ mt m** del PIN, che include il tipo di supporto corrente.</span><span class="sxs-lookup"><span data-stu-id="7abba-131">However, it does not update the pin's **m\_mt** member, which holds the current media type.</span></span> <span data-ttu-id="7abba-132">Quando il filtro elabora l'esempio, è necessario controllare l'esempio per un tipo di supporto.</span><span class="sxs-lookup"><span data-stu-id="7abba-132">When your filter processes the sample, you should check the sample for a media type.</span></span> <span data-ttu-id="7abba-133">Se è presente un nuovo tipo, probabilmente sarà necessario archiviarlo chiamando **SetMediaType** sul pin oppure impostando il valore di **m \_ mt** direttamente.</span><span class="sxs-lookup"><span data-stu-id="7abba-133">If there is a new type, you will probably need to store it, either by calling **SetMediaType** on your pin or by setting the value of **m\_mt** directly.</span></span> <span data-ttu-id="7abba-134">D'altra parte, la classe [**CVideoTransformFilter**](cvideotransformfilter.md) , progettata per i filtri di trasformazione video, archivia il tipo di supporto quando viene modificato.</span><span class="sxs-lookup"><span data-stu-id="7abba-134">On the other hand, the [**CVideoTransformFilter**](cvideotransformfilter.md) class, which is designed for video transform filters, stores the media type when it changes.</span></span> <span data-ttu-id="7abba-135">Per informazioni dettagliate, vedere il codice sorgente per [**CVideoTransformFilter:: Receive**](cvideotransformfilter-receive.md) nella libreria di classi base DirectShow.</span><span class="sxs-lookup"><span data-stu-id="7abba-135">For details, see the source code for [**CVideoTransformFilter::Receive**](cvideotransformfilter-receive.md) in the DirectShow base class library.</span></span>

<span data-ttu-id="7abba-136">In alcuni casi, è possibile passare semplicemente la `QueryAccept` chiamata downstream, quindi alleghi il tipo di supporto all'esempio di output e consentire al filtro downstream di gestire la modifica del formato.</span><span class="sxs-lookup"><span data-stu-id="7abba-136">In some cases, you might simply pass the `QueryAccept` call downstream, then attach the media type to the output sample and let the downstream filter handle the format change.</span></span>

 

 



