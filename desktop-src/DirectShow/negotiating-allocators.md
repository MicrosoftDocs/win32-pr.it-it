---
description: Negozi di allocatori
ms.assetid: fe13477c-1a7b-4098-9d0f-c54783102bc9
title: Negozi di allocatori
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2faa393ba9fcd8585d68947cec172d4cfca6decf
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/06/2021
ms.locfileid: "106303737"
---
# <a name="negotiating-allocators"></a><span data-ttu-id="195d1-103">Negozi di allocatori</span><span class="sxs-lookup"><span data-stu-id="195d1-103">Negotiating Allocators</span></span>

<span data-ttu-id="195d1-104">Quando due pin si connettono, devono disporre di un meccanismo per lo scambio di dati multimediali.</span><span class="sxs-lookup"><span data-stu-id="195d1-104">When two pins connect, they need a mechanism for exchanging media data.</span></span> <span data-ttu-id="195d1-105">Questo meccanismo viene chiamato *trasporto*.</span><span class="sxs-lookup"><span data-stu-id="195d1-105">This mechanism is called the *transport*.</span></span> <span data-ttu-id="195d1-106">In generale, l'architettura DirectShow è neutra per i trasporti.</span><span class="sxs-lookup"><span data-stu-id="195d1-106">In general, the DirectShow architecture is neutral about transports.</span></span> <span data-ttu-id="195d1-107">Due filtri possono accettare la connessione utilizzando qualsiasi trasporto supportato da entrambi.</span><span class="sxs-lookup"><span data-stu-id="195d1-107">Two filters can agree to connect using any transport that both support.</span></span>

<span data-ttu-id="195d1-108">Il trasporto più comune è il trasporto di *memoria locale* , in cui i dati multimediali si trovano nella memoria principale.</span><span class="sxs-lookup"><span data-stu-id="195d1-108">The most common transport is the *local memory* transport, in which the media data resides in main memory.</span></span> <span data-ttu-id="195d1-109">Esistono due tipi di trasporto di memoria locale, il *modello push* e il *modello pull*.</span><span class="sxs-lookup"><span data-stu-id="195d1-109">Two flavors of local memory transport exist, the *push model* and the *pull model*.</span></span> <span data-ttu-id="195d1-110">Nel modello push, il filtro di origine inserisce i dati nel filtro downstream usando l'interfaccia [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) sul pin di input del filtro downstream.</span><span class="sxs-lookup"><span data-stu-id="195d1-110">In the push model, the source filter pushes data to the downstream filter, using the [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) interface on the downstream filter's input pin.</span></span> <span data-ttu-id="195d1-111">Nel modello pull il filtro downstream richiede i dati dal filtro di origine, usando l'interfaccia [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader) sul pin di output del filtro di origine.</span><span class="sxs-lookup"><span data-stu-id="195d1-111">In the pull model, the downstream filter requests data from the source filter, using the [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader) interface on the source filter's output pin.</span></span> <span data-ttu-id="195d1-112">Per altre informazioni su questi due modelli di flusso di dati, vedere [flusso di dati nel grafico del filtro](data-flow-in-the-filter-graph.md).</span><span class="sxs-lookup"><span data-stu-id="195d1-112">For more information on these two data-flow models, see [Data Flow in the Filter Graph](data-flow-in-the-filter-graph.md).</span></span>

<span data-ttu-id="195d1-113">Nel trasporto di memoria locale, l'oggetto responsabile dell'allocazione dei buffer di memoria viene definito *allocatore*.</span><span class="sxs-lookup"><span data-stu-id="195d1-113">In local memory transport, the object responsible for allocating memory buffers is called the *allocator*.</span></span> <span data-ttu-id="195d1-114">Un allocatore supporta l'interfaccia [**IMemAllocator**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) .</span><span class="sxs-lookup"><span data-stu-id="195d1-114">An allocator supports the [**IMemAllocator**](/windows/desktop/api/Strmif/nn-strmif-imemallocator) interface.</span></span> <span data-ttu-id="195d1-115">Entrambi i pin condividono un solo allocatore.</span><span class="sxs-lookup"><span data-stu-id="195d1-115">Both pins share a single allocator.</span></span> <span data-ttu-id="195d1-116">Entrambi i pin possono fornire un allocatore, ma il pin di output seleziona l'allocatore da usare.</span><span class="sxs-lookup"><span data-stu-id="195d1-116">Either pin can provide an allocator, but the output pin selects which allocator to use.</span></span>

<span data-ttu-id="195d1-117">Il pin di output imposta anche le proprietà dell'allocatore, che determinano il numero di buffer creati dall'allocatore, le dimensioni di ogni buffer e l'allineamento della memoria.</span><span class="sxs-lookup"><span data-stu-id="195d1-117">The output pin also sets the allocator properties, which determine how many buffers are created by the allocator, the size of each buffer, and the memory alignment.</span></span> <span data-ttu-id="195d1-118">Il pin di output potrebbe rinviare al pin di input per i requisiti del buffer.</span><span class="sxs-lookup"><span data-stu-id="195d1-118">The output pin might defer to the input pin for the buffer requirements.</span></span>

<span data-ttu-id="195d1-119">In una connessione **IMemInputPin** , la negoziazione dell'allocatore funziona nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="195d1-119">In an **IMemInputPin** connection, allocator negotiation works as follows:</span></span>

1.  <span data-ttu-id="195d1-120">Facoltativamente, il pin di output chiama [**IMemInputPin:: GetAllocatorRequirements**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocatorrequirements).</span><span class="sxs-lookup"><span data-stu-id="195d1-120">Optionally, the output pin calls [**IMemInputPin::GetAllocatorRequirements**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocatorrequirements).</span></span> <span data-ttu-id="195d1-121">Questo metodo recupera i requisiti del buffer del PIN di input, ad esempio l'allineamento della memoria.</span><span class="sxs-lookup"><span data-stu-id="195d1-121">This method retrieves the input pin's buffer requirements, such as memory alignment.</span></span> <span data-ttu-id="195d1-122">In generale, il pin di output deve rispettare la richiesta del PIN di input, a meno che non esista un buon motivo per non farlo.</span><span class="sxs-lookup"><span data-stu-id="195d1-122">In general, the output pin should honor the input pin's request, unless there is a good reason not to.</span></span>
2.  <span data-ttu-id="195d1-123">Facoltativamente, il pin di output chiama [**IMemInputPin:: Getallocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocator).</span><span class="sxs-lookup"><span data-stu-id="195d1-123">Optionally, the output pin calls [**IMemInputPin::GetAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-getallocator).</span></span> <span data-ttu-id="195d1-124">Questo metodo richiede un allocatore dal pin di input.</span><span class="sxs-lookup"><span data-stu-id="195d1-124">This method requests an allocator from the input pin.</span></span> <span data-ttu-id="195d1-125">Il pin di input ne fornisce uno oppure restituisce un codice di errore.</span><span class="sxs-lookup"><span data-stu-id="195d1-125">The input pin provides one, or returns an error code.</span></span>
3.  <span data-ttu-id="195d1-126">Il pin di output seleziona un allocatore.</span><span class="sxs-lookup"><span data-stu-id="195d1-126">The output pin selects an allocator.</span></span> <span data-ttu-id="195d1-127">Può utilizzarne una fornita dal pin di input o crearne una personalizzata.</span><span class="sxs-lookup"><span data-stu-id="195d1-127">It can use one provided by the input pin, or create its own.</span></span>
4.  <span data-ttu-id="195d1-128">Il pin di output chiama [**IMemAllocator:: seproprietà**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-setproperties) per impostare le proprietà dell'allocatore.</span><span class="sxs-lookup"><span data-stu-id="195d1-128">The output pin calls [**IMemAllocator::SetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-setproperties) to set the allocator properties.</span></span> <span data-ttu-id="195d1-129">Tuttavia, l'allocatore potrebbe non rispettare le proprietà richieste.</span><span class="sxs-lookup"><span data-stu-id="195d1-129">However, the allocator might not honor the requested properties.</span></span> <span data-ttu-id="195d1-130">Questo può verificarsi, ad esempio, se il pin di input fornisce l'allocatore. L'allocatore restituisce le proprietà effettive come parametro di output nel metodo **seproperties** .</span><span class="sxs-lookup"><span data-stu-id="195d1-130">(For example, this can happen if the input pin provides the allocator.) The allocator returns the actual properties as an output parameter in the **SetProperties** method.</span></span>
5.  <span data-ttu-id="195d1-131">Outpin chiama [**IMemInputPin:: NotifyAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-notifyallocator) per informare il pin di input della selezione.</span><span class="sxs-lookup"><span data-stu-id="195d1-131">The outpin calls [**IMemInputPin::NotifyAllocator**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-notifyallocator) to inform the input pin of the selection.</span></span>
6.  <span data-ttu-id="195d1-132">Il pin di input deve chiamare [**IMemAllocator:: GetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getproperties) per verificare se le proprietà dell'allocatore sono accettabili.</span><span class="sxs-lookup"><span data-stu-id="195d1-132">The input pin should call [**IMemAllocator::GetProperties**](/windows/desktop/api/Strmif/nf-strmif-imemallocator-getproperties) to verify whether the allocator properties are acceptable.</span></span>
7.  <span data-ttu-id="195d1-133">Il pin di output è responsabile del commit e del commit dell'allocatore.</span><span class="sxs-lookup"><span data-stu-id="195d1-133">The output pin is responsible for committing and decommitting the allocator.</span></span> <span data-ttu-id="195d1-134">Questo errore si verifica quando il flusso viene avviato e interrotto.</span><span class="sxs-lookup"><span data-stu-id="195d1-134">This occurs when streaming starts and stops.</span></span>

<span data-ttu-id="195d1-135">In una connessione **IAsyncReader** , la negoziazione dell'allocatore funziona nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="195d1-135">In an **IAsyncReader** connection, allocator negotiation works as follows:</span></span>

1.  <span data-ttu-id="195d1-136">Il pin di input chiama [**IAsyncReader:: RequestAllocator**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-requestallocator) sul pin di output.</span><span class="sxs-lookup"><span data-stu-id="195d1-136">The input pin calls [**IAsyncReader::RequestAllocator**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-requestallocator) on the output pin.</span></span> <span data-ttu-id="195d1-137">Il pin di input specifica i requisiti del buffer e, facoltativamente, fornisce un allocatore.</span><span class="sxs-lookup"><span data-stu-id="195d1-137">The input pin specifies its buffer requirements and, optionally, provides an allocator.</span></span>
2.  <span data-ttu-id="195d1-138">Il pin di output seleziona un allocatore.</span><span class="sxs-lookup"><span data-stu-id="195d1-138">The output pin selects an allocator.</span></span> <span data-ttu-id="195d1-139">Può usare quello fornito dal pin di input, se disponibile, o crearne uno proprio.</span><span class="sxs-lookup"><span data-stu-id="195d1-139">It can use the one provided by the input pin, if any, or create its own.</span></span>
3.  <span data-ttu-id="195d1-140">Il pin di output restituisce l'allocatore come parametro in uscita nel metodo **RequestAllocator** .</span><span class="sxs-lookup"><span data-stu-id="195d1-140">The output pin returns the allocator as an outgoing parameter in the **RequestAllocator** method.</span></span> <span data-ttu-id="195d1-141">Il pin di input deve controllare le proprietà dell'allocatore.</span><span class="sxs-lookup"><span data-stu-id="195d1-141">The input pin should check the allocator properties.</span></span>
4.  <span data-ttu-id="195d1-142">Il pin di input è responsabile del commit e del decommit dell'allocatore.</span><span class="sxs-lookup"><span data-stu-id="195d1-142">The input pin is responsible for committing and decommitting the allocator.</span></span>
5.  <span data-ttu-id="195d1-143">In qualsiasi momento durante il processo di negoziazione dell'allocatore, il PIN potrebbe non riuscire a connettersi.</span><span class="sxs-lookup"><span data-stu-id="195d1-143">At any time during the allocator negotiation process, either pin can fail the connection.</span></span>
6.  <span data-ttu-id="195d1-144">Se il pin di output usa l'allocatore del PIN di input, può usare tale allocatore solo per recapitare campioni al pin di input.</span><span class="sxs-lookup"><span data-stu-id="195d1-144">If the output pin uses the input pin's allocator, it can use that allocator only to deliver samples to that input pin.</span></span> <span data-ttu-id="195d1-145">Il filtro proprietario non deve usare l'allocatore per recapitare esempi ad altri pin.</span><span class="sxs-lookup"><span data-stu-id="195d1-145">The owning filter must not use the allocator to deliver samples to other pins.</span></span>

## <a name="related-topics"></a><span data-ttu-id="195d1-146">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="195d1-146">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="195d1-147">Fornire un allocatore personalizzato</span><span class="sxs-lookup"><span data-stu-id="195d1-147">Providing a Custom Allocator</span></span>](providing-a-custom-allocator.md)
</dt> </dl>

 

 



