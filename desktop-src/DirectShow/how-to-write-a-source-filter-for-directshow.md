---
description: Questo argomento descrive come scrivere un filtro di origine personalizzato per DirectShow.
ms.assetid: 032f7624-2237-41cd-844a-18ed4a2e420d
title: Come scrivere un filtro di origine per DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 87af99595a43c86be0e2f4ecaa51768a211e9674
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/06/2021
ms.locfileid: "104522521"
---
# <a name="how-to-write-a-source-filter-for-directshow"></a><span data-ttu-id="31660-103">Come scrivere un filtro di origine per DirectShow</span><span class="sxs-lookup"><span data-stu-id="31660-103">How to Write a Source Filter for DirectShow</span></span>

<span data-ttu-id="31660-104">Questo argomento descrive come scrivere un filtro di origine personalizzato per DirectShow.</span><span class="sxs-lookup"><span data-stu-id="31660-104">This topic describes how to write a custom source filter for DirectShow.</span></span>

> [!Note]  
> <span data-ttu-id="31660-105">Questo argomento descrive solo le origini push; non descrive le origini pull, ad esempio il filtro di lettura asincrono, o i filtri splitter che si connettono alle origini di pull.</span><span class="sxs-lookup"><span data-stu-id="31660-105">This topic describes push sources only; it does not describe pull sources, such as the Async Reader Filter, or splitter filters that connect to pull sources.</span></span> <span data-ttu-id="31660-106">Per la distinzione tra le origini *push* e *pull* , vedere [flusso di dati per gli sviluppatori di filtri](data-flow-for-filter-developers.md).</span><span class="sxs-lookup"><span data-stu-id="31660-106">For the distinction between *push* and *pull* sources, see [Data Flow for Filter Developers](data-flow-for-filter-developers.md).</span></span>

 

## <a name="the-directshow-streaming-model"></a><span data-ttu-id="31660-107">Modello di streaming DirectShow</span><span class="sxs-lookup"><span data-stu-id="31660-107">The DirectShow Streaming Model</span></span>

<span data-ttu-id="31660-108">Quando si scrive un filtro di origine, è importante comprendere che un'origine push non è la stessa cosa di un'origine live.</span><span class="sxs-lookup"><span data-stu-id="31660-108">When you write a source filter, it is important to understand that a push source is not the same thing as a live source.</span></span> <span data-ttu-id="31660-109">Un'origine live recupera i dati da un'origine esterna, ad esempio una fotocamera o un flusso di rete.</span><span class="sxs-lookup"><span data-stu-id="31660-109">A live source gets data from some external source, such as a camera or a network stream.</span></span> <span data-ttu-id="31660-110">In genere, un'origine live non è in grado di controllare la frequenza di dati in ingresso.</span><span class="sxs-lookup"><span data-stu-id="31660-110">Generally, a live source cannot control the incoming rate of data.</span></span> <span data-ttu-id="31660-111">Se i filtri downstream non utilizzano i dati in modo sufficientemente veloce, è necessario che l'origine elimini gli esempi.</span><span class="sxs-lookup"><span data-stu-id="31660-111">If the downstream filters do not consume the data fast enough, the source will need to drop samples.</span></span>

<span data-ttu-id="31660-112">Tuttavia, non è necessario che un'origine push sia un'origine live.</span><span class="sxs-lookup"><span data-stu-id="31660-112">But a push source does not have to be a live source.</span></span> <span data-ttu-id="31660-113">Ad esempio, un'origine push può leggere i dati da un file locale.</span><span class="sxs-lookup"><span data-stu-id="31660-113">For example, a push source can read data from a local file.</span></span> <span data-ttu-id="31660-114">In tal caso, i filtri del renderer downstream determinano la velocità con cui i dati vengono utilizzati dall'origine, in base all'orologio di riferimento e ai timestamp di esempio.</span><span class="sxs-lookup"><span data-stu-id="31660-114">In that case, the downstream renderer filters determine how fast they consume the data from the source, based on the reference clock and the sample time stamps.</span></span> <span data-ttu-id="31660-115">Il filtro di origine recapita i campioni il più rapidamente possibile, ma il flusso di dati effettivo viene limitato dai renderer.</span><span class="sxs-lookup"><span data-stu-id="31660-115">The source filter delivers samples as quickly as possible, but the actual data flow is gated limited by the renderers.</span></span> <span data-ttu-id="31660-116">I meccanismi per il controllo del flusso di dati sono descritti in [flusso di dati per gli sviluppatori di filtri](data-flow-for-filter-developers.md).</span><span class="sxs-lookup"><span data-stu-id="31660-116">The mechanisms for gating the data flow are described in [Data Flow for Filter Developers](data-flow-for-filter-developers.md).</span></span>

<span data-ttu-id="31660-117">Ogni pin di output nel filtro di origine crea un thread denominato *thread di streaming*.</span><span class="sxs-lookup"><span data-stu-id="31660-117">Each output pin on the source filter creates a thread called a *streaming thread*.</span></span> <span data-ttu-id="31660-118">Il pin fornisce esempi sul thread di streaming.</span><span class="sxs-lookup"><span data-stu-id="31660-118">The pin delivers samples on the streaming thread.</span></span> <span data-ttu-id="31660-119">In genere, tutte le operazioni di decodifica, elaborazione e rendering avvengono in questo thread, sebbene alcuni filtri downstream possano creare thread aggiuntivi per accodare gli esempi di output.</span><span class="sxs-lookup"><span data-stu-id="31660-119">Typically, all of the decoding, processing, and rendering happens on this thread, although some downstream filters might create additional threads to queue their output samples.</span></span>

<span data-ttu-id="31660-120">Il thread di streaming esegue un ciclo con la struttura seguente:</span><span class="sxs-lookup"><span data-stu-id="31660-120">The streaming thread runs a loop with the following structure:</span></span>

``` syntax
until (stopped)
  1. Get a media sample from the allocator.
  2. Fill the sample with data.
  3. Time stamp the sample. 
  4. Deliver the sample downstream.
```

<span data-ttu-id="31660-121">Se non è disponibile alcun campione, il passaggio 1 si blocca fino a quando non viene reso disponibile un campione.</span><span class="sxs-lookup"><span data-stu-id="31660-121">If no samples are available, step 1 blocks until a sample becomes available.</span></span> <span data-ttu-id="31660-122">Il passaggio 4 può anche bloccare; ad esempio, può bloccarsi quando il grafico è sospeso.</span><span class="sxs-lookup"><span data-stu-id="31660-122">Step 4 can also block; for example, it can block while the graph is paused.</span></span>

<span data-ttu-id="31660-123">Il ciclo viene eseguito il più rapidamente possibile, ma è limitato dalla velocità con cui il filtro renderer esegue il rendering di ogni campione.</span><span class="sxs-lookup"><span data-stu-id="31660-123">The loop runs as quickly as possible, but is limited by how quickly the renderer filter renders each sample.</span></span> <span data-ttu-id="31660-124">Supponendo che il grafico di filtro disponga di un orologio di riferimento, la velocità è determinata dai tempi di presentazione degli esempi.</span><span class="sxs-lookup"><span data-stu-id="31660-124">Assuming the filter graph has a reference clock, the rate is determined by the presentation times on the samples.</span></span> <span data-ttu-id="31660-125">Se non è presente alcun clock di riferimento, il renderer utilizza gli esempi il più rapidamente possibile.</span><span class="sxs-lookup"><span data-stu-id="31660-125">If there is no reference clock, the renderer consumes samples as quickly as possible.</span></span>

## <a name="using-csource-and-csourcestream"></a><span data-ttu-id="31660-126">Uso di CSource e CSourceStream</span><span class="sxs-lookup"><span data-stu-id="31660-126">Using CSource and CSourceStream</span></span>

<span data-ttu-id="31660-127">Le classi base di DirectShow includono due classi che supportano le origini push: [**CSource**](csource.md) e [**CSourceStream**](csourcestream.md).</span><span class="sxs-lookup"><span data-stu-id="31660-127">The DirectShow base classes include two classes that support push sources: [**CSource**](csource.md) and [**CSourceStream**](csourcestream.md).</span></span>

-   <span data-ttu-id="31660-128">[**CSource**](csource.md) è la classe di base per il filtro e implementa l'interfaccia [**IBaseFilter**](/windows/desktop/api/Strmif/nn-strmif-ibasefilter) .</span><span class="sxs-lookup"><span data-stu-id="31660-128">[**CSource**](csource.md) is the base class for the filter and implements the [**IBaseFilter**](/windows/desktop/api/Strmif/nn-strmif-ibasefilter) interface.</span></span>
-   <span data-ttu-id="31660-129">[**CSourceStream**](csourcestream.md) è la classe base per i pin di output e implementa l'interfaccia [**Ipin**](/windows/desktop/api/Strmif/nn-strmif-ipin) .</span><span class="sxs-lookup"><span data-stu-id="31660-129">[**CSourceStream**](csourcestream.md) is the base class for the output pins, and implements the [**IPin**](/windows/desktop/api/Strmif/nn-strmif-ipin) interface.</span></span>

### <a name="output-pins"></a><span data-ttu-id="31660-130">Pin di output</span><span class="sxs-lookup"><span data-stu-id="31660-130">Output Pins</span></span>

<span data-ttu-id="31660-131">Un filtro di origine può avere più di un pin di output.</span><span class="sxs-lookup"><span data-stu-id="31660-131">A source filter can have more than one output pin.</span></span> <span data-ttu-id="31660-132">Nel metodo del costruttore del filtro creare uno o più pin derivati da [**CSourceStream**](csourcestream.md) (un PIN per ogni flusso di output).</span><span class="sxs-lookup"><span data-stu-id="31660-132">In your filter's constructor method, create one or more pins derived from [**CSourceStream**](csourcestream.md) (one pin per output stream).</span></span> <span data-ttu-id="31660-133">Non è necessario archiviare i puntatori ai pin; i pin si aggiungono automaticamente al filtro quando vengono creati.</span><span class="sxs-lookup"><span data-stu-id="31660-133">You don't need to store pointers to the pins; the pins automatically add themselves to the filter when they are created.</span></span>

### <a name="output-formats"></a><span data-ttu-id="31660-134">Formati di output</span><span class="sxs-lookup"><span data-stu-id="31660-134">Output Formats</span></span>

<span data-ttu-id="31660-135">Il pin di output gestisce la negoziazione del formato con i seguenti metodi di [**CSourceStream**](csourcestream.md) :</span><span class="sxs-lookup"><span data-stu-id="31660-135">The output pin handles format negotiation with the following [**CSourceStream**](csourcestream.md) methods:</span></span>



| <span data-ttu-id="31660-136">Metodo</span><span class="sxs-lookup"><span data-stu-id="31660-136">Method</span></span>                                                 | <span data-ttu-id="31660-137">Descrizione</span><span class="sxs-lookup"><span data-stu-id="31660-137">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|--------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="31660-138">**GetMediaType**</span><span class="sxs-lookup"><span data-stu-id="31660-138">**GetMediaType**</span></span>](csourcestream-getmediatype.md)     | <span data-ttu-id="31660-139">Ottiene un tipo di supporto dal pin di output.</span><span class="sxs-lookup"><span data-stu-id="31660-139">Gets a media type from the output pin.</span></span> <br/> <span data-ttu-id="31660-140">Il PIN deve proporre almeno un tipo di supporto, perché il filtro downstream potrebbe non proporre tipi.</span><span class="sxs-lookup"><span data-stu-id="31660-140">The pin must propose at least one media type, because the downstream filter might not propose any types.</span></span> <span data-ttu-id="31660-141">Nella maggior parte dei casi, il filtro downstream sarà un decodificatore o un renderer, a seconda che il filtro di origine fornisca dati compressi o non compressi.</span><span class="sxs-lookup"><span data-stu-id="31660-141">In most cases, the downstream filter will be a decoder or a renderer, depending on whether the source filter delivers compressed or uncompressed data.</span></span> <span data-ttu-id="31660-142">Un filtro renderer richiede in genere un tipo di supporto completo, contenente tutte le informazioni sul formato necessarie per eseguire il rendering del flusso.</span><span class="sxs-lookup"><span data-stu-id="31660-142">A renderer filter usually requires a complete media type, containing all of the format information needed to render the stream.</span></span> <span data-ttu-id="31660-143">Per un decodificatore, la quantità di informazioni richiesta nel tipo di supporto dipende molto dal formato di codifica.</span><span class="sxs-lookup"><span data-stu-id="31660-143">For a decoder, the amount of information that is required in the media type depends very much on the encoding format.</span></span><br/> |
| [<span data-ttu-id="31660-144">**CheckMediaType**</span><span class="sxs-lookup"><span data-stu-id="31660-144">**CheckMediaType**</span></span>](csourcestream-checkmediatype.md) | <span data-ttu-id="31660-145">Controlla se il pin di output accetta un determinato tipo di supporto.</span><span class="sxs-lookup"><span data-stu-id="31660-145">Checks if the output pin accepts a given media type.</span></span> <span data-ttu-id="31660-146">L'override di questo metodo è facoltativo, a seconda della modalità di implementazione di [**GetMediaType**](csourcestream-getmediatype.md).</span><span class="sxs-lookup"><span data-stu-id="31660-146">Overriding this method is optional, depending on how you implement [**GetMediaType**](csourcestream-getmediatype.md).</span></span>                                                                                                                                                                                                                                                                                                                                                                                                         |



 

<span data-ttu-id="31660-147">Il metodo [**GetMediaType**](csourcestream-getmediatype.md) è sovraccarico:</span><span class="sxs-lookup"><span data-stu-id="31660-147">The [**GetMediaType**](csourcestream-getmediatype.md) method is overloaded:</span></span>

-   <span data-ttu-id="31660-148">[**GetMediaType**](csourcestream-getmediatype.md) (1) accetta un solo parametro, un puntatore a un oggetto [**CMediaType**](cmediatype.md) .</span><span class="sxs-lookup"><span data-stu-id="31660-148">[**GetMediaType**](csourcestream-getmediatype.md) (1) takes a single parameter, a pointer to a [**CMediaType**](cmediatype.md) object.</span></span>
-   <span data-ttu-id="31660-149">[**GetMediaType**](csourcestream-getmediatype2.md) (2) accetta una variabile di indice e un puntatore a un oggetto [**CMediaType**](cmediatype.md) .</span><span class="sxs-lookup"><span data-stu-id="31660-149">[**GetMediaType**](csourcestream-getmediatype2.md) (2) takes an index variable and a pointer to a [**CMediaType**](cmediatype.md) object.</span></span>

<span data-ttu-id="31660-150">Se il pin di output del filtro di origine supporta esattamente un formato multimediale, è necessario eseguire l'override di (1) per inizializzare l'oggetto [**CMediaType**](cmediatype.md) con tale formato.</span><span class="sxs-lookup"><span data-stu-id="31660-150">If the source filter's output pin supports exactly one media format, you should override (1) to initialize the [**CMediaType**](cmediatype.md) object with that format.</span></span> <span data-ttu-id="31660-151">Lasciare l'implementazione predefinita di (2) e lasciare anche l'implementazione predefinita di [**CheckMediaType**](csourcestream-checkmediatype.md).</span><span class="sxs-lookup"><span data-stu-id="31660-151">Leave the default implementation of (2) and also leave the default implementation of [**CheckMediaType**](csourcestream-checkmediatype.md).</span></span>

<span data-ttu-id="31660-152">Se il pin supporta più di un formato, eseguire l'override di (2).</span><span class="sxs-lookup"><span data-stu-id="31660-152">If the pin supports more than one format, override (2).</span></span> <span data-ttu-id="31660-153">Inizializzare l'oggetto [**CMediaType**](cmediatype.md) in base al valore della variabile index.</span><span class="sxs-lookup"><span data-stu-id="31660-153">Initialize the [**CMediaType**](cmediatype.md) object according to the value of the index variable.</span></span> <span data-ttu-id="31660-154">Il PIN deve restituire i formati come un elenco ordinato.</span><span class="sxs-lookup"><span data-stu-id="31660-154">The pin should return the formats as an ordered list.</span></span> <span data-ttu-id="31660-155">In questo caso, è necessario anche eseguire l'override di [**CheckMediaType**](csourcestream-checkmediatype.md) per verificare il tipo di supporto in base all'elenco di formati.</span><span class="sxs-lookup"><span data-stu-id="31660-155">In this case, you must also override the [**CheckMediaType**](csourcestream-checkmediatype.md) to check the media type against your list of formats.</span></span>

<span data-ttu-id="31660-156">Per i formati video non compressi, tenere presente che il filtro downstream può proporre formati con diversi valori stride.</span><span class="sxs-lookup"><span data-stu-id="31660-156">For uncompressed video formats, remember that the downstream filter can propose formats with various stride values.</span></span> <span data-ttu-id="31660-157">Il filtro deve accettare qualsiasi valore stride valido.</span><span class="sxs-lookup"><span data-stu-id="31660-157">Your filter should accept any valid stride value.</span></span> <span data-ttu-id="31660-158">Per ulteriori informazioni, vedere [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader).</span><span class="sxs-lookup"><span data-stu-id="31660-158">For more information, see [**BITMAPINFOHEADER**](/windows/win32/api/wingdi/ns-wingdi-bitmapinfoheader).</span></span>

<span data-ttu-id="31660-159">È anche necessario eseguire l'override del metodo [**CBaseOutputPin::D ecidebuffersize**](cbaseoutputpin-decidebuffersize.md) virtuale puro.</span><span class="sxs-lookup"><span data-stu-id="31660-159">You must also override the pure-virtual [**CBaseOutputPin::DecideBufferSize**](cbaseoutputpin-decidebuffersize.md) method.</span></span> <span data-ttu-id="31660-160">Utilizzare questo metodo per impostare le dimensioni dei buffer di esempio.</span><span class="sxs-lookup"><span data-stu-id="31660-160">Use this method to set the size of the sample buffers.</span></span>

### <a name="streaming"></a><span data-ttu-id="31660-161">Streaming</span><span class="sxs-lookup"><span data-stu-id="31660-161">Streaming</span></span>

<span data-ttu-id="31660-162">La classe [**CSourceStream**](csourcestream.md) crea il thread di streaming per il PIN.</span><span class="sxs-lookup"><span data-stu-id="31660-162">The [**CSourceStream**](csourcestream.md) class creates the streaming thread for the pin.</span></span> <span data-ttu-id="31660-163">La routine thread è implementata nel metodo [**CSourceStream::D obufferprocessingloop**](csourcestream-dobufferprocessingloop.md) .</span><span class="sxs-lookup"><span data-stu-id="31660-163">The thread procedure is implemented in the [**CSourceStream::DoBufferProcessingLoop**](csourcestream-dobufferprocessingloop.md) method.</span></span> <span data-ttu-id="31660-164">Questo metodo chiama il metodo [**CSourceStream:: FillBuffer**](csourcestream-fillbuffer.md) , virtual pure, che la classe derivata deve eseguire l'override.</span><span class="sxs-lookup"><span data-stu-id="31660-164">This method calls the pure-virtual [**CSourceStream::FillBuffer**](csourcestream-fillbuffer.md) method, which the derived class must override.</span></span> <span data-ttu-id="31660-165">Questo metodo è il punto in cui il pin riempie il buffer con i dati.</span><span class="sxs-lookup"><span data-stu-id="31660-165">This method is where the pin fills the buffer with data.</span></span> <span data-ttu-id="31660-166">Se, ad esempio, il filtro recapita video non compressi, è possibile creare i fotogrammi video.</span><span class="sxs-lookup"><span data-stu-id="31660-166">For example, if your filter delivers uncompressed video, this is where you would draw the video frames.</span></span>

<span data-ttu-id="31660-167">La classe base viene avviata automaticamente e arresta il ciclo dei thread al momento giusto, quando il filtro viene sospeso o interrotto.</span><span class="sxs-lookup"><span data-stu-id="31660-167">The base class automatically starts and stops the thread loop at the right times, when the filter pauses or stops.</span></span> <span data-ttu-id="31660-168">Quando si verifica questo problema, la classe [**CSourceStream**](csourcestream.md) chiama alcuni metodi per notificare la classe derivata:</span><span class="sxs-lookup"><span data-stu-id="31660-168">When this happens, the [**CSourceStream**](csourcestream.md) class calls some methods to notify your derived class:</span></span>

-   [<span data-ttu-id="31660-169">**CSourceStream::OnThreadCreate**</span><span class="sxs-lookup"><span data-stu-id="31660-169">**CSourceStream::OnThreadCreate**</span></span>](csourcestream-onthreadcreate.md)
-   [<span data-ttu-id="31660-170">**CSourceStream::OnThreadDestroy**</span><span class="sxs-lookup"><span data-stu-id="31660-170">**CSourceStream::OnThreadDestroy**</span></span>](csourcestream-onthreaddestroy.md)
-   [<span data-ttu-id="31660-171">**CSourceStream::OnThreadStartPlay**</span><span class="sxs-lookup"><span data-stu-id="31660-171">**CSourceStream::OnThreadStartPlay**</span></span>](csourcestream-onthreadstartplay.md)

<span data-ttu-id="31660-172">È possibile eseguire l'override di questi metodi se è necessario aggiungere una gestione speciale.</span><span class="sxs-lookup"><span data-stu-id="31660-172">You can override these methods if you need to add any special handling.</span></span> <span data-ttu-id="31660-173">In caso contrario, le implementazioni predefinite restituiscono semplicemente **S \_ OK**.</span><span class="sxs-lookup"><span data-stu-id="31660-173">Otherwise, the default implementations simply return **S\_OK**.</span></span>

## <a name="seeking"></a><span data-ttu-id="31660-174">La ricerca</span><span class="sxs-lookup"><span data-stu-id="31660-174">Seeking</span></span>

<span data-ttu-id="31660-175">Se si dispone di un filtro di origine con un pin di output, è possibile usare la classe [**CSourceSeeking**](csourceseeking.md) come punto di partenza per l'implementazione della ricerca.</span><span class="sxs-lookup"><span data-stu-id="31660-175">If you have a source filter with one output pin, you can use the [**CSourceSeeking**](csourceseeking.md) class as a starting point for implementing seeking.</span></span> <span data-ttu-id="31660-176">Ereditare la classe pin sia da [**CSourceStream**](csourcestream.md) che da **CSourceSeeking**.</span><span class="sxs-lookup"><span data-stu-id="31660-176">Inherit your pin class from both [**CSourceStream**](csourcestream.md) and **CSourceSeeking**.</span></span>

> [!Note]  
> <span data-ttu-id="31660-177">[**CSourceSeeking**](csourceseeking.md) non è consigliato per un filtro con più di un pin di output.</span><span class="sxs-lookup"><span data-stu-id="31660-177">[**CSourceSeeking**](csourceseeking.md) is not recommended for a filter with more than one output pin.</span></span> <span data-ttu-id="31660-178">Il problema principale è che solo un PIN deve rispondere alle richieste di ricerca.</span><span class="sxs-lookup"><span data-stu-id="31660-178">The main issue is that only one pin should respond to seeking requests.</span></span> <span data-ttu-id="31660-179">Questa operazione richiede in genere la comunicazione tra i pin e il filtro.</span><span class="sxs-lookup"><span data-stu-id="31660-179">Typically this requires communication among the pins and the filter.</span></span>

 

<span data-ttu-id="31660-180">La classe [**CSourceSeeking**](csourceseeking.md) gestisce la velocità di riproduzione, l'ora di inizio, l'ora di arresto e la durata.</span><span class="sxs-lookup"><span data-stu-id="31660-180">The [**CSourceSeeking**](csourceseeking.md) class manages the playback rate, start time, stop time, and duration.</span></span> <span data-ttu-id="31660-181">La classe derivata deve impostare la durata e l'ora di arresto iniziali.</span><span class="sxs-lookup"><span data-stu-id="31660-181">Your derived class should set the initial stop time and duration.</span></span> <span data-ttu-id="31660-182">Ogni volta che viene modificato uno di questi valori, viene chiamato il metodo [**CSourceSeeking:: changere**](csourceseeking-changerate.md), [**CSourceSeeking:: iniziale**](csourceseeking-changestart.md)o [**CSourceSeeking:: ChangeStop**](csourceseeking-changestop.md) , a seconda dei casi.</span><span class="sxs-lookup"><span data-stu-id="31660-182">Whenever one of these values changes, the [**CSourceSeeking::ChangeRate**](csourceseeking-changerate.md), [**CSourceSeeking::ChangeStart**](csourceseeking-changestart.md), or [**CSourceSeeking::ChangeStop**](csourceseeking-changestop.md) method is called, as appropriate.</span></span> <span data-ttu-id="31660-183">I metodi sono tutti metodi virtuali puri.</span><span class="sxs-lookup"><span data-stu-id="31660-183">The methods are all pure virtual methods.</span></span> <span data-ttu-id="31660-184">La classe pin derivata esegue l'override di questi metodi per eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="31660-184">The derived pin class overrides these methods to do the following:</span></span>

1.  <span data-ttu-id="31660-185">Chiamare [**Ipin:: BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) sul pin downstream.</span><span class="sxs-lookup"><span data-stu-id="31660-185">Call [**IPin::BeginFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-beginflush) on the downstream pin.</span></span> <span data-ttu-id="31660-186">In questo modo, i filtri downstream rilasciano campioni che contengono e rifiutano i nuovi esempi.</span><span class="sxs-lookup"><span data-stu-id="31660-186">This causes downstream filters to release samples they are holding and reject new samples.</span></span>
2.  <span data-ttu-id="31660-187">Chiamare [**CSourceStream:: Stop**](csourcestream-stop.md) per arrestare il thread di streaming.</span><span class="sxs-lookup"><span data-stu-id="31660-187">Call [**CSourceStream::Stop**](csourcestream-stop.md) to stop the streaming thread.</span></span> <span data-ttu-id="31660-188">Il filtro di origine sospende la produzione di nuovi dati.</span><span class="sxs-lookup"><span data-stu-id="31660-188">The source filter suspends producing new data.</span></span>
3.  <span data-ttu-id="31660-189">Chiamare [**Ipin:: EndFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush) sul pin downstream.</span><span class="sxs-lookup"><span data-stu-id="31660-189">Call [**IPin::EndFlush**](/windows/desktop/api/Strmif/nf-strmif-ipin-endflush) on the downstream pin.</span></span> <span data-ttu-id="31660-190">Ciò segnala ai filtri downstream di accettare nuovi dati.</span><span class="sxs-lookup"><span data-stu-id="31660-190">This signals the downstream filters to accept new data.</span></span>
4.  <span data-ttu-id="31660-191">Chiamare [**Ipin:: NewSegment**](/windows/desktop/api/Strmif/nf-strmif-ipin-newsegment) con la nuova frequenza e gli orari di inizio e di fine.</span><span class="sxs-lookup"><span data-stu-id="31660-191">Call [**IPin::NewSegment**](/windows/desktop/api/Strmif/nf-strmif-ipin-newsegment) with the new start and stop times and rate.</span></span>
5.  <span data-ttu-id="31660-192">Impostare la proprietà discontinuità nell'esempio successivo.</span><span class="sxs-lookup"><span data-stu-id="31660-192">Set the discontinuity property on the next sample.</span></span>

<span data-ttu-id="31660-193">Per ulteriori informazioni, vedere [supporto della ricerca in un filtro di origine](supporting-seeking-in-a-source-filter.md).</span><span class="sxs-lookup"><span data-stu-id="31660-193">For more information, see [Supporting Seeking in a Source Filter](supporting-seeking-in-a-source-filter.md).</span></span>

<span data-ttu-id="31660-194">Se il filtro supporta la ricerca, la posizione del flusso è ora indipendente dall'ora di presentazione.</span><span class="sxs-lookup"><span data-stu-id="31660-194">If your filter supports seeking, the stream position is now independent of the presentation time.</span></span> <span data-ttu-id="31660-195">Dopo una ricerca, i timestamp vengono reimpostati su zero.</span><span class="sxs-lookup"><span data-stu-id="31660-195">After a seek, time stamps reset to zero.</span></span> <span data-ttu-id="31660-196">La formula generale per gli indicatori temporali è:</span><span class="sxs-lookup"><span data-stu-id="31660-196">The general formula for time stamps is:</span></span>

-   <span data-ttu-id="31660-197">ora di inizio di esempio = frequenza tempo trascorso/riproduzione</span><span class="sxs-lookup"><span data-stu-id="31660-197">sample start time = time elapsed / playback rate</span></span>
-   <span data-ttu-id="31660-198">ora di fine campione = ora di inizio di esempio + (tempo per fotogramma/frequenza di riproduzione)</span><span class="sxs-lookup"><span data-stu-id="31660-198">sample end time = sample start time + (time per frame / playback rate)</span></span>

<span data-ttu-id="31660-199">dove *tempo trascorso* è il tempo trascorso dall'avvio dell'esecuzione del filtro o dall'ultimo comando seek.</span><span class="sxs-lookup"><span data-stu-id="31660-199">where *time elapsed* is the time that has elapsed since the filter started running or since the last seek command.</span></span>

### <a name="time-formats-for-seeking"></a><span data-ttu-id="31660-200">Formati di ora per la ricerca</span><span class="sxs-lookup"><span data-stu-id="31660-200">Time Formats for Seeking</span></span>

<span data-ttu-id="31660-201">Per impostazione predefinita, i comandi Seek si trovano in unità di 100-nanosecondi.</span><span class="sxs-lookup"><span data-stu-id="31660-201">By default, seek commands are in units of 100-nanoseconds.</span></span> <span data-ttu-id="31660-202">Il filtro di origine può supportare formati di ora aggiuntivi, ad esempio la ricerca in base al numero di frame.</span><span class="sxs-lookup"><span data-stu-id="31660-202">Your source filter can support additional time formats, such as seeking by frame number.</span></span> <span data-ttu-id="31660-203">Ogni formato di ora è identificato da un GUID. vedere [**GUID del formato ora**](time-format-guids.md).</span><span class="sxs-lookup"><span data-stu-id="31660-203">Each time format is identified by a GUID; see [**Time Format GUIDs**](time-format-guids.md).</span></span>

<span data-ttu-id="31660-204">Per supportare formati di ora aggiuntivi, è necessario implementare i metodi seguenti sul pin di output:</span><span class="sxs-lookup"><span data-stu-id="31660-204">To support additional time formats, you must implement the following methods on your output pin:</span></span>

-   [<span data-ttu-id="31660-205">**IMediaSeeking::ConvertTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="31660-205">**IMediaSeeking::ConvertTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-converttimeformat)
-   [<span data-ttu-id="31660-206">**IMediaSeeking:: GetTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="31660-206">**IMediaSeeking::GetTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-gettimeformat)
-   [<span data-ttu-id="31660-207">**IMediaSeeking::IsFormatSupported**</span><span class="sxs-lookup"><span data-stu-id="31660-207">**IMediaSeeking::IsFormatSupported**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-isformatsupported)
-   [<span data-ttu-id="31660-208">**IMediaSeeking::IsUsingTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="31660-208">**IMediaSeeking::IsUsingTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-isusingtimeformat)
-   [<span data-ttu-id="31660-209">**IMediaSeeking::QueryPreferredFormat**</span><span class="sxs-lookup"><span data-stu-id="31660-209">**IMediaSeeking::QueryPreferredFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-querypreferredformat)
-   [<span data-ttu-id="31660-210">**IMediaSeeking::SetTimeFormat**</span><span class="sxs-lookup"><span data-stu-id="31660-210">**IMediaSeeking::SetTimeFormat**</span></span>](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-settimeformat)

<span data-ttu-id="31660-211">Se l'applicazione imposta un nuovo formato ora, tutti i parametri position nei metodi [**IMediaSeeking**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking) vengono interpretati in base al nuovo formato di ora.</span><span class="sxs-lookup"><span data-stu-id="31660-211">If the application sets a new time format, all of the position parameters in the [**IMediaSeeking**](/windows/desktop/api/Strmif/nn-strmif-imediaseeking) methods are interpreted in terms of the new time format.</span></span> <span data-ttu-id="31660-212">Se, ad esempio, il formato dell'ora è frames, il metodo [**IMediaSeeking:: GetDuration**](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-getduration) deve restituire la durata nei frame.</span><span class="sxs-lookup"><span data-stu-id="31660-212">For example, if the time format is frames, the [**IMediaSeeking::GetDuration**](/windows/desktop/api/Strmif/nf-strmif-imediaseeking-getduration) method must return the duration in frames.</span></span>

<span data-ttu-id="31660-213">In pratica, pochi filtri DirectShow supportano formati di ora aggiuntivi e, di conseguenza, alcune applicazioni DirectShow utilizzano questa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="31660-213">In practice, few DirectShow filters support additional time formats, and as a result, few DirectShow applications make use of this capability.</span></span>

## <a name="related-topics"></a><span data-ttu-id="31660-214">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="31660-214">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="31660-215">Scrittura di filtri di origine</span><span class="sxs-lookup"><span data-stu-id="31660-215">Writing Source Filters</span></span>](writing-source-filters.md)
</dt> </dl>

 

 




