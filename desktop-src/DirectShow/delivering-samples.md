---
description: Distribuzione di esempi
ms.assetid: 31aabb6d-dec6-41fa-b24d-35a77b67bc4a
title: Distribuzione di esempi
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 083bc8c88649c04bdf9f93f86ebcc277ee48e75e
ms.sourcegitcommit: a47bd86f517de76374e4fff33cfeb613eb259a7e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/06/2021
ms.locfileid: "104401347"
---
# <a name="delivering-samples"></a><span data-ttu-id="79a42-103">Distribuzione di esempi</span><span class="sxs-lookup"><span data-stu-id="79a42-103">Delivering Samples</span></span>

<span data-ttu-id="79a42-104">Questo articolo descrive come un filtro fornisce un esempio.</span><span class="sxs-lookup"><span data-stu-id="79a42-104">This article describes how a filter delivers a sample.</span></span> <span data-ttu-id="79a42-105">Descrive il modello push, usando i metodi [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) e il modello pull, usando [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader).</span><span class="sxs-lookup"><span data-stu-id="79a42-105">It describes both the push model, using [**IMemInputPin**](/windows/desktop/api/Strmif/nn-strmif-imeminputpin) methods, and the pull model, using [**IAsyncReader**](/windows/desktop/api/Strmif/nn-strmif-iasyncreader).</span></span>

<span data-ttu-id="79a42-106">**Modello push: distribuzione di un esempio**</span><span class="sxs-lookup"><span data-stu-id="79a42-106">**Push Model: Delivering a Sample**</span></span>

<span data-ttu-id="79a42-107">Il pin di output recapita un esempio chiamando il metodo [**IMemInputPin:: Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) o il metodo [**IMemInputPin:: ReceiveMultiple**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivemultiple) , che è equivalente ma fornisce una matrice di esempi.</span><span class="sxs-lookup"><span data-stu-id="79a42-107">The output pin delivers a sample by calling the [**IMemInputPin::Receive**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receive) method or the [**IMemInputPin::ReceiveMultiple**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivemultiple) method, which is equivalent but delivers an array of samples.</span></span> <span data-ttu-id="79a42-108">Il pin di input può bloccarsi all'interno di **Receive** (o **ReceiveMultiple**).</span><span class="sxs-lookup"><span data-stu-id="79a42-108">The input pin can block inside **Receive** (or **ReceiveMultiple**).</span></span> <span data-ttu-id="79a42-109">Se il PIN potrebbe bloccarsi, il metodo [**IMemInputPin:: ReceiveCanBlock**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivecanblock) deve restituire S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="79a42-109">If the pin might block, its [**IMemInputPin::ReceiveCanBlock**](/windows/desktop/api/Strmif/nf-strmif-imeminputpin-receivecanblock) method should return S\_OK.</span></span> <span data-ttu-id="79a42-110">Se il PIN non garantisce mai il blocco, **ReceiveCanBlock** deve restituire S \_ false.</span><span class="sxs-lookup"><span data-stu-id="79a42-110">If the pin guarantees never to block, **ReceiveCanBlock** should return S\_FALSE.</span></span> <span data-ttu-id="79a42-111">Il \_ valore restituito S OK non significa che **Receive** always Blocks, solo che potrebbe.</span><span class="sxs-lookup"><span data-stu-id="79a42-111">The S\_OK return value does not mean that **Receive** always blocks, just that it might.</span></span>

<span data-ttu-id="79a42-112">Sebbene la **ricezione** possa essere bloccata in modo da attendere la disponibilità di una risorsa, non dovrebbe bloccarsi in attesa di più dati dal filtro upstream.</span><span class="sxs-lookup"><span data-stu-id="79a42-112">Although **Receive** can block to wait for a resource to become available, it should not block to wait for more data from the upstream filter.</span></span> <span data-ttu-id="79a42-113">Questa operazione può causare un deadlock in cui il filtro upstream attende il rilascio dell'esempio da parte del filtro downstream, che non si verifica mai perché il filtro downstream è in attesa sul filtro upstream.</span><span class="sxs-lookup"><span data-stu-id="79a42-113">Doing so can cause a deadlock where the upstream filter waits for the downstream filter to release the sample, which never happens because the downstream filter is waiting on the upstream filter.</span></span> <span data-ttu-id="79a42-114">Se un filtro ha più pin di input, tuttavia, un pin può attendere la ricezione dei dati da parte di un altro pin.</span><span class="sxs-lookup"><span data-stu-id="79a42-114">If a filter has multiple input pins, however, one pin can wait for another pin to receive data.</span></span> <span data-ttu-id="79a42-115">Ad esempio, il filtro [Mux AVI](avi-mux-filter.md) esegue questa operazione in modo che possa interleave dati audio e video.</span><span class="sxs-lookup"><span data-stu-id="79a42-115">For example, the [AVI Mux](avi-mux-filter.md) filter does this so that it can interleave audio and video data.</span></span>

<span data-ttu-id="79a42-116">Un PIN potrebbe rifiutare un campione per diversi motivi:</span><span class="sxs-lookup"><span data-stu-id="79a42-116">A pin might reject a sample for a number of reasons:</span></span>

-   <span data-ttu-id="79a42-117">Il PIN sta per essere scaricato (vedere [scaricamento](flushing.md)).</span><span class="sxs-lookup"><span data-stu-id="79a42-117">The pin is flushing (see [Flushing](flushing.md)).</span></span>
-   <span data-ttu-id="79a42-118">Il PIN non è connesso.</span><span class="sxs-lookup"><span data-stu-id="79a42-118">The pin is not connected.</span></span>
-   <span data-ttu-id="79a42-119">Il filtro è stato arrestato.</span><span class="sxs-lookup"><span data-stu-id="79a42-119">The filter is stopped.</span></span>
-   <span data-ttu-id="79a42-120">Si è verificato un altro errore.</span><span class="sxs-lookup"><span data-stu-id="79a42-120">Some other error occurred.</span></span>

<span data-ttu-id="79a42-121">Il metodo **Receive** deve restituire S \_ false nel primo caso e un codice di errore negli altri casi.</span><span class="sxs-lookup"><span data-stu-id="79a42-121">The **Receive** method should return S\_FALSE in the first case, and a failure code in the other cases.</span></span> <span data-ttu-id="79a42-122">Il filtro upstream deve interrompere l'invio di esempi quando il codice restituito è diverso da S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="79a42-122">The upstream filter should stop sending samples when the return code is anything other than S\_OK.</span></span>

<span data-ttu-id="79a42-123">È possibile considerare i primi tre casi come errori "previsti", nel senso che lo stato del filtro era errato per la ricezione degli esempi.</span><span class="sxs-lookup"><span data-stu-id="79a42-123">You can consider the first three cases to be "expected" failures, in the sense that the filter was in the wrong state to receive samples.</span></span> <span data-ttu-id="79a42-124">Un errore imprevisto potrebbe essere uno che fa sì che il pin rifiuti un campione anche se il pin si trova in uno stato di ricezione.</span><span class="sxs-lookup"><span data-stu-id="79a42-124">An unexpected failure would be one that causes the pin to reject a sample even though the pin is in a receiving state.</span></span> <span data-ttu-id="79a42-125">Se si verifica un errore di questo tipo, il PIN deve inviare una notifica di fine flusso a valle e inviare un evento [**\_ ERRORABORT EC**](ec-errorabort.md) a Filter Graph Manager.</span><span class="sxs-lookup"><span data-stu-id="79a42-125">If an error of this type occurs, the pin should send an end-of-stream notification downstream, and send an [**EC\_ERRORABORT**](ec-errorabort.md) event to the Filter Graph Manager.</span></span>

<span data-ttu-id="79a42-126">Nelle classi di base di DirectShow, il metodo [**CBaseInputPin:: CheckStreaming**](cbaseinputpin-checkstreaming.md) controlla i casi di errore generali: svuotamento, arrestato e così via.</span><span class="sxs-lookup"><span data-stu-id="79a42-126">In the DirectShow base classes, the [**CBaseInputPin::CheckStreaming**](cbaseinputpin-checkstreaming.md) method checks for the general failure cases—flushing, stopped, and so forth.</span></span> <span data-ttu-id="79a42-127">La classe derivata deve verificare la presenza di errori specifici del filtro.</span><span class="sxs-lookup"><span data-stu-id="79a42-127">The derived class will need to check for failures that are specific to the filter.</span></span> <span data-ttu-id="79a42-128">In caso di errore, il metodo [**CBaseInputPin:: Receive**](cbaseinputpin-receive.md) Invia la notifica di fine flusso e l' \_ evento ERRORABORT EC.</span><span class="sxs-lookup"><span data-stu-id="79a42-128">In case of an error, the [**CBaseInputPin::Receive**](cbaseinputpin-receive.md) method sends the end-of-stream notification and the EC\_ERRORABORT event.</span></span>

<span data-ttu-id="79a42-129">**Modello pull: richiesta di un esempio**</span><span class="sxs-lookup"><span data-stu-id="79a42-129">**Pull Model: Requesting a Sample**</span></span>

<span data-ttu-id="79a42-130">Nell'interfaccia **IAsyncReader** il pin di input richiede esempi dal pin di output chiamando uno dei metodi seguenti:</span><span class="sxs-lookup"><span data-stu-id="79a42-130">In the **IAsyncReader** interface, the input pin requests samples from the output pin by calling one of the following methods:</span></span>

-   [<span data-ttu-id="79a42-131">**IAsyncReader:: Request**</span><span class="sxs-lookup"><span data-stu-id="79a42-131">**IAsyncReader::Request**</span></span>](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-request)
-   [<span data-ttu-id="79a42-132">**IAsyncReader::SyncRead**</span><span class="sxs-lookup"><span data-stu-id="79a42-132">**IAsyncReader::SyncRead**</span></span>](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-syncread)
-   [<span data-ttu-id="79a42-133">**IAsyncReader::SyncReadAligned**</span><span class="sxs-lookup"><span data-stu-id="79a42-133">**IAsyncReader::SyncReadAligned**</span></span>](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-syncreadaligned)

<span data-ttu-id="79a42-134">Il metodo di **richiesta** è asincrono. il pin di input chiama [**IAsyncReader:: WaitForNext**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-waitfornext) per attendere il completamento della richiesta.</span><span class="sxs-lookup"><span data-stu-id="79a42-134">The **Request** method is asynchronous; the input pin calls [**IAsyncReader::WaitForNext**](/windows/desktop/api/Strmif/nf-strmif-iasyncreader-waitfornext) to wait for the request to complete.</span></span> <span data-ttu-id="79a42-135">Gli altri due metodi sono sincroni.</span><span class="sxs-lookup"><span data-stu-id="79a42-135">The other two methods are synchronous.</span></span>

<span data-ttu-id="79a42-136">**Quando recapitare i dati**</span><span class="sxs-lookup"><span data-stu-id="79a42-136">**When to Deliver Data**</span></span>

<span data-ttu-id="79a42-137">Un filtro recapita sempre gli esempi mentre è nello stato in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="79a42-137">A filter always delivers samples while it is in the running state.</span></span> <span data-ttu-id="79a42-138">Nella maggior parte dei casi, un filtro fornisce anche esempi mentre è in pausa.</span><span class="sxs-lookup"><span data-stu-id="79a42-138">In most cases, a filter also delivers samples while paused.</span></span> <span data-ttu-id="79a42-139">Ciò consente al grafico di individuare i dati in modo che la riproduzione venga avviata immediatamente quando viene chiamata l' **esecuzione** (vedere [Stati di filtro](filter-states.md)).</span><span class="sxs-lookup"><span data-stu-id="79a42-139">This enables the graph to cue up the data so that playback starts immediately when **Run** is called (see [Filter States](filter-states.md)).</span></span> <span data-ttu-id="79a42-140">Se il filtro non recapita i dati mentre è in pausa, il metodo **IMediaFilter:: GetState** del filtro deve restituire \_ \_ il segnale del cant di VFW \_ nello stato sospeso.</span><span class="sxs-lookup"><span data-stu-id="79a42-140">If your filter does not deliver data while paused, the filter's **IMediaFilter::GetState** method should return VFW\_S\_CANT\_CUE in the paused state.</span></span> <span data-ttu-id="79a42-141">Questo codice restituito segnala al grafico del filtro di non attendere i dati dal filtro prima di completare la transizione di sospensione.</span><span class="sxs-lookup"><span data-stu-id="79a42-141">This return code signals the filter graph not to wait for data from your filter before it completes the pause transition.</span></span> <span data-ttu-id="79a42-142">In caso contrario, il metodo **pause** si bloccherà a tempo indefinito.</span><span class="sxs-lookup"><span data-stu-id="79a42-142">Otherwise, the **Pause** method will block indefinitely.</span></span> <span data-ttu-id="79a42-143">Per un esempio di codice, vedere [**CBaseFilter:: GetState**](cbasefilter-getstate.md).</span><span class="sxs-lookup"><span data-stu-id="79a42-143">For example code, see [**CBaseFilter::GetState**](cbasefilter-getstate.md).</span></span>

<span data-ttu-id="79a42-144">Di seguito sono riportati alcuni esempi di quando un filtro potrebbe dover restituire il CUE del cant di VFW \_ \_ \_ :</span><span class="sxs-lookup"><span data-stu-id="79a42-144">Here are some examples of when a filter might need to return VFW\_S\_CANT\_CUE:</span></span>

-   <span data-ttu-id="79a42-145">Le origini live, ad esempio i filtri di acquisizione, non devono inviare dati mentre sono sospesi.</span><span class="sxs-lookup"><span data-stu-id="79a42-145">Live sources, such as capture filters, should not send data while paused.</span></span> <span data-ttu-id="79a42-146">Vedere [produzione di dati in un filtro di acquisizione](producing-data-in-a-capture-filter.md).</span><span class="sxs-lookup"><span data-stu-id="79a42-146">See [Producing Data in a Capture Filter](producing-data-in-a-capture-filter.md).</span></span>
-   <span data-ttu-id="79a42-147">Un filtro Splitter può inviare o meno dati in pausa, a seconda dell'implementazione.</span><span class="sxs-lookup"><span data-stu-id="79a42-147">A splitter filter might or might not send data while paused, depending on the implementation.</span></span> <span data-ttu-id="79a42-148">Se il filtro usa thread distinti per accodare i dati in ogni pin di output, può inviare i dati mentre sono sospesi.</span><span class="sxs-lookup"><span data-stu-id="79a42-148">If the filter uses separate threads to queue data on each output pin, then it can send data while paused.</span></span> <span data-ttu-id="79a42-149">Tuttavia, se il filtro usa un solo thread per ogni pin di output, il primo PIN potrebbe bloccare il thread quando chiama **Receive**, in modo da impedire agli altri pin di inviare dati.</span><span class="sxs-lookup"><span data-stu-id="79a42-149">But if the filter uses a single thread for every output pin, the first pin might block the thread when it calls **Receive**, which will prevent the other pins from sending data.</span></span> <span data-ttu-id="79a42-150">In tal caso, è necessario restituire il \_ cue di VFW S \_ cant \_ .</span><span class="sxs-lookup"><span data-stu-id="79a42-150">In that case, you should return VFW\_S\_CANT\_CUE.</span></span>
-   <span data-ttu-id="79a42-151">Un filtro può recapitare i dati sporadicamente.</span><span class="sxs-lookup"><span data-stu-id="79a42-151">A filter might deliver data sporadically.</span></span> <span data-ttu-id="79a42-152">Ad esempio, potrebbe analizzare un flusso di dati personalizzato e filtrare alcuni pacchetti e distribuirne altri.</span><span class="sxs-lookup"><span data-stu-id="79a42-152">For example, it might parse a custom data stream and filter out some packets while delivering others.</span></span> <span data-ttu-id="79a42-153">In tal caso, è possibile che al filtro non venga garantito il recapito dei dati mentre sono sospesi.</span><span class="sxs-lookup"><span data-stu-id="79a42-153">In that case, the filter may not be guaranteed to deliver data while paused.</span></span>

<span data-ttu-id="79a42-154">Un filtro di origine (usando il modello push) o un filtro del parser (usando il modello push/pull) crea uno o più thread di streaming, che forniscono i campioni il più rapidamente possibile.</span><span class="sxs-lookup"><span data-stu-id="79a42-154">A source filter (using the push model) or a parser filter (using the push/pull model) creates one or more streaming threads, which deliver samples as quickly as possible.</span></span> <span data-ttu-id="79a42-155">I filtri downstream, ad esempio i decodificatori e le trasformazioni, in genere inviano i dati solo quando viene chiamato **Receive** sui rispettivi pin di input.</span><span class="sxs-lookup"><span data-stu-id="79a42-155">Downstream filters, such as decoders and transforms, typically send data only when **Receive** is called on their input pins.</span></span>

## <a name="related-topics"></a><span data-ttu-id="79a42-156">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="79a42-156">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="79a42-157">Ricezione e distribuzione di esempi</span><span class="sxs-lookup"><span data-stu-id="79a42-157">Receiving and Delivering Samples</span></span>](receiving-and-delivering-samples.md)
</dt> </dl>

 

 



