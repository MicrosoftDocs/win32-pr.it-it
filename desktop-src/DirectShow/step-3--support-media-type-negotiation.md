---
description: Implementare il supporto per la negoziazione del tipo di supporto come parte della scrittura di un filtro di trasformazione. Il tipo di supporto descrive il formato dei dati.
ms.assetid: b2b5dafc-d38d-4ec3-a390-55229495b4f9
title: Passaggio 3. Supporto della negoziazione del tipo di supporto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3a23784e70330f751325fc5f780463d5a3904d20
ms.sourcegitcommit: 5d4e99f4c8f42f5f543e52cb9beb9fb13ec56c5f
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/19/2021
ms.locfileid: "112410044"
---
# <a name="step-3-support-media-type-negotiation"></a><span data-ttu-id="12f7c-105">Passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="12f7c-105">Step 3.</span></span> <span data-ttu-id="12f7c-106">Supporto della negoziazione del tipo di supporto</span><span class="sxs-lookup"><span data-stu-id="12f7c-106">Support Media Type Negotiation</span></span>

<span data-ttu-id="12f7c-107">Questo è il passaggio 3 dell'esercitazione [Scrittura di filtri di trasformazione](writing-transform-filters.md).</span><span class="sxs-lookup"><span data-stu-id="12f7c-107">This is step 3 of the tutorial [Writing Transform Filters](writing-transform-filters.md).</span></span>

<span data-ttu-id="12f7c-108">Quando si connettono due pin, devono accettare un tipo di supporto per la connessione.</span><span class="sxs-lookup"><span data-stu-id="12f7c-108">When two pins connect, they must agree on a media type for the connection.</span></span> <span data-ttu-id="12f7c-109">Il tipo di supporto descrive il formato dei dati.</span><span class="sxs-lookup"><span data-stu-id="12f7c-109">The media type describes the format of the data.</span></span> <span data-ttu-id="12f7c-110">Senza il tipo di supporto, un filtro potrebbe recapitare un tipo di dati, solo per fare in modo che un altro filtro lo tratti come un altro.</span><span class="sxs-lookup"><span data-stu-id="12f7c-110">Without the media type, a filter might deliver one kind of data, only to have another filter treat it as something else.</span></span>

<span data-ttu-id="12f7c-111">Il meccanismo di base per negoziare i tipi di supporti [**è il metodo IPin::ReceiveConnection.**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection)</span><span class="sxs-lookup"><span data-stu-id="12f7c-111">The basic mechanism for negotiating media types is the [**IPin::ReceiveConnection**](/windows/desktop/api/Strmif/nf-strmif-ipin-receiveconnection) method.</span></span> <span data-ttu-id="12f7c-112">Il pin di output chiama questo metodo sul pin di input con un tipo di supporto proposto.</span><span class="sxs-lookup"><span data-stu-id="12f7c-112">The output pin calls this method on the input pin with a proposed media type.</span></span> <span data-ttu-id="12f7c-113">Il pin di input accetta la connessione o la rifiuta.</span><span class="sxs-lookup"><span data-stu-id="12f7c-113">The input pin accepts the connection or rejects it.</span></span> <span data-ttu-id="12f7c-114">Se rifiuta la connessione, il pin di output può provare un altro tipo di supporto.</span><span class="sxs-lookup"><span data-stu-id="12f7c-114">If it rejects the connection, the output pin can try another media type.</span></span> <span data-ttu-id="12f7c-115">Se non vengono trovati tipi adatti, la connessione non riesce.</span><span class="sxs-lookup"><span data-stu-id="12f7c-115">If no suitable types are found, the connection fails.</span></span> <span data-ttu-id="12f7c-116">Facoltativamente, il pin di input può annunciare un elenco di tipi che preferisce, tramite il [**metodo IPin::EnumMediaTypes.**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes)</span><span class="sxs-lookup"><span data-stu-id="12f7c-116">Optionally, the input pin can advertise a list of types that it prefers, through the [**IPin::EnumMediaTypes**](/windows/desktop/api/Strmif/nf-strmif-ipin-enummediatypes) method.</span></span> <span data-ttu-id="12f7c-117">Il pin di output può usare questo elenco quando propone tipi di supporti, anche se non è necessario.</span><span class="sxs-lookup"><span data-stu-id="12f7c-117">The output pin can use this list when it proposes media types, although it does not have to.</span></span>

<span data-ttu-id="12f7c-118">La **classe CTransformFilter** implementa un framework generale per questo processo, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="12f7c-118">The **CTransformFilter** class implements a general framework for this process, as follows:</span></span>

-   <span data-ttu-id="12f7c-119">Il pin di input non ha tipi di supporti preferiti.</span><span class="sxs-lookup"><span data-stu-id="12f7c-119">The input pin has no preferred media types.</span></span> <span data-ttu-id="12f7c-120">Si basa interamente sul filtro upstream per proporre il tipo di supporto.</span><span class="sxs-lookup"><span data-stu-id="12f7c-120">It relies entirely on the upstream filter to propose the media type.</span></span> <span data-ttu-id="12f7c-121">Per i dati video, ciò ha senso, perché il tipo di supporto include le dimensioni dell'immagine e la frequenza dei fotogrammi.</span><span class="sxs-lookup"><span data-stu-id="12f7c-121">For video data, this makes sense, because the media type includes the image size and the frame rate.</span></span> <span data-ttu-id="12f7c-122">In genere, tali informazioni devono essere fornite da un filtro di origine upstream o da un filtro del parser.</span><span class="sxs-lookup"><span data-stu-id="12f7c-122">Typically, that information must be supplied by an upstream source filter or parser filter.</span></span> <span data-ttu-id="12f7c-123">Nel caso dei dati audio, il set di formati possibili è più piccolo, quindi può essere pratico per il pin di input offrire alcuni tipi preferiti.</span><span class="sxs-lookup"><span data-stu-id="12f7c-123">In the case of audio data, the set of possible formats is smaller, so it may be practical for the input pin to offer some preferred types.</span></span> <span data-ttu-id="12f7c-124">In tal caso, eseguire l'override [**di CBasePin::GetMediaType**](cbasepin-getmediatype.md) sul pin di input.</span><span class="sxs-lookup"><span data-stu-id="12f7c-124">In that case, override [**CBasePin::GetMediaType**](cbasepin-getmediatype.md) on the input pin.</span></span>
-   <span data-ttu-id="12f7c-125">Quando il filtro upstream propone un tipo di supporto, il pin di input chiama il metodo [**CTransformFilter::CheckInputType,**](ctransformfilter-checkinputtype.md) che accetta o rifiuta il tipo.</span><span class="sxs-lookup"><span data-stu-id="12f7c-125">When the upstream filter proposes a media type, the input pin calls the [**CTransformFilter::CheckInputType**](ctransformfilter-checkinputtype.md) method, which accepts or rejects the type.</span></span>
-   <span data-ttu-id="12f7c-126">Il pin di output non si connetterà a meno che il pin di input non sia connesso per primo.</span><span class="sxs-lookup"><span data-stu-id="12f7c-126">The output pin will not connect unless the input pin is connected first.</span></span> <span data-ttu-id="12f7c-127">Questo comportamento è tipico per i filtri di trasformazione.</span><span class="sxs-lookup"><span data-stu-id="12f7c-127">This behavior is typical for transform filters.</span></span> <span data-ttu-id="12f7c-128">Nella maggior parte dei casi, il filtro deve determinare il tipo di input prima di poter impostare il tipo di output.</span><span class="sxs-lookup"><span data-stu-id="12f7c-128">In most cases, the filter must determine the input type before it can set the output type.</span></span>
-   <span data-ttu-id="12f7c-129">Quando il pin di output si connette, ha un elenco di tipi di supporti che propone al filtro downstream.</span><span class="sxs-lookup"><span data-stu-id="12f7c-129">When the output pin does connect, it has a list of media types that it proposes to the downstream filter.</span></span> <span data-ttu-id="12f7c-130">Chiama il [**metodo CTransformFilter::GetMediaType**](ctransformfilter-getmediatype.md) per generare questo elenco.</span><span class="sxs-lookup"><span data-stu-id="12f7c-130">It calls the [**CTransformFilter::GetMediaType**](ctransformfilter-getmediatype.md) method to generate this list.</span></span> <span data-ttu-id="12f7c-131">Il pin di output proverà anche tutti i tipi di supporti proposti dal filtro downstream.</span><span class="sxs-lookup"><span data-stu-id="12f7c-131">The output pin will also try any media types that the downstream filter proposes.</span></span>
-   <span data-ttu-id="12f7c-132">Per verificare se un determinato tipo di output è compatibile con il tipo di input, il pin di output chiama il metodo [**CTransformFilter::CheckTransform.**](ctransformfilter-checktransform.md)</span><span class="sxs-lookup"><span data-stu-id="12f7c-132">To check whether a particular output type is compatible with the input type, the output pin calls the [**CTransformFilter::CheckTransform**](ctransformfilter-checktransform.md) method.</span></span>

<span data-ttu-id="12f7c-133">I tre **metodi CTransformFilter** elencati in precedenza sono metodi virtuali puri, pertanto la classe derivata deve implementarli.</span><span class="sxs-lookup"><span data-stu-id="12f7c-133">The three **CTransformFilter** methods listed previously are pure virtual methods, so your derived class must implement them.</span></span> <span data-ttu-id="12f7c-134">Nessuno di questi metodi appartiene a un'interfaccia COM. fanno semplicemente parte dell'implementazione fornita dalle classi di base.</span><span class="sxs-lookup"><span data-stu-id="12f7c-134">None of these methods belongs to a COM interface; they are simply part of the implementation provided by the base classes.</span></span>

<span data-ttu-id="12f7c-135">Le sezioni seguenti descrivono ogni metodo in modo più dettagliato:</span><span class="sxs-lookup"><span data-stu-id="12f7c-135">The following sections describe each method in more detail:</span></span>

-   [<span data-ttu-id="12f7c-136">Passaggio 3A. Implementare il metodo CheckInputType</span><span class="sxs-lookup"><span data-stu-id="12f7c-136">Step 3A. Implement the CheckInputType Method</span></span>](step-3a--implement-the-checkinputtype-method.md)
-   [<span data-ttu-id="12f7c-137">Passaggio 3B. Implementare il metodo GetMediaType</span><span class="sxs-lookup"><span data-stu-id="12f7c-137">Step 3B. Implement the GetMediaType Method</span></span>](step-3b--implement-the-getmediatype-method.md)
-   [<span data-ttu-id="12f7c-138">Passaggio 3C. Implementare il metodo CheckTransform</span><span class="sxs-lookup"><span data-stu-id="12f7c-138">Step 3C. Implement the CheckTransform Method</span></span>](step-3c--implement-the-checktransform-method.md)

## <a name="related-topics"></a><span data-ttu-id="12f7c-139">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="12f7c-139">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="12f7c-140">Come si connettono i filtri</span><span class="sxs-lookup"><span data-stu-id="12f7c-140">How Filters Connect</span></span>](how-filters-connect.md)
</dt> <dt>

[<span data-ttu-id="12f7c-141">Scrittura di filtri DirectShow</span><span class="sxs-lookup"><span data-stu-id="12f7c-141">Writing DirectShow Filters</span></span>](writing-directshow-filters.md)
</dt> </dl>

 

 



