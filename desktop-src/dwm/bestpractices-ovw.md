---
title: Considerazioni sulle prestazioni e procedure consigliate
description: In questo argomento viene presentata una serie di procedure consigliate per l'utilizzo delle API di Gestione finestre desktop (DWM).
ms.assetid: 5b1f6ff8-1d3f-4a70-8efd-90f8802e8532
keywords:
- Gestione finestre desktop (DWM), procedure consigliate
- DWM (Gestione finestre desktop), procedure consigliate
- Gestione finestre desktop (DWM), procedure per le applicazioni
- DWM (Gestione finestre desktop), procedure per le applicazioni
- Gestione finestre desktop (DWM), procedure di disegno
- DWM (Gestione finestre desktop), procedure di disegno
- Gestione finestre desktop (DWM), effetto sfocatura dietro
- DWM (Gestione finestre desktop), effetto sfocatura dietro
- procedure per le applicazioni
- procedure di disegno
- effetto sfocatura dietro
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ec76a4920a91f9502940e866d58641a2550d9354
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "106300258"
---
# <a name="performance-considerations-and-best-practices"></a><span data-ttu-id="5c175-114">Considerazioni sulle prestazioni e procedure consigliate</span><span class="sxs-lookup"><span data-stu-id="5c175-114">Performance Considerations and Best Practices</span></span>

<span data-ttu-id="5c175-115">In questo argomento viene presentata una serie di procedure consigliate per l'utilizzo delle API di Gestione finestre desktop (DWM).</span><span class="sxs-lookup"><span data-stu-id="5c175-115">This topic presents a set of best practices for using the Desktop Window Manager (DWM) APIs.</span></span>

<span data-ttu-id="5c175-116">In questo argomento sono incluse le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="5c175-116">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="5c175-117">Procedure per le applicazioni per DWM</span><span class="sxs-lookup"><span data-stu-id="5c175-117">Application Practices for DWM</span></span>](#application-practices-for-dwm)
-   [<span data-ttu-id="5c175-118">Procedure di disegno per DWM</span><span class="sxs-lookup"><span data-stu-id="5c175-118">Drawing Practices for DWM</span></span>](#drawing-practices-for-dwm)
-   [<span data-ttu-id="5c175-119">DWM Blur-Behind area client</span><span class="sxs-lookup"><span data-stu-id="5c175-119">DWM Blur-Behind Client Region</span></span>](#dwm-blur-behind-client-region)

## <a name="application-practices-for-dwm"></a><span data-ttu-id="5c175-120">Procedure per le applicazioni per DWM</span><span class="sxs-lookup"><span data-stu-id="5c175-120">Application Practices for DWM</span></span>

<span data-ttu-id="5c175-121">Se l'applicazione gestisce il ridimensionamento DPI (punti per pollice), è possibile dichiarare un'applicazione come compatibile con dpi ed evitare la scalabilità automatica impostando il flag in grado di riconoscere DPI nel manifesto del programma o chiamando la funzione [**SetProcessDPIAware**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) durante l'inizializzazione del programma.</span><span class="sxs-lookup"><span data-stu-id="5c175-121">If your application handles dots per inch (dpi) scaling, you can declare an application as dpi-aware and prevent automatic scaling by setting the dpi-aware flag in the program's manifest or by calling the [**SetProcessDPIAware**](/windows/desktop/api/winuser/nf-winuser-setprocessdpiaware) function during program initialization.</span></span>

<span data-ttu-id="5c175-122">Con la composizione DWM attivata, le applicazioni nascoste non ricevono più messaggi di [**\_ disegno WM**](/windows/desktop/gdi/wm-paint) e non viene richiesto di eseguire nuovamente il rendering.</span><span class="sxs-lookup"><span data-stu-id="5c175-122">With DWM composition turned on, obscured applications no longer receive [**WM\_PAINT**](/windows/desktop/gdi/wm-paint) messages and are not asked to re-render.</span></span> <span data-ttu-id="5c175-123">Il contenuto di ogni finestra è già disponibile per comporre l'immagine dello schermo.</span><span class="sxs-lookup"><span data-stu-id="5c175-123">Each window's content is already available to compose the screen image.</span></span>

<span data-ttu-id="5c175-124">Le finestre di primo livello [**WS- \_ \_ Transparent**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) devono essere combinate con uno stile **WS \_ ex a \_ livelli** ai fini dell'hit test.</span><span class="sxs-lookup"><span data-stu-id="5c175-124">Top-level [**WS\_EX\_TRANSPARENT**](/windows/desktop/api/winuser/nf-winuser-createwindowexa) windows should be combined with a **WS\_EX\_LAYERED** style for the purposes of hit testing.</span></span> <span data-ttu-id="5c175-125">**WS \_ Il \_ fatto che, a differenza di quanto** avviene per le finestre figlio in una gerarchia di finestre appartenenti allo stesso thread, non è progettato per le finestre di primo livello.</span><span class="sxs-lookup"><span data-stu-id="5c175-125">**WS\_EX\_TRANSPARENT** in the classic sense, without redirection, is useful for child windows in a hierarchy of windows that belong to the same thread, but is not intended for top-level windows.</span></span>

<span data-ttu-id="5c175-126">Usare aree o livelli per creare finestre con forma o con Blend.</span><span class="sxs-lookup"><span data-stu-id="5c175-126">Use regions or layering to create shaped or blended windows.</span></span> <span data-ttu-id="5c175-127">Si noti che in Windows Vista e nelle versioni successive di Windows, il disegno personalizzato solo parte di una finestra di primo livello non fornirà il contenuto non aggiornato desiderato nelle aree non disegnate.</span><span class="sxs-lookup"><span data-stu-id="5c175-127">Note that in Windows Vista and later versions of Windows, custom drawing only part of a top-level window will not provide the desired stale content in undrawn regions.</span></span>

<span data-ttu-id="5c175-128">Le API come [**GetDCOrgEx**](/windows/desktop/api/wingdi/nf-wingdi-getdcorgex) possono essere usate per determinare determinati valori effettivi.</span><span class="sxs-lookup"><span data-stu-id="5c175-128">APIs such as [**GetDCOrgEx**](/windows/desktop/api/wingdi/nf-wingdi-getdcorgex) can be used to determine certain actual values.</span></span> <span data-ttu-id="5c175-129">Se si dispone di un contesto di dispositivo (DC) per una finestra reindirizzata, l'origine restituita da **GetDCOrgEx** non corrisponderà all'origine della finestra sullo schermo.</span><span class="sxs-lookup"><span data-stu-id="5c175-129">If you have a device context (DC) for a redirected window, the origin returned by **GetDCOrgEx** will not match the origin of your window on the screen.</span></span> <span data-ttu-id="5c175-130">L'origine sarà invece l'origine della superficie del buffer di sfondo per la finestra: (0, 0).</span><span class="sxs-lookup"><span data-stu-id="5c175-130">The origin will instead be the origin of the back-buffer surface for your window: (0, 0).</span></span>

<span data-ttu-id="5c175-131">Quando l'operazione ha esito negativo, disabilitare il rendering della finestra chiamando la funzione [**DwmSetWindowAttribute**](/windows/desktop/api/Dwmapi/nf-dwmapi-dwmsetwindowattribute) .</span><span class="sxs-lookup"><span data-stu-id="5c175-131">When all else fails, disable window rendering by calling the [**DwmSetWindowAttribute**](/windows/desktop/api/Dwmapi/nf-dwmapi-dwmsetwindowattribute) function.</span></span>

## <a name="drawing-practices-for-dwm"></a><span data-ttu-id="5c175-132">Procedure di disegno per DWM</span><span class="sxs-lookup"><span data-stu-id="5c175-132">Drawing Practices for DWM</span></span>

<span data-ttu-id="5c175-133">Evitare di disegnare direttamente nella superficie di visualizzazione principale.</span><span class="sxs-lookup"><span data-stu-id="5c175-133">Avoid drawing directly to the primary display surface.</span></span> <span data-ttu-id="5c175-134">In questo modo, la soluzione DWM verrà forzata per disabilitare la composizione fino a quando l'applicazione non rilascia la superficie del dispositivo primario.</span><span class="sxs-lookup"><span data-stu-id="5c175-134">Doing so will force the DWM to disable composition until your application releases the primary device surface.</span></span>

<span data-ttu-id="5c175-135">Valutare se l'applicazione deve fornire il proprio doppio buffer.</span><span class="sxs-lookup"><span data-stu-id="5c175-135">Evaluate whether your application must provide its own double buffering.</span></span> <span data-ttu-id="5c175-136">DWM raddoppia efficacemente il contenuto e visualizza la finestra in un singolo frame.</span><span class="sxs-lookup"><span data-stu-id="5c175-136">The DWM effectively double buffers content and presents the window in a single frame.</span></span>

<span data-ttu-id="5c175-137">Evitare di leggere o scrivere in un controller di dominio di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="5c175-137">Avoid reading from or writing to a display DC.</span></span> <span data-ttu-id="5c175-138">Sebbene supportato da DWM, questo non è consigliato a causa di una riduzione delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="5c175-138">Although supported by DWM, we do not recommend it because of decreased performance.</span></span>

<span data-ttu-id="5c175-139">Evitare di disegnare nell'area non client.</span><span class="sxs-lookup"><span data-stu-id="5c175-139">Avoid drawing in the non-client area.</span></span> <span data-ttu-id="5c175-140">Sebbene sia possibile accedere a questa area dall'applicazione e che il disegno sia supportato dall'API Microsoft Win32, questa operazione può causare la perdita di tutti i bordi vetro della finestra.</span><span class="sxs-lookup"><span data-stu-id="5c175-140">Although this area can be accessed by the application, and drawing there is supported by the Microsoft Win32 API, doing this can cause the window to lose any glass border it has.</span></span>

<span data-ttu-id="5c175-141">Evitare di combinare Windows Graphics Device Interface (GDI) e Microsoft DirectX a meno che non si sovrappongano.</span><span class="sxs-lookup"><span data-stu-id="5c175-141">Avoid mixing Windows Graphics Device Interface (GDI) and Microsoft DirectX unless they do not overlap.</span></span> <span data-ttu-id="5c175-142">Se la combinazione è necessaria, è possibile creare il contenuto GDI in una superficie software DirectX e combinarli prima della composizione sullo schermo, altrimenti è possibile crearli in finestre separate.</span><span class="sxs-lookup"><span data-stu-id="5c175-142">If mixing is necessary, either draw the GDI content into a DirectX software surface and combine them before composing to the screen, or else draw them in separate windows.</span></span>

<span data-ttu-id="5c175-143">Utilizzare la funzione [**BitBlt**](/windows/desktop/api/wingdi/nf-wingdi-bitblt) o [**StretchBlt**](/windows/desktop/api/wingdi/nf-wingdi-stretchblt) anziché GDI+ per presentare il disegno per il rendering.</span><span class="sxs-lookup"><span data-stu-id="5c175-143">Use [**BitBlt**](/windows/desktop/api/wingdi/nf-wingdi-bitblt) or [**StretchBlt**](/windows/desktop/api/wingdi/nf-wingdi-stretchblt) function instead of Windows GDI+ to present your drawing for rendering.</span></span> <span data-ttu-id="5c175-144">GDI+ esegue il rendering di una riga di analisi alla volta con il rendering software.</span><span class="sxs-lookup"><span data-stu-id="5c175-144">GDI+ renders one scan line at a time with software rendering.</span></span> <span data-ttu-id="5c175-145">Questo può causare lo sfarfallio delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="5c175-145">This can cause flickering in your applications.</span></span>

## <a name="dwm-blur-behind-client-region"></a><span data-ttu-id="5c175-146">DWM Blur-Behind area client</span><span class="sxs-lookup"><span data-stu-id="5c175-146">DWM Blur-Behind Client Region</span></span>

<span data-ttu-id="5c175-147">Il rendering dell'effetto sfocatura è un'operazione a elevato utilizzo di risorse per la CPU e la GPU (Graphics Processing Unit).</span><span class="sxs-lookup"><span data-stu-id="5c175-147">Rendering the blur-behind effect is a resource-intensive operation for both the CPU and the graphics processing unit (GPU).</span></span> <span data-ttu-id="5c175-148">Gli sviluppatori di applicazioni sono invitati a prendere in considerazione le implicazioni dell'uso della sfocatura dell'area client in modo che non utilizzi risorse eccessive.</span><span class="sxs-lookup"><span data-stu-id="5c175-148">Application developers are urged to consider the implications of using client-area blur so that it does not consume excessive resources.</span></span> <span data-ttu-id="5c175-149">È necessario prestare particolare attenzione nei casi seguenti:</span><span class="sxs-lookup"><span data-stu-id="5c175-149">You should use particular caution in the following cases:</span></span>

-   <span data-ttu-id="5c175-150">Quando si prevede che le dimensioni della sfocatura dell'area client siano significative, anche se non si verificheranno aggiornamenti nell'area sfocata.</span><span class="sxs-lookup"><span data-stu-id="5c175-150">When you expect the size of the client-area blur to be significant, even if no updates will occur in the blurred area itself.</span></span> <span data-ttu-id="5c175-151">È necessario eseguire il rendering della sfocatura nel caso in cui si verifichino aggiornamenti nell'area sfocata della finestra, che comporta costi CPU e GPU.</span><span class="sxs-lookup"><span data-stu-id="5c175-151">The blur has to be rendered in case any updates occur under the blurred area of the window, which incurs CPU and GPU costs.</span></span> <span data-ttu-id="5c175-152">Inoltre, le operazioni della finestra sulla finestra (spostamento/ridimensionamento/transizioni) comporteranno un numero maggiore di costi.</span><span class="sxs-lookup"><span data-stu-id="5c175-152">In addition, window operations on the window (move/resize/transitions) will incur more costs.</span></span>
-   <span data-ttu-id="5c175-153">Quando si prevede aggiornamenti significativi nell'area client sfocata.</span><span class="sxs-lookup"><span data-stu-id="5c175-153">When you expect significant updates in the blurred client area.</span></span> <span data-ttu-id="5c175-154">Questa operazione richiederà un ridisegno della sfocatura per ogni aggiornamento e utilizzerà risorse eccessive.</span><span class="sxs-lookup"><span data-stu-id="5c175-154">This will require a repaint of the blur on every update and consume excessive resources.</span></span>
-   <span data-ttu-id="5c175-155">Se si prevede che la sfocatura copra un'area significativa ed è previsto anche l'aggiornamento a tale area, si consiglia vivamente di non sfocare l'area client.</span><span class="sxs-lookup"><span data-stu-id="5c175-155">If the blur is expected to cover a significant area, and updates to that area are also expected, we strongly recommended that you do not blur the client area.</span></span>

 

 