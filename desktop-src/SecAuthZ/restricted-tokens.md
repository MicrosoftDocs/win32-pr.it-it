---
description: Un token con restrizioni è un token di accesso primario o di rappresentazione modificato dalla funzione CreateRestrictedToken.
ms.assetid: 06580ab9-ff58-4aa9-bf88-9536a2e1981d
title: Token con restrizioni
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fee8e6c89915e3edd0a9206f84a0d3d5697a3cb9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104129911"
---
# <a name="restricted-tokens"></a><span data-ttu-id="6802e-103">Token con restrizioni</span><span class="sxs-lookup"><span data-stu-id="6802e-103">Restricted Tokens</span></span>

<span data-ttu-id="6802e-104">Un token con restrizioni è un [*token di accesso*](/windows/desktop/SecGloss/a-gly) [*primario*](/windows/desktop/SecGloss/p-gly) o di rappresentazione modificato dalla funzione [**CreateRestrictedToken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken) .</span><span class="sxs-lookup"><span data-stu-id="6802e-104">A restricted token is a [*primary*](/windows/desktop/SecGloss/p-gly) or impersonation [*access token*](/windows/desktop/SecGloss/a-gly) that has been modified by the [**CreateRestrictedToken**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-createrestrictedtoken) function.</span></span> <span data-ttu-id="6802e-105">Un [*processo*](/windows/desktop/SecGloss/p-gly) o un thread di rappresentazione eseguito nel [*contesto di sicurezza*](/windows/desktop/SecGloss/s-gly) di un token con restrizioni è limitato alla possibilità di accedere agli oggetti a protezione diretta o di eseguire operazioni con privilegi.</span><span class="sxs-lookup"><span data-stu-id="6802e-105">A [*process*](/windows/desktop/SecGloss/p-gly) or impersonating thread running in the [*security context*](/windows/desktop/SecGloss/s-gly) of a restricted token is restricted in its ability to access securable objects or perform privileged operations.</span></span> <span data-ttu-id="6802e-106">La funzione **CreateRestrictedToken** può limitare un token nei modi seguenti:</span><span class="sxs-lookup"><span data-stu-id="6802e-106">The **CreateRestrictedToken** function can restrict a token in the following ways:</span></span>

-   <span data-ttu-id="6802e-107">Rimuovere i [privilegi](privileges.md) dal token.</span><span class="sxs-lookup"><span data-stu-id="6802e-107">Remove [privileges](privileges.md) from the token.</span></span>
-   <span data-ttu-id="6802e-108">Applicare l'attributo Deny-only ai SID nel token in modo che non possano essere utilizzati per accedere agli oggetti protetti.</span><span class="sxs-lookup"><span data-stu-id="6802e-108">Apply the deny-only attribute to SIDs in the token so that they cannot be used to access secured objects.</span></span> <span data-ttu-id="6802e-109">Per altre informazioni sull'attributo Deny-only, vedere [attributi SID in un token di accesso](sid-attributes-in-an-access-token.md).</span><span class="sxs-lookup"><span data-stu-id="6802e-109">For more information about the deny-only attribute, see [SID Attributes in an Access Token](sid-attributes-in-an-access-token.md).</span></span>
-   <span data-ttu-id="6802e-110">Specificare un elenco di SID di restrizione, che possono limitare l'accesso agli oggetti a protezione diretta.</span><span class="sxs-lookup"><span data-stu-id="6802e-110">Specify a list of restricting SIDs, which can limit access to securable objects.</span></span>

<span data-ttu-id="6802e-111">Il sistema utilizza l'elenco dei SID di restrizione quando controlla l'accesso del token a un oggetto a protezione diretta.</span><span class="sxs-lookup"><span data-stu-id="6802e-111">The system uses the list of restricting SIDs when it checks the token's access to a securable object.</span></span> <span data-ttu-id="6802e-112">Quando un processo o un thread con restrizioni tenta di accedere a un oggetto a protezione diretta, il sistema esegue due controlli di accesso: uno usando i SID abilitati del token e un altro usando l'elenco dei SID di restrizione.</span><span class="sxs-lookup"><span data-stu-id="6802e-112">When a restricted process or thread tries to access a securable object, the system performs two access checks: one using the token's enabled SIDs, and another using the list of restricting SIDs.</span></span> <span data-ttu-id="6802e-113">L'accesso viene concesso solo se entrambi i controlli di accesso consentono i diritti di accesso richiesti.</span><span class="sxs-lookup"><span data-stu-id="6802e-113">Access is granted only if both access checks allow the requested access rights.</span></span> <span data-ttu-id="6802e-114">Per ulteriori informazioni sui controlli di accesso, vedere [come gli elenchi DACL controllano l'accesso a un oggetto](how-dacls-control-access-to-an-object.md).</span><span class="sxs-lookup"><span data-stu-id="6802e-114">For more information about access checks, see [How DACLs Control Access to an Object](how-dacls-control-access-to-an-object.md).</span></span>

<span data-ttu-id="6802e-115">È possibile usare un [*token primario*](/windows/desktop/SecGloss/p-gly) con restrizioni in una chiamata alla funzione [**CreateProcessAsUser ha**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) .</span><span class="sxs-lookup"><span data-stu-id="6802e-115">You can use a restricted [*primary token*](/windows/desktop/SecGloss/p-gly) in a call to the [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function.</span></span> <span data-ttu-id="6802e-116">In genere, il processo che chiama **CreateProcessAsUser ha** deve avere il \_ privilegio se ASSIGNPRIMARYTOKEN \_ Name, che in genere viene mantenuto solo dal codice di sistema o dai servizi in esecuzione nell'account LocalSystem.</span><span class="sxs-lookup"><span data-stu-id="6802e-116">Typically, the process that calls **CreateProcessAsUser** must have the SE\_ASSIGNPRIMARYTOKEN\_NAME privilege, which is usually held only by system code or by services running in the LocalSystem account.</span></span> <span data-ttu-id="6802e-117">Tuttavia, se la chiamata **CreateProcessAsUser ha** specifica una versione limitata del token primario del chiamante, questo privilegio non è obbligatorio.</span><span class="sxs-lookup"><span data-stu-id="6802e-117">However, if the **CreateProcessAsUser** call specifies a restricted version of the caller's primary token, this privilege is not required.</span></span> <span data-ttu-id="6802e-118">Questo consente alle applicazioni ordinarie di creare processi con restrizioni.</span><span class="sxs-lookup"><span data-stu-id="6802e-118">This enables ordinary applications to create restricted processes.</span></span>

<span data-ttu-id="6802e-119">È anche possibile usare un [*token di rappresentazione*](/windows/desktop/SecGloss/i-gly) o primario con restrizioni nella funzione [**ImpersonateLoggedOnUser**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) .</span><span class="sxs-lookup"><span data-stu-id="6802e-119">You can also use a restricted primary or [*impersonation token*](/windows/desktop/SecGloss/i-gly) in the [**ImpersonateLoggedOnUser**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-impersonateloggedonuser) function.</span></span>

<span data-ttu-id="6802e-120">Per determinare se un token ha un elenco di SID di restrizione, chiamare la funzione [**IsTokenRestricted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-istokenrestricted) .</span><span class="sxs-lookup"><span data-stu-id="6802e-120">To determine whether a token has a list of restricting SIDs, call the [**IsTokenRestricted**](/windows/win32/api/securitybaseapi/nf-securitybaseapi-istokenrestricted) function.</span></span>

> [!Note]  
> <span data-ttu-id="6802e-121">Le applicazioni che usano token con restrizioni devono eseguire l'applicazione con restrizioni su desktop diversi dal desktop predefinito.</span><span class="sxs-lookup"><span data-stu-id="6802e-121">Applications that use restricted tokens should run the restricted application on desktops other than the default desktop.</span></span> <span data-ttu-id="6802e-122">Questa operazione è necessaria per evitare un attacco da parte di un'applicazione con restrizioni, tramite **SendMessage** o **PostMessage**, alle applicazioni senza restrizioni sul desktop predefinito.</span><span class="sxs-lookup"><span data-stu-id="6802e-122">This is necessary to prevent an attack by a restricted application, using **SendMessage** or **PostMessage**, to unrestricted applications on the default desktop.</span></span> <span data-ttu-id="6802e-123">Se necessario, spostarsi tra i desktop a scopo di applicazione.</span><span class="sxs-lookup"><span data-stu-id="6802e-123">If necessary, switch between desktops for your application purposes.</span></span>

 

 

 
