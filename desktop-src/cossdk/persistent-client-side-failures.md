---
description: Errori persistenti Client-Side
ms.assetid: f991db71-8319-414d-8a25-2d02bc7c8b51
title: Errori persistenti Client-Side
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25d303e712257d62e4ae42497cb4463e782cfbb8
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104401452"
---
# <a name="persistent-client-side-failures"></a><span data-ttu-id="d3a33-103">Errori persistenti Client-Side</span><span class="sxs-lookup"><span data-stu-id="d3a33-103">Persistent Client-Side Failures</span></span>

<span data-ttu-id="d3a33-104">In alcuni casi, [Accodamento messaggi](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) può spostare un messaggio nella coda di destinazione.</span><span class="sxs-lookup"><span data-stu-id="d3a33-104">In some cases, [Message Queuing](/previous-versions/windows/desktop/legacy/ms711472(v=vs.85)) can move a message to the destination queue.</span></span> <span data-ttu-id="d3a33-105">Se, ad esempio, i controlli di accesso della coda non consentono lo spostamento del messaggio da client a server, il messaggio danneggiato viene spostato nella coda di messaggi non recapitabili sul lato client.</span><span class="sxs-lookup"><span data-stu-id="d3a33-105">For example, if the queue access controls do not permit the message to be moved from client to server, the offending message is moved to the client-side dead letter queue.</span></span> <span data-ttu-id="d3a33-106">Quando si verifica questa situazione, il servizio COM+ Queued Components consente di associare una classe di eccezione a un componente.</span><span class="sxs-lookup"><span data-stu-id="d3a33-106">When this occurs, the COM+ queued components service allows an exception class to be associated with a component.</span></span> <span data-ttu-id="d3a33-107">Per associare la classe Exception al componente, utilizzare la scheda **Avanzate** della pagina Proprietà componente dello strumento di amministrazione Servizi componenti.</span><span class="sxs-lookup"><span data-stu-id="d3a33-107">To associate the exception class with the component, use the **Advanced** tab in the component properties page of the Component Services administration tool.</span></span> <span data-ttu-id="d3a33-108">È anche possibile associare la classe di eccezione a livello di codice, usando l'attributo Component Catalog P:System.EnterpriseServices.ExceptionClassAttribute.value delle funzioni amministrative COM+.</span><span class="sxs-lookup"><span data-stu-id="d3a33-108">You can also associate the exception class programmatically, by using the ExceptionClass catalog component attribute of the COM+ Administrative functions.</span></span>

<span data-ttu-id="d3a33-109">La classe Exception è definita come ProgID o CLSID di un componente che implementa [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol).</span><span class="sxs-lookup"><span data-stu-id="d3a33-109">The exception class is defined as either the ProgID or the CLSID of a component implementing [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol).</span></span> <span data-ttu-id="d3a33-110">Il servizio componenti in coda dispone di un monitoraggio coda messaggi non recapitabili che esegue l'analisi della coda dei messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="d3a33-110">The queued components service has a dead letter queue monitor that scans the Xact dead letter queue.</span></span> <span data-ttu-id="d3a33-111">Se è presente un messaggio nella coda, il monitoraggio della coda dei messaggi non recapitabili crea un'istanza del gestore di eccezioni associato al componente di destinazione e chiama [**IPlaybackControl:: FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry), a indicare che si è verificato un errore irreversibile sul lato client.</span><span class="sxs-lookup"><span data-stu-id="d3a33-111">If there is a message on the queue, the dead letter queue monitor instantiates the exception handler associated with the target component and calls [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry), indicating that there has been a client-side, unrecoverable error.</span></span>

<span data-ttu-id="d3a33-112">Oltre a [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol), il gestore di eccezioni deve implementare lo stesso set di interfacce del componente server per cui gestisce le eccezioni.</span><span class="sxs-lookup"><span data-stu-id="d3a33-112">In addition to [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol), the exception handler should implement the same set of interfaces as the server component for which it is handling exceptions.</span></span> <span data-ttu-id="d3a33-113">Quando viene chiamato [**IPlaybackControl:: FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) , la fase di esecuzione dei componenti in coda riproduce il messaggio non riuscito nel gestore di eccezioni.</span><span class="sxs-lookup"><span data-stu-id="d3a33-113">When [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) is called, the queued components run-time plays back the failing message to the exception handler.</span></span> <span data-ttu-id="d3a33-114">Ciò consente al gestore di eccezioni di implementare un comportamento alternativo per i messaggi che non possono essere spostati nel server, ad esempio generando una transazione di compensazione.</span><span class="sxs-lookup"><span data-stu-id="d3a33-114">This allows the exception handler to implement an alternative behavior for messages that cannot be moved to the server—for example, by generating a compensating transaction.</span></span>

<span data-ttu-id="d3a33-115">Se il gestore di eccezioni completa tutte le chiamate al metodo riprodotte, il messaggio viene rimosso dalla coda dei messaggi non recapitabili di XACT e viene rimosso.</span><span class="sxs-lookup"><span data-stu-id="d3a33-115">If the exception handler completes all the method calls played back, the message is removed from the Xact dead letter queue and is dismissed.</span></span> <span data-ttu-id="d3a33-116">Se, tuttavia, il gestore di eccezioni interrompe il messaggio restituendo uno stato di errore da una delle chiamate al metodo, il messaggio viene restituito alla coda dei messaggi non recapitabili XACT.</span><span class="sxs-lookup"><span data-stu-id="d3a33-116">If, however, the exception handler aborts the message by returning a failure status from one of the method calls, the message is returned to the Xact dead letter queue.</span></span> <span data-ttu-id="d3a33-117">La sequenza di eventi seguente mostra come vengono gestite le eccezioni sul lato client:</span><span class="sxs-lookup"><span data-stu-id="d3a33-117">The following sequence of events shows how client-side exceptions are handled:</span></span>

1.  <span data-ttu-id="d3a33-118">Accodamento messaggi non è in grado di recapitare un messaggio al server e inserisce il messaggio nella coda dei messaggi non recapitabili XACT.</span><span class="sxs-lookup"><span data-stu-id="d3a33-118">Message Queuing fails to deliver a message to the server and puts the message onto the Xact dead letter queue.</span></span>
2.  <span data-ttu-id="d3a33-119">Il listener della coda dei messaggi non recapitabili (DLQL) rileva un messaggio nella coda dei messaggi non recapitabili di XACT.</span><span class="sxs-lookup"><span data-stu-id="d3a33-119">The dead letter queue listener (DLQL) finds a message on the Xact dead letter queue.</span></span>
3.  <span data-ttu-id="d3a33-120">DLQL Recupera il CLSID del componente di destinazione dal messaggio e verifica la presenza di una classe di eccezione.</span><span class="sxs-lookup"><span data-stu-id="d3a33-120">The DLQL retrieves the target component CLSID from the message and checks for an exception class.</span></span>
4.  <span data-ttu-id="d3a33-121">DLQL crea un'istanza della classe Exception.</span><span class="sxs-lookup"><span data-stu-id="d3a33-121">The DLQL instantiates the exception class.</span></span>
5.  <span data-ttu-id="d3a33-122">DLQL esegue una query per [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) per la classe Exception.</span><span class="sxs-lookup"><span data-stu-id="d3a33-122">The DLQL queries for [**IPlaybackControl**](/windows/desktop/api/ComSvcs/nn-comsvcs-iplaybackcontrol) for the exception class.</span></span>
6.  <span data-ttu-id="d3a33-123">DLQL chiama il metodo [**IPlaybackControl:: FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) nella classe Exception.</span><span class="sxs-lookup"><span data-stu-id="d3a33-123">The DLQL calls the [**IPlaybackControl::FinalClientRetry**](/windows/desktop/api/ComSvcs/nf-comsvcs-iplaybackcontrol-finalclientretry) method in the exception class.</span></span>
7.  <span data-ttu-id="d3a33-124">Il DLQL riproduce tutte le chiamate a proprietà e metodi dal messaggio alla classe di eccezione.</span><span class="sxs-lookup"><span data-stu-id="d3a33-124">The DLQL plays back all property and method calls from the message to the exception class.</span></span>
8.  <span data-ttu-id="d3a33-125">DLQL Elimina il messaggio se il gestore di eccezioni completa correttamente la transazione.</span><span class="sxs-lookup"><span data-stu-id="d3a33-125">The DLQL deletes the message if the exception handler completes the transaction successfully.</span></span> <span data-ttu-id="d3a33-126">Il gestore di eccezioni può eseguire [**IObjectContext:: SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort)e il messaggio rimarrà nella coda dei messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="d3a33-126">The exception handler may issue [**IObjectContext::SetAbort**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontext-setabort), and the message will remain on the dead letter queue.</span></span>

<span data-ttu-id="d3a33-127">Se uno dei passaggi precedenti ha esito negativo, il messaggio viene lasciato nella coda dei messaggi non recapitabili XACT.</span><span class="sxs-lookup"><span data-stu-id="d3a33-127">If any of the preceding steps fail, the message is left on the Xact dead letter queue.</span></span>

<span data-ttu-id="d3a33-128">Quando viene avviato, DLQL legge ogni messaggio nella coda di messaggi non recapitabili transazionale di Accodamento messaggi e crea un'istanza della classe Exception per ogni messaggio di componenti in coda.</span><span class="sxs-lookup"><span data-stu-id="d3a33-128">When started, the DLQL reads each message on the Message Queuing transactional dead letter queue and instantiates the exception class for each queued components message.</span></span> <span data-ttu-id="d3a33-129">Una volta passato attraverso la coda, resta in attesa di nuovi messaggi.</span><span class="sxs-lookup"><span data-stu-id="d3a33-129">After one pass through the queue, it waits for new messages.</span></span> <span data-ttu-id="d3a33-130">Elabora quindi ogni nuovo messaggio della coda dei messaggi non recapitabili in arrivo.</span><span class="sxs-lookup"><span data-stu-id="d3a33-130">It then processes each new dead letter queue message as it arrives.</span></span>

<span data-ttu-id="d3a33-131">Se è necessario intervenire nel processo descritto qui o se è necessario spostare un messaggio non elaborabile dalla coda di riposo finale, usare l'utilità di spostamento messaggi.</span><span class="sxs-lookup"><span data-stu-id="d3a33-131">If you need to intervene in the process described here or if you need to move a poison message out of its final resting queue, use the message mover utility.</span></span> <span data-ttu-id="d3a33-132">Per ulteriori informazioni sull'utilità Message Mover, vedere [gestione degli errori](handling-errors-in-queued-components.md).</span><span class="sxs-lookup"><span data-stu-id="d3a33-132">For more information on the message mover utility, see [Handling Errors](handling-errors-in-queued-components.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="d3a33-133">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="d3a33-133">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d3a33-134">Errori lato client</span><span class="sxs-lookup"><span data-stu-id="d3a33-134">Client-Side Errors</span></span>](client-side-errors.md)
</dt> <dt>

[<span data-ttu-id="d3a33-135">Errori sul lato server</span><span class="sxs-lookup"><span data-stu-id="d3a33-135">Server-Side Errors</span></span>](server-side-errors.md)
</dt> </dl>

 

 



