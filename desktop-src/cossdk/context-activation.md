---
description: In COM+ ogni oggetto COM viene creato con un contesto associato.
ms.assetid: e5602af2-5852-4c34-a792-6742e90b7d41
title: Attivazione del contesto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a652615d6c1288887085c857817e32e3a3b4081c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104127150"
---
# <a name="context-activation"></a><span data-ttu-id="c9849-103">Attivazione del contesto</span><span class="sxs-lookup"><span data-stu-id="c9849-103">Context Activation</span></span>

<span data-ttu-id="c9849-104">In COM+ ogni oggetto COM viene creato con un contesto associato.</span><span class="sxs-lookup"><span data-stu-id="c9849-104">In COM+, every COM object is created with an associated context.</span></span> <span data-ttu-id="c9849-105">Ciò significa che è necessario creare e inizializzare un nuovo contesto oppure utilizzare un contesto esistente appropriato.</span><span class="sxs-lookup"><span data-stu-id="c9849-105">This means that either a new context must be created and initialized or an appropriate existing context is used.</span></span> <span data-ttu-id="c9849-106">Questo processo è noto come *attivazione*.</span><span class="sxs-lookup"><span data-stu-id="c9849-106">This process is known as *activation*.</span></span> <span data-ttu-id="c9849-107">In COM+, un oggetto viene attivato nel proprio contesto o in quello del creatore (un oggetto che ha richiesto l'attivazione dell'oggetto, ad esempio chiamando [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance)).</span><span class="sxs-lookup"><span data-stu-id="c9849-107">In COM+, an object is activated either in its own context or in that of its creator (an object that has requested that the object be activated—for example, by calling [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance)).</span></span>

<span data-ttu-id="c9849-108">In alcune circostanze, ad esempio con il [pool di oggetti](com--object-pooling.md), un oggetto viene attivato senza essere creato da zero.</span><span class="sxs-lookup"><span data-stu-id="c9849-108">In some circumstances, such as with [object pooling](com--object-pooling.md), an object is activated without being created from scratch.</span></span> <span data-ttu-id="c9849-109">In questo caso, un'istanza in esecuzione viene attivata all'interno di un contesto.</span><span class="sxs-lookup"><span data-stu-id="c9849-109">In this case, a running instance is activated within a context.</span></span> <span data-ttu-id="c9849-110">Per tutta la durata, è possibile che venga attivata ripetutamente in contesti diversi.</span><span class="sxs-lookup"><span data-stu-id="c9849-110">Over its lifetime, it may be repeatedly activated in different contexts.</span></span>

<span data-ttu-id="c9849-111">Il meccanismo di base è lo stesso in entrambi i casi, ovvero un oggetto è associato a un contesto e tale contesto viene inizializzato correttamente per rappresentare le esigenze di run-time dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="c9849-111">The basic mechanism is the same in either case—an object is associated with a context and that context is properly initialized to represent the run-time needs of the object.</span></span>

## <a name="flowing-of-context-properties"></a><span data-ttu-id="c9849-112">Propagazione delle proprietà di contesto</span><span class="sxs-lookup"><span data-stu-id="c9849-112">Flowing of Context Properties</span></span>

<span data-ttu-id="c9849-113">Quando un oggetto viene attivato in risposta a una richiesta di creazione da un altro oggetto, COM+ deve intermediare tra di essi per attivare correttamente l'oggetto downstream.</span><span class="sxs-lookup"><span data-stu-id="c9849-113">When an object is being activated in response to a creation request from another object, COM+ needs to mediate between them to properly activate the downstream object.</span></span> <span data-ttu-id="c9849-114">COM+ deve confrontare il contesto del chiamante con la configurazione del componente chiamato, quindi decidere dove attivare il componente downstream e come inizializzare le proprietà di contesto.</span><span class="sxs-lookup"><span data-stu-id="c9849-114">COM+ has to compare the context of the caller with the configuration of the called component and then decide where to activate the downstream component and how to initialize its context properties.</span></span>

<span data-ttu-id="c9849-115">Per individuare la configurazione del componente, COM+ lo cerca nel database di registrazione della classe COM+, ottimizzato per le ricerche in fase di esecuzione estremamente veloci.</span><span class="sxs-lookup"><span data-stu-id="c9849-115">To discover the component's configuration, COM+ looks it up in the COM+ class registration database, which is optimized for extremely fast run-time lookups.</span></span> <span data-ttu-id="c9849-116">Questa operazione è determinata dalla configurazione di un componente durante l'installazione in un'applicazione COM+. La configurazione del componente viene quindi esaminata in base allo stato delle proprietà di contesto del chiamante.</span><span class="sxs-lookup"><span data-stu-id="c9849-116">(This is determined by how you configured a component when installing it into a COM+ application.) The component's configuration is then examined against the state of the caller's context properties.</span></span>

<span data-ttu-id="c9849-117">In alcuni casi, la configurazione è coerente con il contesto del chiamante e il componente può essere attivato nel contesto del chiamante.</span><span class="sxs-lookup"><span data-stu-id="c9849-117">In some cases, the configuration is consistent with the context of the caller and the component can be activated within the caller's context.</span></span> <span data-ttu-id="c9849-118">Questa situazione può verificarsi solo se il contesto del chiamante soddisfa tutti i requisiti della fase di esecuzione del nuovo oggetto.</span><span class="sxs-lookup"><span data-stu-id="c9849-118">This can happen only if the caller's context satisfies all the run-time requirements of the new object.</span></span>

<span data-ttu-id="c9849-119">Quando il componente downstream non può essere attivato all'interno del contesto del chiamante, viene attivato nel relativo contesto in un Apartment appropriato.</span><span class="sxs-lookup"><span data-stu-id="c9849-119">When the downstream component cannot be activated within the caller's context, it is activated in its own context in an appropriate apartment.</span></span> <span data-ttu-id="c9849-120">In tal caso, è possibile che determinate proprietà di contesto vengano propagate dal chiamante al chiamato.</span><span class="sxs-lookup"><span data-stu-id="c9849-120">When this occurs, certain context properties may flow from caller to callee.</span></span> <span data-ttu-id="c9849-121">Se, ad esempio, il chiamante è associato a una transazione e il chiamato supporta le transazioni, il nuovo oggetto ottiene il proprio contesto (per votare la transazione, deve disporre di un proprio flag coerente) ed eredita l'ID di transazione e l'ID attività del chiamante (che si trovano all'interno della stessa transazione e del dominio di sincronizzazione).</span><span class="sxs-lookup"><span data-stu-id="c9849-121">For example, if the caller is associated with a transaction and the callee supports transactions, the new object gets its own context (to vote in the transaction, it needs to have its own consistent flag) and inherits the caller's transaction ID and activity ID (which reside within the same transaction and synchronization domain).</span></span>

## <a name="ignored-context-properties"></a><span data-ttu-id="c9849-122">Proprietà di contesto ignorate</span><span class="sxs-lookup"><span data-stu-id="c9849-122">Ignored Context Properties</span></span>

<span data-ttu-id="c9849-123">A seconda della modalità di configurazione di un componente, alcune proprietà di contesto potrebbero non essere in grado di determinare se è attivata nel contesto del creatore o nel contesto.</span><span class="sxs-lookup"><span data-stu-id="c9849-123">Depending on how a component is configured, some context properties may play no role in determining whether it is activated in the creator's context or its own context.</span></span> <span data-ttu-id="c9849-124">Ad esempio, le transazioni disabilitate e sincronizzate le impostazioni disabilitate, che indicano la presenza di una transazione o di un dominio di sincronizzazione, non svolgeranno alcun ruolo nell'attivazione del componente.</span><span class="sxs-lookup"><span data-stu-id="c9849-124">For example, the Transactions Disabled and Synchronization Disabled settings, indicating the presence of a transaction or a synchronization domain, will play no role whatsoever in the component's activation.</span></span> <span data-ttu-id="c9849-125">Queste proprietà vengono ignorate in base alla propagazione del contesto.</span><span class="sxs-lookup"><span data-stu-id="c9849-125">These properties are fundamentally ignored when context is flowed.</span></span> <span data-ttu-id="c9849-126">In alternativa, se un componente usa solo il controllo di accesso a livello di processo, la relativa proprietà del contesto di sicurezza viene ignorata. la configurazione di sicurezza del componente non svolgerà mai un ruolo nell'attivazione.</span><span class="sxs-lookup"><span data-stu-id="c9849-126">Or if a component uses only process-level access checking, its security context property is ignored—the component's security configuration will never play a role in its activation.</span></span>

## <a name="forcing-activation-in-the-callers-context"></a><span data-ttu-id="c9849-127">Forzare l'attivazione nel contesto del chiamante</span><span class="sxs-lookup"><span data-stu-id="c9849-127">Forcing Activation in the Caller's Context</span></span>

<span data-ttu-id="c9849-128">In alcune circostanze, è possibile che un oggetto venga attivato solo nel contesto del chiamante, ovvero mai attivato nel contesto.</span><span class="sxs-lookup"><span data-stu-id="c9849-128">In some circumstances, you might want an object to be activated only in its caller's context—that is, never activated in its own context.</span></span> <span data-ttu-id="c9849-129">Ad esempio, potrebbe essere necessario controllare il comportamento dell'oggetto quando viene chiamato attraverso un limite del contesto.</span><span class="sxs-lookup"><span data-stu-id="c9849-129">For example, you might want to control the object's behavior when it's called across a context boundary.</span></span>

<span data-ttu-id="c9849-130">È possibile verificare che un oggetto non possa essere attivato nel proprio contesto selezionando l'opzione di **contesto deve essere attivato in chiamanti** nella scheda **attivazione** della pagina **proprietà** componente, usando lo strumento di amministrazione Servizi componenti.</span><span class="sxs-lookup"><span data-stu-id="c9849-130">You can ensure that an object cannot be activated in its own context by selecting the **Must be activated in callers context** option on the **Activation** tab of the component **Properties** page, using the Component Services administrative tool.</span></span> <span data-ttu-id="c9849-131">Per istruzioni dettagliate, vedere [applicazione dell'attivazione nel contesto del chiamante](enforcing-activation-in-the-caller-s-context.md) . Quando si seleziona questa opzione, se l'oggetto non può essere attivato nel contesto del chiamante, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) ha esito negativo, restituendo un \_ \_ tentativo \_ di creazione al di \_ fuori del \_ \_ \_ contesto client.</span><span class="sxs-lookup"><span data-stu-id="c9849-131">(See [Enforcing Activation in the Caller's Context](enforcing-activation-in-the-caller-s-context.md) for step-by-step instructions.) When you select this option, if the object cannot be activated in the caller's context, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) fails, returning CO\_E\_ATTEMPT\_TO\_CREATE\_OUTSIDE\_CLIENT\_CONTEXT.</span></span>

## <a name="default-context"></a><span data-ttu-id="c9849-132">Contesto predefinito</span><span class="sxs-lookup"><span data-stu-id="c9849-132">Default Context</span></span>

<span data-ttu-id="c9849-133">Sono disponibili contesti predefiniti per supportare componenti non configurati, ovvero componenti COM non installati nelle applicazioni COM+ e non registrati nel database di registrazione della classe COM+.</span><span class="sxs-lookup"><span data-stu-id="c9849-133">Default contexts exist to support unconfigured components—that is, COM components not installed in COM+ applications and not registered in the COM+ class registration database.</span></span> <span data-ttu-id="c9849-134">Se i componenti non configurati hanno un modello di threading compatibile, vengono attivati nel contesto del chiamante.</span><span class="sxs-lookup"><span data-stu-id="c9849-134">If unconfigured components have a compatible threading model, they are activated in the caller's context.</span></span> <span data-ttu-id="c9849-135">In caso contrario, vengono attivati in un contesto predefinito nell'Apartment appropriato.</span><span class="sxs-lookup"><span data-stu-id="c9849-135">Otherwise, they are activated in a default context in the appropriate apartment.</span></span> <span data-ttu-id="c9849-136">Ogni Apartment dispone di un contesto predefinito per supportare gli oggetti COM che non utilizzano servizi COM+.</span><span class="sxs-lookup"><span data-stu-id="c9849-136">Each apartment has a default context to support COM objects that do not use COM+ services.</span></span>

## <a name="hooking-activation"></a><span data-ttu-id="c9849-137">Attivazione dell'hook</span><span class="sxs-lookup"><span data-stu-id="c9849-137">Hooking Activation</span></span>

<span data-ttu-id="c9849-138">Implementando [**IObjectControl:: Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) e [**IObjectControl::D ttiva**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate), è possibile associare l'attivazione e la disattivazione insieme per eseguire un'inizializzazione speciale nel nuovo contesto.</span><span class="sxs-lookup"><span data-stu-id="c9849-138">By implementing [**IObjectControl::Activate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-activate) and [**IObjectControl::Deactivate**](/windows/desktop/api/ComSvcs/nf-comsvcs-iobjectcontrol-deactivate), you can hook activation and deactivation together to perform special initialization in the new context.</span></span> <span data-ttu-id="c9849-139">Questi metodi vengono chiamati da COM+ in determinati punti del ciclo di vita di un oggetto, quando l'oggetto è configurato per l'utilizzo dell'attivazione JIT o del pool di oggetti.</span><span class="sxs-lookup"><span data-stu-id="c9849-139">These methods are called by COM+ at certain points in an object's lifecycle, when the object is configured to use JIT-activation or object pooling.</span></span> <span data-ttu-id="c9849-140">Per informazioni più dettagliate, vedere [attivazione JIT di com+](com--just-in-time-activation.md) e [pool di oggetti com+](com--object-pooling.md) .</span><span class="sxs-lookup"><span data-stu-id="c9849-140">See [COM+ Just-in-Time Activation](com--just-in-time-activation.md) and [COM+ Object Pooling](com--object-pooling.md) for more detail.</span></span>

## <a name="related-topics"></a><span data-ttu-id="c9849-141">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="c9849-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c9849-142">Intercettazione di chiamate tra contesti</span><span class="sxs-lookup"><span data-stu-id="c9849-142">Interception of Cross-Context Calls</span></span>](interception-of-cross-context-calls.md)
</dt> </dl>

 

 
