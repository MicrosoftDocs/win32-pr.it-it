---
description: In questo argomento vengono identificate diverse strategie di gestione degli errori da tenere presenti quando si sviluppano componenti per COM+.
ms.assetid: 1ae5875b-8085-44f2-9071-c2a5d7543ac1
title: Strategie per la gestione degli errori in COM+
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 91ca64546683fa45ac8df3bcb47534d8de482798
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106304730"
---
# <a name="strategies-for-handling-errors-in-com"></a><span data-ttu-id="9f225-103">Strategie per la gestione degli errori in COM+</span><span class="sxs-lookup"><span data-stu-id="9f225-103">Strategies for Handling Errors in COM+</span></span>

<span data-ttu-id="9f225-104">In questo argomento vengono identificate diverse strategie di gestione degli errori da tenere presenti quando si sviluppano componenti per COM+.</span><span class="sxs-lookup"><span data-stu-id="9f225-104">This topic identifies several error-handling strategies to keep in mind as you develop components for COM+.</span></span>

-   <span data-ttu-id="9f225-105">**Restituisce un valore HRESULT per tutti i metodi in tutte le interfacce del componente.**</span><span class="sxs-lookup"><span data-stu-id="9f225-105">**Return an HRESULT value for all methods in all component interfaces.**</span></span>  <span data-ttu-id="9f225-106">COM+ utilizza valori **HRESULT** per segnalare eventuali errori durante l'esecuzione di chiamate di funzione o chiamate al metodo di interfaccia.</span><span class="sxs-lookup"><span data-stu-id="9f225-106">COM+ uses **HRESULT** values to report on any errors in making function calls or interface method calls.</span></span> <span data-ttu-id="9f225-107">**HRESULT** indica se un metodo ha avuto esito positivo o negativo e identifica la struttura associata all'errore, ad esempio RPC, Win32 o ITF, per gli errori specifici dell'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="9f225-107">An **HRESULT** indicates whether a method succeeded or failed and identifies the facility associated with the error, such as RPC, WIN32, or ITF for interface-specific errors.</span></span> <span data-ttu-id="9f225-108">Inoltre, le API di sistema forniscono una ricerca da un **HRESULT** a una stringa che descrive la condizione di errore.</span><span class="sxs-lookup"><span data-stu-id="9f225-108">Also, system APIs provide a lookup from an **HRESULT** to a string that describes the error condition.</span></span> <span data-ttu-id="9f225-109">L'utilizzo di metodi che restituiscono valori **HRESULT** è fondamentale per i componenti ben scritti e è essenziale per il processo di debug.</span><span class="sxs-lookup"><span data-stu-id="9f225-109">Using methods that return **HRESULT** values are fundamental to well-written components and are essential to the debugging process.</span></span> <span data-ttu-id="9f225-110">Microsoft Visual Basic definisce automaticamente ogni metodo con un valore **HRESULT** come valore restituito.</span><span class="sxs-lookup"><span data-stu-id="9f225-110">Microsoft Visual Basic automatically defines each method with an **HRESULT** as a return.</span></span> <span data-ttu-id="9f225-111">In Microsoft Visual C++, è necessario restituire in modo esplicito un valore **HRESULT**.</span><span class="sxs-lookup"><span data-stu-id="9f225-111">In Microsoft Visual C++, you must explicitly return an **HRESULT**.</span></span> <span data-ttu-id="9f225-112">Per ulteriori informazioni sui valori HRESULT, vedere la pagina relativa alla [struttura dei codici di errore com](/windows/desktop/com/structure-of-com-error-codes).</span><span class="sxs-lookup"><span data-stu-id="9f225-112">For additional information on HRESULTs, see [Structure of COM Error Codes](/windows/desktop/com/structure-of-com-error-codes).</span></span>
-   <span data-ttu-id="9f225-113">**Avviare l'oggetto raccolta ErrorInfo in base a qualsiasi metodo fornito dallo strumento di sviluppo.**</span><span class="sxs-lookup"><span data-stu-id="9f225-113">**Initiate the ErrorInfo collection object by whatever means your development tool provides.**</span></span> <span data-ttu-id="9f225-114">Gli oggetti della raccolta [**errorInfo**](errorinfo.md) sono spesso denominati eccezioni com, perché consentono a un oggetto di passare (o generare) informazioni dettagliate sugli errori al chiamante, anche attraverso i limiti dell'Apartment.</span><span class="sxs-lookup"><span data-stu-id="9f225-114">[**ErrorInfo**](errorinfo.md) collection objects are often called COM exceptions because they allow an object to pass (or throw) rich error information to its caller, even across apartment boundaries.</span></span> <span data-ttu-id="9f225-115">Il valore di questo oggetto errore generico è che integra un HRESULT, estendendo il tipo di informazioni sugli errori che è possibile restituire a un chiamante.</span><span class="sxs-lookup"><span data-stu-id="9f225-115">The value of this generic error object is that it supplements an HRESULT, extending the type of error information that you can return to a caller.</span></span> <span data-ttu-id="9f225-116">Ogni oggetto della raccolta **errorInfo** restituisce una descrizione contestuale, l'origine dell'errore e l'identificatore di interfaccia del metodo che ha originato l'errore.</span><span class="sxs-lookup"><span data-stu-id="9f225-116">Each **ErrorInfo** collection object returns a contextual description, the source of the error, and the interface identifier of the method that originated the error.</span></span> <span data-ttu-id="9f225-117">È anche possibile includere puntatori a una voce in un file della guida.</span><span class="sxs-lookup"><span data-stu-id="9f225-117">You can also include pointers to an entry in a help file.</span></span> <span data-ttu-id="9f225-118">L'automazione offre tre interfacce per la gestione dell'oggetto Error.</span><span class="sxs-lookup"><span data-stu-id="9f225-118">Automation provides three interfaces to manage the error object.</span></span> <span data-ttu-id="9f225-119">Il componente deve implementare l'interfaccia di automazione **ISupportErrorInfo** per annunciare il proprio supporto per la raccolta **errorInfo** .</span><span class="sxs-lookup"><span data-stu-id="9f225-119">Your component must implement the **ISupportErrorInfo** Automation interface to advertise its support for the **ErrorInfo** collection.</span></span> <span data-ttu-id="9f225-120">Quando si verifica un errore, il componente usa l'interfaccia di automazione **ICreateErrorInfo** per inizializzare un oggetto Error.</span><span class="sxs-lookup"><span data-stu-id="9f225-120">When an error occurs, the component uses the **ICreateErrorInfo** Automation interface to initialize an error object.</span></span> <span data-ttu-id="9f225-121">Quando il chiamante controlla HRESULT e rileva che la chiamata al metodo ha avuto esito negativo, esegue una query sull'oggetto per verificare se supporta la raccolta **errorInfo** .</span><span class="sxs-lookup"><span data-stu-id="9f225-121">After the caller inspects the HRESULT and finds that the method call failed, it queries the object to see whether it supports the **ErrorInfo** collection.</span></span> <span data-ttu-id="9f225-122">In tal caso, il chiamante usa l'interfaccia di automazione **IErrorInfo** per recuperare le informazioni sull'errore.</span><span class="sxs-lookup"><span data-stu-id="9f225-122">If it does, the caller uses the **IErrorInfo** Automation interface to retrieve the error information.</span></span> <span data-ttu-id="9f225-123">Visual Basic programmatori possono accedere facilmente all'oggetto raccolta **errorInfo** , esposto tramite l'oggetto Err.</span><span class="sxs-lookup"><span data-stu-id="9f225-123">Visual Basic programmers have easy access to the **ErrorInfo** collection object, which is exposed through the Err object.</span></span> <span data-ttu-id="9f225-124">È possibile generare errori con la funzione di generazione Err e rilevare errori con l'istruzione **On Error** .</span><span class="sxs-lookup"><span data-stu-id="9f225-124">You can raise errors with the Err Raise function and catch errors with the **On Error** statement.</span></span> <span data-ttu-id="9f225-125">Il Visual Basic livello di runtime si occupa automaticamente del mapping.</span><span class="sxs-lookup"><span data-stu-id="9f225-125">The Visual Basic run-time layer takes care of the mapping for you.</span></span> <span data-ttu-id="9f225-126">Se si utilizza il supporto del compilatore COM di Visual C++, è possibile utilizzare \_ la \_ classe com raise \_ Error per segnalare un errore e \_ la \_ classe di errore com per recuperare le informazioni sull'errore.</span><span class="sxs-lookup"><span data-stu-id="9f225-126">If you are using the Visual C++ COM compiler support, you can use the \_com\_raise\_error class to report an error and the \_com\_error class to retrieve error information.</span></span> <span data-ttu-id="9f225-127">In COM+ le eccezioni C++ tradizionali non vengono propagate come informazioni **IErrorInfo** estese.</span><span class="sxs-lookup"><span data-stu-id="9f225-127">COM+ will not propagate traditional C++ exceptions as extended **IErrorInfo** information.</span></span> <span data-ttu-id="9f225-128">Per ulteriori informazioni sull'oggetto raccolta **errorInfo** , vedere la sezione relativa alla gestione degli errori nella Guida all'automazione.</span><span class="sxs-lookup"><span data-stu-id="9f225-128">For additional information on the **ErrorInfo** collection object, see "Error Handling" in the Automation guide.</span></span>
    > [!Note]  
    > <span data-ttu-id="9f225-129">COM richiede che tutti gli oggetti della raccolta [**errorInfo**](errorinfo.md) vengano sottoposti a marshalling per valore, implicando che i componenti che implementano l'interfaccia di automazione **IErrorInfo** debbano implementare e supportare anche l'interfaccia [**IMarshal**](/windows/desktop/api/objidl/nn-objidl-imarshal) .</span><span class="sxs-lookup"><span data-stu-id="9f225-129">COM requires that all [**ErrorInfo**](errorinfo.md) collection objects marshal by value, implying that components that implement the **IErrorInfo** Automation interface must also implement and support the [**IMarshal**](/windows/desktop/api/objidl/nn-objidl-imarshal) interface.</span></span> <span data-ttu-id="9f225-130">L'implementazione dell'interfaccia **IMarshal** deve supportare il marshalling per valore per il componente.</span><span class="sxs-lookup"><span data-stu-id="9f225-130">The **IMarshal** interface implementation must support marshal by value for the component.</span></span>

     

-   <span data-ttu-id="9f225-131">**Usare le transazioni per gestire gli errori delle risorse condivise.**</span><span class="sxs-lookup"><span data-stu-id="9f225-131">**Use transactions to manage shared resource failures.**</span></span> <span data-ttu-id="9f225-132">Le transazioni automatiche possono ridurre significativamente la quantità di codice di gestione degli errori che è necessario scrivere quando si utilizzano i gestori di risorse gestiti dallo stato.</span><span class="sxs-lookup"><span data-stu-id="9f225-132">Automatic transactions can significantly reduce the amount of error-handling code you must write when using state-managed resource managers.</span></span> <span data-ttu-id="9f225-133">Tuttavia, le transazioni non eliminano completamente la necessità di una gestione degli errori.</span><span class="sxs-lookup"><span data-stu-id="9f225-133">However, transactions do not eliminate the need for error handling altogether.</span></span> <span data-ttu-id="9f225-134">È comunque necessario restituire i codici di errore dai metodi di interfaccia e verificare i codici di errore all'interno del chiamante per evitare di eseguire operazioni non necessarie per una transazione eliminata.</span><span class="sxs-lookup"><span data-stu-id="9f225-134">You still need to return error codes from your interface methods and check those error codes within the caller to avoid doing unnecessary work for a doomed transaction.</span></span> <span data-ttu-id="9f225-135">Per ulteriori informazioni sulla combinazione della gestione degli errori con l'elaborazione delle transazioni, vedere [velocizzare le transazioni inviando una notifica all'oggetto radice](speeding-transactions-by-notifying-the-root-object.md).</span><span class="sxs-lookup"><span data-stu-id="9f225-135">For additional information about combining error handling with transaction processing, see [Speeding Transactions by Notifying the Root Object](speeding-transactions-by-notifying-the-root-object.md).</span></span>
-   <span data-ttu-id="9f225-136">**Genera errori in modo esplicito.**</span><span class="sxs-lookup"><span data-stu-id="9f225-136">**Raise errors explicitly.**</span></span> <span data-ttu-id="9f225-137">Evitare che le informazioni sugli errori lascino un oggetto a meno che l'oggetto non generi in modo esplicito l'errore.</span><span class="sxs-lookup"><span data-stu-id="9f225-137">Avoid letting error information leave an object unless the object explicitly raises the error.</span></span> <span data-ttu-id="9f225-138">Rilevare tutti gli errori generati dagli strumenti e gestirli nel codice del componente.</span><span class="sxs-lookup"><span data-stu-id="9f225-138">Catch all tool-generated errors and handle them in your component code.</span></span> <span data-ttu-id="9f225-139">Includere almeno un gestore standard per segnalare gli errori imprevisti in modo coerente.</span><span class="sxs-lookup"><span data-stu-id="9f225-139">At the very least, include a standard handler to report unexpected errors in a consistent manner.</span></span>
-   <span data-ttu-id="9f225-140">**Usare la funzionalità \_ intervallo ITF degli errori per segnalare errori specifici dell'interfaccia.**</span><span class="sxs-lookup"><span data-stu-id="9f225-140">**Use the FACILITY\_ITF range of errors to report interface-specific errors.**</span></span> <span data-ttu-id="9f225-141">Gli errori specifici dell'interfaccia devono trovarsi nell' \_ intervallo di errori della struttura, tra 0x0200 e 0xFFFF.</span><span class="sxs-lookup"><span data-stu-id="9f225-141">Interface-specific errors should be in the FACILITY\_ITF range of errors, between 0x0200 and 0xFFFF.</span></span> <span data-ttu-id="9f225-142">È possibile definire un codice di errore personalizzato in Visual Basic come offset rispetto a vbObjectError.</span><span class="sxs-lookup"><span data-stu-id="9f225-142">You can define a custom error code in Visual Basic as an offset from vbObjectError.</span></span> <span data-ttu-id="9f225-143">Usare la \_ macro make HRESULT in C++ per introdurre un codice di errore specifico dell'interfaccia, come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="9f225-143">Use the MAKE\_HRESULT macro in C++ to introduce an interface-specific error code, as shown in the following example:</span></span>

    ``` syntax
    const HRESULT ERROR_NUMBER = MAKE_HRESULT (SEVERITY_ERROR, FACILITY_ITF, 10);
    ```

## <a name="related-topics"></a><span data-ttu-id="9f225-144">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="9f225-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="9f225-145">Criteri di isolamento degli errori e FailFast</span><span class="sxs-lookup"><span data-stu-id="9f225-145">Fault Isolation and Failfast Policy</span></span>](fault-isolation-and-failfast-policy.md)
</dt> <dt>

[<span data-ttu-id="9f225-146">Individuazione dell'origine di un errore</span><span class="sxs-lookup"><span data-stu-id="9f225-146">Finding the Source of an Error</span></span>](finding-the-source-of-an-error.md)
</dt> <dt>

[<span data-ttu-id="9f225-147">Modalità di modifica dei valori restituiti da COM+</span><span class="sxs-lookup"><span data-stu-id="9f225-147">How COM+ Modifies Return Values</span></span>](how-com--modifies-return-values.md)
</dt> <dt>

[<span data-ttu-id="9f225-148">Interpretazione dei codici di errore</span><span class="sxs-lookup"><span data-stu-id="9f225-148">Interpreting Error Codes</span></span>](interpreting-error-codes.md)
</dt> <dt>

[<span data-ttu-id="9f225-149">Risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="9f225-149">Troubleshooting</span></span>](troubleshooting.md)
</dt> </dl>

 

 
