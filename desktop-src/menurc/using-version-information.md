---
title: Utilizzo delle informazioni sulla versione
description: In questo argomento viene illustrato come utilizzare le funzioni di informazioni sulla versione.
ms.assetid: 447b57c9-9e94-4a28-897e-f7b87d9cb25a
keywords:
- risorse, informazioni sulla versione
- informazioni sulla versione
- informazioni sul file di installazione
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1a8785275f5aac69218989250d1c0f83e0a1ff9f
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/19/2020
ms.locfileid: "103725455"
---
# <a name="using-version-information"></a><span data-ttu-id="1c3f0-106">Utilizzo delle informazioni sulla versione</span><span class="sxs-lookup"><span data-stu-id="1c3f0-106">Using Version Information</span></span>

<span data-ttu-id="1c3f0-107">Un programma di installazione ha in genere gli obiettivi seguenti:</span><span class="sxs-lookup"><span data-stu-id="1c3f0-107">An installation program typically has the following goals:</span></span>

-   <span data-ttu-id="1c3f0-108">Per inserire i file nel percorso corretto.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-108">To place files in the correct location.</span></span>
-   <span data-ttu-id="1c3f0-109">Per notificare all'utente se il programma di installazione sostituisce un file esistente con una versione significativamente diversa, ad esempio sostituendo un file in lingua tedesca con un file in lingua inglese o sostituendo un file più recente con un file precedente.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-109">To notify the user if the installation program is replacing an existing file with a version that is significantly different—for example, replacing a German-language file with an English-language file, or replacing a newer file with an older file.</span></span>

<span data-ttu-id="1c3f0-110">Quando si scrive il programma di installazione, è necessario disporre delle seguenti informazioni per ogni file:</span><span class="sxs-lookup"><span data-stu-id="1c3f0-110">When writing the installation program, you must have the following information for each file:</span></span>

-   <span data-ttu-id="1c3f0-111">Nome e percorso del file (denominato file di origine).</span><span class="sxs-lookup"><span data-stu-id="1c3f0-111">The name and location of the file (referred to as the source file).</span></span>
-   <span data-ttu-id="1c3f0-112">Nome del file equivalente sul disco rigido dell'utente (denominato file di destinazione).</span><span class="sxs-lookup"><span data-stu-id="1c3f0-112">The name of the equivalent file on the user's hard disk (referred to as the destination file).</span></span> <span data-ttu-id="1c3f0-113">Questo nome corrisponde in genere al nome del file nel disco di installazione.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-113">This name is usually the same as the filename on the installation disk.</span></span>
-   <span data-ttu-id="1c3f0-114">Lo stato di condivisione del file, vale a dire se il file è privato per l'applicazione in fase di installazione o può essere condiviso da più applicazioni.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-114">The sharing status of the file—that is, whether the file is private to the application being installed or could be shared by multiple applications.</span></span>

<span data-ttu-id="1c3f0-115">Il programma di installazione può utilizzare la funzione [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea) per determinare la posizione in cui copiare il file sul disco.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-115">The installation program can use the [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea) function to determine where the file should be copied on the disk.</span></span> <span data-ttu-id="1c3f0-116">Questa funzione può essere utilizzata anche per specificare se il file è privato o può essere condiviso.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-116">This function can also be used to specify whether the file is private to the application or can be shared.</span></span> <span data-ttu-id="1c3f0-117">Se si verifica un problema durante la ricerca del file, **VerFindFile** restituisce un valore di errore.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-117">If a problem occurs in finding the file, **VerFindFile** returns an error value.</span></span> <span data-ttu-id="1c3f0-118">Ad esempio, se il sistema usa il file di destinazione, **VerFindFile** restituisce **VFF \_ FILEINUSE**.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-118">For example, if the system is using the destination file, **VerFindFile** returns **VFF\_FILEINUSE**.</span></span> <span data-ttu-id="1c3f0-119">Il programma di installazione deve notificare all'utente il problema e rispondere alla decisione dell'utente di continuare o di terminare l'installazione.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-119">The installation program must notify the user of the problem and respond to the user's decision to continue or to end the installation.</span></span>

<span data-ttu-id="1c3f0-120">La funzione [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) copia il file di origine in un file temporaneo nella directory specificata da [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea).</span><span class="sxs-lookup"><span data-stu-id="1c3f0-120">The [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) function copies the source file to a temporary file in the directory specified by [**VerFindFile**](/windows/desktop/api/Winver/nf-winver-verfindfilea).</span></span> <span data-ttu-id="1c3f0-121">Se necessario, **VerInstallFile** espande il file usando le funzioni nella libreria di decompressione dei dati.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-121">If necessary, **VerInstallFile** expands the file by using the functions in the data decompression library.</span></span>

<span data-ttu-id="1c3f0-122">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) Confronta le informazioni sulla versione del file temporaneo con quelle del file di destinazione.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-122">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) compares the version information of the temporary file to that of the destination file.</span></span> <span data-ttu-id="1c3f0-123">Se i due valori sono diversi, **VerInstallFile** restituisce uno o più valori di errore.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-123">If the two differ, **VerInstallFile** returns one or more error values.</span></span> <span data-ttu-id="1c3f0-124">Ad esempio, restituisce **VIF \_ SRCOLD** se il file temporaneo è antecedente al file di destinazione e **VIF \_ DIFFLANG** se i file hanno identificatori di lingua o valori della tabella codici diversi.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-124">For example, it returns **VIF\_SRCOLD** if the temporary file is older than the destination file and **VIF\_DIFFLANG** if the files have different language identifiers or code-page values.</span></span> <span data-ttu-id="1c3f0-125">Il programma di installazione deve notificare all'utente il problema e rispondere alla decisione dell'utente di continuare o di terminare l'installazione.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-125">The installation program must notify the user of the problem and respond to the user's decision to continue or to end the installation.</span></span>

<span data-ttu-id="1c3f0-126">Alcuni errori di [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) sono recuperabili.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-126">Some [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) errors are recoverable.</span></span> <span data-ttu-id="1c3f0-127">In altre termini, il programma di installazione può chiamare nuovamente **VerInstallFile** , specificando l'opzione **VIFF \_ FORCEINSTALL** , per installare il file indipendentemente dal conflitto di versione.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-127">That is, the installation program can call **VerInstallFile** again, specifying the **VIFF\_FORCEINSTALL** option, to install the file regardless of the version conflict.</span></span> <span data-ttu-id="1c3f0-128">Se **VerInstallFile** restituisce **VIF \_ tempfile** e l'utente sceglie di non forzare l'installazione, il programma di installazione deve eliminare il file temporaneo.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-128">If **VerInstallFile** returns **VIF\_TEMPFILE** and the user chooses not to force the installation, the installation program should delete the temporary file.</span></span>

<span data-ttu-id="1c3f0-129">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) potrebbe verificarsi un errore irreversibile durante il tentativo di forzare l'installazione, anche se l'errore non esisteva in precedenza.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-129">[**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) could encounter a nonrecoverable error when attempting to force installation, even though the error did not exist previously.</span></span> <span data-ttu-id="1c3f0-130">Ad esempio, il file potrebbe essere bloccato da un altro utente prima che il programma di installazione abbia tentato di forzare l'installazione.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-130">For example, the file could be locked by another user before the installation program attempted to force installation.</span></span> <span data-ttu-id="1c3f0-131">Se un programma di installazione tenta di forzare l'installazione dopo un errore irreversibile, **VerInstallFile** non riesce.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-131">If an installation program attempts to force installation after a non-recoverable error, **VerInstallFile** fails.</span></span> <span data-ttu-id="1c3f0-132">Il programma di installazione deve contenere routine per il ripristino da questo tipo di errore.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-132">The installation program must contain routines to recover from this type of error.</span></span>

<span data-ttu-id="1c3f0-133">La soluzione consigliata consiste nel visualizzare una finestra di dialogo con i pulsanti **Installa**, **Ignora** e **installa tutto**.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-133">The recommended solution is to display a dialog box with the buttons **Install**, **Skip**, and **Install All**.</span></span> <span data-ttu-id="1c3f0-134">Un'altra soluzione è una finestra di dialogo con i pulsanti **Sì**, **Sì**, **Ignora** e **Annulla**. Il pulsante **installa tutto** dovrebbe impedire al programma di installazione di richiedere all'utente errori simili, includendo l'opzione **VIFF \_ FORCEINSTALL** in tutti gli utilizzi successivi di [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea).</span><span class="sxs-lookup"><span data-stu-id="1c3f0-134">(Another solution is a dialog box with the buttons **Yes**, **Yes to All**, **Skip**, and **Cancel**.) The **Install All** button should prevent the installation program from prompting the user about similar errors by including the **VIFF\_FORCEINSTALL** option in all subsequent uses of [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea).</span></span> <span data-ttu-id="1c3f0-135">Per gli errori irreversibili, i pulsanti **Installa** e **installa tutti** devono essere disabilitati.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-135">For nonrecoverable errors, the **Install** and **Install All** buttons should be disabled.</span></span>

<span data-ttu-id="1c3f0-136">Per visualizzare un messaggio di errore utile all'utente, il programma di installazione di solito deve recuperare le informazioni dalle risorse di versione dei file in conflitto.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-136">To display a useful error message to the user, the installation program usually must retrieve information from the version resources of the conflicting files.</span></span> <span data-ttu-id="1c3f0-137">Sono disponibili quattro funzioni che il programma di installazione può utilizzare a questo scopo:</span><span class="sxs-lookup"><span data-stu-id="1c3f0-137">There are four functions the installation program can use for this purpose:</span></span>

-   [<span data-ttu-id="1c3f0-138">**Impossibile eseguire GetFileVersionInfoSize**</span><span class="sxs-lookup"><span data-stu-id="1c3f0-138">**GetFileVersionInfoSize**</span></span>](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea)
-   [<span data-ttu-id="1c3f0-139">**GetFileVersionInfo**</span><span class="sxs-lookup"><span data-stu-id="1c3f0-139">**GetFileVersionInfo**</span></span>](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa)
-   [<span data-ttu-id="1c3f0-140">**VerQueryValue**</span><span class="sxs-lookup"><span data-stu-id="1c3f0-140">**VerQueryValue**</span></span>](/windows/desktop/api/Winver/nf-winver-verqueryvaluea)
-   [<span data-ttu-id="1c3f0-141">**VerLanguageName**</span><span class="sxs-lookup"><span data-stu-id="1c3f0-141">**VerLanguageName**</span></span>](/windows/desktop/api/Winver/nf-winver-verlanguagenamea)

<span data-ttu-id="1c3f0-142">[**Impossibile eseguire GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea) restituisce le dimensioni delle informazioni sulla versione.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-142">[**GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea) returns the size of the version information.</span></span> <span data-ttu-id="1c3f0-143">[**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa) usa le informazioni recuperate da **Impossibile eseguire GetFileVersionInfoSize** per recuperare una struttura che contiene le informazioni sulla versione.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-143">[**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa) uses information retrieved by **GetFileVersionInfoSize** to retrieve a structure that contains the version information.</span></span> <span data-ttu-id="1c3f0-144">[**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) recupera un membro specifico da tale struttura.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-144">[**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) retrieves a specific member from that structure.</span></span>

<span data-ttu-id="1c3f0-145">Se, ad esempio, [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) restituisce l'errore **VIF \_ elemento DiffType** , il programma di installazione deve utilizzare le funzioni [**Impossibile eseguire GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea), [**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa)e [**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) sui file temporanei e di destinazione per ottenere il tipo generale di ogni file.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-145">For example, if [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) returns the **VIF\_DIFFTYPE** error, the installation program should use the [**GetFileVersionInfoSize**](/windows/desktop/api/Winver/nf-winver-getfileversioninfosizea), [**GetFileVersionInfo**](/windows/desktop/api/Winver/nf-winver-getfileversioninfoa), and [**VerQueryValue**](/windows/desktop/api/Winver/nf-winver-verqueryvaluea) functions on the temporary and destination files to obtain the general type of each file.</span></span> <span data-ttu-id="1c3f0-146">Se le lingue dei file sono in conflitto, anche il programma di installazione deve usare [**VerLanguageName**](/windows/desktop/api/Winver/nf-winver-verlanguagenamea) per convertire l'identificatore di lingua binario in una rappresentazione testuale della lingua.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-146">If the languages of the files conflict, the installation program should also use [**VerLanguageName**](/windows/desktop/api/Winver/nf-winver-verlanguagenamea) to translate the binary language identifier into a text representation of the language.</span></span> <span data-ttu-id="1c3f0-147">Ad esempio, 0x040C viene convertito nella stringa "French".</span><span class="sxs-lookup"><span data-stu-id="1c3f0-147">(For example, 0x040C translates to the string "French.")</span></span>

<span data-ttu-id="1c3f0-148">Se [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) restituisce un errore di file, ad esempio **VIF \_ ACCESSVIOLATION**, il programma di installazione deve usare la funzione [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) per recuperare il valore di errore più recente.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-148">If [**VerInstallFile**](/windows/desktop/api/Winver/nf-winver-verinstallfilea) returns a file error, such as **VIF\_ACCESSVIOLATION**, the installation program should use the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function to retrieve the most recent error value.</span></span> <span data-ttu-id="1c3f0-149">Il programma deve tradurre questo valore in un messaggio informativo da visualizzare all'utente.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-149">The program should translate this value into an informative message to display to the user.</span></span> <span data-ttu-id="1c3f0-150">Il programma non deve restituire il controllo tra le chiamate a **VerInstallFile** e **GetLastError**.</span><span class="sxs-lookup"><span data-stu-id="1c3f0-150">The program must not yield control between the calls to **VerInstallFile** and **GetLastError**.</span></span>

 

 