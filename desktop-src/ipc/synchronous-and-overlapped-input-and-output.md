---
description: I/o della pipe sincrona e I/O della pipe asincrona. Le funzioni ReadFile, WriteFile, TransactNamedPipe e ConnectNamedPipe possono eseguire operazioni di input e output su una pipe in modo sincrono o asincrono.
ms.assetid: 5ab9bb7f-1f99-4041-bba8-2863f34dbcaf
title: I/O della pipe sincrona e sovrapposta
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3becfb19dfe5fa49d4121246a576fb3200226b1a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106318430"
---
# <a name="synchronous-and-overlapped-pipe-io"></a><span data-ttu-id="3b975-104">I/O della pipe sincrona e sovrapposta</span><span class="sxs-lookup"><span data-stu-id="3b975-104">Synchronous and Overlapped Pipe I/O</span></span>

<span data-ttu-id="3b975-105">Le funzioni [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe)e [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) possono eseguire operazioni di input e output su una pipe in modo sincrono o asincrono.</span><span class="sxs-lookup"><span data-stu-id="3b975-105">The [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe), and [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) functions can perform input and output operations on a pipe either synchronously or asynchronously.</span></span> <span data-ttu-id="3b975-106">Quando una funzione viene eseguita in modo sincrono, non viene restituita finché non viene completata l'operazione che sta eseguendo.</span><span class="sxs-lookup"><span data-stu-id="3b975-106">When a function runs synchronously, it does not return until the operation it is performing is completed.</span></span> <span data-ttu-id="3b975-107">Ciò significa che l'esecuzione del thread chiamante può essere bloccata per un periodo indefinito mentre è in attesa del completamento di un'operazione che richiede molto tempo.</span><span class="sxs-lookup"><span data-stu-id="3b975-107">This means that the execution of the calling thread can be blocked for an indefinite period while it waits for a time-consuming operation to be completed.</span></span> <span data-ttu-id="3b975-108">Quando una funzione viene eseguita in modo asincrono, viene restituito immediatamente, anche se l'operazione non è stata completata.</span><span class="sxs-lookup"><span data-stu-id="3b975-108">When a function runs asynchronously, it returns immediately, even if the operation has not been completed.</span></span> <span data-ttu-id="3b975-109">In questo modo è possibile eseguire un'operazione che richiede molto tempo in background, mentre il thread chiamante è libero di eseguire altre attività.</span><span class="sxs-lookup"><span data-stu-id="3b975-109">This enables a time-consuming operation to be executed in the background while the calling thread is free to perform other tasks.</span></span>

<span data-ttu-id="3b975-110">L'utilizzo di operazioni di I/O asincrone consente a un server pipe di utilizzare un ciclo che esegue i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="3b975-110">Using asynchronous I/O enables a pipe server to use a loop that performs the following steps:</span></span>

1.  <span data-ttu-id="3b975-111">Specificare più oggetti evento in una chiamata alla funzione Wait e attendere che uno degli oggetti sia impostato sullo stato segnalato.</span><span class="sxs-lookup"><span data-stu-id="3b975-111">Specify multiple event objects in a call to the wait function, and wait for one of the objects to be set to the signaled state.</span></span>
2.  <span data-ttu-id="3b975-112">Usare il valore restituito della funzione wait per determinare quale operazione sovrapposta è stata completata.</span><span class="sxs-lookup"><span data-stu-id="3b975-112">Use the wait function's return value to determine which overlapped operation has finished.</span></span>
3.  <span data-ttu-id="3b975-113">Eseguire le attività necessarie per pulire l'operazione completata e avviare l'operazione successiva per tale handle della pipe.</span><span class="sxs-lookup"><span data-stu-id="3b975-113">Perform the tasks necessary to clean up the completed operation and initiate the next operation for that pipe handle.</span></span> <span data-ttu-id="3b975-114">Questo può implicare l'avvio di un'altra operazione sovrapposta per lo stesso handle di pipe.</span><span class="sxs-lookup"><span data-stu-id="3b975-114">This can involve starting another overlapped operation for the same pipe handle.</span></span>

<span data-ttu-id="3b975-115">Le operazioni sovrapposte consentono a una pipe di leggere e scrivere dati contemporaneamente e per un singolo thread di eseguire operazioni di I/O simultanee su più handle di pipe.</span><span class="sxs-lookup"><span data-stu-id="3b975-115">Overlapped operations make it possible for one pipe to read and write data simultaneously and for a single thread to perform simultaneous I/O operations on multiple pipe handles.</span></span> <span data-ttu-id="3b975-116">In questo modo un server pipe a thread singolo è in grado di gestire le comunicazioni con più client pipe in modo efficiente.</span><span class="sxs-lookup"><span data-stu-id="3b975-116">This enables a single-threaded pipe server to handle communications with multiple pipe clients efficiently.</span></span> <span data-ttu-id="3b975-117">Per un esempio, vedere [named pipe server con I/O sovrapposti](named-pipe-server-using-overlapped-i-o.md).</span><span class="sxs-lookup"><span data-stu-id="3b975-117">For an example, see [Named Pipe Server Using Overlapped I/O](named-pipe-server-using-overlapped-i-o.md).</span></span>

<span data-ttu-id="3b975-118">Per consentire a un server pipe di utilizzare operazioni sincrone per comunicare con più di un client, è necessario creare un thread distinto per ogni client pipe in modo da poter eseguire uno o più thread mentre altri thread sono in attesa.</span><span class="sxs-lookup"><span data-stu-id="3b975-118">For a pipe server to use synchronous operations to communicate with more than one client, it must create a separate thread for each pipe client so that one or more threads can run while other threads are waiting.</span></span> <span data-ttu-id="3b975-119">Per un esempio di server pipe multithreading che usa operazioni sincrone, vedere [server pipe multithreading](multithreaded-pipe-server.md).</span><span class="sxs-lookup"><span data-stu-id="3b975-119">For an example of a multithreaded pipe server that uses synchronous operations, see [Multithreaded Pipe Server](multithreaded-pipe-server.md).</span></span>

## <a name="enabling-asynchronous-operation"></a><span data-ttu-id="3b975-120">Abilitazione dell'operazione asincrona</span><span class="sxs-lookup"><span data-stu-id="3b975-120">Enabling Asynchronous Operation</span></span>

<span data-ttu-id="3b975-121">Le funzioni [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe)e [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) possono essere eseguite in modo asincrono solo se si Abilita la modalità sovrapposta per l'handle della pipe specificato e si specifica un puntatore valido a una struttura [**sovrapposta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) .</span><span class="sxs-lookup"><span data-stu-id="3b975-121">The [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe), and [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) functions can be performed asynchronously only if you enable overlapped mode for the specified pipe handle and specify a valid pointer to an [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure.</span></span> <span data-ttu-id="3b975-122">Se il puntatore **sovrapposto** è **null**, il valore restituito dalla funzione può indicare erroneamente che l'operazione è stata completata.</span><span class="sxs-lookup"><span data-stu-id="3b975-122">If the **OVERLAPPED** pointer is **NULL**, the function return value can incorrectly indicate that the operation has been completed.</span></span> <span data-ttu-id="3b975-123">Pertanto, è consigliabile che se si crea un handle con il flag di \_ file \_ sovrapposto e si desidera un comportamento asincrono, è sempre necessario specificare una struttura **sovrapposta** valida.</span><span class="sxs-lookup"><span data-stu-id="3b975-123">Therefore, it is strongly recommended that if you create a handle with FILE\_FLAG\_OVERLAPPED and want asynchronous behavior, you should always specify a valid **OVERLAPPED** structure.</span></span>

<span data-ttu-id="3b975-124">Il membro **hEvent** della struttura [**sovrapposta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) specificata deve contenere un handle per un oggetto evento di reimpostazione manuale.</span><span class="sxs-lookup"><span data-stu-id="3b975-124">The **hEvent** member of the specified [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure must contain a handle to a manual-reset event object.</span></span> <span data-ttu-id="3b975-125">Si tratta di un oggetto di sincronizzazione creato dalla funzione [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa) .</span><span class="sxs-lookup"><span data-stu-id="3b975-125">This is a synchronization object created by the [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa) function.</span></span> <span data-ttu-id="3b975-126">Il thread che avvia l'operazione sovrapposta usa l'oggetto evento per determinare il momento in cui l'operazione è stata completata.</span><span class="sxs-lookup"><span data-stu-id="3b975-126">The thread that initiates the overlapped operation uses the event object to determine when the operation has finished.</span></span> <span data-ttu-id="3b975-127">Non è consigliabile usare l'handle di pipe per la sincronizzazione quando si eseguono operazioni simultanee sullo stesso handle perché non esiste alcun modo per sapere quale completamento dell'operazione ha causato la segnalazione dell'handle della pipe.</span><span class="sxs-lookup"><span data-stu-id="3b975-127">You should not use the pipe handle for synchronization when performing simultaneous operations on the same handle because there is no way of knowing which operation's completion caused the pipe handle to be signaled.</span></span> <span data-ttu-id="3b975-128">L'unica tecnica affidabile per l'esecuzione di operazioni simultanee sullo stesso handle di pipe consiste nell'usare una struttura **sovrapposta** separata con il proprio oggetto evento per ogni operazione.</span><span class="sxs-lookup"><span data-stu-id="3b975-128">The only reliable technique for performing simultaneous operations on the same pipe handle is to use a separate **OVERLAPPED** structure with its own event object for each operation.</span></span> <span data-ttu-id="3b975-129">Per ulteriori informazioni sugli oggetti evento, vedere [sincronizzazione](/windows/desktop/Sync/synchronization).</span><span class="sxs-lookup"><span data-stu-id="3b975-129">For more information about event objects, see [Synchronization](/windows/desktop/Sync/synchronization).</span></span>

<span data-ttu-id="3b975-130">Inoltre, è possibile ricevere una notifica quando un'operazione sovrapposta viene completata usando le funzioni [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) o [**GetQueuedCompletionStatusEx**](/windows/desktop/FileIO/getqueuedcompletionstatusex-func) .</span><span class="sxs-lookup"><span data-stu-id="3b975-130">Also, you can be notified when an overlapped operation completes by using the [**GetQueuedCompletionStatus**](/windows/desktop/api/ioapiset/nf-ioapiset-getqueuedcompletionstatus) or [**GetQueuedCompletionStatusEx**](/windows/desktop/FileIO/getqueuedcompletionstatusex-func) functions.</span></span> <span data-ttu-id="3b975-131">In questo caso, non è necessario assegnare l'evento di reimpostazione manuale nella struttura [**sovrapposta**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) e il completamento viene eseguito sull'handle della pipe nello stesso modo di un'operazione di lettura o scrittura asincrona.</span><span class="sxs-lookup"><span data-stu-id="3b975-131">In this case, you do not need to assign the manual-reset event in the [**OVERLAPPED**](/windows/desktop/api/minwinbase/ns-minwinbase-overlapped) structure, and the completion happens against the pipe handle in the same way as an asynchronous read or write operation.</span></span> <span data-ttu-id="3b975-132">Per ulteriori informazioni, vedere [porte di completamento I/O](/windows/desktop/FileIO/i-o-completion-ports).</span><span class="sxs-lookup"><span data-stu-id="3b975-132">For more information, see [I/O Completion Ports](/windows/desktop/FileIO/i-o-completion-ports).</span></span>

<span data-ttu-id="3b975-133">Quando le operazioni [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe)e [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) vengono eseguite in modo asincrono, si verifica una delle condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="3b975-133">When [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile), [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile), [**TransactNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-transactnamedpipe), and [**ConnectNamedPipe**](/windows/win32/api/namedpipeapi/nf-namedpipeapi-connectnamedpipe) operations are performed asynchronously, one of the following occurs:</span></span>

-   <span data-ttu-id="3b975-134">Se l'operazione viene completata quando la funzione restituisce, il valore restituito indica l'esito positivo o negativo dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="3b975-134">If the operation is complete when the function returns, the return value indicates the success or failure of the operation.</span></span> <span data-ttu-id="3b975-135">Se si verifica un errore, il valore restituito è zero e la funzione [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) restituisce un valore diverso da Error \_ io \_ Pending.</span><span class="sxs-lookup"><span data-stu-id="3b975-135">If an error occurs, the return value is zero and the [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) function returns something other than ERROR\_IO\_PENDING.</span></span>
-   <span data-ttu-id="3b975-136">Se l'operazione non è terminata quando la funzione restituisce, il valore restituito è zero e [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) restituisce l'errore \_ io \_ in sospeso.</span><span class="sxs-lookup"><span data-stu-id="3b975-136">If the operation has not finished when the function returns, the return value is zero and [**GetLastError**](/windows/desktop/api/errhandlingapi/nf-errhandlingapi-getlasterror) returns ERROR\_IO\_PENDING.</span></span> <span data-ttu-id="3b975-137">In questo caso, il thread chiamante deve attendere il completamento dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="3b975-137">In this case, the calling thread must wait until the operation has finished.</span></span> <span data-ttu-id="3b975-138">Il thread chiamante deve quindi chiamare la funzione [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) per determinare i risultati.</span><span class="sxs-lookup"><span data-stu-id="3b975-138">The calling thread must then call the [**GetOverlappedResult**](/windows/desktop/api/ioapiset/nf-ioapiset-getoverlappedresult) function to determine the results.</span></span>

## <a name="using-completion-routines"></a><span data-ttu-id="3b975-139">Uso delle routine di completamento</span><span class="sxs-lookup"><span data-stu-id="3b975-139">Using Completion Routines</span></span>

<span data-ttu-id="3b975-140">Le funzioni [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex) e [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) forniscono un'altra forma di i/O sovrapposti.</span><span class="sxs-lookup"><span data-stu-id="3b975-140">The [**ReadFileEx**](/windows/desktop/api/fileapi/nf-fileapi-readfileex) and [**WriteFileEx**](/windows/desktop/api/fileapi/nf-fileapi-writefileex) functions provide another form of overlapped I/O.</span></span> <span data-ttu-id="3b975-141">Diversamente dalle funzioni [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) e [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) sovrapposte, che usano un oggetto evento per segnalare il completamento, le funzioni estese specificano una *routine di completamento*.</span><span class="sxs-lookup"><span data-stu-id="3b975-141">Unlike the overlapped [**ReadFile**](/windows/desktop/api/fileapi/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/fileapi/nf-fileapi-writefile) functions, which use an event object to signal completion, the extended functions specify a *completion routine*.</span></span> <span data-ttu-id="3b975-142">Una routine di completamento è una funzione accodata per l'esecuzione al termine dell'operazione di lettura o scrittura.</span><span class="sxs-lookup"><span data-stu-id="3b975-142">A completion routine is a function that is queued for execution when the read or write operation is finished.</span></span> <span data-ttu-id="3b975-143">La routine di completamento non viene eseguita fino a quando il thread che ha chiamato **ReadFileEx** e **WriteFileEx** avvia un' *operazione di attesa segnalabile* chiamando una delle [funzioni di attesa alertable](/windows/desktop/Sync/wait-functions) con il parametro *fAlertable* impostato su **true**.</span><span class="sxs-lookup"><span data-stu-id="3b975-143">The completion routine is not executed until the thread that called **ReadFileEx** and **WriteFileEx** starts an *alertable wait operation* by calling one of the [alertable wait functions](/windows/desktop/Sync/wait-functions) with the *fAlertable* parameter set to **TRUE**.</span></span> <span data-ttu-id="3b975-144">In un'operazione di attesa di avviso, le funzioni restituiscono anche quando una routine di completamento **ReadFileEx** o **WriteFileEx** viene accodata per l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="3b975-144">In an alertable wait operation, the functions also return when a **ReadFileEx** or **WriteFileEx** completion routine is queued for execution.</span></span> <span data-ttu-id="3b975-145">Un server pipe può utilizzare le funzioni estese per eseguire una sequenza di operazioni di lettura e scrittura per ogni client che si connette a tale server.</span><span class="sxs-lookup"><span data-stu-id="3b975-145">A pipe server can use the extended functions to perform a sequence of read and write operations for each client that connects to it.</span></span> <span data-ttu-id="3b975-146">Ogni operazione di lettura o scrittura nella sequenza specifica una routine di completamento e ogni routine di completamento avvia il passaggio successivo della sequenza.</span><span class="sxs-lookup"><span data-stu-id="3b975-146">Each read or write operation in the sequence specifies a completion routine, and each completion routine initiates the next step in the sequence.</span></span> <span data-ttu-id="3b975-147">Per un esempio, vedere [named pipe server usando le routine di completamento](named-pipe-server-using-completion-routines.md).</span><span class="sxs-lookup"><span data-stu-id="3b975-147">For an example, see [Named Pipe Server Using Completion Routines](named-pipe-server-using-completion-routines.md).</span></span>

 

 
