---
description: Copia e accesso ai dati delle risorse (Direct3D 10)
ms.assetid: 34fd4d15-ee64-4acf-967d-a4afb6f26329
title: Copia e accesso ai dati delle risorse (Direct3D 10)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 38bd075585ee3123e163075a50b06b53a77a214c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103748519"
---
# <a name="copying-and-accessing-resource-data-direct3d-10"></a><span data-ttu-id="eb0fd-103">Copia e accesso ai dati delle risorse (Direct3D 10)</span><span class="sxs-lookup"><span data-stu-id="eb0fd-103">Copying and Accessing Resource Data (Direct3D 10)</span></span>

<span data-ttu-id="eb0fd-104">Non è più necessario considerare le risorse come create nella memoria del video o nella memoria di sistema.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-104">It is no longer necessary to think about resources as being created in either video memory or system memory.</span></span> <span data-ttu-id="eb0fd-105">O se il runtime deve gestire la memoria.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-105">Or whether or not the runtime should manage the memory.</span></span> <span data-ttu-id="eb0fd-106">Grazie all'architettura del nuovo WDDM (Windows Display Driver Model), le applicazioni creano ora risorse Direct3D 10 con flag di [**utilizzo**](/windows/desktop/api/D3D10/ne-d3d10-d3d10_usage) diversi per indicare in che modo l'applicazione intende usare i dati delle risorse.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-106">Thanks to the architecture of the new WDDM (Windows Display Driver Model), applications now create Direct3D 10 resources with different [**usage**](/windows/desktop/api/D3D10/ne-d3d10-d3d10_usage) flags to indicate how the application intends on using the resource data.</span></span> <span data-ttu-id="eb0fd-107">Il nuovo modello di driver virtualizza la memoria usata dalle risorse; quindi diventa la responsabilità del sistema operativo/driver/Memory Manager di posizionare le risorse nell'area di memoria più efficiente possibile in base all'utilizzo previsto.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-107">The new driver model virtualizes the memory used by resources; it then becomes the responsibility of the operating system/driver/memory manager to place resources in the most performant area of memory possible given the expected usage.</span></span>

<span data-ttu-id="eb0fd-108">Il caso predefinito è che le risorse siano disponibili per la GPU.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-108">The default case is for resources to be available to the GPU.</span></span> <span data-ttu-id="eb0fd-109">Ovviamente, in alcuni casi è necessario che i dati delle risorse siano disponibili per la CPU.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-109">Of course, having said that, there are times when the resource data needs to be available to the CPU.</span></span> <span data-ttu-id="eb0fd-110">La copia dei dati delle risorse in modo che il processore appropriato possa accedervi senza conseguenze sulle prestazioni richiede una certa conoscenza del funzionamento dei metodi API.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-110">Copying resource data around so that the appropriate processor can access it without impacting performance requires some knowledge of how the API methods work.</span></span>

-   [<span data-ttu-id="eb0fd-111">Copia dei dati delle risorse</span><span class="sxs-lookup"><span data-stu-id="eb0fd-111">Copying Resource Data</span></span>](#copying-and-accessing-resource-data-direct3d-10)
-   [<span data-ttu-id="eb0fd-112">Accesso ai dati delle risorse</span><span class="sxs-lookup"><span data-stu-id="eb0fd-112">Accessing Resource Data</span></span>](#copying-and-accessing-resource-data-direct3d-10)

## <a name="copying-resource-data"></a><span data-ttu-id="eb0fd-113">Copia dei dati delle risorse</span><span class="sxs-lookup"><span data-stu-id="eb0fd-113">Copying Resource Data</span></span>

<span data-ttu-id="eb0fd-114">Le risorse vengono create in memoria quando Direct3D esegue una chiamata di creazione.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-114">Resources are created in memory when Direct3D executes a Create call.</span></span> <span data-ttu-id="eb0fd-115">Possono essere creati in memoria video, memoria di sistema o qualsiasi altro tipo di memoria.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-115">They can be created in video memory, system memory, or any other kind of memory.</span></span> <span data-ttu-id="eb0fd-116">Poiché il modello di driver WDDM virtualizza questa memoria, le applicazioni non devono più tenere traccia del tipo di risorse di memoria creato in.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-116">Since WDDM driver model virtualizes this memory, applications no longer need to keep track of what kind of memory resources are created in.</span></span>

<span data-ttu-id="eb0fd-117">Idealmente, tutte le risorse si trovano nella memoria video, in modo che la GPU possa avere accesso immediato.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-117">Ideally, all resources would be located in video memory so that the GPU can have immediate access to them.</span></span> <span data-ttu-id="eb0fd-118">Tuttavia, è talvolta necessario che la CPU legga i dati delle risorse o che la GPU acceda ai dati delle risorse in cui la CPU ha scritto.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-118">However, it is sometimes necessary for the CPU to read the resource data or for the GPU to access resource data the CPU has written to.</span></span> <span data-ttu-id="eb0fd-119">Direct3D 10 gestisce questi diversi scenari richiedendo all'applicazione di specificare un utilizzo e quindi offre diversi metodi per la copia dei dati delle risorse, quando necessario.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-119">Direct3D 10 handles these different scenarios by requesting the application specify a usage, and then offers several methods for copying resource data when necessary.</span></span>

<span data-ttu-id="eb0fd-120">A seconda di come è stata creata la risorsa, non è sempre possibile accedere direttamente ai dati sottostanti.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-120">Depending on how the resource was created, it is not always possible to directly access the underlying data.</span></span> <span data-ttu-id="eb0fd-121">Questo può significare che i dati della risorsa devono essere copiati dalla risorsa di origine a un'altra risorsa accessibile dal processore appropriato.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-121">This may mean that the resource data must be copied from the source resource to another resource that is accessible by the appropriate processor.</span></span> <span data-ttu-id="eb0fd-122">In termini di Direct3D 10, è possibile accedere alle risorse predefinite direttamente dalla GPU, le risorse dinamiche e di staging possono accedere direttamente alla CPU.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-122">In terms of Direct3D 10, default resources can be accessed directly by the GPU, dynamic and staging resources can be directly accessed by the CPU.</span></span>

<span data-ttu-id="eb0fd-123">Una volta creata una risorsa, non è possibile modificarne l' [**utilizzo**](/windows/desktop/api/D3D10/ne-d3d10-d3d10_usage) .</span><span class="sxs-lookup"><span data-stu-id="eb0fd-123">Once a resource has been created, its [**usage**](/windows/desktop/api/D3D10/ne-d3d10-d3d10_usage) cannot be changed.</span></span> <span data-ttu-id="eb0fd-124">Copiare invece il contenuto di una risorsa in un'altra risorsa creata con un utilizzo diverso.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-124">Instead, copy the contents of one resource to another resource that was created with a different usage.</span></span> <span data-ttu-id="eb0fd-125">Direct3D 10 offre questa funzionalità con tre metodi diversi.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-125">Direct3D 10 provides this functionality with three different methods.</span></span> <span data-ttu-id="eb0fd-126">I primi due metodi ( [**ID3D10Device:: CopyResource**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copyresource) e [**ID3D10Device:: CopySubresourceRegion**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copysubresourceregion)) sono progettati per copiare i dati delle risorse da una risorsa a un'altra.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-126">The first two methods( [**ID3D10Device::CopyResource**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copyresource) and [**ID3D10Device::CopySubresourceRegion**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copysubresourceregion)) are designed to copy resource data from one resource to another.</span></span> <span data-ttu-id="eb0fd-127">Il terzo metodo ([**ID3D10Device:: UpdateSubresource**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-updatesubresource)) è progettato per copiare i dati dalla memoria a una risorsa.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-127">The third method ([**ID3D10Device::UpdateSubresource**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-updatesubresource)) is designed to copy data from memory to a resource.</span></span>

<span data-ttu-id="eb0fd-128">Esistono due tipi principali di risorse: mappabili e non mappabili.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-128">There are two main kinds of resources: mappable and non-mappable.</span></span> <span data-ttu-id="eb0fd-129">Le risorse create con gli utilizzi dinamici o di gestione temporanea sono mappabili, mentre le risorse create con utilizzi predefiniti o non modificabili non sono mappabili.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-129">Resources created with dynamic or staging usages are mappable, while resources created with default or immutable usages are non-mappable.</span></span>

<span data-ttu-id="eb0fd-130">La copia dei dati tra le risorse non mappabili è molto rapida perché questo è il caso più comune ed è stato ottimizzato per prestazioni ottimali.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-130">Copying data among non-mappable resources is very fast because this is the most common case and has been optimized to perform well.</span></span> <span data-ttu-id="eb0fd-131">Poiché queste risorse non sono direttamente accessibili dalla CPU, sono ottimizzate in modo che la GPU possa manipolarle rapidamente.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-131">Since these resources are not directly accessible by the CPU, they are optimized so that the GPU can manipulate them quickly.</span></span>

<span data-ttu-id="eb0fd-132">La copia dei dati tra le risorse di mappabili è più problematica, perché le prestazioni variano a seconda dell'utilizzo con cui è stata creata la risorsa.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-132">Copying data among mappable resources is more problematic because the performance will depend on the usage the resource was created with.</span></span> <span data-ttu-id="eb0fd-133">La GPU, ad esempio, è in grado di leggere una risorsa dinamica abbastanza rapidamente, ma non di scrivervi, e la GPU non è in grado di leggere o scrivere direttamente nelle risorse di staging.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-133">For example, the GPU can read a dynamic resource fairly quickly but cannot write to them, and the GPU cannot read or write to staging resources directly.</span></span>

<span data-ttu-id="eb0fd-134">Le applicazioni che desiderano copiare i dati da una risorsa con utilizzo predefinito a una risorsa con utilizzo di gestione temporanea (per consentire alla CPU di leggere i dati, ad esempio il problema readback GPU), devono eseguire questa operazione con cautela.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-134">Applications that wish to copy data from a resource with default usage to a resource with staging usage (to allow the CPU to read the data -- i.e. the GPU readback problem) must do so with care.</span></span> <span data-ttu-id="eb0fd-135">Per ulteriori informazioni sull'ultimo caso, vedere [accesso ai dati delle risorse](#copying-and-accessing-resource-data-direct3d-10) .</span><span class="sxs-lookup"><span data-stu-id="eb0fd-135">See [Accessing Resource Data](#copying-and-accessing-resource-data-direct3d-10) for more details on this last case.</span></span>

## <a name="accessing-resource-data"></a><span data-ttu-id="eb0fd-136">Accesso ai dati delle risorse</span><span class="sxs-lookup"><span data-stu-id="eb0fd-136">Accessing Resource Data</span></span>

<span data-ttu-id="eb0fd-137">Per accedere a una risorsa, è necessario mappare la risorsa; il mapping significa essenzialmente che l'applicazione sta tentando di concedere alla CPU l'accesso alla memoria.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-137">Accessing a resource requires mapping the resource; mapping essentially means the application is trying to give the CPU access to memory.</span></span> <span data-ttu-id="eb0fd-138">Il processo di mapping di una risorsa in modo che la CPU possa accedere alla memoria sottostante può causare alcuni colli di bottiglia delle prestazioni e per questo motivo è necessario prestare attenzione a come e quando eseguire questa attività.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-138">The process of mapping a resource so that the CPU can access the underlying memory can cause some performance bottlenecks and for this reason, care must be taken as to how and when to perform this task.</span></span>

<span data-ttu-id="eb0fd-139">Se l'applicazione tenta di eseguire il mapping di una risorsa in un momento errato, le prestazioni possono essere interrotte.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-139">Performance can grind to a halt if the application tries to map a resource at the wrong time.</span></span> <span data-ttu-id="eb0fd-140">Se l'applicazione tenta di accedere ai risultati di un'operazione prima del completamento dell'operazione, si verificherà un blocco della pipeline.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-140">If the application tries to access the results of an operation before that operation is finished, a pipeline stall will occur.</span></span>

<span data-ttu-id="eb0fd-141">L'esecuzione di un'operazione di mapping in un momento errato potrebbe causare un calo grave delle prestazioni forzando la sincronizzazione della GPU e della CPU.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-141">Performing a map operation at the wrong time could potentially cause a severe drop in performance by forcing the GPU and the CPU to synchronize with each other.</span></span> <span data-ttu-id="eb0fd-142">Questa sincronizzazione si verificherà se l'applicazione vuole accedere a una risorsa prima che la GPU venga completata la copia in una risorsa di cui è possibile eseguire il mapping della CPU.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-142">This synchronization will occur if the application wants to access a resource before the GPU is finished copying it into a resource the CPU can map.</span></span>

<span data-ttu-id="eb0fd-143">La CPU può leggere solo da risorse create con il \_ flag di gestione temporanea dell'utilizzo di D3D10 \_ .</span><span class="sxs-lookup"><span data-stu-id="eb0fd-143">The CPU can only read from resources created with the D3D10\_USAGE\_STAGING flag.</span></span> <span data-ttu-id="eb0fd-144">Poiché le risorse create con questo flag non possono essere impostate come output della pipeline, se la CPU vuole leggere i dati in una risorsa generata dalla GPU, i dati devono essere copiati in una risorsa creata con il flag di gestione temporanea.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-144">Since resources created with this flag cannot be set as outputs of the pipeline, if the CPU wants to read the data in a resource generated by the GPU, the data must be copied to a resource created with the staging flag.</span></span> <span data-ttu-id="eb0fd-145">L'applicazione può eseguire questa operazione usando i metodi [**ID3D10Device:: CopyResource**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copyresource) o [**ID3D10Device:: CopySubresourceRegion**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copysubresourceregion) per copiare il contenuto di una risorsa in un'altra.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-145">The application may do this by using the [**ID3D10Device::CopyResource**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copyresource) or [**ID3D10Device::CopySubresourceRegion**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copysubresourceregion) methods to copy the contents of one resource to another.</span></span> <span data-ttu-id="eb0fd-146">L'applicazione può quindi ottenere l'accesso a questa risorsa chiamando il metodo map appropriato.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-146">The application can then gain access to this resource by calling the appropriate Map method.</span></span> <span data-ttu-id="eb0fd-147">Quando l'accesso alla risorsa non è più necessario, l'applicazione deve chiamare il metodo annullare corrispondente.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-147">When access to the resource is no longer needed, the application should then call the corresponding Unmap method.</span></span> <span data-ttu-id="eb0fd-148">Ad esempio, [**ID3D10Texture2D:: Map**](/windows/desktop/api/D3D10/nf-d3d10-id3d10texture2d-map) e [**ID3D10Texture2D:: annullare**](/windows/desktop/api/D3D10/nf-d3d10-id3d10texture2d-unmap).</span><span class="sxs-lookup"><span data-stu-id="eb0fd-148">For example, [**ID3D10Texture2D::Map**](/windows/desktop/api/D3D10/nf-d3d10-id3d10texture2d-map) and [**ID3D10Texture2D::Unmap**](/windows/desktop/api/D3D10/nf-d3d10-id3d10texture2d-unmap).</span></span> <span data-ttu-id="eb0fd-149">I diversi metodi della mappa restituiscono alcuni valori specifici a seconda dei flag di input.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-149">The different Map methods return some specific values depending on the input flags.</span></span> <span data-ttu-id="eb0fd-150">Per informazioni dettagliate, vedere la [**sezione Note sulla mappa**](/windows/desktop/api/D3D10/nf-d3d10-id3d10texture1d-map) .</span><span class="sxs-lookup"><span data-stu-id="eb0fd-150">See [**Map Remarks section**](/windows/desktop/api/D3D10/nf-d3d10-id3d10texture1d-map) for details.</span></span>

> [!Note]  
> <span data-ttu-id="eb0fd-151">Quando l'applicazione chiama il metodo map, riceve un puntatore ai dati della risorsa a cui accedere.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-151">When the application calls the Map method, it receives a pointer to the resource data to access.</span></span> <span data-ttu-id="eb0fd-152">Il runtime garantisce che il puntatore abbia un allineamento specifico, a seconda del [livello di funzionalità](../direct3d11/overviews-direct3d-11-devices-downlevel-intro.md).</span><span class="sxs-lookup"><span data-stu-id="eb0fd-152">The runtime ensures that the pointer has a specific alignment, depending on [feature level](../direct3d11/overviews-direct3d-11-devices-downlevel-intro.md).</span></span> <span data-ttu-id="eb0fd-153">Per [**il \_ livello di funzionalità D3D \_ \_ 10 \_ 0**](/windows/win32/api/d3dcommon/ne-d3dcommon-d3d_feature_level) e superiore, il puntatore è allineato a 16 byte.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-153">For [**D3D\_FEATURE\_LEVEL\_10\_0**](/windows/win32/api/d3dcommon/ne-d3dcommon-d3d_feature_level) and higher, the pointer is aligned to 16 bytes.</span></span> <span data-ttu-id="eb0fd-154">Per un livello di funzionalità inferiore a quello di [**D3D \_ \_ \_ 10 \_ 0**](/windows/win32/api/d3dcommon/ne-d3dcommon-d3d_feature_level), il puntatore è allineato a 4 byte.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-154">For lower than [**D3D\_FEATURE\_LEVEL\_10\_0**](/windows/win32/api/d3dcommon/ne-d3dcommon-d3d_feature_level), the pointer is aligned to 4 bytes.</span></span> <span data-ttu-id="eb0fd-155">L'allineamento a 16 byte consente all'applicazione di eseguire operazioni ottimizzate per [SSE](/previous-versions/visualstudio/visual-studio-2010/t467de55(v=vs.100))sui dati in modo nativo, senza riallineamento o copia.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-155">The 16-byte alignment allows the application to perform [SSE](/previous-versions/visualstudio/visual-studio-2010/t467de55(v=vs.100))-optimized operations on the data natively, without realignment or copy.</span></span>

 

### <a name="performance-considerations"></a><span data-ttu-id="eb0fd-156">Considerazioni sulle prestazioni</span><span class="sxs-lookup"><span data-stu-id="eb0fd-156">Performance Considerations</span></span>

<span data-ttu-id="eb0fd-157">È consigliabile considerare un PC come un computer in esecuzione come un'architettura parallela con due tipi principali di processori: uno o più CPU e una o più GPU.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-157">It is best to think of a PC as a machine running as a parallel architecture with two main types of processors: one or more CPU's and one or more GPU's.</span></span> <span data-ttu-id="eb0fd-158">Come in qualsiasi architettura parallela, si ottengono le migliori prestazioni quando ogni processore è pianificato con un numero sufficiente di attività per impedirne l'inattività e quando il lavoro di un processore non è in attesa di un altro processore.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-158">As in any parallel architecture, the best performance is achieved when each processor is scheduled with enough tasks to prevent it from going idle and when the work of one processor is not waiting on the work of another.</span></span>

<span data-ttu-id="eb0fd-159">Lo scenario peggiore per il parallelismo GPU/CPU è la necessità di forzare un processore ad attendere i risultati del lavoro eseguito da un altro.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-159">The worst-case scenario for GPU/CPU parallelism is the need to force one processor to wait for the results of work done by another.</span></span> <span data-ttu-id="eb0fd-160">Direct3D 10 tenta di rimuovere questo costo rendendo asincrono i metodi [**ID3D10Device:: CopyResource**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copyresource) e [**ID3D10Device:: CopySubresourceRegion**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copysubresourceregion) ; la copia non è stata necessariamente eseguita nel momento in cui il metodo restituisce.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-160">Direct3D 10 tries to remove this cost by making the [**ID3D10Device::CopyResource**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copyresource) and [**ID3D10Device::CopySubresourceRegion**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copysubresourceregion) methods asynchronous; the copy has not necessarily executed by the time the method returns.</span></span> <span data-ttu-id="eb0fd-161">Il vantaggio è che l'applicazione non paga il costo delle prestazioni di copia effettiva dei dati fino a quando la CPU non accede ai dati, ovvero quando viene chiamata la mappa.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-161">The benefit of this is that the application does not pay the performance cost of actually copying the data until the CPU accesses the data, which is when Map is called.</span></span> <span data-ttu-id="eb0fd-162">Se il metodo map viene chiamato dopo che i dati sono stati effettivamente copiati, non si verificherà alcuna perdita di prestazioni.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-162">If the Map method is called after the data has actually been copied, no performance loss occurs.</span></span> <span data-ttu-id="eb0fd-163">D'altra parte, se viene chiamato il metodo map prima che i dati vengano copiati, si verificherà uno stallo della pipeline.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-163">On the other hand, if the Map method is called before the data has been copied, then a pipeline stall will occur.</span></span>

<span data-ttu-id="eb0fd-164">Le chiamate asincrone in Direct3D 10, ovvero la maggior parte dei metodi e in particolare le chiamate di rendering, vengono archiviate in ciò che viene definito buffer dei comandi.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-164">Asynchronous calls in Direct3D 10 (which are the vast majority of methods, and especially rendering calls) are stored in what is called a command buffer.</span></span> <span data-ttu-id="eb0fd-165">Questo buffer è interno al driver della grafica e viene usato per eseguire il batch delle chiamate all'hardware sottostante, in modo che il costo del passaggio dalla modalità utente alla modalità kernel in Microsoft Windows avvenga il più raramente possibile.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-165">This buffer is internal to the graphics driver and is used to batch calls to the underlying hardware so that the costly switch from user mode to kernel mode in Microsoft Windows occurs as rarely as possible.</span></span>

<span data-ttu-id="eb0fd-166">Il buffer dei comandi viene scaricato, causando un cambio di modalità utente/kernel, in una delle quattro situazioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-166">The command buffer is flushed, thus causing a user/kernel mode switch, in one of four situations, which are as follows.</span></span>

1.  <span data-ttu-id="eb0fd-167">[**Present**](/windows/win32/api/dxgi/nf-dxgi-idxgiswapchain-present) viene chiamato.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-167">[**Present**](/windows/win32/api/dxgi/nf-dxgi-idxgiswapchain-present) is called.</span></span>
2.  <span data-ttu-id="eb0fd-168">Viene chiamato [**ID3D10Device:: Flush**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-flush) .</span><span class="sxs-lookup"><span data-stu-id="eb0fd-168">[**ID3D10Device::Flush**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-flush) is called.</span></span>
3.  <span data-ttu-id="eb0fd-169">Il buffer dei comandi è pieno. le sue dimensioni sono dinamiche e sono controllate dal sistema operativo e dal driver della grafica.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-169">The command buffer is full; its size is dynamic and is controlled by the Operating System and the graphics driver.</span></span>
4.  <span data-ttu-id="eb0fd-170">La CPU richiede l'accesso ai risultati di un comando in attesa di esecuzione nel buffer dei comandi.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-170">The CPU requires access to the results of a command waiting to execute in the command buffer.</span></span>

<span data-ttu-id="eb0fd-171">Tra le quattro situazioni precedenti, il numero quattro è la più critica per le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-171">Of the four situations above, number four is the most critical to performance.</span></span> <span data-ttu-id="eb0fd-172">Se l'applicazione rilascia una chiamata [**ID3D10Device:: CopyResource**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copyresource) o [**ID3D10Device:: CopySubresourceRegion**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copysubresourceregion) , questa chiamata viene accodata nel buffer dei comandi.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-172">If the application issues a [**ID3D10Device::CopyResource**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copyresource) or [**ID3D10Device::CopySubresourceRegion**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copysubresourceregion) call, this call is queued in the command buffer.</span></span> <span data-ttu-id="eb0fd-173">Se l'applicazione tenta quindi di eseguire il mapping della risorsa di gestione temporanea che era la destinazione della chiamata di copia prima che il buffer del comando venisse scaricato, si verificherà uno stallo della pipeline perché non solo la chiamata al metodo di copia deve essere eseguita, ma anche tutti gli altri comandi memorizzati nel buffer nel buffer dei comandi.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-173">If the application then tries to map the staging resource that was the target of the copy call before the command buffer has been flushed, a pipeline stall will occur because not only does the Copy method call need to execute, but all other buffered commands in the command buffer must execute as well.</span></span> <span data-ttu-id="eb0fd-174">Questa operazione causerà la sincronizzazione della GPU e della CPU, perché la CPU sarà in attesa di accedere alla risorsa di staging mentre la GPU svuoterà il buffer dei comandi e riempirà infine la risorsa necessaria per la CPU.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-174">This will cause the GPU and CPU to synchronize because the CPU will be waiting to access the staging resource while the GPU is emptying the command buffer and finally filling the resource the CPU needs.</span></span> <span data-ttu-id="eb0fd-175">Al termine della copia, la CPU inizierà ad accedere alla risorsa di staging, ma durante questo periodo la GPU resterà inattiva.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-175">Once the GPU finishes the copy, the CPU will begin accessing the staging resource, but during this time, the GPU will be sitting idle.</span></span>

<span data-ttu-id="eb0fd-176">Questa operazione di frequente in fase di esecuzione provocherà un grave peggioramento delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-176">Doing this frequently at runtime will severely degrade performance.</span></span> <span data-ttu-id="eb0fd-177">Per questo motivo, il mapping delle risorse create con l'utilizzo predefinito dovrebbe essere eseguito con cautela.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-177">For that reason, mapping of resources created with default usage should be done with care.</span></span> <span data-ttu-id="eb0fd-178">L'applicazione deve attendere il tempo sufficiente per il svuotamento del buffer dei comandi e quindi completare l'esecuzione di tutti i comandi prima di provare a eseguire il mapping della risorsa di gestione temporanea corrispondente.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-178">The application needs to wait long enough for the command buffer to be emptied and thus have all of those commands finish executing before it tries to map the corresponding staging resource.</span></span> <span data-ttu-id="eb0fd-179">Per quanto tempo l'applicazione deve attendere?</span><span class="sxs-lookup"><span data-stu-id="eb0fd-179">How long should the application wait?</span></span> <span data-ttu-id="eb0fd-180">Almeno due frame, in quanto ciò consentirà di sfruttare al massimo il parallelismo tra CPU e GPU.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-180">At least two frames because this will enable parallelism between the CPU(s) and the GPU to be maximally leveraged.</span></span> <span data-ttu-id="eb0fd-181">Il funzionamento della GPU è che, mentre l'applicazione elabora il frame N inviando chiamate al buffer dei comandi, la GPU è occupata nell'esecuzione delle chiamate dal frame precedente, N-1.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-181">The way the GPU works is that while the application is processing frame N by submitting calls to the command buffer, the GPU is busy executing the calls from the previous frame, N-1.</span></span>

<span data-ttu-id="eb0fd-182">Quindi, se un'applicazione vuole eseguire il mapping di una risorsa che ha origine nella memoria video e chiama [**ID3D10Device:: CopyResource**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copyresource) o [**ID3D10Device:: CopySubresourceRegion**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copysubresourceregion) al frame n, questa chiamata inizierà a essere eseguita al frame n + 1, quando l'applicazione invia chiamate per il frame successivo.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-182">So if an application wants to map a resource that originates in video memory and calls [**ID3D10Device::CopyResource**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copyresource) or [**ID3D10Device::CopySubresourceRegion**](/windows/desktop/api/D3D10/nf-d3d10-id3d10device-copysubresourceregion) at frame N, this call will actually begin to execute at frame N+1, when the application is submitting calls for the next frame.</span></span> <span data-ttu-id="eb0fd-183">La copia deve essere completata quando l'applicazione sta elaborando il frame N + 2.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-183">The copy should be finished when the application is processing frame N+2.</span></span>



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="eb0fd-184">Frame</span><span class="sxs-lookup"><span data-stu-id="eb0fd-184">Frame</span></span></th>
<th><span data-ttu-id="eb0fd-185">Stato GPU/CPU</span><span class="sxs-lookup"><span data-stu-id="eb0fd-185">GPU/CPU Status</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="eb0fd-186">N</span><span class="sxs-lookup"><span data-stu-id="eb0fd-186">N</span></span></td>
<td><ul>
<li><span data-ttu-id="eb0fd-187">I problemi di CPU eseguono il rendering delle chiamate per il frame corrente.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-187">CPU issues render calls for current frame.</span></span></li>
</ul></td>
</tr>
<tr class="even">
<td><span data-ttu-id="eb0fd-188">N + 1</span><span class="sxs-lookup"><span data-stu-id="eb0fd-188">N+1</span></span></td>
<td><ul>
<li><span data-ttu-id="eb0fd-189">GPU che eseguono chiamate inviate dalla CPU durante il frame N.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-189">GPU executing calls sent from CPU during frame N.</span></span></li>
<li><span data-ttu-id="eb0fd-190">I problemi di CPU eseguono il rendering delle chiamate per il frame corrente.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-190">CPU issues render calls for current frame.</span></span></li>
</ul></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="eb0fd-191">N + 2</span><span class="sxs-lookup"><span data-stu-id="eb0fd-191">N+2</span></span></td>
<td><ul>
<li><span data-ttu-id="eb0fd-192">La GPU ha terminato l'esecuzione delle chiamate inviate dalla CPU durante il frame N. risultati pronti.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-192">GPU finished executing calls sent from CPU during frame N. Results ready.</span></span></li>
<li><span data-ttu-id="eb0fd-193">Esecuzione di chiamate GPU inviate dalla CPU durante il frame N + 1.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-193">GPU executing calls sent from CPU during frame N+1.</span></span></li>
<li><span data-ttu-id="eb0fd-194">I problemi di CPU eseguono il rendering delle chiamate per il frame corrente.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-194">CPU issues render calls for current frame.</span></span></li>
</ul></td>
</tr>
<tr class="even">
<td><span data-ttu-id="eb0fd-195">N + 3</span><span class="sxs-lookup"><span data-stu-id="eb0fd-195">N+3</span></span></td>
<td><ul>
<li><span data-ttu-id="eb0fd-196">La GPU ha terminato l'esecuzione delle chiamate inviate dalla CPU durante il frame N + 1.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-196">GPU finished executing calls sent from CPU during frame N+1.</span></span> <span data-ttu-id="eb0fd-197">Risultati pronti.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-197">Results ready.</span></span></li>
<li><span data-ttu-id="eb0fd-198">GPU che eseguono chiamate inviate dalla CPU durante il frame N + 2.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-198">GPU executing calls sent from CPU during frame N+2.</span></span></li>
<li><span data-ttu-id="eb0fd-199">I problemi di CPU eseguono il rendering delle chiamate per il frame corrente.</span><span class="sxs-lookup"><span data-stu-id="eb0fd-199">CPU issues render calls for current frame.</span></span></li>
</ul></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="eb0fd-200">N + 4</span><span class="sxs-lookup"><span data-stu-id="eb0fd-200">N+4</span></span></td>
<td><span data-ttu-id="eb0fd-201">...</span><span class="sxs-lookup"><span data-stu-id="eb0fd-201">...</span></span></td>
</tr>
</tbody>
</table>



 

## <a name="related-topics"></a><span data-ttu-id="eb0fd-202">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="eb0fd-202">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="eb0fd-203">Risorse (Direct3D 10)</span><span class="sxs-lookup"><span data-stu-id="eb0fd-203">Resources (Direct3D 10)</span></span>](d3d10-graphics-programming-guide-resources.md)
</dt> </dl>

 

 
