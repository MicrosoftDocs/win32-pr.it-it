---
description: Ogni processo dispone di un heap predefinito fornito dal sistema. Le applicazioni che effettuano allocazioni frequenti dall'heap possono migliorare le prestazioni usando gli heap privati.
ms.assetid: cfb683fa-4f46-48b5-9a28-f4625a9cb8cd
title: Funzioni heap
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d0e591c1e349ed6806cbebe00a178a99e63bb412
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103881505"
---
# <a name="heap-functions"></a><span data-ttu-id="29226-104">Funzioni heap</span><span class="sxs-lookup"><span data-stu-id="29226-104">Heap Functions</span></span>

<span data-ttu-id="29226-105">Ogni processo dispone di un heap predefinito fornito dal sistema.</span><span class="sxs-lookup"><span data-stu-id="29226-105">Each process has a default heap provided by the system.</span></span> <span data-ttu-id="29226-106">Le applicazioni che effettuano allocazioni frequenti dall'heap possono migliorare le prestazioni usando gli heap privati.</span><span class="sxs-lookup"><span data-stu-id="29226-106">Applications that make frequent allocations from the heap can improve performance by using private heaps.</span></span>

<span data-ttu-id="29226-107">Un heap privato è un blocco di una o più pagine nello spazio degli indirizzi del processo chiamante.</span><span class="sxs-lookup"><span data-stu-id="29226-107">A private heap is a block of one or more pages in the address space of the calling process.</span></span> <span data-ttu-id="29226-108">Dopo aver creato l'heap privato, il processo utilizza funzioni quali [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) e [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree) per gestire la memoria nell'heap.</span><span class="sxs-lookup"><span data-stu-id="29226-108">After creating the private heap, the process uses functions such as [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) and [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree) to manage the memory in that heap.</span></span>

<span data-ttu-id="29226-109">Le funzioni heap possono anche essere usate per gestire la memoria nell'heap predefinito del processo, usando l'handle restituito dalla funzione [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) .</span><span class="sxs-lookup"><span data-stu-id="29226-109">The heap functions can also be used to manage memory in the process's default heap, using the handle returned by the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) function.</span></span> <span data-ttu-id="29226-110">Per questo scopo, le nuove applicazioni devono usare le funzioni heap anziché le [funzioni globali e locali](global-and-local-functions.md) .</span><span class="sxs-lookup"><span data-stu-id="29226-110">New applications should use the heap functions instead of the [global and local functions](global-and-local-functions.md) for this purpose.</span></span>

<span data-ttu-id="29226-111">Non esiste alcuna differenza tra la memoria allocata da un heap privato e quella allocata usando le altre funzioni di allocazione della memoria.</span><span class="sxs-lookup"><span data-stu-id="29226-111">There is no difference between memory allocated from a private heap and that allocated by using the other memory allocation functions.</span></span> <span data-ttu-id="29226-112">Per un elenco completo delle funzioni, vedere la tabella nelle [funzioni di gestione della memoria](memory-management-functions.md).</span><span class="sxs-lookup"><span data-stu-id="29226-112">For a complete list of functions, see the table in [Memory Management Functions](memory-management-functions.md).</span></span>

> [!Note]  
> <span data-ttu-id="29226-113">Un thread deve chiamare le funzioni dell'heap solo per l'heap predefinito del processo e per gli heap privati che il thread crea e gestisce, usando gli handle restituiti dalla funzione [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) o [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) .</span><span class="sxs-lookup"><span data-stu-id="29226-113">A thread should call heap functions only for the process's default heap and private heaps that the thread creates and manages, using handles returned by the [**GetProcessHeap**](/windows/desktop/api/HeapApi/nf-heapapi-getprocessheap) or [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function.</span></span>

 

<span data-ttu-id="29226-114">La funzione [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) crea un oggetto heap privato dal quale il processo chiamante può allocare blocchi di memoria tramite la funzione [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) .</span><span class="sxs-lookup"><span data-stu-id="29226-114">The [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function creates a private heap object from which the calling process can allocate memory blocks by using the [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) function.</span></span> <span data-ttu-id="29226-115">**HeapCreate** specifica una dimensione iniziale e una dimensione massima per l'heap.</span><span class="sxs-lookup"><span data-stu-id="29226-115">**HeapCreate** specifies both an initial size and a maximum size for the heap.</span></span> <span data-ttu-id="29226-116">La dimensione iniziale determina il numero di pagine di cui è stato eseguito il commit, di lettura/scrittura inizialmente allocate per l'heap.</span><span class="sxs-lookup"><span data-stu-id="29226-116">The initial size determines the number of committed, read/write pages initially allocated for the heap.</span></span> <span data-ttu-id="29226-117">La dimensione massima determina il numero totale di pagine riservate.</span><span class="sxs-lookup"><span data-stu-id="29226-117">The maximum size determines the total number of reserved pages.</span></span> <span data-ttu-id="29226-118">Queste pagine creano un blocco contiguo nello spazio degli indirizzi virtuali di un processo in cui l'heap può aumentare.</span><span class="sxs-lookup"><span data-stu-id="29226-118">These pages create a contiguous block in the virtual address space of a process into which the heap can grow.</span></span> <span data-ttu-id="29226-119">Le pagine aggiuntive vengono sottoposte automaticamente a commit da questo spazio riservato se le richieste da **HeapAlloc** superano le dimensioni correnti delle pagine di cui è stato eseguito il commit, supponendo che sia disponibile l'archiviazione fisica.</span><span class="sxs-lookup"><span data-stu-id="29226-119">Additional pages are automatically committed from this reserved space if requests by **HeapAlloc** exceed the current size of committed pages, assuming that the physical storage for it is available.</span></span> <span data-ttu-id="29226-120">Una volta eseguito il commit, le pagine non vengono sottoposte a commit finché il processo non viene terminato o fino a quando l'heap non viene eliminato definitivamente chiamando la funzione [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) .</span><span class="sxs-lookup"><span data-stu-id="29226-120">Once the pages are committed, they are not decommitted until the process is terminated or until the heap is destroyed by calling the [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) function.</span></span>

<span data-ttu-id="29226-121">La memoria di un oggetto heap privato è accessibile solo al processo che lo ha creato.</span><span class="sxs-lookup"><span data-stu-id="29226-121">The memory of a private heap object is accessible only to the process that created it.</span></span> <span data-ttu-id="29226-122">Se una libreria a collegamento dinamico (DLL) crea un heap privato, lo esegue nello spazio degli indirizzi del processo che ha chiamato la DLL.</span><span class="sxs-lookup"><span data-stu-id="29226-122">If a dynamic-link library (DLL) creates a private heap, it does so in the address space of the process that called the DLL.</span></span> <span data-ttu-id="29226-123">È accessibile solo a tale processo.</span><span class="sxs-lookup"><span data-stu-id="29226-123">It is accessible only to that process.</span></span>

<span data-ttu-id="29226-124">La funzione [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) alloca un numero specificato di byte da un heap privato e restituisce un puntatore al blocco allocato.</span><span class="sxs-lookup"><span data-stu-id="29226-124">The [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) function allocates a specified number of bytes from a private heap and returns a pointer to the allocated block.</span></span> <span data-ttu-id="29226-125">Questo puntatore può essere utilizzato nelle funzioni [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree), [**HeapReAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heaprealloc), [**HEAPSIZE**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)e [**HeapValidate**](/windows/desktop/api/HeapApi/nf-heapapi-heapvalidate) .</span><span class="sxs-lookup"><span data-stu-id="29226-125">This pointer can be used in the [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree), [**HeapReAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heaprealloc), [**HeapSize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize), and [**HeapValidate**](/windows/desktop/api/HeapApi/nf-heapapi-heapvalidate) functions.</span></span>

<span data-ttu-id="29226-126">La memoria allocata da [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) non è movibile.</span><span class="sxs-lookup"><span data-stu-id="29226-126">Memory allocated by [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) is not movable.</span></span> <span data-ttu-id="29226-127">L'indirizzo restituito da **HeapAlloc** è valido finché il blocco di memoria non viene liberato o riallocato; non è necessario bloccare il blocco di memoria.</span><span class="sxs-lookup"><span data-stu-id="29226-127">The address returned by **HeapAlloc** is valid until the memory block is freed or reallocated; the memory block does not need to be locked.</span></span>

<span data-ttu-id="29226-128">Poiché il sistema non può comprimere un heap privato, può diventare frammentato.</span><span class="sxs-lookup"><span data-stu-id="29226-128">Because the system cannot compact a private heap, it can become fragmented.</span></span> <span data-ttu-id="29226-129">Le applicazioni che allocano grandi quantità di memoria in diverse dimensioni di allocazione possono utilizzare l' [heap a frammentazione ridotta](low-fragmentation-heap.md) per ridurre la frammentazione dell'heap.</span><span class="sxs-lookup"><span data-stu-id="29226-129">Applications that allocate large amounts of memory in various allocation sizes can use the [low-fragmentation heap](low-fragmentation-heap.md) to reduce heap fragmentation.</span></span>

<span data-ttu-id="29226-130">Un possibile utilizzo delle funzioni heap consiste nel creare un heap privato all'avvio di un processo, specificando una dimensione iniziale sufficiente per soddisfare i requisiti di memoria del processo.</span><span class="sxs-lookup"><span data-stu-id="29226-130">A possible use for the heap functions is to create a private heap when a process starts up, specifying an initial size sufficient to satisfy the memory requirements of the process.</span></span> <span data-ttu-id="29226-131">Se la chiamata alla funzione [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) ha esito negativo, il processo può terminare o notificare all'utente la carenza di memoria; Se ha esito positivo, tuttavia, il processo è sicuro di avere la memoria necessaria.</span><span class="sxs-lookup"><span data-stu-id="29226-131">If the call to the [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) function fails, the process can terminate or notify the user of the memory shortage; if it succeeds, however, the process is assured of having the memory it needs.</span></span>

<span data-ttu-id="29226-132">La memoria richiesta da [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) può essere o meno contigua.</span><span class="sxs-lookup"><span data-stu-id="29226-132">Memory requested by [**HeapCreate**](/windows/desktop/api/HeapApi/nf-heapapi-heapcreate) may or may not be contiguous.</span></span> <span data-ttu-id="29226-133">La memoria allocata in un heap da [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) è contigua.</span><span class="sxs-lookup"><span data-stu-id="29226-133">Memory allocated within a heap by [**HeapAlloc**](/windows/desktop/api/HeapApi/nf-heapapi-heapalloc) is contiguous.</span></span> <span data-ttu-id="29226-134">Non è consigliabile scrivere o leggere dalla memoria in un heap, ad eccezione di quanto allocato da **HeapAlloc**, né considerare alcuna relazione tra due aree di memoria allocate da **HeapAlloc**.</span><span class="sxs-lookup"><span data-stu-id="29226-134">You should not write to or read from memory in a heap except that allocated by **HeapAlloc**, nor should you assume any relationship between two areas of memory allocated by **HeapAlloc**.</span></span>

<span data-ttu-id="29226-135">Non è consigliabile fare riferimento a memoria che è stata liberata da [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree).</span><span class="sxs-lookup"><span data-stu-id="29226-135">You should not refer in any way to memory that has been freed by [**HeapFree**](/windows/desktop/api/HeapApi/nf-heapapi-heapfree).</span></span> <span data-ttu-id="29226-136">Dopo che la memoria è stata liberata, tutte le informazioni che potrebbero essere state rilasciate sono finite.</span><span class="sxs-lookup"><span data-stu-id="29226-136">After the memory is freed, any information that may have been in it is gone forever.</span></span> <span data-ttu-id="29226-137">Se sono necessarie informazioni, non liberare memoria contenente le informazioni.</span><span class="sxs-lookup"><span data-stu-id="29226-137">If you require information, do not free memory containing the information.</span></span> <span data-ttu-id="29226-138">Le chiamate di funzione che restituiscono informazioni sulla memoria (ad esempio [**HEAPSIZE**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)) non possono essere utilizzate con la memoria liberata, perché potrebbero restituire dati fasulli.</span><span class="sxs-lookup"><span data-stu-id="29226-138">Function calls that return information about memory (such as [**HeapSize**](/windows/desktop/api/HeapApi/nf-heapapi-heapsize)) may not be used with freed memory, as they may return bogus data.</span></span>

<span data-ttu-id="29226-139">La funzione [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) Elimina un oggetto heap privato.</span><span class="sxs-lookup"><span data-stu-id="29226-139">The [**HeapDestroy**](/windows/desktop/api/HeapApi/nf-heapapi-heapdestroy) function destroys a private heap object.</span></span> <span data-ttu-id="29226-140">Annulla il commit e rilascia tutte le pagine dell'oggetto heap e invalida l'handle per l'heap.</span><span class="sxs-lookup"><span data-stu-id="29226-140">It decommits and releases all the pages of the heap object, and it invalidates the handle to the heap.</span></span>

## <a name="related-topics"></a><span data-ttu-id="29226-141">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="29226-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="29226-142">Confronto tra i metodi di allocazione della memoria</span><span class="sxs-lookup"><span data-stu-id="29226-142">Comparing Memory Allocation Methods</span></span>](comparing-memory-allocation-methods.md)
</dt> </dl>

 

 



