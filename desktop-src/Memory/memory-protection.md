---
description: La memoria che appartiene a un processo è protetta in modo implicito dallo spazio degli indirizzi virtuali privato.
ms.assetid: 70ded07a-7be6-4189-a1ae-281917f42a1e
title: Protezione della memoria
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bd30df8084c91a62c28414f4a8142397ee777e52
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "104132035"
---
# <a name="memory-protection"></a><span data-ttu-id="fa8b3-103">Protezione della memoria</span><span class="sxs-lookup"><span data-stu-id="fa8b3-103">Memory Protection</span></span>

<span data-ttu-id="fa8b3-104">La memoria che appartiene a un processo è protetta in modo implicito dallo spazio degli indirizzi virtuali privato.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-104">Memory that belongs to a process is implicitly protected by its private virtual address space.</span></span> <span data-ttu-id="fa8b3-105">Windows garantisce inoltre la protezione della memoria utilizzando l'hardware della memoria virtuale.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-105">In addition, Windows provides memory protection by using the virtual memory hardware.</span></span> <span data-ttu-id="fa8b3-106">L'implementazione di questa protezione varia a seconda del processore. ad esempio, le tabelle codici nello spazio degli indirizzi di un processo possono essere contrassegnate come di sola lettura e protette da modifiche da parte dei thread in modalità utente.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-106">The implementation of this protection varies with the processor, for example, code pages in the address space of a process can be marked read-only and protected from modification by user-mode threads.</span></span>

<span data-ttu-id="fa8b3-107">Per l'elenco completo degli attributi, vedere [costanti di protezione della memoria](memory-protection-constants.md).</span><span class="sxs-lookup"><span data-stu-id="fa8b3-107">For the complete list of attributes, see [Memory Protection Constants](memory-protection-constants.md).</span></span>

## <a name="copy-on-write-protection"></a><span data-ttu-id="fa8b3-108">Protezione copia su scrittura</span><span class="sxs-lookup"><span data-stu-id="fa8b3-108">Copy-on-Write Protection</span></span>

<span data-ttu-id="fa8b3-109">La protezione copy-on-Write è un'ottimizzazione che consente a più processi di mappare gli spazi degli indirizzi virtuali in modo che condividano una pagina fisica finché uno dei processi non modifica la pagina.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-109">Copy-on-write protection is an optimization that allows multiple processes to map their virtual address spaces such that they share a physical page until one of the processes modifies the page.</span></span> <span data-ttu-id="fa8b3-110">Questo fa parte di una tecnica denominata *Lazy Evaluation*, che consente al sistema di conservare la memoria fisica e il tempo senza eseguire un'operazione fino a quando non è assolutamente necessario.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-110">This is part of a technique called *lazy evaluation*, which allows the system to conserve physical memory and time by not performing an operation until absolutely necessary.</span></span>

<span data-ttu-id="fa8b3-111">Si supponga ad esempio che due processi carichino pagine dalla stessa DLL negli spazi di memoria virtuale.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-111">For example, suppose two processes load pages from the same DLL into their virtual memory spaces.</span></span> <span data-ttu-id="fa8b3-112">Queste pagine di memoria virtuale sono mappate alle stesse pagine di memoria fisica per entrambi i processi.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-112">These virtual memory pages are mapped to the same physical memory pages for both processes.</span></span> <span data-ttu-id="fa8b3-113">Finché nessuno dei due processi scrive in queste pagine, è possibile eseguirne il mapping a e condividere le stesse pagine fisiche, come illustrato nel diagramma seguente.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-113">As long as neither process writes to these pages, they can map to and share, the same physical pages, as shown in the following diagram.</span></span>

![caselle e frecce del processo 1 e 2 pagine mappate alla stessa memoria fisica](images/mem1.png)

<span data-ttu-id="fa8b3-115">Se il processo 1 scrive in una di queste pagine, il contenuto della pagina fisica viene copiato in un'altra pagina fisica e la mappa della memoria virtuale viene aggiornata per il processo 1.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-115">If Process 1 writes to one of these pages, the contents of the physical page are copied to another physical page and the virtual memory map is updated for Process 1.</span></span> <span data-ttu-id="fa8b3-116">Entrambi i processi dispongono ora di una propria istanza della pagina nella memoria fisica.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-116">Both processes now have their own instance of the page in physical memory.</span></span> <span data-ttu-id="fa8b3-117">Non è pertanto possibile che un processo scriva in una pagina fisica condivisa e che l'altro processo visualizzi le modifiche.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-117">Therefore, it is not possible for one process to write to a shared physical page and for the other process to see the changes.</span></span>

![caselle e frecce dei processi e rimapping della memoria fisica](images/mem2.png)

## <a name="loading-applications-and-dlls"></a><span data-ttu-id="fa8b3-119">Caricamento di applicazioni e dll</span><span class="sxs-lookup"><span data-stu-id="fa8b3-119">Loading Applications and DLLs</span></span>

<span data-ttu-id="fa8b3-120">Quando vengono caricate più istanze della stessa applicazione basata su Windows, ogni istanza viene eseguita nello spazio degli indirizzi virtuale protetto.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-120">When multiple instances of the same Windows-based application are loaded, each instance is run in its own protected virtual address space.</span></span> <span data-ttu-id="fa8b3-121">Tuttavia, i rispettivi handle di istanza (*HINSTANCE*) hanno in genere lo stesso valore.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-121">However, their instance handles (*hInstance*) typically have the same value.</span></span> <span data-ttu-id="fa8b3-122">Questo valore rappresenta l'indirizzo di base dell'applicazione nello spazio degli indirizzi virtuali.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-122">This value represents the base address of the application in its virtual address space.</span></span> <span data-ttu-id="fa8b3-123">Se ogni istanza può essere caricata nell'indirizzo di base predefinito, può eseguire il mapping a e condividere le stesse pagine fisiche con le altre istanze, usando la protezione copy-on-Write.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-123">If each instance can be loaded into its default base address, it can map to and share the same physical pages with the other instances, using copy-on-write protection.</span></span> <span data-ttu-id="fa8b3-124">Il sistema consente a queste istanze di condividere le stesse pagine fisiche fino a quando uno di essi non modifica una pagina.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-124">The system allows these instances to share the same physical pages until one of them modifies a page.</span></span> <span data-ttu-id="fa8b3-125">Se per qualche motivo una di queste istanze non può essere caricata nell'indirizzo di base desiderato, riceve le proprie pagine fisiche.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-125">If for some reason one of these instances cannot be loaded in the desired base address, it receives its own physical pages.</span></span>

<span data-ttu-id="fa8b3-126">Le dll vengono create con un indirizzo di base predefinito.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-126">DLLs are created with a default base address.</span></span> <span data-ttu-id="fa8b3-127">Ogni processo che utilizza una DLL tenterà di caricare la DLL all'interno del proprio spazio degli indirizzi all'indirizzo virtuale predefinito per la DLL.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-127">Every process that uses a DLL will try to load the DLL within its own address space at the default virtual address for the DLL.</span></span> <span data-ttu-id="fa8b3-128">Se più applicazioni possono caricare una DLL all'indirizzo virtuale predefinito, possono condividere le stesse pagine fisiche per la DLL.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-128">If multiple applications can load a DLL at its default virtual address, they can share the same physical pages for the DLL.</span></span> <span data-ttu-id="fa8b3-129">Se per qualche motivo un processo non è in grado di caricare la DLL all'indirizzo predefinito, carica la DLL altrove.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-129">If for some reason a process cannot load the DLL at the default address, it loads the DLL elsewhere.</span></span> <span data-ttu-id="fa8b3-130">La protezione tramite copia su scrittura impone la copia di alcune pagine della DLL in pagine fisiche diverse per questo processo, perché le correzioni per le istruzioni di salto vengono scritte nelle pagine della DLL e saranno diverse per questo processo.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-130">Copy-on-write protection forces some of the DLL's pages to be copied into different physical pages for this process, because the fixes for jump instructions are written within the DLL's pages, and they will be different for this process.</span></span> <span data-ttu-id="fa8b3-131">Se la sezione di codice contiene molti riferimenti alla sezione dati, questa operazione può causare la copia dell'intera sezione di codice in nuove pagine fisiche.</span><span class="sxs-lookup"><span data-stu-id="fa8b3-131">If the code section contains many references to the data section, this can cause the entire code section to be copied to new physical pages.</span></span>

 

 



