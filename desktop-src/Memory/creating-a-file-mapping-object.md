---
description: Il primo passaggio per eseguire il mapping di un file consiste nell'aprire il file chiamando la funzione CreateFile.
ms.assetid: e00d8742-b717-419c-902c-9a286d75d8aa
title: Creazione di un oggetto mapping file
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b502c484dd0466b47a87f4db205d1da5499bf5ef
ms.sourcegitcommit: c3f669dc1d52278432bf75ad9fddba3257d26aa2
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/04/2021
ms.locfileid: "111432503"
---
# <a name="creating-a-file-mapping-object"></a><span data-ttu-id="b400f-103">Creazione di un oggetto mapping file</span><span class="sxs-lookup"><span data-stu-id="b400f-103">Creating a File Mapping Object</span></span>

<span data-ttu-id="b400f-104">Il primo passaggio per eseguire il mapping di un file consiste nell'aprire il file chiamando la [**funzione CreateFile.**](/windows/win32/api/fileapi/nf-fileapi-createfilea)</span><span class="sxs-lookup"><span data-stu-id="b400f-104">The first step in mapping a file is to open the file by calling the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function.</span></span> <span data-ttu-id="b400f-105">Per assicurarsi che altri processi non siano in grado di scrivere nella parte del file di cui è stato eseguito il mapping, è necessario aprire il file con accesso esclusivo.</span><span class="sxs-lookup"><span data-stu-id="b400f-105">To ensure that other processes cannot write to the portion of the file that is mapped, you should open the file with exclusive access.</span></span> <span data-ttu-id="b400f-106">Inoltre, l'handle di file deve rimanere aperto fino a quando il processo non richiede più l'oggetto mapping file.</span><span class="sxs-lookup"><span data-stu-id="b400f-106">In addition, the file handle should remain open until the process no longer needs the file mapping object.</span></span> <span data-ttu-id="b400f-107">Un modo semplice per ottenere l'accesso esclusivo è specificare zero nel parametro *fdwShareMode* di **CreateFile**.</span><span class="sxs-lookup"><span data-stu-id="b400f-107">An easy way to obtain exclusive access is to specify zero in the *fdwShareMode* parameter of **CreateFile**.</span></span> <span data-ttu-id="b400f-108">L'handle restituito **da CreateFile** viene usato dalla [**funzione CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) per creare un oggetto di mapping dei file.</span><span class="sxs-lookup"><span data-stu-id="b400f-108">The handle returned by **CreateFile** is used by the [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function to create a file mapping object.</span></span>

<span data-ttu-id="b400f-109">La [**funzione CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) restituisce un handle per l'oggetto mapping di file.</span><span class="sxs-lookup"><span data-stu-id="b400f-109">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function returns a handle to the file mapping object.</span></span> <span data-ttu-id="b400f-110">Questo handle verrà usato durante la [creazione di una visualizzazione file](creating-a-file-view.md) in modo da poter accedere alla memoria condivisa.</span><span class="sxs-lookup"><span data-stu-id="b400f-110">This handle will be used when [creating a file view](creating-a-file-view.md) so that you can access the shared memory.</span></span> <span data-ttu-id="b400f-111">Quando si chiama **CreateFileMapping**, si specifica un nome di oggetto, il numero di byte di cui eseguire il mapping dal file e l'autorizzazione di lettura/scrittura per la memoria mappata.</span><span class="sxs-lookup"><span data-stu-id="b400f-111">When you call **CreateFileMapping**, you specify an object name, the number of bytes to be mapped from the file, and the read/write permission for the mapped memory.</span></span> <span data-ttu-id="b400f-112">Il primo processo che chiama **CreateFileMapping crea** l'oggetto mapping file.</span><span class="sxs-lookup"><span data-stu-id="b400f-112">The first process that calls **CreateFileMapping** creates the file mapping object.</span></span> <span data-ttu-id="b400f-113">I processi che chiamano **CreateFileMapping** per un oggetto esistente ricevono un handle per l'oggetto esistente.</span><span class="sxs-lookup"><span data-stu-id="b400f-113">Processes calling **CreateFileMapping** for an existing object receive a handle to the existing object.</span></span> <span data-ttu-id="b400f-114">È possibile stabilire se una chiamata a **CreateFileMapping** ha creato o aperto l'oggetto mapping di file chiamando la [**funzione GetLastError.**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror)</span><span class="sxs-lookup"><span data-stu-id="b400f-114">You can tell whether or not a successful call to **CreateFileMapping** created or opened the file mapping object by calling the [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) function.</span></span> <span data-ttu-id="b400f-115">**GetLastError** restituisce **NO \_ ERROR** al processo di creazione e **ERROR ALREADY \_ \_ EXISTS** per i processi successivi.</span><span class="sxs-lookup"><span data-stu-id="b400f-115">**GetLastError** returns **NO\_ERROR** to the creating process and **ERROR\_ALREADY\_EXISTS** to subsequent processes.</span></span>

<span data-ttu-id="b400f-116">La [**funzione CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) ha esito negativo se i flag di accesso sono in conflitto con quelli specificati quando la [**funzione CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) ha aperto il file.</span><span class="sxs-lookup"><span data-stu-id="b400f-116">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function fails if the access flags conflict with those specified when the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function opened the file.</span></span> <span data-ttu-id="b400f-117">Ad esempio, per leggere e scrivere nel file:</span><span class="sxs-lookup"><span data-stu-id="b400f-117">For example, to read and write to the file:</span></span>

-   <span data-ttu-id="b400f-118">Specificare i **\_ valori GENERIC READ** **e GENERIC \_ WRITE** nel parametro *fdwAccess* di [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="b400f-118">Specify the **GENERIC\_READ** and **GENERIC\_WRITE** values in the *fdwAccess* parameter of [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea).</span></span>
-   <span data-ttu-id="b400f-119">Specificare il **valore PAGE \_ READWRITE** nel parametro *fdwProtect* di [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga).</span><span class="sxs-lookup"><span data-stu-id="b400f-119">Specify the **PAGE\_READWRITE** value in the *fdwProtect* parameter of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga).</span></span>

<span data-ttu-id="b400f-120">La creazione di un oggetto mapping di file non esegue il commit della memoria fisica, ma la riserva.</span><span class="sxs-lookup"><span data-stu-id="b400f-120">Creating a file mapping object does not commit physical memory, it only reserves it.</span></span>

## <a name="file-mapping-size"></a><span data-ttu-id="b400f-121">Dimensioni mapping file</span><span class="sxs-lookup"><span data-stu-id="b400f-121">File Mapping Size</span></span>

<span data-ttu-id="b400f-122">Le dimensioni dell'oggetto mapping file sono indipendenti dalle dimensioni del file di cui viene eseguito il mapping.</span><span class="sxs-lookup"><span data-stu-id="b400f-122">The size of the file mapping object is independent of the size of the file being mapped.</span></span> <span data-ttu-id="b400f-123">Tuttavia, se l'oggetto di mapping dei file è più grande del file, il sistema espande il file prima che [**venga restituito CreateFileMapping.**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga)</span><span class="sxs-lookup"><span data-stu-id="b400f-123">However, if the file mapping object is larger than the file, the system expands the file before [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) returns.</span></span> <span data-ttu-id="b400f-124">Se l'oggetto mapping file è più piccolo del file, il sistema esegue il mapping solo al numero specificato di byte dal file.</span><span class="sxs-lookup"><span data-stu-id="b400f-124">If the file mapping object is smaller than the file, the system maps only the specified number of bytes from the file.</span></span>

<span data-ttu-id="b400f-125">I *parametri dwMaximumSizeHigh* e *dwMaximumSizeLow* di [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) consentono di specificare il numero di byte di cui eseguire il mapping dal file:</span><span class="sxs-lookup"><span data-stu-id="b400f-125">The *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) allow you to specify the number of bytes to be mapped from the file:</span></span>

-   <span data-ttu-id="b400f-126">Quando non si desidera modificare le dimensioni del file , ad esempio quando si esegue il mapping di file di sola lettura, chiamare [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) e specificare zero per *dwMaximumSizeHigh* e *dwMaximumSizeLow*.</span><span class="sxs-lookup"><span data-stu-id="b400f-126">When you do not want the size of the file to change (for example, when mapping read-only files), call [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) and specify zero for both *dwMaximumSizeHigh* and *dwMaximumSizeLow*.</span></span> <span data-ttu-id="b400f-127">In questo modo viene creato un oggetto di mapping dei file che ha esattamente le stesse dimensioni del file.</span><span class="sxs-lookup"><span data-stu-id="b400f-127">Doing this creates a file mapping object that is exactly the same size as the file.</span></span> <span data-ttu-id="b400f-128">In caso contrario, è necessario calcolare o stimare le dimensioni del file completato perché le dimensioni degli oggetti di mapping dei file sono statiche. Dopo la creazione, le dimensioni non possono essere aumentate o ridotte.</span><span class="sxs-lookup"><span data-stu-id="b400f-128">Otherwise, you must calculate or estimate the size of the finished file because file mapping objects are static in size; once created, their size cannot be increased or decreased.</span></span> <span data-ttu-id="b400f-129">Un tentativo di eseguire il mapping di un file con una lunghezza pari a zero in questo modo ha esito negativo e il codice di errore **è \_ ERROR FILE \_ INVALID**.</span><span class="sxs-lookup"><span data-stu-id="b400f-129">An attempt to map a file with a length of zero in this manner fails with an error code of **ERROR\_FILE\_INVALID**.</span></span> <span data-ttu-id="b400f-130">I programmi devono testare i file con lunghezza zero e rifiutare tali file.</span><span class="sxs-lookup"><span data-stu-id="b400f-130">Programs should test for files with a length of zero and reject such files.</span></span>

-   <span data-ttu-id="b400f-131">Le dimensioni di un oggetto mapping file supportato da un file denominato sono limitate dallo spazio su disco.</span><span class="sxs-lookup"><span data-stu-id="b400f-131">The size of a file mapping object that is backed by a named file is limited by disk space.</span></span> <span data-ttu-id="b400f-132">Le dimensioni di una visualizzazione file sono limitate al blocco contiguo più grande disponibile di memoria virtuale non riservata.</span><span class="sxs-lookup"><span data-stu-id="b400f-132">The size of a file view is limited to the largest available contiguous block of unreserved virtual memory.</span></span> <span data-ttu-id="b400f-133">Si tratta al massimo di 2 GB meno la memoria virtuale già riservata dal processo.</span><span class="sxs-lookup"><span data-stu-id="b400f-133">This is at most 2 GB minus the virtual memory already reserved by the process.</span></span>

<span data-ttu-id="b400f-134">Le dimensioni dell'oggetto di mapping dei file selezionato controllano la distanza nel file che è possibile "vedere" con il mapping della memoria.</span><span class="sxs-lookup"><span data-stu-id="b400f-134">The size of the file mapping object that you select controls how far into the file you can "see" with memory mapping.</span></span> <span data-ttu-id="b400f-135">Se si crea un oggetto mapping di file di dimensioni di 500 Kb, si ha accesso solo ai primi 500 Kb del file, indipendentemente dalle dimensioni del file.</span><span class="sxs-lookup"><span data-stu-id="b400f-135">If you create a file mapping object that is 500 Kb in size, you have access only to the first 500 Kb of the file, regardless of the size of the file.</span></span> <span data-ttu-id="b400f-136">Poiché non sono necessarie risorse di sistema per creare un oggetto di mapping dei file di dimensioni maggiori, creare un oggetto di mapping file con le dimensioni del file (impostare i parametri *dwMaximumSizeHigh* e *dwMaximumSizeLow* di [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) entrambi su zero) anche se non si prevede di visualizzare l'intero file.</span><span class="sxs-lookup"><span data-stu-id="b400f-136">Since it does not cost you any system resources to create a larger file mapping object, create a file mapping object that is the size of the file (set the *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) both to zero) even if you do not expect to view the entire file.</span></span> <span data-ttu-id="b400f-137">Il costo delle risorse di sistema deriva dalla creazione delle viste e dall'accesso.</span><span class="sxs-lookup"><span data-stu-id="b400f-137">The cost in system resources comes in creating the views and accessing them.</span></span>

<span data-ttu-id="b400f-138">È possibile visualizzare una parte del file che non inizia all'inizio del file.</span><span class="sxs-lookup"><span data-stu-id="b400f-138">You can view a portion of the file that does not start at the beginning of the file.</span></span> <span data-ttu-id="b400f-139">Per altre informazioni, vedere [Creazione di una vista all'interno di un file](creating-a-view-within-a-file.md).</span><span class="sxs-lookup"><span data-stu-id="b400f-139">For more information, see [Creating a View Within a File](creating-a-view-within-a-file.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="b400f-140">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="b400f-140">Related topics</span></span>

<dl> <span data-ttu-id="b400f-141"><dt>
[Creazione di una vista file Creazione](creating-a-file-view.md)
</dt> di una vista <dt> 
[all'interno di un file](creating-a-view-within-a-file.md)
</dt> </span><span class="sxs-lookup"><span data-stu-id="b400f-141"><dt>
[Creating a File View](creating-a-file-view.md)
</dt> <dt>
[Creating a View Within a File](creating-a-view-within-a-file.md)
</dt> </span></span></dl>


 
