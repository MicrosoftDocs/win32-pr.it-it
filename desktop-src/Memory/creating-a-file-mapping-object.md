---
description: Il primo passaggio per eseguire il mapping di un file consiste nell'aprire il file chiamando la funzione CreateFile.
ms.assetid: e00d8742-b717-419c-902c-9a286d75d8aa
title: Creazione di un oggetto di mapping dei file
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 65badc2af8aed5211c2f5c590fc0998019dae264
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104345366"
---
# <a name="creating-a-file-mapping-object"></a><span data-ttu-id="24d52-103">Creazione di un oggetto di mapping dei file</span><span class="sxs-lookup"><span data-stu-id="24d52-103">Creating a File Mapping Object</span></span>

<span data-ttu-id="24d52-104">Il primo passaggio per eseguire il mapping di un file consiste nell'aprire il file chiamando la funzione [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) .</span><span class="sxs-lookup"><span data-stu-id="24d52-104">The first step in mapping a file is to open the file by calling the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function.</span></span> <span data-ttu-id="24d52-105">Per assicurarsi che altri processi non possano scrivere nella parte del file di cui è stato eseguito il mapping, è necessario aprire il file con accesso esclusivo.</span><span class="sxs-lookup"><span data-stu-id="24d52-105">To ensure that other processes cannot write to the portion of the file that is mapped, you should open the file with exclusive access.</span></span> <span data-ttu-id="24d52-106">Inoltre, l'handle di file deve rimanere aperto fino a quando il processo non necessita più dell'oggetto mapping dei file.</span><span class="sxs-lookup"><span data-stu-id="24d52-106">In addition, the file handle should remain open until the process no longer needs the file mapping object.</span></span> <span data-ttu-id="24d52-107">Un modo semplice per ottenere l'accesso esclusivo consiste nello specificare zero nel parametro *fdwShareMode* di **CreateFile**.</span><span class="sxs-lookup"><span data-stu-id="24d52-107">An easy way to obtain exclusive access is to specify zero in the *fdwShareMode* parameter of **CreateFile**.</span></span> <span data-ttu-id="24d52-108">L'handle restituito da **CreateFile** viene usato dalla funzione [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) per creare un oggetto mapping di file.</span><span class="sxs-lookup"><span data-stu-id="24d52-108">The handle returned by **CreateFile** is used by the [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function to create a file mapping object.</span></span>

<span data-ttu-id="24d52-109">La funzione [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) restituisce un handle per l'oggetto mapping del file.</span><span class="sxs-lookup"><span data-stu-id="24d52-109">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function returns a handle to the file mapping object.</span></span> <span data-ttu-id="24d52-110">Questo handle verrà usato durante [la creazione di una visualizzazione file](creating-a-file-view.md) in modo da poter accedere alla memoria condivisa.</span><span class="sxs-lookup"><span data-stu-id="24d52-110">This handle will be used when [creating a file view](creating-a-file-view.md) so that you can access the shared memory.</span></span> <span data-ttu-id="24d52-111">Quando si chiama **CreateFileMapping**, si specifica il nome di un oggetto, il numero di byte da mappare dal file e l'autorizzazione di lettura/scrittura per la memoria mappata.</span><span class="sxs-lookup"><span data-stu-id="24d52-111">When you call **CreateFileMapping**, you specify an object name, the number of bytes to be mapped from the file, and the read/write permission for the mapped memory.</span></span> <span data-ttu-id="24d52-112">Il primo processo che chiama **CreateFileMapping** crea l'oggetto mapping dei file.</span><span class="sxs-lookup"><span data-stu-id="24d52-112">The first process that calls **CreateFileMapping** creates the file mapping object.</span></span> <span data-ttu-id="24d52-113">I processi che chiamano **CreateFileMapping** per un oggetto esistente ricevono un handle per l'oggetto esistente.</span><span class="sxs-lookup"><span data-stu-id="24d52-113">Processes calling **CreateFileMapping** for an existing object receive a handle to the existing object.</span></span> <span data-ttu-id="24d52-114">È possibile stabilire se una chiamata a **CreateFileMapping** è stata creata o meno con esito positivo oppure se è stato aperto l'oggetto di mapping dei file chiamando la funzione [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) .</span><span class="sxs-lookup"><span data-stu-id="24d52-114">You can tell whether or not a successful call to **CreateFileMapping** created or opened the file mapping object by calling the [**GetLastError**](/windows/win32/api/errhandlingapi/nf-errhandlingapi-getlasterror) function.</span></span> <span data-ttu-id="24d52-115">**GetLastError** **non restituisce alcun \_ errore** al processo di creazione e l' **errore \_ \_ esiste già** nei processi successivi.</span><span class="sxs-lookup"><span data-stu-id="24d52-115">**GetLastError** returns **NO\_ERROR** to the creating process and **ERROR\_ALREADY\_EXISTS** to subsequent processes.</span></span>

<span data-ttu-id="24d52-116">La funzione [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) ha esito negativo se i flag di accesso sono in conflitto con quelli specificati quando la funzione [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) ha aperto il file.</span><span class="sxs-lookup"><span data-stu-id="24d52-116">The [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) function fails if the access flags conflict with those specified when the [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea) function opened the file.</span></span> <span data-ttu-id="24d52-117">Ad esempio, per leggere e scrivere nel file:</span><span class="sxs-lookup"><span data-stu-id="24d52-117">For example, to read and write to the file:</span></span>

-   <span data-ttu-id="24d52-118">Specificare i valori **generici di \_ lettura** e **\_ scrittura** generici nel parametro *fdwAccess* di [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="24d52-118">Specify the **GENERIC\_READ** and **GENERIC\_WRITE** values in the *fdwAccess* parameter of [**CreateFile**](/windows/win32/api/fileapi/nf-fileapi-createfilea).</span></span>
-   <span data-ttu-id="24d52-119">Specificare il **valore \_ ReadWrite della pagina** nel parametro *fdwProtect* di [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga).</span><span class="sxs-lookup"><span data-stu-id="24d52-119">Specify the **PAGE\_READWRITE** value in the *fdwProtect* parameter of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga).</span></span>

<span data-ttu-id="24d52-120">La creazione di un oggetto mapping di file non esegue il commit della memoria fisica, ma la riserva.</span><span class="sxs-lookup"><span data-stu-id="24d52-120">Creating a file mapping object does not commit physical memory, it only reserves it.</span></span>

## <a name="file-mapping-size"></a><span data-ttu-id="24d52-121">Dimensioni del mapping dei file</span><span class="sxs-lookup"><span data-stu-id="24d52-121">File Mapping Size</span></span>

<span data-ttu-id="24d52-122">Le dimensioni dell'oggetto mapping dei file sono indipendenti dalle dimensioni del file di cui è in corso il mapping.</span><span class="sxs-lookup"><span data-stu-id="24d52-122">The size of the file mapping object is independent of the size of the file being mapped.</span></span> <span data-ttu-id="24d52-123">Tuttavia, se l'oggetto di mapping dei file è più grande del file, il sistema espande il file prima che [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) restituisca.</span><span class="sxs-lookup"><span data-stu-id="24d52-123">However, if the file mapping object is larger than the file, the system expands the file before [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) returns.</span></span> <span data-ttu-id="24d52-124">Se l'oggetto di mapping dei file è più piccolo del file, il sistema esegue il mapping solo del numero specificato di byte dal file.</span><span class="sxs-lookup"><span data-stu-id="24d52-124">If the file mapping object is smaller than the file, the system maps only the specified number of bytes from the file.</span></span>

<span data-ttu-id="24d52-125">I parametri *dwMaximumSizeHigh* e *dwMaximumSizeLow* di [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) consentono di specificare il numero di byte da mappare dal file:</span><span class="sxs-lookup"><span data-stu-id="24d52-125">The *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) allow you to specify the number of bytes to be mapped from the file:</span></span>

-   <span data-ttu-id="24d52-126">Quando non si desidera modificare le dimensioni del file (ad esempio, quando si esegue il mapping di file di sola lettura), chiamare [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) e specificare zero sia per *DwMaximumSizeHigh* che per *dwMaximumSizeLow*.</span><span class="sxs-lookup"><span data-stu-id="24d52-126">When you do not want the size of the file to change (for example, when mapping read-only files), call [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) and specify zero for both *dwMaximumSizeHigh* and *dwMaximumSizeLow*.</span></span> <span data-ttu-id="24d52-127">In questo modo viene creato un oggetto mapping di file esattamente della stessa dimensione del file.</span><span class="sxs-lookup"><span data-stu-id="24d52-127">Doing this creates a file mapping object that is exactly the same size as the file.</span></span> <span data-ttu-id="24d52-128">In caso contrario, è necessario calcolare o stimare la dimensione del file finito perché gli oggetti di mapping dei file sono statici di dimensioni. una volta create, le dimensioni non possono essere aumentate o diminuite.</span><span class="sxs-lookup"><span data-stu-id="24d52-128">Otherwise, you must calculate or estimate the size of the finished file because file mapping objects are static in size; once created, their size cannot be increased or decreased.</span></span> <span data-ttu-id="24d52-129">Il tentativo di eseguire il mapping di un file con una lunghezza pari a zero in questo modo ha esito negativo e non è **\_ \_ valido** un codice di errore del file degli errori.</span><span class="sxs-lookup"><span data-stu-id="24d52-129">An attempt to map a file with a length of zero in this manner fails with an error code of **ERROR\_FILE\_INVALID**.</span></span> <span data-ttu-id="24d52-130">I programmi devono verificare la presenza di file con una lunghezza pari a zero e rifiutare tali file.</span><span class="sxs-lookup"><span data-stu-id="24d52-130">Programs should test for files with a length of zero and reject such files.</span></span>

-   <span data-ttu-id="24d52-131">Le dimensioni di un oggetto mapping di file supportato da un file denominato sono limitate dallo spazio su disco.</span><span class="sxs-lookup"><span data-stu-id="24d52-131">The size of a file mapping object that is backed by a named file is limited by disk space.</span></span> <span data-ttu-id="24d52-132">Le dimensioni di una visualizzazione file sono limitate al blocco contiguo più grande disponibile di memoria virtuale non riservata.</span><span class="sxs-lookup"><span data-stu-id="24d52-132">The size of a file view is limited to the largest available contiguous block of unreserved virtual memory.</span></span> <span data-ttu-id="24d52-133">Si tratta di un massimo di 2 GB meno la memoria virtuale già riservata dal processo.</span><span class="sxs-lookup"><span data-stu-id="24d52-133">This is at most 2 GB minus the virtual memory already reserved by the process.</span></span>

<span data-ttu-id="24d52-134">Le dimensioni dell'oggetto mapping dei file selezionato controllano la distanza del file che è possibile "visualizzare" con il mapping della memoria.</span><span class="sxs-lookup"><span data-stu-id="24d52-134">The size of the file mapping object that you select controls how far into the file you can "see" with memory mapping.</span></span> <span data-ttu-id="24d52-135">Se si crea un oggetto di mapping dei file di 500 KB, è possibile accedere solo ai primi 500 KB del file, indipendentemente dalle dimensioni del file.</span><span class="sxs-lookup"><span data-stu-id="24d52-135">If you create a file mapping object that is 500 Kb in size, you have access only to the first 500 Kb of the file, regardless of the size of the file.</span></span> <span data-ttu-id="24d52-136">Poiché non sono previste risorse di sistema per la creazione di un oggetto di mapping dei file più ampio, creare un oggetto mapping file che corrisponde alla dimensione del file (impostare i parametri *dwMaximumSizeHigh* e *dwMaximumSizeLow* di [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) entrambi su zero) anche se non si prevede di visualizzare l'intero file.</span><span class="sxs-lookup"><span data-stu-id="24d52-136">Since it does not cost you any system resources to create a larger file mapping object, create a file mapping object that is the size of the file (set the *dwMaximumSizeHigh* and *dwMaximumSizeLow* parameters of [**CreateFileMapping**](/windows/desktop/api/WinBase/nf-winbase-createfilemappinga) both to zero) even if you do not expect to view the entire file.</span></span> <span data-ttu-id="24d52-137">Il costo delle risorse di sistema è quello di creare le visualizzazioni e accedervi.</span><span class="sxs-lookup"><span data-stu-id="24d52-137">The cost in system resources comes in creating the views and accessing them.</span></span>

<span data-ttu-id="24d52-138">Se si desidera visualizzare una parte del file che non si avvia all'inizio del file, è necessario creare un oggetto mapping di file.</span><span class="sxs-lookup"><span data-stu-id="24d52-138">If you want to view a portion of the file that does not start at the beginning of the file, you must create a file mapping object.</span></span> <span data-ttu-id="24d52-139">Questo oggetto corrisponde alla dimensione della parte del file che si desidera visualizzare più l'offset nel file.</span><span class="sxs-lookup"><span data-stu-id="24d52-139">This object is the size of the portion of the file that you want to view plus the offset into the file.</span></span>

## <a name="related-topics"></a><span data-ttu-id="24d52-140">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="24d52-140">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="24d52-141">Creazione di una vista in un file</span><span class="sxs-lookup"><span data-stu-id="24d52-141">Creating a View Within a File</span></span>](creating-a-view-within-a-file.md)
</dt> </dl>

 

 
