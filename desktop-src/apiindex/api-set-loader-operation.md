---
description: Viene descritto come Windows 10 USA i set di API nelle operazioni del caricatore.
title: Funzionamento del caricatore dei set di API
ms.topic: article
ms.date: 10/14/2020
ms.openlocfilehash: 701409c0d8dac2c275add06d2502c8764d502aba
ms.sourcegitcommit: bf526e267d3991892733bdd229c66d5365cf244a
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/05/2021
ms.locfileid: "106320224"
---
# <a name="api-set-loader-operation"></a><span data-ttu-id="c0941-103">Funzionamento del caricatore dei set di API</span><span class="sxs-lookup"><span data-stu-id="c0941-103">API set loader operation</span></span>

<span data-ttu-id="c0941-104">I [set di API](windows-apisets.md) si basano sul supporto del sistema operativo nel caricatore della libreria per introdurre efficacemente un reindirizzamento dello spazio dei nomi del modulo nel processo di associazione della libreria.</span><span class="sxs-lookup"><span data-stu-id="c0941-104">[API sets](windows-apisets.md) rely on OS support in the library loader to effectively introduce a module namespace redirection into the library binding process.</span></span> <span data-ttu-id="c0941-105">Il [nome del contratto del set di API](windows-apisets.md#api-set-contract-names) viene usato dal caricatore della libreria per eseguire un reindirizzamento del runtime del riferimento a un file binario host di destinazione che ospita l'implementazione appropriata del set di API.</span><span class="sxs-lookup"><span data-stu-id="c0941-105">The [API set contract name](windows-apisets.md#api-set-contract-names) is used by library loader to perform a runtime redirection of the reference to a target host binary that houses the appropriate implementation of the API set.</span></span>

<span data-ttu-id="c0941-106">Quando il caricatore rileva una dipendenza da un'API impostata in fase di esecuzione, il caricatore consulta i dati di configurazione nell'immagine per identificare il file binario host per un set di API.</span><span class="sxs-lookup"><span data-stu-id="c0941-106">When the loader encounters a dependency on an API set at run time, the loader consults configuration data in the image to identify the host binary for an API set.</span></span> <span data-ttu-id="c0941-107">Questi dati di configurazione sono definiti **schema del set di API**.</span><span class="sxs-lookup"><span data-stu-id="c0941-107">This configuration data is called the **API set schema**.</span></span> <span data-ttu-id="c0941-108">Lo schema viene assemblato come una proprietà del sistema operativo e il mapping tra i set di API e i file binari può variare a seconda dei file binari inclusi in un determinato dispositivo.</span><span class="sxs-lookup"><span data-stu-id="c0941-108">The schema is assembled as a property of the OS, and the mapping between API sets and binaries may differ depending on which binaries are included in a given device.</span></span> <span data-ttu-id="c0941-109">Lo schema consente di instradare correttamente una funzione importata in un singolo file binario su dispositivi diversi, anche se i nomi dei moduli dell'host binario sono stati rinominati o completamente sottoposti a refactoring in diversi dispositivi Windows.</span><span class="sxs-lookup"><span data-stu-id="c0941-109">The schema enables an imported function in a single binary to be routed correctly on different devices, even if the module names of the binary host have been renamed or completely refactored on different Windows devices.</span></span>

<span data-ttu-id="c0941-110">Windows 10 supporta due tecniche standard per l'utilizzo e l'interfaccia con i set di API: l' **invio diretto** e l' **invio inverso**.</span><span class="sxs-lookup"><span data-stu-id="c0941-110">Windows 10 supports two standard techniques to consume and interface with API sets: **direct forwarding** and **reverse forwarding**.</span></span>

### <a name="direct-forwarding"></a><span data-ttu-id="c0941-111">Inoltri diretti</span><span class="sxs-lookup"><span data-stu-id="c0941-111">Direct forwarding</span></span>

<span data-ttu-id="c0941-112">In questa configurazione, il codice consumer importa direttamente il nome del modulo set di API.</span><span class="sxs-lookup"><span data-stu-id="c0941-112">In this configuration, the consuming code imports an API set module name directly.</span></span> <span data-ttu-id="c0941-113">Questa importazione viene risolta in un'unica operazione ed è il metodo più efficiente con il minor sovraccarico.</span><span class="sxs-lookup"><span data-stu-id="c0941-113">This import is resolved in a single operation, and is the most efficient method with the least overhead.</span></span> <span data-ttu-id="c0941-114">A livello concettuale, questa risoluzione può puntare a binari diversi in dispositivi Windows 10 diversi, come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="c0941-114">Conceptually, this resolution may point to different binaries on different Windows 10 devices, as is shown in the following example:</span></span>

<span data-ttu-id="c0941-115">Set di API importati: **api-feature1-l1-1-0.dll**</span><span class="sxs-lookup"><span data-stu-id="c0941-115">Imported API set: **api-feature1-l1-1-0.dll**</span></span>
-  <span data-ttu-id="c0941-116">**feature1.dll** > PC Windows</span><span class="sxs-lookup"><span data-stu-id="c0941-116">Windows PC -> **feature1.dll**</span></span>
-  <span data-ttu-id="c0941-117">HoloLens- **feature1_holo.dll** ></span><span class="sxs-lookup"><span data-stu-id="c0941-117">HoloLens -> **feature1_holo.dll**</span></span>
-  <span data-ttu-id="c0941-118">> **feature1_iot.dll**</span><span class="sxs-lookup"><span data-stu-id="c0941-118">IoT -> **feature1_iot.dll**</span></span>

<span data-ttu-id="c0941-119">Poiché i mapping vengono conservati in un archivio dati dello schema personalizzato, significa che il nome di un set di API che termina con **. dll** non fa riferimento direttamente a un file su disco.</span><span class="sxs-lookup"><span data-stu-id="c0941-119">Because the mappings are kept in a custom schema data repository, it means that an API set name that ends with **.dll** does not directly refer to a file on disk.</span></span> <span data-ttu-id="c0941-120">La parte **dll** del nome del set di API è solo una convenzione richiesta dal caricatore.</span><span class="sxs-lookup"><span data-stu-id="c0941-120">The **.dll** part of the API set name is only a convention required by the loader.</span></span> <span data-ttu-id="c0941-121">Il nome del set di API è più simile a un alias o a un nome virtuale per un file DLL fisico.</span><span class="sxs-lookup"><span data-stu-id="c0941-121">The API set name is more like an alias or a virtual name for a physical DLL file.</span></span> <span data-ttu-id="c0941-122">Questo rende il nome portabile nell'intero intervallo di dispositivi Windows 10.</span><span class="sxs-lookup"><span data-stu-id="c0941-122">This makes the name portable across the entire range of Windows 10 devices.</span></span>

### <a name="reverse-forwarding"></a><span data-ttu-id="c0941-123">Inoltri inverso</span><span class="sxs-lookup"><span data-stu-id="c0941-123">Reverse forwarding</span></span>

<span data-ttu-id="c0941-124">Sebbene i nomi dei set di API forniscano uno spazio dei nomi stabile per i moduli tra i dispositivi, non è sempre consigliabile convertire ogni file binario in questo nuovo sistema.</span><span class="sxs-lookup"><span data-stu-id="c0941-124">While API set names provide a stable namespace for modules across devices, it is not always practical to convert every binary to this new system.</span></span> <span data-ttu-id="c0941-125">È ad esempio possibile che un'applicazione sia stata usata per molti anni e che la ricompilazione dei file binari dell'applicazione potrebbe non essere fattibile.</span><span class="sxs-lookup"><span data-stu-id="c0941-125">For example, an application may have been in common use for many years, and recompiling the application's binaries may not be feasible.</span></span> <span data-ttu-id="c0941-126">Inoltre, è possibile che alcune applicazioni debbano continuare a essere eseguite nei sistemi compilati prima dell'introduzione di specifici set di API.</span><span class="sxs-lookup"><span data-stu-id="c0941-126">Additionally, some applications may need to continue to run on systems built before specific API sets were introduced.</span></span>

<span data-ttu-id="c0941-127">Per supportare questo livello di compatibilità, viene fornito un sistema di *server d'inoltri* in tutti i dispositivi Windows 10 che coprono un subset della superficie dell'API Win32.</span><span class="sxs-lookup"><span data-stu-id="c0941-127">To accommodate this level of compatibility, a system of *forwarders* are provided on all Windows 10 devices that cover a subset of the Win32 API surface.</span></span> <span data-ttu-id="c0941-128">Questi server d'utilità usano i nomi dei moduli introdotti nei PC Windows e sfruttano il sistema di set di API per garantire la compatibilità tra tutti i dispositivi Windows 10.</span><span class="sxs-lookup"><span data-stu-id="c0941-128">These forwarders use the module names that were introduced on Windows PCs, and leverage the API Set system to provide compatibility across all Windows 10 devices.</span></span>

<span data-ttu-id="c0941-129">Il comportamento dell'operazione del caricatore è analogo al seguente:</span><span class="sxs-lookup"><span data-stu-id="c0941-129">The loader operation behaves like this:</span></span>

1.  <span data-ttu-id="c0941-130">In un dispositivo diverso da un PC Windows, il caricatore presenta una dipendenza legacy del nome del modulo PC Windows che non è presente nel dispositivo.</span><span class="sxs-lookup"><span data-stu-id="c0941-130">On a device other than a Windows PC, the loader is presented a legacy Windows PC module name dependency that is not present on the device.</span></span>
2.  <span data-ttu-id="c0941-131">Il caricatore individua un server d'installazione del set di API per questo modulo e lo carica in memoria.</span><span class="sxs-lookup"><span data-stu-id="c0941-131">The loader locates an API set forwarder for this module and loads it into memory.</span></span>
3.  <span data-ttu-id="c0941-132">Il server d'esecuzione dispone di un mapping per il set di API per la funzione specificata chiamata.</span><span class="sxs-lookup"><span data-stu-id="c0941-132">The forwarder has a mapping for the API set for the given function being called.</span></span>
4.  <span data-ttu-id="c0941-133">Il caricatore trova il file binario host appropriato per il dispositivo specificato.</span><span class="sxs-lookup"><span data-stu-id="c0941-133">The loader finds the proper host binary for the given device.</span></span>

<span data-ttu-id="c0941-134">Concettualmente, il mapping ha un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="c0941-134">Conceptually, the mapping looks like:</span></span>

<span data-ttu-id="c0941-135">DLL importata: **feature1.dll**</span><span class="sxs-lookup"><span data-stu-id="c0941-135">Imported DLL: **feature1.dll**</span></span>
- <span data-ttu-id="c0941-136">**feature1.dll** > PC Windows</span><span class="sxs-lookup"><span data-stu-id="c0941-136">Windows PC -> **feature1.dll**</span></span>
- <span data-ttu-id="c0941-137">HoloLens-> **feature1.dll** server d'avanzamento-> **api-feature1-l1-1-0.dll**  ->  **feature1_holo.dll**</span><span class="sxs-lookup"><span data-stu-id="c0941-137">HoloLens -> **feature1.dll** forwarder -> **api-feature1-l1-1-0.dll** -> **feature1_holo.dll**</span></span>
- <span data-ttu-id="c0941-138">> **feature1.dll** server d'avanzamento-> **api-feature1-l1-1-0.dll**  ->  **feature1_iot.dll**</span><span class="sxs-lookup"><span data-stu-id="c0941-138">IoT -> **feature1.dll** forwarder -> **api-feature1-l1-1-0.dll** -> **feature1_iot.dll**</span></span>

<span data-ttu-id="c0941-139">Il risultato finale è funzionalmente identico all'esecuzione [diretta](#direct-forwarding), ma viene eseguita in modo da ottimizzare la compatibilità delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="c0941-139">The end result is functionally the same as [direct forwarding](#direct-forwarding), but it accomplishes it in a way that maximizes application compatibility.</span></span>

> [!NOTE]
> <span data-ttu-id="c0941-140">L'avanzamento inverso fornisce la copertura solo per un subset della superficie dell'API Win32.</span><span class="sxs-lookup"><span data-stu-id="c0941-140">Reverse forwarding provides coverage only for a subset of the Win32 API surface.</span></span> <span data-ttu-id="c0941-141">Non consente l'esecuzione di applicazioni destinate alle versioni desktop di Windows 10 in tutti i dispositivi Windows 10.</span><span class="sxs-lookup"><span data-stu-id="c0941-141">It does not allow applications that target desktop versions of Windows 10 to run on all Windows 10 devices.</span></span>
