---
description: Uso dell'interfaccia IKsControl per accedere alle proprietà audio
ms.assetid: 72bf9164-96c6-4543-b858-19480b032fdb
title: Uso dell'interfaccia IKsControl per accedere alle proprietà audio
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a67639a0e51334da80b7bff88293414a58bb204c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104225698"
---
# <a name="using-the-ikscontrol-interface-to-access-audio-properties"></a><span data-ttu-id="a393b-103">Uso dell'interfaccia IKsControl per accedere alle proprietà audio</span><span class="sxs-lookup"><span data-stu-id="a393b-103">Using the IKsControl Interface to Access Audio Properties</span></span>

<span data-ttu-id="a393b-104">In rari casi, è possibile che un'applicazione audio specializzata debba usare l'interfaccia [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) per accedere a determinate funzionalità hardware di una scheda audio che non sono esposte dall' [API DEVICETOPOLOGY](devicetopology-api.md) o dall' [API MMDevice](mmdevice-api.md).</span><span class="sxs-lookup"><span data-stu-id="a393b-104">In rare cases, a specialized audio application might need to use the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface to access certain hardware capabilities of an audio adapter that are not exposed by the [DeviceTopology API](devicetopology-api.md) or the [MMDevice API](mmdevice-api.md).</span></span> <span data-ttu-id="a393b-105">L'interfaccia **IKsControl** rende disponibili le proprietà, gli eventi e i metodi dei dispositivi di streaming kernel (KS) per le applicazioni in modalità utente.</span><span class="sxs-lookup"><span data-stu-id="a393b-105">The **IKsControl** interface makes the properties, events, and methods of kernel-streaming (KS) devices available to user-mode applications.</span></span> <span data-ttu-id="a393b-106">Di interesse principale per le applicazioni audio sono le proprietà di KS.</span><span class="sxs-lookup"><span data-stu-id="a393b-106">Of primary interest to audio applications are KS properties.</span></span> <span data-ttu-id="a393b-107">L'interfaccia **IKsControl** può essere usata in combinazione con l'API DeviceTopology e l'API MMDevice per accedere alle proprietà KS delle schede audio.</span><span class="sxs-lookup"><span data-stu-id="a393b-107">The **IKsControl** interface can be used in conjunction with the DeviceTopology API and the MMDevice API to access the KS properties of audio adapters.</span></span>

<span data-ttu-id="a393b-108">L'interfaccia [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) è progettata principalmente per l'uso da parte di fornitori di hardware che scrivono applicazioni del pannello di controllo per gestire l'hardware audio.</span><span class="sxs-lookup"><span data-stu-id="a393b-108">The [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface is intended primarily for use by hardware vendors who write control-panel applications to manage their audio hardware.</span></span> <span data-ttu-id="a393b-109">**IKsControl** è meno utile per le applicazioni audio generiche che non sono collegate a dispositivi hardware specifici.</span><span class="sxs-lookup"><span data-stu-id="a393b-109">**IKsControl** is less useful for general-purpose audio applications that are not tied to particular hardware devices.</span></span> <span data-ttu-id="a393b-110">Il motivo è che i fornitori di hardware implementano spesso meccanismi proprietari per accedere alle proprietà audio dei propri dispositivi.</span><span class="sxs-lookup"><span data-stu-id="a393b-110">The reason is that hardware vendors frequently implement proprietary mechanisms to access the audio properties of their devices.</span></span> <span data-ttu-id="a393b-111">Diversamente dall'API DeviceTopology, che nasconde le anomalie dei driver specifiche dell'hardware e fornisce un'interfaccia relativamente uniforme per l'accesso alle proprietà audio, le applicazioni usano **IKsControl** per comunicare direttamente con i driver.</span><span class="sxs-lookup"><span data-stu-id="a393b-111">In contrast to the DeviceTopology API, which hides hardware-specific driver quirks and provides a relatively uniform interface for accessing audio properties, applications use **IKsControl** to communicate directly with drivers.</span></span> <span data-ttu-id="a393b-112">Per ulteriori informazioni su **IKsControl**, vedere la documentazione di Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="a393b-112">For more information about **IKsControl**, see the Windows DDK documentation.</span></span>

<span data-ttu-id="a393b-113">Come illustrato nelle [topologie di dispositivo](device-topologies.md), una sottounità nella topologia di un dispositivo adapter potrebbe supportare una o più delle interfacce di controllo specifiche della funzione visualizzate nella colonna sinistra della tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="a393b-113">As discussed in [Device Topologies](device-topologies.md), a subunit in the topology of an adapter device might support one or more of the function-specific control interfaces shown in the left column of the following table.</span></span> <span data-ttu-id="a393b-114">Ogni voce nella colonna a destra della tabella è la proprietà KS che corrisponde all'interfaccia del controllo a sinistra.</span><span class="sxs-lookup"><span data-stu-id="a393b-114">Each entry in the right column of the table is the KS property that corresponds to the control interface on the left.</span></span> <span data-ttu-id="a393b-115">L'interfaccia di controllo fornisce un comodo accesso alla proprietà.</span><span class="sxs-lookup"><span data-stu-id="a393b-115">The control interface provides convenient access to the property.</span></span> <span data-ttu-id="a393b-116">La maggior parte dei driver audio utilizza le proprietà KS per rappresentare le funzionalità di elaborazione specifiche della funzione delle unità secondarie (dette anche nodi KS) nelle topologie delle schede audio.</span><span class="sxs-lookup"><span data-stu-id="a393b-116">Most audio drivers use KS properties to represent the function-specific processing capabilities of the subunits (also referred to as KS nodes) in the topologies of their audio adapters.</span></span> <span data-ttu-id="a393b-117">Per ulteriori informazioni sulle proprietà KS e sui nodi KS, vedere la documentazione di Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="a393b-117">For more information about KS properties and KS nodes, see the Windows DDK documentation.</span></span>



| <span data-ttu-id="a393b-118">Interfaccia di controllo</span><span class="sxs-lookup"><span data-stu-id="a393b-118">Control interface</span></span>                                          | <span data-ttu-id="a393b-119">KS (proprietà)</span><span class="sxs-lookup"><span data-stu-id="a393b-119">KS property</span></span>                        |
|------------------------------------------------------------|------------------------------------|
| [<span data-ttu-id="a393b-120">**IAudioAutoGainControl**</span><span class="sxs-lookup"><span data-stu-id="a393b-120">**IAudioAutoGainControl**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioautogaincontrol)     | <span data-ttu-id="a393b-121">KSPROPERTY \_ audio \_ AGC</span><span class="sxs-lookup"><span data-stu-id="a393b-121">KSPROPERTY\_AUDIO\_AGC</span></span>             |
| [<span data-ttu-id="a393b-122">**IAudioBass**</span><span class="sxs-lookup"><span data-stu-id="a393b-122">**IAudioBass**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiobass)                           | <span data-ttu-id="a393b-123">KSPROPERTY \_ audio \_ Bass</span><span class="sxs-lookup"><span data-stu-id="a393b-123">KSPROPERTY\_AUDIO\_BASS</span></span>            |
| [<span data-ttu-id="a393b-124">**IAudioChannelConfig**</span><span class="sxs-lookup"><span data-stu-id="a393b-124">**IAudioChannelConfig**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiochannelconfig)         | <span data-ttu-id="a393b-125">\_configurazione del \_ canale \_ audio KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="a393b-125">KSPROPERTY\_AUDIO\_CHANNEL\_CONFIG</span></span> |
| [<span data-ttu-id="a393b-126">**IAudioInputSelector**</span><span class="sxs-lookup"><span data-stu-id="a393b-126">**IAudioInputSelector**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioinputselector)         | <span data-ttu-id="a393b-127">\_ \_ origine Mux audio \_ KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="a393b-127">KSPROPERTY\_AUDIO\_MUX\_SOURCE</span></span>     |
| [<span data-ttu-id="a393b-128">**IAudioLoudness**</span><span class="sxs-lookup"><span data-stu-id="a393b-128">**IAudioLoudness**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudioloudness)                   | <span data-ttu-id="a393b-129">\_ \_ sonorità audio KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="a393b-129">KSPROPERTY\_AUDIO\_LOUDNESS</span></span>        |
| [<span data-ttu-id="a393b-130">**IAudioMidrange**</span><span class="sxs-lookup"><span data-stu-id="a393b-130">**IAudioMidrange**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiomidrange)                   | <span data-ttu-id="a393b-131">KSPROPERTY \_ audio \_ Mid</span><span class="sxs-lookup"><span data-stu-id="a393b-131">KSPROPERTY\_AUDIO\_MID</span></span>             |
| [<span data-ttu-id="a393b-132">**IAudioMute**</span><span class="sxs-lookup"><span data-stu-id="a393b-132">**IAudioMute**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiomute)                           | <span data-ttu-id="a393b-133">\_silenziamento audio \_ KSPROPERTY</span><span class="sxs-lookup"><span data-stu-id="a393b-133">KSPROPERTY\_AUDIO\_MUTE</span></span>            |
| [<span data-ttu-id="a393b-134">**IAudioOutputSelector**</span><span class="sxs-lookup"><span data-stu-id="a393b-134">**IAudioOutputSelector**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiooutputselector)       | <span data-ttu-id="a393b-135">KSPROPERTY \_ audio \_ demux \_ dest</span><span class="sxs-lookup"><span data-stu-id="a393b-135">KSPROPERTY\_AUDIO\_DEMUX\_DEST</span></span>     |
| [<span data-ttu-id="a393b-136">**IAudioPeakMeter**</span><span class="sxs-lookup"><span data-stu-id="a393b-136">**IAudioPeakMeter**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-iaudiopeakmeter)                 | <span data-ttu-id="a393b-137">KSPROPERTY \_ audio \_ PEAKMETER</span><span class="sxs-lookup"><span data-stu-id="a393b-137">KSPROPERTY\_AUDIO\_PEAKMETER</span></span>       |
| [<span data-ttu-id="a393b-138">**IAudioTreble**</span><span class="sxs-lookup"><span data-stu-id="a393b-138">**IAudioTreble**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiotreble)                       | <span data-ttu-id="a393b-139">KSPROPERTY \_ audio \_ acuti</span><span class="sxs-lookup"><span data-stu-id="a393b-139">KSPROPERTY\_AUDIO\_TREBLE</span></span>          |
| [<span data-ttu-id="a393b-140">**IAudioVolumeLevel**</span><span class="sxs-lookup"><span data-stu-id="a393b-140">**IAudioVolumeLevel**</span></span>](/windows/win32/api/devicetopology/nn-devicetopology-iaudiovolumelevel)             | <span data-ttu-id="a393b-141">KSPROPERTY \_ audio \_ VOLUMELEVEL</span><span class="sxs-lookup"><span data-stu-id="a393b-141">KSPROPERTY\_AUDIO\_VOLUMELEVEL</span></span>     |
| [<span data-ttu-id="a393b-142">**IDeviceSpecificProperty**</span><span class="sxs-lookup"><span data-stu-id="a393b-142">**IDeviceSpecificProperty**</span></span>](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicespecificproperty) | <span data-ttu-id="a393b-143">KSPROPERTY \_ audio \_ dev \_ specifico</span><span class="sxs-lookup"><span data-stu-id="a393b-143">KSPROPERTY\_AUDIO\_DEV\_SPECIFIC</span></span>   |



 

<span data-ttu-id="a393b-144">Le topologie di alcune schede audio possono contenere unità secondarie con proprietà KS non elencate nella tabella precedente.</span><span class="sxs-lookup"><span data-stu-id="a393b-144">The topologies of some audio adapters might contain subunits that have KS properties that are not listed in the preceding table.</span></span> <span data-ttu-id="a393b-145">Si supponga, ad esempio, che una chiamata al metodo [**IPart:: GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) per una determinata unità secondaria recuperi il valore GUID KSNODETYPE \_ tono.</span><span class="sxs-lookup"><span data-stu-id="a393b-145">For example, assume that a call to the [**IPart::GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) method for a particular subunit retrieves the GUID value KSNODETYPE\_TONE.</span></span> <span data-ttu-id="a393b-146">Questo GUID del sottotipo indica che l'unità secondaria supporta una o più delle proprietà KS seguenti:</span><span class="sxs-lookup"><span data-stu-id="a393b-146">This subtype GUID indicates that the subunit supports one or more of the following KS properties:</span></span>

-   <span data-ttu-id="a393b-147">KSPROPERTY \_ audio \_ Bass</span><span class="sxs-lookup"><span data-stu-id="a393b-147">KSPROPERTY\_AUDIO\_BASS</span></span>
-   <span data-ttu-id="a393b-148">KSPROPERTY \_ audio \_ Mid</span><span class="sxs-lookup"><span data-stu-id="a393b-148">KSPROPERTY\_AUDIO\_MID</span></span>
-   <span data-ttu-id="a393b-149">KSPROPERTY \_ audio \_ acuti</span><span class="sxs-lookup"><span data-stu-id="a393b-149">KSPROPERTY\_AUDIO\_TREBLE</span></span>
-   <span data-ttu-id="a393b-150">KSPROPERTY \_ audio \_ Bass \_ Boost</span><span class="sxs-lookup"><span data-stu-id="a393b-150">KSPROPERTY\_AUDIO\_BASS\_BOOST</span></span>

<span data-ttu-id="a393b-151">È possibile accedere alle prime tre proprietà in questo elenco tramite le interfacce di controllo visualizzate nella tabella precedente, ma la proprietà KSPROPERTY \_ audio \_ Bass \_ Boost non ha un'interfaccia di controllo corrispondente nell'API DeviceTopology.</span><span class="sxs-lookup"><span data-stu-id="a393b-151">The first three properties in this list can be accessed through the control interfaces that appear in the preceding table, but the KSPROPERTY\_AUDIO\_BASS\_BOOST property has no corresponding control interface in the DeviceTopology API.</span></span> <span data-ttu-id="a393b-152">Tuttavia, un'applicazione può usare l'interfaccia [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) per accedere a questa proprietà, se l'unità secondaria supporta la proprietà.</span><span class="sxs-lookup"><span data-stu-id="a393b-152">However, an application can use the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface to access this property, if the subunit supports the property.</span></span>

<span data-ttu-id="a393b-153">I passaggi seguenti sono necessari per accedere alla \_ Proprietà KSPROPERTY audio \_ Bass \_ Boost di un'unità secondaria di sottotipo KSNODETYPE \_ Tone:</span><span class="sxs-lookup"><span data-stu-id="a393b-153">The following steps are required to access the KSPROPERTY\_AUDIO\_BASS\_BOOST property of a subunit of subtype KSNODETYPE\_TONE:</span></span>

1.  <span data-ttu-id="a393b-154">Chiamare il metodo [**IConnector:: GetDeviceIdConnectedTo**](/windows/desktop/api/Devicetopology/nf-devicetopology-iconnector-getdeviceidconnectedto) o [**IDeviceTopology:: GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) per ottenere la stringa dell'ID dispositivo che identifica il dispositivo adapter.</span><span class="sxs-lookup"><span data-stu-id="a393b-154">Call the [**IConnector::GetDeviceIdConnectedTo**](/windows/desktop/api/Devicetopology/nf-devicetopology-iconnector-getdeviceidconnectedto) or [**IDeviceTopology::GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) method to obtain the device ID string that identifies the adapter device.</span></span> <span data-ttu-id="a393b-155">Questa stringa è simile a una [stringa ID endpoint](endpoint-id-strings.md), ad eccezione del fatto che identifica un dispositivo adapter anziché un dispositivo endpoint.</span><span class="sxs-lookup"><span data-stu-id="a393b-155">This string is similar to an [endpoint ID string](endpoint-id-strings.md), except that it identifies an adapter device instead of an endpoint device.</span></span> <span data-ttu-id="a393b-156">Per ulteriori informazioni sulla differenza tra un dispositivo adattatore e un dispositivo endpoint, vedere [dispositivi endpoint audio](audio-endpoint-devices.md).</span><span class="sxs-lookup"><span data-stu-id="a393b-156">For more information about the difference between an adapter device and an endpoint device, see [Audio Endpoint Devices](audio-endpoint-devices.md).</span></span>
2.  <span data-ttu-id="a393b-157">Ottenere l'interfaccia [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) del dispositivo adapter chiamando il metodo [**IMMDeviceEnumerator:: GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) con la stringa ID del dispositivo.</span><span class="sxs-lookup"><span data-stu-id="a393b-157">Obtain the [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface of the adapter device by calling the [**IMMDeviceEnumerator::GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) method with the device ID string.</span></span> <span data-ttu-id="a393b-158">Questa interfaccia **IMMDevice** è la stessa dell'interfaccia descritta nell' **interfaccia IMMDevice**, ma rappresenta un dispositivo adapter anziché un dispositivo endpoint.</span><span class="sxs-lookup"><span data-stu-id="a393b-158">This **IMMDevice** interface is the same as the interface described in **IMMDevice Interface**, but it represents an adapter device instead of an endpoint device.</span></span>
3.  <span data-ttu-id="a393b-159">Ottenere l'interfaccia [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) sull'unità secondaria chiamando il metodo [**IMMDevice:: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) con il parametro *IID* impostato su **REFIID** IID \_ IKsControl.</span><span class="sxs-lookup"><span data-stu-id="a393b-159">Obtain the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface on the subunit by calling the [**IMMDevice::Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) method with parameter *iid* set to **REFIID** IID\_IKsControl.</span></span> <span data-ttu-id="a393b-160">Si noti che le interfacce supportate da questo metodo **Activate** , ovvero per un dispositivo adattatore, sono diverse dalle interfacce supportate dal metodo **Activate** per un dispositivo endpoint.</span><span class="sxs-lookup"><span data-stu-id="a393b-160">Note that the interfaces supported by this **Activate** method, which is for an adapter device, are different from the interfaces supported by the **Activate** method for an endpoint device.</span></span> <span data-ttu-id="a393b-161">In particolare, il metodo **Activate** per un dispositivo adapter supporta **IKsControl**.</span><span class="sxs-lookup"><span data-stu-id="a393b-161">In particular, the **Activate** method for an adapter device supports **IKsControl**.</span></span>
4.  <span data-ttu-id="a393b-162">Chiamare il metodo [**IPart:: Getlocalid**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getlocalid) per ottenere l'ID locale della sottounità.</span><span class="sxs-lookup"><span data-stu-id="a393b-162">Call the [**IPart::GetLocalId**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getlocalid) method to obtain the local ID of the subunit.</span></span>
5.  <span data-ttu-id="a393b-163">Costruire una richiesta di proprietà KS.</span><span class="sxs-lookup"><span data-stu-id="a393b-163">Construct a KS property request.</span></span> <span data-ttu-id="a393b-164">L'ID del nodo KS richiesto per la richiesta è contenuto nei 16 bit meno significativi dell'ID locale ottenuto nel passaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="a393b-164">The KS node ID required for the request is contained in the 16 least-significant bits of the local ID obtained in the previous step.</span></span>
6.  <span data-ttu-id="a393b-165">Inviare la richiesta di proprietà KS al driver audio chiamando il metodo [**IKsControl:: KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) .</span><span class="sxs-lookup"><span data-stu-id="a393b-165">Send the KS property request to the audio driver by calling the [**IKsControl::KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) method.</span></span> <span data-ttu-id="a393b-166">Per ulteriori informazioni su questo metodo, vedere la documentazione di Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="a393b-166">For more information about this method, see the Windows DDK documentation.</span></span>

<span data-ttu-id="a393b-167">L'esempio di codice seguente recupera il valore della \_ Proprietà KSPROPERTY audio \_ Bass \_ Boost da un'unità secondaria di sottotipo KSNODETYPE \_ Tone:</span><span class="sxs-lookup"><span data-stu-id="a393b-167">The following code example retrieves the value of the KSPROPERTY\_AUDIO\_BASS\_BOOST property from a subunit of subtype KSNODETYPE\_TONE:</span></span>


```C++
//-----------------------------------------------------------
// This function calls the IKsControl::Property method to get
// the value of the KSPROPERTY_AUDIO_BASS_BOOST property of
// a subunit. Parameter pPart should point to a part that is
// a subunit with a subtype GUID value of KSNODETYPE_TONE.
//-----------------------------------------------------------
#define PARTID_MASK 0x0000ffff
#define EXIT_ON_ERROR(hres)  \
              if (FAILED(hres)) { goto Exit; }
#define SAFE_RELEASE(punk)  \
              if ((punk) != NULL)  \
                { (punk)->Release(); (punk) = NULL; }

const IID IID_IKsControl = __uuidof(IKsControl);

HRESULT GetBassBoost(IMMDeviceEnumerator *pEnumerator,
                     IPart *pPart, BOOL *pbValue)
{
    HRESULT hr;
    IDeviceTopology *pTopology = NULL;
    IMMDevice *pPnpDevice = NULL;
    IKsControl *pKsControl = NULL;
    LPWSTR pwszDeviceId = NULL;

    if (pEnumerator == NULL || pPart == NULL || pbValue == NULL)
    {
        return E_INVALIDARG;
    }

    // Get the topology object for the adapter device that contains
    // the subunit represented by the IPart interface.
    hr = pPart->GetTopologyObject(&pTopology);
    EXIT_ON_ERROR(hr)

    // Get the device ID string that identifies the adapter device.
    hr = pTopology->GetDeviceId(&pwszDeviceId);
    EXIT_ON_ERROR(hr)

    // Get the IMMDevice interface of the adapter device object.
    hr = pEnumerator->GetDevice(pwszDeviceId, &pPnpDevice);
    EXIT_ON_ERROR(hr)

    // Activate an IKsControl interface on the adapter device object.
    hr = pPnpDevice->Activate(IID_IKsControl, CLSCTX_ALL, NULL, (void**)&pKsControl);
    EXIT_ON_ERROR(hr)

    // Get the local ID of the subunit (contains the KS node ID).
    UINT localId = 0;
    hr = pPart->GetLocalId(&localId);
    EXIT_ON_ERROR(hr)

    KSNODEPROPERTY_AUDIO_CHANNEL ksprop;
    ZeroMemory(&ksprop, sizeof(ksprop));
    ksprop.NodeProperty.Property.Set = KSPROPSETID_Audio;
    ksprop.NodeProperty.Property.Id = KSPROPERTY_AUDIO_BASS_BOOST;
    ksprop.NodeProperty.Property.Flags = KSPROPERTY_TYPE_GET | KSPROPERTY_TYPE_TOPOLOGY;
    ksprop.NodeProperty.NodeId = localId & PARTID_MASK;
    ksprop.Channel = 0;

    // Send the property request.to the device driver.
    BOOL bValue = FALSE;
    ULONG valueSize;
    hr = pKsControl->KsProperty(
                         &ksprop.NodeProperty.Property, sizeof(ksprop),
                         &bValue, sizeof(bValue), &valueSize);
    EXIT_ON_ERROR(hr)

    *pbValue = bValue;

Exit:
    SAFE_RELEASE(pTopology)
    SAFE_RELEASE(pPnpDevice)
    SAFE_RELEASE(pKsControl)
    CoTaskMemFree(pwszDeviceId);
    return hr;
}

```



<span data-ttu-id="a393b-168">Nell'esempio di codice precedente, la funzione GetBassBoost accetta i tre parametri seguenti:</span><span class="sxs-lookup"><span data-stu-id="a393b-168">In the preceding code example, the GetBassBoost function takes the following three parameters:</span></span>

-   <span data-ttu-id="a393b-169">`pEnumerator` punta all'interfaccia [**IMMDeviceEnumerator**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdeviceenumerator) di un enumeratore di endpoint audio.</span><span class="sxs-lookup"><span data-stu-id="a393b-169">`pEnumerator` points to the [**IMMDeviceEnumerator**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdeviceenumerator) interface of an audio endpoint enumerator.</span></span>
-   <span data-ttu-id="a393b-170">`pPart` punta all'interfaccia [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) di un'unità secondaria che ha un sottotipo di tono KSNODETYPE \_ .</span><span class="sxs-lookup"><span data-stu-id="a393b-170">`pPart` points to the [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) interface of a subunit that has a subtype of KSNODETYPE\_TONE.</span></span>
-   <span data-ttu-id="a393b-171">`pbValue` punta a una variabile **bool** in cui la funzione scrive il valore della proprietà.</span><span class="sxs-lookup"><span data-stu-id="a393b-171">`pbValue` points to a **BOOL** variable into which the function writes the property value.</span></span>

<span data-ttu-id="a393b-172">Un programma chiama GetBassBoost solo dopo la chiamata a [**IPart:: GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) e determina che il sottotipo dell'unità secondaria è KSNODETYPE \_ tono.</span><span class="sxs-lookup"><span data-stu-id="a393b-172">A program calls GetBassBoost only after it calls [**IPart::GetSubType**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-getsubtype) and determines that the subtype of the subunit is KSNODETYPE\_TONE.</span></span> <span data-ttu-id="a393b-173">Il valore della proprietà è **true** se è abilitata la funzionalità Bass Boost.</span><span class="sxs-lookup"><span data-stu-id="a393b-173">The property value is **TRUE** if bass boost is enabled.</span></span> <span data-ttu-id="a393b-174">È **false** se Bass Boost è disabilitato.</span><span class="sxs-lookup"><span data-stu-id="a393b-174">It is **FALSE** if bass boost is disabled.</span></span>

<span data-ttu-id="a393b-175">All'inizio della funzione GetBassBoost, la chiamata al metodo [**IPart:: GetTopologyObject**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-gettopologyobject) Ottiene l'interfaccia [**IDeviceTopology**](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicetopology) del dispositivo adattatore che contiene la \_ sottounità tono KSNODETYPE.</span><span class="sxs-lookup"><span data-stu-id="a393b-175">At the beginning of the GetBassBoost function, the call to the [**IPart::GetTopologyObject**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-gettopologyobject) method obtains the [**IDeviceTopology**](/windows/desktop/api/Devicetopology/nn-devicetopology-idevicetopology) interface of the adapter device that contains the KSNODETYPE\_TONE subunit.</span></span> <span data-ttu-id="a393b-176">La chiamata al metodo [**IDeviceTopology:: GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) recupera la stringa dell'ID dispositivo che identifica il dispositivo adapter.</span><span class="sxs-lookup"><span data-stu-id="a393b-176">The [**IDeviceTopology::GetDeviceId**](/windows/desktop/api/Devicetopology/nf-devicetopology-idevicetopology-getdeviceid) method call retrieves the device ID string that identifies the adapter device.</span></span> <span data-ttu-id="a393b-177">La chiamata al metodo [**IMMDeviceEnumerator:: GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) accetta la stringa ID del dispositivo come parametro di input e recupera l'interfaccia [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) del dispositivo adapter.</span><span class="sxs-lookup"><span data-stu-id="a393b-177">The [**IMMDeviceEnumerator::GetDevice**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdevice) method call takes the device ID string as an input parameter, and retrieves the [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface of the adapter device.</span></span> <span data-ttu-id="a393b-178">Successivamente, la chiamata al metodo [**IMMDevice:: Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) recupera l'interfaccia [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) dell'unità secondaria.</span><span class="sxs-lookup"><span data-stu-id="a393b-178">Next, the [**IMMDevice::Activate**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdevice-activate) method call retrieves the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface of the subunit.</span></span> <span data-ttu-id="a393b-179">Per ulteriori informazioni sull'interfaccia **IKsControl** , vedere la documentazione di Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="a393b-179">For more information about the **IKsControl** interface, see the Windows DDK documentation.</span></span>

<span data-ttu-id="a393b-180">Successivamente, l'esempio di codice precedente crea una struttura del [**\_ \_ canale audio KSNODEPROPERTY**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) che descrive la proprietà Bass-Boost.</span><span class="sxs-lookup"><span data-stu-id="a393b-180">Next, the preceding code example creates a [**KSNODEPROPERTY\_AUDIO\_CHANNEL**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) structure that describes the bass-boost property.</span></span> <span data-ttu-id="a393b-181">Nell'esempio di codice viene passato un puntatore alla struttura al metodo [**IKsControl:: KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) , che usa le informazioni nella struttura per recuperare il valore della proprietà.</span><span class="sxs-lookup"><span data-stu-id="a393b-181">The code example passes a pointer to the structure to the [**IKsControl::KsProperty**](/windows-hardware/drivers/ddi/ksproxy/nf-ksproxy-ikscontrol-ksproperty) method, which uses the information in the structure to retrieve the property value.</span></span> <span data-ttu-id="a393b-182">Per ulteriori informazioni sulla struttura **del \_ \_ canale audio KSNODEPROPERTY** e sul metodo **IKsControl:: KsProperty** , vedere la documentazione di Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="a393b-182">For more information about the **KSNODEPROPERTY\_AUDIO\_CHANNEL** structure and the **IKsControl::KsProperty** method, see the Windows DDK documentation.</span></span>

<span data-ttu-id="a393b-183">L'hardware audio in genere assegna uno stato di incremento basso separato a ogni canale in un flusso audio.</span><span class="sxs-lookup"><span data-stu-id="a393b-183">Audio hardware typically assigns a separate bass-boost state to each channel in an audio stream.</span></span> <span data-ttu-id="a393b-184">In linea di base, è possibile abilitare la funzionalità Bass Boost per alcuni canali e disabilitarli per altri.</span><span class="sxs-lookup"><span data-stu-id="a393b-184">In principle, bass boost can be enabled for some channels and disabled for others.</span></span> <span data-ttu-id="a393b-185">La struttura del [**\_ \_ canale audio KSNODEPROPERTY**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) contiene un membro del **canale** che specifica il numero del canale.</span><span class="sxs-lookup"><span data-stu-id="a393b-185">The [**KSNODEPROPERTY\_AUDIO\_CHANNEL**](/windows-hardware/drivers/ddi/ksmedia/ns-ksmedia-ksnodeproperty_audio_channel) structure contains a **Channel** member that specifies the channel number.</span></span> <span data-ttu-id="a393b-186">Se un flusso contiene *N* canali, i canali sono numerati da 0 a *n*-1.</span><span class="sxs-lookup"><span data-stu-id="a393b-186">If a stream contains *N* channels, the channels are numbered from 0 to *N*— 1.</span></span> <span data-ttu-id="a393b-187">Nell'esempio di codice precedente viene ottenuto il valore della proprietà Bass-Boost solo per il canale 0.</span><span class="sxs-lookup"><span data-stu-id="a393b-187">The preceding code example gets the value of the bass-boost property for channel 0 only.</span></span> <span data-ttu-id="a393b-188">Questa implementazione presuppone implicitamente che le proprietà Bass-Boost per tutti i canali siano impostate in modo uniforme sullo stesso stato.</span><span class="sxs-lookup"><span data-stu-id="a393b-188">This implementation implicitly assumes that the bass-boost properties for all of the channels are set uniformly to the same state.</span></span> <span data-ttu-id="a393b-189">Quindi, la lettura della proprietà Bass-Boost per Channel 0 è sufficiente per determinare il valore della proprietà Bass-Boost per il flusso.</span><span class="sxs-lookup"><span data-stu-id="a393b-189">Thus, reading the bass-boost property for channel 0 is sufficient to determine the bass-boost property value for the stream.</span></span> <span data-ttu-id="a393b-190">Per coerenza con questo presupposto, una funzione corrispondente per impostare la proprietà Bass-Boost imposta tutti i canali sullo stesso valore della proprietà Bass-Boost.</span><span class="sxs-lookup"><span data-stu-id="a393b-190">To be consistent with this assumption, a corresponding function to set the bass-boost property would set all channels to the same bass-boost property value.</span></span> <span data-ttu-id="a393b-191">Si tratta di convenzioni ragionevoli, ma non tutti i fornitori di hardware le seguono necessariamente.</span><span class="sxs-lookup"><span data-stu-id="a393b-191">These are reasonable conventions, but not all hardware vendors necessarily follow them.</span></span> <span data-ttu-id="a393b-192">Ad esempio, un fornitore potrebbe fornire un'applicazione del pannello di controllo che Abilita il boosting dei bassi solo per i canali che guidano gli altoparlanti a intervalli completi.</span><span class="sxs-lookup"><span data-stu-id="a393b-192">For example, a vendor might supply a control-panel application that enables bass boost only for channels that drive full-range speakers.</span></span> <span data-ttu-id="a393b-193">Un relatore di un intervallo completo è in grado di riprodurre suoni nell'intervallo completo, da bassi a acuti. In tal caso, il valore della proprietà recuperato dall'esempio di codice precedente potrebbe non rappresentare accuratamente lo stato di Boost Bass del flusso.</span><span class="sxs-lookup"><span data-stu-id="a393b-193">(A full-range speaker is capable of playing sounds over the full range from bass to treble.) In that case, the property value retrieved by the preceding code example might not accurately represent the bass-boost state of the stream.</span></span>

<span data-ttu-id="a393b-194">I client che utilizzano le interfacce di controllo elencate nella tabella precedente possono chiamare il metodo [**IPart:: RegisterControlChangeCallback**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-registercontrolchangecallback) per eseguire la registrazione per le notifiche quando cambia il valore di un parametro di controllo.</span><span class="sxs-lookup"><span data-stu-id="a393b-194">Clients that use the control interfaces listed in the preceding table can call the [**IPart::RegisterControlChangeCallback**](/windows/desktop/api/Devicetopology/nf-devicetopology-ipart-registercontrolchangecallback) method to register for notifications when the value of a control parameter changes.</span></span> <span data-ttu-id="a393b-195">Si noti che l'interfaccia [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) non fornisce un mezzo simile per la registrazione dei client per le notifiche in caso di modifica del valore di una proprietà.</span><span class="sxs-lookup"><span data-stu-id="a393b-195">Note that the [**IKsControl**](/windows-hardware/drivers/ddi/ksproxy/nn-ksproxy-ikscontrol) interface does not provide a similar means for clients to register for notifications when a property value changes.</span></span> <span data-ttu-id="a393b-196">Se **IKsControl** supportava le notifiche di modifica delle proprietà, potrebbe informare un'applicazione quando un'altra applicazione ha modificato il valore di una proprietà.</span><span class="sxs-lookup"><span data-stu-id="a393b-196">If **IKsControl** did support property-change notifications, it could inform an application when another application changed a property value.</span></span> <span data-ttu-id="a393b-197">Tuttavia, a differenza dei controlli usati più di frequente monitorati tramite le notifiche di [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) , le proprietà gestite da **IKsControl** sono destinate principalmente all'uso da parte dei fornitori di hardware e tali proprietà sono soggette a modifiche solo dalle applicazioni del pannello di controllo scritte dai fornitori.</span><span class="sxs-lookup"><span data-stu-id="a393b-197">However, in contrast to the more commonly used controls that are monitored through [**IPart**](/windows/desktop/api/Devicetopology/nn-devicetopology-ipart) notifications, the properties managed by **IKsControl** are intended primarily for use by hardware vendors, and those properties are likely to be changed only by control-panel applications written by the vendors.</span></span> <span data-ttu-id="a393b-198">Se un'applicazione deve rilevare le modifiche alle proprietà apportate da un'altra applicazione, può rilevare le modifiche eseguendo periodicamente il polling del valore della proprietà tramite **IKsControl**.</span><span class="sxs-lookup"><span data-stu-id="a393b-198">If an application must detect property changes made by another application, it can detect the changes by periodically polling the property value through **IKsControl**.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a393b-199">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="a393b-199">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a393b-200">Guida per programmatori</span><span class="sxs-lookup"><span data-stu-id="a393b-200">Programming Guide</span></span>](programming-guide.md)
</dt> </dl>

 

 
