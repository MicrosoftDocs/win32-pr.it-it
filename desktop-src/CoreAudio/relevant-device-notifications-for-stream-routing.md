---
description: Informazioni sulle notifiche per il routing di flusso. Le API implementano il routing di flusso gestendo il passaggio del flusso a un nuovo endpoint audio predefinito.
ms.assetid: caf831bb-b8de-467f-bdb4-f9f8991dc7a8
title: Notifiche pertinenti per il routing di flusso
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d1a843c1d8b5cfd740ada5049cb9428e7745072d
ms.sourcegitcommit: 51ef825fb48f15e1aa30e8795988f10dc2b2155c
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/14/2021
ms.locfileid: "112068527"
---
# <a name="relevant-notifications-for-stream-routing"></a><span data-ttu-id="982d1-104">Notifiche pertinenti per il routing di flusso</span><span class="sxs-lookup"><span data-stu-id="982d1-104">Relevant Notifications for Stream Routing</span></span>

<span data-ttu-id="982d1-105">In Windows 7 le API della piattaforma di alto livello che usano LE API audio di base, ad esempio le API Media Foundation, DirectSound e Wave, implementano la funzionalità di routing del flusso gestendo il passaggio del flusso da un dispositivo esistente a un nuovo endpoint audio predefinito.</span><span class="sxs-lookup"><span data-stu-id="982d1-105">In Windows 7, high-level platform APIs that use Core Audio APIs, such as Media Foundation, DirectSound, and Wave APIs, implement the stream routing feature by handling stream switching from an existing device to a new default audio endpoint.</span></span> <span data-ttu-id="982d1-106">Le applicazioni multimediali che usano queste API usano il comportamento di routing del flusso senza alcuna modifica all'origine.</span><span class="sxs-lookup"><span data-stu-id="982d1-106">Media applications that use these APIs use the stream routing behavior without any modifications to the source.</span></span> <span data-ttu-id="982d1-107">I client WASAPI diretti possono usare le notifiche inviate dai componenti Audio core e implementare la funzionalità di routing del flusso.</span><span class="sxs-lookup"><span data-stu-id="982d1-107">Direct WASAPI clients can use the notifications sent by Core Audio components and implement the stream routing feature.</span></span>

<span data-ttu-id="982d1-108">Per implementare la funzionalità di routing del flusso, un client deve restare in ascolto di due tipi di eventi: notifiche di modifica del dispositivo e notifiche di disconnessione della sessione.</span><span class="sxs-lookup"><span data-stu-id="982d1-108">To implement the stream routing feature, a client must listen for two types of events: device change notifications and session disconnect notifications.</span></span> <span data-ttu-id="982d1-109">Nell'implementazione fornita dalle API di alto livello, questi eventi vengono inviati per gli endpoint dispositivo predefiniti creati chiamando [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span><span class="sxs-lookup"><span data-stu-id="982d1-109">In the implementation provided by the high-level APIs, these events are sent for default device endpoints created by calling [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint).</span></span> <span data-ttu-id="982d1-110">Per altre informazioni, vedere [Recupero dell'endpoint del dispositivo per il routing di flusso.](getting-the-default-device-endpoint-for-stream-routing.md)</span><span class="sxs-lookup"><span data-stu-id="982d1-110">For more information, see [Getting the Device Endpoint for Stream Routing](getting-the-default-device-endpoint-for-stream-routing.md).</span></span>

<span data-ttu-id="982d1-111">Il componente Audio principale MMDeviceAPI recapita callback di notifica quando i dispositivi audio vengono aggiunti, rimossi o modificati.</span><span class="sxs-lookup"><span data-stu-id="982d1-111">The Core Audio component MMDeviceAPI delivers notification callbacks when audio devices are added, removed, or modified.</span></span> <span data-ttu-id="982d1-112">Le modifiche al formato e alla sessione audio vengono segnalate come eventi tramite WASAPI.</span><span class="sxs-lookup"><span data-stu-id="982d1-112">The format and audio session changes are reported as events through WASAPI.</span></span>

## <a name="device-change-notifications"></a><span data-ttu-id="982d1-113">Notifiche di modifica del dispositivo</span><span class="sxs-lookup"><span data-stu-id="982d1-113">Device Change Notifications</span></span>

<span data-ttu-id="982d1-114">MMDeviceAPI genera eventi quando i dispositivi audio vengono aggiunti, rimossi o modificati.</span><span class="sxs-lookup"><span data-stu-id="982d1-114">MMDeviceAPI raises events when audio devices are added, removed, or modified.</span></span> <span data-ttu-id="982d1-115">Se il client deve fornire funzionalità di routing di flusso, deve implementare [**l'interfaccia IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) e registrarne l'implementazione con MMDeviceAPI.</span><span class="sxs-lookup"><span data-stu-id="982d1-115">If the client is to provide stream routing functionality, it must implement the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) interface and register its implementation with MMDeviceAPI.</span></span>

<span data-ttu-id="982d1-116">Per ottenere le notifiche di modifica del dispositivo, il client deve eseguire le attività seguenti:</span><span class="sxs-lookup"><span data-stu-id="982d1-116">To get device change notifications, the client must perform the following tasks:</span></span>

-   <span data-ttu-id="982d1-117">Implementare [**l'interfaccia IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) per gestire le notifiche di modifica del dispositivo inviate da MMDeviceAPI.</span><span class="sxs-lookup"><span data-stu-id="982d1-117">Implement the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) interface to handle device change notifications sent by MMDeviceAPI.</span></span>
-   <span data-ttu-id="982d1-118">Registrare [**l'implementazione di IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) con MMDeviceAPI chiamando il [**metodo IMMDeviceEnumerator::RegisterEndpointNotificationCallback.**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback)</span><span class="sxs-lookup"><span data-stu-id="982d1-118">Register the [**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) implementation with MMDeviceAPI by calling the [**IMMDeviceEnumerator::RegisterEndpointNotificationCallback**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-registerendpointnotificationcallback) method.</span></span>

<span data-ttu-id="982d1-119">Dopo la registrazione dell'implementazione del client di queste interfacce, il client riceve le notifiche sotto forma di callback tramite i metodi di queste interfacce.</span><span class="sxs-lookup"><span data-stu-id="982d1-119">After the client's implementation of these interfaces is registered, the client receives notifications in the form of callbacks through the methods of these interfaces.</span></span> <span data-ttu-id="982d1-120">I [**metodi IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) vengono chiamati da MMDeviceAPI quando genera eventi a livello di endpoint (modifiche dello stato dell'endpoint, nuovi arrivi di endpoint, eliminazioni di endpoint, modifiche dell'endpoint predefinite e modifiche alle proprietà dell'endpoint).</span><span class="sxs-lookup"><span data-stu-id="982d1-120">[**IMMNotificationClient**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immnotificationclient) methods are called by MMDeviceAPI when it raises endpoint-level events (endpoint state changes, new endpoint arrivals, endpoint deletions, default endpoint changes, and endpoint property changes).</span></span>

<span data-ttu-id="982d1-121">Se il client vuole fornire il routing di flusso per il dispositivo predefinito, il client deve implementare il comportamento di modifica del dispositivo quando riceve la notifica tramite il callback [**IMMNotificationClient::OnDefaultDeviceChanged.**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged)</span><span class="sxs-lookup"><span data-stu-id="982d1-121">If the client wants to provide stream routing for the default device, the client must implement the device change behavior when it receives the notification through the [**IMMNotificationClient::OnDefaultDeviceChanged**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immnotificationclient-ondefaultdevicechanged) callback.</span></span>

## <a name="audio-session-change-notifications"></a><span data-ttu-id="982d1-122">Notifiche di modifica della sessione audio</span><span class="sxs-lookup"><span data-stu-id="982d1-122">Audio Session Change Notifications</span></span>

<span data-ttu-id="982d1-123">Le modifiche della sessione audio e le modifiche di formato vengono segnalate come eventi di sessione audio tramite WASAPI.</span><span class="sxs-lookup"><span data-stu-id="982d1-123">Audio session changes and format changes are reported as audio session events through WASAPI.</span></span> <span data-ttu-id="982d1-124">Un client WASAPI implementa [**l'interfaccia IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) e registra l'implementazione con WASAPI.</span><span class="sxs-lookup"><span data-stu-id="982d1-124">A WASAPI client implements the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface and registers the implementation with WASAPI.</span></span>

<span data-ttu-id="982d1-125">Per ottenere le notifiche di modifica della sessione audio, il client deve eseguire le attività seguenti:</span><span class="sxs-lookup"><span data-stu-id="982d1-125">To get audio session change notifications, the client must perform the following tasks:</span></span>

-   <span data-ttu-id="982d1-126">Implementare [**l'interfaccia IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) per gestire le notifiche di modifica del formato inviate da WASAPI.</span><span class="sxs-lookup"><span data-stu-id="982d1-126">Implement the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface to handle format change notifications sent by WASAPI.</span></span>
-   <span data-ttu-id="982d1-127">Registrare [**l'implementazione di IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) con WASAPI chiamando il [**metodo IAudioSessionControl::RegisterAudioSessionNotification.**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification)</span><span class="sxs-lookup"><span data-stu-id="982d1-127">Register the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) implementation with WASAPI by calling the [**IAudioSessionControl::RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) method.</span></span>

<span data-ttu-id="982d1-128">[**I metodi IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) vengono chiamati da WASAPI quando si verificano modifiche della sessione audio.</span><span class="sxs-lookup"><span data-stu-id="982d1-128">[**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) methods are called by WASAPI when audio session changes occur.</span></span> <span data-ttu-id="982d1-129">Questi eventi vengono generati quando cambia il nome visualizzato, il percorso dell'icona, il volume, il parametro di raggruppamento o lo stato della sessione.</span><span class="sxs-lookup"><span data-stu-id="982d1-129">These events are raised when the session's display name, icon path, volume, grouping parameter, or state changes.</span></span>

<span data-ttu-id="982d1-130">Per implementare la funzionalità di routing del flusso, il client deve attendere la notifica di disconnessione sessione.</span><span class="sxs-lookup"><span data-stu-id="982d1-130">To implement the stream routing feature, the client must wait for the session-disconnect notification.</span></span> <span data-ttu-id="982d1-131">Quando una sessione audio viene disconnessa o il formato di un dispositivo viene modificato, WASAPI invia le notifiche client sotto forma di callback tramite [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected).</span><span class="sxs-lookup"><span data-stu-id="982d1-131">When an audio session is disconnected or a device's format is changed, WASAPI sends the client notifications in the form of callbacks through [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected).</span></span> <span data-ttu-id="982d1-132">Con la notifica di disconnessione, WASAPI invia anche un valore che indica il motivo per cui la sessione è stata disconnessa.</span><span class="sxs-lookup"><span data-stu-id="982d1-132">With the disconnection notification, WASAPI also sends a value that indicates why the session was disconnected.</span></span> <span data-ttu-id="982d1-133">Ciò può verificarsi per diversi motivi, ad esempio la rimozione del dispositivo, l'arresto del server e così via.</span><span class="sxs-lookup"><span data-stu-id="982d1-133">This can occur for several reasons, such as the device was removed, the server stopped, and so on.</span></span> <span data-ttu-id="982d1-134">Per l'elenco completo dei motivi, vedere **l'enumerazione AudioSessionDisconnectReason** definita in AudioPolicy.h.</span><span class="sxs-lookup"><span data-stu-id="982d1-134">For the complete list of reasons, see the **AudioSessionDisconnectReason** enumeration defined in AudioPolicy.h.</span></span> <span data-ttu-id="982d1-135">Se il dispositivo predefinito cambia, il client deve attendere le notifiche (se non sono già state ricevute) che sono accompagnate da un **valore DisconnectReasonDeviceRemoval.**</span><span class="sxs-lookup"><span data-stu-id="982d1-135">If the default device changes, the client must wait for the notifications (if they have not already been received) that are accompanied with a **DisconnectReasonDeviceRemoval** value.</span></span> <span data-ttu-id="982d1-136">In risposta a tali notifiche, il client potrebbe riaprire il flusso nel nuovo dispositivo predefinito.</span><span class="sxs-lookup"><span data-stu-id="982d1-136">In response to such notifications, the client might reopen the stream on the new default device.</span></span>

<span data-ttu-id="982d1-137">Poiché tutte queste operazioni sono asychronous, l'ordine in cui l'applicazione riceve le notifiche non può essere previsto.</span><span class="sxs-lookup"><span data-stu-id="982d1-137">Because all of these operations are asychronous, the order in which the application receives notifications cannnot be predicted.</span></span> <span data-ttu-id="982d1-138">Tuttavia, in genere, l'applicazione riceve il **valore AudioSessionDisconnect** prima della notifica di modifica del dispositivo predefinita.</span><span class="sxs-lookup"><span data-stu-id="982d1-138">However, typically, the application receives **AudioSessionDisconnect** value before the default device change notification.</span></span>

### <a name="format-change-notifications"></a><span data-ttu-id="982d1-139">Formattare le notifiche di modifica</span><span class="sxs-lookup"><span data-stu-id="982d1-139">Format Change Notifications</span></span>

<span data-ttu-id="982d1-140">Le modifiche al formato audio si verificano quando cambia il formato del flusso.</span><span class="sxs-lookup"><span data-stu-id="982d1-140">Audio format changes occur when the format of the stream changes.</span></span> <span data-ttu-id="982d1-141">Ciò può verificarsi quando l'utente  seleziona un nuovo formato nel pannello di controllo Audio o il nuovo dispositivo predefinito supporta un nuovo formato, ad esempio HDMI o alcune interfacce audio professionali con una regolazione manuale della frequenza di campionamento.</span><span class="sxs-lookup"><span data-stu-id="982d1-141">This can occur when the user selects a new format in the **Sound** control panel or the new default device supports a new format (for example, HDMI or certain professional audio interfaces with a manual sample-rate adjustment).</span></span> <span data-ttu-id="982d1-142">Per notificare al client questi tipi di modifiche di formato, WASAPI invia una notifica di sessione dall'implementazione registrata di [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) con un motivo di disconnessione **di DisconnectReasonFormatChanged.**</span><span class="sxs-lookup"><span data-stu-id="982d1-142">To notify the client about these types of format changes, WASAPI sends a session notification by the registered implementation of [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) with a disconnect reason of **DisconnectReasonFormatChanged**.</span></span> <span data-ttu-id="982d1-143">Il client può gestire la notifica riaprendo il flusso nel nuovo formato.</span><span class="sxs-lookup"><span data-stu-id="982d1-143">The client can handle the notification by reopening the stream in the new format.</span></span>

## <a name="related-topics"></a><span data-ttu-id="982d1-144">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="982d1-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="982d1-145">Informazioni sull'API MMDevice</span><span class="sxs-lookup"><span data-stu-id="982d1-145">About MMDevice API</span></span>](mmdevice-api.md)
</dt> <dt>

[<span data-ttu-id="982d1-146">Informazioni su WASAPI</span><span class="sxs-lookup"><span data-stu-id="982d1-146">About WASAPI</span></span>](wasapi.md)
</dt> <dt>

[<span data-ttu-id="982d1-147">Routing di flusso</span><span class="sxs-lookup"><span data-stu-id="982d1-147">Stream Routing</span></span>](stream-routing.md)
</dt> </dl>

 

 



