---
description: Registrazione loopback
ms.assetid: 71c567f7-fffa-4b75-897a-63ed30c4c9b0
title: Registrazione loopback
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 374da7497096118905f5e4c79bbacda832a42a7b
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103966256"
---
# <a name="loopback-recording"></a><span data-ttu-id="65a2e-103">Registrazione loopback</span><span class="sxs-lookup"><span data-stu-id="65a2e-103">Loopback Recording</span></span>

<span data-ttu-id="65a2e-104">In modalità loopback un client di WASAPI è in grado di acquisire il flusso audio che viene riprodotto da un dispositivo endpoint di rendering.</span><span class="sxs-lookup"><span data-stu-id="65a2e-104">In loopback mode, a client of WASAPI can capture the audio stream that is being played by a rendering endpoint device.</span></span> <span data-ttu-id="65a2e-105">Per aprire un flusso in modalità loopback, il client deve:</span><span class="sxs-lookup"><span data-stu-id="65a2e-105">To open a stream in loopback mode, the client must:</span></span>

-   <span data-ttu-id="65a2e-106">Ottenere un'interfaccia [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) per il dispositivo dell'endpoint di rendering.</span><span class="sxs-lookup"><span data-stu-id="65a2e-106">Obtain an [**IMMDevice**](/windows/desktop/api/Mmdeviceapi/nn-mmdeviceapi-immdevice) interface for the rendering endpoint device.</span></span>
-   <span data-ttu-id="65a2e-107">Inizializzare un flusso di acquisizione in modalità loopback sul dispositivo dell'endpoint di rendering.</span><span class="sxs-lookup"><span data-stu-id="65a2e-107">Initialize a capture stream in loopback mode on the rendering endpoint device.</span></span>

<span data-ttu-id="65a2e-108">Dopo aver seguito questi passaggi, il client può chiamare il metodo [**IAudioClient:: GetService**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getservice) per ottenere un'interfaccia [**IAudioCaptureClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudiocaptureclient) sul dispositivo dell'endpoint di rendering.</span><span class="sxs-lookup"><span data-stu-id="65a2e-108">After following these steps, the client can call the [**IAudioClient::GetService**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getservice) method to obtain an [**IAudioCaptureClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudiocaptureclient) interface on the rendering endpoint device.</span></span>

<span data-ttu-id="65a2e-109">WASAPI fornisce la modalità loopback principalmente per supportare l'annullamento dell'eco acustico (AEC).</span><span class="sxs-lookup"><span data-stu-id="65a2e-109">WASAPI provides loopback mode primarily to support acoustic echo cancellation (AEC).</span></span> <span data-ttu-id="65a2e-110">Tuttavia, altri tipi di applicazioni audio potrebbero trovare la modalità loopback utile per acquisire la combinazione di sistema riprodotta dal motore audio.</span><span class="sxs-lookup"><span data-stu-id="65a2e-110">However, other types of audio applications might find loopback mode useful for capturing the system mix that is being played by the audio engine.</span></span>

<span data-ttu-id="65a2e-111">Nell'esempio di codice in [acquisizione di un flusso](capturing-a-stream.md), è possibile modificare facilmente la funzione RecordAudioStream per configurare un flusso di acquisizione in modalità loopback.</span><span class="sxs-lookup"><span data-stu-id="65a2e-111">In the code example in [Capturing a Stream](capturing-a-stream.md), the RecordAudioStream function can be easily modified to configure a loopback-mode capture stream.</span></span> <span data-ttu-id="65a2e-112">Di seguito sono riportate le modifiche necessarie:</span><span class="sxs-lookup"><span data-stu-id="65a2e-112">The required modifications are:</span></span>

-   <span data-ttu-id="65a2e-113">Nella chiamata al metodo [**IMMDeviceEnumerator:: GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) modificare il primo parametro (*flusso di flussi*) da eCapture a eRender.</span><span class="sxs-lookup"><span data-stu-id="65a2e-113">In the call to the [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) method, change the first parameter (*dataFlow*) from eCapture to eRender.</span></span>
-   <span data-ttu-id="65a2e-114">Nella chiamata al metodo [**IAudioClient:: Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize) , modificare il valore del secondo parametro (*StreamFlags*) da 0 a AUDCLNT \_ StreamFlags \_ loopback.</span><span class="sxs-lookup"><span data-stu-id="65a2e-114">In the call to the [**IAudioClient::Initialize**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-initialize) method, change the value of the second parameter (*StreamFlags*) from 0 to AUDCLNT\_STREAMFLAGS\_LOOPBACK.</span></span>

<span data-ttu-id="65a2e-115">Nelle versioni di Windows precedenti a Windows 10 1703, il client di acquisizione in modalità pull non riceve alcun evento quando un flusso viene inizializzato con il buffer guidato dagli eventi ed è abilitato per loopback.</span><span class="sxs-lookup"><span data-stu-id="65a2e-115">In versions of Windows prior to Windows 10 1703, pull-mode capture client does not receive any events when a stream is initialized with event-driven buffering and is loopback-enabled.</span></span> <span data-ttu-id="65a2e-116">Per ovviare a questo problema, inizializzare un flusso di rendering in modalità guidata dagli eventi.</span><span class="sxs-lookup"><span data-stu-id="65a2e-116">To work around this, initialize a render stream in event-driven mode.</span></span> <span data-ttu-id="65a2e-117">Ogni volta che il client riceve un evento per il flusso di rendering, deve segnalare al client di acquisizione di eseguire il thread di acquisizione che legge il set successivo di esempi dal buffer dell'endpoint di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="65a2e-117">Each time the client receives an event for the render stream, it must signal the capture client to run the capture thread that reads the next set of samples from the capture endpoint buffer.</span></span> <span data-ttu-id="65a2e-118">Nelle versioni 1703 e successive di Windows 10, i client loopback basati su eventi sono supportati e non necessitano più della soluzione alternativa che interessano il flusso di rendering.</span><span class="sxs-lookup"><span data-stu-id="65a2e-118">In Windows 10 versions 1703 and higher, event-driven loopback clients are supported, and no longer need the workaround involving the render stream.</span></span>  

<span data-ttu-id="65a2e-119">Un client può abilitare la modalità loopback solo per un flusso in modalità condivisa (AUDCLNT \_ SHAREMODE \_ Shared).</span><span class="sxs-lookup"><span data-stu-id="65a2e-119">A client can enable loopback mode only for a shared-mode stream (AUDCLNT\_SHAREMODE\_SHARED).</span></span> <span data-ttu-id="65a2e-120">I flussi in modalità esclusiva non possono funzionare in modalità loopback.</span><span class="sxs-lookup"><span data-stu-id="65a2e-120">Exclusive-mode streams cannot operate in loopback mode.</span></span>

<span data-ttu-id="65a2e-121">L'implementazione di loopback da WASAPI dipende dalle capacità dell'hardware.</span><span class="sxs-lookup"><span data-stu-id="65a2e-121">The implementation of loopback by WASAPI depend on the capabilities of the hardware.</span></span> <span data-ttu-id="65a2e-122">Se l'hardware supporta un pin di loopback sull'endpoint di rendering, WASAPI usa l'audio fornito su questo pin per il flusso di loopback.</span><span class="sxs-lookup"><span data-stu-id="65a2e-122">If the hardware supports a loopback pin on the render endpoint, WASAPI uses the audio provided on this pin for the loopback stream.</span></span> <span data-ttu-id="65a2e-123">Quando l'hardware non supporta un pin di loopback, WASAPI copia il flusso di output dal motore audio nel buffer di acquisizione dell'applicazione loopback, oltre a copiare i dati audio nel pin di rendering dell'hardware.</span><span class="sxs-lookup"><span data-stu-id="65a2e-123">When the hardware does not support a loopback pin, WASAPI copies the output stream from the audio engine into the loopback application's capture buffer, in addition to copying the audio data to the hardware's render pin.</span></span>

<span data-ttu-id="65a2e-124">Alcuni fornitori di hardware implementano dispositivi loopback, anziché aggiungere istanze nei dispositivi di rendering, nelle schede audio.</span><span class="sxs-lookup"><span data-stu-id="65a2e-124">Some hardware vendors implement loopback devices (as opposed to pin instances on render devices) in their audio adapters.</span></span> <span data-ttu-id="65a2e-125">Sebbene i dispositivi loopback hardware siano simili in funzione alla modalità loopback WASAPI, possono essere più difficili da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="65a2e-125">Although hardware loopback devices are similar in operation to the WASAPI loopback mode, they can be more difficult to use.</span></span>

<span data-ttu-id="65a2e-126">I dispositivi loopback hardware presentano gli svantaggi seguenti per le applicazioni audio:</span><span class="sxs-lookup"><span data-stu-id="65a2e-126">Hardware loopback devices have the following disadvantages for audio applications:</span></span>

-   <span data-ttu-id="65a2e-127">Non tutte le schede audio dispongono di dispositivi loopback.</span><span class="sxs-lookup"><span data-stu-id="65a2e-127">Not all audio adapters have loopback devices.</span></span> <span data-ttu-id="65a2e-128">Pertanto, le applicazioni che dipendono da tali applicazioni non funzioneranno su tutti i sistemi.</span><span class="sxs-lookup"><span data-stu-id="65a2e-128">Thus, applications that depend on them will not work on all systems.</span></span>
-   <span data-ttu-id="65a2e-129">Prima che un'applicazione possa registrare da un dispositivo loopback, l'utente deve identificare il dispositivo loopback e abilitarlo per l'utilizzo.</span><span class="sxs-lookup"><span data-stu-id="65a2e-129">Before an application can record from a loopback device, the user must identify the loopback device and enable it for use.</span></span>

<span data-ttu-id="65a2e-130">Fornitori diversi assegnano nomi diversi ai dispositivi loopback hardware.</span><span class="sxs-lookup"><span data-stu-id="65a2e-130">Different vendors assign different names to their hardware loopback devices.</span></span> <span data-ttu-id="65a2e-131">Di seguito sono riportati alcuni esempi:</span><span class="sxs-lookup"><span data-stu-id="65a2e-131">The following names are examples:</span></span>

-   <span data-ttu-id="65a2e-132">Combinazione stereo</span><span class="sxs-lookup"><span data-stu-id="65a2e-132">Stereo Mix</span></span>
-   <span data-ttu-id="65a2e-133">Combinazione di onda</span><span class="sxs-lookup"><span data-stu-id="65a2e-133">Waveout Mix</span></span>
-   <span data-ttu-id="65a2e-134">Output misto</span><span class="sxs-lookup"><span data-stu-id="65a2e-134">Mixed Output</span></span>
-   <span data-ttu-id="65a2e-135">Cosa si sente</span><span class="sxs-lookup"><span data-stu-id="65a2e-135">What You Hear</span></span>

<span data-ttu-id="65a2e-136">La mancanza di nomi standardizzati potrebbe impedire agli utenti di identificare un dispositivo loopback in un elenco di nomi di dispositivo.</span><span class="sxs-lookup"><span data-stu-id="65a2e-136">The lack of standardized names might cause users to have difficulty identifying a loopback device in a list of device names.</span></span>

<span data-ttu-id="65a2e-137">Un dispositivo loopback hardware è un dispositivo di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="65a2e-137">A hardware loopback device is a capture device.</span></span> <span data-ttu-id="65a2e-138">Pertanto, se un adapter supporta un dispositivo loopback, un'applicazione audio può registrare dal dispositivo nello stesso modo in cui registra da qualsiasi altro dispositivo di acquisizione.</span><span class="sxs-lookup"><span data-stu-id="65a2e-138">Thus, if an adapter supports a loopback device, an audio application can record from the device in the same way that it records from any other capture device.</span></span>

<span data-ttu-id="65a2e-139">Ad esempio, se si seleziona un dispositivo loopback hardware come dispositivo di acquisizione predefinito, è possibile usare la funzione RecordAudioStream (senza modifiche) nell'esempio di codice in [acquisizione di un flusso](capturing-a-stream.md) per acquisire il flusso dal dispositivo.</span><span class="sxs-lookup"><span data-stu-id="65a2e-139">For example, if you select a hardware loopback device to be the default capture device, you can use the RecordAudioStream function (without modification) in the code example in [Capturing a Stream](capturing-a-stream.md) to capture the stream from the device.</span></span> <span data-ttu-id="65a2e-140">È anche possibile usare un'API audio legacy, ad esempio le funzioni **waveInXxx** multimediali di Windows, per acquisire il flusso dal dispositivo.</span><span class="sxs-lookup"><span data-stu-id="65a2e-140">(You can also use a legacy audio API, such as the Windows multimedia **waveInXxx** functions, to capture the stream from the device.)</span></span>

<span data-ttu-id="65a2e-141">Se la scheda audio contiene un dispositivo loopback hardware, è possibile usare il pannello di controllo multimediale di Windows, Mmsys.cpl, per designare il dispositivo come dispositivo di acquisizione predefinito.</span><span class="sxs-lookup"><span data-stu-id="65a2e-141">If your audio adapter contains a hardware loopback device, you can use the Windows multimedia control panel, Mmsys.cpl, to designate the device as the default capture device.</span></span> <span data-ttu-id="65a2e-142">Attenersi alla procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="65a2e-142">The steps are as follows:</span></span>

1.  <span data-ttu-id="65a2e-143">Per eseguire Mmsys.cpl, aprire una finestra del prompt dei comandi e immettere il comando seguente:</span><span class="sxs-lookup"><span data-stu-id="65a2e-143">To run Mmsys.cpl, open a Command Prompt window and enter the following command:</span></span>

    ```C++
    control mmsys.cpl,,1
    ```

    

    <span data-ttu-id="65a2e-144">In alternativa, è possibile eseguire Mmsys.cpl facendo clic con il pulsante destro del mouse sull'icona dell'altoparlante nell'area di notifica che si trova sul lato destro della barra delle applicazioni e selezionando **registrazione dispositivi**.</span><span class="sxs-lookup"><span data-stu-id="65a2e-144">Alternatively, you can run Mmsys.cpl by right-clicking the speaker icon in the notification area, which is located on the right side of the taskbar, and selecting **Recording Devices**.</span></span>

2.  <span data-ttu-id="65a2e-145">Una volta aperta la finestra di Mmsys.cpl, fare clic con il pulsante destro del mouse in un punto qualsiasi dell'elenco dei dispositivi di registrazione e verificare che l'opzione **Mostra dispositivi disabilitati** sia selezionata.</span><span class="sxs-lookup"><span data-stu-id="65a2e-145">After the Mmsys.cpl window opens, right-click anywhere in the list of recording devices and verify that the **Show Disabled Devices** option is checked.</span></span> <span data-ttu-id="65a2e-146">In caso contrario, se il dispositivo loopback è disabilitato, non verrà visualizzato nell'elenco.</span><span class="sxs-lookup"><span data-stu-id="65a2e-146">(Otherwise, if the loopback device is disabled, it will not appear in the list.)</span></span>
3.  <span data-ttu-id="65a2e-147">Sfogliare l'elenco dei dispositivi di registrazione per individuare il dispositivo loopback (se esistente).</span><span class="sxs-lookup"><span data-stu-id="65a2e-147">Browse the list of recording devices to locate the loopback device (if it exists).</span></span> <span data-ttu-id="65a2e-148">Se il dispositivo loopback è disabilitato, abilitarlo facendo clic con il pulsante destro del mouse sul dispositivo e scegliendo **Abilita**.</span><span class="sxs-lookup"><span data-stu-id="65a2e-148">If the loopback device is disabled, enable it by right-clicking the device and clicking **Enable**.</span></span>
4.  <span data-ttu-id="65a2e-149">Infine, per selezionare il dispositivo loopback come dispositivo di acquisizione predefinito, fare clic con il pulsante destro del mouse sul dispositivo e scegliere **Imposta come dispositivo predefinito**.</span><span class="sxs-lookup"><span data-stu-id="65a2e-149">Finally, to select the loopback device to be the default capture device, right-click the device and click **Set as Default Device**.</span></span>

<span data-ttu-id="65a2e-150">WASAPI supporta la registrazione loopback indipendentemente dal fatto che l'hardware audio contenga un dispositivo loopback o se l'utente ha abilitato il dispositivo.</span><span class="sxs-lookup"><span data-stu-id="65a2e-150">WASAPI supports loopback recording regardless of whether the audio hardware contains a loopback device, or whether the user has enabled the device.</span></span>

<span data-ttu-id="65a2e-151">Windows Vista fornisce Digital Rights Management (DRM).</span><span class="sxs-lookup"><span data-stu-id="65a2e-151">Windows Vista provides digital rights management (DRM).</span></span> <span data-ttu-id="65a2e-152">I provider di contenuti si basano sul DRM per proteggere la musica di proprietà o altro contenuto da copia non autorizzata e altri usi non validi.</span><span class="sxs-lookup"><span data-stu-id="65a2e-152">Content providers rely on DRM to protect their proprietary music or other content from unauthorized copying and other illegal uses.</span></span> <span data-ttu-id="65a2e-153">Analogamente, un driver audio attendibile non consente a un dispositivo loopback di acquisire flussi digitali contenenti contenuto protetto.</span><span class="sxs-lookup"><span data-stu-id="65a2e-153">Similarly, a trusted audio driver does not permit a loopback device to capture digital streams that contain protected content.</span></span> <span data-ttu-id="65a2e-154">Windows Vista consente solo ai driver attendibili di riprodurre contenuti protetti.</span><span class="sxs-lookup"><span data-stu-id="65a2e-154">Windows Vista allows only trusted drivers to play protected content.</span></span> <span data-ttu-id="65a2e-155">Per ulteriori informazioni su driver attendibili e DRM, vedere la documentazione di Windows DDK.</span><span class="sxs-lookup"><span data-stu-id="65a2e-155">For more information about trusted drivers and DRM, see the Windows DDK documentation.</span></span>

<span data-ttu-id="65a2e-156">Il loopback WASAPI contiene la combinazione di tutti i file audio riprodotti, indipendentemente dalla sessione di Servizi terminal da cui ha origine l'audio.</span><span class="sxs-lookup"><span data-stu-id="65a2e-156">WASAPI loopback contains the mix of all audio being played, regardless of the Terminal Services session the audio originated from.</span></span> <span data-ttu-id="65a2e-157">Ad esempio, è possibile eseguire un client di loopback in un servizio in esecuzione nella sessione 0 e acquisire l'audio da tutte le sessioni utente, oltre che l'audio riprodotto dalla sessione 0.</span><span class="sxs-lookup"><span data-stu-id="65a2e-157">For example, you can run a loopback client in a service running in session 0 and capture audio from all user sessions, as well as audio being played from session 0.</span></span>

<span data-ttu-id="65a2e-158">Desktop remoto consente il reindirizzamento dell'audio al client.</span><span class="sxs-lookup"><span data-stu-id="65a2e-158">Remote Desktop allows redirecting audio to the client.</span></span> <span data-ttu-id="65a2e-159">Questa operazione viene implementata creando nuovi dispositivi audio che vengono visualizzati solo per tale sessione.</span><span class="sxs-lookup"><span data-stu-id="65a2e-159">This is implemented by creating new audio devices that only appear for that session.</span></span>

## <a name="related-topics"></a><span data-ttu-id="65a2e-160">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="65a2e-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="65a2e-161">Gestione dei flussi</span><span class="sxs-lookup"><span data-stu-id="65a2e-161">Stream Management</span></span>](stream-management.md)
</dt> </dl>

 

 



