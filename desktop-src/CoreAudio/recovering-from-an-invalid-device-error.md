---
description: Ripristino da un errore di Invalid-Device
ms.assetid: 1f5c3458-70ca-45ba-ac33-5c7b9f092320
title: Ripristino da un errore di Invalid-Device
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ca20c32be46367f53a14ce26c39f980e3649b652
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104127422"
---
# <a name="recovering-from-an-invalid-device-error"></a><span data-ttu-id="34296-103">Ripristino da un errore di Invalid-Device</span><span class="sxs-lookup"><span data-stu-id="34296-103">Recovering from an Invalid-Device Error</span></span>

<span data-ttu-id="34296-104">Molti dei metodi in WASAPI restituiscono il codice di errore AUDCLNT \_ E \_ dispositivo \_ invalidato se il dispositivo dell'endpoint audio che l'applicazione client sta usando diventa non valido.</span><span class="sxs-lookup"><span data-stu-id="34296-104">Many of the methods in WASAPI return error code AUDCLNT\_E\_DEVICE\_INVALIDATED if the audio endpoint device that the client application is using becomes invalid.</span></span> <span data-ttu-id="34296-105">Questo codice di errore indica che il dispositivo endpoint è stato scollegato o che l'hardware audio o le risorse hardware associate sono state riconfigurate, disabilitate, rimosse o rese non disponibili per l'utilizzo.</span><span class="sxs-lookup"><span data-stu-id="34296-105">This error code indicates that the endpoint device has been unplugged, or that the audio hardware or associated hardware resources have been reconfigured, disabled, removed, or otherwise made unavailable for use.</span></span> <span data-ttu-id="34296-106">Spesso l'applicazione può risolvere questo errore.</span><span class="sxs-lookup"><span data-stu-id="34296-106">Frequently, the application can recover from this error.</span></span>

>[!NOTE]
> <span data-ttu-id="34296-107">Per informazioni sul ripristino da errori di dispositivo non validi quando si usano le API ISAC (Spatial audio API), vedere [ripristino da un errore di Invalid-Device (audio spaziale)](recovering-from-an-invalid-device-error-spatial-sound.md)</span><span class="sxs-lookup"><span data-stu-id="34296-107">For information on recovering from invalid device errors when using spatial audio APIs (ISAC), see [Recovering from an Invalid-Device Error (Spatial Sound)](recovering-from-an-invalid-device-error-spatial-sound.md)</span></span>

<span data-ttu-id="34296-108">La strategia che un'applicazione deve usare per eseguire il ripristino da \_ un \_ \_ errore invalidato del dispositivo AUDCLNT E dipende dalle tecniche seguenti utilizzate dall'applicazione per selezionare un dispositivo endpoint audio:</span><span class="sxs-lookup"><span data-stu-id="34296-108">The strategy that an application should use to recover from an AUDCLNT\_E\_DEVICE\_INVALIDATED error depends on which of the following techniques the application uses to select an audio endpoint device:</span></span>

-   <span data-ttu-id="34296-109">Selezionare sempre il dispositivo di acquisizione o il rendering audio predefinito.</span><span class="sxs-lookup"><span data-stu-id="34296-109">Always select the default audio rendering or capture device.</span></span>
-   <span data-ttu-id="34296-110">Selezionare un dispositivo endpoint audio specifico.</span><span class="sxs-lookup"><span data-stu-id="34296-110">Select a specific audio endpoint device.</span></span>

<span data-ttu-id="34296-111">Nel secondo caso, l'applicazione seleziona automaticamente un dispositivo specifico in base ai requisiti interni oppure consente all'utente di selezionare in modo esplicito un dispositivo da un elenco di dispositivi disponibili.</span><span class="sxs-lookup"><span data-stu-id="34296-111">In the latter case, either the application automatically selects a specific device based on internal requirements or it allows the user to explicitly select a device from a list of available devices.</span></span>

<span data-ttu-id="34296-112">Un'applicazione che usa il dispositivo predefinito può tentare di eseguire il ripristino da \_ un \_ \_ errore invalidato del dispositivo AUDCLNT E come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="34296-112">An application that uses the default device can attempt to recover from an AUDCLNT\_E\_DEVICE\_INVALIDATED error as follows:</span></span>

1.  <span data-ttu-id="34296-113">Rilasciare l'interfaccia [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) e tutte le altre interfacce WASAPI acquisite nel dispositivo.</span><span class="sxs-lookup"><span data-stu-id="34296-113">Release the [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface and any other WASAPI interfaces that it has acquired on the device.</span></span>
2.  <span data-ttu-id="34296-114">Chiamare il metodo [**IMMDeviceEnumerator:: GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) per ottenere il dispositivo audio predefinito corrente.</span><span class="sxs-lookup"><span data-stu-id="34296-114">Call the [**IMMDeviceEnumerator::GetDefaultAudioEndpoint**](/windows/desktop/api/Mmdeviceapi/nf-mmdeviceapi-immdeviceenumerator-getdefaultaudioendpoint) method to get the current default audio device.</span></span>
3.  <span data-ttu-id="34296-115">Tentativo di attivare [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) sul dispositivo audio predefinito.</span><span class="sxs-lookup"><span data-stu-id="34296-115">Attempt to activate [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) on the default audio device.</span></span>

<span data-ttu-id="34296-116">Seguendo i passaggi precedenti, l'applicazione tende a rispondere in modo appropriato, indipendentemente dalla cause dell' \_ \_ \_ errore invalidato del dispositivo AUDCLNT E.</span><span class="sxs-lookup"><span data-stu-id="34296-116">By following the preceding steps, the application tends to respond appropriately regardless of the cause of the AUDCLNT\_E\_DEVICE\_INVALIDATED error.</span></span> <span data-ttu-id="34296-117">Se la riconfigurazione del dispositivo predefinito ha causato l'errore (ad esempio, se l'utente ha modificato il formato di flusso usato dal dispositivo), questi passaggi, se hanno esito positivo, consentono all'applicazione di continuare a usare lo stesso dispositivo.</span><span class="sxs-lookup"><span data-stu-id="34296-117">If reconfiguration of the default device caused the error (for example, if the user changed the stream format used by the device), then these steps, if they succeed, enable the application to continue to use the same device.</span></span> <span data-ttu-id="34296-118">Se l'utente ha disabilitato o rimosso il dispositivo usato dall'applicazione e un altro dispositivo è disponibile per assumere il ruolo di dispositivo predefinito, l'applicazione può continuare usando il nuovo dispositivo predefinito.</span><span class="sxs-lookup"><span data-stu-id="34296-118">If the user disabled or removed the device that the application was using and another device is available to assume the role of default device, then the application can continue by using the new default device.</span></span> <span data-ttu-id="34296-119">In entrambi i casi, l'applicazione si adatta automaticamente senza richiedere l'intervento dell'utente.</span><span class="sxs-lookup"><span data-stu-id="34296-119">In either case, the application adapts automatically without requiring intervention by the user.</span></span>

<span data-ttu-id="34296-120">Un'applicazione che seleziona un dispositivo specifico può tentare di eseguire il ripristino dall' \_ \_ \_ errore invalidato del dispositivo AUDCLNT E come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="34296-120">An application that selects a specific device can attempt to recover from the AUDCLNT\_E\_DEVICE\_INVALIDATED error as follows:</span></span>

1.  <span data-ttu-id="34296-121">Rilasciare l'interfaccia [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) e tutte le altre interfacce WASAPI acquisite nel dispositivo.</span><span class="sxs-lookup"><span data-stu-id="34296-121">Release the [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface and any other WASAPI interfaces that it has acquired on the device.</span></span>
2.  <span data-ttu-id="34296-122">Tentativo di attivare un'interfaccia [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) sullo stesso dispositivo.</span><span class="sxs-lookup"><span data-stu-id="34296-122">Attempt to activate an [**IAudioClient**](/windows/desktop/api/Audioclient/nn-audioclient-iaudioclient) interface on the same device.</span></span>
3.  <span data-ttu-id="34296-123">Se il passaggio 2 ha esito negativo, l'applicazione può richiedere all'utente di selezionare un altro dispositivo.</span><span class="sxs-lookup"><span data-stu-id="34296-123">If step 2 fails, then the application can, as an option, prompt the user to select another device.</span></span>

<span data-ttu-id="34296-124">Il passaggio 2 può avere esito positivo se il dispositivo utilizzato dall'applicazione è stato riconfigurato ma non disabilitato o rimosso.</span><span class="sxs-lookup"><span data-stu-id="34296-124">Step 2 can succeed if the device being used by the application was reconfigured but not disabled or removed.</span></span> <span data-ttu-id="34296-125">In caso di esito positivo, il passaggio 2 consente all'applicazione di continuare a usare automaticamente lo stesso dispositivo senza richiedere l'intervento dell'utente.</span><span class="sxs-lookup"><span data-stu-id="34296-125">If successful, step 2 enables the application to automatically continue to use the same device without requiring intervention by the user.</span></span> <span data-ttu-id="34296-126">Il passaggio 3 è appropriato se l'applicazione consente all'utente di selezionare in modo esplicito un altro dispositivo dopo che l'utente ha disabilitato o rimosso il dispositivo usato in precedenza.</span><span class="sxs-lookup"><span data-stu-id="34296-126">Step 3 is appropriate if the application allows the user to explicitly select another device after the user has disabled or removed the previously used device.</span></span>

<span data-ttu-id="34296-127">Un'applicazione può determinare in modo più preciso la cause di un errore del dispositivo non valido eseguendo la registrazione per ricevere una notifica quando una sessione perde la connessione a un dispositivo.</span><span class="sxs-lookup"><span data-stu-id="34296-127">An application can determine more precisely the cause of an invalid-device error by registering to receive a notification when a session loses its connection to a device.</span></span> <span data-ttu-id="34296-128">Per abilitare questa notifica, l'applicazione implementa un'interfaccia [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) e chiama il metodo [**IAudioSessionControl:: RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) per registrare l'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="34296-128">To enable this notification, the application implements an [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface and calls the [**IAudioSessionControl::RegisterAudioSessionNotification**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessioncontrol-registeraudiosessionnotification) method to register the interface.</span></span> <span data-ttu-id="34296-129">Quando un errore di dispositivo non valido causa la disconnessione della sessione, WASAPI chiama il metodo [**IAudioSessionEvents:: OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) nell'interfaccia registrata.</span><span class="sxs-lookup"><span data-stu-id="34296-129">When an invalid-device error causes the session to be disconnected, WASAPI calls the [**IAudioSessionEvents::OnSessionDisconnected**](/windows/desktop/api/Audiopolicy/nf-audiopolicy-iaudiosessionevents-onsessiondisconnected) method in the registered interface.</span></span> <span data-ttu-id="34296-130">Tramite questo metodo, WASAPI informa l'applicazione del motivo della disconnessione.</span><span class="sxs-lookup"><span data-stu-id="34296-130">Through this method, WASAPI informs the application of the reason for the disconnection.</span></span> <span data-ttu-id="34296-131">In Windows Vista, la chiamata **OnSessionDisconnected** identifica i motivi seguenti:</span><span class="sxs-lookup"><span data-stu-id="34296-131">In Windows Vista, the **OnSessionDisconnected** call identifies the following reasons:</span></span>

-   <span data-ttu-id="34296-132">L'utente ha rimosso il dispositivo dell'endpoint audio.</span><span class="sxs-lookup"><span data-stu-id="34296-132">The user removed the audio endpoint device.</span></span>
-   <span data-ttu-id="34296-133">Il servizio audio Windows è stato arrestato.</span><span class="sxs-lookup"><span data-stu-id="34296-133">The Windows audio service has shut down.</span></span>
-   <span data-ttu-id="34296-134">Il formato di flusso preferito è stato modificato per il dispositivo a cui è connessa la sessione audio.</span><span class="sxs-lookup"><span data-stu-id="34296-134">The preferred stream format changed for the device that the audio session is connected to.</span></span>
-   <span data-ttu-id="34296-135">L'utente ha disconnesso la sessione Servizi terminal di Windows (WTS) in cui è in esecuzione la sessione audio.</span><span class="sxs-lookup"><span data-stu-id="34296-135">The user logged off the Windows Terminal Services (WTS) session that the audio session was running in.</span></span> <span data-ttu-id="34296-136">Per ulteriori informazioni sulle sessioni WTS, vedere la documentazione Windows SDK.</span><span class="sxs-lookup"><span data-stu-id="34296-136">For more information about WTS sessions, see the Windows SDK documentation.</span></span>
-   <span data-ttu-id="34296-137">La sessione di WTS in cui è in esecuzione la sessione audio è stata disconnessa.</span><span class="sxs-lookup"><span data-stu-id="34296-137">The WTS session that the audio session was running in was disconnected.</span></span>
-   <span data-ttu-id="34296-138">La sessione audio (modalità condivisa) è stata disconnessa per rendere disponibile il dispositivo dell'endpoint audio per una connessione in modalità esclusiva.</span><span class="sxs-lookup"><span data-stu-id="34296-138">The (shared-mode) audio session was disconnected to make the audio endpoint device available for an exclusive-mode connection.</span></span>

<span data-ttu-id="34296-139">In risposta all'evento di disconnessione, WASAPI chiude tutti i flussi che appartengono alla sessione.</span><span class="sxs-lookup"><span data-stu-id="34296-139">In response to the disconnection event, WASAPI closes all of the streams that belong to the session.</span></span> <span data-ttu-id="34296-140">Se un'applicazione tenta successivamente di accedere a un flusso chiuso tramite un metodo WASAPI, ad esempio [**IAudioClient:: GetCurrentPadding**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getcurrentpadding), il metodo ha esito negativo e restituisce il codice di errore AUDCLNT \_ e il \_ dispositivo \_ invalidato.</span><span class="sxs-lookup"><span data-stu-id="34296-140">If an application subsequently attempts to access a closed stream through a WASAPI method such as [**IAudioClient::GetCurrentPadding**](/windows/desktop/api/Audioclient/nf-audioclient-iaudioclient-getcurrentpadding), then the method fails and returns error code AUDCLNT\_E\_DEVICE\_INVALIDATED.</span></span>

<span data-ttu-id="34296-141">Un ulteriore vantaggio della ricezione di notifiche tramite l'interfaccia [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) è che le notifiche arrivano in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="34296-141">An additional benefit to receiving notifications through the [**IAudioSessionEvents**](/windows/desktop/api/Audiopolicy/nn-audiopolicy-iaudiosessionevents) interface is that the notifications arrive asynchronously.</span></span> <span data-ttu-id="34296-142">Pertanto, anche quando il flusso non è in esecuzione, l'applicazione riceverà comunque una notifica tempestiva degli errori del dispositivo non validi che possono impedire l'esecuzione del flusso.</span><span class="sxs-lookup"><span data-stu-id="34296-142">Thus, even when the stream is not running, the application will still receive timely notification of invalid-device errors that can prevent the stream from running.</span></span>

## <a name="related-topics"></a><span data-ttu-id="34296-143">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="34296-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="34296-144">Gestione dei flussi</span><span class="sxs-lookup"><span data-stu-id="34296-144">Stream Management</span></span>](stream-management.md)
</dt> </dl>

 

 



