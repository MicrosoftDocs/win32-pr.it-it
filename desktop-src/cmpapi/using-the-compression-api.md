---
description: Molte applicazioni devono usare la compressione e la decompressione dei dati senza perdita di dati. L'API di compressione semplifica questa operazione esponendo gli algoritmi di compressione Windows tramite un'API pubblica.
ms.assetid: D603A7DE-D4A1-4515-9702-B03C81504661
title: Uso dell'API di compressione
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 01eff163f4ea1ccf03e1cd4ac9cb16a26afeb265
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104127414"
---
# <a name="using-the-compression-api"></a><span data-ttu-id="59c5f-104">Uso dell'API di compressione</span><span class="sxs-lookup"><span data-stu-id="59c5f-104">Using the Compression API</span></span>

<span data-ttu-id="59c5f-105">Molte applicazioni devono usare la compressione e la decompressione dei dati senza perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="59c5f-105">Many applications need to use lossless data compression and decompression.</span></span> <span data-ttu-id="59c5f-106">L'API di compressione semplifica questa operazione esponendo gli algoritmi di compressione Windows tramite un'API pubblica.</span><span class="sxs-lookup"><span data-stu-id="59c5f-106">The Compression API simplifies this by exposing Windows compression algorithms through a public API.</span></span> <span data-ttu-id="59c5f-107">Ogni algoritmo di compressione dispone di un set di proprietà che ne controlla il comportamento.</span><span class="sxs-lookup"><span data-stu-id="59c5f-107">Each compression algorithm has a set of properties that controls its behavior.</span></span> <span data-ttu-id="59c5f-108">L'API di compressione espone un'interfaccia che consente allo sviluppatore di impostare o eseguire query sui valori di queste proprietà.</span><span class="sxs-lookup"><span data-stu-id="59c5f-108">The Compression API exposes an interface that enables the developer to set or query the values of these properties.</span></span> <span data-ttu-id="59c5f-109">Per tutte le proprietà degli algoritmi di compressione supportati sono disponibili valori predefiniti che rappresentano i valori di queste proprietà usati comunemente.</span><span class="sxs-lookup"><span data-stu-id="59c5f-109">All properties for the supported compression algorithms have default values representing commonly used values of these properties.</span></span> <span data-ttu-id="59c5f-110">Se una proprietà è necessaria per la compressione e la decompressione, i valori predefiniti saranno identici, assicurando che i valori identici vengano usati per la compressione e la decompressione.</span><span class="sxs-lookup"><span data-stu-id="59c5f-110">If a property is required for both compression and decompression, the default values will be identical, ensuring identical values are used for compression and decompression.</span></span>

## <a name="selecting-the-compression-algorithm"></a><span data-ttu-id="59c5f-111">Selezione dell'algoritmo di compressione</span><span class="sxs-lookup"><span data-stu-id="59c5f-111">Selecting the compression algorithm</span></span>

<span data-ttu-id="59c5f-112">Quando uno sviluppatore decide che un'applicazione deve comprimere o decomprimere i dati, il passaggio successivo consiste nel scegliere un algoritmo di compressione.</span><span class="sxs-lookup"><span data-stu-id="59c5f-112">After a developer decides that an application needs to compress or decompress data, the next step is to choose a compression algorithm.</span></span> <span data-ttu-id="59c5f-113">Questo può dipendere da test per trovare la combinazione di velocità, compressione e requisiti di memoria migliori per una particolare applicazione.</span><span class="sxs-lookup"><span data-stu-id="59c5f-113">This may depend upon tests to find the best performing combination of speed, compression ratio, and memory requirement for a particular application.</span></span> <span data-ttu-id="59c5f-114">L'elenco seguente fornisce un confronto relativo degli algoritmi di compressione attualmente supportati dall'API di compressione.</span><span class="sxs-lookup"><span data-stu-id="59c5f-114">The following list gives a relative comparison of the compression algorithms currently supported by the Compression API.</span></span> <span data-ttu-id="59c5f-115">Non tutte le opzioni sono disponibili per ogni algoritmo di compressione e il confronto è approssimativo poiché le prestazioni possono dipendere dai dati di input.</span><span class="sxs-lookup"><span data-stu-id="59c5f-115">Not every option is available for every compression algorithm, and the comparison is approximate because performance can depend on the input data.</span></span>

<span data-ttu-id="59c5f-116">XPRESS (**Comprimi \_ algoritmo \_ Xpress**)</span><span class="sxs-lookup"><span data-stu-id="59c5f-116">XPRESS (**COMPRESS\_ALGORITHM\_XPRESS**)</span></span>

-   <span data-ttu-id="59c5f-117">Molto veloce con requisiti di risorse limitati</span><span class="sxs-lookup"><span data-stu-id="59c5f-117">Very fast with low resource requirements</span></span>
-   <span data-ttu-id="59c5f-118">Rapporto di compressione medio</span><span class="sxs-lookup"><span data-stu-id="59c5f-118">Medium compression ratio</span></span>
-   <span data-ttu-id="59c5f-119">Velocità elevata di compressione e decompressione</span><span class="sxs-lookup"><span data-stu-id="59c5f-119">High compression and decompression speeds</span></span>
-   <span data-ttu-id="59c5f-120">Requisito di memoria insufficiente</span><span class="sxs-lookup"><span data-stu-id="59c5f-120">Low memory requirement</span></span>
-   <span data-ttu-id="59c5f-121">Supporta l'opzione **Comprimi \_ informazioni a \_ \_ livello di classe** disponibile nell'enumerazione della [**\_ \_ classe Compress Information**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) .</span><span class="sxs-lookup"><span data-stu-id="59c5f-121">Supports the **COMPRESS\_INFORMATION\_CLASS\_LEVEL** option available in the [**COMPRESS\_INFORMATION\_CLASS**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) enumeration.</span></span> <span data-ttu-id="59c5f-122">Il valore predefinito è **(DWORD) 0**.</span><span class="sxs-lookup"><span data-stu-id="59c5f-122">The default value is **(DWORD)0**.</span></span> <span data-ttu-id="59c5f-123">Per alcuni dati, il valore **(DWORD) 1** può migliorare il rapporto di compressione con una velocità di compressione leggermente più lenta.</span><span class="sxs-lookup"><span data-stu-id="59c5f-123">For some data, the value **(DWORD)1** can improve the compression ratio with a slightly slower compression speed.</span></span>

<span data-ttu-id="59c5f-124">XPRESS con codifica Huffman (**Comprimi \_ algoritmo \_ Xpress \_ Huff**)</span><span class="sxs-lookup"><span data-stu-id="59c5f-124">XPRESS with Huffman encoding (**COMPRESS\_ALGORITHM\_XPRESS\_HUFF**)</span></span>

-   <span data-ttu-id="59c5f-125">Il rapporto di compressione è superiore a **Comprimi \_ algoritmo \_ Xpress**</span><span class="sxs-lookup"><span data-stu-id="59c5f-125">Compression ratio is higher than **COMPRESS\_ALGORITHM\_XPRESS**</span></span>
-   <span data-ttu-id="59c5f-126">Rapporto di compressione medio</span><span class="sxs-lookup"><span data-stu-id="59c5f-126">Medium compression ratio</span></span>
-   <span data-ttu-id="59c5f-127">Velocità di compressione e decompressione da media ad elevata</span><span class="sxs-lookup"><span data-stu-id="59c5f-127">Medium to high compression and decompression speeds</span></span>
-   <span data-ttu-id="59c5f-128">Requisito di memoria insufficiente</span><span class="sxs-lookup"><span data-stu-id="59c5f-128">Low memory requirement</span></span>
-   <span data-ttu-id="59c5f-129">Supporta l'opzione **Comprimi \_ informazioni a \_ \_ livello di classe** nell'enumerazione della [**\_ \_ classe Compress Information**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) .</span><span class="sxs-lookup"><span data-stu-id="59c5f-129">Supports the **COMPRESS\_INFORMATION\_CLASS\_LEVEL** option in the [**COMPRESS\_INFORMATION\_CLASS**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) enumeration.</span></span> <span data-ttu-id="59c5f-130">Il valore predefinito è **(DWORD) 0**.</span><span class="sxs-lookup"><span data-stu-id="59c5f-130">The default value is **(DWORD)0**.</span></span> <span data-ttu-id="59c5f-131">Per alcuni dati, il valore **(DWORD) 1** può migliorare il rapporto di compressione con una velocità di compressione leggermente più lenta.</span><span class="sxs-lookup"><span data-stu-id="59c5f-131">For some data, the value **(DWORD)1** can improve the compression ratio with a slightly slower compression speed.</span></span>

<span data-ttu-id="59c5f-132">MSZIP (**Comprimi \_ algoritmo \_ MSZIP**)</span><span class="sxs-lookup"><span data-stu-id="59c5f-132">MSZIP (**COMPRESS\_ALGORITHM\_MSZIP**)</span></span>

-   <span data-ttu-id="59c5f-133">USA più risorse rispetto a **Comprimi \_ algoritmo \_ Xpress \_ Huff**</span><span class="sxs-lookup"><span data-stu-id="59c5f-133">Uses more resources than **COMPRESS\_ALGORITHM\_XPRESS\_HUFF**</span></span>
-   <span data-ttu-id="59c5f-134">Genera un blocco compresso simile a RFC 1951.</span><span class="sxs-lookup"><span data-stu-id="59c5f-134">Generates a compressed block similar to RFC 1951.</span></span>
-   <span data-ttu-id="59c5f-135">Rapporto di compressione medio-alto</span><span class="sxs-lookup"><span data-stu-id="59c5f-135">Medium to high compression ratio</span></span>
-   <span data-ttu-id="59c5f-136">Velocità di compressione media e velocità elevata di decompressione</span><span class="sxs-lookup"><span data-stu-id="59c5f-136">Medium compression speed and high decompression speed</span></span>
-   <span data-ttu-id="59c5f-137">Requisito di memoria media</span><span class="sxs-lookup"><span data-stu-id="59c5f-137">Medium memory requirement</span></span>

<span data-ttu-id="59c5f-138">LZMS (**Comprimi \_ algoritmo \_ LZMS**)</span><span class="sxs-lookup"><span data-stu-id="59c5f-138">LZMS (**COMPRESS\_ALGORITHM\_LZMS**)</span></span>

-   <span data-ttu-id="59c5f-139">Algoritmo valido se le dimensioni dei dati da comprimere sono superiori a 2 MB.</span><span class="sxs-lookup"><span data-stu-id="59c5f-139">Good algorithm if the size of the data to be compressed is over 2MB.</span></span>
-   <span data-ttu-id="59c5f-140">Rapporto di compressione elevato</span><span class="sxs-lookup"><span data-stu-id="59c5f-140">High compression ratio</span></span>
-   <span data-ttu-id="59c5f-141">Velocità di compressione bassa e velocità elevata di decompressione</span><span class="sxs-lookup"><span data-stu-id="59c5f-141">Low compression speed and high decompression speed</span></span>
-   <span data-ttu-id="59c5f-142">Requisito di memoria medio-alto</span><span class="sxs-lookup"><span data-stu-id="59c5f-142">Medium to high memory requirement</span></span>
-   <span data-ttu-id="59c5f-143">Supporta l'opzione **compress \_ Information \_ Class \_ Block \_ size** nell'enumerazione [**compress \_ Information \_ Class**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) .</span><span class="sxs-lookup"><span data-stu-id="59c5f-143">Supports the **COMPRESS\_INFORMATION\_CLASS\_BLOCK\_SIZE** option in the [**COMPRESS\_INFORMATION\_CLASS**](/windows/desktop/api/compressapi/ne-compressapi-compress_information_class) enumeration.</span></span> <span data-ttu-id="59c5f-144">È consigliabile avere una dimensione minima di 1 MB per ottenere un rapporto di compressione migliore.</span><span class="sxs-lookup"><span data-stu-id="59c5f-144">A minimum size of 1 MB is suggested to get a better compression ratio.</span></span>

## <a name="deciding-which-compression-api-mode-to-use"></a><span data-ttu-id="59c5f-145">Scelta della modalità API di compressione da usare</span><span class="sxs-lookup"><span data-stu-id="59c5f-145">Deciding which Compression API mode to use</span></span>

<span data-ttu-id="59c5f-146">Quando uno sviluppatore seleziona l'algoritmo di compressione, la decisione successiva è quella delle due modalità di utilizzo dell'API di compressione, ovvero la modalità del buffer o la modalità di blocco.</span><span class="sxs-lookup"><span data-stu-id="59c5f-146">After a developer selects the compression algorithm, the next decision is which of the two modes of the Compression API to use: buffer mode or block mode.</span></span> <span data-ttu-id="59c5f-147">La modalità buffer è stata sviluppata per semplicità d'uso ed è consigliata per la maggior parte dei casi.</span><span class="sxs-lookup"><span data-stu-id="59c5f-147">Buffer mode was developed for ease of use and is recommended for most cases.</span></span>

<span data-ttu-id="59c5f-148">La modalità buffer suddivide automaticamente il buffer di input in blocchi di dimensioni appropriate per l'algoritmo di compressione selezionato.</span><span class="sxs-lookup"><span data-stu-id="59c5f-148">Buffer mode automatically splits up the input buffer into blocks of a size that is appropriate for the selected compression algorithm.</span></span> <span data-ttu-id="59c5f-149">La modalità buffer formatta e archivia automaticamente le dimensioni del buffer non compresso nel buffer compresso.</span><span class="sxs-lookup"><span data-stu-id="59c5f-149">The buffer mode automatically formats and stores the uncompressed buffer size in the compressed buffer.</span></span> <span data-ttu-id="59c5f-150">La dimensione del buffer compresso non viene salvata automaticamente e l'applicazione deve salvare questa operazione per la decompressione.</span><span class="sxs-lookup"><span data-stu-id="59c5f-150">The size of the compressed buffer is not automatically saved, and the application needs to save this for decompression.</span></span> <span data-ttu-id="59c5f-151">Non includere il flag **compress \_ RAW** nel parametro *Algorithm* quando si chiama [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) e [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) per usare la modalità buffer.</span><span class="sxs-lookup"><span data-stu-id="59c5f-151">Do not include the **COMPRESS\_RAW** flag in the *Algorithm* parameter when you call [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) and [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) to use buffer mode.</span></span> <span data-ttu-id="59c5f-152">Per un esempio di codice di un'applicazione in modalità buffer, vedere la sezione [uso dell'API di compressione in modalità buffer](using-the-compression-api-in-buffer-mode.md) .</span><span class="sxs-lookup"><span data-stu-id="59c5f-152">For a code example of a buffer mode application, see the [Using the Compression API in buffer mode](using-the-compression-api-in-buffer-mode.md) section.</span></span>

<span data-ttu-id="59c5f-153">La modalità blocco consente allo sviluppatore di controllare le dimensioni del blocco, ma richiede un maggior numero di operazioni da parte dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="59c5f-153">Block mode enables the developer to control the block size, but requires more work be done by the application.</span></span> <span data-ttu-id="59c5f-154">Quando si usa la modalità blocco, l'applicazione deve suddividere i dati di input in parti opportunamente dimensionate quando si comprimono e quindi riportare insieme i componenti durante la decompressione.</span><span class="sxs-lookup"><span data-stu-id="59c5f-154">When using block mode, the application has to break the input data into appropriately sized pieces when compressing and then put the pieces back together when decompressing.</span></span> <span data-ttu-id="59c5f-155">La modalità di blocco ha esito negativo se la dimensione del buffer di input è maggiore della dimensione interna del blocco dell'algoritmo di compressione.</span><span class="sxs-lookup"><span data-stu-id="59c5f-155">The block mode fails if the size of the input buffer is greater than the internal block size of the compression algorithm.</span></span> <span data-ttu-id="59c5f-156">La dimensione del blocco interno è 32 KB per MSZIP e 1GB per gli algoritmi di compressione XPRESS.</span><span class="sxs-lookup"><span data-stu-id="59c5f-156">The internal block size is 32KB for the MSZIP and 1GB for the XPRESS compression algorithms.</span></span> <span data-ttu-id="59c5f-157">Le dimensioni del blocco interno per LZMS sono configurabili fino a 64 GB con un aumento corrispondente nell'uso della memoria.</span><span class="sxs-lookup"><span data-stu-id="59c5f-157">The internal block size for LZMS is configurable up to 64GB with a corresponding increase in memory use.</span></span> <span data-ttu-id="59c5f-158">La dimensione del buffer compresso non viene salvata automaticamente e l'applicazione deve anche salvare questa operazione per la decompressione.</span><span class="sxs-lookup"><span data-stu-id="59c5f-158">The size of the compressed buffer is not automatically saved, and the application also needs to save this for decompression.</span></span> <span data-ttu-id="59c5f-159">Il valore del parametro *UncompressedBufferSize* di [**Decompress**](/windows/desktop/api/compressapi/nf-compressapi-decompress) deve essere esattamente uguale alla dimensione originale dei dati non compressi e non solo alle dimensioni del buffer di output.</span><span class="sxs-lookup"><span data-stu-id="59c5f-159">The value of *UncompressedBufferSize* parameter of [**Decompress**](/windows/desktop/api/compressapi/nf-compressapi-decompress) must be exactly equal to the original size of the uncompressed data and not just the size of the output buffer.</span></span> <span data-ttu-id="59c5f-160">Ciò significa che l'applicazione deve salvare la dimensione originale esatta dei dati non compressi, nonché i dati compressi e le dimensioni compresse, quando si usa la modalità blocco.</span><span class="sxs-lookup"><span data-stu-id="59c5f-160">This means your application should save the exact original size of the uncompressed data, as well as the compressed data and compressed size, when using block mode.</span></span> <span data-ttu-id="59c5f-161">Includere il **flag compress \_ RAW** nel parametro *Algorithm* quando si chiamano sia [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) che [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) per usare la modalità di blocco.</span><span class="sxs-lookup"><span data-stu-id="59c5f-161">Include the **COMPRESS\_RAW** flag in the *Algorithm* parameter when you call both [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) and [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor) to use block mode.</span></span> <span data-ttu-id="59c5f-162">Per un esempio di codice di un'applicazione in modalità blocco, vedere la sezione [uso dell'API di compressione in modalità blocco](using-the-compression-api-in-block-mode.md) .</span><span class="sxs-lookup"><span data-stu-id="59c5f-162">For a code example of a block mode application, see the [Using the Compression API in block mode](using-the-compression-api-in-block-mode.md) section.</span></span>

## <a name="custom-memory-allocation"></a><span data-ttu-id="59c5f-163">Allocazione di memoria personalizzata</span><span class="sxs-lookup"><span data-stu-id="59c5f-163">Custom memory allocation</span></span>

<span data-ttu-id="59c5f-164">Le applicazioni in modalità blocco e di buffer hanno la possibilità di specificare una routine di allocazione della memoria personalizzata quando chiamano [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) e [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor).</span><span class="sxs-lookup"><span data-stu-id="59c5f-164">Buffer and block mode applications have the option to specify a custom memory allocation routine when they call [**CreateCompressor**](/windows/desktop/api/compressapi/nf-compressapi-createcompressor) and [**CreateDecompressor**](/windows/desktop/api/compressapi/nf-compressapi-createdecompressor).</span></span> <span data-ttu-id="59c5f-165">Il parametro *AllocationRoutines* specifica la struttura delle [**\_ \_ routine di allocazione di compressione**](/windows/desktop/api/compressapi/ns-compressapi-compress_allocation_routines) che contiene la routine di allocazione della memoria.</span><span class="sxs-lookup"><span data-stu-id="59c5f-165">The *AllocationRoutines* parameter specifies the [**COMPRESS\_ALLOCATION\_ROUTINES**](/windows/desktop/api/compressapi/ns-compressapi-compress_allocation_routines) structure that contains the memory allocation routine.</span></span> <span data-ttu-id="59c5f-166">L'applicazione può quindi impostare le dimensioni del blocco per il compressore usando [**SetCompressorInformation**](/windows/desktop/api/compressapi/nf-compressapi-setcompressorinformation).</span><span class="sxs-lookup"><span data-stu-id="59c5f-166">The application can then set the block size for the compressor using [**SetCompressorInformation**](/windows/desktop/api/compressapi/nf-compressapi-setcompressorinformation).</span></span> <span data-ttu-id="59c5f-167">Per un esempio di una semplice routine di allocazione personalizzata, vedere la sezione [utilizzo dell'API di compressione in modalità blocco](using-the-compression-api-in-block-mode.md) .</span><span class="sxs-lookup"><span data-stu-id="59c5f-167">See the [Using the Compression API in block mode](using-the-compression-api-in-block-mode.md) section for an example of a simple customized allocation routine.</span></span>

 

 



