---
title: Negoziazione del formato video nel plug-in DSP video di esempio
description: Negoziazione del formato video nel plug-in DSP video di esempio
ms.assetid: 3e92ce10-2b9b-4689-a181-f56c33472fea
keywords:
- Plug-in di Windows Media Player, video DSP
- plug-in, video DSP
- plug-in per l'elaborazione di segnali digitali, negoziazione del formato video
- Plug-in DSP, negoziazione del formato video
- plug-in di video DSP, negoziazione del formato
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c287a38fbfcf11f1b9d74087a91c5825b22f1243
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/16/2019
ms.locfileid: "104330247"
---
# <a name="video-format-negotiation-in-the-sample-video-dsp-plug-in"></a><span data-ttu-id="cf36e-108">Negoziazione del formato video nel plug-in DSP video di esempio</span><span class="sxs-lookup"><span data-stu-id="cf36e-108">Video Format Negotiation in the Sample Video DSP Plug-in</span></span>

<span data-ttu-id="cf36e-109">Prima che Windows Media Player inserisca un plug-in di DSP video nella catena di segnali, il lettore deve determinare se il plug-in è in grado di elaborare il video riprodotto.</span><span class="sxs-lookup"><span data-stu-id="cf36e-109">Before Windows Media Player inserts a video DSP plug-in into the signal chain, the Player must determine whether the plug-in can process the video being played.</span></span> <span data-ttu-id="cf36e-110">Il processo mediante il quale il plug-in e il lettore comunicano sui formati video supportati è denominato negoziazione del formato.</span><span class="sxs-lookup"><span data-stu-id="cf36e-110">The process by which the plug-in and the Player communicate about supported video formats is called format negotiation.</span></span>

## <a name="providing-the-supported-input-and-output-types"></a><span data-ttu-id="cf36e-111">Fornire i tipi di input e output supportati</span><span class="sxs-lookup"><span data-stu-id="cf36e-111">Providing the Supported Input and Output Types</span></span>

<span data-ttu-id="cf36e-112">Se il plug-in DSP funge da oggetto DMO (DirectX Media Object), il lettore esegue una query sul plug-in sui formati supportati eseguendo una sequenza di chiamate a **IMediaObject:: GetInputType** e **IMediaObject:: GetOutputType**.</span><span class="sxs-lookup"><span data-stu-id="cf36e-112">If the DSP plug-in is acting as a DirectX Media Object (DMO), the Player queries the plug-in about its supported formats by making a sequence of calls to **IMediaObject::GetInputType** and **IMediaObject::GetOutputType**.</span></span>

<span data-ttu-id="cf36e-113">Se il plug-in DSP funge da trasformazione Media Foundation (MFT), il lettore esegue una query sul plug-in sui formati supportati eseguendo una sequenza di chiamate a **IMFTransform:: GetInputAvailableType** e **IMFTransform:: GetOutputAvailableType**.</span><span class="sxs-lookup"><span data-stu-id="cf36e-113">If the DSP plug-in is acting as a Media Foundation Transform (MFT), the Player queries the plug-in about its supported formats by making a sequence of calls to **IMFTransform::GetInputAvailableType** and **IMFTransform::GetOutputAvailableType**.</span></span>

<span data-ttu-id="cf36e-114">Il plug-in video di esempio generato dalla procedura guidata per il plug-in di Windows Media Player archivia l'elenco dei formati video supportati come una matrice di GUID.</span><span class="sxs-lookup"><span data-stu-id="cf36e-114">The sample video plug-in generated by the Windows Media Player Plug-in Wizard stores the list of supported video formats as an array of GUIDs.</span></span> <span data-ttu-id="cf36e-115">Il codice seguente viene dal file Main. cpp:</span><span class="sxs-lookup"><span data-stu-id="cf36e-115">The following code is from the main .cpp file:</span></span>


```C++
static const GUID*    k_guidValidSubtypes[] = {
    &MEDIASUBTYPE_NV12,
    &MEDIASUBTYPE_YV12,
    &MEDIASUBTYPE_YUY2,
    &MEDIASUBTYPE_UYVY,
    &MEDIASUBTYPE_RGB32,
    &MEDIASUBTYPE_RGB24,
    &MEDIASUBTYPE RGB555,
    &MEDIASUBTYPE RGB565
};

```



<span data-ttu-id="cf36e-116">Il lettore può chiamare **IMediaObject:: GetInputType** e **IMediaObject:: GetOutputType** in qualsiasi ordine, quindi il codice del plug-in deve prevedere questa operazione.</span><span class="sxs-lookup"><span data-stu-id="cf36e-116">The Player can call **IMediaObject::GetInputType** and **IMediaObject::GetOutputType** in any order, so the plug-in code must anticipate this.</span></span> <span data-ttu-id="cf36e-117">Analogamente, il lettore può chiamare **IMFTransform:: GetInputAvailableType** e **IMFTransform:: GetOutputAvailableType** in qualsiasi ordine.</span><span class="sxs-lookup"><span data-stu-id="cf36e-117">Similary, the Player can call **IMFTransform::GetInputAvailableType** and **IMFTransform::GetOutputAvailableType** in any order.</span></span> <span data-ttu-id="cf36e-118">Le implementazioni di esempio di **GetOutputType** e **GetOutputAvailableType** verificano se il tipo di input è già stato definito.</span><span class="sxs-lookup"><span data-stu-id="cf36e-118">The sample implementations of **GetOutputType** and **GetOutputAvailableType** test whether the input type has already been defined.</span></span> <span data-ttu-id="cf36e-119">In caso contrario, il plug-in risponde che supporta solo quel tipo.</span><span class="sxs-lookup"><span data-stu-id="cf36e-119">If it has, the plug-in responds that it supports only that type.</span></span> <span data-ttu-id="cf36e-120">In caso contrario, il plug-in restituisce il tipo che corrisponde all'indice fornito, come illustrato nel codice seguente:</span><span class="sxs-lookup"><span data-stu-id="cf36e-120">Otherwise, the plug-in returns the type that corresponds to the supplied index, as the following code demonstrates:</span></span>


```C++
// If input type has been defined, then use that as output type.
if (GUID_NULL != m_mtInput.majortype)
{
    hr = ::MoCopyMediaType( pmt, &m_mtInput );
}
else // Otherwise use default for this plug-in.
{
    ::ZeroMemory( pmt, sizeof( DMO_MEDIA_TYPE ) );
    pmt->majortype = MEDIATYPE_Video;
    pmt->subtype = *k_guidValidSubtypes[dwTypeIndex];     
}

```



## <a name="setting-the-input-and-output-types"></a><span data-ttu-id="cf36e-121">Impostazione dei tipi di input e di output</span><span class="sxs-lookup"><span data-stu-id="cf36e-121">Setting the Input and Output Types</span></span>

<span data-ttu-id="cf36e-122">Se il plug-in DSP funge da DMO, Windows Media Player imposta il tipo di supporto chiamando **IMediaObject:: SetInputType** e **IMediaObject:: SetOutputType**, passando a ogni funzione un puntatore a una struttura del **\_ \_ tipo di supporto DMO** che rappresenta il tipo di supporto richiesto.</span><span class="sxs-lookup"><span data-stu-id="cf36e-122">If the DSP plug-in is acting as a DMO, Windows Media Player sets the media type by calling **IMediaObject::SetInputType** and **IMediaObject::SetOutputType**, passing to each function a pointer to a **DMO\_MEDIA\_TYPE** structure that represents the requested media type.</span></span>

<span data-ttu-id="cf36e-123">Se il plug-in DSP funge da MFT, Windows Media Player imposta il tipo di supporto chiamando **IMFTransform:: SetInputType** e **IMFTransform:: SetOutputType**, passando a ogni funzione un puntatore a un'interfaccia **IMFMediaType** che rappresenta il tipo di supporto richiesto.</span><span class="sxs-lookup"><span data-stu-id="cf36e-123">If the DSP plug-in is acting as an MFT, Windows Media Player sets the media type by calling **IMFTransform::SetInputType** and **IMFTransform::SetOutputType**, passing to each function a pointer to an **IMFMediaType** interface that represents the requested media type.</span></span>

<span data-ttu-id="cf36e-124">Non vi è alcuna garanzia che il lettore chiamerà i metodi di negoziazione del formato in un ordine particolare, quindi il codice del plug-in deve gestire qualsiasi caso.</span><span class="sxs-lookup"><span data-stu-id="cf36e-124">There is no guarantee that the Player will call format negotiation methods in any particular order, so plug-in code must handle any case.</span></span> <span data-ttu-id="cf36e-125">Ad esempio, se il giocatore chiama **SetOutputType** prima di chiamare **SetInputType**, è una valida azione per il plug-in per rifiutare il tipo di supporto di output proposto.</span><span class="sxs-lookup"><span data-stu-id="cf36e-125">For instance, if the Player calls **SetOutputType** before calling **SetInputType**, it is a valid course of action for the plug-in to reject the proposed output media type.</span></span> <span data-ttu-id="cf36e-126">Il codice seguente dell'implementazione di esempio di **IMediaObject:: SetOutputType** dimostra quanto segue:</span><span class="sxs-lookup"><span data-stu-id="cf36e-126">The following code from the sample implementation of **IMediaObject::SetOutputType** demonstrates this:</span></span>


```C++
if( GUID_NULL != m_mtInput.majortype )
{
    // Validate that the output media type matches our requirements 
    // and matches our input type (if set).
    hr = ValidateMediaType(pmt, &m_mtInput);
}
else
{
    hr = DMO_E_TYPE_NOT_ACCEPTED;
}

```



<span data-ttu-id="cf36e-127">Le implementazioni di plug-in di esempio di **SetInputType** e **SetOutputType** chiamano la funzione personalizzata denominata **ValidateMediaType**.</span><span class="sxs-lookup"><span data-stu-id="cf36e-127">The sample plug-in implementations of **SetInputType** and **SetOutputType** call the custom function named **ValidateMediaType**.</span></span> <span data-ttu-id="cf36e-128">Questa funzione plug-in esegue una serie di test sul tipo di supporto proposto progettato per garantire che il tipo di supporto sia ben formato e supportato dal plug-in.</span><span class="sxs-lookup"><span data-stu-id="cf36e-128">This plug-in function performs a series of tests on the proposed media type designed to ensure that the media type is well-formed and supported by the plug-in.</span></span> <span data-ttu-id="cf36e-129">**ValidateMediaType** esegue i test seguenti:</span><span class="sxs-lookup"><span data-stu-id="cf36e-129">**ValidateMediaType** performs the following tests:</span></span>

-   <span data-ttu-id="cf36e-130">Verifica che i membri **majortype** e **formatType** contengano i valori corretti.</span><span class="sxs-lookup"><span data-stu-id="cf36e-130">Verifies that the **majortype** and **formattype** members contain the correct values.</span></span>
-   <span data-ttu-id="cf36e-131">Verifica che il membro del **sottotipo** corrisponda a uno dei formati supportati.</span><span class="sxs-lookup"><span data-stu-id="cf36e-131">Verifies that the **subtype** member matches one of the supported formats.</span></span>
-   <span data-ttu-id="cf36e-132">Verifica che le informazioni nelle strutture **BITMAPINFOHEADER** e **VIDEOINFOHEADER** o **VIDEOINFOHEADER2** contengano valori validi.</span><span class="sxs-lookup"><span data-stu-id="cf36e-132">Verifies that the information in the **BITMAPINFOHEADER** and **VIDEOINFOHEADER** or **VIDEOINFOHEADER2** structures contain valid values.</span></span>
-   <span data-ttu-id="cf36e-133">Verifica se i tipi di supporto di input e di output corrispondono perché il plug-in non converte i formati dall'input all'output.</span><span class="sxs-lookup"><span data-stu-id="cf36e-133">Tests whether the input and output media types match because the plug-in does not convert formats from input to output.</span></span>

<span data-ttu-id="cf36e-134">Se il tipo di supporto proposto supera i test di convalida, viene archiviato in una variabile membro: **m \_ mtInput** per il tipo di supporto di input, **m \_ mtOutput** per il tipo di supporto di output.</span><span class="sxs-lookup"><span data-stu-id="cf36e-134">If the proposed media type passes the validation tests, it is stored in a member variable: **m\_mtInput** for the input media type, **m\_mtOutput** for the output media type.</span></span>

## <a name="related-topics"></a><span data-ttu-id="cf36e-135">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="cf36e-135">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="cf36e-136">**Implementazione di un plug-in video DSP**</span><span class="sxs-lookup"><span data-stu-id="cf36e-136">**Implementing a Video DSP Plug-in**</span></span>](implementing-a-video-dsp-plug-in.md)
</dt> </dl>

 

 




