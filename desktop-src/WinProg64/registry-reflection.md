---
title: Reflection del registro di sistema
description: Il redirector del registro di sistema isola le applicazioni a 32 bit e a 64 bit fornendo viste logiche separate di determinate parti del registro di sistema in WOW64. Tuttavia, i valori di alcune chiavi del registro di sistema devono essere gli stessi nelle viste a 32 bit e a 64 bit.
ms.assetid: eac9038b-9f59-4ac7-8974-f94a4a62a257
keywords:
- Reflection del registro di sistema a 64 bit programmazione Windows
- Programmazione Windows Reflection a 64 bit
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 523041004d9570bbdf101050e30f5d9139031913
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "106300058"
---
# <a name="registry-reflection"></a><span data-ttu-id="d3c87-106">Reflection del registro di sistema</span><span class="sxs-lookup"><span data-stu-id="d3c87-106">Registry Reflection</span></span>

<span data-ttu-id="d3c87-107">\[Le informazioni contenute in questo argomento si applicano a Windows Server 2008, Windows Vista, Windows Server 2003 e Windows XP.</span><span class="sxs-lookup"><span data-stu-id="d3c87-107">\[The information in this topic applies to Windows Server 2008, Windows Vista, Windows Server 2003, and Windows XP.</span></span> <span data-ttu-id="d3c87-108">A partire da Windows 7 e Windows Server 2008 R2, WOW64 non usa più la reflection del registro di sistema e le chiavi precedentemente riflesse sono invece condivise.</span><span class="sxs-lookup"><span data-stu-id="d3c87-108">Starting with Windows 7 and Windows Server 2008 R2, WOW64 no longer uses registry reflection and formerly reflected keys are shared instead.</span></span> <span data-ttu-id="d3c87-109">Per altre informazioni, vedere [chiavi del registro di sistema interessate da WOW64](shared-registry-keys.md).\]</span><span class="sxs-lookup"><span data-stu-id="d3c87-109">For more information, see [Registry Keys Affected by WOW64](shared-registry-keys.md).\]</span></span>

<span data-ttu-id="d3c87-110">Il [redirector del registro di sistema](registry-redirector.md) isola le applicazioni a 32 bit e a 64 bit fornendo viste logiche separate di determinate parti del registro di sistema in WOW64.</span><span class="sxs-lookup"><span data-stu-id="d3c87-110">The [registry redirector](registry-redirector.md) isolates 32-bit and 64-bit applications by providing separate logical views of certain portions of the registry on WOW64.</span></span> <span data-ttu-id="d3c87-111">Tuttavia, i valori di alcune chiavi del registro di sistema devono essere gli stessi nelle viste a 32 bit e a 64 bit.</span><span class="sxs-lookup"><span data-stu-id="d3c87-111">However, the values of some registry keys must be the same in both the 32-bit and 64-bit views.</span></span>

<span data-ttu-id="d3c87-112">Il processo di *Reflection del registro* di sistema copia le chiavi e i valori del registro di sistema tra due visualizzazioni del registro per mantenerle Sincronizza</span><span class="sxs-lookup"><span data-stu-id="d3c87-112">The process of *registry reflection* copies registry keys and values between two registry views to keep them synchronized.</span></span> <span data-ttu-id="d3c87-113">Ogni visualizzazione dispone di una copia fisica separata di ogni chiave del registro di sistema riflessa, una per la visualizzazione del registro di sistema a 32 bit e l'altra per la visualizzazione del registro di sistema a 64 bit.</span><span class="sxs-lookup"><span data-stu-id="d3c87-113">Each view has a separate physical copy of each reflected registry key, one for the 32-bit registry view and the other for the 64-bit registry view.</span></span>

<span data-ttu-id="d3c87-114">Una chiave riflessa viene copiata quando una chiave viene chiusa chiamando [**RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey).</span><span class="sxs-lookup"><span data-stu-id="d3c87-114">A reflected key is copied when a key is closed by calling [**RegCloseKey**](/windows/desktop/api/winreg/nf-winreg-regclosekey).</span></span> <span data-ttu-id="d3c87-115">Si noti che questa operazione consente di generare un possibile race condition: se più processi modificano la chiave riflessa, l'ultima chiamata **RegCloseKey** determina il valore finale della chiave.</span><span class="sxs-lookup"><span data-stu-id="d3c87-115">Note that this gives rise to a possible race condition: if more than one process changes the reflected key, the last **RegCloseKey** call determines the key's final value.</span></span>

<span data-ttu-id="d3c87-116">Il riflettore copia i dati di attivazione COM per i server locali tra le visualizzazioni, ma non copia i dati in-process perché la combinazione di 32/64 di dati in-process non è consentita in Windows a 64 bit.</span><span class="sxs-lookup"><span data-stu-id="d3c87-116">The reflector copies COM activation data for Local servers between the views, but it does not copy in-process data because 32/64 in-process data mixing is not permitted on 64-bit Windows.</span></span>

<span data-ttu-id="d3c87-117">La reflection non è abilitata per chiavi del registro di sistema condivise o per chiavi del registro di sistema non reindirizzate.</span><span class="sxs-lookup"><span data-stu-id="d3c87-117">Reflection is not enabled for shared registry keys or for registry keys that are not redirected.</span></span> <span data-ttu-id="d3c87-118">Ad esempio, la reflection non è abilitata per la chiave di **\_ \_ \\ sistema del computer locale HKEY** .</span><span class="sxs-lookup"><span data-stu-id="d3c87-118">For example, reflection is not enabled for the **HKEY\_LOCAL\_MACHINE\\System** key.</span></span> <span data-ttu-id="d3c87-119">Per un elenco delle chiavi del registro di sistema reindirizzate, condivise o riflesse, vedere le [chiavi del registro di sistema interessate da WOW64](shared-registry-keys.md).</span><span class="sxs-lookup"><span data-stu-id="d3c87-119">For a list of registry keys that are redirected, shared, or reflected, see [Registry Keys Affected by WOW64](shared-registry-keys.md).</span></span>

<span data-ttu-id="d3c87-120">La reflection del registro di sistema usa un criterio "ultimo writer wins", come illustrato nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="d3c87-120">Registry reflection uses a "last writer wins" policy as illustrated in the following example:</span></span>

-   <span data-ttu-id="d3c87-121">Dopo un'installazione pulita di Windows a 64 bit, viene registrato Wordpad.exe a 64 bit per gestire i file con estensione doc.</span><span class="sxs-lookup"><span data-stu-id="d3c87-121">After a clean installation of 64-bit Windows, 64-bit Wordpad.exe is registered to handle .doc files.</span></span> <span data-ttu-id="d3c87-122">Il riflettore copia la registrazione. doc dalla vista del registro di sistema a 64 bit nella visualizzazione del registro di sistema a 32 bit.</span><span class="sxs-lookup"><span data-stu-id="d3c87-122">The reflector copies the .doc registration from the 64-bit registry view into the 32-bit registry view.</span></span>
-   <span data-ttu-id="d3c87-123">Un amministratore installa Office a 32 bit, che registra Winword.exe a 32 bit per gestire i file con estensione doc nella visualizzazione del registro di sistema a 32 bit.</span><span class="sxs-lookup"><span data-stu-id="d3c87-123">An administrator installs 32-bit Office, which registers 32-bit Winword.exe to handle .doc files in the 32-bit registry view.</span></span> <span data-ttu-id="d3c87-124">Il riflettore del registro di sistema copia queste informazioni nella visualizzazione del registro di sistema a 64 bit, pertanto le applicazioni a 32 bit e 64 bit avviano la versione a 32 bit di Winword.exe per i file con estensione doc.</span><span class="sxs-lookup"><span data-stu-id="d3c87-124">The registry reflector copies this information into the 64-bit registry view, so both 32-bit and 64-bit applications launch the 32-bit version of Winword.exe for .doc files.</span></span>
-   <span data-ttu-id="d3c87-125">Un amministratore installa Office a 64 bit, che registra Winword.exe a 64 bit per gestire i file con estensione doc nella visualizzazione del registro di sistema a 64 bit.</span><span class="sxs-lookup"><span data-stu-id="d3c87-125">An administrator installs 64-bit Office, which registers 64-bit Winword.exe to handle .doc files in the 64-bit registry view.</span></span> <span data-ttu-id="d3c87-126">Il riflettore del registro di sistema copia queste informazioni nel registro di sistema a 32 bit, pertanto le applicazioni a 32 bit e 64 bit avviano la versione a 64 bit di Winword.exe per i file con estensione doc.</span><span class="sxs-lookup"><span data-stu-id="d3c87-126">The registry reflector copies this information into the 32-bit registry, so both 32-bit and 64-bit applications launch the 64-bit version of Winword.exe for .doc files.</span></span>

<span data-ttu-id="d3c87-127">Pertanto, le informazioni sull'associazione di file vengono conservate per l'applicazione installata più di recente.</span><span class="sxs-lookup"><span data-stu-id="d3c87-127">Therefore, the file association information is preserved for the most recently installed application.</span></span>

<span data-ttu-id="d3c87-128">Può essere utile per le applicazioni a 32 bit e a 64 bit per condividere valori di chiave del registro di sistema specifici che in genere vengono scritti in visualizzazioni del registro di sistema separate.</span><span class="sxs-lookup"><span data-stu-id="d3c87-128">It can be useful for 32-bit and 64-bit applications to share specific registry key values that are normally written to separate registry views.</span></span> <span data-ttu-id="d3c87-129">Ad esempio, un server OLE a 32 bit che può gestire le richieste da client sia a 32 bit che a 64 bit potrebbe rendere disponibili i dati del registro di sistema a 32 bit per la visualizzazione a 64 bit del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="d3c87-129">For example, a 32-bit OLE server that can serve requests from both 32-bit and 64-bit clients could make its 32-bit registry data available to the 64-bit view of the system registry.</span></span>

<span data-ttu-id="d3c87-130">Quando un componente scrive i dati nel registro di sistema, WOW64 analizza le informazioni ed esegue una copia dei dati nella visualizzazione alternativa del registro di sistema quando appropriato.</span><span class="sxs-lookup"><span data-stu-id="d3c87-130">When a component writes data in the system registry, WOW64 analyzes the information and makes a copy of the data in the alternate view of the registry when appropriate.</span></span> <span data-ttu-id="d3c87-131">In genere, questo processo mantiene due copie fisiche separate delle stesse chiavi del registro di sistema in entrambe le visualizzazioni del registro di sistema e viene chiamata Reflection del registro di sistema o mirroring del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="d3c87-131">Typically, this process keeps two separate physical copies of the same registry keys in both views in the registry, and is called registry reflection or registry mirroring.</span></span>

<span data-ttu-id="d3c87-132">La maggior parte delle chiavi sotto la radice delle classi si trova in questa categoria.</span><span class="sxs-lookup"><span data-stu-id="d3c87-132">Most of the keys under the classes root are in this category.</span></span> <span data-ttu-id="d3c87-133">Gli aggiornamenti alle chiavi vengono riflessi quando l'aggiornamento viene completato e l'handle per la chiave si chiude.</span><span class="sxs-lookup"><span data-stu-id="d3c87-133">Updates to the keys are reflected when the update completes and the handle to the key closes.</span></span> <span data-ttu-id="d3c87-134">In casi specifici, le Scritture in una chiave non vengono riflesse se la chiave ha una dipendenza bit.</span><span class="sxs-lookup"><span data-stu-id="d3c87-134">In specific cases, writes to a key are not reflected if the key has some bitness dependency.</span></span> <span data-ttu-id="d3c87-135">Ad esempio, la chiave InprocServer32 a 32 bit non è pertinente per le applicazioni a 64 bit, quindi la chiave InprocServer32 non viene riflessa nella visualizzazione del registro di sistema a 64 bit.</span><span class="sxs-lookup"><span data-stu-id="d3c87-135">For example, the 32-bit InprocServer32 key is not relevant for 64-bit applications, so the InprocServer32 key is not reflected to the 64-bit registry view.</span></span> <span data-ttu-id="d3c87-136">Tuttavia, le applicazioni a 64 bit possono utilizzare la chiave LocalServer32 a 32 bit e viene riflessa la chiave LocalServer32.</span><span class="sxs-lookup"><span data-stu-id="d3c87-136">However, 64-bit applications can use the 32-bit LocalServer32 key and the LocalServer32 key gets reflected.</span></span>

<span data-ttu-id="d3c87-137">Per **\_ \_ \\ \\ le classi \\ software del computer locale HKEY CLSID** e **HKEY \_ \_ \\ classi software utente correnti \\ \\ CLSID**, vengono riflessi solo i CLSID che non specificano InprocServer32 o InprocHandler32.</span><span class="sxs-lookup"><span data-stu-id="d3c87-137">For **HKEY\_LOCAL\_MACHINE\\Software\\Classes\\CLSID** and **HKEY\_CURRENT\_USER\\Software\\Classes\\CLSID**, only CLSIDs that do not specify InprocServer32 or InprocHandler32 are reflected.</span></span> <span data-ttu-id="d3c87-138">Solo i CLSID LocalServer32 vengono riflessi perché sono in esecuzione out-of-process e possono essere attivati da applicazioni 32 o 64 bit.</span><span class="sxs-lookup"><span data-stu-id="d3c87-138">Only LocalServer32 CLSIDs are reflected because they run out-of-process and can be activated by either 32- or 64-bit applications.</span></span> <span data-ttu-id="d3c87-139">I CLSID InProcServer32 non vengono riflessi perché non è possibile caricare una DLL a 32 bit per l'esecuzione in un processo a 64 bit o una DLL a 64 bit per l'esecuzione in un processo a 32 bit.</span><span class="sxs-lookup"><span data-stu-id="d3c87-139">InProcServer32 CLSIDs are not reflected because it is not possible to load a 32-bit DLL for execution in a 64-bit process, or a 64-bit DLL for execution in a 32-bit process.</span></span>

<span data-ttu-id="d3c87-140">Per le classi **\_ software del computer locale HKEY \_ \\ \\ \\ AppID** e **HKEY le \_ \_ \\ classi software utente correnti \\ \\ AppID**, i valori del registro di sistema [DllSurrogate](../com/dllsurrogate.md) e [DllSurrogateExecutable]( ../com/dllsurrogateexecutable.md) non vengono riflessi se il relativo valore è una stringa vuota.</span><span class="sxs-lookup"><span data-stu-id="d3c87-140">For **HKEY\_LOCAL\_MACHINE\\Software\\Classes\\Appid** and **HKEY\_CURRENT\_USER\\Software\\Classes\\Appid**, the [DllSurrogate](../com/dllsurrogate.md) and [DllSurrogateExecutable]( ../com/dllsurrogateexecutable.md) registry values are not reflected if their value is an empty string.</span></span>

<span data-ttu-id="d3c87-141">Per disabilitare e abilitare la reflection del registro di sistema per una particolare chiave riflessa, usare le funzioni [**RegDisableReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regdisablereflectionkey) e [**RegEnableReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regenablereflectionkey) .</span><span class="sxs-lookup"><span data-stu-id="d3c87-141">To disable and enable registry reflection for a particular reflected key, use the [**RegDisableReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regdisablereflectionkey) and [**RegEnableReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regenablereflectionkey) functions.</span></span> <span data-ttu-id="d3c87-142">Queste funzioni non influiscono sulle chiavi che non sono presenti nell'elenco di chiavi riflesse più indietro in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="d3c87-142">These functions do not affect keys that are not on the list of reflected keys earlier in this topic.</span></span> <span data-ttu-id="d3c87-143">Le applicazioni devono disabilitare la reflection solo per le chiavi del registro di sistema create e non tentare di disabilitare la reflection per le chiavi predefinite, ad esempio il **\_ \_ computer locale HKEY** o l' **\_ \_ utente corrente di HKEY**.</span><span class="sxs-lookup"><span data-stu-id="d3c87-143">Applications should disable reflection only for the registry keys that they create and not attempt to disable reflection for the predefined keys such as **HKEY\_LOCAL\_MACHINE** or **HKEY\_CURRENT\_USER**.</span></span> <span data-ttu-id="d3c87-144">Per determinare se le chiavi nell'elenco Reflection sono state disabilitate, utilizzare la funzione [**RegQueryReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regqueryreflectionkey) .</span><span class="sxs-lookup"><span data-stu-id="d3c87-144">To determine whether the keys on the reflection list have been disabled, use the [**RegQueryReflectionKey**](/windows/desktop/api/winreg/nf-winreg-regqueryreflectionkey) function.</span></span>

<span data-ttu-id="d3c87-145">Le chiavi riflesse non devono essere utilizzate nelle operazioni del registro di sistema transazionali.</span><span class="sxs-lookup"><span data-stu-id="d3c87-145">Reflected keys should not be used in transacted registry operations.</span></span> <span data-ttu-id="d3c87-146">La scrittura di chiavi riflesse durante una transazione può causare l'esito negativo della transazione.</span><span class="sxs-lookup"><span data-stu-id="d3c87-146">Writing to reflected keys during a transaction can cause the transaction to fail.</span></span> <span data-ttu-id="d3c87-147">Per ulteriori informazioni sulle transazioni, vedere [gestione transazioni kernel](/windows/desktop/Ktm/kernel-transaction-manager-portal).</span><span class="sxs-lookup"><span data-stu-id="d3c87-147">For more information about transactions, see [Kernel Transaction Manager](/windows/desktop/Ktm/kernel-transaction-manager-portal).</span></span>

## <a name="related-topics"></a><span data-ttu-id="d3c87-148">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="d3c87-148">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="d3c87-149">Redirector del registro di sistema</span><span class="sxs-lookup"><span data-stu-id="d3c87-149">Registry Redirector</span></span>](registry-redirector.md)
</dt> <dt>

[<span data-ttu-id="d3c87-150">Reflection del registro di sistema in Windows</span><span class="sxs-lookup"><span data-stu-id="d3c87-150">Registry Reflection in Windows</span></span>](/windows-hardware/drivers/display/microsoft-windows-vista-display-driver-64-bit-issues)
</dt> <dt>

[<span data-ttu-id="d3c87-151">Chiavi del registro di sistema interessate da WOW64</span><span class="sxs-lookup"><span data-stu-id="d3c87-151">Registry Keys Affected by WOW64</span></span>](shared-registry-keys.md)
</dt> </dl>

 

 