---
description: Windows fornisce le API che è possibile usare per acquisire indicatori temporali ad alta risoluzione o misurare gli intervalli di tempo.
ms.assetid: D66E0FC2-3AF2-489B-B4B5-78648905B77B
title: Acquisizione di timestamp ad alta risoluzione
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c9a1300967738b717ab8d8c822bf2af3f6a4a7ed
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "103968749"
---
# <a name="acquiring-high-resolution-time-stamps"></a><span data-ttu-id="f28c1-103">Acquisizione di timestamp ad alta risoluzione</span><span class="sxs-lookup"><span data-stu-id="f28c1-103">Acquiring high-resolution time stamps</span></span>

<span data-ttu-id="f28c1-104">Windows fornisce le API che è possibile usare per acquisire indicatori temporali ad alta risoluzione o misurare gli intervalli di tempo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-104">Windows provides APIs that you can use to acquire high-resolution time stamps or measure time intervals.</span></span> <span data-ttu-id="f28c1-105">L'API primaria per il codice nativo è [**QueryPerformanceCounter (QPC)**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="f28c1-105">The primary API for native code is [**QueryPerformanceCounter (QPC)**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="f28c1-106">Per i driver di dispositivo, l'API in modalità kernel è [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="f28c1-106">For device drivers, the kernel-mode API is [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter).</span></span> <span data-ttu-id="f28c1-107">Per il codice gestito, la classe [**System. Diagnostics. Stopwatch**](/previous-versions/windows/) USA **QPC** come base di tempo precisa.</span><span class="sxs-lookup"><span data-stu-id="f28c1-107">For managed code, the [**System.Diagnostics.Stopwatch**](/previous-versions/windows/) class uses **QPC** as its precise time basis.</span></span>

<span data-ttu-id="f28c1-108">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) è indipendente da e non è sincronizzato con un riferimento all'ora esterno.</span><span class="sxs-lookup"><span data-stu-id="f28c1-108">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is independent of and isn't synchronized to any external time reference.</span></span> <span data-ttu-id="f28c1-109">Per recuperare i timestamp che possono essere sincronizzati con un riferimento ora esterno, ad esempio l'ora UTC (Coordinated Universal Time) per l'uso in misurazioni temporali ad alta risoluzione, usare [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span><span class="sxs-lookup"><span data-stu-id="f28c1-109">To retrieve time stamps that can be synchronized to an external time reference, such as, Coordinated Universal Time (UTC) for use in high-resolution time-of-day measurements, use [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span></span>

<span data-ttu-id="f28c1-110">I timestamp e le misurazioni di intervallo di tempo sono parte integrante delle misurazioni delle prestazioni di rete e del computer.</span><span class="sxs-lookup"><span data-stu-id="f28c1-110">Time stamps and time-interval measurements are an integral part of computer and network performance measurements.</span></span> <span data-ttu-id="f28c1-111">Queste operazioni di misurazione delle prestazioni includono il calcolo del tempo di risposta, della velocità effettiva e della latenza, nonché dell'esecuzione del codice di profilatura.</span><span class="sxs-lookup"><span data-stu-id="f28c1-111">These performance measurement operations include the computation of response time, throughput, and latency as well as profiling code execution.</span></span> <span data-ttu-id="f28c1-112">Ognuna di queste operazioni comporta una misurazione delle attività che si verificano durante un intervallo di tempo definito da un evento di inizio e di fine che può essere indipendente da qualsiasi riferimento all'ora del giorno esterno.</span><span class="sxs-lookup"><span data-stu-id="f28c1-112">Each of these operations involves a measurement of activities that occur during a time interval that is defined by a start and an end event that can be independent of any external time-of-day reference.</span></span>

<span data-ttu-id="f28c1-113">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) è in genere il metodo migliore da usare per gli eventi timestamp e misurare intervalli di tempo ridotti che si verificano nello stesso sistema o nella stessa macchina virtuale.</span><span class="sxs-lookup"><span data-stu-id="f28c1-113">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is typically the best method to use to time-stamp events and measure small time intervals that occur on the same system or virtual machine.</span></span> <span data-ttu-id="f28c1-114">Si consiglia di usare [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime) quando si desidera eseguire il timestamp degli eventi tra più computer, purché ogni computer partecipi a uno schema di sincronizzazione dell'ora, ad esempio Network Time Protocol (NTP).</span><span class="sxs-lookup"><span data-stu-id="f28c1-114">Consider using [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime) when you want to time-stamp events across multiple machines, provided that each machine is participating in a time synchronization scheme such as Network Time Protocol (NTP).</span></span> <span data-ttu-id="f28c1-115">**QPC** consente di evitare le difficoltà che possono verificarsi con altri approcci di misurazione del tempo, ad esempio la lettura diretta del contatore del timestamp del processore (TSC).</span><span class="sxs-lookup"><span data-stu-id="f28c1-115">**QPC** helps you avoid difficulties that can be encountered with other time measurement approaches, such as reading the processor’s time stamp counter (TSC) directly.</span></span>

-   [<span data-ttu-id="f28c1-116">Supporto di QPC nelle versioni di Windows</span><span class="sxs-lookup"><span data-stu-id="f28c1-116">QPC support in Windows versions</span></span>](#qpc-support-in-windows-versions)
-   [<span data-ttu-id="f28c1-117">Linee guida per l'acquisizione di timestamp</span><span class="sxs-lookup"><span data-stu-id="f28c1-117">Guidance for acquiring time stamps</span></span>](#guidance-for-acquiring-time-stamps)
    -   [<span data-ttu-id="f28c1-118">Virtualizzazione</span><span class="sxs-lookup"><span data-stu-id="f28c1-118">Virtualization</span></span>](#virtualization)
    -   [<span data-ttu-id="f28c1-119">Utilizzo diretto di TSC</span><span class="sxs-lookup"><span data-stu-id="f28c1-119">Direct TSC usage</span></span>](#direct-tsc-usage)
    -   [<span data-ttu-id="f28c1-120">Esempi per l'acquisizione di timestamp</span><span class="sxs-lookup"><span data-stu-id="f28c1-120">Examples for acquiring time stamps</span></span>](#examples-for-acquiring-time-stamps)
-   [<span data-ttu-id="f28c1-121">Domande frequenti generali su QPC e TSC</span><span class="sxs-lookup"><span data-stu-id="f28c1-121">General FAQ about QPC and TSC</span></span>](#general-faq-about-qpc-and-tsc)
-   [<span data-ttu-id="f28c1-122">Domande frequenti sulla programmazione con QPC e TSC</span><span class="sxs-lookup"><span data-stu-id="f28c1-122">FAQ about programming with QPC and TSC</span></span>](#faq-about-programming-with-qpc-and-tsc)
-   [<span data-ttu-id="f28c1-123">Caratteristiche del clock hardware di basso livello</span><span class="sxs-lookup"><span data-stu-id="f28c1-123">Low-level hardware clock characteristics</span></span>](#low-level-hardware-clock-characteristics)
    -   [<span data-ttu-id="f28c1-124">Orologi assoluti e orologi di differenza</span><span class="sxs-lookup"><span data-stu-id="f28c1-124">Absolute Clocks and Difference Clocks</span></span>](#absolute-clocks-and-difference-clocks)
    -   [<span data-ttu-id="f28c1-125">Risoluzione, precisione, accuratezza e stabilità</span><span class="sxs-lookup"><span data-stu-id="f28c1-125">Resolution, Precision, Accuracy, and Stability</span></span>](#resolution-precision-accuracy-and-stability)
-   [<span data-ttu-id="f28c1-126">Informazioni sul timer hardware</span><span class="sxs-lookup"><span data-stu-id="f28c1-126">Hardware timer info</span></span>](#hardware-timer-info)

## <a name="qpc-support-in-windows-versions"></a><span data-ttu-id="f28c1-127">Supporto di QPC nelle versioni di Windows</span><span class="sxs-lookup"><span data-stu-id="f28c1-127">QPC support in Windows versions</span></span>

<span data-ttu-id="f28c1-128">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) è stato introdotto in Windows 2000 e Windows XP ed è stato sviluppato per sfruttare i miglioramenti apportati alla piattaforma hardware e ai processori.</span><span class="sxs-lookup"><span data-stu-id="f28c1-128">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) was introduced in Windows 2000 and Windows XP and has evolved to take advantage of improvements in the hardware platform and processors.</span></span> <span data-ttu-id="f28c1-129">Di seguito vengono descritte le caratteristiche di **QPC** su diverse versioni di Windows per semplificare la manutenzione del software in esecuzione in tali versioni di Windows.</span><span class="sxs-lookup"><span data-stu-id="f28c1-129">Here we describe the characteristics of **QPC** on different Windows versions to help you maintain software that runs on those Windows versions.</span></span>

### <a name="windows-xp-and-windows-2000"></a><span data-ttu-id="f28c1-130">Windows XP e Windows 2000</span><span class="sxs-lookup"><span data-stu-id="f28c1-130">Windows XP and Windows 2000</span></span>

<span data-ttu-id="f28c1-131">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) è disponibile in Windows XP e Windows 2000 e funziona bene nella maggior parte dei sistemi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-131">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is available on Windows XP and Windows 2000 and works well on most systems.</span></span> <span data-ttu-id="f28c1-132">Tuttavia, alcuni sistemi hardware ' BIOS non indicano correttamente le caratteristiche della CPU hardware (un TSC non invariante) e alcuni sistemi multicore o multiprocessore hanno usato processori con TSCs che non potevano essere sincronizzati tra i core.</span><span class="sxs-lookup"><span data-stu-id="f28c1-132">However, some hardware systems' BIOS didn't indicate the hardware CPU characteristics correctly (a non-invariant TSC), and some multi-core or multi-processor systems used processors with TSCs that couldn't be synchronized across cores.</span></span> <span data-ttu-id="f28c1-133">I sistemi con firmware difettoso che eseguono queste versioni di Windows potrebbero non fornire lo stesso **QPC** di lettura su core diversi se hanno usato il TSC come base per **QPC**.</span><span class="sxs-lookup"><span data-stu-id="f28c1-133">Systems with flawed firmware that run these versions of Windows might not provide the same **QPC** reading on different cores if they used the TSC as the basis for **QPC**.</span></span>

### <a name="windows-vista-and-windows-server-2008"></a><span data-ttu-id="f28c1-134">Windows Vista e Windows Server 2008</span><span class="sxs-lookup"><span data-stu-id="f28c1-134">Windows Vista and Windows Server 2008</span></span>

<span data-ttu-id="f28c1-135">Tutti i computer forniti con Windows Vista e Windows Server 2008 usavano un contatore della piattaforma (High Precision Event Timer (HPET)) o il timer di risparmio energia ACPI (timer PM) come base per [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="f28c1-135">All computers that shipped with Windows Vista and Windows Server 2008 used a platform counter (High Precision Event Timer (HPET)) or the ACPI Power Management Timer (PM timer) as the basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="f28c1-136">Questi timer di piattaforma hanno una latenza di accesso superiore rispetto al TSC e sono condivisi tra più processori.</span><span class="sxs-lookup"><span data-stu-id="f28c1-136">Such platform timers have higher access latency than the TSC and are shared between multiple processors.</span></span> <span data-ttu-id="f28c1-137">Questo limita la scalabilità di **QPC** se viene chiamata simultaneamente da più processori.</span><span class="sxs-lookup"><span data-stu-id="f28c1-137">This limits scalability of **QPC** if it is called concurrently from multiple processors.</span></span>

### <a name="windows-7-and-windows-server-2008-r2"></a><span data-ttu-id="f28c1-138">Windows 7 e Windows Server 2008 R2</span><span class="sxs-lookup"><span data-stu-id="f28c1-138">Windows 7 and Windows Server 2008 R2</span></span>

<span data-ttu-id="f28c1-139">La maggior parte dei computer Windows 7 e Windows Server 2008 R2 dispone di processori con TSCs a frequenza costante e usa questi contatori come base per [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="f28c1-139">The majority of Windows 7 and Windows Server 2008 R2 computers have processors with constant-rate TSCs and use these counters as the basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="f28c1-140">TSCs sono contatori hardware ad alta risoluzione a cui è possibile accedere con latenza molto bassa e overhead (nell'ordine di decine o centinaia di cicli del computer, a seconda del tipo di processore).</span><span class="sxs-lookup"><span data-stu-id="f28c1-140">TSCs are high-resolution per-processor hardware counters that can be accessed with very low latency and overhead (in the order of 10s or 100s of machine cycles, depending on the processor type).</span></span> <span data-ttu-id="f28c1-141">Windows 7 e Windows Server 2008 R2 usano TSCs come base di **QPC** nei sistemi di dominio a Clock singolo in cui il sistema operativo (o l'hypervisor) è in grado di sincronizzare strettamente i singoli TSCS tra tutti i processori durante l'inizializzazione del sistema.</span><span class="sxs-lookup"><span data-stu-id="f28c1-141">Windows 7 and Windows Server 2008 R2 use TSCs as the basis of **QPC** on single-clock domain systems where the operating system (or the hypervisor) is able to tightly synchronize the individual TSCs across all processors during system initialization.</span></span> <span data-ttu-id="f28c1-142">In tali sistemi, il costo della lettura del contatore delle prestazioni è significativamente inferiore rispetto ai sistemi che utilizzano un contatore della piattaforma.</span><span class="sxs-lookup"><span data-stu-id="f28c1-142">On such systems, the cost of reading the performance counter is significantly lower compared to systems that use a platform counter.</span></span> <span data-ttu-id="f28c1-143">Inoltre, non vi è alcun sovraccarico aggiuntivo per le chiamate simultanee e le query in modalità utente ignorano spesso le chiamate di sistema, riducendo ulteriormente il sovraccarico.</span><span class="sxs-lookup"><span data-stu-id="f28c1-143">Furthermore, there is no added overhead for concurrent calls and user-mode queries often bypass system calls, which further reduces overhead.</span></span> <span data-ttu-id="f28c1-144">Nei sistemi in cui il TSC non è adatto per il cronometraggio, Windows seleziona automaticamente un contatore della piattaforma (il timer HPET o il timer di PM ACPI) come base per **QPC**.</span><span class="sxs-lookup"><span data-stu-id="f28c1-144">On systems where the TSC is not suitable for timekeeping, Windows automatically selects a platform counter (either the HPET timer or the ACPI PM timer) as the basis for **QPC**.</span></span>

### <a name="windows-8-windows-81-windows-server-2012-and-windows-server-2012-r2"></a><span data-ttu-id="f28c1-145">Windows 8, Windows 8.1, Windows Server 2012 e Windows Server 2012 R2</span><span class="sxs-lookup"><span data-stu-id="f28c1-145">Windows 8, Windows 8.1, Windows Server 2012, and Windows Server 2012 R2</span></span>

<span data-ttu-id="f28c1-146">Windows 8, Windows 8.1, Windows Server 2012 e Windows Server 2012 R2 usano TSCs come base per il contatore delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f28c1-146">Windows 8, Windows 8.1, Windows Server 2012, and Windows Server 2012 R2 use TSCs as the basis for the performance counter.</span></span> <span data-ttu-id="f28c1-147">L'algoritmo di sincronizzazione TSC è stato significativamente migliorato per supportare al meglio i sistemi di grandi dimensioni con molti processori.</span><span class="sxs-lookup"><span data-stu-id="f28c1-147">The TSC synchronization algorithm was significantly improved to better accommodate large systems with many processors.</span></span> <span data-ttu-id="f28c1-148">È stato inoltre aggiunto il supporto per la nuova API di Time-of-Day precisa, che consente di acquisire timestamp precisi dal sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-148">In addition, support for the new precise time-of-day API was added, which enables acquiring precise wall clock time stamps from the operating system.</span></span> <span data-ttu-id="f28c1-149">Per altre informazioni, vedere [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span><span class="sxs-lookup"><span data-stu-id="f28c1-149">For more info, see [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span></span> <span data-ttu-id="f28c1-150">Nelle piattaforme PC Windows RT, il contatore delle prestazioni si basa su un contatore della piattaforma proprietario o sul contatore di sistema fornito dal timer generico Windows RT PC se la piattaforma è così attrezzata.</span><span class="sxs-lookup"><span data-stu-id="f28c1-150">On Windows RT PC platforms, the performance counter is based on either a proprietary platform counter or the system counter provided by the Windows RT PC Generic Timer if the platform is so equipped.</span></span>

## <a name="guidance-for-acquiring-time-stamps"></a><span data-ttu-id="f28c1-151">Linee guida per l'acquisizione di timestamp</span><span class="sxs-lookup"><span data-stu-id="f28c1-151">Guidance for acquiring time stamps</span></span>

<span data-ttu-id="f28c1-152">Windows ha e continuerà a investire nella fornitura di un contatore delle prestazioni affidabile ed efficiente.</span><span class="sxs-lookup"><span data-stu-id="f28c1-152">Windows has and will continue to invest in providing a reliable and efficient performance counter.</span></span> <span data-ttu-id="f28c1-153">Quando sono necessari timestamp con una risoluzione di 1 microsecondo o superiore e non sono necessari i timestamp da sincronizzare con un riferimento ora esterno, scegliere [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter), [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter)o [**KeQueryInterruptTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttimeprecise).</span><span class="sxs-lookup"><span data-stu-id="f28c1-153">When you need time stamps with a resolution of 1 microsecond or better and you don't need the time stamps to be synchronized to an external time reference, choose [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter), [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter), or [**KeQueryInterruptTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttimeprecise).</span></span> <span data-ttu-id="f28c1-154">Quando sono necessari timestamp con sincronizzazione UTC con una risoluzione di 1 microsecondo o superiore, scegliere [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime) o [**KeQuerySystemTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequerysystemtimeprecise).</span><span class="sxs-lookup"><span data-stu-id="f28c1-154">When you need UTC-synchronized time stamps with a resolution of 1 microsecond or better, choose [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime) or [**KeQuerySystemTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequerysystemtimeprecise).</span></span>

<span data-ttu-id="f28c1-155">In un numero relativamente ridotto di piattaforme che non possono usare il registro TSC come base [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) , ad esempio, per i motivi illustrati nelle [informazioni sul timer hardware](#hardware-timer-info), l'acquisizione di timestamp ad alta risoluzione può essere notevolmente più costosa rispetto all'acquisizione di timestamp con risoluzione inferiore.</span><span class="sxs-lookup"><span data-stu-id="f28c1-155">On a relatively small number of platforms that can't use the TSC register as the [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) basis, for example, for reasons explained in [Hardware timer info](#hardware-timer-info), acquiring high resolution time stamps can be significantly more expensive than acquiring time stamps with lower resolution.</span></span> <span data-ttu-id="f28c1-156">Se è sufficiente la risoluzione da 10 a 16 millisecondi, è possibile usare [**GetTickCount64**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount64), [**QueryInterruptTime**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryinterrupttime), [**QueryUnbiasedInterruptTime**](/windows/win32/api/realtimeapiset/nf-realtimeapiset-queryunbiasedinterrupttime), [**KeQueryInterruptTime**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttime)o [**KeQueryUnbiasedInterruptTime**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryunbiasedinterrupttime) per ottenere i timestamp non sincronizzati con un riferimento ora esterno.</span><span class="sxs-lookup"><span data-stu-id="f28c1-156">If resolution of 10 to 16 milliseconds is sufficient, you can use [**GetTickCount64**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount64), [**QueryInterruptTime**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryinterrupttime), [**QueryUnbiasedInterruptTime**](/windows/win32/api/realtimeapiset/nf-realtimeapiset-queryunbiasedinterrupttime), [**KeQueryInterruptTime**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttime), or [**KeQueryUnbiasedInterruptTime**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryunbiasedinterrupttime) to obtain time stamps that aren't synchronized to an external time reference.</span></span> <span data-ttu-id="f28c1-157">Per gli indicatori di ora UTC sincronizzati, utilizzare [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) o [**KeQuerySystemTime**](/windows-hardware/drivers/ddi/wdm/nf-wdm-kequerysystemtime~r1).</span><span class="sxs-lookup"><span data-stu-id="f28c1-157">For UTC-synchronized time stamps, use [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) or [**KeQuerySystemTime**](/windows-hardware/drivers/ddi/wdm/nf-wdm-kequerysystemtime~r1).</span></span> <span data-ttu-id="f28c1-158">Se è necessaria una risoluzione più elevata, è possibile usare [**QueryInterruptTimePrecise**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryinterrupttimeprecise), [**QueryUnbiasedInterruptTimePrecise**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryunbiasedinterrupttimeprecise)o [**KeQueryInterruptTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttimeprecise) per ottenere i timestamp.</span><span class="sxs-lookup"><span data-stu-id="f28c1-158">If higher resolution is needed, you can use [**QueryInterruptTimePrecise**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryinterrupttimeprecise), [**QueryUnbiasedInterruptTimePrecise**](/windows/desktop/api/realtimeapiset/nf-realtimeapiset-queryunbiasedinterrupttimeprecise), or [**KeQueryInterruptTimePrecise**](/windows-hardware/drivers/ddi/content/wdm/nf-wdm-kequeryinterrupttimeprecise) to obtain time stamps instead.</span></span>

<span data-ttu-id="f28c1-159">In generale, i risultati dei contatori delle prestazioni sono coerenti in tutti i processori nei sistemi multicore e multiprocessore, anche se misurati in thread o processi diversi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-159">In general, the performance counter results are consistent across all processors in multi-core and multi-processor systems, even when measured on different threads or processes.</span></span> <span data-ttu-id="f28c1-160">Di seguito sono riportate alcune eccezioni a questa regola:</span><span class="sxs-lookup"><span data-stu-id="f28c1-160">Here are some exceptions to this rule:</span></span>

-   <span data-ttu-id="f28c1-161">I sistemi operativi precedenti a Windows Vista eseguiti su determinati processori potrebbero violare questa coerenza a causa di uno dei motivi seguenti:</span><span class="sxs-lookup"><span data-stu-id="f28c1-161">Pre-Windows Vista operating systems that run on certain processors might violate this consistency because of one of these reasons:</span></span>

    -   <span data-ttu-id="f28c1-162">I processori hardware hanno un TSC non invariante e il BIOS non indica correttamente questa condizione.</span><span class="sxs-lookup"><span data-stu-id="f28c1-162">The hardware processors have a non-invariant TSC and the BIOS doesn't indicate this condition correctly.</span></span>
    -   <span data-ttu-id="f28c1-163">L'algoritmo di sincronizzazione TSC utilizzato non era adatto per i sistemi con un numero elevato di processori.</span><span class="sxs-lookup"><span data-stu-id="f28c1-163">The TSC synchronization algorithm that was used wasn't suitable for systems with large numbers of processors.</span></span>

-   <span data-ttu-id="f28c1-164">Quando si confrontano i risultati dei contatori delle prestazioni acquisiti da thread diversi, prendere in considerazione i valori che differiscono per ± 1, per avere un ordinamento ambiguo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-164">When you compare performance counter results that are acquired from different threads, consider values that differ by ± 1 tick to have an ambiguous ordering.</span></span> <span data-ttu-id="f28c1-165">Se gli indicatori di data e ora vengono ricavati dallo stesso thread, l'incertezza di ± 1 non viene applicata.</span><span class="sxs-lookup"><span data-stu-id="f28c1-165">If the time stamps are taken from the same thread, this ± 1 tick uncertainty doesn't apply.</span></span> <span data-ttu-id="f28c1-166">In questo contesto, il termine segno si riferisce a un periodo di tempo uguale a 1 ÷ (la frequenza del contatore delle prestazioni ottenuto da [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency)).</span><span class="sxs-lookup"><span data-stu-id="f28c1-166">In this context, the term tick refers to a period of time equal to 1 ÷ (the frequency of the performance counter obtained from [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency)).</span></span>

<span data-ttu-id="f28c1-167">Quando si usa il contatore delle prestazioni in sistemi server di grandi dimensioni con domini a più clock che non sono sincronizzati nell'hardware, Windows determina che il TSC non può essere usato a scopo di temporizzazione e seleziona un contatore della piattaforma come base per [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="f28c1-167">When you use the performance counter on large server systems with multiple-clock domains that aren't synchronized in hardware, Windows determines that the TSC can't be used for timing purposes and selects a platform counter as the basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="f28c1-168">Sebbene questo scenario produca comunque indicatori di tempo affidabili, la latenza e la scalabilità dell'accesso sono compromesse.</span><span class="sxs-lookup"><span data-stu-id="f28c1-168">While this scenario still yields reliable time stamps, the access latency and scalability is adversely affected.</span></span> <span data-ttu-id="f28c1-169">Pertanto, come indicato in precedenza nelle linee guida per l'utilizzo precedenti, usare solo le API che forniscono una soluzione microsecondo o migliore quando è necessaria una risoluzione di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-169">Therefore, as previously stated in the preceding usage guidance, only use the APIs that provide 1 microsecond or better resolution when such resolution is necessary.</span></span> <span data-ttu-id="f28c1-170">Il TSC viene usato come base per **QPC** nei sistemi di dominio a più clock che includono la sincronizzazione hardware di tutti i domini di clock del processore, in quanto ciò li rende effettivamente funzioni come un unico sistema di dominio di clock.</span><span class="sxs-lookup"><span data-stu-id="f28c1-170">The TSC is used as the basis for **QPC** on multi-clock domain systems that include hardware synchronization of all processor clock domains, as this effectively makes them function as a single clock domain system.</span></span>

<span data-ttu-id="f28c1-171">La frequenza del contatore delle prestazioni è fissa all'avvio del sistema ed è coerente in tutti i processori, quindi è sufficiente eseguire una query sulla frequenza da [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) durante l'inizializzazione dell'applicazione e quindi memorizzare nella cache il risultato.</span><span class="sxs-lookup"><span data-stu-id="f28c1-171">The frequency of the performance counter is fixed at system boot and is consistent across all processors so you only need to query the frequency from [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) as the application initializes, and then cache the result.</span></span>

### <a name="virtualization"></a><span data-ttu-id="f28c1-172">Virtualizzazione</span><span class="sxs-lookup"><span data-stu-id="f28c1-172">Virtualization</span></span>

<span data-ttu-id="f28c1-173">Il contatore delle prestazioni dovrebbe funzionare in modo affidabile in tutte le macchine virtuali guest eseguite in hypervisor correttamente implementati.</span><span class="sxs-lookup"><span data-stu-id="f28c1-173">The performance counter is expected to work reliably on all guest virtual machines running on correctly implemented hypervisors.</span></span> <span data-ttu-id="f28c1-174">Tuttavia, gli hypervisor che sono conformi all'interfaccia dell'hypervisor versione 1,0 e la superficie dell'Illuminismo del tempo di riferimento possono offrire un sovraccarico notevolmente inferiore.</span><span class="sxs-lookup"><span data-stu-id="f28c1-174">However, hypervisors that comply with the hypervisor version 1.0 interface and surface the reference time enlightenment can offer substantially lower overhead.</span></span> <span data-ttu-id="f28c1-175">Per ulteriori informazioni sulle interfacce hypervisor e sugli illuminamenti, vedere [specifiche hypervisor](/virtualization/hyper-v-on-windows/reference/tlfs).</span><span class="sxs-lookup"><span data-stu-id="f28c1-175">For more information about hypervisor interfaces and enlightenments, see [Hypervisor Specifications](/virtualization/hyper-v-on-windows/reference/tlfs).</span></span>

### <a name="direct-tsc-usage"></a><span data-ttu-id="f28c1-176">Utilizzo diretto di TSC</span><span class="sxs-lookup"><span data-stu-id="f28c1-176">Direct TSC usage</span></span>

<span data-ttu-id="f28c1-177">È fortemente sconsigliato l'uso dell'istruzione del processore **RDTSC** o **rdtscp (** per eseguire direttamente una query sul TSC perché non si ottengono risultati affidabili in alcune versioni di Windows, tra migrazioni in tempo reale di macchine virtuali e su sistemi hardware senza invariante o con TSCS strettamente sincronizzati.</span><span class="sxs-lookup"><span data-stu-id="f28c1-177">We strongly discourage using the **RDTSC** or **RDTSCP** processor instruction to directly query the TSC because you won't get reliable results on some versions of Windows, across live migrations of virtual machines, and on hardware systems without invariant or tightly synchronized TSCs.</span></span> <span data-ttu-id="f28c1-178">Si consiglia invece di usare [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) per sfruttare l'astrazione, la coerenza e la portabilità che offre.</span><span class="sxs-lookup"><span data-stu-id="f28c1-178">Instead, we encourage you to use [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) to leverage the abstraction, consistency, and portability that it offers.</span></span>

### <a name="examples-for-acquiring-time-stamps"></a><span data-ttu-id="f28c1-179">Esempi per l'acquisizione di timestamp</span><span class="sxs-lookup"><span data-stu-id="f28c1-179">Examples for acquiring time stamps</span></span>

<span data-ttu-id="f28c1-180">I vari esempi di codice in queste sezioni illustrano come acquisire timestamp.</span><span class="sxs-lookup"><span data-stu-id="f28c1-180">The various code examples in these sections show how to acquire time stamps.</span></span>

### <a name="using-qpc-in-native-code"></a><span data-ttu-id="f28c1-181">Uso di QPC nel codice nativo</span><span class="sxs-lookup"><span data-stu-id="f28c1-181">Using QPC in native code</span></span>

<span data-ttu-id="f28c1-182">Questo esempio Mostra come usare [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) in codice nativo C e C++.</span><span class="sxs-lookup"><span data-stu-id="f28c1-182">This example shows how to use [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) in C and C++ native code.</span></span>


```C++
LARGE_INTEGER StartingTime, EndingTime, ElapsedMicroseconds;
LARGE_INTEGER Frequency;

QueryPerformanceFrequency(&Frequency); 
QueryPerformanceCounter(&StartingTime);

// Activity to be timed

QueryPerformanceCounter(&EndingTime);
ElapsedMicroseconds.QuadPart = EndingTime.QuadPart - StartingTime.QuadPart;


//
// We now have the elapsed number of ticks, along with the
// number of ticks-per-second. We use these values
// to convert to the number of elapsed microseconds.
// To guard against loss-of-precision, we convert
// to microseconds *before* dividing by ticks-per-second.
//

ElapsedMicroseconds.QuadPart *= 1000000;
ElapsedMicroseconds.QuadPart /= Frequency.QuadPart;
```



### <a name="acquiring-high-resolution-time-stamps-from-managed-code"></a><span data-ttu-id="f28c1-183">Acquisizione di timestamp ad alta risoluzione dal codice gestito</span><span class="sxs-lookup"><span data-stu-id="f28c1-183">Acquiring high resolution time stamps from managed code</span></span>

<span data-ttu-id="f28c1-184">Questo esempio illustra come usare la classe [**System. Diagnostics. Stopwatch**](/previous-versions/windows/) di codice gestito.</span><span class="sxs-lookup"><span data-stu-id="f28c1-184">This example shows how to use the managed code [**System.Diagnostics.Stopwatch**](/previous-versions/windows/) class.</span></span>


```CSharp
using System.Diagnostics;

long StartingTime = Stopwatch.GetTimestamp();

// Activity to be timed

long EndingTime  = Stopwatch.GetTimestamp();
long ElapsedTime = EndingTime - StartingTime;

double ElapsedSeconds = ElapsedTime * (1.0 / Stopwatch.Frequency);
```



<span data-ttu-id="f28c1-185">La classe [**System. Diagnostics. Stopwatch**](/previous-versions/windows/) fornisce anche diversi metodi pratici per eseguire misure di intervallo di tempo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-185">The [**System.Diagnostics.Stopwatch**](/previous-versions/windows/) class also provides several convenient methods to perform time-interval measurements.</span></span>

### <a name="using-qpc-from-kernel-mode"></a><span data-ttu-id="f28c1-186">Uso di QPC dalla modalità kernel</span><span class="sxs-lookup"><span data-stu-id="f28c1-186">Using QPC from kernel mode</span></span>

<span data-ttu-id="f28c1-187">Il kernel di Windows fornisce l'accesso in modalità kernel al contatore delle prestazioni tramite [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter) da cui è possibile ottenere sia il contatore delle prestazioni che la frequenza delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="f28c1-187">The Windows kernel provides kernel-mode access to the performance counter through [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter) from which both the performance counter and performance frequency can be obtained.</span></span> <span data-ttu-id="f28c1-188">**KeQueryPerformanceCounter** è disponibile solo in modalità kernel e viene fornito per writer di driver di dispositivo e altri componenti in modalità kernel.</span><span class="sxs-lookup"><span data-stu-id="f28c1-188">**KeQueryPerformanceCounter** is available from kernel mode only and is provided for writers of device drivers and other kernel-mode components.</span></span>

<span data-ttu-id="f28c1-189">Questo esempio Mostra come usare [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter) in modalità kernel C e C++.</span><span class="sxs-lookup"><span data-stu-id="f28c1-189">This example shows how to use [**KeQueryPerformanceCounter**](/windows-hardware/drivers/ddi/content/ntifs/nf-ntifs-kequeryperformancecounter) in C and C++ kernel mode.</span></span>


```C++
LARGE_INTEGER StartingTime, EndingTime, ElapsedMicroseconds;
LARGE_INTEGER Frequency;

StartingTime = KeQueryPerformanceCounter(&Frequency);

// Activity to be timed

EndingTime = KeQueryPerformanceCounter(NULL);
ElapsedMicroseconds.QuadPart = EndingTime.QuadPart - StartingTime.QuadPart;
ElapsedMicroseconds.QuadPart *= 1000000;
ElapsedMicroseconds.QuadPart /= Frequency.QuadPart;
```



## <a name="general-faq-about-qpc-and-tsc"></a><span data-ttu-id="f28c1-190">Domande frequenti generali su QPC e TSC</span><span class="sxs-lookup"><span data-stu-id="f28c1-190">General FAQ about QPC and TSC</span></span>

<span data-ttu-id="f28c1-191">Di seguito sono riportate le risposte alle domande frequenti su [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) e TSCS in generale.</span><span class="sxs-lookup"><span data-stu-id="f28c1-191">Here are answers to frequently-asked questions about [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) and TSCs in general.</span></span>

<dl> <dt>

<span data-ttu-id="f28c1-192"><span id="Is_QueryPerformanceCounter___the_same_as_the_Win32_GetTickCount___or_________GetTickCount64___function_"></span><span id="is_queryperformancecounter___the_same_as_the_win32_gettickcount___or_________gettickcount64___function_"></span><span id="IS_QUERYPERFORMANCECOUNTER___THE_SAME_AS_THE_WIN32_GETTICKCOUNT___OR_________GETTICKCOUNT64___FUNCTION_"></span>**QueryPerformanceCounter () è uguale alla funzione Win32 GetTickCount () o GetTickCount64 ()?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-192"><span id="Is_QueryPerformanceCounter___the_same_as_the_Win32_GetTickCount___or_________GetTickCount64___function_"></span><span id="is_queryperformancecounter___the_same_as_the_win32_gettickcount___or_________gettickcount64___function_"></span><span id="IS_QUERYPERFORMANCECOUNTER___THE_SAME_AS_THE_WIN32_GETTICKCOUNT___OR_________GETTICKCOUNT64___FUNCTION_"></span>**Is QueryPerformanceCounter() the same as the Win32 GetTickCount() or GetTickCount64() function?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-193">No.</span><span class="sxs-lookup"><span data-stu-id="f28c1-193">No.</span></span> <span data-ttu-id="f28c1-194">[**GetTickCount**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount) e [**GetTickCount64**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount64) non sono correlati a [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="f28c1-194">[**GetTickCount**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount) and [**GetTickCount64**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-gettickcount64) aren't related to [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="f28c1-195">**GetTickCount** e **GetTickCount64** restituiscono il numero di millisecondi trascorsi dall'avvio del sistema.</span><span class="sxs-lookup"><span data-stu-id="f28c1-195">**GetTickCount** and **GetTickCount64** return the number of milliseconds since the system was started.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-196"><span id="Should_I_use_QPC_or_call_the_RDTSC__RDTSCP_instructions_directly_"></span><span id="should_i_use_qpc_or_call_the_rdtsc__rdtscp_instructions_directly_"></span><span id="SHOULD_I_USE_QPC_OR_CALL_THE_RDTSC__RDTSCP_INSTRUCTIONS_DIRECTLY_"></span>**È consigliabile usare QPC o chiamare direttamente le istruzioni/RDTSCP RDTSC?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-196"><span id="Should_I_use_QPC_or_call_the_RDTSC__RDTSCP_instructions_directly_"></span><span id="should_i_use_qpc_or_call_the_rdtsc__rdtscp_instructions_directly_"></span><span id="SHOULD_I_USE_QPC_OR_CALL_THE_RDTSC__RDTSCP_INSTRUCTIONS_DIRECTLY_"></span>**Should I use QPC or call the RDTSC /RDTSCP instructions directly?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-197">Per evitare problemi di correttezza e portabilità, è consigliabile usare [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) invece di usare il registro TSC o le istruzioni del processore **RDTSC** o **rdtscp (** .</span><span class="sxs-lookup"><span data-stu-id="f28c1-197">To avoid incorrectness and portability issues, we strongly encourage you to use [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) instead of using the TSC register or the **RDTSC** or **RDTSCP** processor instructions.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-198"><span id="What_is_QPC_s_relation_to_an_external_time_epoch__Can_it_be_synchronized_to_an_________external_epoch_such_as_UTC_"></span><span id="what_is_qpc_s_relation_to_an_external_time_epoch__can_it_be_synchronized_to_an_________external_epoch_such_as_utc_"></span><span id="WHAT_IS_QPC_S_RELATION_TO_AN_EXTERNAL_TIME_EPOCH__CAN_IT_BE_SYNCHRONIZED_TO_AN_________EXTERNAL_EPOCH_SUCH_AS_UTC_"></span>**Qual è la relazione di QPC con un periodo di tempo esterno? Può essere sincronizzato con un'Epoch esterna, ad esempio UTC?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-198"><span id="What_is_QPC_s_relation_to_an_external_time_epoch__Can_it_be_synchronized_to_an_________external_epoch_such_as_UTC_"></span><span id="what_is_qpc_s_relation_to_an_external_time_epoch__can_it_be_synchronized_to_an_________external_epoch_such_as_utc_"></span><span id="WHAT_IS_QPC_S_RELATION_TO_AN_EXTERNAL_TIME_EPOCH__CAN_IT_BE_SYNCHRONIZED_TO_AN_________EXTERNAL_EPOCH_SUCH_AS_UTC_"></span>**What is QPC’s relation to an external time epoch? Can it be synchronized to an external epoch such as UTC?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-199">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) si basa su un contatore hardware che non può essere sincronizzato con un riferimento all'ora esterno, ad esempio UTC.</span><span class="sxs-lookup"><span data-stu-id="f28c1-199">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is based on a hardware counter that can't be synchronized to an external time reference, such as UTC.</span></span> <span data-ttu-id="f28c1-200">Per gli indicatori di data e ora specifici che possono essere sincronizzati con un riferimento UTC esterno, usare [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span><span class="sxs-lookup"><span data-stu-id="f28c1-200">For precise time-of-day time stamps that can be synchronized to an external UTC reference, use [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-201"><span id="Is_QPC_affected_by_daylight_savings_time__leap_seconds__time_zones__or_system_________time_changes_made_by_the_administrator_"></span><span id="is_qpc_affected_by_daylight_savings_time__leap_seconds__time_zones__or_system_________time_changes_made_by_the_administrator_"></span><span id="IS_QPC_AFFECTED_BY_DAYLIGHT_SAVINGS_TIME__LEAP_SECONDS__TIME_ZONES__OR_SYSTEM_________TIME_CHANGES_MADE_BY_THE_ADMINISTRATOR_"></span>**QPC è influenzato dall'ora legale, dai secondi intercalari, dai fusi orari o dalle modifiche dell'ora di sistema apportate dall'amministratore?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-201"><span id="Is_QPC_affected_by_daylight_savings_time__leap_seconds__time_zones__or_system_________time_changes_made_by_the_administrator_"></span><span id="is_qpc_affected_by_daylight_savings_time__leap_seconds__time_zones__or_system_________time_changes_made_by_the_administrator_"></span><span id="IS_QPC_AFFECTED_BY_DAYLIGHT_SAVINGS_TIME__LEAP_SECONDS__TIME_ZONES__OR_SYSTEM_________TIME_CHANGES_MADE_BY_THE_ADMINISTRATOR_"></span>**Is QPC affected by daylight savings time, leap seconds, time zones, or system time changes made by the administrator?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-202">No.</span><span class="sxs-lookup"><span data-stu-id="f28c1-202">No.</span></span> <span data-ttu-id="f28c1-203">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) è completamente indipendente dall'ora di sistema e dall'ora UTC.</span><span class="sxs-lookup"><span data-stu-id="f28c1-203">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is completely independent of the system time and UTC.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-204"><span id="Is_QPC_accuracy_affected_by_processor_frequency_changes_caused_by_power_________management_or_Turbo_Boost_technology_"></span><span id="is_qpc_accuracy_affected_by_processor_frequency_changes_caused_by_power_________management_or_turbo_boost_technology_"></span><span id="IS_QPC_ACCURACY_AFFECTED_BY_PROCESSOR_FREQUENCY_CHANGES_CAUSED_BY_POWER_________MANAGEMENT_OR_TURBO_BOOST_TECHNOLOGY_"></span>**QPC è influenzato dall'accuratezza delle modifiche della frequenza del processore dovute alla tecnologia di risparmio energia o Turbo Boost?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-204"><span id="Is_QPC_accuracy_affected_by_processor_frequency_changes_caused_by_power_________management_or_Turbo_Boost_technology_"></span><span id="is_qpc_accuracy_affected_by_processor_frequency_changes_caused_by_power_________management_or_turbo_boost_technology_"></span><span id="IS_QPC_ACCURACY_AFFECTED_BY_PROCESSOR_FREQUENCY_CHANGES_CAUSED_BY_POWER_________MANAGEMENT_OR_TURBO_BOOST_TECHNOLOGY_"></span>**Is QPC accuracy affected by processor frequency changes caused by power management or Turbo Boost technology?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-205">No.</span><span class="sxs-lookup"><span data-stu-id="f28c1-205">No.</span></span> <span data-ttu-id="f28c1-206">Se il processore ha un TSC invariante, il [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) non è interessato da queste modifiche.</span><span class="sxs-lookup"><span data-stu-id="f28c1-206">If the processor has an invariant TSC, the [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is not affected by these sort of changes.</span></span> <span data-ttu-id="f28c1-207">Se il processore non ha un TSC invariante, **QPC** verrà ripristinato un timer hardware della piattaforma che non sarà influenzato dalle modifiche della frequenza del processore o dalla tecnologia Turbo Boost.</span><span class="sxs-lookup"><span data-stu-id="f28c1-207">If the processor doesn't have an invariant TSC, **QPC** will revert to a platform hardware timer that won't be affected by processor frequency changes or Turbo Boost technology.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-208"><span id="Does_QPC_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_"></span><span id="does_qpc_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_"></span><span id="DOES_QPC_RELIABLY_WORK_ON_MULTI-PROCESSOR_SYSTEMS__MULTI-CORE_SYSTEM__AND_________SYSTEMS_WITH_HYPER-THREADING_"></span>**QPC funziona in modo affidabile su sistemi multiprocessore, sistema multicore e sistemi con Hyper-Threading?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-208"><span id="Does_QPC_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_"></span><span id="does_qpc_reliably_work_on_multi-processor_systems__multi-core_system__and_________systems_with_hyper-threading_"></span><span id="DOES_QPC_RELIABLY_WORK_ON_MULTI-PROCESSOR_SYSTEMS__MULTI-CORE_SYSTEM__AND_________SYSTEMS_WITH_HYPER-THREADING_"></span>**Does QPC reliably work on multi-processor systems, multi-core system, and systems with hyper-threading?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-209">Sì</span><span class="sxs-lookup"><span data-stu-id="f28c1-209">Yes</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-210"><span id="How_do_I_determine_and_validate_that_QPC_works_on_my_machine_"></span><span id="how_do_i_determine_and_validate_that_qpc_works_on_my_machine_"></span><span id="HOW_DO_I_DETERMINE_AND_VALIDATE_THAT_QPC_WORKS_ON_MY_MACHINE_"></span>**Ricerca per categorie determinare e verificare che QPC funzioni nel computer?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-210"><span id="How_do_I_determine_and_validate_that_QPC_works_on_my_machine_"></span><span id="how_do_i_determine_and_validate_that_qpc_works_on_my_machine_"></span><span id="HOW_DO_I_DETERMINE_AND_VALIDATE_THAT_QPC_WORKS_ON_MY_MACHINE_"></span>**How do I determine and validate that QPC works on my machine?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-211">Non è necessario eseguire tali controlli.</span><span class="sxs-lookup"><span data-stu-id="f28c1-211">You don't need to perform such checks.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-212"><span id="Which_processors_have_non-invariant_TSCs__How_can_I_check_if_my_system_has_a_________non-invariant_TSC_"></span><span id="which_processors_have_non-invariant_tscs__how_can_i_check_if_my_system_has_a_________non-invariant_tsc_"></span><span id="WHICH_PROCESSORS_HAVE_NON-INVARIANT_TSCS__HOW_CAN_I_CHECK_IF_MY_SYSTEM_HAS_A_________NON-INVARIANT_TSC_"></span>**Quali processori hanno TSCs non invarianti? Come è possibile verificare se il sistema dispone di un TSC non invariante?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-212"><span id="Which_processors_have_non-invariant_TSCs__How_can_I_check_if_my_system_has_a_________non-invariant_TSC_"></span><span id="which_processors_have_non-invariant_tscs__how_can_i_check_if_my_system_has_a_________non-invariant_tsc_"></span><span id="WHICH_PROCESSORS_HAVE_NON-INVARIANT_TSCS__HOW_CAN_I_CHECK_IF_MY_SYSTEM_HAS_A_________NON-INVARIANT_TSC_"></span>**Which processors have non-invariant TSCs? How can I check if my system has a non-invariant TSC?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-213">Non è necessario eseguire questa verifica.</span><span class="sxs-lookup"><span data-stu-id="f28c1-213">You don't need to perform this check yourself.</span></span> <span data-ttu-id="f28c1-214">I sistemi operativi Windows eseguono diversi controlli nell'inizializzazione del sistema per determinare se il TSC è adatto come base per [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="f28c1-214">Windows operating systems perform several checks at system initialization to determine if the TSC is suitable as a basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="f28c1-215">Tuttavia, a scopo di riferimento, è possibile determinare se il processore ha un TSC invariante utilizzando uno dei seguenti:</span><span class="sxs-lookup"><span data-stu-id="f28c1-215">However, for reference purposes, you can determine whether your processor has an invariant TSC by using one of these:</span></span>

-   <span data-ttu-id="f28c1-216">utilità Coreinfo.exe da Windows Sysinternals</span><span class="sxs-lookup"><span data-stu-id="f28c1-216">the Coreinfo.exe utility from Windows Sysinternals</span></span>
-   <span data-ttu-id="f28c1-217">Verifica dei valori restituiti dall'istruzione CPUID relativa alle caratteristiche TSC</span><span class="sxs-lookup"><span data-stu-id="f28c1-217">checking the values returned by the CPUID instruction pertaining to the TSC characteristics</span></span>
-   <span data-ttu-id="f28c1-218">documentazione del produttore del processore</span><span class="sxs-lookup"><span data-stu-id="f28c1-218">the processor manufacturer’s documentation</span></span>

<span data-ttu-id="f28c1-219">Di seguito sono illustrate le informazioni relative a TSC-Invariant fornite dall'utilità Coreinfo.exe di Windows Sysinternals ([www.sysInternals.com](https://www.sysinternals.com)).</span><span class="sxs-lookup"><span data-stu-id="f28c1-219">The following shows the TSC-INVARIANT info that is provided by the Windows Sysinternals Coreinfo.exe utility ([www.sysinternals.com](https://www.sysinternals.com)).</span></span> <span data-ttu-id="f28c1-220">Un asterisco indica "true".</span><span class="sxs-lookup"><span data-stu-id="f28c1-220">An asterisk means "True".</span></span>

``` syntax
> Coreinfo.exe 

Coreinfo v3.2 - Dump information on system CPU and memory topology
Copyright (C) 2008-2012 Mark Russinovich
Sysinternals - www.sysinternals.com

 <unrelated text removed>

RDTSCP          * Supports RDTSCP instruction
TSC             * Supports RDTSC instruction
TSC-DEADLINE    - Local APIC supports one-shot deadline timer
TSC-INVARIANT   * TSC runs at constant rate
```

</dd> <dt>

<span data-ttu-id="f28c1-221"><span id="Does_QPC_work_reliably_on__hardware_platforms_"></span><span id="does_qpc_work_reliably_on__hardware_platforms_"></span><span id="DOES_QPC_WORK_RELIABLY_ON__HARDWARE_PLATFORMS_"></span>**QPC funziona in modo affidabile sulle piattaforme hardware del PC Windows RT?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-221"><span id="Does_QPC_work_reliably_on__hardware_platforms_"></span><span id="does_qpc_work_reliably_on__hardware_platforms_"></span><span id="DOES_QPC_WORK_RELIABLY_ON__HARDWARE_PLATFORMS_"></span>**Does QPC work reliably on Windows RT PC hardware platforms?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-222">Sì</span><span class="sxs-lookup"><span data-stu-id="f28c1-222">Yes</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-223"><span id="How_often_does_QPC_roll_over_"></span><span id="how_often_does_qpc_roll_over_"></span><span id="HOW_OFTEN_DOES_QPC_ROLL_OVER_"></span>**Con quale frequenza viene eseguito il rollover di QPC?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-223"><span id="How_often_does_QPC_roll_over_"></span><span id="how_often_does_qpc_roll_over_"></span><span id="HOW_OFTEN_DOES_QPC_ROLL_OVER_"></span>**How often does QPC roll over?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-224">Non meno di 100 anni dall'avvio del sistema più recente e potenzialmente più lungo a seconda del timer hardware sottostante utilizzato.</span><span class="sxs-lookup"><span data-stu-id="f28c1-224">Not less than 100 years from the most recent system boot, and potentially longer based on the underlying hardware timer used.</span></span> <span data-ttu-id="f28c1-225">Per la maggior parte delle applicazioni, il rollover non è un problema.</span><span class="sxs-lookup"><span data-stu-id="f28c1-225">For most applications, rollover isn't a concern.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-226"><span id="What_is_the_computational_cost_of_calling_QPC_"></span><span id="what_is_the_computational_cost_of_calling_qpc_"></span><span id="WHAT_IS_THE_COMPUTATIONAL_COST_OF_CALLING_QPC_"></span>**Qual è il costo computazionale della chiamata a QPC?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-226"><span id="What_is_the_computational_cost_of_calling_QPC_"></span><span id="what_is_the_computational_cost_of_calling_qpc_"></span><span id="WHAT_IS_THE_COMPUTATIONAL_COST_OF_CALLING_QPC_"></span>**What is the computational cost of calling QPC?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-227">Il costo di chiamata computazionale di [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) è determinato principalmente dalla piattaforma hardware sottostante.</span><span class="sxs-lookup"><span data-stu-id="f28c1-227">The computational calling cost of [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is determined primarily by the underlying hardware platform.</span></span> <span data-ttu-id="f28c1-228">Se il registro TSC viene usato come base per QPC, il costo di calcolo è determinato principalmente dal tempo impiegato dal processore per elaborare un'istruzione **RDTSC** .</span><span class="sxs-lookup"><span data-stu-id="f28c1-228">If the TSC register is used as the basis for QPC, the computational cost is determined primarily by how long the processor takes to process an **RDTSC** instruction.</span></span> <span data-ttu-id="f28c1-229">Questo intervallo di tempo va da 10 a 10 cicli CPU a centinaia di cicli di CPU a seconda del processore usato.</span><span class="sxs-lookup"><span data-stu-id="f28c1-229">This time ranges from 10s of CPU cycles to several hundred CPU cycles depending upon the processor used.</span></span> <span data-ttu-id="f28c1-230">Se non è possibile utilizzare il TSC, il sistema selezionerà un tempo hardware diverso.</span><span class="sxs-lookup"><span data-stu-id="f28c1-230">If the TSC can't be used, the system will select a different hardware time basis.</span></span> <span data-ttu-id="f28c1-231">Poiché queste basi temporali si trovano sulla scheda madre (ad esempio, sul Bridge PCI meridionale o PCH), il costo di calcolo per chiamata è superiore a quello del TSC e spesso è in prossimità di 0,8-1,0 microsecondi a seconda della velocità del processore e di altri fattori hardware.</span><span class="sxs-lookup"><span data-stu-id="f28c1-231">Because these time bases are located on the motherboard (for example, on the PCI South Bridge or PCH), the per-call computational cost is higher than the TSC, and is frequently in the vicinity of 0.8 - 1.0 microseconds depending on processor speed and other hardware factors.</span></span> <span data-ttu-id="f28c1-232">Questo costo è dominato dal tempo necessario per accedere al dispositivo hardware sulla scheda madre.</span><span class="sxs-lookup"><span data-stu-id="f28c1-232">This cost is dominated by the time required to access the hardware device on the motherboard.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-233"><span id="Does_QPC_require_a_kernel_transition__system_call__"></span><span id="does_qpc_require_a_kernel_transition__system_call__"></span><span id="DOES_QPC_REQUIRE_A_KERNEL_TRANSITION__SYSTEM_CALL__"></span>**QPC richiede una transizione del kernel (chiamata di sistema)?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-233"><span id="Does_QPC_require_a_kernel_transition__system_call__"></span><span id="does_qpc_require_a_kernel_transition__system_call__"></span><span id="DOES_QPC_REQUIRE_A_KERNEL_TRANSITION__SYSTEM_CALL__"></span>**Does QPC require a kernel transition (system call)?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-234">Non è necessaria una transizione del kernel se il sistema è in grado di usare il registro TSC come base per [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="f28c1-234">A kernel transition is not required if the system can use the TSC register as the basis for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="f28c1-235">Se il sistema deve usare una base temporale diversa, ad esempio il timer HPET o PM, è necessaria una chiamata di sistema.</span><span class="sxs-lookup"><span data-stu-id="f28c1-235">If the system must use a different time base, such as the HPET or PM timer, a system call is required.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-236"><span id="Is_the_performance_counter_monotonic__non-decreasing__"></span><span id="is_the_performance_counter_monotonic__non-decreasing__"></span><span id="IS_THE_PERFORMANCE_COUNTER_MONOTONIC__NON-DECREASING__"></span>**Il contatore delle prestazioni è monotonico (non decrescente)?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-236"><span id="Is_the_performance_counter_monotonic__non-decreasing__"></span><span id="is_the_performance_counter_monotonic__non-decreasing__"></span><span id="IS_THE_PERFORMANCE_COUNTER_MONOTONIC__NON-DECREASING__"></span>**Is the performance counter monotonic (non-decreasing)?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-237">Sì</span><span class="sxs-lookup"><span data-stu-id="f28c1-237">Yes</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-238"><span id="Can_the_performance_counter_be_used_to_order_events_in_time_"></span><span id="can_the_performance_counter_be_used_to_order_events_in_time_"></span><span id="CAN_THE_PERFORMANCE_COUNTER_BE_USED_TO_ORDER_EVENTS_IN_TIME_"></span>**Il contatore delle prestazioni può essere utilizzato per ordinare gli eventi in tempo?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-238"><span id="Can_the_performance_counter_be_used_to_order_events_in_time_"></span><span id="can_the_performance_counter_be_used_to_order_events_in_time_"></span><span id="CAN_THE_PERFORMANCE_COUNTER_BE_USED_TO_ORDER_EVENTS_IN_TIME_"></span>**Can the performance counter be used to order events in time?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-239">Sì.</span><span class="sxs-lookup"><span data-stu-id="f28c1-239">Yes.</span></span> <span data-ttu-id="f28c1-240">Tuttavia, quando si confrontano i risultati dei contatori delle prestazioni acquisiti da thread diversi, i valori che differiscono per ± 1 segno di selezione hanno un ordinamento ambiguo come se avessero un timestamp identico.</span><span class="sxs-lookup"><span data-stu-id="f28c1-240">However, when comparing performance counter results that are acquired from different threads, values that differ by ± 1 tick have an ambiguous ordering as if they had an identical time stamp.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-241"><span id="How_accurate_is_the_performance_counter_"></span><span id="how_accurate_is_the_performance_counter_"></span><span id="HOW_ACCURATE_IS_THE_PERFORMANCE_COUNTER_"></span>**Quanto è preciso il contatore delle prestazioni?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-241"><span id="How_accurate_is_the_performance_counter_"></span><span id="how_accurate_is_the_performance_counter_"></span><span id="HOW_ACCURATE_IS_THE_PERFORMANCE_COUNTER_"></span>**How accurate is the performance counter?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-242">La risposta dipende da diversi fattori.</span><span class="sxs-lookup"><span data-stu-id="f28c1-242">The answer depends on a variety of factors.</span></span> <span data-ttu-id="f28c1-243">Per altre informazioni, vedere [caratteristiche del clock hardware di basso livello](#low-level-hardware-clock-characteristics).</span><span class="sxs-lookup"><span data-stu-id="f28c1-243">For more info, see [Low-level hardware clock characteristics](#low-level-hardware-clock-characteristics).</span></span>

</dd> </dl>

## <a name="faq-about-programming-with-qpc-and-tsc"></a><span data-ttu-id="f28c1-244">Domande frequenti sulla programmazione con QPC e TSC</span><span class="sxs-lookup"><span data-stu-id="f28c1-244">FAQ about programming with QPC and TSC</span></span>

<span data-ttu-id="f28c1-245">Di seguito sono riportate le risposte alle domande frequenti sulla programmazione con [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) e tscs.</span><span class="sxs-lookup"><span data-stu-id="f28c1-245">Here are answers to frequently-asked questions about programming with [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) and TSCs.</span></span>

<dl> <dt>

<span data-ttu-id="f28c1-246"><span id="I_need_to_convert_the_QPC_output_to_milliseconds._How_can_I_avoid_loss_of_________precision_with_converting_to_double_or_float_"></span><span id="i_need_to_convert_the_qpc_output_to_milliseconds._how_can_i_avoid_loss_of_________precision_with_converting_to_double_or_float_"></span><span id="I_NEED_TO_CONVERT_THE_QPC_OUTPUT_TO_MILLISECONDS._HOW_CAN_I_AVOID_LOSS_OF_________PRECISION_WITH_CONVERTING_TO_DOUBLE_OR_FLOAT_"></span>**È necessario convertire l'output QPC in millisecondi. Come è possibile evitare la perdita di precisione con la conversione a Double o float?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-246"><span id="I_need_to_convert_the_QPC_output_to_milliseconds._How_can_I_avoid_loss_of_________precision_with_converting_to_double_or_float_"></span><span id="i_need_to_convert_the_qpc_output_to_milliseconds._how_can_i_avoid_loss_of_________precision_with_converting_to_double_or_float_"></span><span id="I_NEED_TO_CONVERT_THE_QPC_OUTPUT_TO_MILLISECONDS._HOW_CAN_I_AVOID_LOSS_OF_________PRECISION_WITH_CONVERTING_TO_DOUBLE_OR_FLOAT_"></span>**I need to convert the QPC output to milliseconds. How can I avoid loss of precision with converting to double or float?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-247">Esistono diversi aspetti da tenere presenti quando si eseguono calcoli su contatori di prestazioni Integer:</span><span class="sxs-lookup"><span data-stu-id="f28c1-247">There are several things to keep in mind when performing calculations on integer performance counters:</span></span>

-   <span data-ttu-id="f28c1-248">La divisione di interi perderà il resto.</span><span class="sxs-lookup"><span data-stu-id="f28c1-248">Integer division will lose the remainder.</span></span> <span data-ttu-id="f28c1-249">In alcuni casi può causare la perdita di precisione.</span><span class="sxs-lookup"><span data-stu-id="f28c1-249">This can cause loss of precision in some cases.</span></span>
-   <span data-ttu-id="f28c1-250">La conversione tra interi a 64 bit e virgola mobile (Double) può causare la perdita di precisione perché il mantissa a virgola mobile non può rappresentare tutti i valori integrali possibili.</span><span class="sxs-lookup"><span data-stu-id="f28c1-250">Conversion between 64 bit integers and floating point (double) can cause loss of precision because the floating point mantissa can't represent all possible integral values.</span></span>
-   <span data-ttu-id="f28c1-251">La moltiplicazione degli Integer a 64 bit può causare un overflow di Integer.</span><span class="sxs-lookup"><span data-stu-id="f28c1-251">Multiplication of 64 bit integers can result in integer overflow.</span></span>

<span data-ttu-id="f28c1-252">Come principio generale, ritardare questi calcoli e conversioni il più a lungo possibile per evitare la composizione degli errori introdotti.</span><span class="sxs-lookup"><span data-stu-id="f28c1-252">As a general principle, delay these computations and conversions as long as possible to avoid compounding the errors introduced.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-253"><span id="How_can_I_convert_QPC_to_100_nanosecond_ticks_so_I_can_add_it_to_a_________FILETIME_"></span><span id="how_can_i_convert_qpc_to_100_nanosecond_ticks_so_i_can_add_it_to_a_________filetime_"></span><span id="HOW_CAN_I_CONVERT_QPC_TO_100_NANOSECOND_TICKS_SO_I_CAN_ADD_IT_TO_A_________FILETIME_"></span>**Come è possibile convertire QPC in cicli di 100 nanosecondi in modo che sia possibile aggiungerli a un FILETIME?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-253"><span id="How_can_I_convert_QPC_to_100_nanosecond_ticks_so_I_can_add_it_to_a_________FILETIME_"></span><span id="how_can_i_convert_qpc_to_100_nanosecond_ticks_so_i_can_add_it_to_a_________filetime_"></span><span id="HOW_CAN_I_CONVERT_QPC_TO_100_NANOSECOND_TICKS_SO_I_CAN_ADD_IT_TO_A_________FILETIME_"></span>**How can I convert QPC to 100 nanosecond ticks so I can add it to a FILETIME?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-254">Un'ora di file è un valore a 64 bit che rappresenta il numero di intervalli di 100-nanosecondi trascorsi da 12:00 A.M.</span><span class="sxs-lookup"><span data-stu-id="f28c1-254">A file time is a 64-bit value that represents the number of 100-nanosecond intervals that have elapsed since 12:00 A.M.</span></span> <span data-ttu-id="f28c1-255">1 gennaio 1601 Coordinated Universal Time (UTC).</span><span class="sxs-lookup"><span data-stu-id="f28c1-255">January 1, 1601 Coordinated Universal Time (UTC).</span></span> <span data-ttu-id="f28c1-256">Gli orari dei file vengono usati dalle chiamate API Win32 che restituiscono l'ora del giorno, ad esempio [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) e [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span><span class="sxs-lookup"><span data-stu-id="f28c1-256">File times are used by Win32 API calls that return time-of-day, such as [**GetSystemTimeAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimeasfiletime) and [**GetSystemTimePreciseAsFileTime**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsystemtimepreciseasfiletime).</span></span> <span data-ttu-id="f28c1-257">Al contrario, [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) restituisce i valori che rappresentano il tempo in unità di 1/(la frequenza del contatore delle prestazioni ottenuto da [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency)).</span><span class="sxs-lookup"><span data-stu-id="f28c1-257">By contrast, [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) returns values that represent time in units of 1/(the frequency of the performance counter obtained from [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency)).</span></span> <span data-ttu-id="f28c1-258">Per la conversione tra i due è necessario calcolare il rapporto tra l'intervallo di **QPC** e gli intervalli di 100 nanosecondi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-258">Conversion between the two requires calculating the ratio of the **QPC** interval and 100-nanoseconds intervals.</span></span> <span data-ttu-id="f28c1-259">Prestare attenzione per evitare di perdere la precisione perché i valori possono essere di dimensioni ridotte (0,0000001/0,000000340).</span><span class="sxs-lookup"><span data-stu-id="f28c1-259">Be careful to avoid losing precision because the values might be small (0.0000001 / 0.000000340).</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-260"><span id="Why_is_the_time_stamp_that_is_returned_from_QPC_a_signed_integer_"></span><span id="why_is_the_time_stamp_that_is_returned_from_qpc_a_signed_integer_"></span><span id="WHY_IS_THE_TIME_STAMP_THAT_IS_RETURNED_FROM_QPC_A_SIGNED_INTEGER_"></span>**Perché il timestamp restituito da QPC è un intero con segno?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-260"><span id="Why_is_the_time_stamp_that_is_returned_from_QPC_a_signed_integer_"></span><span id="why_is_the_time_stamp_that_is_returned_from_qpc_a_signed_integer_"></span><span id="WHY_IS_THE_TIME_STAMP_THAT_IS_RETURNED_FROM_QPC_A_SIGNED_INTEGER_"></span>**Why is the time stamp that is returned from QPC a signed integer?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-261">I calcoli che coinvolgono [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) timestamp possono comportare la sottrazione.</span><span class="sxs-lookup"><span data-stu-id="f28c1-261">Calculations that involve [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) time stamps might involve subtraction.</span></span> <span data-ttu-id="f28c1-262">Utilizzando un valore con segno, è possibile gestire calcoli che potrebbero produrre valori negativi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-262">By using a signed value, you can handle calculations that might yield negative values.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-263"><span id="How_can_I_obtain_high_resolution_time_stamps_from_managed_code_"></span><span id="how_can_i_obtain_high_resolution_time_stamps_from_managed_code_"></span><span id="HOW_CAN_I_OBTAIN_HIGH_RESOLUTION_TIME_STAMPS_FROM_MANAGED_CODE_"></span>**Come è possibile ottenere indicatori temporali ad alta risoluzione dal codice gestito?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-263"><span id="How_can_I_obtain_high_resolution_time_stamps_from_managed_code_"></span><span id="how_can_i_obtain_high_resolution_time_stamps_from_managed_code_"></span><span id="HOW_CAN_I_OBTAIN_HIGH_RESOLUTION_TIME_STAMPS_FROM_MANAGED_CODE_"></span>**How can I obtain high resolution time stamps from managed code?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-264">Chiamare il metodo [**Stopwatch. GetTimestamp**](/previous-versions/windows/) dalla classe [**System. Diagnostics. Stopwatch**](/previous-versions/windows/) .</span><span class="sxs-lookup"><span data-stu-id="f28c1-264">Call the [**Stopwatch.GetTimeStamp**](/previous-versions/windows/) method from the [**System.Diagnostics.Stopwatch**](/previous-versions/windows/) class.</span></span> <span data-ttu-id="f28c1-265">Per un esempio su come usare **Stopwatch. GetTimestamp**, vedere [acquisizione di timestamp ad alta risoluzione dal codice gestito](#acquiring-high-resolution-time-stamps-from-managed-code).</span><span class="sxs-lookup"><span data-stu-id="f28c1-265">For an example about how to use **Stopwatch.GetTimeStamp**, see [Acquiring high resolution time stamps from managed code](#acquiring-high-resolution-time-stamps-from-managed-code).</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-266"><span id="Under_what_circumstances_does_QueryPerformanceFrequency_return_FALSE__or_________QueryPerformanceCounter_return_zero_"></span><span id="under_what_circumstances_does_queryperformancefrequency_return_false__or_________queryperformancecounter_return_zero_"></span><span id="UNDER_WHAT_CIRCUMSTANCES_DOES_QUERYPERFORMANCEFREQUENCY_RETURN_FALSE__OR_________QUERYPERFORMANCECOUNTER_RETURN_ZERO_"></span>**In quali circostanze QueryPerformanceFrequency restituisce FALSE oppure QueryPerformanceCounter restituisce zero?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-266"><span id="Under_what_circumstances_does_QueryPerformanceFrequency_return_FALSE__or_________QueryPerformanceCounter_return_zero_"></span><span id="under_what_circumstances_does_queryperformancefrequency_return_false__or_________queryperformancecounter_return_zero_"></span><span id="UNDER_WHAT_CIRCUMSTANCES_DOES_QUERYPERFORMANCEFREQUENCY_RETURN_FALSE__OR_________QUERYPERFORMANCECOUNTER_RETURN_ZERO_"></span>**Under what circumstances does QueryPerformanceFrequency return FALSE, or QueryPerformanceCounter return zero?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-267">Questa operazione non si verifica in alcun sistema che esegue Windows XP o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="f28c1-267">This won't occur on any system that runs Windows XP or later.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-268"><span id="Do_I_need_to_set_the_thread_affinity_to_a_single_core_to_use_QPC_"></span><span id="do_i_need_to_set_the_thread_affinity_to_a_single_core_to_use_qpc_"></span><span id="DO_I_NEED_TO_SET_THE_THREAD_AFFINITY_TO_A_SINGLE_CORE_TO_USE_QPC_"></span>**È necessario impostare l'affinità di thread su un singolo core per usare QPC?**</span><span class="sxs-lookup"><span data-stu-id="f28c1-268"><span id="Do_I_need_to_set_the_thread_affinity_to_a_single_core_to_use_QPC_"></span><span id="do_i_need_to_set_the_thread_affinity_to_a_single_core_to_use_qpc_"></span><span id="DO_I_NEED_TO_SET_THE_THREAD_AFFINITY_TO_A_SINGLE_CORE_TO_USE_QPC_"></span>**Do I need to set the thread affinity to a single core to use QPC?**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-269">No.</span><span class="sxs-lookup"><span data-stu-id="f28c1-269">No.</span></span> <span data-ttu-id="f28c1-270">Per altre informazioni, vedere [linee guida per l'acquisizione dei timestamp](#guidance-for-acquiring-time-stamps).</span><span class="sxs-lookup"><span data-stu-id="f28c1-270">For more info, see [Guidance for acquiring time stamps](#guidance-for-acquiring-time-stamps).</span></span> <span data-ttu-id="f28c1-271">Questo scenario non è necessario né auspicabile.</span><span class="sxs-lookup"><span data-stu-id="f28c1-271">This scenario is neither necessary nor desirable.</span></span> <span data-ttu-id="f28c1-272">L'esecuzione di questo scenario può influire negativamente sulle prestazioni dell'applicazione limitando l'elaborazione a un core o creando un collo di bottiglia in un singolo core se più thread impostano la loro affinità allo stesso nucleo quando chiamano [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="f28c1-272">Performing this scenario might adversely affect your application's performance by restricting processing to one core or by creating a bottleneck on a single core if multiple threads set their affinity to the same core when calling [**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span>

</dd> </dl>

## <a name="low-level-hardware-clock-characteristics"></a><span data-ttu-id="f28c1-273">Caratteristiche del clock hardware di basso livello</span><span class="sxs-lookup"><span data-stu-id="f28c1-273">Low-level hardware clock characteristics</span></span>

<span data-ttu-id="f28c1-274">In queste sezioni vengono illustrate le caratteristiche del clock hardware di basso livello.</span><span class="sxs-lookup"><span data-stu-id="f28c1-274">These sections show low-level hardware clock characteristics.</span></span>

### <a name="absolute-clocks-and-difference-clocks"></a><span data-ttu-id="f28c1-275">Orologi assoluti e orologi di differenza</span><span class="sxs-lookup"><span data-stu-id="f28c1-275">Absolute Clocks and Difference Clocks</span></span>

<span data-ttu-id="f28c1-276">Gli orologi assoluti forniscono letture accurate per l'ora del giorno.</span><span class="sxs-lookup"><span data-stu-id="f28c1-276">Absolute clocks provide accurate time-of-day readings.</span></span> <span data-ttu-id="f28c1-277">Si basano in genere sull'ora UTC (Coordinated Universal Time) e, di conseguenza, la loro accuratezza dipende in parte dal modo in cui vengono sincronizzate con un riferimento all'ora esterna.</span><span class="sxs-lookup"><span data-stu-id="f28c1-277">They are typically based on Coordinated Universal Time (UTC) and consequently their accuracy depends in part on how well they are synchronized to an external time reference.</span></span> <span data-ttu-id="f28c1-278">Gli orologi di differenza misurano gli intervalli di tempo e non sono in genere basati su un periodo di tempo esterno.</span><span class="sxs-lookup"><span data-stu-id="f28c1-278">Difference clocks measure time intervals and aren't typically based on an external time epoch.</span></span> <span data-ttu-id="f28c1-279">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) è un clock di differenza e non viene sincronizzato con un periodo di tempo o un riferimento esterno.</span><span class="sxs-lookup"><span data-stu-id="f28c1-279">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is a difference clock and isn't synchronized to an external time epoch or reference.</span></span> <span data-ttu-id="f28c1-280">Quando si usa **QPC** per le misurazioni di intervallo di tempo, in genere si ottiene una maggiore precisione di quanto si otterrebbe usando i timestamp derivati da un clock assoluto.</span><span class="sxs-lookup"><span data-stu-id="f28c1-280">When you use **QPC** for time-interval measurements, you typically get better accuracy than you would get by using time stamps that are derived from an absolute clock.</span></span> <span data-ttu-id="f28c1-281">Questo è dovuto al fatto che il processo di sincronizzazione dell'ora di un clock assoluto può introdurre turni di fase e frequenza che aumentano l'incertezza delle misurazioni a breve termine di intervallo di tempo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-281">This is because the process of synchronizing the time of an absolute clock can introduce phase and frequency shifts that increase the uncertainty of short term time-interval measurements.</span></span>

### <a name="resolution-precision-accuracy-and-stability"></a><span data-ttu-id="f28c1-282">Risoluzione, precisione, accuratezza e stabilità</span><span class="sxs-lookup"><span data-stu-id="f28c1-282">Resolution, Precision, Accuracy, and Stability</span></span>

<span data-ttu-id="f28c1-283">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) usa un contatore hardware come base.</span><span class="sxs-lookup"><span data-stu-id="f28c1-283">[**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) uses a hardware counter as its basis.</span></span> <span data-ttu-id="f28c1-284">I timer hardware sono costituiti da tre parti: un generatore di cicli, un contatore che conta i cicli e un mezzo per recuperare il valore del contatore.</span><span class="sxs-lookup"><span data-stu-id="f28c1-284">Hardware timers consist of three parts: a tick generator, a counter that counts the ticks, and a means of retrieving the counter value.</span></span> <span data-ttu-id="f28c1-285">Le caratteristiche di questi tre componenti determinano la risoluzione, la precisione, l'accuratezza e la stabilità dei **QPC**.</span><span class="sxs-lookup"><span data-stu-id="f28c1-285">The characteristics of these three components determine the resolution, precision, accuracy, and stability of **QPC**.</span></span>

<span data-ttu-id="f28c1-286">Se un generatore di hardware fornisce i cicli a una velocità costante, è possibile misurare gli intervalli di tempo semplicemente contando questi cicli.</span><span class="sxs-lookup"><span data-stu-id="f28c1-286">If a hardware generator provides ticks at a constant rate, time intervals can be measured by simply counting these ticks.</span></span> <span data-ttu-id="f28c1-287">La frequenza con cui vengono generati i cicli è detta frequenza e espressa in Hertz (Hz).</span><span class="sxs-lookup"><span data-stu-id="f28c1-287">The rate at which the ticks are generated is called the frequency and expressed in Hertz (Hz).</span></span> <span data-ttu-id="f28c1-288">Il reciproco della frequenza è denominato intervallo del periodo o del segno ed è espresso in un'unità di tempo del sistema internazionale (SI) appropriata (ad esempio, secondo, millisecondo, microsecondo o nanosecondo).</span><span class="sxs-lookup"><span data-stu-id="f28c1-288">The reciprocal of the frequency is called the period or tick interval and is expressed in an appropriate International System of Units (SI) time unit (for example, second, millisecond, microsecond, or nanosecond).</span></span>

![intervallo di tempo](images/tick-interval.png)

<span data-ttu-id="f28c1-290">La risoluzione del timer è uguale al punto.</span><span class="sxs-lookup"><span data-stu-id="f28c1-290">The resolution of the timer is equal to the period.</span></span> <span data-ttu-id="f28c1-291">La risoluzione determina la possibilità di distinguere tra due timestamp e inserisce un limite inferiore per gli intervalli di tempo più piccoli che possono essere misurati.</span><span class="sxs-lookup"><span data-stu-id="f28c1-291">Resolution determines the ability to distinguish between any two time stamps and places a lower bound on the smallest time intervals that can be measured.</span></span> <span data-ttu-id="f28c1-292">Questa operazione viene a volte definita risoluzione del ciclo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-292">This is sometimes called the tick resolution.</span></span>

<span data-ttu-id="f28c1-293">La misurazione digitale del tempo introduce un'incertezza delle misurazioni di ± 1 segno di avanzamento perché il contatore digitale avanza in passaggi discreti, mentre il tempo continua a avanzare.</span><span class="sxs-lookup"><span data-stu-id="f28c1-293">Digital measurement of time introduces a measurements uncertainty of ± 1 tick because the digital counter advances in discrete steps, while time is continuously advancing.</span></span> <span data-ttu-id="f28c1-294">Questa incertezza è detta errore di quantizzazione.</span><span class="sxs-lookup"><span data-stu-id="f28c1-294">This uncertainty is called a quantization error.</span></span> <span data-ttu-id="f28c1-295">Per le misurazioni tipiche dell'intervallo di tempo, questo effetto può spesso essere ignorato perché l'errore di quantizzazione è molto più piccolo dell'intervallo di tempo misurato.</span><span class="sxs-lookup"><span data-stu-id="f28c1-295">For typical time-interval measurements, this effect can often be ignored because the quantizing error is much smaller than the time interval being measured.</span></span>

![misurazione del tempo digitale](images/digital-time-measure.png)

<span data-ttu-id="f28c1-297">Tuttavia, se il periodo misurato è ridotto e si avvicina alla risoluzione del timer, sarà necessario prendere in considerazione questo errore di quantizzazione.</span><span class="sxs-lookup"><span data-stu-id="f28c1-297">However, if the period being measured is small and approaches the resolution of the timer, you will need to consider this quantizing error.</span></span> <span data-ttu-id="f28c1-298">La dimensione dell'errore introdotta è quella di un periodo di clock.</span><span class="sxs-lookup"><span data-stu-id="f28c1-298">The size of the error introduced is that of one clock period.</span></span>

<span data-ttu-id="f28c1-299">I due diagrammi seguenti illustrano l'effetto dell'incertezza di ± 1 segno di incertezza usando un timer con una risoluzione di 1 unità di tempo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-299">The following two diagrams illustrate the impact of the ± 1 tick uncertainty by using a timer with a resolution of 1 time unit.</span></span>

![incertezze del segno di incertezza](images/tick-uncertainty.png)

<span data-ttu-id="f28c1-301">[**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) restituisce la frequenza di [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)e il periodo e la risoluzione sono uguali al reciproco di questo valore.</span><span class="sxs-lookup"><span data-stu-id="f28c1-301">[**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) returns the frequency of [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter), and the period and resolution are equal to the reciprocal of this value.</span></span> <span data-ttu-id="f28c1-302">La frequenza del contatore delle prestazioni restituita da **QueryPerformanceFrequency** viene determinata durante l'inizializzazione del sistema e non cambia mentre il sistema è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="f28c1-302">The performance counter frequency that **QueryPerformanceFrequency** returns is determined during system initialization and doesn't change while the system is running.</span></span>

> [!Note]  
> <span data-ttu-id="f28c1-303">Potrebbero esistere casi in cui [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) non restituisce la frequenza effettiva del generatore di cicli hardware.</span><span class="sxs-lookup"><span data-stu-id="f28c1-303">Cases might exist where [**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) doesn't return the actual frequency of the hardware tick generator.</span></span> <span data-ttu-id="f28c1-304">In molti casi, ad esempio, **QueryPerformanceFrequency** restituisce la frequenza TSC divisa per 1024; in Hyper-V, la frequenza del contatore delle prestazioni è sempre 10 MHz quando la macchina virtuale guest viene eseguita con un [hypervisor](https://msdn.microsoft.com/library/Ff542584(v=VS.85).aspx) che implementa l' [interfaccia hypervisor versione 1,0](https://msdn.microsoft.com/library/Ff541458(v=VS.85).aspx).</span><span class="sxs-lookup"><span data-stu-id="f28c1-304">For example, in many cases, **QueryPerformanceFrequency** returns the TSC frequency divided by 1024; and on Hyper-V, the performance counter frequency is always 10 MHz when the guest virtual machine runs under a [hypervisor](https://msdn.microsoft.com/library/Ff542584(v=VS.85).aspx) that implements the [hypervisor version 1.0 interface](https://msdn.microsoft.com/library/Ff541458(v=VS.85).aspx).</span></span> <span data-ttu-id="f28c1-305">Di conseguenza, non presupporre che **QueryPerformanceFrequency** restituirà la frequenza TSC precisa.</span><span class="sxs-lookup"><span data-stu-id="f28c1-305">As a result, don't assume that **QueryPerformanceFrequency** will return the precise TSC frequency.</span></span>

 

<span data-ttu-id="f28c1-306">[**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) legge il contatore delle prestazioni e restituisce il numero totale di cicli verificatisi dopo l'avvio del sistema operativo Windows, inclusa la data e l'ora in cui il computer si trova in uno stato di sospensione, ad esempio standby, ibernazione o standby connesso.</span><span class="sxs-lookup"><span data-stu-id="f28c1-306">[**QueryPerformanceCounter**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) reads the performance counter and returns the total number of ticks that have occurred since the Windows operating system was started, including the time when the machine was in a sleep state such as standby, hibernate, or connected standby.</span></span>

<span data-ttu-id="f28c1-307">In questi esempi viene illustrato come calcolare l'intervallo e la risoluzione del segno di cadenza e come convertire il conteggio dei cicli in un valore di ora.</span><span class="sxs-lookup"><span data-stu-id="f28c1-307">These examples show how to calculate the tick interval and resolution and how to convert the tick count into a time value.</span></span>

<dl> <dt>

<span data-ttu-id="f28c1-308"><span id="Example_1"></span><span id="example_1"></span><span id="EXAMPLE_1"></span>**Esempio 1**</span><span class="sxs-lookup"><span data-stu-id="f28c1-308"><span id="Example_1"></span><span id="example_1"></span><span id="EXAMPLE_1"></span>**Example 1**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-309">[**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) restituisce il valore 3.125.000 in un computer specifico.</span><span class="sxs-lookup"><span data-stu-id="f28c1-309">[**QueryPerformanceFrequency**](/windows/win32/api/profileapi/nf-profileapi-queryperformancefrequency) returns the value 3,125,000 on a particular machine.</span></span> <span data-ttu-id="f28c1-310">Qual è l'intervallo di cicli e la risoluzione delle misurazioni [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) nel computer?</span><span class="sxs-lookup"><span data-stu-id="f28c1-310">What is the tick interval and resolution of [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) measurements on this machine?</span></span> <span data-ttu-id="f28c1-311">L'intervallo di cicli, o punto, è il reciproco di 3.125.000, ovvero 0,000000320 (320 nanosecondi).</span><span class="sxs-lookup"><span data-stu-id="f28c1-311">The tick interval, or period, is the reciprocal of 3,125,000, which is 0.000000320 (320 nanoseconds).</span></span> <span data-ttu-id="f28c1-312">Ogni segno di selezione rappresenta pertanto il superamento di 320 nanosecondi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-312">Therefore, each tick represents the passing of 320 nanoseconds.</span></span> <span data-ttu-id="f28c1-313">Non è possibile misurare intervalli di tempo inferiori a 320 nanosecondi in questo computer.</span><span class="sxs-lookup"><span data-stu-id="f28c1-313">Time intervals smaller than 320 nanoseconds can't be measured on this machine.</span></span>

<span data-ttu-id="f28c1-314">Intervallo di cicli = 1/(frequenza delle prestazioni)</span><span class="sxs-lookup"><span data-stu-id="f28c1-314">Tick Interval = 1/(Performance Frequency)</span></span>

<span data-ttu-id="f28c1-315">Intervallo di cicli = 1/3125000 = 320 NS</span><span class="sxs-lookup"><span data-stu-id="f28c1-315">Tick Interval = 1/3,125,000 = 320 ns</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-316"><span id="Example_2"></span><span id="example_2"></span><span id="EXAMPLE_2"></span>**Esempio 2**</span><span class="sxs-lookup"><span data-stu-id="f28c1-316"><span id="Example_2"></span><span id="example_2"></span><span id="EXAMPLE_2"></span>**Example 2**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-317">Nello stesso computer dell'esempio precedente, la differenza tra i valori restituiti da due chiamate successive a [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) è 5.</span><span class="sxs-lookup"><span data-stu-id="f28c1-317">On the same machine as the preceding example, the difference of the values returned from two successive calls to [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) is 5.</span></span> <span data-ttu-id="f28c1-318">Quanto tempo è trascorso tra le due chiamate?</span><span class="sxs-lookup"><span data-stu-id="f28c1-318">How much time has elapsed between the two calls?</span></span> <span data-ttu-id="f28c1-319">5 cicli moltiplicati per 320 nanosecondi generano 1,6 microsecondi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-319">5 ticks multiplied by 320 nanoseconds yields 1.6 microseconds.</span></span>

<span data-ttu-id="f28c1-320">ElapsedTime = intervallo di \* cicli</span><span class="sxs-lookup"><span data-stu-id="f28c1-320">ElapsedTime = Ticks \* Tick Interval</span></span>

<span data-ttu-id="f28c1-321">ElapsedTime = 5 \* 320 NS = 1,6 μs</span><span class="sxs-lookup"><span data-stu-id="f28c1-321">ElapsedTime = 5 \* 320 ns = 1.6 μs</span></span>

</dd> </dl>

<span data-ttu-id="f28c1-322">È necessario tempo per accedere (leggere) al contatore dei segni di indicizzazione dal software e questo tempo di accesso può ridurre la precisione della misurazione del tempo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-322">It takes time to access (read) the tick counter from software, and this access time can reduce the precision of the of the time measurement.</span></span> <span data-ttu-id="f28c1-323">Questo è dovuto al fatto che il tempo minimo di intervallo, ovvero l'intervallo di tempo più piccolo che è possibile misurare, è maggiore della risoluzione e del tempo di accesso.</span><span class="sxs-lookup"><span data-stu-id="f28c1-323">This is because the minimum interval time (the smallest time interval that can be measured) is the larger of the resolution and the access time.</span></span>

<span data-ttu-id="f28c1-324">Precisione = \[ risoluzione massima, AccessTime\]</span><span class="sxs-lookup"><span data-stu-id="f28c1-324">Precision = MAX \[ Resolution, AccessTime\]</span></span>

<span data-ttu-id="f28c1-325">Si consideri, ad esempio, un ipotetico timer hardware con una risoluzione di 100 nanosecondi e un tempo di accesso di 800 nanosecondi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-325">For example, consider a hypothetical hardware timer with a 100 nanosecond resolution and an 800 nanosecond access time.</span></span> <span data-ttu-id="f28c1-326">Questo potrebbe essere il caso in cui il timer della piattaforma è stato usato al posto del registro TSC come base di [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span><span class="sxs-lookup"><span data-stu-id="f28c1-326">This might be the case if the platform timer were used instead of the TSC register as the basis of [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter).</span></span> <span data-ttu-id="f28c1-327">Quindi, la precisione sarà di 800 nanosecondi non 100 nanosecondi, come illustrato in questo calcolo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-327">Thus, the precision would be 800 nanoseconds not 100 nanoseconds as shown in this calculation.</span></span>

<span data-ttu-id="f28c1-328">Precisione = MAX \[ 800 ns, 100 NS \] = 800 ns</span><span class="sxs-lookup"><span data-stu-id="f28c1-328">Precision = MAX \[800 ns,100 ns\] = 800 ns</span></span>

<span data-ttu-id="f28c1-329">Queste due figure rappresentano questo effetto.</span><span class="sxs-lookup"><span data-stu-id="f28c1-329">These two figures depict this effect.</span></span>

![QPC tempo di accesso](images/qpc-access-time.png)

<span data-ttu-id="f28c1-331">Se il tempo di accesso è maggiore della risoluzione, non provare a migliorare la precisione indovinando.</span><span class="sxs-lookup"><span data-stu-id="f28c1-331">If the access time is greater than the resolution, don't try to improve the precision by guessing.</span></span> <span data-ttu-id="f28c1-332">In altre parole, è un errore supporre che il timestamp venga assunto con precisione al centro o all'inizio o alla fine della chiamata.</span><span class="sxs-lookup"><span data-stu-id="f28c1-332">In other words, it's an error to assume that the time stamp is taken precisely in the middle, or at the beginning or the end of the call.</span></span>

<span data-ttu-id="f28c1-333">Al contrario, si consideri l'esempio seguente in cui il tempo di accesso di [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) è solo 20 nanosecondi e la risoluzione dell'orologio hardware è di 100 nanosecondi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-333">By contrast, consider the following example in which the [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) access time is only 20 nanoseconds and the hardware clock resolution is 100 nanoseconds.</span></span> <span data-ttu-id="f28c1-334">Questo potrebbe essere il caso in cui il registro TSC è stato usato come base per **QPC**.</span><span class="sxs-lookup"><span data-stu-id="f28c1-334">This might be the case if the TSC register was used as the basis for **QPC**.</span></span> <span data-ttu-id="f28c1-335">Qui la precisione è limitata dalla risoluzione dell'orologio.</span><span class="sxs-lookup"><span data-stu-id="f28c1-335">Here the precision is limited by the clock resolution.</span></span>

![precisione QPC](images/qpc-precision.png)

<span data-ttu-id="f28c1-337">In pratica, è possibile trovare origini temporali per le quali il tempo necessario per la lettura del contatore è maggiore o minore della risoluzione.</span><span class="sxs-lookup"><span data-stu-id="f28c1-337">In practice, you can find time sources for which the time required to read the counter is larger or smaller than the resolution.</span></span> <span data-ttu-id="f28c1-338">In entrambi i casi, la precisione sarà il più grande dei due.</span><span class="sxs-lookup"><span data-stu-id="f28c1-338">In either case, the precision will be the larger of the two.</span></span>

<span data-ttu-id="f28c1-339">Questa tabella fornisce informazioni sulla risoluzione approssimativa, il tempo di accesso e la precisione di diversi orologi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-339">This table provides info on the approximate resolution, access time, and precision of a variety of clocks.</span></span> <span data-ttu-id="f28c1-340">Si noti che alcuni valori variano a seconda della velocità del processore, delle piattaforme hardware e dei processori.</span><span class="sxs-lookup"><span data-stu-id="f28c1-340">Note that some of the values will vary with different processors, hardware platforms, and processor speeds.</span></span>



| <span data-ttu-id="f28c1-341">Origine Clock</span><span class="sxs-lookup"><span data-stu-id="f28c1-341">Clock Source</span></span>                                                      | <span data-ttu-id="f28c1-342">Frequenza di clock nominale</span><span class="sxs-lookup"><span data-stu-id="f28c1-342">Nominal Clock Frequency</span></span> | <span data-ttu-id="f28c1-343">Risoluzione del clock</span><span class="sxs-lookup"><span data-stu-id="f28c1-343">Clock Resolution</span></span>    | <span data-ttu-id="f28c1-344">Tempo di accesso (tipico)</span><span class="sxs-lookup"><span data-stu-id="f28c1-344">Access Time (Typical)</span></span> | <span data-ttu-id="f28c1-345">Precision</span><span class="sxs-lookup"><span data-stu-id="f28c1-345">Precision</span></span>       |
|-------------------------------------------------------------------|-------------------------|---------------------|-----------------------|-----------------|
| <span data-ttu-id="f28c1-346">RTC DEL PC</span><span class="sxs-lookup"><span data-stu-id="f28c1-346">PC RTC</span></span>                                                            | <span data-ttu-id="f28c1-347">64 Hz</span><span class="sxs-lookup"><span data-stu-id="f28c1-347">64 Hz</span></span>                   | <span data-ttu-id="f28c1-348">15,625 millisecondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-348">15.625 milliseconds</span></span> | <span data-ttu-id="f28c1-349">N/D</span><span class="sxs-lookup"><span data-stu-id="f28c1-349">N/A</span></span>                   | <span data-ttu-id="f28c1-350">N/D</span><span class="sxs-lookup"><span data-stu-id="f28c1-350">N/A</span></span>             |
| <span data-ttu-id="f28c1-351">Contatore delle prestazioni delle query con TSC con clock del processore a 3 GHz</span><span class="sxs-lookup"><span data-stu-id="f28c1-351">Query performance counter using TSC with a 3 GHz processor clock</span></span>  | <span data-ttu-id="f28c1-352">3 MHz</span><span class="sxs-lookup"><span data-stu-id="f28c1-352">3 MHz</span></span>                   | <span data-ttu-id="f28c1-353">333 nanosecondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-353">333 nanoseconds</span></span>     | <span data-ttu-id="f28c1-354">30 nanosecondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-354">30 nanoseconds</span></span>        | <span data-ttu-id="f28c1-355">333 nanosecondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-355">333 nanoseconds</span></span> |
| <span data-ttu-id="f28c1-356">**RDTSC** le istruzioni del computer in un sistema con una durata del ciclo di 3 GHz</span><span class="sxs-lookup"><span data-stu-id="f28c1-356">**RDTSC** machine instruction on a system with a 3 GHz cycle time</span></span> | <span data-ttu-id="f28c1-357">3 GHz</span><span class="sxs-lookup"><span data-stu-id="f28c1-357">3 GHz</span></span>                   | <span data-ttu-id="f28c1-358">333 picosecondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-358">333 picoseconds</span></span>     | <span data-ttu-id="f28c1-359">30 nanosecondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-359">30 nanoseconds</span></span>        | <span data-ttu-id="f28c1-360">30 nanosecondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-360">30 nanoseconds</span></span>  |



 

<span data-ttu-id="f28c1-361">Poiché [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) utilizza un contatore hardware, quando si conoscono alcune caratteristiche di base dei contatori hardware, è possibile ottenere informazioni sulle funzionalità e le limitazioni di **QPC**.</span><span class="sxs-lookup"><span data-stu-id="f28c1-361">Because [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) uses a hardware counter, when you understand some basic characteristics of hardware counters, you gain understanding about the capabilities and limitations of **QPC**.</span></span>

<span data-ttu-id="f28c1-362">Il generatore di cicli hardware più comunemente usato è un oscillatore di cristallo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-362">The most commonly used hardware tick generator is a crystal oscillator.</span></span> <span data-ttu-id="f28c1-363">Il cristallo è una piccola parte di quarzo o altro materiale ceramico che presenta le caratteristiche piezoelettrici che forniscono un riferimento di frequenza economico con una stabilità e un'accuratezza ottimali.</span><span class="sxs-lookup"><span data-stu-id="f28c1-363">The crystal is a small piece of quartz or other ceramic material that exhibits piezoelectric characteristics that provide an inexpensive frequency reference with excellent stability and accuracy.</span></span> <span data-ttu-id="f28c1-364">Questa frequenza viene utilizzata per generare i tick conteggiati dal clock.</span><span class="sxs-lookup"><span data-stu-id="f28c1-364">This frequency is used to generate the ticks counted by the clock.</span></span>

<span data-ttu-id="f28c1-365">L'accuratezza di un timer si riferisce al grado di conformità a un valore true o standard.</span><span class="sxs-lookup"><span data-stu-id="f28c1-365">The accuracy of a timer refers to the degree of conformity to a true or standard value.</span></span> <span data-ttu-id="f28c1-366">Questo dipende principalmente dalla capacità di Crystal Oscillator di fornire segni di scanditura alla frequenza specificata.</span><span class="sxs-lookup"><span data-stu-id="f28c1-366">This depends primarily on the crystal oscillator’s ability to provide ticks at the specified frequency.</span></span> <span data-ttu-id="f28c1-367">Se la frequenza delle oscillazioni è troppo elevata, il clock verrà eseguito in modo rapido e gli intervalli misurati verranno visualizzati più a lungo di quanto siano effettivamente. Se la frequenza è troppo bassa, il clock verrà eseguito lentamente e gli intervalli misurati verranno visualizzati più a breve di quanto siano effettivamente.</span><span class="sxs-lookup"><span data-stu-id="f28c1-367">If the frequency of oscillation is too high, the clock will 'run fast', and measured intervals will appear longer than they really are; and if the frequency is too low, the clock will 'run slow', and measured intervals will appear shorter than they really are.</span></span>

<span data-ttu-id="f28c1-368">Per le misure tipiche di intervallo di tempo per la durata breve (ad esempio, misure del tempo di risposta, misure di latenza di rete e così via), l'accuratezza dell'oscillatore hardware è in genere sufficiente.</span><span class="sxs-lookup"><span data-stu-id="f28c1-368">For typical time-interval measurements for short duration (for example, response time measurements, network latency measurements, and so on), the accuracy of the hardware oscillator is usually sufficient.</span></span> <span data-ttu-id="f28c1-369">Per alcune misure, tuttavia, l'accuratezza della frequenza Oscillator diventa importante, in particolare per intervalli di tempo lunghi o quando si desidera confrontare le misurazioni eseguite su computer diversi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-369">However, for some measurements the oscillator frequency accuracy becomes important, particularly for long time intervals or when you want to compare measurements taken on different machines.</span></span> <span data-ttu-id="f28c1-370">Nella parte restante di questa sezione vengono esaminati gli effetti dell'accuratezza dell'oscillatore.</span><span class="sxs-lookup"><span data-stu-id="f28c1-370">The remainder of this section explores the effects of the oscillator accuracy.</span></span>

<span data-ttu-id="f28c1-371">La frequenza delle oscillazioni dei cristalli viene impostata durante il processo di produzione e viene specificata dal produttore in termini di una frequenza specificata più o meno una tolleranza di produzione espressa in ' parti per milione ' (ppm), denominata offset frequenza massima.</span><span class="sxs-lookup"><span data-stu-id="f28c1-371">The crystals' frequency of oscillation is set during the manufacturing process and is specified by the manufacturer in terms of a specified frequency plus or minus a manufacturing tolerance expressed in 'parts per million' (ppm), called the maximum frequency offset.</span></span> <span data-ttu-id="f28c1-372">Un cristallo con una frequenza specificata di 1 milione Hz e un offset di frequenza massima pari a ± 10 ppm è entro i limiti della specifica se la frequenza effettiva è compresa tra 999.990 Hz e 1.000.010 Hz.</span><span class="sxs-lookup"><span data-stu-id="f28c1-372">A crystal with a specified frequency of 1,000,000 Hz and a maximum frequency offset of ± 10 ppm would be within specification limits if its actual frequency were between 999,990 Hz and 1,000,010 Hz.</span></span>

<span data-ttu-id="f28c1-373">Sostituendo le parti di frase per milione con microsecondi al secondo, è possibile applicare questo errore di offset della frequenza alle misure di intervallo di tempo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-373">By substituting the phrase parts per million with microseconds per second, we can apply this frequency offset error to time-interval measurements.</span></span> <span data-ttu-id="f28c1-374">Un oscillatore con un offset di + 10 ppm avrà un errore di 10 microsecondi al secondo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-374">An oscillator with a + 10 ppm offset would have an error of 10 microseconds per second.</span></span> <span data-ttu-id="f28c1-375">Di conseguenza, quando si misura un intervallo di 1 secondo, l'esecuzione viene eseguita velocemente e viene misurato un intervallo di 1 secondo come 0,999990 secondi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-375">Accordingly, when measuring a 1 second interval, it would run fast and measure a 1 second interval as 0.999990 seconds.</span></span>

<span data-ttu-id="f28c1-376">Un riferimento utile è che un errore di frequenza di 100 ppm causa un errore di 8,64 secondi dopo 24 ore.</span><span class="sxs-lookup"><span data-stu-id="f28c1-376">A convenient reference is that a frequency error of 100 ppm causes an error of 8.64 seconds after 24 hours.</span></span> <span data-ttu-id="f28c1-377">Questa tabella presenta l'incertezza di misurazione a causa dell'errore accumulato per intervalli di tempo più lunghi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-377">This table presents the measurement uncertainty due to the accumulated error for longer time intervals.</span></span>



| <span data-ttu-id="f28c1-378">Durata intervallo di tempo</span><span class="sxs-lookup"><span data-stu-id="f28c1-378">Time interval duration</span></span> | <span data-ttu-id="f28c1-379">Incertezza di misurazione dovuta a un errore accumulato con tolleranza di frequenza di +/-10 PPM</span><span class="sxs-lookup"><span data-stu-id="f28c1-379">Measurement uncertainty due to accumulated error with +/- 10 PPM frequency tolerance</span></span> |
|------------------------|--------------------------------------------------------------------------------------|
| <span data-ttu-id="f28c1-380">1 microsecondo</span><span class="sxs-lookup"><span data-stu-id="f28c1-380">1 microsecond</span></span>          | <span data-ttu-id="f28c1-381">± 10 picosecondi (10-12)</span><span class="sxs-lookup"><span data-stu-id="f28c1-381">± 10 picoseconds (10-12)</span></span>                                                             |
| <span data-ttu-id="f28c1-382">1 millisecondo</span><span class="sxs-lookup"><span data-stu-id="f28c1-382">1 millisecond</span></span>          | <span data-ttu-id="f28c1-383">± 10 nanosecondi (10-9)</span><span class="sxs-lookup"><span data-stu-id="f28c1-383">± 10 nanoseconds (10-9)</span></span>                                                              |
| <span data-ttu-id="f28c1-384">1 secondo</span><span class="sxs-lookup"><span data-stu-id="f28c1-384">1 second</span></span>               | <span data-ttu-id="f28c1-385">± 10 microsecondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-385">± 10 microseconds</span></span>                                                                    |
| <span data-ttu-id="f28c1-386">1 ora</span><span class="sxs-lookup"><span data-stu-id="f28c1-386">1 hour</span></span>                 | <span data-ttu-id="f28c1-387">microsecondi da ± 60</span><span class="sxs-lookup"><span data-stu-id="f28c1-387">± 60 microseconds</span></span>                                                                    |
| <span data-ttu-id="f28c1-388">1 giorno</span><span class="sxs-lookup"><span data-stu-id="f28c1-388">1 day</span></span>                  | <span data-ttu-id="f28c1-389">± 0,86 secondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-389">± 0.86 seconds</span></span>                                                                       |
| <span data-ttu-id="f28c1-390">1 settimana</span><span class="sxs-lookup"><span data-stu-id="f28c1-390">1 week</span></span>                 | <span data-ttu-id="f28c1-391">± 6,08 secondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-391">± 6.08 seconds</span></span>                                                                       |



 

<span data-ttu-id="f28c1-392">La tabella precedente mostra che per intervalli di tempo ridotti è spesso possibile ignorare l'errore di offset della frequenza.</span><span class="sxs-lookup"><span data-stu-id="f28c1-392">The preceding table shows that for small time intervals the frequency offset error can often be ignored.</span></span> <span data-ttu-id="f28c1-393">Tuttavia, per intervalli di tempo prolungati, anche un offset di frequenza ridotto può comportare un'incertezza sostanziale della misura.</span><span class="sxs-lookup"><span data-stu-id="f28c1-393">However for long time intervals, even a small frequency offset can result in a substantial measurement uncertainty.</span></span>

<span data-ttu-id="f28c1-394">Gli oscillatori cristallini usati in Personal computer e server vengono in genere prodotti con una tolleranza di frequenza di ± 30 a 50 parti per milione e raramente i cristalli possono essere spenti fino a 500 ppm.</span><span class="sxs-lookup"><span data-stu-id="f28c1-394">Crystal oscillators that are used in personal computers and servers are typically manufactured with a frequency tolerance of ± 30 to 50 parts per million, and rarely, crystals can be off by as much as 500 ppm.</span></span> <span data-ttu-id="f28c1-395">Sebbene i cristalli con una maggiore tolleranza di offset di frequenza siano disponibili, sono più costosi e pertanto non vengono usati nella maggior parte dei computer.</span><span class="sxs-lookup"><span data-stu-id="f28c1-395">Although crystals with much tighter frequency offset tolerances are available, they are more expensive and thus are not used in most computers.</span></span>

<span data-ttu-id="f28c1-396">Per ridurre gli effetti negativi di questo errore di offset della frequenza, le versioni recenti di Windows, in particolare Windows 8, usano più timer hardware per rilevare l'offset della frequenza e compensarlo nella misura massima possibile.</span><span class="sxs-lookup"><span data-stu-id="f28c1-396">To reduce the adverse effects of this frequency offset error, recent versions of Windows, particularly Windows 8, use multiple hardware timers to detect the frequency offset and compensate for it to the extent possible.</span></span> <span data-ttu-id="f28c1-397">Questo processo di calibrazione viene eseguito all'avvio di Windows.</span><span class="sxs-lookup"><span data-stu-id="f28c1-397">This calibration process is performed when Windows is started.</span></span>

<span data-ttu-id="f28c1-398">Come illustrato negli esempi seguenti, l'errore di offset della frequenza di un orologio hardware influisce sull'accuratezza ottenibile e la risoluzione dell'orologio può essere meno importante.</span><span class="sxs-lookup"><span data-stu-id="f28c1-398">As the following examples show, the frequency offset error of a hardware clock influences the achievable accuracy, and the resolution of the clock can be less important.</span></span>

![l'errore di offset della frequenza influenza la precisione ottenibile](images/freq-offset-error.png)

<dl> <dt>

<span data-ttu-id="f28c1-400"><span id="Example_1"></span><span id="example_1"></span><span id="EXAMPLE_1"></span>**Esempio 1**</span><span class="sxs-lookup"><span data-stu-id="f28c1-400"><span id="Example_1"></span><span id="example_1"></span><span id="EXAMPLE_1"></span>**Example 1**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-401">Si supponga di eseguire misure di intervallo di tempo usando un oscillatore di 1 MHz, che ha una risoluzione di 1 microsecondo e un errore di offset della frequenza massima pari a ± 50 ppm.</span><span class="sxs-lookup"><span data-stu-id="f28c1-401">Suppose you perform time-interval measurements by using a 1 MHz oscillator, which has a resolution of 1 microsecond, and a maximum frequency offset error of ±50 ppm.</span></span> <span data-ttu-id="f28c1-402">A questo punto, supponiamo che l'offset sia esattamente + 50 ppm.</span><span class="sxs-lookup"><span data-stu-id="f28c1-402">Now, let us suppose the offset is exactly +50 ppm.</span></span> <span data-ttu-id="f28c1-403">Ciò significa che la frequenza effettiva sarebbe 1.000.050 Hz.</span><span class="sxs-lookup"><span data-stu-id="f28c1-403">This means that the actual frequency would be 1,000,050 Hz.</span></span> <span data-ttu-id="f28c1-404">Se è stato misurato un intervallo di tempo di 24 ore, la misura sarà di 4,3 secondi troppo breve (23:59:55.700000 misurato rispetto a 24:00:00.000000 effettivo).</span><span class="sxs-lookup"><span data-stu-id="f28c1-404">If we measured a time interval of 24 hours, our measurement would be 4.3 seconds too short (23:59:55.700000 measured versus 24:00:00.000000 actual).</span></span>

<span data-ttu-id="f28c1-405">Secondi in un giorno = 86400</span><span class="sxs-lookup"><span data-stu-id="f28c1-405">Seconds in a day = 86400</span></span>

<span data-ttu-id="f28c1-406">Errore di offset frequenza = 50 ppm = 0,00005</span><span class="sxs-lookup"><span data-stu-id="f28c1-406">Frequency offset error = 50 ppm = 0.00005</span></span>

<span data-ttu-id="f28c1-407">86.400 secondi \* 0,00005 = 4,3 secondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-407">86,400 seconds \* 0.00005 = 4.3 seconds</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-408"><span id="Example_2"></span><span id="example_2"></span><span id="EXAMPLE_2"></span>**Esempio 2**</span><span class="sxs-lookup"><span data-stu-id="f28c1-408"><span id="Example_2"></span><span id="example_2"></span><span id="EXAMPLE_2"></span>**Example 2**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-409">Si supponga che il clock TSC del processore sia controllato da un oscillatore di cristallo e che abbia una frequenza di 3 GHz specificata.</span><span class="sxs-lookup"><span data-stu-id="f28c1-409">Suppose the processor TSC clock is controlled by a crystal oscillator and has specified frequency of 3 GHz.</span></span> <span data-ttu-id="f28c1-410">Ciò significa che la risoluzione sarà 1/3000000000 o circa 333 picosecondi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-410">This means that the resolution would be 1/3,000,000,000 or about 333 picoseconds.</span></span> <span data-ttu-id="f28c1-411">Si supponga che il cristallo usato per controllare il clock del processore abbia una tolleranza di frequenza pari a ± 50 ppm ed è effettivamente + 50 ppm.</span><span class="sxs-lookup"><span data-stu-id="f28c1-411">Assume the crystal used to control the processor clock has a frequency tolerance of ±50 ppm and is actually +50 ppm.</span></span> <span data-ttu-id="f28c1-412">Nonostante la risoluzione impressionante, una misurazione del periodo di tempo di 24 ore sarà ancora di 4,3 secondi troppo breve.</span><span class="sxs-lookup"><span data-stu-id="f28c1-412">In spite of the impressive resolution, a time-interval measurement of 24 hours will still be 4.3 seconds too short.</span></span> <span data-ttu-id="f28c1-413">(23:59:55.7000000000 misurato rispetto a 24:00:00.0000000000 effettivo).</span><span class="sxs-lookup"><span data-stu-id="f28c1-413">(23:59:55.7000000000 measured versus 24:00:00.0000000000 actual).</span></span>

<span data-ttu-id="f28c1-414">Secondi in un giorno = 86400</span><span class="sxs-lookup"><span data-stu-id="f28c1-414">Seconds in a day = 86400</span></span>

<span data-ttu-id="f28c1-415">Errore di offset frequenza = 50 ppm = 0,00005</span><span class="sxs-lookup"><span data-stu-id="f28c1-415">Frequency offset error = 50 ppm = 0.00005</span></span>

<span data-ttu-id="f28c1-416">86.400 secondi \* 0,00005 = 4,3 secondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-416">86,400 seconds \* 0.00005 = 4.3 seconds</span></span>

<span data-ttu-id="f28c1-417">Questo mostra che un orologio TSC a risoluzione elevata non fornisce necessariamente misurazioni più accurate rispetto a un clock di risoluzione inferiore.</span><span class="sxs-lookup"><span data-stu-id="f28c1-417">This shows that a high resolution TSC clock doesn't necessarily provide more accurate measurements than a lower resolution clock.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-418"><span id="Example_3"></span><span id="example_3"></span><span id="EXAMPLE_3"></span>**Esempio 3**</span><span class="sxs-lookup"><span data-stu-id="f28c1-418"><span id="Example_3"></span><span id="example_3"></span><span id="EXAMPLE_3"></span>**Example 3**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-419">Prendere in considerazione l'utilizzo di due computer diversi per misurare lo stesso intervallo di tempo di 24 ore.</span><span class="sxs-lookup"><span data-stu-id="f28c1-419">Consider using two different computers to measure the same 24 hour time interval.</span></span> <span data-ttu-id="f28c1-420">Entrambi i computer hanno un oscillatore con un offset di frequenza massima pari a ± 50 ppm.</span><span class="sxs-lookup"><span data-stu-id="f28c1-420">Both computers have an oscillator with a maximum frequency offset of ± 50 ppm.</span></span> <span data-ttu-id="f28c1-421">Quanto è possibile che la misurazione dello stesso intervallo di tempo in questi due sistemi sia diversa?</span><span class="sxs-lookup"><span data-stu-id="f28c1-421">How far apart can the measurement of the same time interval on these two systems be?</span></span> <span data-ttu-id="f28c1-422">Come negli esempi precedenti, ± 50 ppm restituisce un errore massimo di ± 4,3 secondi dopo 24 ore.</span><span class="sxs-lookup"><span data-stu-id="f28c1-422">As in the previous examples, ± 50 ppm yields a maximum error of ± 4.3 seconds after 24 hours.</span></span> <span data-ttu-id="f28c1-423">Se un sistema esegue rapidamente 4,3 secondi e l'altro è lento di 4,3 secondi, l'errore massimo dopo 24 ore potrebbe essere 8,6 secondi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-423">If one system runs 4.3 seconds fast, and the other 4.3 seconds slow, the maximum error after 24 hours could be 8.6 seconds.</span></span>

<span data-ttu-id="f28c1-424">Secondi in un giorno = 86400</span><span class="sxs-lookup"><span data-stu-id="f28c1-424">Seconds in a day = 86400</span></span>

<span data-ttu-id="f28c1-425">Errore di offset frequenza = ± 50 ppm = ± 0,00005</span><span class="sxs-lookup"><span data-stu-id="f28c1-425">Frequency offset error = ±50 ppm = ±0.00005</span></span>

<span data-ttu-id="f28c1-426">± (86.400 secondi \* 0,00005) = ± 4,3 secondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-426">±(86,400 seconds \* 0.00005) = ±4.3 seconds</span></span>

<span data-ttu-id="f28c1-427">Offset massimo tra i due sistemi = 8,6 secondi</span><span class="sxs-lookup"><span data-stu-id="f28c1-427">Maximum offset between the two systems = 8.6 seconds</span></span>

<span data-ttu-id="f28c1-428">In breve, l'errore di offset della frequenza diventa sempre più importante quando si misurano intervalli di tempo lunghi e quando si confrontano le misurazioni tra sistemi diversi.</span><span class="sxs-lookup"><span data-stu-id="f28c1-428">In summary, the frequency offset error becomes increasingly important when measuring long time intervals and when comparing measurements between different systems.</span></span>

<span data-ttu-id="f28c1-429">La stabilità di un timer indica se la frequenza del segno di variazione viene modificata nel tempo, ad esempio in seguito a variazioni di temperatura.</span><span class="sxs-lookup"><span data-stu-id="f28c1-429">The stability of a timer describes whether the tick frequency changes over time, for example as the result of temperatures changes.</span></span> <span data-ttu-id="f28c1-430">I cristalli di quarzo usati come generatori di cicli sui computer mostreranno piccole variazioni di frequenza come funzione di temperatura.</span><span class="sxs-lookup"><span data-stu-id="f28c1-430">Quartz crystals used as the tick generators on computers will exhibit small changes in frequency as a function of temperature.</span></span> <span data-ttu-id="f28c1-431">L'errore causato dalla deriva termica è in genere di piccole dimensioni rispetto all'errore di offset della frequenza per intervalli di temperature comuni.</span><span class="sxs-lookup"><span data-stu-id="f28c1-431">The error caused by thermal drift is typically small compared to the frequency offset error for common temperature ranges.</span></span> <span data-ttu-id="f28c1-432">Tuttavia, i progettisti di software per apparecchiature portatili o apparecchiature soggette a fluttuazioni di temperatura elevate potrebbero dover considerare questo effetto.</span><span class="sxs-lookup"><span data-stu-id="f28c1-432">However, designers of software for portable equipment or equipment subject to large temperature fluctuations might need to consider this effect.</span></span>

</dd> </dl>

## <a name="hardware-timer-info"></a><span data-ttu-id="f28c1-433">Informazioni sul timer hardware</span><span class="sxs-lookup"><span data-stu-id="f28c1-433">Hardware timer info</span></span>

<dl> <dt>

<span data-ttu-id="f28c1-434"><span id="TSC_Register"></span><span id="tsc_register"></span><span id="TSC_REGISTER"></span>**Registro TSC**</span><span class="sxs-lookup"><span data-stu-id="f28c1-434"><span id="TSC_Register"></span><span id="tsc_register"></span><span id="TSC_REGISTER"></span>**TSC Register**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-435">Alcuni processori Intel e AMD contengono un registro TSC che è un registro a 64 bit che aumenta a una frequenza elevata, in genere uguale al clock del processore.</span><span class="sxs-lookup"><span data-stu-id="f28c1-435">Some Intel and AMD processors contain a TSC register that is a 64-bit register that increases at a high rate, typically equal to the processor clock.</span></span> <span data-ttu-id="f28c1-436">Il valore di questo contatore può essere letto tramite le istruzioni del computer **RDTSC** o **rdtscp (** , fornendo tempi di accesso molto bassi e costi di calcolo nell'ordine di decine o centinaia di cicli del computer, a seconda del processore.</span><span class="sxs-lookup"><span data-stu-id="f28c1-436">The value of this counter can be read through the **RDTSC** or **RDTSCP** machine instructions, providing very low access time and computational cost in the order of tens or hundreds of machine cycles, depending upon the processor.</span></span>

<span data-ttu-id="f28c1-437">Sebbene il registro TSC sembri un meccanismo di timestamp ideale, di seguito sono riportati alcuni casi in cui non può funzionare in modo affidabile ai fini del cronometraggio:</span><span class="sxs-lookup"><span data-stu-id="f28c1-437">Although the TSC register seems like an ideal time stamp mechanism, here are circumstances in which it can't function reliably for timekeeping purposes:</span></span>

-   <span data-ttu-id="f28c1-438">Non tutti i processori hanno registri TSC, quindi l'uso del registro TSC nel software crea direttamente un problema di portabilità.</span><span class="sxs-lookup"><span data-stu-id="f28c1-438">Not all processors have TSC registers, so using the TSC register in software directly creates a portability problem.</span></span> <span data-ttu-id="f28c1-439">In questo caso, in Windows verrà selezionata un'origine dell'ora alternativa per [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) , che evita il problema di portabilità.</span><span class="sxs-lookup"><span data-stu-id="f28c1-439">(Windows will select an alternative time source for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter) in this case, which avoids the portability problem.)</span></span>
-   <span data-ttu-id="f28c1-440">Alcuni processori possono variare la frequenza dell'orologio TSC o arrestare l'avanzamento del registro TSC, rendendo il TSC non adatto ai fini della temporizzazione di questi processori.</span><span class="sxs-lookup"><span data-stu-id="f28c1-440">Some processors can vary the frequency of the TSC clock or stop the advancement of the TSC register, which makes the TSC unsuitable for timing purposes on these processors.</span></span> <span data-ttu-id="f28c1-441">Questi processori hanno un registro TSC non invariante.</span><span class="sxs-lookup"><span data-stu-id="f28c1-441">These processors are said to have non-invariant TSC registers.</span></span> <span data-ttu-id="f28c1-442">(Windows rileva automaticamente questo e selezionare un'origine ora alternativa per [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span><span class="sxs-lookup"><span data-stu-id="f28c1-442">(Windows will automatically detect this, and select an alternative time source for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span></span>
-   <span data-ttu-id="f28c1-443">Nei sistemi multiprocessore o multicore, alcuni processori e sistemi non sono in grado di sincronizzare gli orologi di ogni core con lo stesso valore.</span><span class="sxs-lookup"><span data-stu-id="f28c1-443">On multi-processor or multi-core systems, some processors and systems are unable to synchronize the clocks on each core to the same value.</span></span> <span data-ttu-id="f28c1-444">(Windows rileva automaticamente questo e selezionare un'origine ora alternativa per [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span><span class="sxs-lookup"><span data-stu-id="f28c1-444">(Windows will automatically detect this, and select an alternative time source for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span></span>
-   <span data-ttu-id="f28c1-445">In alcuni sistemi multiprocessori di grandi dimensioni, potrebbe non essere possibile sincronizzare gli orologi del processore con lo stesso valore anche se il processore ha un TSC invariante.</span><span class="sxs-lookup"><span data-stu-id="f28c1-445">On some large multi-processor systems, you might not be able to synchronize the processor clocks to the same value even if the processor has an invariant TSC.</span></span> <span data-ttu-id="f28c1-446">(Windows rileva automaticamente questo e selezionare un'origine ora alternativa per [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span><span class="sxs-lookup"><span data-stu-id="f28c1-446">(Windows will automatically detect this, and select an alternative time source for [**QPC**](/windows/win32/api/profileapi/nf-profileapi-queryperformancecounter)).</span></span>
-   <span data-ttu-id="f28c1-447">Alcuni processori eseguiranno istruzioni non ordinate.</span><span class="sxs-lookup"><span data-stu-id="f28c1-447">Some processors will execute instructions out of order.</span></span> <span data-ttu-id="f28c1-448">Questo può comportare un numero di cicli errato quando **RDTSC** viene usato per le sequenze di istruzioni temporali perché l'istruzione **RDTSC** potrebbe essere eseguita in un momento diverso rispetto a quanto specificato nel programma.</span><span class="sxs-lookup"><span data-stu-id="f28c1-448">This can result in incorrect cycle counts when **RDTSC** is used to time instruction sequences because the **RDTSC** instruction might be executed at a different time than specified in your program.</span></span> <span data-ttu-id="f28c1-449">L'istruzione **rdtscp (** è stata introdotta in alcuni processori in risposta a questo problema.</span><span class="sxs-lookup"><span data-stu-id="f28c1-449">The **RDTSCP** instruction has been introduced on some processors in response to this problem.</span></span>

<span data-ttu-id="f28c1-450">Analogamente ad altri timer, il TSC si basa su un oscillatore di cristallo la cui frequenza esatta non è nota in anticipo e che presenta un errore di offset della frequenza.</span><span class="sxs-lookup"><span data-stu-id="f28c1-450">Like other timers, the TSC is based on a crystal oscillator whose exact frequency is not known in advance and that has a frequency offset error.</span></span> <span data-ttu-id="f28c1-451">Quindi, prima di poterlo usare, è necessario che venga calibrato usando un altro riferimento temporizzato.</span><span class="sxs-lookup"><span data-stu-id="f28c1-451">Thus before it can be used, it must be calibrated using another timing reference.</span></span>

<span data-ttu-id="f28c1-452">Durante l'inizializzazione del sistema, Windows controlla se il TSC è adatto ai fini della temporizzazione ed esegue la taratura di frequenza e la sincronizzazione di base necessarie.</span><span class="sxs-lookup"><span data-stu-id="f28c1-452">During system initialization, Windows checks if the TSC is suitable for timing purposes and performs the necessary frequency calibration and core synchronization.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-453"><span id="PM_Clock"></span><span id="pm_clock"></span><span id="PM_CLOCK"></span>**Clock PM**</span><span class="sxs-lookup"><span data-stu-id="f28c1-453"><span id="PM_Clock"></span><span id="pm_clock"></span><span id="PM_CLOCK"></span>**PM Clock**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-454">Il timer ACPI, noto anche come clock PM, è stato aggiunto all'architettura di sistema per fornire indicatori di tempo affidabili indipendentemente dalla velocità dei processori.</span><span class="sxs-lookup"><span data-stu-id="f28c1-454">The ACPI timer, also known as the PM clock, was added to the system architecture to provide reliable time stamps independently of the processors speed.</span></span> <span data-ttu-id="f28c1-455">Poiché questo è l'obiettivo singolo di questo timer, fornisce un timestamp in un singolo ciclo di clock, ma non fornisce altre funzionalità.</span><span class="sxs-lookup"><span data-stu-id="f28c1-455">Because this was the single goal of this timer, it provides a time stamp in a single clock cycle, but it doesn't provide any other functionality.</span></span>

</dd> <dt>

<span data-ttu-id="f28c1-456"><span id="HPET_Timer"></span><span id="hpet_timer"></span><span id="HPET_TIMER"></span>**Timer HPET**</span><span class="sxs-lookup"><span data-stu-id="f28c1-456"><span id="HPET_Timer"></span><span id="hpet_timer"></span><span id="HPET_TIMER"></span>**HPET Timer**</span></span>
</dt> <dd>

<span data-ttu-id="f28c1-457">Il High Precision Event Timer (HPET) è stato sviluppato congiuntamente da Intel e Microsoft per soddisfare i requisiti di temporizzazione di applicazioni multimediali e di altre applicazioni sensibili al tempo.</span><span class="sxs-lookup"><span data-stu-id="f28c1-457">The High Precision Event Timer (HPET) was developed jointly by Intel and Microsoft to meet the timing requirements of multimedia and other time-sensitive applications.</span></span> <span data-ttu-id="f28c1-458">Il supporto di HPET è stato in Windows da Windows Vista e la certificazione del logo hardware di Windows 7 e Windows 8 richiede il supporto di HPET nella piattaforma hardware.</span><span class="sxs-lookup"><span data-stu-id="f28c1-458">HPET support has been in Windows since Windows Vista, and Windows 7 and Windows 8 Hardware Logo certification requires HPET support in the hardware platform.</span></span>

</dd> </dl>

 

 
