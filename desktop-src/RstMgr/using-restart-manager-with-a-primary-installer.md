---
title: Uso di gestione riavvio con un programma di installazione primario
description: Nella procedura seguente viene descritto come utilizzare Gestione riavvio per arrestare e riavviare le applicazioni e i servizi. Quando si usa Gestione riavvio con un unico programma di installazione, questo programma di installazione è anche il programma di installazione principale che controlla l'interfaccia utente.
ms.assetid: 8d2b4129-c595-4b11-9771-6dc953f4db40
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 38956ee8d04bc377809e93579080d9b767c3da3a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/16/2019
ms.locfileid: "103955296"
---
# <a name="using-restart-manager-with-a-primary-installer"></a><span data-ttu-id="9661b-104">Uso di gestione riavvio con un programma di installazione primario</span><span class="sxs-lookup"><span data-stu-id="9661b-104">Using Restart Manager with a Primary Installer</span></span>

<span data-ttu-id="9661b-105">Nella procedura seguente viene descritto come utilizzare Gestione riavvio per arrestare e riavviare le applicazioni e i servizi.</span><span class="sxs-lookup"><span data-stu-id="9661b-105">The following procedure describes how to use the Restart Manager to shutdown and restart applications and services.</span></span> <span data-ttu-id="9661b-106">Quando si usa Gestione riavvio con un unico programma di installazione, questo programma di installazione è anche il programma di installazione principale che controlla l'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="9661b-106">When using the Restart Manager with a single installer, this installer is also the primary installer that controls the user interface.</span></span>

<span data-ttu-id="9661b-107">**Per usare Gestione riavvio con un programma di installazione primario**</span><span class="sxs-lookup"><span data-stu-id="9661b-107">**To use the Restart Manager with a primary installer**</span></span>

1.  <span data-ttu-id="9661b-108">Il programma di installazione chiama la funzione [**RmStartSession**](/windows/desktop/api/RestartManager/nf-restartmanager-rmstartsession) per avviare la sessione di gestione riavvio e ottenere un handle di sessione e una chiave.</span><span class="sxs-lookup"><span data-stu-id="9661b-108">The installer calls the [**RmStartSession**](/windows/desktop/api/RestartManager/nf-restartmanager-rmstartsession) function to start the Restart Manager session and obtain a session handle and key.</span></span>
2.  <span data-ttu-id="9661b-109">Il programma di installazione chiama la funzione [**RmRegisterResources**](/windows/desktop/api/RestartManager/nf-restartmanager-rmregisterresources) per registrare le risorse.</span><span class="sxs-lookup"><span data-stu-id="9661b-109">The installer calls the [**RmRegisterResources**](/windows/desktop/api/RestartManager/nf-restartmanager-rmregisterresources) function to register resources.</span></span> <span data-ttu-id="9661b-110">Gestione riavvio può utilizzare solo le risorse registrate per determinare quali applicazioni e servizi devono essere arrestati e riavviati.</span><span class="sxs-lookup"><span data-stu-id="9661b-110">The Restart Manager can only use registered resources to determine which applications and services must be shut down and restarted.</span></span> <span data-ttu-id="9661b-111">Tutte le risorse che possono essere interessate dall'installazione devono essere registrate con la sessione.</span><span class="sxs-lookup"><span data-stu-id="9661b-111">All resources that can be affected by the installation should be registered with the session.</span></span> <span data-ttu-id="9661b-112">Le risorse possono essere identificate in base al nome file, al nome breve del servizio o a una struttura di [**\_ \_ processo univoca RM**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_unique_process) .</span><span class="sxs-lookup"><span data-stu-id="9661b-112">Resources can be identified by filename, service short name, or an [**RM\_UNIQUE\_PROCESS**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_unique_process) structure.</span></span>
3.  <span data-ttu-id="9661b-113">Il programma di installazione chiama la funzione [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) per ottenere una matrice di strutture di [**\_ \_ informazioni del processo RM**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_process_info) che elenca tutte le applicazioni e i servizi che devono essere arrestati e riavviati.</span><span class="sxs-lookup"><span data-stu-id="9661b-113">The installer calls the [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) function to obtain an array of [**RM\_PROCESS\_INFO**](/windows/desktop/api/RestartManager/ns-restartmanager-rm_process_info) structures that lists all applications and services that must be shut down and restarted.</span></span>

    <span data-ttu-id="9661b-114">Se il valore del parametro *lpdwRebootReason* restituito dalla funzione [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) è diverso da zero, gestione riavvio non è in grado di liberare una risorsa registrata dalla chiusura di un'applicazione o di un servizio.</span><span class="sxs-lookup"><span data-stu-id="9661b-114">If the value of the *lpdwRebootReason* parameter that is returned by the [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) function is nonzero, the Restart Manager is unable to free a registered resource by the shutdown of an application or service.</span></span> <span data-ttu-id="9661b-115">In questo caso, è necessario arrestare e riavviare il sistema per continuare l'installazione.</span><span class="sxs-lookup"><span data-stu-id="9661b-115">In this case, a system shutdown and restart is required to continue the installation.</span></span> <span data-ttu-id="9661b-116">Il programma di installazione deve richiedere all'utente un'azione, arrestare programmi o servizi oppure pianificare un arresto e un riavvio del sistema.</span><span class="sxs-lookup"><span data-stu-id="9661b-116">The installer should prompt the user for an action, stop programs or services, or schedule a system shutdown and restart.</span></span>

    <span data-ttu-id="9661b-117">Se il valore del parametro *lpdwRebootReason* restituito dalla funzione [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) è zero, il programma di installazione deve chiamare la funzione [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) .</span><span class="sxs-lookup"><span data-stu-id="9661b-117">If the value of the *lpdwRebootReason* parameter that is returned by the [**RmGetList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetlist) function is zero, the installer should call the [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) function.</span></span> <span data-ttu-id="9661b-118">Questa operazione arresta i servizi e le applicazioni che usano risorse registrate.</span><span class="sxs-lookup"><span data-stu-id="9661b-118">This shuts down the services and applications that are using registered resources.</span></span> <span data-ttu-id="9661b-119">Il programma di installazione deve quindi eseguire le modifiche di sistema necessarie per completare l'installazione.</span><span class="sxs-lookup"><span data-stu-id="9661b-119">The installer should then perform system modifications that are required to complete the installation.</span></span> <span data-ttu-id="9661b-120">Infine, il programma di installazione deve chiamare la funzione [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) in modo che la gestione riavvio possa riavviare le applicazioni arrestate e registrate per il riavvio.</span><span class="sxs-lookup"><span data-stu-id="9661b-120">Finally, the installer should call the [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) function so that the Restart Manager can restart the applications it has shut down and that have been registered for a restart.</span></span>

4.  <span data-ttu-id="9661b-121">Il programma di installazione può utilizzare la funzione [**RmAddFilter**](/windows/desktop/api/RestartManager/nf-restartmanager-rmaddfilter) per impedire che le applicazioni e i servizi specificati vengano arrestati o riavviati dalle operazioni di gestione riavvio.</span><span class="sxs-lookup"><span data-stu-id="9661b-121">The installer can use the [**RmAddFilter**](/windows/desktop/api/RestartManager/nf-restartmanager-rmaddfilter) function to prevent specified applications and services from being shutdown or restarted by Restart Manager operations.</span></span> <span data-ttu-id="9661b-122">La funzione [**RmGetFilterList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetfilterlist) restituisce un elenco di applicazioni e servizi da filtrare dall'arresto e dal riavvio.</span><span class="sxs-lookup"><span data-stu-id="9661b-122">The [**RmGetFilterList**](/windows/desktop/api/RestartManager/nf-restartmanager-rmgetfilterlist) function returns a list of the applications and services to be filtered from shutdown and restart.</span></span> <span data-ttu-id="9661b-123">La funzione [**RmRemoveFilter**](/windows/desktop/api/RestartManager/nf-restartmanager-rmremovefilter) rimuove un filtro.</span><span class="sxs-lookup"><span data-stu-id="9661b-123">The [**RmRemoveFilter**](/windows/desktop/api/RestartManager/nf-restartmanager-rmremovefilter) function removes a filter.</span></span>
5.  <span data-ttu-id="9661b-124">Il programma di installazione chiama la funzione [**RmEndSession**](/windows/desktop/api/RestartManager/nf-restartmanager-rmendsession) per chiudere la sessione di gestione riavvio.</span><span class="sxs-lookup"><span data-stu-id="9661b-124">The installer calls the [**RmEndSession**](/windows/desktop/api/RestartManager/nf-restartmanager-rmendsession) function to close the Restart Manager session.</span></span>

<span data-ttu-id="9661b-125">Per un frammento di codice di esempio che mostra l'avvio e l'uso di una sessione di gestione riavvio usando un programma di installazione primario e quindi aggiungendo un programma di installazione secondario alla sessione esistente, vedere [uso di gestione riavvio con un programma di installazione secondario](using-restart-manager-with-a-secondary-installer.md).</span><span class="sxs-lookup"><span data-stu-id="9661b-125">For an example code snippet that shows starting and using a Restart Manager session by using a primary installer and then joining a secondary installer to the existing session, see [Using Restart Manager with a Secondary Installer](using-restart-manager-with-a-secondary-installer.md).</span></span>

 

 




