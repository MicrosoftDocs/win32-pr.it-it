---
title: Linee guida per le applicazioni
description: Le applicazioni in esecuzione in Windows Vista e Windows Server 2008 devono rispettare queste linee guida per garantire che Gestione riavvio possa arrestare e riavviare le applicazioni, se necessario, per installare gli aggiornamenti.
ms.assetid: 97b1df63-65a9-47b4-891b-e4a754882b89
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3ebace21e09956c68d34c90775c5ea646a8b2dd0
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "103729626"
---
# <a name="guidelines-for-applications"></a><span data-ttu-id="e700b-103">Linee guida per le applicazioni</span><span class="sxs-lookup"><span data-stu-id="e700b-103">Guidelines for Applications</span></span>

<span data-ttu-id="e700b-104">Le applicazioni in esecuzione in Windows Vista e Windows Server 2008 devono rispettare queste linee guida per garantire che Gestione riavvio possa arrestare e riavviare le applicazioni, se necessario, per installare gli aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="e700b-104">Applications running on Windows Vista and Windows Server 2008 should adhere to these guidelines to ensure that the Restart Manager can shut down and restart applications if necessary to install updates.</span></span> <span data-ttu-id="e700b-105">I servizi possono usare le linee guida descritte in [linee guida per i servizi](guidelines-for-services.md).</span><span class="sxs-lookup"><span data-stu-id="e700b-105">Services can use the guidelines that are described in [Guidelines for Services](guidelines-for-services.md).</span></span>

-   <span data-ttu-id="e700b-106">Gestione riavvio esegue una query sulle applicazioni GUI per l'arresto inviando una notifica [**WM \_ QUERYENDSESSION**](/windows/desktop/Shutdown/wm-queryendsession) con il parametro *lParam* impostato su **ENDSESSION \_ CLOSEAPP** (0x1).</span><span class="sxs-lookup"><span data-stu-id="e700b-106">The Restart Manager queries GUI applications for shutdown by sending a [**WM\_QUERYENDSESSION**](/windows/desktop/Shutdown/wm-queryendsession) notification that has the *lParam* parameter set to **ENDSESSION\_CLOSEAPP** (0x1).</span></span> <span data-ttu-id="e700b-107">Le applicazioni non devono essere arrestate quando ricevono un messaggio **WM \_ QUERYENDSESSION** perché un'altra applicazione potrebbe non essere pronta per l'arresto.</span><span class="sxs-lookup"><span data-stu-id="e700b-107">Applications should not shut down when they receive a **WM\_QUERYENDSESSION** message because another application may not be ready to shut down.</span></span> <span data-ttu-id="e700b-108">Le applicazioni GUI devono ascoltare il messaggio **WM \_ QUERYENDSESSION** e restituire il valore **true** se l'applicazione è preparata per l'arresto e il riavvio.</span><span class="sxs-lookup"><span data-stu-id="e700b-108">GUI applications should listen for the **WM\_QUERYENDSESSION** message and return a value of **TRUE** if the application is prepared to shut down and restart.</span></span> <span data-ttu-id="e700b-109">Se nessuna applicazione restituisce un valore **false**, gestione riavvio Invia un messaggio [**WM \_ ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) con il parametro *lParam* impostato su **ENDSESSION \_ CLOSEAPP** (0x1) e il parametro *wParam* impostato su **true**.</span><span class="sxs-lookup"><span data-stu-id="e700b-109">If no application returns a value of **FALSE**, the Restart Manager sends a [**WM\_ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) message with the *lParam* parameter set to **ENDSESSION\_CLOSEAPP** (0x1) and the *wparam* parameter set to **TRUE**.</span></span> <span data-ttu-id="e700b-110">Le applicazioni devono essere arrestate solo quando ricevono il messaggio **WM \_ ENDSESSION** .</span><span class="sxs-lookup"><span data-stu-id="e700b-110">Applications should shut down only when they receive the **WM\_ENDSESSION** message.</span></span> <span data-ttu-id="e700b-111">Gestione riavvio invia anche un messaggio [**WM \_ Close**](../winmsg/wm-close.md) per le applicazioni GUI che non si arrestano alla ricezione di **WM \_ ENDSESSION**.</span><span class="sxs-lookup"><span data-stu-id="e700b-111">The Restart Manager also sends a [**WM\_CLOSE**](../winmsg/wm-close.md) message for GUI applications that do not shut down on receiving **WM\_ENDSESSION**.</span></span> <span data-ttu-id="e700b-112">Se un'applicazione GUI risponde a un messaggio **WM \_ QUERYENDSESSION** restituendo un valore **false**, l'arresto viene annullato.</span><span class="sxs-lookup"><span data-stu-id="e700b-112">If any GUI application responds to a **WM\_QUERYENDSESSION** message by returning a value of **FALSE**, the shutdown is canceled.</span></span> <span data-ttu-id="e700b-113">Tuttavia, se l'arresto è forzato, l'applicazione viene terminata indipendentemente.</span><span class="sxs-lookup"><span data-stu-id="e700b-113">However, if the shutdown is forced, the application is terminated regardless.</span></span>
-   <span data-ttu-id="e700b-114">Quando un'applicazione GUI riceve un messaggio [**WM \_ ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) , l'applicazione deve prepararsi a arrestarsi entro il periodo di timeout specificato.</span><span class="sxs-lookup"><span data-stu-id="e700b-114">When a GUI application receives a [**WM\_ENDSESSION**](/windows/desktop/Shutdown/wm-endsession) message, the application should prepare itself to shut down within the specified timeout period.</span></span> <span data-ttu-id="e700b-115">Come minimo, le applicazioni devono essere preparate salvando tutti i dati utente e le informazioni sullo stato necessarie dopo un riavvio.</span><span class="sxs-lookup"><span data-stu-id="e700b-115">At a minimum, applications should prepare by saving any user data and state information that is needed after a restart.</span></span> <span data-ttu-id="e700b-116">È consigliabile che le applicazioni Salvino periodicamente i dati e lo stato dell'utente.</span><span class="sxs-lookup"><span data-stu-id="e700b-116">It is recommended that applications periodically save the user data and state.</span></span>
-   <span data-ttu-id="e700b-117">Gestione riavvio invia una notifica **di \_ \_ evento CTRL C** alle applicazioni console che devono essere arrestate e riavviate.</span><span class="sxs-lookup"><span data-stu-id="e700b-117">The Restart Manager sends a **CTRL\_C\_EVENT** notification to console applications that must be shut down and restarted.</span></span> <span data-ttu-id="e700b-118">Quando un'applicazione console riceve una notifica di **\_ \_ evento CTRL C** , l'applicazione deve eseguire le operazioni necessarie per preparare un arresto entro il periodo di timeout specificato.</span><span class="sxs-lookup"><span data-stu-id="e700b-118">When a console application receives a **CTRL\_C\_EVENT** notification, the application should take actions necessary to prepare for a shutdown within the specified timeout period.</span></span> <span data-ttu-id="e700b-119">Come minimo, le applicazioni console devono definire una funzione [*HandlerRoutine*](/windows/console/handlerroutine) per gestire la notifica degli **eventi di CTRL \_ C \_** e salvare tutti i dati utente e le informazioni sullo stato che saranno necessari dopo un riavvio.</span><span class="sxs-lookup"><span data-stu-id="e700b-119">At a minimum, console applications should define a [*HandlerRoutine*](/windows/console/handlerroutine) function to handle the **CTRL\_C\_EVENT** notification and should save any user data and state information that is going to be needed after a restart.</span></span> <span data-ttu-id="e700b-120">È consigliabile che le applicazioni Salvino periodicamente i dati e lo stato dell'utente.</span><span class="sxs-lookup"><span data-stu-id="e700b-120">It is recommended that applications periodically save the user data and state.</span></span>
-   <span data-ttu-id="e700b-121">Se le applicazioni non vengono arrestate in risposta ai messaggi di chiusura, i programmi di installazione possono usare l'opzione **RmForceShutdown** della funzione [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) per forzare l'arresto dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="e700b-121">If any applications do not shut down in response to the shutdown messages, installers can use the **RmForceShutdown** option of the [**RmShutdown**](/windows/desktop/api/RestartManager/nf-restartmanager-rmshutdown) function to force the applications to shut down.</span></span> <span data-ttu-id="e700b-122">Quando il programma di installazione specifica un arresto forzato, gestione riavvio tenta di arrestare correttamente le applicazioni inviando i messaggi di arresto, ma forza l'arresto in caso di errore.</span><span class="sxs-lookup"><span data-stu-id="e700b-122">When the installer specifies a forced shutdown, Restart Manager attempts to shut down the applications cleanly by sending the shutdown messages, but will force them shut if this fails.</span></span> <span data-ttu-id="e700b-123">È possibile forzare l'arresto di applicazioni GUI e applicazioni console per consentire l'installazione di un aggiornamento critico della sicurezza.</span><span class="sxs-lookup"><span data-stu-id="e700b-123">GUI applications and console applications can be forced to shut down to enable the installation of a critical security update.</span></span> <span data-ttu-id="e700b-124">Poiché questo può comportare la perdita di dati, le applicazioni devono gestire i messaggi di arresto e arrestare la pulizia quando necessario.</span><span class="sxs-lookup"><span data-stu-id="e700b-124">Because this can result in data loss, applications should handle the shutdown messages and shut down cleanly when required.</span></span>
-   <span data-ttu-id="e700b-125">Le applicazioni devono registrarsi per un riavvio tramite la funzione [**RegisterApplicationRestart**](/windows/desktop/api/winbase/nf-winbase-registerapplicationrestart) .</span><span class="sxs-lookup"><span data-stu-id="e700b-125">Applications should register for a restart by using the [**RegisterApplicationRestart**](/windows/desktop/api/winbase/nf-winbase-registerapplicationrestart) function.</span></span> <span data-ttu-id="e700b-126">Gestione riavvio può riavviare solo le applicazioni che sono state registrate per il riavvio.</span><span class="sxs-lookup"><span data-stu-id="e700b-126">Restart Manager can only restart applications that have been registered for restart.</span></span> <span data-ttu-id="e700b-127">Questo è l'unico modo in cui gestione riavvio è in grado di determinare il comando della riga di comando da usare durante il riavvio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="e700b-127">This is the only way that the Restart Manager can determine the command-line command to use when restarting the application.</span></span> <span data-ttu-id="e700b-128">Se l'applicazione deve riaprirsi con alcuni dati o uno stato salvato, tali informazioni devono essere incluse nel comando della riga di comando registrato per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="e700b-128">If the application must reopen with some saved state or data, that information must be included in the command-line command that is registered for the application.</span></span>
    > [!Note]  
    > <span data-ttu-id="e700b-129">Se l'applicazione riavviata deve essere eseguita nella stessa directory in cui è stata eseguita prima di essere arrestata, l'applicazione deve salvare le informazioni della directory e quindi passare alla directory dopo il riavvio.</span><span class="sxs-lookup"><span data-stu-id="e700b-129">If the restarted application must run in the same directory it ran in before being shut down, the application must save the directory information and then change to the directory after restarting.</span></span>

     

    > [!Note]  
    > <span data-ttu-id="e700b-130">La funzione [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) non riavvia le applicazioni che non vengono eseguite come utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="e700b-130">The [**RmRestart**](/windows/desktop/api/RestartManager/nf-restartmanager-rmrestart) function does not restart applications that do not run as the currently-logged on user.</span></span> <span data-ttu-id="e700b-131">Ad esempio, la funzione **RmRestart** non riavvia le applicazioni avviate con il comando **RunAs** che non vengono eseguite come utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="e700b-131">For example, the **RmRestart** function does not restart applications started with the **Run As** command that do not run as the currently-logged on user.</span></span> <span data-ttu-id="e700b-132">Queste applicazioni devono essere riavviate manualmente.</span><span class="sxs-lookup"><span data-stu-id="e700b-132">These applications must be manually restarted.</span></span>

     

-   <span data-ttu-id="e700b-133">Quando Gestione riavvio determina che è necessario riavviare il sistema per installare un aggiornamento, non arresta alcun servizio e applicazioni.</span><span class="sxs-lookup"><span data-stu-id="e700b-133">When Restart Manager determines that a system restart is required to install an update, it does not shut down any applications and services.</span></span> <span data-ttu-id="e700b-134">Al contrario, lascia al programma di installazione di decidere quando pianificare un riavvio del sistema e installare l'aggiornamento.</span><span class="sxs-lookup"><span data-stu-id="e700b-134">Instead, it leaves this to the installer to decide when to schedule a system restart and install the update.</span></span> <span data-ttu-id="e700b-135">I programmi di installazione possono ridurre l'interruzione degli utenti causati da aggiornamenti che richiedono un riavvio del sistema tramite la funzione [**ExitWindowsEx**](/windows/desktop/api/winuser/nf-winuser-exitwindowsex) con il flag **EWX \_ RESTARTAPPS** o la funzione [**InitiateShutdown**](/windows/desktop/api/winreg/nf-winreg-initiateshutdowna) con il flag **Shutdown \_ RESTARTAPPS** .</span><span class="sxs-lookup"><span data-stu-id="e700b-135">Installers can reduce the disruption to users caused by updates that require a system restart by using the [**ExitWindowsEx**](/windows/desktop/api/winuser/nf-winuser-exitwindowsex) function with the **EWX\_RESTARTAPPS** flag or the [**InitiateShutdown**](/windows/desktop/api/winreg/nf-winreg-initiateshutdowna) function with the **SHUTDOWN\_RESTARTAPPS** flag.</span></span> <span data-ttu-id="e700b-136">L'uso di questi flag garantisce che le applicazioni registrate per il riavvio vengano riavviate dopo un riavvio del sistema, riducendo al minimo l'effetto sull'utente.</span><span class="sxs-lookup"><span data-stu-id="e700b-136">Using these flags ensures that applications registered for restart are restarted after a system reboot, which minimizes the impact on the user.</span></span>

 

 