---
title: Cenni preliminari sugli heap di descrittori
description: Gli heap del descrittore contengono molti tipi di oggetto che non fanno parte di un oggetto di stato della pipeline (PSO), ad esempio viste di risorse shader (SRVs), viste di accesso non ordinate (UAV), viste del buffer costante (CBVs) e Samplers.
ms.assetid: 14561E77-44E0-4A58-8456-F40D59ECA175
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a8bf720ebb71d016457fa4383a8d33aa62e2eee4
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/16/2019
ms.locfileid: "74104838"
---
# <a name="descriptor-heaps-overview"></a><span data-ttu-id="ea568-103">Cenni preliminari sugli heap di descrittori</span><span class="sxs-lookup"><span data-stu-id="ea568-103">Descriptor Heaps Overview</span></span>

<span data-ttu-id="ea568-104">Gli heap del descrittore contengono molti tipi di oggetto che non fanno parte di un oggetto di stato della pipeline (PSO), ad esempio viste di risorse shader (SRVs), viste di accesso non ordinate (UAV), viste del buffer costante (CBVs) e Samplers.</span><span class="sxs-lookup"><span data-stu-id="ea568-104">Descriptor heaps contain many object types that are not part of a Pipeline State Object (PSO), such as Shader Resource Views (SRVs), Unordered Access Views (UAVs), Constant Buffer Views (CBVs), and Samplers.</span></span>

-   [<span data-ttu-id="ea568-105">Scopo degli heap dei descrittori</span><span class="sxs-lookup"><span data-stu-id="ea568-105">The Purpose of Descriptor Heaps</span></span>](#the-purpose-of-descriptor-heaps)
-   [<span data-ttu-id="ea568-106">Sincronizzazione</span><span class="sxs-lookup"><span data-stu-id="ea568-106">Synchronization</span></span>](#synchronization)
-   [<span data-ttu-id="ea568-107">Associazione</span><span class="sxs-lookup"><span data-stu-id="ea568-107">Binding</span></span>](#binding)
-   [<span data-ttu-id="ea568-108">Spostamento di heap</span><span class="sxs-lookup"><span data-stu-id="ea568-108">Switching heaps</span></span>](#switching-heaps)
-   [<span data-ttu-id="ea568-109">Bundle</span><span class="sxs-lookup"><span data-stu-id="ea568-109">Bundles</span></span>](#bundles)
-   [<span data-ttu-id="ea568-110">Gestione</span><span class="sxs-lookup"><span data-stu-id="ea568-110">Management</span></span>](#management)
-   [<span data-ttu-id="ea568-111">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="ea568-111">Related topics</span></span>](#related-topics)

## <a name="the-purpose-of-descriptor-heaps"></a><span data-ttu-id="ea568-112">Scopo degli heap dei descrittori</span><span class="sxs-lookup"><span data-stu-id="ea568-112">The Purpose of Descriptor Heaps</span></span>

<span data-ttu-id="ea568-113">Lo scopo principale di un heap dei descrittori è includere la maggior parte dell'allocazione di memoria necessaria per archiviare le specifiche del descrittore dei tipi di oggetto a cui fanno riferimento gli shader per il maggior numero possibile di una finestra di rendering (idealmente un intero frame di rendering o più).</span><span class="sxs-lookup"><span data-stu-id="ea568-113">The primary purpose of a descriptor heap is to encompass the bulk of memory allocation required for storing the descriptor specifications of object types that shaders reference for as large of a window of rendering as possible (ideally an entire frame of rendering or more).</span></span> <span data-ttu-id="ea568-114">Se un'applicazione sta cambiando le trame che la pipeline rileva rapidamente dall'API, è necessario che nell'heap del descrittore vengano definite le tabelle dei descrittori in tempo reale per ogni set di stato necessario.</span><span class="sxs-lookup"><span data-stu-id="ea568-114">If an application is switching which textures the pipeline sees rapidly from the API, there has to be space in the descriptor heap to define descriptor tables on the fly for every set of state needed.</span></span> <span data-ttu-id="ea568-115">L'applicazione può scegliere di riutilizzare le definizioni se le risorse vengono riutilizzate in un altro oggetto, ad esempio, o semplicemente di assegnare lo spazio dell'heap in modo sequenziale durante la commutazione di diversi tipi di oggetto.</span><span class="sxs-lookup"><span data-stu-id="ea568-115">The application can choose to reuse definitions if the resources are used again in another object, for example, or just assign the heap space sequentially as it switches various object types.</span></span>

<span data-ttu-id="ea568-116">Gli heap dei descrittori consentono inoltre ai singoli componenti software di gestire l'archiviazione descrittore separatamente.</span><span class="sxs-lookup"><span data-stu-id="ea568-116">Descriptor heaps also allow individual software components to manage descriptor storage separately from each other.</span></span>

<span data-ttu-id="ea568-117">Tutti gli heap sono visibili alla CPU.</span><span class="sxs-lookup"><span data-stu-id="ea568-117">All heaps are visible to the CPU.</span></span> <span data-ttu-id="ea568-118">L'applicazione può anche richiedere quali proprietà di accesso alla CPU un heap dei descrittori deve avere (se presente), ovvero scrivere combinate, scrivere di nuovo e così via.</span><span class="sxs-lookup"><span data-stu-id="ea568-118">The application can also request which CPU access properties a descriptor heap should have (if any) – write combined, write back, and so on.</span></span> <span data-ttu-id="ea568-119">Le app possono creare tutti gli heap dei descrittori desiderati con qualsiasi proprietà desiderata.</span><span class="sxs-lookup"><span data-stu-id="ea568-119">Apps can create as many descriptor heaps as desired with whatever properties are desired.</span></span> <span data-ttu-id="ea568-120">Le app hanno sempre la possibilità di creare heap del descrittore esclusivamente per finalità di staging che non sono vincolate e vengono copiati negli heap descrittore usati per il rendering in modo necessario.</span><span class="sxs-lookup"><span data-stu-id="ea568-120">Apps always have the option to create descriptor heaps that are purely for staging purposes that are unconstrained in size, and copying to descriptor heaps that are used for rendering as necessary.</span></span>

<span data-ttu-id="ea568-121">Esistono alcune restrizioni per gli elementi che possono essere inseriti nello stesso heap del descrittore.</span><span class="sxs-lookup"><span data-stu-id="ea568-121">There are some restrictions in what can go in the same descriptor heap.</span></span> <span data-ttu-id="ea568-122">Le voci CBV, UAV e SRV possono trovarsi nello stesso heap del descrittore.</span><span class="sxs-lookup"><span data-stu-id="ea568-122">CBV, UAV and SRV entries can be in the same descriptor heap.</span></span> <span data-ttu-id="ea568-123">Tuttavia, le voci dei sampler non possono condividere un heap con le voci CBV, UAV o SRV.</span><span class="sxs-lookup"><span data-stu-id="ea568-123">However, Samplers entries cannot share a heap with CBV, UAV or SRV entries.</span></span> <span data-ttu-id="ea568-124">In genere, sono disponibili due insiemi di heap dei descrittori, uno per le risorse comuni e il secondo per i sampler.</span><span class="sxs-lookup"><span data-stu-id="ea568-124">Typically, there are two sets of descriptor heaps, one for the common resources and the second for Samplers.</span></span>

<span data-ttu-id="ea568-125">L'uso degli heap dei descrittori di Direct3D 12 rispecchia la maggior parte dell'hardware GPU, che richiede che i descrittori siano attivi solo negli heap dei descrittori o semplicemente che siano necessari meno bit di indirizzamento se vengono usati questi heap.</span><span class="sxs-lookup"><span data-stu-id="ea568-125">The use of descriptor heaps by Direct3D 12 mirrors what most GPU hardware does, which is to either require descriptors live only in descriptor heaps, or simply that fewer addressing bits are needed if these heaps are used.</span></span> <span data-ttu-id="ea568-126">Direct3D 12 richiede l'uso di heap di descrittori. non è possibile inserire descrittori in qualsiasi punto della memoria.</span><span class="sxs-lookup"><span data-stu-id="ea568-126">Direct3D 12 does require the use of descriptor heaps, there is no option to put descriptors anywhere in memory.</span></span>

<span data-ttu-id="ea568-127">Gli heap dei descrittori possono essere modificati immediatamente solo dalla CPU, ma non è possibile modificare un heap dei descrittori tramite la GPU.</span><span class="sxs-lookup"><span data-stu-id="ea568-127">Descriptor heaps can only be edited immediately by the CPU, there is no option to edit a descriptor heap by the GPU.</span></span>

## <a name="synchronization"></a><span data-ttu-id="ea568-128">Sincronizzazione</span><span class="sxs-lookup"><span data-stu-id="ea568-128">Synchronization</span></span>

<span data-ttu-id="ea568-129">Il contenuto dell'heap del descrittore può essere modificato prima, durante e dopo la registrazione degli elenchi di comandi che vi fanno riferimento.</span><span class="sxs-lookup"><span data-stu-id="ea568-129">Descriptor heap contents can be changed before, during and after recording command lists that reference it.</span></span> <span data-ttu-id="ea568-130">Tuttavia, i descrittori non possono essere modificati mentre un elenco di comandi inviato per l'esecuzione può fare riferimento a tale percorso, in quanto questo può richiamare un race condition.</span><span class="sxs-lookup"><span data-stu-id="ea568-130">However, descriptors cannot be changed while a command list submitted for execution might reference that location, as this could invoke a race condition.</span></span>

## <a name="binding"></a><span data-ttu-id="ea568-131">Binding</span><span class="sxs-lookup"><span data-stu-id="ea568-131">Binding</span></span>

<span data-ttu-id="ea568-132">È possibile associare al massimo un heap combinato CBV/SRV/UAV e un heap campionatore alla volta.</span><span class="sxs-lookup"><span data-stu-id="ea568-132">At most one CBV/SRV/UAV combined heap and one Sampler heap can be bound at any one time.</span></span> <span data-ttu-id="ea568-133">Questi heap sono condivisi tra le pipeline di calcolo e di grafica (descritte in PSO).</span><span class="sxs-lookup"><span data-stu-id="ea568-133">These heaps are shared between both the graphics and compute pipelines (described in their PSOs).</span></span>

## <a name="switching-heaps"></a><span data-ttu-id="ea568-134">Spostamento di heap</span><span class="sxs-lookup"><span data-stu-id="ea568-134">Switching heaps</span></span>

<span data-ttu-id="ea568-135">È accettabile che un'applicazione Commuti gli heap nello stesso elenco di comandi o in quelli diversi usando le API [**SetDescriptorHeaps**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setdescriptorheaps) e [**Reset**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-reset) .</span><span class="sxs-lookup"><span data-stu-id="ea568-135">It is acceptable for an application to switch heaps within the same command list or in different ones using the [**SetDescriptorHeaps**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setdescriptorheaps) and [**Reset**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-reset) APIs.</span></span> <span data-ttu-id="ea568-136">In alcuni componenti hardware può trattarsi di un'operazione costosa, che richiede la disattivazione di una GPU per lo scaricamento di tutte le operazioni che dipendono dall'heap del descrittore attualmente associato.</span><span class="sxs-lookup"><span data-stu-id="ea568-136">On some hardware, this can be an expensive operation, requiring a GPU stall to flush all work that depends on the currently bound descriptor heap.</span></span> <span data-ttu-id="ea568-137">Di conseguenza, se è necessario modificare gli heap del descrittore, le applicazioni devono provare a farlo quando il carico di lavoro della GPU è relativamente leggero, forse limitando le modifiche all'inizio di un elenco di comandi.</span><span class="sxs-lookup"><span data-stu-id="ea568-137">As a result, if descriptor heaps must be changed, applications should try to do so when the GPU workload is relatively light, perhaps limiting changes to the start of a command list.</span></span>

## <a name="bundles"></a><span data-ttu-id="ea568-138">Bundle</span><span class="sxs-lookup"><span data-stu-id="ea568-138">Bundles</span></span>

<span data-ttu-id="ea568-139">Con Bundle è possibile eseguire una sola chiamata al metodo [**SetDescriptorHeaps**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setdescriptorheaps) e gli heap del descrittore impostati devono corrispondere esattamente a quelli dell'elenco di comandi che chiama il bundle.</span><span class="sxs-lookup"><span data-stu-id="ea568-139">With bundles there can only be one call to the [**SetDescriptorHeaps**](/windows/desktop/api/d3d12/nf-d3d12-id3d12graphicscommandlist-setdescriptorheaps) method, and the descriptor heaps set must match exactly those of the command list calling the bundle.</span></span> <span data-ttu-id="ea568-140">Se il bundle non modifica le tabelle dei descrittori, non è necessario impostare gli heap del descrittore.</span><span class="sxs-lookup"><span data-stu-id="ea568-140">If the bundle does not change descriptor tables, it does not need to set the descriptor heaps.</span></span>

<span data-ttu-id="ea568-141">Per un elenco di chiamate API che non possono essere usate con bundle, vedere [creazione e registrazione di elenchi di comandi e bundle](recording-command-lists-and-bundles.md).</span><span class="sxs-lookup"><span data-stu-id="ea568-141">For a list of API calls that cannot be used with bundles, refer to [Creating and Recording Command Lists and Bundles](recording-command-lists-and-bundles.md).</span></span>

## <a name="management"></a><span data-ttu-id="ea568-142">Gestione</span><span class="sxs-lookup"><span data-stu-id="ea568-142">Management</span></span>

<span data-ttu-id="ea568-143">Per eseguire il rendering di tutti gli oggetti in una scena, saranno necessari molti descrittori ed è possibile seguire alcune strategie di gestione diverse.</span><span class="sxs-lookup"><span data-stu-id="ea568-143">To render all of the objects in a scene, many descriptors will be needed, and there are some different management strategies that can be followed.</span></span>

<span data-ttu-id="ea568-144">La strategia più semplice consiste nel compilare un'area aggiornata dell'heap dei descrittori con tutti i requisiti per la chiamata di estrazione successiva.</span><span class="sxs-lookup"><span data-stu-id="ea568-144">The most basic strategy would be to fill in a fresh area of the descriptor heap with all of the requirements for the next draw call.</span></span> <span data-ttu-id="ea568-145">Quindi, appena prima di emettere la chiamata di progetto nell'elenco dei comandi, un puntatore alla tabella del descrittore verrebbe impostato sull'inizio della tabella appena popolata.</span><span class="sxs-lookup"><span data-stu-id="ea568-145">So, just before issuing the draw call on the command list, a descriptor table pointer would be set to the start of the freshly populated table.</span></span> <span data-ttu-id="ea568-146">Il lato positivo è che non è necessario registrare la posizione di un determinato descrittore nell'heap.</span><span class="sxs-lookup"><span data-stu-id="ea568-146">The upside is that there is no need to record where any particular descriptor is in the heap.</span></span>

<span data-ttu-id="ea568-147">Lo svantaggio di questa strategia è costituito dal fatto che potrebbe esserci una grande ripetizione di descrittori nell'heap del descrittore, specialmente quando viene eseguito il rendering di una scena molto simile e lo spazio dell'heap del descrittore verrà utilizzato rapidamente.</span><span class="sxs-lookup"><span data-stu-id="ea568-147">The downside to this strategy is that there could be a lot of repetition of descriptors in the descriptor heap, especially when a very similar scene is being rendered, and that descriptor heap space is going to be used up quickly.</span></span> <span data-ttu-id="ea568-148">Gli heap dei descrittori separati per i quali viene eseguito il rendering sulla GPU e per quelli registrati dalla CPU possono essere probabilmente necessari per evitare conflitti.</span><span class="sxs-lookup"><span data-stu-id="ea568-148">Separate descriptor heaps for those being rendered on the GPU and for those being recorded by the CPU, would probably be necessary to avoid conflict.</span></span> <span data-ttu-id="ea568-149">In alternativa, è possibile usare un sistema di suddivisione delle sottoallocazioni.</span><span class="sxs-lookup"><span data-stu-id="ea568-149">Alternatively a sub-allocation system could be used.</span></span>

<span data-ttu-id="ea568-150">Inoltre, il sistema di base potrebbe essere ulteriormente ottimizzato con un utilizzo accurato di tabelle descrittore sovrapposte da una chiamata di creazione a quella successiva, in modo che vengano aggiunti solo i nuovi descrittori richiesti.</span><span class="sxs-lookup"><span data-stu-id="ea568-150">Also, the basic system could be further optimized by careful use of overlapping descriptor tables from one draw call to the next, so that only the new descriptors required are added.</span></span>

<span data-ttu-id="ea568-151">Una strategia più efficiente rispetto a quella di base consiste nel precompilare gli heap dei descrittori con i descrittori necessari per gli oggetti (o materiali) noti come parte della scena.</span><span class="sxs-lookup"><span data-stu-id="ea568-151">A more efficient strategy than the basic one would be to pre-fill descriptor heaps with descriptors required for the objects (or materials) that are known to be part of the scene.</span></span> <span data-ttu-id="ea568-152">L'idea è che è necessario solo impostare la tabella descrittore in fase di estrazione, perché l'heap del descrittore viene popolato in anticipo.</span><span class="sxs-lookup"><span data-stu-id="ea568-152">The idea here is that it is only necessary to set the descriptor table at draw time, as the descriptor heap is populated ahead of time.</span></span>

<span data-ttu-id="ea568-153">Una variante della strategia di pre-riempimento consiste nel considerare l'heap del descrittore come una grande matrice, che contiene tutti i descrittori richiesti in posizioni note fisse.</span><span class="sxs-lookup"><span data-stu-id="ea568-153">A variation of the pre-filling strategy is to treat the descriptor heap as one huge array, containing all the required descriptors in fixed known locations.</span></span> <span data-ttu-id="ea568-154">Quindi la chiamata di progetto deve solo ricevere un set di costanti che sono gli indici nella matrice di in cui devono essere usati i descrittori.</span><span class="sxs-lookup"><span data-stu-id="ea568-154">Then the draw call needs only to receive a set of constants which are the indices into the array of where the descriptors are that need to be used.</span></span>

<span data-ttu-id="ea568-155">Un'ulteriore ottimizzazione consiste nel garantire che le costanti radice e i descrittori radice contengano quelli che cambiano più di frequente, anziché inserire costanti nell'heap del descrittore.</span><span class="sxs-lookup"><span data-stu-id="ea568-155">A further optimization is to ensure root constants and root descriptors contain those that change most frequently, rather than place constants in the descriptor heap.</span></span> <span data-ttu-id="ea568-156">Per la maggior parte dell'hardware, si tratta di un modo efficiente per gestire le costanti.</span><span class="sxs-lookup"><span data-stu-id="ea568-156">For most hardware this is an efficient way of handling constants.</span></span>

<span data-ttu-id="ea568-157">In pratica, un motore di grafica può utilizzare una strategia diversa in situazioni diverse e combinare gli elementi di ogni strategia per soddisfare i requisiti di disegno specifici.</span><span class="sxs-lookup"><span data-stu-id="ea568-157">In practice a graphics engine might use a different strategy in different situations, and combine elements of each strategy to suit the particular drawing requirements.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ea568-158">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="ea568-158">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ea568-159">Heap descrittore</span><span class="sxs-lookup"><span data-stu-id="ea568-159">Descriptor Heaps</span></span>](descriptor-heaps.md)
</dt> </dl>

 

 




