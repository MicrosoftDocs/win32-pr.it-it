---
title: Heap condivisi
description: La condivisione è utile per le architetture a più processi e a più adapter.
ms.assetid: 67C6B1D4-BF76-45A9-BADC-7C9520C900EB
ms.localizationpriority: high
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9f4271055f88e38484041c225b6b17c6d75f0d98
ms.sourcegitcommit: d6102d9e2b26368142fe5b006c65acb50c98be65
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/26/2019
ms.locfileid: "74103726"
---
# <a name="shared-heaps"></a><span data-ttu-id="cde76-103">Heap condivisi</span><span class="sxs-lookup"><span data-stu-id="cde76-103">Shared Heaps</span></span>

<span data-ttu-id="cde76-104">La condivisione è utile per le architetture a più processi e a più adapter.</span><span class="sxs-lookup"><span data-stu-id="cde76-104">Sharing is useful for multi-process and multi-adapter architectures.</span></span>

-   [<span data-ttu-id="cde76-105">Panoramica della condivisione</span><span class="sxs-lookup"><span data-stu-id="cde76-105">Sharing overview</span></span>](#sharing-overview)
-   [<span data-ttu-id="cde76-106">Condivisione di heap tra processi</span><span class="sxs-lookup"><span data-stu-id="cde76-106">Sharing heaps across processes</span></span>](#sharing-heaps-across-processes)
-   [<span data-ttu-id="cde76-107">Condivisione degli heap tra gli adapter</span><span class="sxs-lookup"><span data-stu-id="cde76-107">Sharing heaps across adapters</span></span>](#sharing-heaps-across-adapters)
-   [<span data-ttu-id="cde76-108">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="cde76-108">Related topics</span></span>](#related-topics)

## <a name="sharing-overview"></a><span data-ttu-id="cde76-109">Panoramica della condivisione</span><span class="sxs-lookup"><span data-stu-id="cde76-109">Sharing overview</span></span>

<span data-ttu-id="cde76-110">Gli heap condivisi consentono due operazioni: condividere i dati in un heap in uno o più processi e escludere una scelta non deterministica del layout di trama non definito per le risorse posizionate all'interno dell'heap.</span><span class="sxs-lookup"><span data-stu-id="cde76-110">Shared heaps enable two things: sharing data in a heap across one or more processes, and precluding a non-deterministic choice of undefined texture layout for resources placed within the heap.</span></span> <span data-ttu-id="cde76-111">La condivisione degli heap tra gli adapter consente inoltre di eliminare la necessità di effettuare il marshalling della CPU dei dati.</span><span class="sxs-lookup"><span data-stu-id="cde76-111">Sharing heaps across adapters also removes the need for CPU marshaling of the data.</span></span>

<span data-ttu-id="cde76-112">Gli heap e le risorse di cui è stato eseguito il commit possono essere condivisi.</span><span class="sxs-lookup"><span data-stu-id="cde76-112">Both heaps and committed resources can be shared.</span></span> <span data-ttu-id="cde76-113">La condivisione di una risorsa di cui è stato eseguito il commit condivide effettivamente l'heap implicito insieme alla descrizione della risorsa di cui è stato eseguito il commit, in modo che sia possibile eseguire il mapping di una descrizione della risorsa compatibile</span><span class="sxs-lookup"><span data-stu-id="cde76-113">Sharing a committed resource actually shares the implicit heap along with the committed resource description, such that a compatible resource description can be mapped to the heap from another device.</span></span>

<span data-ttu-id="cde76-114">Tutti i metodi sono a thread libero e ereditano la semantica D3D11 esistente della progettazione della condivisione dell'handle NT.</span><span class="sxs-lookup"><span data-stu-id="cde76-114">All methods are free-threaded and inherit the existing D3D11 semantics of the NT handle sharing design.</span></span>

-   [<span data-ttu-id="cde76-115">**ID3D12Device::CreateSharedHandle**</span><span class="sxs-lookup"><span data-stu-id="cde76-115">**ID3D12Device::CreateSharedHandle**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createsharedhandle)
-   [<span data-ttu-id="cde76-116">**ID3D12Device::OpenSharedHandle**</span><span class="sxs-lookup"><span data-stu-id="cde76-116">**ID3D12Device::OpenSharedHandle**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandle)
-   [<span data-ttu-id="cde76-117">**ID3D12Device::OpenSharedHandleByName**</span><span class="sxs-lookup"><span data-stu-id="cde76-117">**ID3D12Device::OpenSharedHandleByName**</span></span>](/windows/win32/api/d3d12/nf-d3d12-id3d12device-opensharedhandlebyname)

## <a name="sharing-heaps-across-processes"></a><span data-ttu-id="cde76-118">Condivisione di heap tra processi</span><span class="sxs-lookup"><span data-stu-id="cde76-118">Sharing heaps across processes</span></span>

<span data-ttu-id="cde76-119">Gli heap condivisi vengono specificati con il \_ \_ membro condiviso del flag heap D3D12 \_ dell' [**enumerazione \_ \_ flag heap D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) .</span><span class="sxs-lookup"><span data-stu-id="cde76-119">Shared heaps are specified with the D3D12\_HEAP\_FLAG\_SHARED member of the [**D3D12\_HEAP\_FLAGS**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) enum.</span></span>

<span data-ttu-id="cde76-120">Gli heap condivisi non sono supportati negli heap accessibili dalla CPU: il \_ caricamento del tipo di heap D3D12, il tipo di \_ \_ \_ heap D3D12 \_ \_ READBACK e il \_ tipo di heap D3D12 \_ \_ personalizzati senza \_ proprietà della pagina della CPU D3D12 \_ non sono \_ \_ \_ disponibili.</span><span class="sxs-lookup"><span data-stu-id="cde76-120">Shared heaps are not supported on CPU-accessible heaps: D3D12\_HEAP\_TYPE\_UPLOAD, D3D12\_HEAP\_TYPE\_READBACK, and D3D12\_HEAP\_TYPE\_CUSTOM without D3D12\_CPU\_PAGE\_PROPERTY\_NOT\_AVAILABLE.</span></span>

<span data-ttu-id="cde76-121">Se una scelta non deterministica del layout di trama non definito può compromettere in modo significativo scenari di rendering posticipati in alcune GPU, non è il comportamento predefinito per le risorse posizionate e sottoposte a commit.</span><span class="sxs-lookup"><span data-stu-id="cde76-121">Precluding a non-deterministic choice of undefined texture layout can significantly impair deferred rendering scenarios on some GPUs, so it is not the default behavior for placed and committed resources.</span></span> <span data-ttu-id="cde76-122">Il rendering posticipato non è associato ad alcune architetture GPU perché i layout di trama deterministico diminuiscono la larghezza di banda di memoria effettiva conseguita durante il rendering simultaneo a più trame di destinazione di rendering dello stesso formato e dimensioni.</span><span class="sxs-lookup"><span data-stu-id="cde76-122">Deferred rendering is impaired on some GPU architectures because deterministic texture layouts decrease the effective memory bandwidth achieved when rendering simultaneously to multiple render target textures of the same format and size.</span></span> <span data-ttu-id="cde76-123">Le architetture GPU si evolvono dall'uso di layout di trama non deterministici per supportare i modelli swizzle standardizzati e i layout standardizzati in modo efficiente per il rendering posticipato.</span><span class="sxs-lookup"><span data-stu-id="cde76-123">GPU architectures are evolving away from leveraging non-deterministic texture layouts in order to support standardized swizzle patterns and standardized layouts efficiently for deferred rendering.</span></span>

<span data-ttu-id="cde76-124">Gli heap condivisi sono associati anche ad altri costi secondari:</span><span class="sxs-lookup"><span data-stu-id="cde76-124">Shared heaps come with other minor costs as well:</span></span>

-   <span data-ttu-id="cde76-125">I dati dell'heap condiviso non possono essere riciclati in modo flessibile come gli heap in-process a causa di problemi di divulgazione delle informazioni, quindi la memoria fisica viene zero'ed più spesso.</span><span class="sxs-lookup"><span data-stu-id="cde76-125">Shared heap data cannot be recycled as flexibly as in-process heaps due to information disclosure concerns, so physical memory is zero'ed more often.</span></span>
-   <span data-ttu-id="cde76-126">Si verifica un sovraccarico aggiuntivo della CPU e un maggiore utilizzo della memoria di sistema durante la creazione e la distruzione degli heap condivisi.</span><span class="sxs-lookup"><span data-stu-id="cde76-126">There is a minor additional CPU overhead and increased system memory usage during creation and destruction of shared heaps.</span></span>

## <a name="sharing-heaps-across-adapters"></a><span data-ttu-id="cde76-127">Condivisione degli heap tra gli adapter</span><span class="sxs-lookup"><span data-stu-id="cde76-127">Sharing heaps across adapters</span></span>

<span data-ttu-id="cde76-128">Gli heap condivisi tra gli adapter vengono specificati con il \_ \_ membro della \_ \_ scheda incrociata D3D12 del flag dell'heap condiviso \_ dell'enum dei [**\_ \_ flag dell'heap di D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) .</span><span class="sxs-lookup"><span data-stu-id="cde76-128">Shared heaps across adapters is specified with the D3D12\_HEAP\_FLAG\_SHARED\_CROSS\_ADAPTER member of the [**D3D12\_HEAP\_FLAGS**](/windows/win32/api/d3d12/ne-d3d12-d3d12_heap_flags) enum.</span></span>

<span data-ttu-id="cde76-129">Gli heap condivisi tra più adapter consentono a più adapter di condividere i dati senza che venga eseguito il marshalling dei dati tra di essi.</span><span class="sxs-lookup"><span data-stu-id="cde76-129">Cross adapter shared heaps enable multiple adapters to share data without the CPU marshaling the data between them.</span></span> <span data-ttu-id="cde76-130">Sebbene le diverse funzionalità dell'adapter determinino il modo in cui gli adattatori possono passare i dati tra di essi, l'abilitazione delle copie GPU aumenta la larghezza di banda effettiva.</span><span class="sxs-lookup"><span data-stu-id="cde76-130">While varying adapter capabilities determine how efficient adapters can pass data between them, merely enabling GPU copies increases the effective bandwidth achieved.</span></span> <span data-ttu-id="cde76-131">Alcuni layout di trama sono consentiti negli heap tra Adapter per supportare un interscambio di dati di trama, anche se tali layout non sono altrimenti supportati.</span><span class="sxs-lookup"><span data-stu-id="cde76-131">Some texture layouts are allowed on cross adapter heaps to support an interchange of texture data, even if such texture layouts are not otherwise supported.</span></span> <span data-ttu-id="cde76-132">È possibile che alcune restrizioni si applichino a tali trame, ad esempio solo il supporto della copia.</span><span class="sxs-lookup"><span data-stu-id="cde76-132">Certain restrictions may apply to such textures, such as only supporting copying.</span></span>

<span data-ttu-id="cde76-133">La condivisione tra Adapter funziona con gli heap creati chiamando [**ID3D12Device:: createheap ha provocato**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span><span class="sxs-lookup"><span data-stu-id="cde76-133">Cross-adapter sharing works with heaps created by calling [**ID3D12Device::CreateHeap**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createheap).</span></span> <span data-ttu-id="cde76-134">Le applicazioni possono quindi creare risorse tramite [**CreatePlacedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource).</span><span class="sxs-lookup"><span data-stu-id="cde76-134">Applications can then create resources via [**CreatePlacedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createplacedresource).</span></span> <span data-ttu-id="cde76-135">È consentita anche da risorse/heap creati da [**CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) , ma solo per \_ le risorse TEXTURE2D della dimensione della risorsa D3D12 di riga \_ \_ (fare riferimento alla [**\_ \_ dimensione della risorsa D3D12**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)).</span><span class="sxs-lookup"><span data-stu-id="cde76-135">It is also allowed by resources/heaps created by [**CreateCommittedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createcommittedresource) but only for row-major D3D12\_RESOURCE\_DIMENSION\_TEXTURE2D resources (refer to [**D3D12\_RESOURCE\_DIMENSION**](/windows/win32/api/d3d12/ne-d3d12-d3d12_resource_dimension)).</span></span> <span data-ttu-id="cde76-136">La condivisione tra adapter non funziona con [**CreateReservedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource).</span><span class="sxs-lookup"><span data-stu-id="cde76-136">Cross-adapter sharing does not work with [**CreateReservedResource**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-createreservedresource).</span></span>

<span data-ttu-id="cde76-137">Per la condivisione tra adapter, vengono applicate tutte le normali regole di condivisione delle risorse tra le code.</span><span class="sxs-lookup"><span data-stu-id="cde76-137">For cross-adapter sharing, all of the usual cross-queue resource sharing rules still apply.</span></span> <span data-ttu-id="cde76-138">Le applicazioni devono emettere le barriere appropriate per garantire la corretta sincronizzazione e coerenza tra i due adapter.</span><span class="sxs-lookup"><span data-stu-id="cde76-138">Applications must issue the appropriate barriers to ensure proper synchronization and coherence between the two adapters.</span></span> <span data-ttu-id="cde76-139">Per coordinare la pianificazione degli elenchi di comandi inviati a più schede, le applicazioni devono utilizzare le barriere tra adapter.</span><span class="sxs-lookup"><span data-stu-id="cde76-139">Applications should use cross-adapter fences to coordinate the scheduling of command lists submitted to multiple adapters.</span></span> <span data-ttu-id="cde76-140">Non è disponibile alcun meccanismo per condividere le risorse tra adapter tra le versioni dell'API D3D.</span><span class="sxs-lookup"><span data-stu-id="cde76-140">There is no mechanism to share cross-adapter resources across D3D API versions.</span></span> <span data-ttu-id="cde76-141">Le risorse condivise tra Adapter sono supportate solo nella memoria di sistema.</span><span class="sxs-lookup"><span data-stu-id="cde76-141">Cross-adapter shared resources are only supported in system memory.</span></span> <span data-ttu-id="cde76-142">Gli heap o le risorse condivise tra Adapter sono supportati negli heap \_ predefiniti del tipo di heap D3D12 e negli heap \_ \_ \_ \_ \_ personalizzati del tipo di heap D3D12 (con il pool di memoria L0 e le proprietà della pagina CPU della combinazione di scrittura).</span><span class="sxs-lookup"><span data-stu-id="cde76-142">Cross-adapter shared heaps/resources are supported in D3D12\_HEAP\_TYPE\_DEFAULT heaps and D3D12\_HEAP\_TYPE\_CUSTOM heaps (with the L0 memory pool, and write-combine CPU page properties).</span></span> <span data-ttu-id="cde76-143">I driver devono assicurarsi che le operazioni di lettura/scrittura GPU per gli heap condivisi tra adapter siano coerenti con altre GPU nel sistema.</span><span class="sxs-lookup"><span data-stu-id="cde76-143">Drivers must be sure that GPU read/write operations to cross-adapter shared heaps are coherent with other GPUs on the system.</span></span> <span data-ttu-id="cde76-144">Ad esempio, il driver potrebbe avere la necessità di escludere i dati dell'heap da risiedere nelle cache GPU che in genere non devono essere scaricate quando la CPU non può accedere direttamente ai dati dell'heap.</span><span class="sxs-lookup"><span data-stu-id="cde76-144">For example, the driver may need to exclude the heap data from residing in GPU caches that typically don’t need to be flushed when the CPU cannot directly access the heap data.</span></span>

<span data-ttu-id="cde76-145">Le applicazioni devono limitare l'utilizzo degli heap tra Adapter solo agli scenari che richiedono la funzionalità fornita.</span><span class="sxs-lookup"><span data-stu-id="cde76-145">Applications should confine the usage of cross adapter heaps to only those scenarios which require the functionality they provide.</span></span> <span data-ttu-id="cde76-146">Gli heap tra adapter si trovano nel pool di \_ memoria \_ D3D12 \_ L0, che non è sempre quello che suggerisce [**GetCustomHeapProperties**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) .</span><span class="sxs-lookup"><span data-stu-id="cde76-146">Cross-adapter heaps are located in D3D12\_MEMORY\_POOL\_L0, which is not always what [**GetCustomHeapProperties**](/windows/win32/api/d3d12/nf-d3d12-id3d12device-getcustomheapproperties) suggests.</span></span> <span data-ttu-id="cde76-147">Il pool di memoria non è efficiente per le architetture di adapter discreti/NUMA.</span><span class="sxs-lookup"><span data-stu-id="cde76-147">That memory pool is not efficient for discrete/ NUMA adapter architectures.</span></span> <span data-ttu-id="cde76-148">I layout di trama più efficienti non sono sempre disponibili.</span><span class="sxs-lookup"><span data-stu-id="cde76-148">And, the most efficient texture layouts are not always available.</span></span>

<span data-ttu-id="cde76-149">Vengono applicate anche le seguenti limitazioni:</span><span class="sxs-lookup"><span data-stu-id="cde76-149">The following limitations also apply:</span></span>

-   <span data-ttu-id="cde76-150">I flag dell'heap correlati ai livelli dell'heap devono essere \_ flag dell'heap D3D12 per \_ \_ consentire \_ tutti i \_ buffer \_ e le \_ trame.</span><span class="sxs-lookup"><span data-stu-id="cde76-150">The heap flags related to heap tiers must be D3D12\_HEAP\_FLAG\_ALLOW\_ALL\_BUFFERS\_AND\_TEXTURES.</span></span>
-   <span data-ttu-id="cde76-151">\_ \_ È necessario impostare anche il flag dell'heap D3D12 \_ condiviso.</span><span class="sxs-lookup"><span data-stu-id="cde76-151">D3D12\_HEAP\_FLAG\_SHARED must also be set.</span></span>
-   <span data-ttu-id="cde76-152">È necessario impostare il \_ \_ valore predefinito del tipo di heap D3D12 \_ o il \_ \_ tipo di heap D3D12 \_ personalizzato con il \_ pool di memoria D3D12 \_ \_ L0 e la \_ proprietà della pagina CPU D3D12 \_ \_ \_ non \_ disponibile.</span><span class="sxs-lookup"><span data-stu-id="cde76-152">Either D3D12\_HEAP\_TYPE\_DEFAULT must be set or D3D12\_HEAP\_TYPE\_CUSTOM with D3D12\_MEMORY\_POOL\_L0 and D3D12\_CPU\_PAGE\_PROPERTY\_NOT\_AVAILABLE must be set.</span></span>
-   <span data-ttu-id="cde76-153">Solo le risorse con \_ flag di risorsa D3D12 \_ \_ \_ \_ possono essere inserite in heap tra più adapter.</span><span class="sxs-lookup"><span data-stu-id="cde76-153">Only resources with D3D12\_RESOURCE\_FLAG\_ALLOW\_CROSS\_ADAPTER may be placed on cross-adapter heaps.</span></span>

<span data-ttu-id="cde76-154">Per ulteriori informazioni sull'utilizzo di più schede, vedere la sezione sistemi con più [Adapter](multi-engine.md) .</span><span class="sxs-lookup"><span data-stu-id="cde76-154">For more information on using multiple adapters, refer to the [Multi-adapter systems](multi-engine.md) section.</span></span>

## <a name="related-topics"></a><span data-ttu-id="cde76-155">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="cde76-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="cde76-156">Sottoallocazione negli heap</span><span class="sxs-lookup"><span data-stu-id="cde76-156">Suballocation Within Heaps</span></span>](suballocation-within-heaps.md)
</dt> </dl>

 

 




