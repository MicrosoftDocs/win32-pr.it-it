---
title: Durata e sincronizzazione delle risorse
description: Per evitare un comportamento non definito, l'applicazione DirectML deve gestire correttamente le durate degli oggetti e la sincronizzazione tra la CPU e la GPU.
ms.custom: Windows 10 May 2019 Update
ms.localizationpriority: high
ms.topic: article
ms.date: 04/19/2019
ms.openlocfilehash: 6e8ab30c5c87c135ef3bdac0c1bc2a3d64040787
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/16/2019
ms.locfileid: "74103990"
---
# <a name="resource-lifetime-and-synchronization"></a><span data-ttu-id="26463-103">Durata e sincronizzazione delle risorse</span><span class="sxs-lookup"><span data-stu-id="26463-103">Resource lifetime and synchronization</span></span>

<span data-ttu-id="26463-104">Analogamente a Direct3D 12, l'applicazione DirectML deve (per evitare un comportamento non definito) gestire correttamente le durate degli oggetti e la sincronizzazione tra la CPU e la GPU.</span><span class="sxs-lookup"><span data-stu-id="26463-104">Just as with Direct3D 12, your DirectML application must (in order to avoid undefined behavior) correctly manage object lifetimes and synchronization between the CPU and the GPU.</span></span> <span data-ttu-id="26463-105">DirectML segue un modello di durata delle risorse identico a quello di Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="26463-105">DirectML follows an identical resource lifetime model to that of Direct3D 12.</span></span>

- <span data-ttu-id="26463-106">Le dipendenze di durata tra due oggetti CPU sono gestite da DirectML usando conteggi dei riferimenti sicuri.</span><span class="sxs-lookup"><span data-stu-id="26463-106">Lifetime dependencies between two CPU objects are maintained by DirectML using strong reference counts.</span></span> <span data-ttu-id="26463-107">L'applicazione non deve gestire manualmente le dipendenze della durata della CPU.</span><span class="sxs-lookup"><span data-stu-id="26463-107">Your application needn't manually manage CPU lifetime dependencies.</span></span> <span data-ttu-id="26463-108">Ogni dispositivo figlio, ad esempio, include un riferimento sicuro al dispositivo padre.</span><span class="sxs-lookup"><span data-stu-id="26463-108">For example, every device child holds a strong reference to its parent device.</span></span>
- <span data-ttu-id="26463-109">Le dipendenze di durata tra oggetti GPU &mdash; o dipendenze che si estendono su CPU e GPU &mdash; non vengono gestite automaticamente.</span><span class="sxs-lookup"><span data-stu-id="26463-109">Lifetime dependencies between GPU objects&mdash;or dependencies that span across CPU and GPU&mdash;aren't automatically managed.</span></span> <span data-ttu-id="26463-110">È responsabilità dell'applicazione assicurarsi che le risorse GPU siano attive almeno finché tutto il lavoro che usa tale risorsa non ha completato l'esecuzione sulla GPU.</span><span class="sxs-lookup"><span data-stu-id="26463-110">It's your application's responsibility to ensure that GPU resources live at least until all work using that resource has completed execution on the GPU.</span></span>

## <a name="directml-devices"></a><span data-ttu-id="26463-111">Dispositivi DirectML</span><span class="sxs-lookup"><span data-stu-id="26463-111">DirectML devices</span></span>

<span data-ttu-id="26463-112">Il dispositivo DirectML è un oggetto factory senza stato thread-safe.</span><span class="sxs-lookup"><span data-stu-id="26463-112">The DirectML device is a thread-safe stateless factory object.</span></span> <span data-ttu-id="26463-113">Ogni dispositivo figlio (vedere [**IDMLDeviceChild**](/windows/desktop/api/directml/nn-directml-idmldevicechild)) include un riferimento sicuro al dispositivo DirectML padre (vedere [**IDMLDevice**](/windows/desktop/api/directml/nn-directml-idmldevice)).</span><span class="sxs-lookup"><span data-stu-id="26463-113">Every device child (see [**IDMLDeviceChild**](/windows/desktop/api/directml/nn-directml-idmldevicechild)) holds a strong reference to its parent DirectML device (see [**IDMLDevice**](/windows/desktop/api/directml/nn-directml-idmldevice)).</span></span> <span data-ttu-id="26463-114">Ciò significa che è sempre possibile recuperare l'interfaccia del dispositivo padre da qualsiasi interfaccia figlio del dispositivo.</span><span class="sxs-lookup"><span data-stu-id="26463-114">That means that you can always retrieve the parent device interface from any device child interface.</span></span>

<span data-ttu-id="26463-115">Un dispositivo DirectML a sua volta include un riferimento sicuro al dispositivo Direct3D 12 usato per crearlo (vedere [**ID3D12Device**](/windows/desktop/api/d3d12/nn-d3d12-id3d12device)e interfacce derivate).</span><span class="sxs-lookup"><span data-stu-id="26463-115">A DirectML device in turn holds a strong reference to the Direct3D 12 device that was used to create it (see [**ID3D12Device**](/windows/desktop/api/d3d12/nn-d3d12-id3d12device), and derived interfaces).</span></span>

<span data-ttu-id="26463-116">Poiché il dispositivo DirectML è senza stato, è implicitamente thread-safe.</span><span class="sxs-lookup"><span data-stu-id="26463-116">Because the DirectML device is stateless, it's implicitly thread-safe.</span></span> <span data-ttu-id="26463-117">È possibile chiamare i metodi sul dispositivo DirectML da più thread contemporaneamente senza la necessità di sincronizzazione esterna.</span><span class="sxs-lookup"><span data-stu-id="26463-117">You may call methods on the DirectML device from multiple threads simultaneously without the need for external synchronization.</span></span>

<span data-ttu-id="26463-118">Tuttavia, a differenza del dispositivo Direct3D 12, il dispositivo DirectML non è un oggetto singleton.</span><span class="sxs-lookup"><span data-stu-id="26463-118">However, unlike the Direct3D 12 device, the DirectML device is not a singleton object.</span></span> <span data-ttu-id="26463-119">Si è liberi di creare tutti i dispositivi DirectML desiderati.</span><span class="sxs-lookup"><span data-stu-id="26463-119">You're free to create as many DirectML devices as you wish.</span></span> <span data-ttu-id="26463-120">Tuttavia, non è possibile combinare e associare gli elementi figlio del dispositivo che appartengono a dispositivi diversi.</span><span class="sxs-lookup"><span data-stu-id="26463-120">However, you may not mix and match device children that belong to different devices.</span></span> <span data-ttu-id="26463-121">Ad esempio, [**IDMLBindingTable**](/windows/desktop/api/directml/nn-directml-idmlbindingtable) e [**IDMLCompiledOperator**](/windows/desktop/api/directml/nn-directml-idmlcompiledoperator) sono due tipi di elementi figlio (entrambe le interfacce derivano direttamente o indirettamente da **IDMLDeviceChild**).</span><span class="sxs-lookup"><span data-stu-id="26463-121">For example, [**IDMLBindingTable**](/windows/desktop/api/directml/nn-directml-idmlbindingtable) and [**IDMLCompiledOperator**](/windows/desktop/api/directml/nn-directml-idmlcompiledoperator) are two kinds of device children (both interfaces derive directly or indirectly from **IDMLDeviceChild**).</span></span> <span data-ttu-id="26463-122">E non è possibile usare una tabella di binding (**IDMLBindingTable**) per eseguire il binding per un operatore (**IDMLCompiledOperator**) se l'operatore e la tabella di associazione appartengono a diverse istanze di dispositivo DirectML.</span><span class="sxs-lookup"><span data-stu-id="26463-122">And you may not use a binding table (**IDMLBindingTable**) to bind for an operator (**IDMLCompiledOperator**) if the operator and the binding table belong to different DirectML device instances.</span></span>

<span data-ttu-id="26463-123">Poiché il dispositivo DirectML non è un singleton, la rimozione dei dispositivi viene eseguita in base ai singoli dispositivi, anziché essere un evento a livello di processo così come per un dispositivo Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="26463-123">Because the DirectML device is not a singleton, device removal occurs on a per-device basis, rather than being a process-wide event as it is for a Direct3D 12 device.</span></span> <span data-ttu-id="26463-124">Per altre informazioni, vedere [gestione degli errori e rimozione dei dispositivi in DirectML](dml-errors.md).</span><span class="sxs-lookup"><span data-stu-id="26463-124">For more information, see [Handling errors and device removal in DirectML](dml-errors.md).</span></span>

## <a name="lifetime-requirements-of-gpu-resources"></a><span data-ttu-id="26463-125">Requisiti di durata delle risorse GPU</span><span class="sxs-lookup"><span data-stu-id="26463-125">Lifetime requirements of GPU resources</span></span>

<span data-ttu-id="26463-126">Analogamente a Direct3D 12, DirectML non viene sincronizzato automaticamente tra la CPU e la GPU; né mantiene automaticamente le risorse attive mentre sono utilizzate dalla GPU.</span><span class="sxs-lookup"><span data-stu-id="26463-126">Like Direct3D 12, DirectML doesn't automatically synchronize between the CPU and GPU; nor does it automatically keep resources alive while they're in use by the GPU.</span></span> <span data-ttu-id="26463-127">Al contrario, si tratta di responsabilità dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="26463-127">Instead, these are responsibilities of your application.</span></span>

<span data-ttu-id="26463-128">Quando si esegue un elenco di comandi che contiene DirectML, l'applicazione deve garantire che le risorse GPU rimangano attive fino a quando tutto il lavoro che usa tali risorse non ha completato l'esecuzione sulla GPU.</span><span class="sxs-lookup"><span data-stu-id="26463-128">When executing a command list that contains DirectML dispatches, your application must ensure that GPU resources are kept alive until all work using those resources has completed execution on the GPU.</span></span>

<span data-ttu-id="26463-129">Nel caso di [**IDMLCommandRecorder:: RecordDispatch**](/windows/desktop/api/directml/nf-directml-idmlcommandrecorder-recorddispatch) per un operatore DirectML, che include gli oggetti seguenti.</span><span class="sxs-lookup"><span data-stu-id="26463-129">In the case of [**IDMLCommandRecorder::RecordDispatch**](/windows/desktop/api/directml/nf-directml-idmlcommandrecorder-recorddispatch) for a DirectML operator, that includes the following objects.</span></span>

- <span data-ttu-id="26463-130">[**IDMLCompiledOperator**](/windows/desktop/api/directml/nn-directml-idmlcompiledoperator) in esecuzione (o [**IDMLOperatorInitializer**](/windows/desktop/api/directml/nn-directml-idmloperatorinitializer) , se si esegue l'inizializzazione dell'operatore).</span><span class="sxs-lookup"><span data-stu-id="26463-130">The [**IDMLCompiledOperator**](/windows/desktop/api/directml/nn-directml-idmlcompiledoperator) being executed (or [**IDMLOperatorInitializer**](/windows/desktop/api/directml/nn-directml-idmloperatorinitializer) instead, if performing operator initialization).</span></span>
- <span data-ttu-id="26463-131">**IDMLCompiledOperator** che esegue il backup della tabella di associazione utilizzata per associare l'operatore.</span><span class="sxs-lookup"><span data-stu-id="26463-131">The **IDMLCompiledOperator** backing the binding table being used to bind the operator.</span></span>
- <span data-ttu-id="26463-132">Gli oggetti [**ID3D12Resource**](/windows/desktop/api/d3d12/nn-d3d12-id3d12resource) associati come input/output dell'operatore.</span><span class="sxs-lookup"><span data-stu-id="26463-132">The [**ID3D12Resource**](/windows/desktop/api/d3d12/nn-d3d12-id3d12resource) objects bound as the inputs/outputs of the operator.</span></span>
- <span data-ttu-id="26463-133">Gli oggetti **ID3D12Resource** associati come risorse permanenti e temporanee, se applicabile.</span><span class="sxs-lookup"><span data-stu-id="26463-133">The **ID3D12Resource** objects bound as persistent and temporary resources, if applicable.</span></span>
- <span data-ttu-id="26463-134">[**ID3D12CommandAllocator**](/windows/desktop/api/d3d12/nn-d3d12-id3d12commandallocator) che esegue il backup dell'elenco dei comandi.</span><span class="sxs-lookup"><span data-stu-id="26463-134">The [**ID3D12CommandAllocator**](/windows/desktop/api/d3d12/nn-d3d12-id3d12commandallocator) backing the command list itself.</span></span>

<span data-ttu-id="26463-135">Non tutte le interfacce DirectML rappresentano risorse GPU.</span><span class="sxs-lookup"><span data-stu-id="26463-135">Not all DirectML interfaces represent GPU resources.</span></span> <span data-ttu-id="26463-136">Una tabella di binding, ad esempio, *non* deve essere mantenuta attiva fino a quando tutti gli invii che lo usano non hanno completato l'esecuzione sulla GPU.</span><span class="sxs-lookup"><span data-stu-id="26463-136">For example, a binding table does *not* need to be kept alive until all dispatches using it have completed execution on the GPU.</span></span> <span data-ttu-id="26463-137">Questo perché la tabella di associazione non possiede risorse GPU.</span><span class="sxs-lookup"><span data-stu-id="26463-137">That's because the binding table itself doesn't own any GPU resources.</span></span> <span data-ttu-id="26463-138">Piuttosto, l'heap del descrittore.</span><span class="sxs-lookup"><span data-stu-id="26463-138">Rather, the descriptor heap does.</span></span> <span data-ttu-id="26463-139">Pertanto, l' *heap del descrittore* sottostante è l'oggetto che deve essere mantenuto attivo fino al completamento dell'esecuzione e non alla tabella di associazione.</span><span class="sxs-lookup"><span data-stu-id="26463-139">Therefore, the underlying *descriptor heap* is the object that must be kept alive until execution completes, and not the binding table itself.</span></span>

<span data-ttu-id="26463-140">In Direct3D 12 esiste un concetto simile.</span><span class="sxs-lookup"><span data-stu-id="26463-140">A similar concept exists in Direct3D 12.</span></span> <span data-ttu-id="26463-141">Un *allocatore* di comandi deve rimanere attivo fino a quando tutte le esecuzioni che lo usano non sono state completate sulla GPU; poiché possiede la memoria GPU.</span><span class="sxs-lookup"><span data-stu-id="26463-141">A command *allocator* must be kept alive until all executions using it have completed on the GPU; since it owns GPU memory.</span></span> <span data-ttu-id="26463-142">Tuttavia, un *elenco* di comandi non è proprietario della memoria GPU, pertanto può essere reimpostato o rilasciato non appena è stato inviato per l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="26463-142">But, a command *list* doesn't own GPU memory, so it can therefore be reset or released as soon as it's been submitted for execution.</span></span>

<span data-ttu-id="26463-143">In DirectML, gli operatori compilati ([**IDMLCompiledOperator**](/windows/desktop/api/directml/nn-directml-idmlcompiledoperator)) e gli inizializzatori di operatore ([**IDMLOperatorInitializer**](/windows/desktop/api/directml/nn-directml-idmloperatorinitializer)) possiedono direttamente risorse GPU, pertanto devono essere mantenuti attivi fino a quando tutti gli invii che li usano non hanno completato l'esecuzione sulla GPU.</span><span class="sxs-lookup"><span data-stu-id="26463-143">In DirectML, compiled operators ([**IDMLCompiledOperator**](/windows/desktop/api/directml/nn-directml-idmlcompiledoperator)) and operator initializers ([**IDMLOperatorInitializer**](/windows/desktop/api/directml/nn-directml-idmloperatorinitializer)) both own GPU resources directly, so they must be kept alive until all dispatches using them have completed execution on the GPU.</span></span> <span data-ttu-id="26463-144">Inoltre, le risorse Direct3D 12 utilizzate (allocatori di comandi, heap di descrittori, buffer come esempi) devono essere mantenute attive dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="26463-144">In addition, any Direct3D 12 resource being used (command allocators, descriptor heaps, buffers, as examples) must similarly be kept alive by your application.</span></span>

<span data-ttu-id="26463-145">Se si rilascia un oggetto in modo prematuro mentre è ancora in uso dalla GPU, il risultato è un comportamento non definito, che può causare la rimozione del dispositivo o altri errori.</span><span class="sxs-lookup"><span data-stu-id="26463-145">If you prematurely release an object while it's still in use by the GPU, the result is undefined behavior, which has the potential to cause device removal or other errors.</span></span>

## <a name="cpu-and-gpu-synchronization"></a><span data-ttu-id="26463-146">Sincronizzazione CPU e GPU</span><span class="sxs-lookup"><span data-stu-id="26463-146">CPU and GPU synchronization</span></span>

<span data-ttu-id="26463-147">DirectML non invia alcun lavoro per l'esecuzione nella GPU.</span><span class="sxs-lookup"><span data-stu-id="26463-147">DirectML doesn't itself submit any work for execution on the GPU.</span></span> <span data-ttu-id="26463-148">Al contrario, il [metodo **IDMLCommandRecorder:: RecordDispatch**](/windows/desktop/api/directml/nf-directml-idmlcommandrecorder-recorddispatch) *registra* l'invio di tale lavoro in un elenco di comandi per l'esecuzione successiva.</span><span class="sxs-lookup"><span data-stu-id="26463-148">Instead, the [**IDMLCommandRecorder::RecordDispatch** method](/windows/desktop/api/directml/nf-directml-idmlcommandrecorder-recorddispatch) *records* the dispatch of that work into a command list for later execution.</span></span> <span data-ttu-id="26463-149">L'applicazione deve quindi chiudere e inviare il proprio elenco di comandi per l'esecuzione chiamando [**ID3D12CommandQueue:: oggetti executecommandlist**](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-executecommandlists), come con qualsiasi elenco di comandi Direct3D 12.</span><span class="sxs-lookup"><span data-stu-id="26463-149">Your application must then close and submit its command list for execution by calling [**ID3D12CommandQueue::ExecuteCommandLists**](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-executecommandlists), as with any Direct3D 12 command list.</span></span>

<span data-ttu-id="26463-150">Poiché DirectML non invia alcun lavoro per l'esecuzione sulla GPU, non crea alcun limite, né esegue alcuna forma di sincronizzazione CPU/GPU per conto dell'utente.</span><span class="sxs-lookup"><span data-stu-id="26463-150">Because DirectML doesn't itself submit any work for execution on the GPU, it also doesn't create any fences, nor perform any form of CPU/GPU synchronization on your behalf.</span></span> <span data-ttu-id="26463-151">È responsabilità dell'applicazione usare le primitive Direct3D 12 appropriate per attendere il completamento dell'esecuzione del lavoro inviato sulla GPU, se necessario.</span><span class="sxs-lookup"><span data-stu-id="26463-151">It is the responsibility of your application to use the appropriate Direct3D 12 primitives to wait for submitted work to complete execution on the GPU, if necessary.</span></span> <span data-ttu-id="26463-152">Per altre informazioni, vedere [**ID3D12Fence**](/windows/desktop/api/d3d12/nn-d3d12-id3d12fence) e [**ID3D12CommandQueue:: Signal**](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-signal).</span><span class="sxs-lookup"><span data-stu-id="26463-152">For more info, see [**ID3D12Fence**](/windows/desktop/api/d3d12/nn-d3d12-id3d12fence) and [**ID3D12CommandQueue::Signal**](/windows/desktop/api/d3d12/nf-d3d12-id3d12commandqueue-signal).</span></span>

## <a name="see-also"></a><span data-ttu-id="26463-153">Vedi anche</span><span class="sxs-lookup"><span data-stu-id="26463-153">See also</span></span>

* [<span data-ttu-id="26463-154">Esecuzione e sincronizzazione degli elenchi di comandi</span><span class="sxs-lookup"><span data-stu-id="26463-154">Executing and synchronizing command lists</span></span>](/windows/desktop/direct3d12/executing-and-synchronizing-command-lists)
* [<span data-ttu-id="26463-155">Gestione degli errori e della rimozione dei dispositivi in DirectML</span><span class="sxs-lookup"><span data-stu-id="26463-155">Handling errors and device removal in DirectML</span></span>](dml-errors.md)