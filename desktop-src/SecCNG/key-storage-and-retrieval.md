---
description: CNG fornisce un modello per l'archiviazione delle chiavi private che consente di adattarsi alle esigenze attuali e future della creazione di applicazioni che utilizzano funzionalità di crittografia come la crittografia a chiave pubblica o privata, nonché le richieste di archiviazione del materiale della chiave.
ms.assetid: 95e5750f-fdc5-41f3-a4ce-9593a7081e95
title: Archiviazione e recupero delle chiavi
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 5abfd6319353440c580d53990075a71613a1eba9
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "104347756"
---
# <a name="key-storage-and-retrieval"></a><span data-ttu-id="2e8d8-103">Archiviazione e recupero delle chiavi</span><span class="sxs-lookup"><span data-stu-id="2e8d8-103">Key Storage and Retrieval</span></span>

-   [<span data-ttu-id="2e8d8-104">Architettura di archiviazione chiavi</span><span class="sxs-lookup"><span data-stu-id="2e8d8-104">Key Storage Architecture</span></span>](#key-storage-architecture)
-   [<span data-ttu-id="2e8d8-105">Tipi di chiave</span><span class="sxs-lookup"><span data-stu-id="2e8d8-105">Key Types</span></span>](#key-types)
-   [<span data-ttu-id="2e8d8-106">Algoritmi supportati</span><span class="sxs-lookup"><span data-stu-id="2e8d8-106">Supported Algorithms</span></span>](#supported-algorithms)
-   [<span data-ttu-id="2e8d8-107">Directory e file principali</span><span class="sxs-lookup"><span data-stu-id="2e8d8-107">Key Directories and Files</span></span>](#key-directories-and-files)

## <a name="key-storage-architecture"></a><span data-ttu-id="2e8d8-108">Architettura di archiviazione chiavi</span><span class="sxs-lookup"><span data-stu-id="2e8d8-108">Key Storage Architecture</span></span>

<span data-ttu-id="2e8d8-109">CNG fornisce un modello per l'archiviazione delle chiavi private che consente di adattarsi alle esigenze attuali e future della creazione di applicazioni che utilizzano funzionalità di crittografia come la crittografia a chiave pubblica o privata, nonché le richieste di archiviazione del materiale della chiave.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-109">CNG provides a model for private key storage that allows adapting to the current and future demands of creating applications that use cryptography features such as public or private key encryption, as well as the demands of the storage of key material.</span></span> <span data-ttu-id="2e8d8-110">Il router di archiviazione chiavi è la routine centrale di questo modello e viene implementato in Ncrypt.dll.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-110">The key storage router is the central routine in this model and is implemented in Ncrypt.dll.</span></span> <span data-ttu-id="2e8d8-111">Un'applicazione accede ai provider di archiviazione chiavi (KSP) nel sistema tramite il router di archiviazione chiavi, che nasconde i dettagli, ad esempio l'isolamento delle chiavi, sia dall'applicazione che dal provider di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-111">An application accesses the key storage providers (KSPs) on the system through the key storage router, which conceals details, such as key isolation, from both the application and the storage provider itself.</span></span> <span data-ttu-id="2e8d8-112">Nella figura seguente viene illustrata la progettazione e la funzione dell'architettura di isolamento delle chiavi CNG.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-112">The following illustration shows the design and function of the CNG key isolation architecture.</span></span>

![provider di archiviazione chiavi CNG](images/cng-key-storage-provider.png)

<span data-ttu-id="2e8d8-114">Per conformarsi ai requisiti di criteri comuni (CC), le chiavi di lunga durata devono essere isolate in modo che non siano mai presenti nel processo dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-114">To comply with common criteria (CC) requirements, the long-lived keys must be isolated so that they are never present in the application process.</span></span> <span data-ttu-id="2e8d8-115">CNG supporta attualmente l'archiviazione di chiavi private asimmetriche usando il provider di archiviazione chiavi software Microsoft incluso in Windows Server 2008 e Windows Vista e installato per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-115">CNG currently supports the storage of asymmetric private keys by using the Microsoft software KSP that is included with Windows Server 2008 and Windows Vista and installed by default.</span></span>

<span data-ttu-id="2e8d8-116">L'isolamento delle chiavi è abilitato per impostazione predefinita in Windows Server 2008 e Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-116">Key isolation is enabled by default in Windows Server 2008 and Windows Vista.</span></span> <span data-ttu-id="2e8d8-117">La funzionalità di isolamento delle chiavi non è disponibile sulle piattaforme precedenti.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-117">The key isolation feature is not available on platforms prior to these.</span></span> <span data-ttu-id="2e8d8-118">Inoltre, i KSP di terze parti non vengono caricati nel servizio di isolamento chiave (processo LSA).</span><span class="sxs-lookup"><span data-stu-id="2e8d8-118">Also, third party KSPs are not loaded in the key isolation service (LSA process).</span></span> <span data-ttu-id="2e8d8-119">Nel servizio di isolamento delle chiavi viene caricato solo il KSP Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-119">Only the Microsoft KSP is loaded in the key isolation service.</span></span>

<span data-ttu-id="2e8d8-120">Il processo LSA viene usato come processo di isolamento della chiave per ottimizzare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-120">The LSA process is used as the key isolation process to maximize performance.</span></span> <span data-ttu-id="2e8d8-121">Tutti gli accessi alle chiavi private passano attraverso il router di archiviazione chiavi, che espone un set completo di funzioni per la gestione e l'uso delle chiavi private.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-121">All access to private keys goes through the key storage router, which exposes a comprehensive set of functions for managing and using private keys.</span></span>

<span data-ttu-id="2e8d8-122">CNG archivia la parte pubblica della chiave archiviata separatamente dalla parte privata.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-122">CNG stores the public portion of the stored key separately from the private portion.</span></span> <span data-ttu-id="2e8d8-123">Anche la parte pubblica di una coppia di chiavi viene mantenuta nel servizio di isolamento delle chiavi ed è accessibile tramite la chiamata RPC (Remote Procedure Call) locale (LRPC).</span><span class="sxs-lookup"><span data-stu-id="2e8d8-123">The public portion of a key pair is also maintained in the key isolation service and is accessed by using local remote procedure call (LRPC).</span></span> <span data-ttu-id="2e8d8-124">Il router di archiviazione chiavi usa LRPC durante la chiamata al processo di isolamento delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-124">The key storage router uses LRPC when calling into the key isolation process.</span></span> <span data-ttu-id="2e8d8-125">Tutti gli accessi alle chiavi private passano attraverso il router di chiave privata e vengono controllati da CNG.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-125">All access to private keys goes through the private key router and is audited by CNG.</span></span>

<span data-ttu-id="2e8d8-126">Come descritto in precedenza, è possibile supportare un'ampia gamma di dispositivi di archiviazione hardware.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-126">As described above, a wide range of hardware storage devices can be supported.</span></span> <span data-ttu-id="2e8d8-127">In ogni caso, l'interfaccia per tutti questi dispositivi di archiviazione è identica.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-127">In each case, the interface to all of these storage devices is identical.</span></span> <span data-ttu-id="2e8d8-128">Include funzioni per eseguire varie operazioni di chiave privata, oltre a funzioni che riguardano l'archiviazione e la gestione delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-128">It includes functions to perform various private key operations as well as functions that pertain to key storage and management.</span></span>

<span data-ttu-id="2e8d8-129">CNG fornisce un set di API che consentono di creare, archiviare e recuperare chiavi crittografiche.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-129">CNG provides a set of APIs that are used to create, store, and retrieve cryptographic keys.</span></span> <span data-ttu-id="2e8d8-130">Per un elenco di queste API, vedere [funzioni di archiviazione delle chiavi CNG](cng-key-storage-functions.md).</span><span class="sxs-lookup"><span data-stu-id="2e8d8-130">For a list of these APIs, see [CNG Key Storage Functions](cng-key-storage-functions.md).</span></span>

## <a name="key-types"></a><span data-ttu-id="2e8d8-131">Tipi di chiave</span><span class="sxs-lookup"><span data-stu-id="2e8d8-131">Key Types</span></span>

<span data-ttu-id="2e8d8-132">CNG supporta i tipi di chiave seguenti:</span><span class="sxs-lookup"><span data-stu-id="2e8d8-132">CNG supports the following key types:</span></span>

-   <span data-ttu-id="2e8d8-133">Diffie-Hellman chiavi pubbliche e private.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-133">Diffie-Hellman public and private keys.</span></span>
-   <span data-ttu-id="2e8d8-134">Chiavi pubbliche e private con algoritmo di firma digitale (DSA, FIPS 186-2).</span><span class="sxs-lookup"><span data-stu-id="2e8d8-134">Digital Signature Algorithm (DSA, FIPS 186-2) public and private keys.</span></span>
-   <span data-ttu-id="2e8d8-135">\#Chiavi pubbliche e private RSA (PKCS 1).</span><span class="sxs-lookup"><span data-stu-id="2e8d8-135">RSA (PKCS \#1) public and private keys.</span></span>
-   <span data-ttu-id="2e8d8-136">Diverse chiavi pubbliche e private legacy (CryptoAPI).</span><span class="sxs-lookup"><span data-stu-id="2e8d8-136">Several legacy (CryptoAPI) public and private keys.</span></span>
-   <span data-ttu-id="2e8d8-137">Chiavi pubbliche e private di crittografia a curva ellittica.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-137">Elliptic Curve Cryptography public and private keys.</span></span>

## <a name="supported-algorithms"></a><span data-ttu-id="2e8d8-138">Algoritmi supportati</span><span class="sxs-lookup"><span data-stu-id="2e8d8-138">Supported Algorithms</span></span>

<span data-ttu-id="2e8d8-139">CNG supporta gli algoritmi chiave seguenti.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-139">CNG supports the following key algorithms.</span></span>

| <span data-ttu-id="2e8d8-140">Algoritmo</span><span class="sxs-lookup"><span data-stu-id="2e8d8-140">Algorithm</span></span> | <span data-ttu-id="2e8d8-141">Lunghezza chiave/hash (BITS)</span><span class="sxs-lookup"><span data-stu-id="2e8d8-141">Key/hash length (bits)</span></span>             |
|-----------|------------------------------------|
| <span data-ttu-id="2e8d8-142">RSA</span><span class="sxs-lookup"><span data-stu-id="2e8d8-142">RSA</span></span>       | <span data-ttu-id="2e8d8-143">da 512 a 16384, in incrementi di 64 bit</span><span class="sxs-lookup"><span data-stu-id="2e8d8-143">512 to 16384, in 64 bit increments</span></span> |
| <span data-ttu-id="2e8d8-144">DH</span><span class="sxs-lookup"><span data-stu-id="2e8d8-144">DH</span></span>        | <span data-ttu-id="2e8d8-145">da 512 a 16384, in incrementi di 64 bit</span><span class="sxs-lookup"><span data-stu-id="2e8d8-145">512 to 16384, in 64 bit increments</span></span> |
| <span data-ttu-id="2e8d8-146">DSA</span><span class="sxs-lookup"><span data-stu-id="2e8d8-146">DSA</span></span>       | <span data-ttu-id="2e8d8-147">da 512 a 1024, in incrementi di 64 bit</span><span class="sxs-lookup"><span data-stu-id="2e8d8-147">512 to 1024, in 64 bit increments</span></span>  |
| <span data-ttu-id="2e8d8-148">ECDSA</span><span class="sxs-lookup"><span data-stu-id="2e8d8-148">ECDSA</span></span>     | <span data-ttu-id="2e8d8-149">P-256, P-384, P-521 (curve NIST)</span><span class="sxs-lookup"><span data-stu-id="2e8d8-149">P-256, P-384, P-521 (NIST Curves)</span></span>  |
| <span data-ttu-id="2e8d8-150">ECDH</span><span class="sxs-lookup"><span data-stu-id="2e8d8-150">ECDH</span></span>      | <span data-ttu-id="2e8d8-151">P-256, P-384, P-521 (curve NIST)</span><span class="sxs-lookup"><span data-stu-id="2e8d8-151">P-256, P-384, P-521 (NIST Curves)</span></span>  |
| <span data-ttu-id="2e8d8-152">MD2</span><span class="sxs-lookup"><span data-stu-id="2e8d8-152">MD2</span></span>       | <span data-ttu-id="2e8d8-153">128</span><span class="sxs-lookup"><span data-stu-id="2e8d8-153">128</span></span>                                |
| <span data-ttu-id="2e8d8-154">MD4</span><span class="sxs-lookup"><span data-stu-id="2e8d8-154">MD4</span></span>       | <span data-ttu-id="2e8d8-155">128</span><span class="sxs-lookup"><span data-stu-id="2e8d8-155">128</span></span>                                |
| <span data-ttu-id="2e8d8-156">MD5</span><span class="sxs-lookup"><span data-stu-id="2e8d8-156">MD5</span></span>       | <span data-ttu-id="2e8d8-157">128</span><span class="sxs-lookup"><span data-stu-id="2e8d8-157">128</span></span>                                |
| <span data-ttu-id="2e8d8-158">SHA-1</span><span class="sxs-lookup"><span data-stu-id="2e8d8-158">SHA-1</span></span>     | <span data-ttu-id="2e8d8-159">160</span><span class="sxs-lookup"><span data-stu-id="2e8d8-159">160</span></span>                                |
| <span data-ttu-id="2e8d8-160">SHA-256</span><span class="sxs-lookup"><span data-stu-id="2e8d8-160">SHA-256</span></span>   | <span data-ttu-id="2e8d8-161">256</span><span class="sxs-lookup"><span data-stu-id="2e8d8-161">256</span></span>                                |
| <span data-ttu-id="2e8d8-162">SHA-384</span><span class="sxs-lookup"><span data-stu-id="2e8d8-162">SHA-384</span></span>   | <span data-ttu-id="2e8d8-163">384</span><span class="sxs-lookup"><span data-stu-id="2e8d8-163">384</span></span>                                |
| <span data-ttu-id="2e8d8-164">SHA-512</span><span class="sxs-lookup"><span data-stu-id="2e8d8-164">SHA-512</span></span>   | <span data-ttu-id="2e8d8-165">512</span><span class="sxs-lookup"><span data-stu-id="2e8d8-165">512</span></span>                                |



 

## <a name="key-directories-and-files"></a><span data-ttu-id="2e8d8-166">Directory e file principali</span><span class="sxs-lookup"><span data-stu-id="2e8d8-166">Key Directories and Files</span></span>

<span data-ttu-id="2e8d8-167">I CSP Microsoft CryptoAPI legacy archiviano le chiavi private nelle directory seguenti.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-167">The Microsoft legacy CryptoAPI CSPs store private keys in the following directories.</span></span>

| <span data-ttu-id="2e8d8-168">Tipo di chiave</span><span class="sxs-lookup"><span data-stu-id="2e8d8-168">Key type</span></span>                | <span data-ttu-id="2e8d8-169">Directory</span><span class="sxs-lookup"><span data-stu-id="2e8d8-169">Directories</span></span>                                                                                                                                                 |
|-------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="2e8d8-170">Utente privato</span><span class="sxs-lookup"><span data-stu-id="2e8d8-170">User private</span></span>            | <span data-ttu-id="2e8d8-171">% APPDATA% \\ Microsoft \\ Crypto \\ RSA \\ *utente SID*</span><span class="sxs-lookup"><span data-stu-id="2e8d8-171">%APPDATA%\\Microsoft\\Crypto\\RSA\\*User SID*</span></span>\\<br/><span data-ttu-id="2e8d8-172">% APPDATA% \\ Microsoft \\ Crypto \\ DSS \\ *utente SID*</span><span class="sxs-lookup"><span data-stu-id="2e8d8-172">%APPDATA%\\Microsoft\\Crypto\\DSS\\*User SID*</span></span>\\<br/>                                                   |
| <span data-ttu-id="2e8d8-173">Privato sistema locale</span><span class="sxs-lookup"><span data-stu-id="2e8d8-173">Local system private</span></span>    | <span data-ttu-id="2e8d8-174">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ Crypto \\ RSA \\ S-1-5-18</span><span class="sxs-lookup"><span data-stu-id="2e8d8-174">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-18</span></span>\\<br/><span data-ttu-id="2e8d8-175">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ Crypto \\ DSS \\ S-1-5-18</span><span class="sxs-lookup"><span data-stu-id="2e8d8-175">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-18</span></span>\\<br/>   |
| <span data-ttu-id="2e8d8-176">Servizio locale privato</span><span class="sxs-lookup"><span data-stu-id="2e8d8-176">Local service private</span></span>   | <span data-ttu-id="2e8d8-177">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ Crypto \\ RSA \\ S-1-5-19</span><span class="sxs-lookup"><span data-stu-id="2e8d8-177">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-19</span></span>\\<br/><span data-ttu-id="2e8d8-178">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ Crypto \\ DSS \\ S-1-5-19</span><span class="sxs-lookup"><span data-stu-id="2e8d8-178">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-19</span></span>\\<br/>   |
| <span data-ttu-id="2e8d8-179">Servizio di rete privato</span><span class="sxs-lookup"><span data-stu-id="2e8d8-179">Network service private</span></span> | <span data-ttu-id="2e8d8-180">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ Crypto \\ RSA \\ S-1-5-20</span><span class="sxs-lookup"><span data-stu-id="2e8d8-180">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\S-1-5-20</span></span>\\<br/><span data-ttu-id="2e8d8-181">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ Crypto \\ DSS \\ S-1-5-20</span><span class="sxs-lookup"><span data-stu-id="2e8d8-181">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\S-1-5-20</span></span>\\<br/>   |
| <span data-ttu-id="2e8d8-182">Privato condiviso</span><span class="sxs-lookup"><span data-stu-id="2e8d8-182">Shared private</span></span>          | <span data-ttu-id="2e8d8-183">% ALLUSERSPROFILE% \\ dati applicazione \\ Microsoft \\ Crypto \\ RSA \\ MachineKeys</span><span class="sxs-lookup"><span data-stu-id="2e8d8-183">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\RSA\\MachineKeys</span></span><br/><span data-ttu-id="2e8d8-184">% ALLUSERSPROFILE% \\ Application Data \\ Microsoft \\ Crypto \\ DSS, \\ MachineKeys</span><span class="sxs-lookup"><span data-stu-id="2e8d8-184">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\DSS\\MachineKeys</span></span><br/> |



 

<span data-ttu-id="2e8d8-185">CNG archivia le chiavi private nelle directory seguenti.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-185">CNG stores private keys in the following directories.</span></span>

| <span data-ttu-id="2e8d8-186">Tipo di chiave</span><span class="sxs-lookup"><span data-stu-id="2e8d8-186">Key type</span></span>                | <span data-ttu-id="2e8d8-187">Directory</span><span class="sxs-lookup"><span data-stu-id="2e8d8-187">Directory</span></span>                                                          |
|-------------------------|--------------------------------------------------------------------|
| <span data-ttu-id="2e8d8-188">Utente privato</span><span class="sxs-lookup"><span data-stu-id="2e8d8-188">User private</span></span>            | <span data-ttu-id="2e8d8-189">% APPDATA% \\ Microsoft \\ Crypto \\ chiavi</span><span class="sxs-lookup"><span data-stu-id="2e8d8-189">%APPDATA%\\Microsoft\\Crypto\\Keys</span></span>                                 |
| <span data-ttu-id="2e8d8-190">Privato sistema locale</span><span class="sxs-lookup"><span data-stu-id="2e8d8-190">Local system private</span></span>    | <span data-ttu-id="2e8d8-191">% ALLUSERSPROFILE% \\ dati applicazione \\ Microsoft \\ Crypto \\ SystemKeys</span><span class="sxs-lookup"><span data-stu-id="2e8d8-191">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\SystemKeys</span></span> |
| <span data-ttu-id="2e8d8-192">Servizio locale privato</span><span class="sxs-lookup"><span data-stu-id="2e8d8-192">Local service private</span></span>   | <span data-ttu-id="2e8d8-193">% WINDIR% \\ ServiceProfiles \\ LocalService</span><span class="sxs-lookup"><span data-stu-id="2e8d8-193">%WINDIR%\\ServiceProfiles\\LocalService</span></span>                            |
| <span data-ttu-id="2e8d8-194">Servizio di rete privato</span><span class="sxs-lookup"><span data-stu-id="2e8d8-194">Network service private</span></span> | <span data-ttu-id="2e8d8-195">% WINDIR% \\ ServiceProfiles \\ NetworkService</span><span class="sxs-lookup"><span data-stu-id="2e8d8-195">%WINDIR%\\ServiceProfiles\\NetworkService</span></span>                          |
| <span data-ttu-id="2e8d8-196">Privato condiviso</span><span class="sxs-lookup"><span data-stu-id="2e8d8-196">Shared private</span></span>          | <span data-ttu-id="2e8d8-197">% ALLUSERSPROFILE% \\ dati applicazione \\ Microsoft \\ Crypto \\ Keys</span><span class="sxs-lookup"><span data-stu-id="2e8d8-197">%ALLUSERSPROFILE%\\Application Data\\Microsoft\\Crypto\\Keys</span></span>       |



 

<span data-ttu-id="2e8d8-198">Di seguito sono riportate alcune delle differenze tra i contenitori di chiavi CryptoAPI e CNG.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-198">The following are some of the differences between the CryptoAPI and CNG key containers.</span></span>

-   <span data-ttu-id="2e8d8-199">CNG utilizza nomi file diversi per i file di chiave rispetto ai file di chiave creati dal Rsaenh.dll e Dssenh.dll CSP legacy.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-199">CNG uses different file names for key files than key files that are created by the Rsaenh.dll and Dssenh.dll legacy CSPs.</span></span> <span data-ttu-id="2e8d8-200">Anche i file di chiave legacy hanno estensione. Key, ma i file di chiave CNG non hanno l'estensione. Key.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-200">The legacy key files also have the .key extension, but CNG key files do not have the .key extension.</span></span>
-   <span data-ttu-id="2e8d8-201">CNG supporta completamente i nomi dei contenitori di chiavi Unicode. CNG usa un hash del nome del contenitore Unicode, mentre CryptoAPI usa un hash del nome del contenitore ANSI.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-201">CNG fully supports Unicode key container names; CNG uses a hash of the Unicode container name, whereas CryptoAPI uses a hash of the ANSI container name.</span></span>
-   <span data-ttu-id="2e8d8-202">CNG è più flessibile per quanto riguarda le coppie di chiavi RSA.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-202">CNG is more flexible with regard to RSA key pairs.</span></span> <span data-ttu-id="2e8d8-203">Ad esempio, CNG supporta gli esponenti pubblici con una lunghezza superiore a 32 bit e supporta le chiavi in cui p e q sono lunghezze diverse.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-203">For example, CNG supports public exponents larger than 32-bits in length, and it supports keys in which p and q are different lengths.</span></span>
-   <span data-ttu-id="2e8d8-204">In CryptoAPI il file contenitore di chiavi viene archiviato in una directory il cui nome è l'equivalente testuale del SID dell'utente.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-204">In CryptoAPI, the key container file is stored in a directory whose name is the textual equivalent of the user's SID.</span></span> <span data-ttu-id="2e8d8-205">Questo non è più il caso in CNG, che elimina la difficoltà di trasferire gli utenti da un dominio a un altro senza perdere tutte le chiavi private.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-205">This is no longer the case in CNG, which removes the difficulty of moving users from one domain to another without losing all of their private keys.</span></span>
-   <span data-ttu-id="2e8d8-206">Il provider di archiviazione chiavi e i nomi delle chiavi CNG sono limitati ai caratteri Unicode del **\_ percorso massimo** .</span><span class="sxs-lookup"><span data-stu-id="2e8d8-206">The CNG KSP and key names are limited to **MAX\_PATH** Unicode characters.</span></span> <span data-ttu-id="2e8d8-207">Il CSP CryptoAPI e i nomi delle chiavi sono limitati ai caratteri ANSI del **\_ percorso massimo** .</span><span class="sxs-lookup"><span data-stu-id="2e8d8-207">The CryptoAPI CSP and key names are limited to **MAX\_PATH** ANSI characters.</span></span>
-   <span data-ttu-id="2e8d8-208">CNG offre la funzionalità delle proprietà chiave definite dall'utente.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-208">CNG offers the capability of user-defined key properties.</span></span> <span data-ttu-id="2e8d8-209">Gli utenti possono creare e associare proprietà personalizzate con chiavi e archiviarle con chiavi salvate in modo permanente.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-209">Users can create and associate custom properties with keys, and have them stored with persisted keys.</span></span>

<span data-ttu-id="2e8d8-210">Quando si rende permanente una chiave, CNG può creare due file.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-210">When persisting a key, CNG can create two files.</span></span> <span data-ttu-id="2e8d8-211">Il primo file contiene la chiave privata nel nuovo formato CNG e viene sempre creato.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-211">The first file contains the private key in the new CNG format and is always created.</span></span> <span data-ttu-id="2e8d8-212">Il file non può essere utilizzato dai DSN CryptoAPI legacy.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-212">This file is not usable by the legacy CryptoAPI CSPs.</span></span> <span data-ttu-id="2e8d8-213">Il secondo file contiene la stessa chiave privata nel contenitore di chiavi CryptoAPI legacy.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-213">The second file contains the same private key in the legacy CryptoAPI key container.</span></span> <span data-ttu-id="2e8d8-214">Il secondo file è conforme al formato e alla posizione utilizzati dalla Rsaenh.dll.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-214">The second file conforms to the format and location used by Rsaenh.dll.</span></span> <span data-ttu-id="2e8d8-215">La creazione del secondo file si verifica solo se viene specificato il flag **NCRYPT \_ Write \_ Key \_ to \_ legacy \_ Store \_ flag** quando viene chiamata la funzione [**NCryptFinalizeKey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptfinalizekey) per finalizzare una chiave RSA.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-215">Creation of the second file only occurs if the **NCRYPT\_WRITE\_KEY\_TO\_LEGACY\_STORE\_FLAG** flag is specified when the [**NCryptFinalizeKey**](/windows/desktop/api/Ncrypt/nf-ncrypt-ncryptfinalizekey) function is called to finalize an RSA key.</span></span> <span data-ttu-id="2e8d8-216">Questa funzionalità non è supportata per le chiavi DSA e DH.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-216">This feature is not supported for DSA and DH keys.</span></span>

<span data-ttu-id="2e8d8-217">Quando un'applicazione tenta di aprire una chiave permanente esistente, CNG tenta innanzitutto di aprire il file CNG nativo.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-217">When an application attempts to open an existing persisted key, CNG first attempts to open the native CNG file.</span></span> <span data-ttu-id="2e8d8-218">Se il file non esiste, CNG tenta di individuare una chiave corrispondente nel contenitore di chiavi CryptoAPI legacy.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-218">If this file does not exist, then CNG attempts to locate a matching key in the legacy CryptoAPI key container.</span></span>

<span data-ttu-id="2e8d8-219">Quando si spostano o si copiano le chiavi CryptoAPI da una macchina di origine a un computer di destinazione con Utilità di migrazione stato utente Windows (USMT), CNG non riuscirà ad accedere alle chiavi nel computer di destinazione.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-219">When you move or copy CryptoAPI keys from a source machine to a target machine with Windows User State Migration Tool (USMT), CNG will fail to access the keys on the target machine.</span></span> <span data-ttu-id="2e8d8-220">Per accedere a tali chiavi migrate, è necessario usare CryptoAPI.</span><span class="sxs-lookup"><span data-stu-id="2e8d8-220">To access such migrated keys, you must use the CryptoAPI.</span></span>

 

 




