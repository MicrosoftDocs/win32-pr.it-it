---
description: L'API CNG implementa un modello di provider estendibile che consente di caricare un provider specificando l'algoritmo di crittografia necessario anziché un provider specifico.
ms.assetid: a88a089b-4afe-4201-96f7-97f19bce18a1
title: Programmazione CNG tipica
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1119da63ca1ea0613444b150914c06664f36c121
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103751658"
---
# <a name="typical-cng-programming"></a><span data-ttu-id="29bf2-103">Programmazione CNG tipica</span><span class="sxs-lookup"><span data-stu-id="29bf2-103">Typical CNG Programming</span></span>

<span data-ttu-id="29bf2-104">L'API CNG implementa un modello di provider estendibile che consente di caricare un provider specificando l'algoritmo di crittografia necessario anziché un provider specifico.</span><span class="sxs-lookup"><span data-stu-id="29bf2-104">The CNG API implements an extensible provider model that lets you load a provider by specifying the required cryptographic algorithm rather than a particular provider.</span></span> <span data-ttu-id="29bf2-105">Il vantaggio è che un provider di algoritmi può essere sostituito o aggiornato e non sarà necessario modificare il codice in alcun modo per usare il nuovo provider.</span><span class="sxs-lookup"><span data-stu-id="29bf2-105">The advantage is that an algorithm provider can be replaced or upgraded and you will not have to change your code in any way to use the new provider.</span></span> <span data-ttu-id="29bf2-106">Inoltre, se in futuro è stato determinato un algoritmo non sicuro, è possibile installare una versione più sicura di tale algoritmo senza influire sul codice.</span><span class="sxs-lookup"><span data-stu-id="29bf2-106">Also, if some algorithm is determined to be unsafe in the future, a more secure version of that algorithm can be installed without affecting your code.</span></span> <span data-ttu-id="29bf2-107">La maggior parte delle API CNG richiede un provider o un oggetto creato da un provider.</span><span class="sxs-lookup"><span data-stu-id="29bf2-107">Most of the CNG APIs require a provider or an object created by a provider.</span></span>

<span data-ttu-id="29bf2-108">I passaggi tipici per l'uso dell'API CNG per le operazioni primitive crittografiche sono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="29bf2-108">The typical steps involved in using the CNG API for cryptographic primitive operations are as follows:</span></span>

1.  <span data-ttu-id="29bf2-109">Apertura del provider di algoritmi</span><span class="sxs-lookup"><span data-stu-id="29bf2-109">Opening the Algorithm Provider</span></span>
2.  <span data-ttu-id="29bf2-110">Recupero o impostazione delle proprietà degli algoritmi</span><span class="sxs-lookup"><span data-stu-id="29bf2-110">Getting or Setting Algorithm Properties</span></span>
3.  <span data-ttu-id="29bf2-111">Creazione o importazione di una chiave</span><span class="sxs-lookup"><span data-stu-id="29bf2-111">Creating or Importing a Key</span></span>
4.  <span data-ttu-id="29bf2-112">Esecuzione di operazioni di crittografia</span><span class="sxs-lookup"><span data-stu-id="29bf2-112">Performing Cryptographic Operations</span></span>
5.  <span data-ttu-id="29bf2-113">Chiusura del provider di algoritmi</span><span class="sxs-lookup"><span data-stu-id="29bf2-113">Closing the Algorithm Provider</span></span>

<span data-ttu-id="29bf2-114">Per ulteriori informazioni, vedere esempi di programmazione.</span><span class="sxs-lookup"><span data-stu-id="29bf2-114">For more information, see Programming Examples.</span></span>

## <a name="opening-the-algorithm-provider"></a><span data-ttu-id="29bf2-115">Apertura del provider di algoritmi</span><span class="sxs-lookup"><span data-stu-id="29bf2-115">Opening the Algorithm Provider</span></span>

<span data-ttu-id="29bf2-116">La funzione [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) fornisce un handle del provider di algoritmi usato nelle API CNG successive, ad esempio [**BCryptCreateHash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) o [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).</span><span class="sxs-lookup"><span data-stu-id="29bf2-116">The [**BCryptOpenAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptopenalgorithmprovider) function provides you with an algorithm provider handle that is used in subsequent CNG APIs, such as [**BCryptCreateHash**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptcreatehash) or [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair).</span></span>

## <a name="getting-or-setting-algorithm-properties"></a><span data-ttu-id="29bf2-117">Recupero o impostazione delle proprietà degli algoritmi</span><span class="sxs-lookup"><span data-stu-id="29bf2-117">Getting or Setting Algorithm Properties</span></span>

<span data-ttu-id="29bf2-118">È possibile usare l'handle del provider dell'algoritmo per ottenere i dettagli di implementazione per l'algoritmo, ad esempio la dimensione della chiave o la modalità operativa corrente.</span><span class="sxs-lookup"><span data-stu-id="29bf2-118">You can use the algorithm provider handle to get implementation details for the algorithm, such as the key size or the current mode of operation.</span></span> <span data-ttu-id="29bf2-119">Usare la funzione [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) per ottenere proprietà specifiche.</span><span class="sxs-lookup"><span data-stu-id="29bf2-119">You use the [**BCryptGetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgetproperty) function to obtain specific properties.</span></span>

<span data-ttu-id="29bf2-120">È inoltre possibile modificare le proprietà dell'algoritmo.</span><span class="sxs-lookup"><span data-stu-id="29bf2-120">You can also modify the properties of the algorithm.</span></span> <span data-ttu-id="29bf2-121">Se, ad esempio, si vuole usare il concatenamento di crittografia a blocchi ECB con AES, impostare la proprietà **\_ \_ modalità di concatenamento di BCRYPT** di un algoritmo AES su **BCRYPT \_ Chain \_ mode \_ BCE**; la proprietà viene assegnata a tutte le chiavi AES create usando questo handle dell'algoritmo, senza la necessità di configurare ogni chiave AES.</span><span class="sxs-lookup"><span data-stu-id="29bf2-121">For example, If you want to use ECB block cipher chaining with AES, you set the **BCRYPT\_CHAINING\_MODE** property of an AES algorithm to **BCRYPT\_CHAIN\_MODE\_ECB**; the property is assigned to all AES keys created using this algorithm handle, without the need to configure each and every AES key.</span></span> <span data-ttu-id="29bf2-122">Per modificare queste proprietà, usare la funzione [**BCryptSetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) .</span><span class="sxs-lookup"><span data-stu-id="29bf2-122">You use the [**BCryptSetProperty**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptsetproperty) function to modify these properties.</span></span>

## <a name="creating-or-importing-a-key"></a><span data-ttu-id="29bf2-123">Creazione o importazione di una chiave</span><span class="sxs-lookup"><span data-stu-id="29bf2-123">Creating or Importing a Key</span></span>

<span data-ttu-id="29bf2-124">A seconda del tipo di algoritmo utilizzato, potrebbe essere necessario creare o caricare una chiave.</span><span class="sxs-lookup"><span data-stu-id="29bf2-124">Depending on the type of algorithm you use, you may need to create or load a key.</span></span> <span data-ttu-id="29bf2-125">Ad esempio, la funzione [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) accetta un handle di chiave per il primo parametro.</span><span class="sxs-lookup"><span data-stu-id="29bf2-125">For example, the [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) function takes a key handle for the first parameter.</span></span> <span data-ttu-id="29bf2-126">Se si desidera che la funzione crittografa i dati con un algoritmo di crittografia simmetrica, ad esempio AES, è necessario innanzitutto ottenere una chiave.</span><span class="sxs-lookup"><span data-stu-id="29bf2-126">If you want that function to encrypt data with a symmetric encryption algorithm such as AES, you must first obtain a key.</span></span> <span data-ttu-id="29bf2-127">Il modo in cui si ottiene la chiave dipende dal tipo di algoritmo utilizzato e dall'origine della chiave.</span><span class="sxs-lookup"><span data-stu-id="29bf2-127">How you obtain the key depends on the type of algorithm being used and the source of the key.</span></span>

<span data-ttu-id="29bf2-128">È possibile creare chiavi effimere con le funzioni [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) e [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) .</span><span class="sxs-lookup"><span data-stu-id="29bf2-128">You can create ephemeral keys with the [**BCryptGenerateSymmetricKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratesymmetrickey) and [**BCryptGenerateKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptgeneratekeypair) functions.</span></span> <span data-ttu-id="29bf2-129">È anche possibile importare chiavi effimere da un BLOB di memoria con le funzioni [**BCryptImportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) e [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) .</span><span class="sxs-lookup"><span data-stu-id="29bf2-129">You can also import ephemeral keys from a memory BLOB with the [**BCryptImportKey**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkey) and [**BCryptImportKeyPair**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptimportkeypair) functions.</span></span>

<span data-ttu-id="29bf2-130">Per le chiavi salvate in modo permanente, usare le funzioni di archiviazione chiavi per caricare un provider di archiviazione chiavi e quindi creare o caricare le chiavi.</span><span class="sxs-lookup"><span data-stu-id="29bf2-130">For persisted keys, you use the key storage functions to load a key storage provider, and then create or load the keys.</span></span> <span data-ttu-id="29bf2-131">È anche possibile usare queste funzioni per creare o caricare chiavi effimere passando **null** per i nomi dei contenitori.</span><span class="sxs-lookup"><span data-stu-id="29bf2-131">You can also use these functions to create or load ephemeral keys by passing **NULL** for any container names.</span></span> <span data-ttu-id="29bf2-132">Per altre informazioni sulle funzioni di archiviazione delle chiavi, vedere [funzioni di archiviazione delle chiavi CNG](cng-key-storage-functions.md).</span><span class="sxs-lookup"><span data-stu-id="29bf2-132">For more information about the key storage functions, see [CNG Key Storage Functions](cng-key-storage-functions.md).</span></span>

## <a name="performing-cryptographic-operations"></a><span data-ttu-id="29bf2-133">Esecuzione di operazioni di crittografia</span><span class="sxs-lookup"><span data-stu-id="29bf2-133">Performing Cryptographic Operations</span></span>

<span data-ttu-id="29bf2-134">A questo punto è possibile eseguire l'operazione di crittografia, ad esempio crittografare o decrittografare i dati usando rispettivamente le funzioni [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) o [**BCryptDecrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) .</span><span class="sxs-lookup"><span data-stu-id="29bf2-134">You are now ready to perform the cryptographic operation, such as encrypting or decrypting data by using the [**BCryptEncrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptencrypt) or [**BCryptDecrypt**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptdecrypt) functions, respectively.</span></span>

## <a name="closing-the-algorithm-provider"></a><span data-ttu-id="29bf2-135">Chiusura del provider di algoritmi</span><span class="sxs-lookup"><span data-stu-id="29bf2-135">Closing the Algorithm Provider</span></span>

<span data-ttu-id="29bf2-136">Quando il provider non è più necessario, è necessario passare l'handle alla funzione [**BCryptCloseAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) per chiudere il provider.</span><span class="sxs-lookup"><span data-stu-id="29bf2-136">When the provider is no longer needed, you must pass the handle to the [**BCryptCloseAlgorithmProvider**](/windows/desktop/api/Bcrypt/nf-bcrypt-bcryptclosealgorithmprovider) function to close the provider.</span></span> <span data-ttu-id="29bf2-137">In questo modo il provider rilascia tutte le risorse allocate per l'istanza del provider dell'algoritmo.</span><span class="sxs-lookup"><span data-stu-id="29bf2-137">This causes the provider to release any resources that have been allocated for that algorithm provider instance.</span></span> <span data-ttu-id="29bf2-138">Una volta chiuso, un handle del provider non può essere riutilizzato.</span><span class="sxs-lookup"><span data-stu-id="29bf2-138">After a provider handle is closed, it cannot be reused.</span></span>

<span data-ttu-id="29bf2-139">Il caricamento di un provider può essere un processo relativamente lungo.</span><span class="sxs-lookup"><span data-stu-id="29bf2-139">Loading a provider can be a relatively time-intensive process.</span></span> <span data-ttu-id="29bf2-140">È pertanto necessario memorizzare nella cache tutti gli handle del provider a cui si fa riferimento più volte nel corso della durata dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="29bf2-140">You should therefore cache any provider handles that you will reference multiple times during the lifetime of your application.</span></span>

## <a name="programming-examples"></a><span data-ttu-id="29bf2-141">Esempi di programmazione</span><span class="sxs-lookup"><span data-stu-id="29bf2-141">Programming Examples</span></span>

<span data-ttu-id="29bf2-142">Negli esempi seguenti viene descritto come eseguire operazioni di crittografia specifiche utilizzando CNG.</span><span class="sxs-lookup"><span data-stu-id="29bf2-142">The following examples describe how to perform specific cryptographic operations using CNG.</span></span>

-   [<span data-ttu-id="29bf2-143">Creazione di un hash con CNG</span><span class="sxs-lookup"><span data-stu-id="29bf2-143">Creating a Hash with CNG</span></span>](creating-a-hash-with-cng.md)
-   [<span data-ttu-id="29bf2-144">Firma di dati con CNG</span><span class="sxs-lookup"><span data-stu-id="29bf2-144">Signing Data with CNG</span></span>](signing-data-with-cng.md)
-   [<span data-ttu-id="29bf2-145">Crittografia dei dati con CNG</span><span class="sxs-lookup"><span data-stu-id="29bf2-145">Encrypting Data with CNG</span></span>](encrypting-data-with-cng.md)

 

 



