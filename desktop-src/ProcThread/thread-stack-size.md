---
description: Ogni nuovo thread o Fiber riceve il proprio spazio dello stack costituito da memoria riservata e inizialmente vincolata.
ms.assetid: abb2d5c1-040b-4c36-aae5-3517b6a8c540
title: Dimensioni dello stack di thread
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f4204e0bffa13fb43b6ea9520b60c0505372bad6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "103967675"
---
# <a name="thread-stack-size"></a><span data-ttu-id="2313b-103">Dimensioni dello stack di thread</span><span class="sxs-lookup"><span data-stu-id="2313b-103">Thread Stack Size</span></span>

<span data-ttu-id="2313b-104">Ogni nuovo thread o Fiber riceve il proprio spazio dello stack costituito da memoria riservata e inizialmente vincolata.</span><span class="sxs-lookup"><span data-stu-id="2313b-104">Each new thread or fiber receives its own stack space consisting of both reserved and initially committed memory.</span></span> <span data-ttu-id="2313b-105">La dimensione della memoria riservata rappresenta l'allocazione totale dello stack nella memoria virtuale.</span><span class="sxs-lookup"><span data-stu-id="2313b-105">The reserved memory size represents the total stack allocation in virtual memory.</span></span> <span data-ttu-id="2313b-106">Di conseguenza, le dimensioni riservate sono limitate all'intervallo di indirizzi virtuali.</span><span class="sxs-lookup"><span data-stu-id="2313b-106">As such, the reserved size is limited to the virtual address range.</span></span> <span data-ttu-id="2313b-107">Le pagine inizialmente sottoposte a commit non utilizzano la memoria fisica finché non vi viene fatto riferimento; Tuttavia, le pagine vengono rimosse dal limite totale di commit del sistema, ovvero dalla dimensione del file di paging più le dimensioni della memoria fisica.</span><span class="sxs-lookup"><span data-stu-id="2313b-107">The initially committed pages do not utilize physical memory until they are referenced; however, they do remove pages from the system total commit limit, which is the size of the page file plus the size of the physical memory.</span></span> <span data-ttu-id="2313b-108">Il sistema esegue il commit di pagine aggiuntive dalla memoria dello stack riservata quando sono necessarie, fino a quando lo stack non raggiunge le dimensioni riservate meno una pagina (che viene usata come pagina di protezione per evitare l'overflow dello stack) o la memoria del sistema è insufficiente in caso di errore dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="2313b-108">The system commits additional pages from the reserved stack memory as they are needed, until either the stack reaches the reserved size minus one page (which is used as a guard page to prevent stack overflow) or the system is so low on memory that the operation fails.</span></span>

<span data-ttu-id="2313b-109">È preferibile scegliere il minor numero possibile di dimensioni dello stack ed eseguire il commit dello stack necessario affinché il thread o Fiber venga eseguito in modo affidabile.</span><span class="sxs-lookup"><span data-stu-id="2313b-109">It is best to choose as small a stack size as possible and commit the stack that is needed for the thread or fiber to run reliably.</span></span> <span data-ttu-id="2313b-110">Ogni pagina riservata per lo stack non può essere usata per altri scopi.</span><span class="sxs-lookup"><span data-stu-id="2313b-110">Every page that is reserved for the stack cannot be used for any other purpose.</span></span>

<span data-ttu-id="2313b-111">Uno stack viene liberato alla chiusura del thread.</span><span class="sxs-lookup"><span data-stu-id="2313b-111">A stack is freed when its thread exits.</span></span> <span data-ttu-id="2313b-112">Non viene liberato se il thread viene terminato da un altro thread.</span><span class="sxs-lookup"><span data-stu-id="2313b-112">It is not freed if the thread is terminated by another thread.</span></span>

<span data-ttu-id="2313b-113">Le dimensioni predefinite per la memoria dello stack riservata e inizialmente sottoposta a commit sono specificate nell'intestazione del file eseguibile.</span><span class="sxs-lookup"><span data-stu-id="2313b-113">The default size for the reserved and initially committed stack memory is specified in the executable file header.</span></span> <span data-ttu-id="2313b-114">La creazione di thread o Fiber ha esito negativo se non è disponibile memoria sufficiente per riservare o eseguire il commit del numero di byte richiesti.</span><span class="sxs-lookup"><span data-stu-id="2313b-114">Thread or fiber creation fails if there is not enough memory to reserve or commit the number of bytes requested.</span></span> <span data-ttu-id="2313b-115">Le dimensioni di prenotazione dello stack predefinite usate dal linker sono pari a 1 MB.</span><span class="sxs-lookup"><span data-stu-id="2313b-115">The default stack reservation size used by the linker is 1 MB.</span></span> <span data-ttu-id="2313b-116">Per specificare una dimensione di prenotazione dello stack predefinita diversa per tutti i thread e i fiber, utilizzare l'istruzione STACKSIZE nel file di definizione del modulo (con estensione def).</span><span class="sxs-lookup"><span data-stu-id="2313b-116">To specify a different default stack reservation size for all threads and fibers, use the STACKSIZE statement in the module definition (.def) file.</span></span> <span data-ttu-id="2313b-117">Il sistema operativo arrotonda la dimensione specificata al multiplo più vicino della granularità di allocazione del sistema, in genere 64 KB.</span><span class="sxs-lookup"><span data-stu-id="2313b-117">The operating system rounds up the specified size to the nearest multiple of the system's allocation granularity (typically 64 KB).</span></span> <span data-ttu-id="2313b-118">Per recuperare la granularità di allocazione del sistema corrente, utilizzare la funzione [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) .</span><span class="sxs-lookup"><span data-stu-id="2313b-118">To retrieve the allocation granularity of the current system, use the [**GetSystemInfo**](/windows/win32/api/sysinfoapi/nf-sysinfoapi-getsysteminfo) function.</span></span>

<span data-ttu-id="2313b-119">Per modificare lo spazio dello stack inizialmente sottoposto a commit, usare il parametro *dwStackSize* della funzione [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread)o [**CreateFiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) .</span><span class="sxs-lookup"><span data-stu-id="2313b-119">To change the initially committed stack space, use the *dwStackSize* parameter of the [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread), or [**CreateFiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) function.</span></span> <span data-ttu-id="2313b-120">Questo valore viene arrotondato per eccesso alla pagina più vicina.</span><span class="sxs-lookup"><span data-stu-id="2313b-120">This value is rounded up to the nearest page.</span></span> <span data-ttu-id="2313b-121">In genere, la dimensione della riserva è la dimensione di riserva predefinita specificata nell'intestazione eseguibile.</span><span class="sxs-lookup"><span data-stu-id="2313b-121">Generally, the reserve size is the default reserve size specified in the executable header.</span></span> <span data-ttu-id="2313b-122">Tuttavia, se la dimensione iniziale di cui è stato eseguito il commit specificata da *dwStackSize* è maggiore o uguale alla dimensione di riserva predefinita, le dimensioni della riserva sono le nuove dimensioni del commit arrotondate per eccesso al multiplo più vicino di 1 MB.</span><span class="sxs-lookup"><span data-stu-id="2313b-122">However, if the initially committed size specified by *dwStackSize* is larger than or equal to the default reserve size, the reserve size is this new commit size rounded up to the nearest multiple of 1 MB.</span></span>

<span data-ttu-id="2313b-123">Per modificare le dimensioni dello stack riservato, impostare il parametro *dwCreationFlags* di [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) o [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) su stack \_ size \_ param \_ è \_ una \_ prenotazione e utilizzare il parametro *dwStackSize* .</span><span class="sxs-lookup"><span data-stu-id="2313b-123">To change the reserved stack size, set the *dwCreationFlags* parameter of [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) or [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread) to STACK\_SIZE\_PARAM\_IS\_A\_RESERVATION and use the *dwStackSize* parameter.</span></span> <span data-ttu-id="2313b-124">In questo caso, la dimensione iniziale di cui è stato eseguito il commit corrisponde alla dimensione predefinita specificata nell'intestazione eseguibile.</span><span class="sxs-lookup"><span data-stu-id="2313b-124">In this case, the initially committed size is the default size specified in the executable header.</span></span> <span data-ttu-id="2313b-125">Per fibers, usare il parametro *dwStackReserveSize* di [**CreateFiberEx**](/windows/desktop/api/WinBase/nf-winbase-createfiberex).</span><span class="sxs-lookup"><span data-stu-id="2313b-125">For fibers, use the *dwStackReserveSize* parameter of [**CreateFiberEx**](/windows/desktop/api/WinBase/nf-winbase-createfiberex).</span></span> <span data-ttu-id="2313b-126">Le dimensioni di cui è stato eseguito il commit sono specificate nel parametro *dwStackCommitSize* .</span><span class="sxs-lookup"><span data-stu-id="2313b-126">The committed size is specified in the *dwStackCommitSize* parameter.</span></span>

<span data-ttu-id="2313b-127">La funzione [**SetThreadStackGuarantee**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadstackguarantee) imposta la dimensione minima dello stack associato al thread chiamante o al Fiber che sarà disponibile durante le eccezioni di overflow dello stack.</span><span class="sxs-lookup"><span data-stu-id="2313b-127">The [**SetThreadStackGuarantee**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setthreadstackguarantee) function sets the minimum size of the stack associated with the calling thread or fiber that will be available during any stack overflow exceptions.</span></span>

 

 
