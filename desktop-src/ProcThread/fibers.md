---
description: Un fiber è un'unità di esecuzione che deve essere pianificata manualmente dall'applicazione.
ms.assetid: 6283f56b-23ae-4840-abd0-2478a50c670c
title: Fiber
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4ea0383e6d207a77c621f00f358c72bb8873ecb5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103756560"
---
# <a name="fibers"></a><span data-ttu-id="b7a90-103">Fiber</span><span class="sxs-lookup"><span data-stu-id="b7a90-103">Fibers</span></span>

<span data-ttu-id="b7a90-104">Un *Fiber* è un'unità di esecuzione che deve essere pianificata manualmente dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b7a90-104">A *fiber* is a unit of execution that must be manually scheduled by the application.</span></span> <span data-ttu-id="b7a90-105">I fiber vengono eseguiti nel contesto dei thread che li pianificano.</span><span class="sxs-lookup"><span data-stu-id="b7a90-105">Fibers run in the context of the threads that schedule them.</span></span> <span data-ttu-id="b7a90-106">Ogni thread può pianificare più Fiber.</span><span class="sxs-lookup"><span data-stu-id="b7a90-106">Each thread can schedule multiple fibers.</span></span> <span data-ttu-id="b7a90-107">In generale, i fiber non offrono vantaggi in un'applicazione multithreading progettata correttamente.</span><span class="sxs-lookup"><span data-stu-id="b7a90-107">In general, fibers do not provide advantages over a well-designed multithreaded application.</span></span> <span data-ttu-id="b7a90-108">Tuttavia, l'uso di fiber può semplificare la portabilità delle applicazioni progettate per pianificare i propri thread.</span><span class="sxs-lookup"><span data-stu-id="b7a90-108">However, using fibers can make it easier to port applications that were designed to schedule their own threads.</span></span>

<span data-ttu-id="b7a90-109">Dal punto di vista del sistema, una fibra presuppone l'identità del thread che lo esegue.</span><span class="sxs-lookup"><span data-stu-id="b7a90-109">From a system standpoint, a fiber assumes the identity of the thread that runs it.</span></span> <span data-ttu-id="b7a90-110">Ad esempio, se un fiber accede all' [archiviazione locale di thread](thread-local-storage.md) (TLS), accede alla risorsa di archiviazione locale del thread che lo esegue.</span><span class="sxs-lookup"><span data-stu-id="b7a90-110">For example, if a fiber accesses [thread local storage](thread-local-storage.md) (TLS), it is accessing the thread local storage of the thread that is running it.</span></span> <span data-ttu-id="b7a90-111">Inoltre, se un fiber chiama la funzione [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) , il thread che lo esegue viene chiuso.</span><span class="sxs-lookup"><span data-stu-id="b7a90-111">In addition, if a fiber calls the [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) function, the thread that is running it exits.</span></span> <span data-ttu-id="b7a90-112">Tuttavia, a una fibra non sono associate tutte le stesse informazioni sullo stato associate a un thread.</span><span class="sxs-lookup"><span data-stu-id="b7a90-112">However, a fiber does not have all the same state information associated with it as that associated with a thread.</span></span> <span data-ttu-id="b7a90-113">Le uniche informazioni sullo stato gestite per un fiber sono lo stack, un subset dei relativi registri e i dati Fiber forniti durante la creazione della Fiber.</span><span class="sxs-lookup"><span data-stu-id="b7a90-113">The only state information maintained for a fiber is its stack, a subset of its registers, and the fiber data provided during fiber creation.</span></span> <span data-ttu-id="b7a90-114">I registri salvati sono il set di registri generalmente mantenuti in una chiamata di funzione.</span><span class="sxs-lookup"><span data-stu-id="b7a90-114">The saved registers are the set of registers typically preserved across a function call.</span></span>

<span data-ttu-id="b7a90-115">I fiber non vengono pianificati preventivamente.</span><span class="sxs-lookup"><span data-stu-id="b7a90-115">Fibers are not preemptively scheduled.</span></span> <span data-ttu-id="b7a90-116">È possibile pianificare una fibra passando da un'altra Fiber.</span><span class="sxs-lookup"><span data-stu-id="b7a90-116">You schedule a fiber by switching to it from another fiber.</span></span> <span data-ttu-id="b7a90-117">Il sistema pianifica ancora i thread per l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="b7a90-117">The system still schedules threads to run.</span></span> <span data-ttu-id="b7a90-118">Quando un thread che esegue Fiber viene interrotto, la relativa fibra attualmente in esecuzione viene superata ma rimane selezionata.</span><span class="sxs-lookup"><span data-stu-id="b7a90-118">When a thread running fibers is preempted, its currently running fiber is preempted but remains selected.</span></span> <span data-ttu-id="b7a90-119">Il fiber selezionato viene eseguito quando viene eseguito il thread.</span><span class="sxs-lookup"><span data-stu-id="b7a90-119">The selected fiber runs when its thread runs.</span></span>

<span data-ttu-id="b7a90-120">Prima di pianificare la prima fibra, chiamare la funzione [**ConvertThreadToFiber**](/windows/desktop/api/WinBase/nf-winbase-convertthreadtofiber) per creare un'area in cui salvare le informazioni sullo stato della Fiber.</span><span class="sxs-lookup"><span data-stu-id="b7a90-120">Before scheduling the first fiber, call the [**ConvertThreadToFiber**](/windows/desktop/api/WinBase/nf-winbase-convertthreadtofiber) function to create an area in which to save fiber state information.</span></span> <span data-ttu-id="b7a90-121">Il thread chiamante è ora il fiber attualmente in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="b7a90-121">The calling thread is now the currently executing fiber.</span></span> <span data-ttu-id="b7a90-122">Le informazioni sullo stato archiviato per questa fiber includono i dati Fiber passati come argomento a **ConvertThreadToFiber**.</span><span class="sxs-lookup"><span data-stu-id="b7a90-122">The stored state information for this fiber includes the fiber data passed as an argument to **ConvertThreadToFiber**.</span></span>

<span data-ttu-id="b7a90-123">La funzione [**CreateFiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) viene usata per creare un nuovo fiber da una fibra esistente. la chiamata richiede le dimensioni dello stack, l'indirizzo iniziale e i dati Fiber.</span><span class="sxs-lookup"><span data-stu-id="b7a90-123">The [**CreateFiber**](/windows/desktop/api/WinBase/nf-winbase-createfiber) function is used to create a new fiber from an existing fiber; the call requires the stack size, the starting address, and the fiber data.</span></span> <span data-ttu-id="b7a90-124">L'indirizzo iniziale è in genere una funzione fornita dall'utente, denominata funzione Fiber, che accetta un parametro (i dati Fiber) e non restituisce alcun valore.</span><span class="sxs-lookup"><span data-stu-id="b7a90-124">The starting address is typically a user-supplied function, called the fiber function, that takes one parameter (the fiber data) and does not return a value.</span></span> <span data-ttu-id="b7a90-125">Se la funzione Fiber restituisce, il thread che esegue il fiber viene chiuso.</span><span class="sxs-lookup"><span data-stu-id="b7a90-125">If your fiber function returns, the thread running the fiber exits.</span></span> <span data-ttu-id="b7a90-126">Per eseguire qualsiasi Fiber creata con **CreateFiber**, chiamare la funzione [**SwitchToFiber**](/windows/desktop/api/WinBase/nf-winbase-switchtofiber) .</span><span class="sxs-lookup"><span data-stu-id="b7a90-126">To execute any fiber created with **CreateFiber**, call the [**SwitchToFiber**](/windows/desktop/api/WinBase/nf-winbase-switchtofiber) function.</span></span> <span data-ttu-id="b7a90-127">È possibile chiamare **SwitchToFiber** con l'indirizzo di una fibra creata da un thread diverso.</span><span class="sxs-lookup"><span data-stu-id="b7a90-127">You can call **SwitchToFiber** with the address of a fiber created by a different thread.</span></span> <span data-ttu-id="b7a90-128">A tale scopo, è necessario che l'indirizzo venga restituito all'altro thread quando si chiama **CreateFiber** ed è necessario usare la sincronizzazione corretta.</span><span class="sxs-lookup"><span data-stu-id="b7a90-128">To do this, you must have the address returned to the other thread when it called **CreateFiber** and you must use proper synchronization.</span></span>

<span data-ttu-id="b7a90-129">Un fiber può recuperare i dati Fiber chiamando la macro [**GetFiberData**](/windows/win32/api/winnt/nf-winnt-getfiberdata) .</span><span class="sxs-lookup"><span data-stu-id="b7a90-129">A fiber can retrieve the fiber data by calling the [**GetFiberData**](/windows/win32/api/winnt/nf-winnt-getfiberdata) macro.</span></span> <span data-ttu-id="b7a90-130">Un fiber può recuperare l'indirizzo Fiber in qualsiasi momento chiamando la macro [**GetCurrentFiber**](/windows/win32/api/winnt/nf-winnt-getcurrentfiber) .</span><span class="sxs-lookup"><span data-stu-id="b7a90-130">A fiber can retrieve the fiber address at any time by calling the [**GetCurrentFiber**](/windows/win32/api/winnt/nf-winnt-getcurrentfiber) macro.</span></span>

## <a name="fiber-local-storage"></a><span data-ttu-id="b7a90-131">Archiviazione locale Fiber</span><span class="sxs-lookup"><span data-stu-id="b7a90-131">Fiber Local Storage</span></span>

<span data-ttu-id="b7a90-132">Un fiber può usare l' *archiviazione locale di Fiber* (FLS) per creare una copia univoca di una variabile per ogni Fiber.</span><span class="sxs-lookup"><span data-stu-id="b7a90-132">A fiber can use *fiber local storage* (FLS) to create a unique copy of a variable for each fiber.</span></span> <span data-ttu-id="b7a90-133">Se non si verifica alcun cambio di fibra, FLS funziona esattamente come l' [archiviazione thread-local](thread-local-storage.md).</span><span class="sxs-lookup"><span data-stu-id="b7a90-133">If no fiber switching occurs, FLS acts exactly the same as [thread local storage](thread-local-storage.md).</span></span> <span data-ttu-id="b7a90-134">Le funzioni FLS ([**FlsAlloc**](/windows/win32/api/fibersapi/nf-fibersapi-flsalloc), [**FlsFree**](/windows/win32/api/fibersapi/nf-fibersapi-flsfree), [**FlsGetValue**](/windows/win32/api/fibersapi/nf-fibersapi-flsgetvalue)e [**FlsSetValue**](/windows/win32/api/fibersapi/nf-fibersapi-flssetvalue)) modificano il FLS associato al thread corrente.</span><span class="sxs-lookup"><span data-stu-id="b7a90-134">The FLS functions ([**FlsAlloc**](/windows/win32/api/fibersapi/nf-fibersapi-flsalloc), [**FlsFree**](/windows/win32/api/fibersapi/nf-fibersapi-flsfree), [**FlsGetValue**](/windows/win32/api/fibersapi/nf-fibersapi-flsgetvalue), and [**FlsSetValue**](/windows/win32/api/fibersapi/nf-fibersapi-flssetvalue)) manipulate the FLS associated with the current thread.</span></span> <span data-ttu-id="b7a90-135">Se il thread sta eseguendo una fibra e la fibra è cambiata, viene anche scambiata la FLS.</span><span class="sxs-lookup"><span data-stu-id="b7a90-135">If the thread is executing a fiber and the fiber is switched, the FLS is also switched.</span></span>

<span data-ttu-id="b7a90-136">Per pulire i dati associati a un fiber, chiamare la funzione [**DeleteFiber**](/windows/desktop/api/WinBase/nf-winbase-deletefiber) .</span><span class="sxs-lookup"><span data-stu-id="b7a90-136">To clean up the data associated with a fiber, call the [**DeleteFiber**](/windows/desktop/api/WinBase/nf-winbase-deletefiber) function.</span></span> <span data-ttu-id="b7a90-137">Questi dati includono lo stack, un subset dei registri e i dati Fiber.</span><span class="sxs-lookup"><span data-stu-id="b7a90-137">This data includes the stack, a subset of the registers, and the fiber data.</span></span> <span data-ttu-id="b7a90-138">Se il fiber attualmente in esecuzione chiama **DeleteFiber**, il thread chiama [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) e termina.</span><span class="sxs-lookup"><span data-stu-id="b7a90-138">If the currently running fiber calls **DeleteFiber**, its thread calls [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) and terminates.</span></span> <span data-ttu-id="b7a90-139">Tuttavia, se il fiber selezionato di un thread viene eliminato da una fibra in esecuzione in un altro thread, è probabile che il thread con la fibra eliminata venga interrotto in modo anomalo perché lo stack Fiber è stato liberato.</span><span class="sxs-lookup"><span data-stu-id="b7a90-139">However, if the selected fiber of a thread is deleted by a fiber running in another thread, the thread with the deleted fiber is likely to terminate abnormally because the fiber stack has been freed.</span></span>

## <a name="related-topics"></a><span data-ttu-id="b7a90-140">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="b7a90-140">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b7a90-141">Uso di Fiber</span><span class="sxs-lookup"><span data-stu-id="b7a90-141">Using Fibers</span></span>](using-fibers.md)
</dt> </dl>

 

 
