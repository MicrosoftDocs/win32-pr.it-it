---
description: "Il termine di un processo presenta i risultati seguenti: gli eventuali thread rimanenti nel processo sono contrassegnati per la terminazione. Tutte le risorse allocate dal processo vengono liberate. Tutti gli oggetti kernel sono chiusi. Il codice del processo viene rimosso dalla memoria. Il codice di uscita del processo è impostato. L'oggetto processo viene segnalato."
ms.assetid: af24d157-2719-4052-8029-1eb8010047cc
title: Terminazione di un processo
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2010f1d4332a575c8ee94cf1b0f196e00ba7fb9f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106311954"
---
# <a name="terminating-a-process"></a><span data-ttu-id="fded2-103">Terminazione di un processo</span><span class="sxs-lookup"><span data-stu-id="fded2-103">Terminating a Process</span></span>

<span data-ttu-id="fded2-104">Il termine di un processo presenta i risultati seguenti:</span><span class="sxs-lookup"><span data-stu-id="fded2-104">Terminating a process has the following results:</span></span>

-   <span data-ttu-id="fded2-105">Tutti i thread rimanenti del processo sono contrassegnati per la terminazione.</span><span class="sxs-lookup"><span data-stu-id="fded2-105">Any remaining threads in the process are marked for termination.</span></span>
-   <span data-ttu-id="fded2-106">Tutte le risorse allocate dal processo vengono liberate.</span><span class="sxs-lookup"><span data-stu-id="fded2-106">Any resources allocated by the process are freed.</span></span>
-   <span data-ttu-id="fded2-107">Tutti gli oggetti kernel sono chiusi.</span><span class="sxs-lookup"><span data-stu-id="fded2-107">All kernel objects are closed.</span></span>
-   <span data-ttu-id="fded2-108">Il codice del processo viene rimosso dalla memoria.</span><span class="sxs-lookup"><span data-stu-id="fded2-108">The process code is removed from memory.</span></span>
-   <span data-ttu-id="fded2-109">Il codice di uscita del processo è impostato.</span><span class="sxs-lookup"><span data-stu-id="fded2-109">The process exit code is set.</span></span>
-   <span data-ttu-id="fded2-110">L'oggetto processo viene segnalato.</span><span class="sxs-lookup"><span data-stu-id="fded2-110">The process object is signaled.</span></span>

<span data-ttu-id="fded2-111">Mentre gli handle aperti agli oggetti kernel vengono chiusi automaticamente al termine di un processo, gli oggetti stessi sono presenti finché tutti gli handle aperti non vengono chiusi.</span><span class="sxs-lookup"><span data-stu-id="fded2-111">While open handles to kernel objects are closed automatically when a process terminates, the objects themselves exist until all open handles to them are closed.</span></span> <span data-ttu-id="fded2-112">Pertanto, un oggetto rimarrà valido dopo che un processo che lo usa termina se un altro processo ha un handle aperto.</span><span class="sxs-lookup"><span data-stu-id="fded2-112">Therefore, an object will remain valid after a process that is using it terminates if another process has an open handle to it.</span></span>

<span data-ttu-id="fded2-113">La funzione [**GetExitCodeProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodeprocess) restituisce lo stato di terminazione di un processo.</span><span class="sxs-lookup"><span data-stu-id="fded2-113">The [**GetExitCodeProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-getexitcodeprocess) function returns the termination status of a process.</span></span> <span data-ttu-id="fded2-114">Mentre un processo è in esecuzione, il relativo stato di terminazione è ancora \_ attivo.</span><span class="sxs-lookup"><span data-stu-id="fded2-114">While a process is executing, its termination status is STILL\_ACTIVE.</span></span> <span data-ttu-id="fded2-115">Al termine di un processo, lo stato di chiusura passa da ancora \_ attivo al codice di uscita del processo.</span><span class="sxs-lookup"><span data-stu-id="fded2-115">When a process terminates, its termination status changes from STILL\_ACTIVE to the exit code of the process.</span></span>

<span data-ttu-id="fded2-116">Quando un processo termina, lo stato dell'oggetto processo viene segnalato, che rilascia tutti i thread in attesa dell'interruzione del processo.</span><span class="sxs-lookup"><span data-stu-id="fded2-116">When a process terminates, the state of the process object becomes signaled, releasing any threads that had been waiting for the process to terminate.</span></span> <span data-ttu-id="fded2-117">Per ulteriori informazioni sulla sincronizzazione, vedere [sincronizzazione dell'esecuzione di più thread](synchronizing-execution-of-multiple-threads.md).</span><span class="sxs-lookup"><span data-stu-id="fded2-117">For more about synchronization, see [Synchronizing Execution of Multiple Threads](synchronizing-execution-of-multiple-threads.md).</span></span>

<span data-ttu-id="fded2-118">Quando il sistema termina un processo, non termina i processi figlio creati dal processo.</span><span class="sxs-lookup"><span data-stu-id="fded2-118">When the system is terminating a process, it does not terminate any child processes that the process has created.</span></span> <span data-ttu-id="fded2-119">Se si termina un processo, non vengono generate notifiche per \_ le procedure hook di WH CBT.</span><span class="sxs-lookup"><span data-stu-id="fded2-119">Terminating a process does not generate notifications for WH\_CBT hook procedures.</span></span>

<span data-ttu-id="fded2-120">Utilizzare la funzione [**SetProcessShutdownParameters**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessshutdownparameters) per specificare determinati aspetti della terminazione del processo al momento dell'arresto del sistema, ad esempio quando un processo deve terminare rispetto agli altri processi nel sistema.</span><span class="sxs-lookup"><span data-stu-id="fded2-120">Use the [**SetProcessShutdownParameters**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-setprocessshutdownparameters) function to specify certain aspects of the process termination at system shutdown, such as when a process should terminate relative to the other processes in the system.</span></span>

## <a name="how-processes-are-terminated"></a><span data-ttu-id="fded2-121">Modalità di terminazione dei processi</span><span class="sxs-lookup"><span data-stu-id="fded2-121">How Processes are Terminated</span></span>

<span data-ttu-id="fded2-122">Un processo viene eseguito fino a quando non si verifica uno degli eventi seguenti:</span><span class="sxs-lookup"><span data-stu-id="fded2-122">A process executes until one of the following events occurs:</span></span>

-   <span data-ttu-id="fded2-123">Qualsiasi thread del processo chiama la funzione [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) .</span><span class="sxs-lookup"><span data-stu-id="fded2-123">Any thread of the process calls the [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) function.</span></span> <span data-ttu-id="fded2-124">Si noti che alcune implementazioni della libreria di runtime C (CRT) chiamano **ExitProcess** se il thread principale del processo restituisce.</span><span class="sxs-lookup"><span data-stu-id="fded2-124">Note that some implementation of the C run-time library (CRT) call **ExitProcess** if the primary thread of the process returns.</span></span>
-   <span data-ttu-id="fded2-125">L'ultimo thread del processo viene terminato.</span><span class="sxs-lookup"><span data-stu-id="fded2-125">The last thread of the process terminates.</span></span>
-   <span data-ttu-id="fded2-126">Qualsiasi thread chiama la funzione [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) con un handle per il processo.</span><span class="sxs-lookup"><span data-stu-id="fded2-126">Any thread calls the [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess) function with a handle to the process.</span></span>
-   <span data-ttu-id="fded2-127">Per i processi della console, il [gestore di controllo della console](/windows/console/console-control-handlers) predefinito chiama [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) quando la console riceve un segnale CTRL + C o CTRL + INTERR.</span><span class="sxs-lookup"><span data-stu-id="fded2-127">For console processes, the default [console control handler](/windows/console/console-control-handlers) calls [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) when the console receives a CTRL+C or CTRL+BREAK signal.</span></span>
-   <span data-ttu-id="fded2-128">L'utente arresta il sistema o si disconnette.</span><span class="sxs-lookup"><span data-stu-id="fded2-128">The user shuts down the system or logs off.</span></span>

<span data-ttu-id="fded2-129">Non terminare un processo a meno che i relativi thread non siano in stati noti.</span><span class="sxs-lookup"><span data-stu-id="fded2-129">Do not terminate a process unless its threads are in known states.</span></span> <span data-ttu-id="fded2-130">Se un thread è in attesa di un oggetto kernel, non verrà terminato fino al completamento dell'attesa.</span><span class="sxs-lookup"><span data-stu-id="fded2-130">If a thread is waiting on a kernel object, it will not be terminated until the wait has completed.</span></span> <span data-ttu-id="fded2-131">Questa operazione può causare l'interruzione della risposta dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="fded2-131">This can cause the application to stop responding.</span></span>

<span data-ttu-id="fded2-132">Il thread primario può evitare di terminare altri thread indirizzando questi alla chiamata di [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) prima di causare la terminazione del processo (per altre informazioni, vedere [terminazione di un thread](terminating-a-thread.md)).</span><span class="sxs-lookup"><span data-stu-id="fded2-132">The primary thread can avoid terminating other threads by directing them to call [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread) before causing the process to terminate (for more information, see [Terminating a Thread](terminating-a-thread.md)).</span></span> <span data-ttu-id="fded2-133">Il thread primario può comunque chiamare [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) in un secondo momento per assicurarsi che tutti i thread vengano terminati.</span><span class="sxs-lookup"><span data-stu-id="fded2-133">The primary thread can still call [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) afterwards to ensure that all threads are terminated.</span></span>

<span data-ttu-id="fded2-134">Il codice di uscita per un processo è il valore specificato nella chiamata a [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) o [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess)oppure il valore restituito dalla funzione Main o [**WinMain**](/windows/win32/api/winbase/nf-winbase-winmain) del processo.</span><span class="sxs-lookup"><span data-stu-id="fded2-134">The exit code for a process is either the value specified in the call to [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) or [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), or the value returned by the main or [**WinMain**](/windows/win32/api/winbase/nf-winbase-winmain) function of the process.</span></span> <span data-ttu-id="fded2-135">Se un processo viene terminato a causa di un'eccezione irreversibile, il codice di uscita corrisponde al valore dell'eccezione che ha causato la chiusura.</span><span class="sxs-lookup"><span data-stu-id="fded2-135">If a process is terminated due to a fatal exception, the exit code is the value of the exception that caused the termination.</span></span> <span data-ttu-id="fded2-136">Inoltre, questo valore viene usato come codice di uscita per tutti i thread in esecuzione quando si è verificata l'eccezione.</span><span class="sxs-lookup"><span data-stu-id="fded2-136">In addition, this value is used as the exit code for all the threads that were executing when the exception occurred.</span></span>

<span data-ttu-id="fded2-137">Se un processo viene terminato da [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), il sistema chiama la funzione del punto di ingresso di ogni DLL collegata con un valore che indica che il processo viene scollegato dalla dll.</span><span class="sxs-lookup"><span data-stu-id="fded2-137">If a process is terminated by [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), the system calls the entry-point function of each attached DLL with a value indicating that the process is detaching from the DLL.</span></span> <span data-ttu-id="fded2-138">Le dll non ricevono notifiche quando un processo viene terminato da [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span><span class="sxs-lookup"><span data-stu-id="fded2-138">DLLs are not notified when a process is terminated by [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess).</span></span> <span data-ttu-id="fded2-139">Per altre informazioni sulle dll, vedere [librerie a collegamento dinamico](../dlls/dynamic-link-libraries.md).</span><span class="sxs-lookup"><span data-stu-id="fded2-139">For more information about DLLs, see [Dynamic-Link Libraries](../dlls/dynamic-link-libraries.md).</span></span>

<span data-ttu-id="fded2-140">Se un processo viene terminato da [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), tutti i thread del processo vengono interrotti immediatamente senza alcuna possibilità di eseguire codice aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="fded2-140">If a process is terminated by [**TerminateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-terminateprocess), all threads of the process are terminated immediately with no chance to run additional code.</span></span> <span data-ttu-id="fded2-141">Ciò significa che il thread non esegue codice nei blocchi del gestore di terminazione.</span><span class="sxs-lookup"><span data-stu-id="fded2-141">This means that the thread does not execute code in termination handler blocks.</span></span> <span data-ttu-id="fded2-142">Inoltre, nessuna DLL collegata riceve una notifica che indica che il processo è scollegato.</span><span class="sxs-lookup"><span data-stu-id="fded2-142">In addition, no attached DLLs are notified that the process is detaching.</span></span> <span data-ttu-id="fded2-143">Se è necessario che un processo termini un altro processo, i passaggi seguenti offrono una soluzione migliore:</span><span class="sxs-lookup"><span data-stu-id="fded2-143">If you need to have one process terminate another process, the following steps provide a better solution:</span></span>

-   <span data-ttu-id="fded2-144">In entrambi i processi viene chiamata la funzione [**RegisterWindowMessage**](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea) per creare un messaggio privato.</span><span class="sxs-lookup"><span data-stu-id="fded2-144">Have both processes call the [**RegisterWindowMessage**](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea) function to create a private message.</span></span>
-   <span data-ttu-id="fded2-145">Un processo può terminare l'altro processo trasmettendo un messaggio privato usando la funzione [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) come segue:</span><span class="sxs-lookup"><span data-stu-id="fded2-145">One process can terminate the other process by broadcasting a private message using the [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) function as follows:</span></span>

    ``` syntax
     DWORD dwRecipients = BSM_APPLICATIONS;
        UINT uMessage = PM_MYMSG;
        WPARAM wParam = 0;
        LPARAM lParam = 0;

        BroadcastSystemMessage( 
            BSF_IGNORECURRENTTASK, // do not send message to this process
            &dwRecipients,         // broadcast only to applications
            uMessage,              // registered private message
            wParam,                // message-specific value
            lParam );              // message-specific value
    ```

-   <span data-ttu-id="fded2-146">Il processo che riceve il messaggio privato chiama [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) per terminare l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="fded2-146">The process receiving the private message calls [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) to terminate its execution.</span></span>

<span data-ttu-id="fded2-147">L'esecuzione delle funzioni [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread)e [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) viene serializzata in uno spazio di indirizzi.</span><span class="sxs-lookup"><span data-stu-id="fded2-147">The execution of the [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess), [**ExitThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitthread), [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread), [**CreateRemoteThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createremotethread), and [**CreateProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createprocessa) functions is serialized within an address space.</span></span> <span data-ttu-id="fded2-148">Si applicano le restrizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="fded2-148">The following restrictions apply:</span></span>

-   <span data-ttu-id="fded2-149">Durante le routine di avvio del processo e di inizializzazione della DLL, è possibile creare nuovi thread, ma non avviare l'esecuzione fino a quando non viene completata l'inizializzazione della DLL per il processo.</span><span class="sxs-lookup"><span data-stu-id="fded2-149">During process startup and DLL initialization routines, new threads can be created, but they do not begin execution until DLL initialization is finished for the process.</span></span>
-   <span data-ttu-id="fded2-150">Solo un thread alla volta può trovarsi in una routine di inizializzazione o scollegamento della DLL.</span><span class="sxs-lookup"><span data-stu-id="fded2-150">Only one thread at a time can be in a DLL initialization or detach routine.</span></span>
-   <span data-ttu-id="fded2-151">La funzione [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) non restituisce alcun risultato finché non sono presenti thread nelle routine di inizializzazione o scollegamento della dll.</span><span class="sxs-lookup"><span data-stu-id="fded2-151">The [**ExitProcess**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-exitprocess) function does not return until there are no threads are in their DLL initialization or detach routines.</span></span>

 

 
