---
title: Protezione contro la rientranza nelle funzioni hook
description: Mentre una funzione hook elabora un evento, è possibile che vengano generati eventi aggiuntivi, che potrebbero causare la reimmissione della funzione hook prima del completamento dell'elaborazione dell'evento originale.
ms.assetid: 2382e7a4-82df-423a-8479-66e28baf8105
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 74e2b0dc6f8951bf48ce3fecabd3a81bd345388d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "104399485"
---
# <a name="guarding-against-reentrancy-in-hook-functions"></a><span data-ttu-id="0ede4-103">Protezione contro la rientranza nelle funzioni hook</span><span class="sxs-lookup"><span data-stu-id="0ede4-103">Guarding Against Reentrancy in Hook Functions</span></span>

<span data-ttu-id="0ede4-104">Mentre una funzione hook elabora un evento, è possibile che vengano generati eventi aggiuntivi, che potrebbero causare la reimmissione della funzione hook prima del completamento dell'elaborazione dell'evento originale.</span><span class="sxs-lookup"><span data-stu-id="0ede4-104">While a hook function processes an event, additional events may be triggered, which may cause the hook function to reenter before the processing for the original event is finished.</span></span> <span data-ttu-id="0ede4-105">Il problema con la rientranza nelle funzioni hook è che gli eventi vengono completati fuori sequenza, a meno che la funzione hook non gestisca questa situazione.</span><span class="sxs-lookup"><span data-stu-id="0ede4-105">The problem with reentrancy in hook functions is that events are completed out of sequence unless the hook function handles this situation.</span></span>

<span data-ttu-id="0ede4-106">Si consideri, ad esempio, un caso in cui una funzione hook in un programma di lettura schermo sta elaborando l'evento [**\_ \_ VALUECHANGE dell'oggetto evento**](event-constants.md) per un controllo di modifica.</span><span class="sxs-lookup"><span data-stu-id="0ede4-106">For example, consider a case where a hook function in a screen reader program is processing the [**EVENT\_OBJECT\_VALUECHANGE**](event-constants.md) event for an edit control.</span></span> <span data-ttu-id="0ede4-107">Se, durante l'elaborazione dell'evento di modifica del primo valore, la funzione hook viene nuovamente immessa per elaborare un evento di modifica del valore successivo, il secondo evento viene completato prima del primo evento.</span><span class="sxs-lookup"><span data-stu-id="0ede4-107">If, while processing the first value change event the hook function is reentered to process a subsequent value change event, the second event is completed before the first event.</span></span> <span data-ttu-id="0ede4-108">Questa situazione restituisce all'utente informazioni non accurate da parte dell'utente.</span><span class="sxs-lookup"><span data-stu-id="0ede4-108">This situation results in the screen reader conveying inaccurate information to the user.</span></span>

<span data-ttu-id="0ede4-109">Poiché l'elaborazione degli eventi viene interrotta, è possibile che vengano ricevuti eventi aggiuntivi ogni volta che la funzione hook chiama una funzione che determina il controllo della coda di messaggi del thread proprietario.</span><span class="sxs-lookup"><span data-stu-id="0ede4-109">Because event processing is interrupted, additional events might be received any time the hook function calls a function that causes the owning thread's message queue to get checked.</span></span> <span data-ttu-id="0ede4-110">Questo errore si verifica quando una qualsiasi delle operazioni seguenti viene chiamata all'interno della funzione hook:</span><span class="sxs-lookup"><span data-stu-id="0ede4-110">This happens when any of the following are called within the hook function:</span></span>

-   <span data-ttu-id="0ede4-111">Funzione Windows [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage), [**GetMessage**](/windows/desktop/api/winuser/nf-winuser-getmessage), [**PeekMessage**](/windows/desktop/api/winuser/nf-winuser-peekmessagea), [**DialogBox**](/windows/desktop/api/winuser/nf-winuser-dialogboxa)o [**MessageBox**](/windows/desktop/api/winuser/nf-winuser-messagebox)</span><span class="sxs-lookup"><span data-stu-id="0ede4-111">The Windows [**SendMessage**](/windows/desktop/api/winuser/nf-winuser-sendmessage), [**GetMessage**](/windows/desktop/api/winuser/nf-winuser-getmessage), [**PeekMessage**](/windows/desktop/api/winuser/nf-winuser-peekmessagea), [**DialogBox**](/windows/desktop/api/winuser/nf-winuser-dialogboxa), or [**MessageBox**](/windows/desktop/api/winuser/nf-winuser-messagebox) function</span></span>
-   <span data-ttu-id="0ede4-112">Funzioni di Microsoft Active Accessibility [**AccessibleObjectFromEvent**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfromevent), [**AccessibleObjectFromWindow**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfromwindow), [**AccessibleObjectFromPoint**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfrompoint)</span><span class="sxs-lookup"><span data-stu-id="0ede4-112">The Microsoft Active Accessibility functions [**AccessibleObjectFromEvent**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfromevent), [**AccessibleObjectFromWindow**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfromwindow), [**AccessibleObjectFromPoint**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfrompoint)</span></span>
-   <span data-ttu-id="0ede4-113">Interfaccia [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) o altra proprietà o metodo di Component Object Model (com) che supera i limiti del processo</span><span class="sxs-lookup"><span data-stu-id="0ede4-113">An [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) interface or other Component Object Model (COM) property or method that crosses process boundaries</span></span>

<span data-ttu-id="0ede4-114">Poiché le funzioni hook chiamano proprietà e metodi [**AccessibleObjectFromEvent**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfromevent) e [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) , non è possibile impedire la rientranza.</span><span class="sxs-lookup"><span data-stu-id="0ede4-114">Because hook functions call [**AccessibleObjectFromEvent**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfromevent) and [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) properties and methods, it is not possible to prevent reentrancy.</span></span> <span data-ttu-id="0ede4-115">L'unica soluzione consiste nel consentire agli sviluppatori di client di aggiungere codice nella funzione hook che rilevi la rientranza e intraprendere le azioni appropriate se la funzione hook viene nuovamente immessa.</span><span class="sxs-lookup"><span data-stu-id="0ede4-115">The only solution is for client developers to add code in the hook function that detects reentrancy and take appropriate action if the hook function is reentered.</span></span>

 

 