---
title: Precauzioni della funzione hook In-Context
description: Per motivi di prestazioni, gli sviluppatori client registrano funzioni hook nel contesto.
ms.assetid: 14b48920-a291-4519-b005-e559263a0e83
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8c0e319037cb1295725548b3361bf076b4b1f760
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "106300125"
---
# <a name="in-context-hook-function-precautions"></a><span data-ttu-id="2e1f0-103">Precauzioni della funzione hook In-Context</span><span class="sxs-lookup"><span data-stu-id="2e1f0-103">In-Context Hook Function Precautions</span></span>

<span data-ttu-id="2e1f0-104">Per motivi di prestazioni, gli sviluppatori client registrano funzioni hook nel contesto.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-104">For performance reasons, client developers register in-context hook functions.</span></span> <span data-ttu-id="2e1f0-105">Tuttavia, poiché queste funzioni hook sono mappate nello spazio degli indirizzi del server, gli sviluppatori di client e server devono adottare le precauzioni necessarie per garantire che l'elaborazione degli eventi venga eseguita senza problemi.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-105">However, because these hook functions are mapped into the server's address space, client and server developers must take precautions to ensure that the event processing goes smoothly.</span></span>

## <a name="precautions-for-client-developers"></a><span data-ttu-id="2e1f0-106">Precauzioni per gli sviluppatori client</span><span class="sxs-lookup"><span data-stu-id="2e1f0-106">Precautions for Client Developers</span></span>

<span data-ttu-id="2e1f0-107">Gli sviluppatori client devono essere a conoscenza dei seguenti problemi:</span><span class="sxs-lookup"><span data-stu-id="2e1f0-107">Client developers should be aware of the following issues:</span></span>

-   <span data-ttu-id="2e1f0-108">Le funzioni hook nel contesto non devono utilizzare molto tempo del processore, perché la funzione hook deve restituire prima che l'applicazione server continui.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-108">In-context hook functions should not use a lot of processor time, because the hook function must return before the server application continues.</span></span>
-   <span data-ttu-id="2e1f0-109">Dopo l'attivazione di un evento, è possibile che la finestra associata a un evento non esista più nel momento in cui viene chiamata la funzione hook.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-109">After an event is triggered, it is possible that the window associated with an event no longer exists by the time the hook function is called.</span></span> <span data-ttu-id="2e1f0-110">I client devono verificare che la finestra associata a un evento esista ancora prima di intraprendere qualsiasi altra azione correlata all'evento.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-110">Clients must verify that the window associated with an event still exists before taking any other action related to the event.</span></span> <span data-ttu-id="2e1f0-111">Per assicurarsi che esista ancora una finestra, i client utilizzano la funzione [**finestra**](/windows/desktop/api/winuser/nf-winuser-iswindow) di Microsoft Win32.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-111">To ensure that a window still exists, clients use the Microsoft Win32 [**IsWindow**](/windows/desktop/api/winuser/nf-winuser-iswindow) function.</span></span>
-   <span data-ttu-id="2e1f0-112">Se la DLL in cui è definita la funzione hook è collegata a un'altra DLL, gli sviluppatori client devono assicurarsi che il sistema carichi l'altra DLL.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-112">If the DLL in which the hook function is defined links to another DLL, client developers must ensure that the system loads the other DLL.</span></span> <span data-ttu-id="2e1f0-113">Se si collega in modo implicito (usando i file def e le importazioni), la DLL aggiuntiva deve trovarsi nella directory di Windows o in una delle directory di sistema, ad esempio Windows \\ System, Windows \\ System32 o Windows \\ SysWow64.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-113">If linking implicitly (using .def files and imports), the additional DLL must be in either the Windows directory or one of the system directories such as Windows\\System, Windows\\System32, or Windows\\SysWOW64.</span></span> <span data-ttu-id="2e1f0-114">Se si collega in modo esplicito (usando [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya)), il percorso completo della directory in cui risiede la DLL aggiuntiva deve essere specificato nella chiamata a **LoadLibrary**.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-114">If linking explicitly (using [**LoadLibrary**](/windows/desktop/api/libloaderapi/nf-libloaderapi-loadlibrarya)), the full path to the directory in which the additional DLL resides must be specified in the call to **LoadLibrary**.</span></span>
-   <span data-ttu-id="2e1f0-115">Le funzioni hook nel contesto possono causare un overflow dello stack quando la DLL che contiene la funzione hook viene caricata in un'applicazione a 16 bit.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-115">In-context hook functions may cause a stack overflow when the DLL that contains the hook function is loaded into a 16-bit application.</span></span> <span data-ttu-id="2e1f0-116">Questo problema si verifica perché le applicazioni a 16 bit utilizzano una dimensione dello stack fissa non sufficientemente grande da contenere la catena di chiamate di funzione di sistema che generano una chiamata alla funzione hook.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-116">This problem occurs because 16-bit applications use a fixed stack size that is not large enough to accommodate the chain of system function calls that result in a call to the hook function.</span></span>

## <a name="precautions-for-server-developers"></a><span data-ttu-id="2e1f0-117">Precauzioni per gli sviluppatori di server</span><span class="sxs-lookup"><span data-stu-id="2e1f0-117">Precautions for Server Developers</span></span>

<span data-ttu-id="2e1f0-118">Gli sviluppatori di server devono tenere presente che le applicazioni client possono registrare funzioni hook nel contesto.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-118">Server developers need to be aware that client applications might register in-context hook functions.</span></span> <span data-ttu-id="2e1f0-119">Quando un server chiama [**NotifyWinEvent**](/windows/desktop/api/Winuser/nf-winuser-notifywinevent), deve essere preparato per gestire [**WM \_ GetObject**](wm-getobject.md) e altri metodi [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) .</span><span class="sxs-lookup"><span data-stu-id="2e1f0-119">When a server calls [**NotifyWinEvent**](/windows/desktop/api/Winuser/nf-winuser-notifywinevent), it must be prepared to handle [**WM\_GETOBJECT**](wm-getobject.md) and other [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) methods.</span></span>

## <a name="invalid-interface-pointers"></a><span data-ttu-id="2e1f0-120">Puntatori a interfaccia non validi</span><span class="sxs-lookup"><span data-stu-id="2e1f0-120">Invalid Interface Pointers</span></span>

<span data-ttu-id="2e1f0-121">Quando un client chiama [**AccessibleObjectFromEvent**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfromevent) all'interno di una funzione hook nel contesto, il puntatore all'interfaccia [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) restituito punta direttamente al codice nello spazio degli indirizzi del server.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-121">When a client calls [**AccessibleObjectFromEvent**](/windows/desktop/api/Oleacc/nf-oleacc-accessibleobjectfromevent) within an in-context hook function, the [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) interface pointer that is returned points directly to code in the server's address space.</span></span> <span data-ttu-id="2e1f0-122">Se il client chiama una proprietà di interfaccia usando questo puntatore, la libreria Component Object Model (COM) non è associata al marshalling (creazione di pacchetti e invio di parametri di interfaccia tra i limiti del processo) o all'annullamento del marshalling (annullamento del packaging dei parametri inviati attraverso i limiti del processo) e non rileva se un oggetto viene eliminato definitivamente.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-122">If the client calls an interface property using this pointer, the Component Object Model (COM) library is not involved with marshaling (packaging and sending interface parameters across process boundaries) or unmarshaling (unpackaging parameters that have been sent across process boundaries) and does not detect if an object is destroyed.</span></span>

<span data-ttu-id="2e1f0-123">Se il client chiama una proprietà di interfaccia a un oggetto che viene eliminato definitivamente, il puntatore a interfaccia non valido causa un errore di protezione generale nello spazio degli indirizzi del server, a meno che il server non rilevi questa situazione.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-123">If the client calls an interface property to an object that is destroyed, the invalid interface pointer causes a General Protection fault in the server's address space unless the server detects this situation.</span></span>

<span data-ttu-id="2e1f0-124">Per proteggersi da puntatori di interfaccia non validi, i server [creano oggetti proxy](creating-proxy-objects.md) che esegue il wrapping degli oggetti accessibili e monitora la durata degli oggetti accessibili.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-124">To protect against invalid interface pointers, servers [create proxy objects](creating-proxy-objects.md) that wrap accessible objects and monitor the life span of accessible objects.</span></span> <span data-ttu-id="2e1f0-125">Ad esempio, quando un client chiama una proprietà [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) per ottenere informazioni su un oggetto, il proxy controlla se l'oggetto accessibile è ancora disponibile e, in caso affermativo, esegue il inoltro della richiesta del client all'oggetto accessibile.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-125">For instance, when a client calls an [**IAccessible**](/windows/desktop/api/oleacc/nn-oleacc-iaccessible) property to get information about an object, the proxy checks whether the accessible object is still available, and if so, forwards the client's request to the accessible object.</span></span> <span data-ttu-id="2e1f0-126">Se l'oggetto accessibile viene eliminato definitivamente, il proxy restituisce un errore al client.</span><span class="sxs-lookup"><span data-stu-id="2e1f0-126">If the accessible object is destroyed, the proxy returns an error to the client.</span></span>

 

 