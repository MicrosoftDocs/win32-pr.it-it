---
description: Quando l'applicazione chiama le funzioni LoadLibrary o LoadLibraryEx, il sistema tenta di individuare la DLL. per informazioni dettagliate, vedere Dynamic-Link ordine di ricerca della libreria.
ms.assetid: 81e237a9-3c32-46a5-88d3-c978f43dad54
title: Collegamento dinamico Run-Time
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a9e215ac83ecdc0615b8030e2e215857c67fe6e5
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106308380"
---
# <a name="run-time-dynamic-linking"></a><span data-ttu-id="78dc7-103">Collegamento dinamico Run-Time</span><span class="sxs-lookup"><span data-stu-id="78dc7-103">Run-Time Dynamic Linking</span></span>

<span data-ttu-id="78dc7-104">Quando l'applicazione chiama le funzioni [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) , il sistema tenta di individuare la dll. per informazioni dettagliate, vedere l'ordine di ricerca della [libreria a collegamento dinamico](dynamic-link-library-search-order.md).</span><span class="sxs-lookup"><span data-stu-id="78dc7-104">When the application calls the [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) functions, the system attempts to locate the DLL (for details, see [Dynamic-Link Library Search Order](dynamic-link-library-search-order.md)).</span></span> <span data-ttu-id="78dc7-105">Se la ricerca ha esito positivo, il sistema esegue il mapping del modulo DLL allo spazio degli indirizzi virtuali del processo e incrementa il conteggio dei riferimenti.</span><span class="sxs-lookup"><span data-stu-id="78dc7-105">If the search succeeds, the system maps the DLL module into the virtual address space of the process and increments the reference count.</span></span> <span data-ttu-id="78dc7-106">Se la chiamata a **LoadLibrary** o **LOADLIBRARYEX** specifica una dll il cui codice è già stato mappato nello spazio degli indirizzi virtuali del processo chiamante, la funzione restituisce semplicemente un handle per la dll e incrementa il conteggio dei riferimenti alla dll.</span><span class="sxs-lookup"><span data-stu-id="78dc7-106">If the call to **LoadLibrary** or **LoadLibraryEx** specifies a DLL whose code is already mapped into the virtual address space of the calling process, the function simply returns a handle to the DLL and increments the DLL reference count.</span></span> <span data-ttu-id="78dc7-107">Si noti che due DLL con lo stesso nome e l'estensione di file di base, ma che si trovano in directory diverse, non sono considerate uguali.</span><span class="sxs-lookup"><span data-stu-id="78dc7-107">Note that two DLLs that have the same base file name and extension but are found in different directories are not considered to be the same DLL.</span></span>

<span data-ttu-id="78dc7-108">Il sistema chiama la funzione del punto di ingresso nel contesto del thread che ha chiamato [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span><span class="sxs-lookup"><span data-stu-id="78dc7-108">The system calls the entry-point function in the context of the thread that called [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span></span> <span data-ttu-id="78dc7-109">La funzione del punto di ingresso non viene chiamata se la DLL è già stata caricata dal processo tramite una chiamata a **LoadLibrary** o **LoadLibraryEx** senza una chiamata corrispondente alla funzione [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) .</span><span class="sxs-lookup"><span data-stu-id="78dc7-109">The entry-point function is not called if the DLL was already loaded by the process through a call to **LoadLibrary** or **LoadLibraryEx** with no corresponding call to the [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) function.</span></span>

<span data-ttu-id="78dc7-110">Se il sistema non riesce a trovare la DLL o se la funzione del punto di ingresso restituisce FALSE, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) restituisce null.</span><span class="sxs-lookup"><span data-stu-id="78dc7-110">If the system cannot find the DLL or if the entry-point function returns FALSE, [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) returns NULL.</span></span> <span data-ttu-id="78dc7-111">Se **LoadLibrary** o **LoadLibraryEx** ha esito positivo, restituisce un handle per il modulo dll.</span><span class="sxs-lookup"><span data-stu-id="78dc7-111">If **LoadLibrary** or **LoadLibraryEx** succeeds, it returns a handle to the DLL module.</span></span> <span data-ttu-id="78dc7-112">Il processo può utilizzare questo handle per identificare la DLL in una chiamata alla funzione [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)o [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread) .</span><span class="sxs-lookup"><span data-stu-id="78dc7-112">The process can use this handle to identify the DLL in a call to the [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread) function.</span></span>

<span data-ttu-id="78dc7-113">La funzione [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea) restituisce un handle utilizzato in [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary)o [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span><span class="sxs-lookup"><span data-stu-id="78dc7-113">The [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea) function returns a handle used in [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress), [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span></span> <span data-ttu-id="78dc7-114">La funzione **GetModuleHandle** ha esito positivo solo se è già stato eseguito il mapping del modulo dll nello spazio degli indirizzi del processo tramite il collegamento della fase di caricamento o una chiamata precedente a [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span><span class="sxs-lookup"><span data-stu-id="78dc7-114">The **GetModuleHandle** function succeeds only if the DLL module is already mapped into the address space of the process by load-time linking or by a previous call to [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa).</span></span> <span data-ttu-id="78dc7-115">Diversamente da **LoadLibrary** o **LoadLibraryEx**, **GetModuleHandle** non incrementa il conteggio dei riferimenti del modulo.</span><span class="sxs-lookup"><span data-stu-id="78dc7-115">Unlike **LoadLibrary** or **LoadLibraryEx**, **GetModuleHandle** does not increment the module reference count.</span></span> <span data-ttu-id="78dc7-116">La funzione [**GetModuleFileName**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) Recupera il percorso completo del modulo associato a un handle restituito da **GetModuleHandle**, **LoadLibrary** o **LoadLibraryEx**.</span><span class="sxs-lookup"><span data-stu-id="78dc7-116">The [**GetModuleFileName**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function retrieves the full path of the module associated with a handle returned by **GetModuleHandle**, **LoadLibrary**, or **LoadLibraryEx**.</span></span>

<span data-ttu-id="78dc7-117">Il processo può usare [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) per ottenere l'indirizzo di una funzione esportata nella dll usando un handle di modulo DLL restituito da [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa), [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea).</span><span class="sxs-lookup"><span data-stu-id="78dc7-117">The process can use [**GetProcAddress**](/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress) to get the address of an exported function in the DLL using a DLL module handle returned by [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa), [**GetModuleHandle**](/windows/win32/api/libloaderapi/nf-libloaderapi-getmodulehandlea).</span></span>

<span data-ttu-id="78dc7-118">Quando il modulo DLL non è più necessario, il processo può chiamare [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) o [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span><span class="sxs-lookup"><span data-stu-id="78dc7-118">When the DLL module is no longer needed, the process can call [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary) or [**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread).</span></span> <span data-ttu-id="78dc7-119">Queste funzioni decrementano il conteggio dei riferimenti al modulo e annullare il codice DLL dallo spazio degli indirizzi virtuali del processo se il conteggio dei riferimenti è pari a zero.</span><span class="sxs-lookup"><span data-stu-id="78dc7-119">These functions decrement the module reference count and unmap the DLL code from the virtual address space of the process if the reference count is zero.</span></span>

<span data-ttu-id="78dc7-120">Il collegamento dinamico in fase di esecuzione consente di continuare l'esecuzione del processo anche se non è disponibile una DLL.</span><span class="sxs-lookup"><span data-stu-id="78dc7-120">Run-time dynamic linking enables the process to continue running even if a DLL is not available.</span></span> <span data-ttu-id="78dc7-121">Il processo può quindi utilizzare un metodo alternativo per completare l'obiettivo.</span><span class="sxs-lookup"><span data-stu-id="78dc7-121">The process can then use an alternate method to accomplish its objective.</span></span> <span data-ttu-id="78dc7-122">Se, ad esempio, un processo non è in grado di individuare una DLL, può provare a utilizzarne un'altra o può inviare una notifica all'utente di un errore.</span><span class="sxs-lookup"><span data-stu-id="78dc7-122">For example, if a process is unable to locate one DLL, it can try to use another, or it can notify the user of an error.</span></span> <span data-ttu-id="78dc7-123">Se l'utente è in grado di fornire il percorso completo della DLL mancante, il processo può utilizzare queste informazioni per caricare la DLL anche se non si trova nel percorso di ricerca normale.</span><span class="sxs-lookup"><span data-stu-id="78dc7-123">If the user can provide the full path of the missing DLL, the process can use this information to load the DLL even though it is not in the normal search path.</span></span> <span data-ttu-id="78dc7-124">Questa situazione si differenzia dal collegamento del tempo di caricamento, in cui il sistema termina semplicemente il processo se non riesce a trovare la DLL.</span><span class="sxs-lookup"><span data-stu-id="78dc7-124">This situation contrasts with load-time linking, in which the system simply terminates the process if it cannot find the DLL.</span></span>

<span data-ttu-id="78dc7-125">Il collegamento dinamico in fase di esecuzione può causare problemi se la DLL usa la funzione [**DllMain**](dllmain.md) per eseguire l'inizializzazione per ogni thread di un processo, perché il punto di ingresso non viene chiamato per i thread esistenti prima della chiamata a [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) o a [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) .</span><span class="sxs-lookup"><span data-stu-id="78dc7-125">Run-time dynamic linking can cause problems if the DLL uses the [**DllMain**](dllmain.md) function to perform initialization for each thread of a process, because the entry-point is not called for threads that existed before [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) or [**LoadLibraryEx**](/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa) is called.</span></span> <span data-ttu-id="78dc7-126">Per un esempio che illustra come gestire questo problema, vedere [uso dell'archiviazione locale di thread in una libreria di Dynamic-Link](using-thread-local-storage-in-a-dynamic-link-library.md).</span><span class="sxs-lookup"><span data-stu-id="78dc7-126">For an example showing how to deal with this problem, see [Using Thread Local Storage in a Dynamic-Link Library](using-thread-local-storage-in-a-dynamic-link-library.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="78dc7-127">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="78dc7-127">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="78dc7-128">Uso del collegamento dinamico in fase di esecuzione</span><span class="sxs-lookup"><span data-stu-id="78dc7-128">Using Run-time Dynamic Linking</span></span>](using-run-time-dynamic-linking.md)
</dt> </dl>

 

 
