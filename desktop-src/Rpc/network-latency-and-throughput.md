---
title: Latenza di rete e velocità effettiva
description: Latenza di rete e velocità effettiva con RPC (Remote Procedure Call).
ms.assetid: 8285fd73-eb54-4c06-b01a-1bffafb7e675
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c5c51c4db75b904ac5feae8c4a1cc5965fc2b06e
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/16/2019
ms.locfileid: "104221917"
---
# <a name="network-latency-and-throughput"></a><span data-ttu-id="4cde3-103">Latenza di rete e velocità effettiva</span><span class="sxs-lookup"><span data-stu-id="4cde3-103">Network Latency and Throughput</span></span>

<span data-ttu-id="4cde3-104">Tre problemi principali riguardano l'uso ottimale della rete:</span><span class="sxs-lookup"><span data-stu-id="4cde3-104">Three major issues relate to optimal use of the network:</span></span>

-   <span data-ttu-id="4cde3-105">Latenza di rete</span><span class="sxs-lookup"><span data-stu-id="4cde3-105">Network latency</span></span>
-   <span data-ttu-id="4cde3-106">Saturazione della rete</span><span class="sxs-lookup"><span data-stu-id="4cde3-106">Network saturation</span></span>
-   <span data-ttu-id="4cde3-107">Implicazioni di elaborazione dei pacchetti</span><span class="sxs-lookup"><span data-stu-id="4cde3-107">Packet processing implications</span></span>

<span data-ttu-id="4cde3-108">Questa sezione introduce un'attività di programmazione che richiede l'uso di RPC, quindi progetta due soluzioni: una scritta malamente e una ben scritta.</span><span class="sxs-lookup"><span data-stu-id="4cde3-108">This section introduces a programming task requiring use of RPC, then designs two solutions: one poorly written and one well written.</span></span> <span data-ttu-id="4cde3-109">Vengono quindi esaminate entrambe le soluzioni e il relativo impatto sulle prestazioni di rete viene illustrato.</span><span class="sxs-lookup"><span data-stu-id="4cde3-109">Both solutions are then scrutinized, and their affect on network performance is discussed.</span></span>

<span data-ttu-id="4cde3-110">Prima di illustrare le due soluzioni, le sezioni successive discutono e chiariscono i problemi di prestazioni correlati alla rete.</span><span class="sxs-lookup"><span data-stu-id="4cde3-110">Before discussing the two solutions, the next few sections discuss and clarify network related performance issues.</span></span>

## <a name="network-latency"></a><span data-ttu-id="4cde3-111">Latenza di rete</span><span class="sxs-lookup"><span data-stu-id="4cde3-111">Network Latency</span></span>

<span data-ttu-id="4cde3-112">La larghezza di banda di rete e la latenza di rete sono termini distinti.</span><span class="sxs-lookup"><span data-stu-id="4cde3-112">Network bandwidth and network latency are separate terms.</span></span> <span data-ttu-id="4cde3-113">Le reti con larghezza di banda elevata non garantiscono bassa latenza.</span><span class="sxs-lookup"><span data-stu-id="4cde3-113">Networks with high bandwidth do not guarantee low latency.</span></span> <span data-ttu-id="4cde3-114">Ad esempio, un percorso di rete che attraversa un collegamento satellite spesso presenta una latenza elevata, anche se la velocità effettiva è molto elevata.</span><span class="sxs-lookup"><span data-stu-id="4cde3-114">For example, a network path traversing a satellite link often has high latency, even though throughput is very high.</span></span> <span data-ttu-id="4cde3-115">Non è insolito per un round trip di rete attraversare un collegamento satellite per avere cinque o più secondi di latenza.</span><span class="sxs-lookup"><span data-stu-id="4cde3-115">It is not uncommon for a network round trip traversing a satellite link to have five or more seconds of latency.</span></span> <span data-ttu-id="4cde3-116">L'implicazione di tale ritardo è il seguente: un'applicazione progettata per inviare una richiesta, attendere una risposta, inviare un'altra richiesta, attendere un'altra risposta e così via, attenderà almeno cinque secondi per ogni scambio di pacchetti, indipendentemente dalla velocità con cui si trova il server.</span><span class="sxs-lookup"><span data-stu-id="4cde3-116">The implication of such a delay is this: an application designed to send a request, wait for a reply, send another request, wait for another reply, and so on, will wait at least five seconds for each packet exchange, regardless of how fast the server is.</span></span> <span data-ttu-id="4cde3-117">Nonostante la maggiore velocità dei computer, le trasmissioni satellite e i supporti di rete sono basati sulla velocità della luce, che in genere rimane costante.</span><span class="sxs-lookup"><span data-stu-id="4cde3-117">Despite the increasing speed of computers, satellite transmissions and network media are based on the speed of light, which generally stays constant.</span></span> <span data-ttu-id="4cde3-118">Di conseguenza, è improbabile che si verifichino miglioramenti della latenza per le reti satellite esistenti.</span><span class="sxs-lookup"><span data-stu-id="4cde3-118">As such, improvements in latency for existing satellite networks is unlikely to occur.</span></span>

## <a name="network-saturation"></a><span data-ttu-id="4cde3-119">Saturazione della rete</span><span class="sxs-lookup"><span data-stu-id="4cde3-119">Network Saturation</span></span>

<span data-ttu-id="4cde3-120">Una saturazione si verifica in molte reti.</span><span class="sxs-lookup"><span data-stu-id="4cde3-120">Some saturation occurs in many networks.</span></span> <span data-ttu-id="4cde3-121">Le reti più semplici da saturare sono collegamenti modem lenti, ad esempio modem analoghi 56K standard.</span><span class="sxs-lookup"><span data-stu-id="4cde3-121">The easiest networks to saturate are slow modem links, such as standard 56k analog modems.</span></span> <span data-ttu-id="4cde3-122">Tuttavia, i collegamenti Ethernet con molti computer in un singolo segmento possono anche diventare saturi.</span><span class="sxs-lookup"><span data-stu-id="4cde3-122">However, Ethernet links with many computers on a single segment can also become saturated.</span></span> <span data-ttu-id="4cde3-123">Lo stesso vale per le reti WAN con una larghezza di banda ridotta o un collegamento altrimenti sovraccaricato, ad esempio un router o un commutere che può gestire una quantità limitata di traffico.</span><span class="sxs-lookup"><span data-stu-id="4cde3-123">The same is true about wide area networks with a low-bandwidth or otherwise overburdened link, such as a router or switch that can handle a limited amount of traffic.</span></span> <span data-ttu-id="4cde3-124">In questi casi, se la rete invia più pacchetti di quelli che possono essere gestiti dal collegamento più debole, i pacchetti vengono eliminati.</span><span class="sxs-lookup"><span data-stu-id="4cde3-124">In such these cases, if the network sends more packets than its weakest link can handle, it drops packets.</span></span> <span data-ttu-id="4cde3-125">Per evitare la congestione lo stack TCP di Windows viene ridimensionato quando vengono rilevati pacchetti eliminati che possono causare ritardi significativi.</span><span class="sxs-lookup"><span data-stu-id="4cde3-125">To avoid congestion the Windows TCP stack scales back when dropped packets are detected which can result in significant delays.</span></span>

## <a name="packet-processing-implications"></a><span data-ttu-id="4cde3-126">Implicazioni di elaborazione dei pacchetti</span><span class="sxs-lookup"><span data-stu-id="4cde3-126">Packet Processing Implications</span></span>

<span data-ttu-id="4cde3-127">Quando si sviluppano programmi per ambienti di livello superiore come RPC, COM e persino Windows Sockets, gli sviluppatori tendono a dimenticare quanto lavoro si svolge in background per ogni pacchetto inviato o ricevuto.</span><span class="sxs-lookup"><span data-stu-id="4cde3-127">When programs are developed for higher level environments like RPC, COM, and even Windows Sockets, developers tend to forget how much work takes place behind the scenes for each sent or received packet.</span></span> <span data-ttu-id="4cde3-128">Quando arriva un pacchetto dalla rete, un interrupt dalla scheda di rete viene gestito dal computer.</span><span class="sxs-lookup"><span data-stu-id="4cde3-128">When a packet arrives from the network, an interrupt from the network card is serviced by the computer.</span></span> <span data-ttu-id="4cde3-129">Una chiamata di procedura posticipata viene quindi accodata e deve essere configurata attraverso i driver.</span><span class="sxs-lookup"><span data-stu-id="4cde3-129">Then a Deferred Procedure Call (DPC) is queued, and must make its way through the drivers.</span></span> <span data-ttu-id="4cde3-130">Se viene utilizzata una forma di sicurezza, è possibile che sia necessario decrittografare il pacchetto oppure che sia stato verificato l'hash crittografico.</span><span class="sxs-lookup"><span data-stu-id="4cde3-130">If any form of security is used, the packet may have to be decrypted, or the cryptographic hash verified.</span></span> <span data-ttu-id="4cde3-131">È necessario eseguire anche un numero di controlli di validità a ogni stato.</span><span class="sxs-lookup"><span data-stu-id="4cde3-131">A number of validity checks must also be performed at each state.</span></span> <span data-ttu-id="4cde3-132">Solo a questo punto il pacchetto arriva alla destinazione finale: il codice server.</span><span class="sxs-lookup"><span data-stu-id="4cde3-132">Only then does the packet arrive at the final destination: the server code.</span></span> <span data-ttu-id="4cde3-133">L'invio di molti piccoli blocchi di dati comporta un sovraccarico di elaborazione dei pacchetti per ogni piccolo blocco di dati.</span><span class="sxs-lookup"><span data-stu-id="4cde3-133">Sending many small chunks of data results in packet processing overhead for each small chunk of data.</span></span> <span data-ttu-id="4cde3-134">L'invio di un grande blocco di dati tende a consumare un tempo di CPU significativamente inferiore nel sistema, anche se il costo di esecuzione per molti blocchi piccoli rispetto a un blocco di grandi dimensioni può essere lo stesso per l'applicazione server.</span><span class="sxs-lookup"><span data-stu-id="4cde3-134">Sending one big chunk of data tends to consume significantly less CPU time throughout the system, even though the cost of execution for many small chunks compared to one large chunk may be the same for the server application.</span></span>

## <a name="example-1-a-poorly-designed-rpc-server"></a><span data-ttu-id="4cde3-135">Esempio 1: un server RPC progettato in modo non corretto</span><span class="sxs-lookup"><span data-stu-id="4cde3-135">Example 1: A Poorly Designed RPC Server</span></span>

<span data-ttu-id="4cde3-136">Si supponga che un'applicazione debba accedere ai file remoti e che l'attività sia quella di progettare un'interfaccia RPC per la manipolazione del file remoto.</span><span class="sxs-lookup"><span data-stu-id="4cde3-136">Imagine an application that must access remote files, and the task at hand is to design an RPC interface for manipulating the remote file.</span></span> <span data-ttu-id="4cde3-137">La soluzione più semplice consiste nel rispecchiare le routine dei file di studio per i file locali.</span><span class="sxs-lookup"><span data-stu-id="4cde3-137">The simplest solution is to mirror the studio file routines for local files.</span></span> <span data-ttu-id="4cde3-138">Questa operazione può comportare un'interfaccia apparentemente pulita e familiare.</span><span class="sxs-lookup"><span data-stu-id="4cde3-138">Doing so may result in a deceptively clean and familiar interface.</span></span> <span data-ttu-id="4cde3-139">Ecco un file. idl abbreviato:</span><span class="sxs-lookup"><span data-stu-id="4cde3-139">Here is an abbreviated .idl file:</span></span>

``` syntax
typedef [context_handle] void *remote_file;
... .
interface remote_file
{
    remote_file remote_fopen(file_name);
    void remote_fclose(remote_file ...);
    size_t remote_fread(void *, size_t, size_t, remote_file ...);
    size_t remote_fwrite(const void *, size_t, size_t, remote_file ...);
    size_t remote_fseek(remote_file ..., long, int);
}
```

<span data-ttu-id="4cde3-140">Questa operazione sembra abbastanza elegante, ma in realtà si tratta di una ricetta del tempo rispettata per l'emergenza delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="4cde3-140">This seems elegant enough, but actually, this is a time-honored recipe for performance disaster.</span></span> <span data-ttu-id="4cde3-141">Contrariamente al parere comune, la chiamata di procedura remota non è semplicemente una chiamata di procedura locale con una rete tra il chiamante e il chiamato.</span><span class="sxs-lookup"><span data-stu-id="4cde3-141">Contrary to popular opinion, remote procedure call is not simply a local procedure call with a wire between the caller and callee.</span></span>

<span data-ttu-id="4cde3-142">Per vedere in che modo questa ricetta brucia le prestazioni, prendere in considerazione un file 2K, in cui 20 byte vengono letti dall'inizio e poi 20 byte dalla fine e vedere come viene eseguita questa operazione.</span><span class="sxs-lookup"><span data-stu-id="4cde3-142">To see how this recipe burns performance, consider a 2K file, where 20 bytes are read from the beginning, and then 20 bytes from the end, and see how this performs.</span></span> <span data-ttu-id="4cde3-143">Sul lato client vengono effettuate le chiamate seguenti (molti percorsi di codice vengono omessi per brevità):</span><span class="sxs-lookup"><span data-stu-id="4cde3-143">On the client side, the following calls are made (many code paths are omitted for brevity):</span></span>

``` syntax
rfp = remote_fopen("c:\\sample.txt");
remote_read(...);
remote_fseek(...);
remote_read(...);
remote_fclose(rfp);
```

<span data-ttu-id="4cde3-144">Si supponga ora che il server sia separato dal client tramite un collegamento satellite con un tempo di round trip di cinque secondi.</span><span class="sxs-lookup"><span data-stu-id="4cde3-144">Now imagine that the server is separated from the client by a satellite link with a five-second round-trip time.</span></span> <span data-ttu-id="4cde3-145">Ognuna di queste chiamate deve attendere una risposta prima di procedere, il che significa un valore minimo assoluto per l'esecuzione di questa sequenza di 25 secondi.</span><span class="sxs-lookup"><span data-stu-id="4cde3-145">Each of those calls must wait for a response before it can proceed, which means an absolute minimum for executing this sequence of 25 seconds.</span></span> <span data-ttu-id="4cde3-146">Considerato che si sta recuperando solo 40 byte, si tratta di un rallentamento delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="4cde3-146">Considering we are retrieving only 40 bytes, this is outrageously slow performance.</span></span> <span data-ttu-id="4cde3-147">I clienti di questa applicazione sarebbero furiosi.</span><span class="sxs-lookup"><span data-stu-id="4cde3-147">Customers of this application would be furious.</span></span>

<span data-ttu-id="4cde3-148">Si supponga ora che la rete sia satura, perché la capacità di un router in un percorso di rete è sovraccarica.</span><span class="sxs-lookup"><span data-stu-id="4cde3-148">Now imagine the network is saturated, because a router's capacity somewhere in the network path is overburdened.</span></span> <span data-ttu-id="4cde3-149">Questa progettazione impone al router di gestire almeno 10 pacchetti se non si ha la sicurezza (uno per ogni richiesta e uno per ogni risposta).</span><span class="sxs-lookup"><span data-stu-id="4cde3-149">This design forces the router to handle at least 10 packets if we do not have security (one for each request, and one for each reply).</span></span> <span data-ttu-id="4cde3-150">Anche questo non è un aspetto positivo.</span><span class="sxs-lookup"><span data-stu-id="4cde3-150">That, too, is not good.</span></span>

<span data-ttu-id="4cde3-151">Questa progettazione impone inoltre al server di ricevere cinque pacchetti e inviare cinque pacchetti.</span><span class="sxs-lookup"><span data-stu-id="4cde3-151">This design also forces the server to receive five packets and send five packets.</span></span> <span data-ttu-id="4cde3-152">Anche in questo caso non è un'implementazione molto corretta.</span><span class="sxs-lookup"><span data-stu-id="4cde3-152">Again, not a very good implementation.</span></span>

## <a name="example-2-a-better-designed-rpc-server"></a><span data-ttu-id="4cde3-153">Esempio 2: un server RPC progettato meglio</span><span class="sxs-lookup"><span data-stu-id="4cde3-153">Example 2: A Better Designed RPC Server</span></span>

<span data-ttu-id="4cde3-154">Riprogettare l'interfaccia illustrata nell'esempio 1 e verificare se è possibile migliorare.</span><span class="sxs-lookup"><span data-stu-id="4cde3-154">Let's redesign the interface discussed in Example 1, and see whether we can make it better.</span></span> <span data-ttu-id="4cde3-155">È importante sottolineare che rendere questo server molto valido richiede la conoscenza del modello di utilizzo per i file specificati: tali informazioni non vengono considerate per questo esempio.</span><span class="sxs-lookup"><span data-stu-id="4cde3-155">It is important to note that making this server really good requires knowledge of the usage pattern for the given files: such knowledge is not assumed for this example.</span></span> <span data-ttu-id="4cde3-156">Pertanto, si tratta di un server RPC progettato meglio, ma non di un server RPC progettato in modo ottimale.</span><span class="sxs-lookup"><span data-stu-id="4cde3-156">Therefore, this is a better designed RPC server, but not an optimally designed RPC server.</span></span>

<span data-ttu-id="4cde3-157">L'idea in questo esempio consiste nel comprimere il numero di operazioni remote in un'unica operazione possibile.</span><span class="sxs-lookup"><span data-stu-id="4cde3-157">The idea in this example is to collapse as many remote operations into one operation as possible.</span></span> <span data-ttu-id="4cde3-158">Il primo tentativo è il seguente:</span><span class="sxs-lookup"><span data-stu-id="4cde3-158">The first attempt is the following:</span></span>

``` syntax
typedef [context_handle] void *remote_file;
typedef struct
{
    long position;
    int origin;
} remote_seek_instruction;
... .
interface remote_file
{
    remote_fread(file_name, void *, size_t, size_t, [in, out] remote_file ..., BOOL CloseWhenDone, remote_seek_instruction *...);
    size_t remote_fwrite(file_name, const void *, size_t, size_t, [in, out] remote_file ..., BOOL CloseWhenDone, remote_seek_instruction *...);
}
```

<span data-ttu-id="4cde3-159">Questo esempio Mostra come comprimere tutte le operazioni in lettura e scrittura, che consente l'apertura facoltativa nella stessa operazione, nonché una chiusura e una ricerca facoltative.</span><span class="sxs-lookup"><span data-stu-id="4cde3-159">This example collapses all operations to a read and write, which allows for an optional open on the same operation, as well as an optional close and seek.</span></span>

<span data-ttu-id="4cde3-160">Questa stessa sequenza di operazione, se scritta in formato abbreviato, ha un aspetto simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="4cde3-160">This same sequence of operation, when written in abbreviated form, looks like this:</span></span>

``` syntax
remote_read("c:\\sample.txt", ..., &rfp, FALSE, NULL);
remote_read(NULL, ..., &rfp, TRUE, seek_to_20_bytes_before_end);
```

<span data-ttu-id="4cde3-161">Quando si considera il server RPC migliore progettato, nella seconda chiamata il server verifica che il *\_ nome del file* sia **null** e usa il file aperto archiviato in RDP.</span><span class="sxs-lookup"><span data-stu-id="4cde3-161">When considering the better designed RPC server, on the second call the server checks that the *file\_name* is **NULL**, and uses the stored open file in rfp.</span></span> <span data-ttu-id="4cde3-162">Vengono quindi visualizzate le istruzioni di ricerca e il puntatore del file verrà posizionato 20 byte prima della fine prima della lettura.</span><span class="sxs-lookup"><span data-stu-id="4cde3-162">Then it sees there are seek instructions, and will position the file pointer 20 bytes before the end before it reads.</span></span> <span data-ttu-id="4cde3-163">Al termine, riconoscerà che il flag **CloseWhenDone** è impostato su **true** e chiuderà il file e chiuderà RDP.</span><span class="sxs-lookup"><span data-stu-id="4cde3-163">When done, it will recognize the **CloseWhenDone** flag is set to **TRUE**, and will close the file, and close rfp.</span></span>

<span data-ttu-id="4cde3-164">Nella rete ad alta latenza, questa versione migliore richiede 10 secondi per il completamento (2,5 volte più velocemente) e richiede l'elaborazione di soli quattro pacchetti; due ricevute dal server e due invii dal server.</span><span class="sxs-lookup"><span data-stu-id="4cde3-164">On the high latency network, this better version takes 10 seconds to complete (2.5 times faster) and requires processing of only four packets; two receives from the server, and two sends from the server.</span></span> <span data-ttu-id="4cde3-165">Le prestazioni *IFS* e unmarshaling aggiuntive eseguite dal server sono irrilevanti rispetto a tutti gli altri elementi.</span><span class="sxs-lookup"><span data-stu-id="4cde3-165">The extra *ifs* and unmarshaling the server performs are negligible compared to everything else.</span></span>

<span data-ttu-id="4cde3-166">Se l'ordinamento causale è specificato in modo corretto, l'interfaccia può anche essere eseguita in modo asincrono e le due chiamate possono essere inviate in parallelo.</span><span class="sxs-lookup"><span data-stu-id="4cde3-166">If causal ordering is specified properly, the interface can even be made asynchronous, and the two calls can be sent in parallel.</span></span> <span data-ttu-id="4cde3-167">Quando l'ordinamento causale viene usato, le chiamate vengono comunque inviate in ordine, ovvero nella rete a latenza elevata viene sopportato solo un ritardo di cinque secondi, anche se il numero di pacchetti inviati e ricevuti è lo stesso.</span><span class="sxs-lookup"><span data-stu-id="4cde3-167">When causal ordering is used calls are still dispatched in order, which means on the high latency network only a five-second delay is endured, even though the number of packets sent and received is the same.</span></span>

<span data-ttu-id="4cde3-168">È possibile comprimere ulteriormente questo problema creando un metodo che accetta una matrice di strutture, ogni membro della matrice che descrive un'operazione di file particolare. variazione remota di I/O a dispersione/raccolta.</span><span class="sxs-lookup"><span data-stu-id="4cde3-168">We can collapse this even further by creating one method that takes an array of structures, each member of the array describing a particular file operation; a remote variation of scatter/gather I/O.</span></span> <span data-ttu-id="4cde3-169">L'approccio si paga fino a quando il risultato di ogni operazione non richiede un'ulteriore elaborazione nel client. in altre parole, l'applicazione leggerà i 20 byte alla fine, indipendentemente dai primi 20 byte letti.</span><span class="sxs-lookup"><span data-stu-id="4cde3-169">The approach pays off as long as the result of each operation does not require further processing on the client; in other words the application is going to read the 20 bytes at the end regardless of what the first 20 bytes read are.</span></span>

<span data-ttu-id="4cde3-170">Tuttavia, se è necessario eseguire alcune elaborazioni sui primi 20 byte dopo la lettura per determinare l'operazione successiva, il collasso di tutto in un'unica operazione non funziona (almeno non in tutti i casi).</span><span class="sxs-lookup"><span data-stu-id="4cde3-170">However, if some processing must be performed on the first 20 bytes after reading them to determine the next operation, collapsing everything into one operation does not work (at least not in all cases).</span></span> <span data-ttu-id="4cde3-171">L'eleganza di RPC è che un'applicazione può avere entrambi i metodi nell'interfaccia e chiamare uno dei metodi in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="4cde3-171">The elegance of RPC is that an application can have both methods in the interface, and call either method depending on need.</span></span>

<span data-ttu-id="4cde3-172">In generale, quando è presente la rete è preferibile combinare il maggior numero possibile di chiamate a una singola chiamata.</span><span class="sxs-lookup"><span data-stu-id="4cde3-172">In general, when the network is involved it is best to combine as many calls onto a single call as possible.</span></span> <span data-ttu-id="4cde3-173">Se un'applicazione ha due attività indipendenti, usare le operazioni asincrone e consentirne l'esecuzione in parallelo.</span><span class="sxs-lookup"><span data-stu-id="4cde3-173">If an application has two independent activities, use asynchronous operations and let them run in parallel.</span></span> <span data-ttu-id="4cde3-174">In pratica, la pipeline viene mantenuta piena.</span><span class="sxs-lookup"><span data-stu-id="4cde3-174">Essentially, keep the pipeline full.</span></span>

 

 




