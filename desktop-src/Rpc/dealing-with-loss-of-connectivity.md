---
title: Gestione della perdita di connettività
description: Gestione della perdita di connettività
ms.assetid: a90fcb5a-773e-4c21-bf6c-c3519ec13a09
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: de8e7a8088cfe09a4c4026c16cc3dc5ea36b3430
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "103728866"
---
# <a name="dealing-with-loss-of-connectivity"></a><span data-ttu-id="3fcb9-103">Gestione della perdita di connettività</span><span class="sxs-lookup"><span data-stu-id="3fcb9-103">Dealing with Loss of Connectivity</span></span>

<span data-ttu-id="3fcb9-104">Al termine della chiamata RPC la connessione non viene chiusa. è contrassegnato come disponibile.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-104">After an RPC call completes the connection is not closed; it is marked as free.</span></span> <span data-ttu-id="3fcb9-105">Di conseguenza, il server può essere disattivato o la connettività di rete può andare persa durante o tra le chiamate, mentre una connessione è situata nel pool.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-105">As such, the server can go down or network connectivity can be lost during or between calls, while a connection is sitting in the pool.</span></span> <span data-ttu-id="3fcb9-106">Per quanto riguarda i criteri, il tempo di esecuzione RPC esegue un nuovo tentativo di tali chiamate solo se vengono soddisfatte le due condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="3fcb9-106">As a matter of policy, the RPC run time re-attempts those calls only if the following two conditions are met:</span></span>

-   <span data-ttu-id="3fcb9-107">Il server non può eventualmente eseguire la chiamata o la chiamata è idempotente.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-107">The server cannot possibly execute the call, or the call is idempotent.</span></span>
-   <span data-ttu-id="3fcb9-108">Il client può implementare i tentativi in modo efficiente dalle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-108">The client can implement retries in a performance-efficient manner.</span></span>

<span data-ttu-id="3fcb9-109">I paragrafi seguenti espandono e chiariscono le due condizioni.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-109">The following paragraphs expand and clarify the two conditions.</span></span>

<span data-ttu-id="3fcb9-110">Una chiamata idempotente è una chiamata che può essere eseguita più di una volta nel server senza effetti collaterali indesiderati.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-110">An idempotent call is a call that can be executed more than once on the server without undesirable side effects.</span></span> <span data-ttu-id="3fcb9-111">Ad esempio, la presenza di una chiamata RPC che esegue query sul saldo della banca per un determinato account è idempotente.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-111">For example, having an RPC call that queries the balance in the bank for a given account is idempotent.</span></span> <span data-ttu-id="3fcb9-112">Se questa chiamata viene eseguita due volte a causa della perdita di connettività, non viene eseguito alcun danno.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-112">If this call is executed twice due to loss of connectivity, no harm is done.</span></span> <span data-ttu-id="3fcb9-113">Un altro esempio di chiamata idempotente è la modifica dell'indirizzo di un cliente in un database.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-113">Another example of an idempotent call is changing the address of a customer in a database.</span></span> <span data-ttu-id="3fcb9-114">L'esecuzione di due volte è corretta, perché la seconda esecuzione sostituisce semplicemente l'indirizzo già corrente con lo stesso indirizzo.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-114">Executing twice is fine, since the second execution simply replaces the already-current address with the same address.</span></span> <span data-ttu-id="3fcb9-115">Un'operazione come "sottrazione di 50 dollari dall'account XYZ" non è idempotente.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-115">An operation like "subtract fifty dollars from account xyz" is not idempotent.</span></span> <span data-ttu-id="3fcb9-116">La perdita della connettività di rete non dovrebbe comportare più esecuzioni di una chiamata di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-116">Loss of network connectivity should not result in multiple executions of such a call.</span></span>

<span data-ttu-id="3fcb9-117">Per essere sicuri, il tempo di esecuzione RPC considera tutte le chiamate come non idempotente.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-117">To be safe, the RPC run time treats all calls as non-idempotent.</span></span> <span data-ttu-id="3fcb9-118">L' \[ \] attributo idempotente non è supportato per [**\_ \_ TCP IP ncacn**](/windows/desktop/Midl/ncacn-ip-tcp)e viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-118">The \[idempotent\] attribute is not supported for [**ncacn\_ip\_tcp**](/windows/desktop/Midl/ncacn-ip-tcp), and is ignored.</span></span> <span data-ttu-id="3fcb9-119">Di conseguenza, la prima condizione nell'elenco precedente viene ridotta al *server che non è possibile eseguire la chiamata*.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-119">As such, the first condition in the preceding list is reduced to *the server that cannot possibly execute the call*.</span></span>

<span data-ttu-id="3fcb9-120">In molti casi, il tempo di esecuzione RPC non è in grado di determinare definitivamente la chiamata non è già stata eseguita nel server.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-120">In many cases the RPC run time is unable to conclusively determine the call was not already executed on the server.</span></span> <span data-ttu-id="3fcb9-121">In questi casi, il client non tenterà di eseguire la chiamata.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-121">In such cases, the client will not retry executing the call.</span></span>

<span data-ttu-id="3fcb9-122">Negli esempi seguenti viene illustrato quando il runtime RPC esegue o non tenta una chiamata:</span><span class="sxs-lookup"><span data-stu-id="3fcb9-122">The following examples illustrate when the RPC run time does or does not retry a call:</span></span>

-   <span data-ttu-id="3fcb9-123">Un server è stato riavviato.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-123">A server is rebooted.</span></span>

    <span data-ttu-id="3fcb9-124">Viene eseguita una chiamata RPC semplice senza sicurezza su un'interfaccia in cui non è stata effettuata alcuna chiamata precedente dopo il riavvio.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-124">A simple, no-security RPC call is made on an interface on which no previous call has been made after the reboot.</span></span> <span data-ttu-id="3fcb9-125">Poiché non sono state effettuate chiamate a questa interfaccia, il tempo di esecuzione RPC tenta innanzitutto di negoziare l'utilizzo dell'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-125">Since no calls were made on this interface, the RPC run time first attempts to negotiate use of the interface.</span></span> <span data-ttu-id="3fcb9-126">Invia un pacchetto usando una connessione nel pool.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-126">It sends a packet using a connection in the pool.</span></span> <span data-ttu-id="3fcb9-127">Poiché il server è stato riavviato e la connessione non è più valida, viene restituito un errore.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-127">Since the server was rebooted, and the connection is no longer valid, it returns an error.</span></span> <span data-ttu-id="3fcb9-128">Poiché il tempo di esecuzione RPC sul lato client non ha ancora iniziato a inviare i dati per la chiamata effettiva, il client determina che il server potrebbe non essere stato eseguito su tali dati.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-128">Since the client side RPC run time has not yet started sending the data for the actual call, the client determines that the server could not possibly have executed on those data.</span></span> <span data-ttu-id="3fcb9-129">Quindi, chiude la connessione e cerca un'altra connessione nel pool.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-129">Therefore, it closes the connection and looks for another connection in the pool.</span></span> <span data-ttu-id="3fcb9-130">Se non riesce a trovare una connessione, apre una nuova connessione e tenta di negoziare nuovamente l'uso dell'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-130">If it cannot find a connection, it opens a new connection and tries to negotiate use of the interface again.</span></span> <span data-ttu-id="3fcb9-131">Se l'operazione ha esito positivo, viene eseguita la chiamata, ovvero viene eseguito un nuovo tentativo, perché l'errore è stato rilevato prima dell'avvio della chiamata.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-131">If this succeeds, the call is made (that is, a retry is made, because the failure was detected before the call was started).</span></span>

-   <span data-ttu-id="3fcb9-132">Una chiamata RPC con sicurezza a livello di privacy (crittografia) viene eseguita su una connessione con un contesto di sicurezza già negoziato.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-132">An RPC call with privacy-level security (encryption) is made on a connection with an already-negotiated security context.</span></span>

    <span data-ttu-id="3fcb9-133">Per garantire prestazioni efficienti, il tempo di esecuzione RPC crittografa il pacchetto inline con marshalling (sui dati di testo non crittografato).</span><span class="sxs-lookup"><span data-stu-id="3fcb9-133">To ensure efficient performance, the RPC run time encrypts the marshaled packet inline (over the clear text data).</span></span> <span data-ttu-id="3fcb9-134">Se il tentativo di inviare i dati ha esito negativo, il tempo di esecuzione RPC non può ripetere la chiamata, perché i dati di testo non crittografato sono stati sovrascritti con i dati crittografati e non è possibile crittografarli nuovamente con un nuovo contesto di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-134">If the attempt to send the data fails, the RPC run time cannot retry the call, since the clear text data have been overwritten with the encrypted data, and it cannot re-encrypt the data with a new security context.</span></span> <span data-ttu-id="3fcb9-135">Non viene quindi eseguito alcun tentativo.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-135">Therefore, no retry is made.</span></span>

-   <span data-ttu-id="3fcb9-136">L'invio di un frammento non primo ha esito negativo.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-136">The sending of a non-first fragment fails.</span></span>

    <span data-ttu-id="3fcb9-137">Il nuovo tentativo non viene eseguito perché il tempo di esecuzione RPC può scegliere di rimuovere il contenuto del primo frammento una volta completato e non è in grado di ritentare l'invio del primo frammento.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-137">Retry is not made, since the RPC run time may choose to discard the contents of the first fragment once it is complete, and has no way to retry sending the first fragment.</span></span>

-   <span data-ttu-id="3fcb9-138">La richiesta RPC viene inviata.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-138">The RPC request is sent.</span></span>

    <span data-ttu-id="3fcb9-139">Il server interrompe la connessione.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-139">The server aborts the connection.</span></span> <span data-ttu-id="3fcb9-140">Non viene effettuato alcun tentativo, poiché RPC non è in grado di discernere se il server ha ricevuto la chiamata e ha iniziato a eseguirla.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-140">No retry is attempted, since RPC cannot discern whether the server received the call and started executing it.</span></span>

<span data-ttu-id="3fcb9-141">Se il server utilizza un endpoint dinamico, RPC non risolverà di nuovo l'endpoint durante i tentativi.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-141">If the server uses a dynamic endpoint, RPC will not re-resolve the endpoint during retries.</span></span> <span data-ttu-id="3fcb9-142">Ciò significa che se un server viene disattivato e viene riavviato, può risiedere in un endpoint diverso e RPC non risolvono in modo trasparente l'endpoint quando viene ritentata una chiamata.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-142">This means that if a server is brought down and comes back up, it may reside on a different endpoint, and RPC will not transparently re-resolve the endpoint when a call is retried.</span></span> <span data-ttu-id="3fcb9-143">Per forzare la ririsoluzione dell'endpoint, il client RPC deve chiamare [**RpcBindingReset**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingreset) prima di eseguire un nuovo tentativo di chiamata.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-143">To force re-resolving of the endpoint, the RPC client should calling [**RpcBindingReset**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingreset) before it retries a call.</span></span>

<span data-ttu-id="3fcb9-144">In molti di questi casi, se un client RPC è in grado di determinare se una chiamata è idempotente o se mantiene i dati ignorati da RPC, può scegliere di compilare un meccanismo di ripetizione dei tentativi in RPC.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-144">In many of these cases, if an RPC client can determine whether a call is idempotent, or if it keeps data that RPC discards, it may choose to build a retry mechanism on top of RPC.</span></span>

> [!Note]  
> <span data-ttu-id="3fcb9-145">Se il server è un cluster e i diversi nodi del cluster eseguono versioni diverse del software server, un nuovo tentativo RPC può causare la chiamata su un nodo diverso del cluster in caso di failover e potenzialmente su una versione diversa del server.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-145">If the server is a cluster, and the different nodes of the cluster run different versions of the server software, an RPC retry may land the call on a different node of the cluster in the case of failover, and potentially on a different version of the server.</span></span> <span data-ttu-id="3fcb9-146">In questi scenari di distribuzione, assicurarsi che il client non si basi su una versione specifica del software server per eseguire una determinata chiamata.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-146">In such deployment scenarios, make sure the client does not rely on a particular version of the server software to execute a given call.</span></span> <span data-ttu-id="3fcb9-147">In caso contrario, il client deve compilare un meccanismo su RPC che rileva e gestisce tali condizioni.</span><span class="sxs-lookup"><span data-stu-id="3fcb9-147">If it does, the client should build a mechanism on top of RPC that detects and handles such conditions.</span></span>

 

 

 