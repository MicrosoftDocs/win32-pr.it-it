---
title: Scelta delle opzioni QOS di sicurezza
description: Le opzioni QOS di sicurezza vengono passate come parte del parametro SecurityQOS specificato per la funzione RpcBindingSetAuthInfoEx. Utilizzare le seguenti procedure consigliate.
ms.assetid: 43befe3d-079a-4389-a1ff-6bda90935769
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8c286b516438eae78117ef8d73939c3b4bed396d
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "106300330"
---
# <a name="choosing-security-qos-options"></a><span data-ttu-id="d68b8-104">Scelta delle opzioni QOS di sicurezza</span><span class="sxs-lookup"><span data-stu-id="d68b8-104">Choosing Security QOS Options</span></span>

<span data-ttu-id="d68b8-105">Le opzioni QOS di sicurezza vengono passate come parte del parametro *SecurityQOS* specificato per la funzione [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) .</span><span class="sxs-lookup"><span data-stu-id="d68b8-105">The security QOS options are passed as part of the *SecurityQOS* parameter given to the [**RpcBindingSetAuthInfoEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetauthinfoexa) function.</span></span> <span data-ttu-id="d68b8-106">Utilizzare le seguenti procedure consigliate.</span><span class="sxs-lookup"><span data-stu-id="d68b8-106">Use the following best practices.</span></span>

## <a name="use-mutual-authentication"></a><span data-ttu-id="d68b8-107">Usare l'autenticazione reciproca</span><span class="sxs-lookup"><span data-stu-id="d68b8-107">Use Mutual Authentication</span></span>

<span data-ttu-id="d68b8-108">L'autenticazione reciproca vera e propria è disponibile solo per determinati provider di sicurezza: Negotiate (when it negotiates Kerberos), Kerberos e Schannel.</span><span class="sxs-lookup"><span data-stu-id="d68b8-108">True mutual authentication is available only for certain security providers: Negotiate (when it negotiates Kerberos), Kerberos, and Schannel.</span></span> <span data-ttu-id="d68b8-109">NTLM non supporta l'autenticazione reciproca.</span><span class="sxs-lookup"><span data-stu-id="d68b8-109">NTLM does not support mutual authentication.</span></span> <span data-ttu-id="d68b8-110">Per utilizzare l'autenticazione reciproca, è necessario fornire un nome di entità server ben formato.</span><span class="sxs-lookup"><span data-stu-id="d68b8-110">Using mutual authentication requires that a well formed server principal name be provided.</span></span> <span data-ttu-id="d68b8-111">Molti sviluppatori utilizzano la seguente procedura di sicurezza non funzionante: il server viene chiamato per richiedere il nome principale ([**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname)) e quindi richiede l'autenticazione reciproca usando il nome dell'entità.</span><span class="sxs-lookup"><span data-stu-id="d68b8-111">Many developers use the following faulty security practice: The server is called to ask for its principal name ([**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname)), and then they blindly ask for mutual authentication using that principal name.</span></span> <span data-ttu-id="d68b8-112">Questo approccio interrompe l'intera idea dell'autenticazione reciproca. il concetto di autenticazione reciproca è che vengono chiamati solo determinati server perché sono attendibili per l'analisi e la gestione dei dati.</span><span class="sxs-lookup"><span data-stu-id="d68b8-112">This approach breaks the whole idea of mutual authentication; the idea of mutual authentication is that only certain servers are called because they are trusted to parse and handle your data.</span></span> <span data-ttu-id="d68b8-113">Utilizzando la procedura di sicurezza difettosa appena descritta, gli sviluppatori forniscono i dati a chiunque intelligente per restituirne il nome.</span><span class="sxs-lookup"><span data-stu-id="d68b8-113">Using the faulty security practice just described, developers give their data to anyone smart enough to return their name.</span></span>

<span data-ttu-id="d68b8-114">Ad esempio, se il software client deve chiamare solo un server in esecuzione con gli account di Joe, Pete o Alice, è necessario chiamare la funzione [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname) e il nome restituito deve essere controllato.</span><span class="sxs-lookup"><span data-stu-id="d68b8-114">As an example, if the client software should call only a server running under Joe, Pete, or Alice's accounts, the [**RpcMgmtInqServerPrincName**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcmgmtinqserverprincname) function should be called, and the name sent back should be checked.</span></span> <span data-ttu-id="d68b8-115">Se è Joe, Pete o Alice, è necessario richiedere l'autenticazione reciproca usando il nome dell'entità server.</span><span class="sxs-lookup"><span data-stu-id="d68b8-115">If it is Joe, Pete or Alice, mutual authentication should be requested using their server principal name.</span></span> <span data-ttu-id="d68b8-116">Ciò garantisce che entrambe le metà della conversazione vadano alla stessa entità.</span><span class="sxs-lookup"><span data-stu-id="d68b8-116">This ensures both halves of the conversation go to the same principal.</span></span>

<span data-ttu-id="d68b8-117">Se il software client deve chiamare un servizio in esecuzione solo con l'account di Joe, comporre direttamente il nome dell'entità server di Joe ed effettuare la chiamata.</span><span class="sxs-lookup"><span data-stu-id="d68b8-117">If client software should call a service running under Joe's account only, directly compose Joe's server principal name and make the call.</span></span> <span data-ttu-id="d68b8-118">Se il server non è Joe, la chiamata avrà semplicemente esito negativo.</span><span class="sxs-lookup"><span data-stu-id="d68b8-118">If the server is not Joe, the call will simply fail.</span></span>

<span data-ttu-id="d68b8-119">In molti casi, i servizi vengono eseguiti come servizi di sistema Windows, il che significa che vengono eseguiti con l'account del computer.</span><span class="sxs-lookup"><span data-stu-id="d68b8-119">Many times, services run as Windows system services, which means they run under the machine account.</span></span> <span data-ttu-id="d68b8-120">È comunque consigliabile usare l'autenticazione reciproca e la creazione di un nome dell'entità server.</span><span class="sxs-lookup"><span data-stu-id="d68b8-120">Mutual authentication and creation of a server principal name is still recommended.</span></span>

## <a name="use-the-lowest-impersonationtype-that-allows-the-call-to-go-through"></a><span data-ttu-id="d68b8-121">Usare il ImpersonationType più basso che consente la chiamata al passaggio</span><span class="sxs-lookup"><span data-stu-id="d68b8-121">Use the Lowest ImpersonationType that Allows the Call to Go Through</span></span>

<span data-ttu-id="d68b8-122">Questa procedura consigliata è piuttosto chiara.</span><span class="sxs-lookup"><span data-stu-id="d68b8-122">This Best Practice is fairly self explanatory.</span></span> <span data-ttu-id="d68b8-123">Anche se viene usata l'autenticazione reciproca, non concedere al server più diritti del necessario; un server legittimo potrebbe essere stato compromesso e anche se i dati inviati rientrano nelle mani sbagliate in questi casi, almeno il server non sarà in grado di accedere ad altri dati sulla rete per conto dell'utente.</span><span class="sxs-lookup"><span data-stu-id="d68b8-123">Even if mutual authentication is used, do not give the server more rights than necessary; a legitimate server may have been compromised, and even though the data you send falls into the wrong hands in such cases, at least the server will not be able to access other data on the network on your behalf.</span></span> <span data-ttu-id="d68b8-124">Alcuni server rifiuteranno una chiamata che non dispone di informazioni sufficienti per determinare ed eventualmente rappresentare il chiamante.</span><span class="sxs-lookup"><span data-stu-id="d68b8-124">Some servers will reject a call that does not have sufficient information to determine, and possibly impersonate, the caller.</span></span> <span data-ttu-id="d68b8-125">Tenere inoltre presente che alcune sequenze di protocollo supportano la sicurezza a livello di trasporto ([**ncacn \_ NP**](/windows/desktop/Midl/ncacn-np) e [**ncalrpc**](/windows/desktop/Midl/ncalrpc)).</span><span class="sxs-lookup"><span data-stu-id="d68b8-125">Also, be aware that some protocol sequences support transport level security ([**ncacn\_np**](/windows/desktop/Midl/ncacn-np) and [**ncalrpc**](/windows/desktop/Midl/ncalrpc)).</span></span> <span data-ttu-id="d68b8-126">In questi casi, il server può sempre rappresentare l'utente se si specifica un livello di rappresentazione sufficientemente elevato tramite il parametro *NetworkOptions* durante la creazione dell'handle di associazione.</span><span class="sxs-lookup"><span data-stu-id="d68b8-126">In such cases, the server can always impersonate you if you specify a sufficiently high impersonation level through the *NetworkOptions* parameter when you create the binding handle.</span></span>

<span data-ttu-id="d68b8-127">Infine, alcuni provider o trasporti di sicurezza possono imbattersi in modo trasparente ImpersonationType a un livello superiore rispetto a quello specificato.</span><span class="sxs-lookup"><span data-stu-id="d68b8-127">Finally, some security providers or transports may transparently bump ImpersonationType to a higher level than that specified.</span></span> <span data-ttu-id="d68b8-128">Quando si sviluppa un programma, assicurarsi di provare a effettuare chiamate con il ImpersonationType previsto e verificare se si sta ottenendo una ImpersonationType superiore sul server.</span><span class="sxs-lookup"><span data-stu-id="d68b8-128">When developing a program, make sure you try to make calls with the intended ImpersonationType and check whether you are getting higher ImpersonationType on the server.</span></span>

 

 