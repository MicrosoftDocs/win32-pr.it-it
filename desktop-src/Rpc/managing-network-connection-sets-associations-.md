---
title: Gestione dei set di connessioni di rete (associazioni)
description: A partire da Windows 2000, il tempo di esecuzione RPC può mantenere più di una connessione tra il client e il server.
ms.assetid: 9b9c42e9-8ed5-46a6-b6ec-4093ce0128bb
keywords:
- Gestione dei set di connessioni di rete
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 81e99afe23d90e44d85dc7a2ec9301b45e1f20b1
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/16/2019
ms.locfileid: "104221785"
---
# <a name="managing-network-connection-sets-associations"></a><span data-ttu-id="5b627-104">Gestione dei set di connessioni di rete (associazioni)</span><span class="sxs-lookup"><span data-stu-id="5b627-104">Managing Network Connection Sets (Associations)</span></span>

<span data-ttu-id="5b627-105">A partire da Windows 2000, il tempo di esecuzione RPC può mantenere più di una connessione tra il client e il server.</span><span class="sxs-lookup"><span data-stu-id="5b627-105">Starting with Windows 2000, the RPC run time may maintain more than one connection between the client and the server.</span></span> <span data-ttu-id="5b627-106">Ciò semplifica l'operazione sui trasporti che non supportano la modifica dell'identità client senza ristabilire la connessione, i client multithread e i client asincroni.</span><span class="sxs-lookup"><span data-stu-id="5b627-106">This facilitates operation on transports that do not support changing the client identity without reestablishing the connection, multithreaded clients, and asynchronous clients.</span></span> <span data-ttu-id="5b627-107">Il set di connessioni tra un processo client e un endpoint server è detto *associazione* nella terminologia RPC.</span><span class="sxs-lookup"><span data-stu-id="5b627-107">The set of connections between a client process and a server endpoint is called an *association* in RPC terminology.</span></span> <span data-ttu-id="5b627-108">La comprensione delle associazioni può migliorare l'implementazione di RPC.</span><span class="sxs-lookup"><span data-stu-id="5b627-108">Understanding associations can improve the implementation of RPC.</span></span>

<span data-ttu-id="5b627-109">In uno scenario di identità a singolo thread e singolo client, RPC apre una connessione tra un processo client e un endpoint server per eseguire chiamate RPC.</span><span class="sxs-lookup"><span data-stu-id="5b627-109">In a single-thread, single-client identity scenario, RPC opens one connection between a client process and a server endpoint to make RPC calls.</span></span> <span data-ttu-id="5b627-110">Quando viene eseguita una chiamata RPC sincrona, il client invia la richiesta al server in questa connessione e riceve anche la risposta.</span><span class="sxs-lookup"><span data-stu-id="5b627-110">When a synchronous RPC call is made, the client sends the request to the server on this connection, and receives the reply on it as well.</span></span> <span data-ttu-id="5b627-111">Quando aumenta il numero di thread che effettuano chiamate RPC nel processo client, l'identità di sicurezza del client può cambiare.</span><span class="sxs-lookup"><span data-stu-id="5b627-111">When the number of threads making RPC calls in the client process grows, the security identity of the client can change.</span></span> <span data-ttu-id="5b627-112">Quando le chiamate asincrone/pipe vengono combinate con chiamate sincrone sul client, RPC potrebbe richiedere più di una connessione di rete.</span><span class="sxs-lookup"><span data-stu-id="5b627-112">When asynchronous/pipe calls are mixed with synchronous calls on the client, RPC may need more than one network connection.</span></span> <span data-ttu-id="5b627-113">Tutte le connessioni nel set vengono inserite in un pool di connessioni denominato associazione.</span><span class="sxs-lookup"><span data-stu-id="5b627-113">All connections in the set are put in a connection pool called an association.</span></span>

<span data-ttu-id="5b627-114">Una chiamata di procedura remota sincrona usa esclusivamente una determinata connessione per essere conforme agli standard RPC.</span><span class="sxs-lookup"><span data-stu-id="5b627-114">A synchronous remote procedure call exclusively uses a given connection to conform with RPC standards.</span></span> <span data-ttu-id="5b627-115">Una connessione utilizzata da una chiamata RPC sincrona è considerata occupata se è stata inviata una richiesta, ma non è stata ricevuta alcuna risposta.</span><span class="sxs-lookup"><span data-stu-id="5b627-115">A connection used by a synchronous RPC call is considered busy if a request has been sent, but a response has not been received.</span></span> <span data-ttu-id="5b627-116">Nessun altro traffico consentito sulla connessione fino a quando non viene ricevuta la risposta.</span><span class="sxs-lookup"><span data-stu-id="5b627-116">No other traffic is allowed on that connection until the response is received.</span></span> <span data-ttu-id="5b627-117">Il tempo di esecuzione RPC tenta di eseguire il multiplexing di chiamate RPC asincrone e pipe sulla stessa connessione.</span><span class="sxs-lookup"><span data-stu-id="5b627-117">The RPC run time attempts to multiplex asynchronous and pipe RPC calls on the same connection.</span></span> <span data-ttu-id="5b627-118">Le chiamate sincrone e asincrone/pipe non possono essere combinate nella stessa connessione, il che significa che una determinata connessione può essere utilizzata per chiamate RPC sincrone o per chiamate RPC asincrone/pipe.</span><span class="sxs-lookup"><span data-stu-id="5b627-118">Synchronous and asynchronous/pipe calls cannot be mixed on the same connection, which means that a given connection can be used for either synchronous RPC calls or for asynchronous/pipe RPC calls.</span></span>

<span data-ttu-id="5b627-119">RPC tenta di riutilizzare in modo aggressivo le connessioni dal pool.</span><span class="sxs-lookup"><span data-stu-id="5b627-119">RPC aggressively tries to reuse connections from the pool.</span></span> <span data-ttu-id="5b627-120">Quando viene effettuata una nuova chiamata RPC, RPC tenta di trovare una connessione appropriata dal pool e crea una nuova connessione solo se non è possibile trovare una connessione appropriata.</span><span class="sxs-lookup"><span data-stu-id="5b627-120">When a new RPC call is made, RPC attempts to find a suitable connection from the pool, and creates a new connection only if a suitable connection cannot be found.</span></span> <span data-ttu-id="5b627-121">Affinché una connessione venga considerata adatta, è necessario:</span><span class="sxs-lookup"><span data-stu-id="5b627-121">For a connection to be considered suitable, it must:</span></span>

-   <span data-ttu-id="5b627-122">Essere del tipo appropriato (sincrono o asincrono/pipe).</span><span class="sxs-lookup"><span data-stu-id="5b627-122">Be of the appropriate type (synchronous, or asynchronous/pipe).</span></span>
-   <span data-ttu-id="5b627-123">È gratuito.</span><span class="sxs-lookup"><span data-stu-id="5b627-123">Be free.</span></span>
-   <span data-ttu-id="5b627-124">Avere la stessa identità di sicurezza dell'handle di associazione in cui viene effettuata la chiamata.</span><span class="sxs-lookup"><span data-stu-id="5b627-124">Have the same security identity as the binding handle on which the call is made.</span></span> <span data-ttu-id="5b627-125">Se viene utilizzato il rilevamento dinamico delle identità, l'identità dell'handle di associazione viene aggiornata dal token del thread all'inizio della chiamata.</span><span class="sxs-lookup"><span data-stu-id="5b627-125">If dynamic identity tracking is used, the identity of the binding handle is refreshed from the thread token at the beginning of the call.</span></span> <span data-ttu-id="5b627-126">Se viene utilizzato il rilevamento statico delle identità, viene utilizzata l'identità del client contrassegnata sull'handle di associazione.</span><span class="sxs-lookup"><span data-stu-id="5b627-126">If static identity tracking is used, the client identity stamped on the binding handle is used.</span></span>

<span data-ttu-id="5b627-127">Quando la chiamata è completa, una volta ricevuta la risposta, la connessione viene contrassegnata come disponibile e può essere utilizzata per altre chiamate RPC.</span><span class="sxs-lookup"><span data-stu-id="5b627-127">When the call is complete, once the response is received, the connection is marked as free and can be used for other RPC calls.</span></span>

<span data-ttu-id="5b627-128">Impossibile modificare l'identità di sicurezza di una connessione.</span><span class="sxs-lookup"><span data-stu-id="5b627-128">The security identity on a connection cannot change.</span></span> <span data-ttu-id="5b627-129">Se, ad esempio, un numero elevato di chiamate allo stesso server viene eseguito con diverse identità di sicurezza, il numero di connessioni nel pool di thread aumenta.</span><span class="sxs-lookup"><span data-stu-id="5b627-129">For example, if a large number of calls to the same server are made under different security identities, the number of connections in the thread pool grows.</span></span> <span data-ttu-id="5b627-130">L'associazione stessa è conteggiata come riferimento e, quando tutti i riferimenti sono finiti, arresta e chiude tutte le connessioni.</span><span class="sxs-lookup"><span data-stu-id="5b627-130">The association itself is reference-counted, and when all references are gone, it stops and closes all connections.</span></span> <span data-ttu-id="5b627-131">Ogni handle di binding e ogni handle di contesto contengono un riferimento nell'associazione.</span><span class="sxs-lookup"><span data-stu-id="5b627-131">Every binding handle and every context handle hold a reference on the association.</span></span> <span data-ttu-id="5b627-132">Quando tutti sono chiusi, l'associazione scompare.</span><span class="sxs-lookup"><span data-stu-id="5b627-132">When all are closed, the association disappears.</span></span> <span data-ttu-id="5b627-133">In Windows XP le associazioni non devono necessariamente scomparire immediatamente; potrebbero rimanere per un breve periodo di tempo (il periodo di destinazione è di 20 secondi, ma il tempo di esecuzione RPC può scegliere di ritardare l'eliminazione dell'associazione se non sono disponibili thread per l'esecuzione dell'attività).</span><span class="sxs-lookup"><span data-stu-id="5b627-133">On Windows XP, associations do not necessarily disappear immediately; they may remain for a short period (the target period is 20 seconds, but the RPC run time may choose to delay destroying the association if no threads are available to execute the task).</span></span> <span data-ttu-id="5b627-134">Se non si desidera che l'associazione resti attiva dopo la chiusura dell'ultimo handle di contesto/binding, utilizzare l' \_ \_ opzione relativa al consenso esplicito di RPC C \_ \_ per forzare il runtime RPC alla chiusura immediata della connessione.</span><span class="sxs-lookup"><span data-stu-id="5b627-134">If you do not want the association to stay alive after the last context handle/binding handle is closed, use the RPC\_C\_OPT\_DONT\_LINGER option to force the RPC Runtime to immediately close the connection.</span></span>

 

 




