---
title: Semantica degli errori per gli handle di contesto
description: In questo argomento viene illustrata la semantica degli errori per gli handle di contesto.
ms.assetid: fcf28519-39ad-4823-bc27-f3502e4d540c
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c4528b3f5160b92a4e6f10dbcf877e9fec59f81b
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/16/2019
ms.locfileid: "104044777"
---
# <a name="failure-semantics-for-context-handles"></a><span data-ttu-id="d2969-103">Semantica degli errori per gli handle di contesto</span><span class="sxs-lookup"><span data-stu-id="d2969-103">Failure Semantics for Context Handles</span></span>

<span data-ttu-id="d2969-104">In questo argomento viene illustrata la semantica degli errori per gli handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="d2969-104">This topic discusses failure semantics for context handles.</span></span>

## <a name="failure-semantics-when-closing-the-context-handle-fails"></a><span data-ttu-id="d2969-105">Semantica degli errori durante la chiusura dell'handle del contesto non riuscita</span><span class="sxs-lookup"><span data-stu-id="d2969-105">Failure Semantics when Closing the Context Handle Fails</span></span>

<span data-ttu-id="d2969-106">Si supponga che un'applicazione client tenti di chiudere un handle di contesto aperto sul server, senza arrestare il processo client.</span><span class="sxs-lookup"><span data-stu-id="d2969-106">Imagine a client application is attempting to close a context handle it opened on the server, without shutting down the client process.</span></span> <span data-ttu-id="d2969-107">Si supponga inoltre che la chiamata al server per chiudere l'handle di contesto abbia esito negativo, ad esempio se il client ha esaurito la memoria.</span><span class="sxs-lookup"><span data-stu-id="d2969-107">Also, assume the call to the server to close the context handle fails (for example, the client is out of memory).</span></span> <span data-ttu-id="d2969-108">Il modo corretto per gestire questa situazione consiste nel chiamare la funzione [**RpcSsDestroyClientContext**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcssdestroyclientcontext) .</span><span class="sxs-lookup"><span data-stu-id="d2969-108">The proper way to handle this situation is to call the [**RpcSsDestroyClientContext**](/windows/desktop/api/Rpcndr/nf-rpcndr-rpcssdestroyclientcontext) function.</span></span> <span data-ttu-id="d2969-109">In tal caso il client pulisce il proprio lato dell'handle di contesto e abortively chiude la connessione al server.</span><span class="sxs-lookup"><span data-stu-id="d2969-109">In such a case the client cleans up its side of the context handle, and abortively closes the connection to the server.</span></span> <span data-ttu-id="d2969-110">Poiché la connessione è effettivamente un pool di connessioni (vedere [RPC e la rete](rpc-and-the-network.md)), che è conteggiato come riferimento con un riferimento per ogni binding aperto o handle di contesto, la distruzione dell'handle del contesto chiamando la funzione **RpcSsDestroyClientContext** non elimina effettivamente la connessione.</span><span class="sxs-lookup"><span data-stu-id="d2969-110">Since the connection is really a connection pool (see [RPC and the Network](rpc-and-the-network.md)), which is reference-counted with one reference for each opened binding or context handle, destroying the context handle by calling the **RpcSsDestroyClientContext** function does not actually destroy the connection.</span></span> <span data-ttu-id="d2969-111">Ma decrementa il conteggio dei riferimenti per il pool di connessioni.</span><span class="sxs-lookup"><span data-stu-id="d2969-111">Rather, it decrements the reference count for the connection pool.</span></span> <span data-ttu-id="d2969-112">Per chiudere le connessioni nel pool, è necessario che il client chiuda tutti gli handle di binding e gli handle di contesto al server dal processo client.</span><span class="sxs-lookup"><span data-stu-id="d2969-112">For connections in the pool to be closed, the client needs to close all binding handles and context handles to that server from the client process.</span></span> <span data-ttu-id="d2969-113">Tutte le connessioni nel pool vengono chiuse e il meccanismo di esecuzione del server viene avviato e pulito.</span><span class="sxs-lookup"><span data-stu-id="d2969-113">Then all connections in the pool are closed, and the server run-down mechanism is initiated and cleans up.</span></span>

## <a name="failure-semantics-during-change-of-state-of-the-context-handle"></a><span data-ttu-id="d2969-114">Semantica degli errori durante la modifica dello stato dell'handle di contesto</span><span class="sxs-lookup"><span data-stu-id="d2969-114">Failure Semantics During Change of State of the Context Handle</span></span>

<span data-ttu-id="d2969-115">Le informazioni contenute in questa sezione si riferiscono a piattaforme Windows XP e versioni successive.</span><span class="sxs-lookup"><span data-stu-id="d2969-115">The information in this section refers to Windows XP and later platforms.</span></span>

<span data-ttu-id="d2969-116">Gli handle di contesto sono semplicemente parametri di una funzione.</span><span class="sxs-lookup"><span data-stu-id="d2969-116">Context handles are simply parameters to a function.</span></span> <span data-ttu-id="d2969-117">Tutte le modifiche apportate allo stato di un handle di contesto si verificano quando viene eseguito il marshalling o l'unmarshalling dei parametri.</span><span class="sxs-lookup"><span data-stu-id="d2969-117">All changes in the state of a context handle happen when parameters are marshaled or unmarshaled.</span></span> <span data-ttu-id="d2969-118">Se, ad esempio, un client apre un handle del contesto (lo modifica da **null** a non **null**), la fase di esecuzione RPC non apre effettivamente la parte RPC dell'handle fino a quando non viene eseguito il marshalling degli argomenti per l'invio al client.</span><span class="sxs-lookup"><span data-stu-id="d2969-118">For example, if a client opens a context handle (changes it from **NULL** to non-**NULL**), the RPC run-time does not actually open the RPC portion of the handle until the arguments are marshaled for sending to the client.</span></span> <span data-ttu-id="d2969-119">Possono verificarsi errori durante il frattempo.</span><span class="sxs-lookup"><span data-stu-id="d2969-119">Failures can occur during the interim.</span></span> <span data-ttu-id="d2969-120">A causa di una varietà di possibili condizioni di rete o risorse insufficienti, la trasmissione del pacchetto al client potrebbe non riuscire.</span><span class="sxs-lookup"><span data-stu-id="d2969-120">Due to a variety of possible network or low resource conditions, transmission of the packet to the client could fail.</span></span> <span data-ttu-id="d2969-121">In alternativa, la routine del server può generare un'eccezione durante il tentativo di modificare un handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="d2969-121">Or the server routine may throw an exception while attempting to change a context handle.</span></span> <span data-ttu-id="d2969-122">In queste o in altre situazioni di errore, il client e il server possono ottenere visualizzazioni incoerenti dell'handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="d2969-122">In these or other failure situations, the client and server may get inconsistent views of the context handle.</span></span> <span data-ttu-id="d2969-123">Questa sezione illustra la regola per lo stato dell'handle di contesto e la responsabilità del codice client e server durante le varie condizioni di errore.</span><span class="sxs-lookup"><span data-stu-id="d2969-123">This section explains the rule for the state of the context handle, and the responsibility of client and server code during various failure conditions.</span></span>

-   <span data-ttu-id="d2969-124">Arriva un handle di contesto **null** , ma la routine del server rileva un errore e genera un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="d2969-124">A **NULL** context handle arrives, but the server routine encounters a failure and throws an exception.</span></span>

    <span data-ttu-id="d2969-125">La routine del server è responsabile della pulizia di qualsiasi stato correlato all'handle di contesto creato.</span><span class="sxs-lookup"><span data-stu-id="d2969-125">It is the responsibility of the server routine to clean up any context handle–related state it may have created.</span></span> <span data-ttu-id="d2969-126">Il tempo di esecuzione RPC pulisce il proprio stato.</span><span class="sxs-lookup"><span data-stu-id="d2969-126">The RPC run time cleans up its state.</span></span>

-   <span data-ttu-id="d2969-127">Arrivano gli handle di contesto non **null** , ma la routine del server rileva un errore e genera un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="d2969-127">A non-**NULL** context handles arrives, but the server routine encounters a failure and throws an exception.</span></span>

    <span data-ttu-id="d2969-128">Se la routine del server ha chiuso l'handle del contesto, il client non sarà in grado di conoscerlo, perché la chiamata avrà esito negativo. un ulteriore utilizzo dell'handle di contesto comporterà un \_ \_ errore di \_ mancata corrispondenza del contesto RPC X SS nel \_ client.</span><span class="sxs-lookup"><span data-stu-id="d2969-128">If the server routine closed the context handle, the client will not know about it, since the call will not succeed; further use of the context handle will result in an RPC\_X\_SS\_CONTEXT\_MISMATCH error on the client.</span></span> <span data-ttu-id="d2969-129">Se la routine del server non modifica l'handle del contesto, il client può comunque utilizzarlo.</span><span class="sxs-lookup"><span data-stu-id="d2969-129">If the server routine does not modify the context handle, the client can still use it.</span></span> <span data-ttu-id="d2969-130">Se la routine del server modifica le informazioni archiviate nel contesto del server, le nuove chiamate del client utilizzeranno tali informazioni.</span><span class="sxs-lookup"><span data-stu-id="d2969-130">If the server routine changes the information stored in the server context, new calls from the client will use that information.</span></span>

-   <span data-ttu-id="d2969-131">Arriva un handle di contesto non **null** e la routine del server chiude l'handle, ma il marshalling dopo il marshalling dell'handle di contesto non è riuscito o l'elaborazione dopo il marshalling non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="d2969-131">A non-**NULL** context handle arrives, and the server routine closes the handle, but either marshaling after the context handle was marshaled failed, or processing after marshaling failed.</span></span>

    <span data-ttu-id="d2969-132">L'handle del contesto viene chiuso e le chiamate successive da questo client usando questo handle di contesto generano \_ un \_ \_ errore di mancata corrispondenza del contesto RPC X SS nel \_ client.</span><span class="sxs-lookup"><span data-stu-id="d2969-132">The context handle is closed, and further calls by this client using this context handle result in an RPC\_X\_SS\_CONTEXT\_MISMATCH error on the client.</span></span>

-   <span data-ttu-id="d2969-133">Viene ricevuto un handle di contesto **null** e il server crea il contesto per questo handle, ma il marshalling dopo il marshalling dell'handle di contesto non è riuscito o l'elaborazione dopo il marshalling non è riuscita.</span><span class="sxs-lookup"><span data-stu-id="d2969-133">A **NULL** context handle arrives, and the server creates its context for this handle, but either marshaling after the context handle was marshaled failed, or processing after marshaling failed.</span></span>

    <span data-ttu-id="d2969-134">In questo caso, il tempo di esecuzione RPC richiama l'esecuzione per questo handle di contesto e pulisce lo stato RPC per questo handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="d2969-134">In this case, the RPC run time invokes the run down for this context handle, and cleans up the RPC state for this context handle.</span></span> <span data-ttu-id="d2969-135">L'handle del contesto non verrà creato sul lato client.</span><span class="sxs-lookup"><span data-stu-id="d2969-135">The context handle will not be created on the client side.</span></span>

-   <span data-ttu-id="d2969-136">Viene ricevuto un handle di contesto non **null** e il server non modifica l'handle del contesto o modifica le informazioni archiviate nel contesto del server e il marshalling ha esito negativo dopo il marshalling dell'handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="d2969-136">A non-**NULL** context handle arrives, and the server either does not change the context handle, or it changes the information stored in the server context, and marshaling fails after the context handle is marshaled.</span></span>

    <span data-ttu-id="d2969-137">Le nuove chiamate dal client utilizzeranno l'handle di contesto del server.</span><span class="sxs-lookup"><span data-stu-id="d2969-137">New calls from the client will use the context handle that the server has.</span></span>

-   <span data-ttu-id="d2969-138">Arriva un handle di contesto **null** e il server non lo imposta su un valore diverso da **null**, ma la chiamata ha esito negativo prima del marshalling dell'handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="d2969-138">A **NULL** context handle arrives, and the server does not set it to anything other than **NULL**, but the call fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="d2969-139">In questo caso, non viene creato alcun handle di contesto nel client.</span><span class="sxs-lookup"><span data-stu-id="d2969-139">In this case, no context handle is created on the client.</span></span>

-   <span data-ttu-id="d2969-140">Arriva un handle di contesto non **null** e il server lo imposta su **null**, ma il marshalling ha esito negativo prima del marshalling dell'handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="d2969-140">A non-**NULL** context handle arrives, and the server sets it to **NULL**, but marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="d2969-141">In questo caso, l'handle di contesto rimane chiuso sul server e il client ottiene gli \_ \_ \_ errori di contesto RPC X SS \_ quando tenta di usare l'handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="d2969-141">In this case, the context handle remains closed on the server, and the client gets RPC\_X\_SS\_CONTEXT\_MISMATCH errors when it tries to use the context handle.</span></span>

-   <span data-ttu-id="d2969-142">Un handle di contesto **null** arriva sul server e il server lo imposta su un valore diverso da **null**, ma il marshalling ha esito negativo prima del marshalling dell'handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="d2969-142">A **NULL** context handle arrives on the server, and the server sets it to non-**NULL**, but marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="d2969-143">È necessario richiamare l'handle del contesto in modo che sia possibile eseguire la pulizia del server e non venga creato alcun handle di contesto nel client.</span><span class="sxs-lookup"><span data-stu-id="d2969-143">The context handle run down is to be invoked so that the server can clean up, and no context handle will be created on the client.</span></span>

-   <span data-ttu-id="d2969-144">Viene ricevuto un handle di contesto non **null** e il server non modifica l'handle del contesto o modifica le informazioni archiviate nel contesto del server e il marshalling ha esito negativo prima del marshalling dell'handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="d2969-144">A non-**NULL** context handle arrives, and the server either does not change the context handle, or it changes the information stored in the server context, and marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="d2969-145">Le nuove chiamate dal client utilizzeranno lo stato nel server.</span><span class="sxs-lookup"><span data-stu-id="d2969-145">New calls from the client will use the state on the server.</span></span>

-   <span data-ttu-id="d2969-146">Un handle di contesto viene dichiarato come valore restituito e la routine del server restituisce **null** per l'handle del contesto e il marshalling ha esito negativo prima del marshalling dell'handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="d2969-146">A context handle is declared as a return value, and the server routine returns **NULL** for the context handle and marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="d2969-147">In questo caso, non viene creato alcun nuovo contesto nel client.</span><span class="sxs-lookup"><span data-stu-id="d2969-147">In this case, no new context is created on the client.</span></span>

-   <span data-ttu-id="d2969-148">Un handle di contesto viene dichiarato come valore restituito e la routine del server restituisce un valore diverso da **null** per l'handle del contesto e il marshalling ha esito negativo prima del marshalling dell'handle di contesto.</span><span class="sxs-lookup"><span data-stu-id="d2969-148">A context handle is declared as a return value, and the server routine returns non-**NULL** for the context handle and marshaling fails before the context handle is marshaled.</span></span>

    <span data-ttu-id="d2969-149">Il tempo di esecuzione RPC chiama la routine di esecuzione dell'handle di contesto per dare la possibilità di eseguire la pulizia e non viene creato alcun nuovo contesto nel client.</span><span class="sxs-lookup"><span data-stu-id="d2969-149">The RPC run time calls the context handle run-down routine to give it a chance to clean up, and no new context is created on the client.</span></span>

 

 




