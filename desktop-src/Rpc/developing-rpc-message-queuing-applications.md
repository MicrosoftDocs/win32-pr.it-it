---
title: Sviluppo di applicazioni di Accodamento RPC-Message
description: Per sfruttare al meglio il trasporto MSMQ nell'applicazione RPC, è necessario molto poco sforzo.
ms.assetid: 1ea97df8-cdf5-43b8-88aa-9e8fa6ae845a
keywords:
- RPC (Remote Procedure Call), attività, sviluppo di applicazioni di Accodamento messaggi
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f3e51707c0a6903200e51dd35e50e998430c8eae
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "104047250"
---
# <a name="developing-rpc-message-queuing-applications"></a><span data-ttu-id="d9b4a-104">Sviluppo di applicazioni di Accodamento RPC-Message</span><span class="sxs-lookup"><span data-stu-id="d9b4a-104">Developing RPC-Message Queuing Applications</span></span>

<span data-ttu-id="d9b4a-105">Per sfruttare al meglio il trasporto MSMQ nell'applicazione RPC, è necessario molto poco sforzo.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-105">Very little effort is necessary to take advantage of the MSMQ transport in your RPC application.</span></span> <span data-ttu-id="d9b4a-106">Per la messaggistica sincrona è necessario specificare solo il trasporto della coda di messaggi ([**ncadg \_ mq**](/windows/desktop/Midl/ncadg-mq)) come sequenza di protocollo.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-106">For synchronous messaging you need only specify the message queue transport ([**ncadg\_mq**](/windows/desktop/Midl/ncadg-mq)) as the protocol sequence.</span></span> <span data-ttu-id="d9b4a-107">Il protocollo **ncadg \_ mq** supporta tutte le funzionalità di datagramma standard, ad eccezione delle chiamate broadcast.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-107">The **ncadg\_mq** protocol supports all of the standard datagram features except broadcasting calls.</span></span> <span data-ttu-id="d9b4a-108">Si noti inoltre che attualmente il trasporto della coda di messaggi non supporta gli endpoint dinamici.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-108">Also, note that currently the message-queue transport does not support dynamic endpoints.</span></span>

<span data-ttu-id="d9b4a-109">Applicando l' \[ [](/windows/desktop/Midl/message) \] attributo Message alle dichiarazioni di procedura remota nel file IDL, viene automaticamente implementato l'Accodamento messaggi in modalità asincrona per tali chiamate.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-109">By applying the \[[**message**](/windows/desktop/Midl/message)\] attribute to remote procedure declarations in the IDL file, you automatically implement asynchronous-mode message queuing for those calls.</span></span> <span data-ttu-id="d9b4a-110">Ciò consente alle applicazioni client e server di controllare molte delle proprietà associate ai messaggi e alle code di messaggi, tra cui:</span><span class="sxs-lookup"><span data-stu-id="d9b4a-110">This makes it possible for the client and server applications to control many of the properties associated with messages and message queues, including:</span></span>

-   <span data-ttu-id="d9b4a-111">Qualità del servizio</span><span class="sxs-lookup"><span data-stu-id="d9b4a-111">Quality of service</span></span>
-   <span data-ttu-id="d9b4a-112">Riconoscimento della ricevuta</span><span class="sxs-lookup"><span data-stu-id="d9b4a-112">Acknowledgment of receipt</span></span>
-   <span data-ttu-id="d9b4a-113">Journaling</span><span class="sxs-lookup"><span data-stu-id="d9b4a-113">Journaling</span></span>
-   <span data-ttu-id="d9b4a-114">Priorità di chiamata</span><span class="sxs-lookup"><span data-stu-id="d9b4a-114">Call priority</span></span>
-   <span data-ttu-id="d9b4a-115">Persistenza della coda del processo server</span><span class="sxs-lookup"><span data-stu-id="d9b4a-115">Persistence of Server Process Queue</span></span>

<span data-ttu-id="d9b4a-116">Qualità del servizio è il lavoro che il trasporto farà per recapitare la chiamata al processo server.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-116">Quality of service is the effort that the transport will make to deliver the call to the server process.</span></span> <span data-ttu-id="d9b4a-117">Il recapito rapido verrà accodato in memoria, quindi è piuttosto veloce, ma la chiamata andrà persa se un computer o una connessione di rete si arresta in un momento errato.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-117">An express delivery will be queued in memory, so it is fairly fast, but the call will be lost if a computer or network connection goes down at the wrong time.</span></span> <span data-ttu-id="d9b4a-118">Un recapito reversibile verrà inserito in un file su disco fino a quando non viene recapitato, quindi la chiamata non andrà persa, anche in caso di arresto anomalo del computer.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-118">A recoverable delivery will be posted to a disk file until it is delivered, so the call will not be lost, even in the face of a computer crash.</span></span> <span data-ttu-id="d9b4a-119">Ciò garantisce un recapito garantito, ma con un costo in termini di prestazioni, quando ogni chiamata viene scritta su disco.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-119">This gives guaranteed delivery, but at a cost in performance as each call is written to disk.</span></span>

<span data-ttu-id="d9b4a-120">È inoltre possibile indicare al trasporto MSMQ di attendere il riconoscimento che la chiamata ha raggiunto la coda di destinazione (Server) prima di restituire.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-120">You can also tell the MSMQ transport to wait for acknowledgment that the call reached the destination (server) queue before returning.</span></span> <span data-ttu-id="d9b4a-121">La scelta di questa opzione blocca il client fino a quando il server non riconosce la chiamata. in caso contrario, il controllo torna al client immediatamente dopo la chiamata.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-121">Choosing this option blocks the client until the server acknowledges the call, otherwise control returns to the client immediately upon making the call.</span></span>

<span data-ttu-id="d9b4a-122">Utilizzando il journaling, le chiamate possono essere registrate su disco.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-122">By using journaling, calls can be logged to disk.</span></span> <span data-ttu-id="d9b4a-123">Se l'inserimento nel journal è attivato, ogni chiamata viene registrata su disco mentre viene trasmessa all'hop successivo fino al processo server.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-123">If journaling is turned on, each call is logged to disk as it is transmitted to the next hop on its way to the server process.</span></span>

<span data-ttu-id="d9b4a-124">La priorità delle chiamate può essere utilizzata insieme all'attributo della funzione del \[ [**messaggio**](/windows/desktop/Midl/message) RPC \] per consentire alle chiamate con priorità più alta di avere la precedenza sulle chiamate con priorità più bassa, anche se le chiamate con priorità alta arrivano in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-124">Call priority can be used in conjunction with the RPC \[[**message**](/windows/desktop/Midl/message)\] function attribute to allow calls with higher priority to take precedence over calls with lower priority, even if the high priority calls arrive later.</span></span> <span data-ttu-id="d9b4a-125">La priorità di chiamata funziona anche in modo limitato con RPC sincrona, ma le chiamate RPC sincrone non possono essere impilate nello stesso modo delle chiamate asincrone.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-125">Call priority will also work in a limited fashion with synchronous RPC, but synchronous RPC calls cannot stack up in the same manner as asynchronous calls.</span></span>

<span data-ttu-id="d9b4a-126">Il processo client controlla tutte le proprietà precedenti chiamando [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption).</span><span class="sxs-lookup"><span data-stu-id="d9b4a-126">The client process controls all of the above properties by calling [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption).</span></span> <span data-ttu-id="d9b4a-127">Una volta impostate, queste proprietà rimangono attive fino a quando non vengono modificate in un'altra chiamata a **RpcBindingSetOption**.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-127">Once set, these properties remain in effect until they are changed in another call to **RpcBindingSetOption**.</span></span>

<span data-ttu-id="d9b4a-128">Il processo server RPC può controllare la durata della coda di ricezione.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-128">The RPC server process can control the lifetime of its receive queue.</span></span> <span data-ttu-id="d9b4a-129">Per impostazione predefinita, la coda viene eliminata al termine del processo server.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-129">By default the queue is deleted when the server process exits.</span></span> <span data-ttu-id="d9b4a-130">Tuttavia, il processo server può utilizzare [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex) quando si configura l'endpoint per indicare al trasporto di continuare a esistere e accettare richieste di chiamata anche quando il processo server non è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-130">However, the server process can use [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex) when setting up its endpoint to tell the transport to allow the queue to continue to exist and to accept call requests even when the server process is not running.</span></span> <span data-ttu-id="d9b4a-131">In questo caso, le chiamate vengono accodate ed eseguite in un secondo momento, quando il processo server torna in linea.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-131">In this case, the calls are queued up and executed later, when the server process comes back online.</span></span>

> [!Note]  
> <span data-ttu-id="d9b4a-132">Se si usano chiamate asincrone \[ [**ai messaggi**](/windows/desktop/Midl/message) \] in un'interfaccia, è necessario registrare l'interfaccia chiamando [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) o [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) prima di chiamare [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)**(ncadg \_ mq)**.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-132">If you are using asynchronous \[[**message**](/windows/desktop/Midl/message)\] calls in an interface, you must register the interface by calling [**RpcServerRegisterIf**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterif) or [**RpcServerRegisterIfEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserverregisterifex) before calling [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)**(ncadg\_mq)**.</span></span> <span data-ttu-id="d9b4a-133">Una volta accesa la sequenza di protocollo, tutte le chiamate già in attesa nella coda per il server inizieranno a essere lette fuori dalla coda.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-133">Once you turn on the protocol sequence, any calls already waiting on the queue for the server will begin to be read off the queue.</span></span> <span data-ttu-id="d9b4a-134">Se l'interfaccia RPC corrispondente non è stata registrata, le chiamate avranno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-134">If the corresponding RPC interface has not been registered, the calls will fail.</span></span> <span data-ttu-id="d9b4a-135">Questa situazione può verificarsi se si dispone di una configurazione di un endpoint permanente per le chiamate a procedure remote, il server è stato arrestato e i client hanno continuato a inviare chiamate al server.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-135">This situation can happen if you have a setup a permanent endpoint for your remote procedure calls, the server has been shut down, and clients have continued to send calls to the server.</span></span> <span data-ttu-id="d9b4a-136">Queste chiamate verranno impilate nella coda, in attesa di essere lette dopo che il server tornerà online.</span><span class="sxs-lookup"><span data-stu-id="d9b4a-136">These calls will be stacked up in the queue, waiting to be read once the server comes back online.</span></span>

 

<span data-ttu-id="d9b4a-137">Per altre informazioni, vedere [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption), [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex)e \[ [**Message**](/windows/desktop/Midl/message) \] , [**ncadg \_ mq**](/windows/desktop/Midl/ncadg-mq).</span><span class="sxs-lookup"><span data-stu-id="d9b4a-137">For more information, see [**RpcBindingSetOption**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcbindingsetoption), [**RpcServerUseProtseqEpEx**](/windows/desktop/api/Rpcdce/nf-rpcdce-rpcserveruseprotseqepex), and \[[**message**](/windows/desktop/Midl/message)\], [**ncadg\_mq**](/windows/desktop/Midl/ncadg-mq).</span></span>

 

 