---
description: Nell'architettura TAPI tutti i TSPs vengono eseguiti nel contesto di TAPISRV, che viene implementato come un processo del servizio all'interno di SVCHOST.
ms.assetid: f47662f9-2fca-4044-ab26-617e5b1f9eae
title: Architettura MSP
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: e8c1229ddce90f79c122c47572b4567d230b0b4e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104401566"
---
# <a name="msp-architecture"></a><span data-ttu-id="7800f-103">Architettura MSP</span><span class="sxs-lookup"><span data-stu-id="7800f-103">MSP Architecture</span></span>

<span data-ttu-id="7800f-104">Nell'architettura TAPI tutti i TSPs vengono eseguiti nel contesto di TAPISRV, che viene implementato come un processo del servizio all'interno di SVCHOST.</span><span class="sxs-lookup"><span data-stu-id="7800f-104">In TAPI architecture, all TSPs are run in the context of TAPISRV, which is implemented as a service process within SVCHOST.</span></span> <span data-ttu-id="7800f-105">Le applicazioni TAPI si trovano in un processo.</span><span class="sxs-lookup"><span data-stu-id="7800f-105">TAPI applications live in their own process.</span></span> <span data-ttu-id="7800f-106">Le applicazioni TAPI caricano Tapi3.dll e tutte le MSPs necessarie nel proprio processo e la DLL TAPI comunica con TAPISRV tramite un'interfaccia RPC privata.</span><span class="sxs-lookup"><span data-stu-id="7800f-106">TAPI applications load Tapi3.dll and any needed MSPs into their own process, and the TAPI DLL communicates with TAPISRV through a private RPC interface.</span></span> <span data-ttu-id="7800f-107">Il diagramma seguente illustra l'interazione di questi componenti.</span><span class="sxs-lookup"><span data-stu-id="7800f-107">The following diagram illustrates the interaction of these components.</span></span>

![interazioni tra tapisrv, applicazioni TAPI e Msps](images/tsp-msp1.png)

<span data-ttu-id="7800f-109">Un provider di servizi multimediali (MSP) fornisce flussi multimediali usando le astrazioni di terminali, flussi e sottoflussi.</span><span class="sxs-lookup"><span data-stu-id="7800f-109">A media service provider (MSP) provides media streaming using the abstractions of Terminals, Streams, and SubStreams.</span></span>

<span data-ttu-id="7800f-110">Un terminale è un sink o un'origine per un flusso multimediale.</span><span class="sxs-lookup"><span data-stu-id="7800f-110">A Terminal is a sink or source for a media stream.</span></span> <span data-ttu-id="7800f-111">Potrebbe trattarsi di un oggetto fisico, ad esempio un altoparlante o un microfono, oppure un'astrazione di un dispositivo, ad esempio una finestra video.</span><span class="sxs-lookup"><span data-stu-id="7800f-111">It may be a physical object, such as a speaker or a microphone, or it may be an abstraction of a device, such as a video window.</span></span> <span data-ttu-id="7800f-112">L' [oggetto terminale](terminal-object.md) espone l'interfaccia [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) .</span><span class="sxs-lookup"><span data-stu-id="7800f-112">The [Terminal Object](terminal-object.md) exposes the [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) interface.</span></span> <span data-ttu-id="7800f-113">La classe del terminale è descritta dal GUID della [**classe terminale**](terminal-class.md) .</span><span class="sxs-lookup"><span data-stu-id="7800f-113">The class of terminal is described by the [**Terminal Class**](terminal-class.md) GUID.</span></span> <span data-ttu-id="7800f-114">Un MSP può definire le proprie classi terminal.</span><span class="sxs-lookup"><span data-stu-id="7800f-114">An MSP may define its own terminal classes.</span></span>

<span data-ttu-id="7800f-115">I flussi dividono il supporto di una chiamata in base al tipo o al tipo di [**supporto**](tapimediatype--constants.md) , alla [**direzione**](/windows/desktop/api/Tapi3if/ne-tapi3if-terminal_direction)del flusso e all'indirizzo di destinazione del supporto.</span><span class="sxs-lookup"><span data-stu-id="7800f-115">Streams divide the media of a call based on the [**media type**](tapimediatype--constants.md) or type, the stream's [**direction**](/windows/desktop/api/Tapi3if/ne-tapi3if-terminal_direction), and the destination address of the media.</span></span> <span data-ttu-id="7800f-116">Ad esempio, un flusso audio in ingresso da un modem è un oggetto flusso, un flusso video in uscita a un indirizzo IP e una porta è un oggetto flusso, i flussi video provenienti da un gruppo multicast IP vengono considerati anche come un unico oggetto flusso.</span><span class="sxs-lookup"><span data-stu-id="7800f-116">For example, an incoming audio stream from a modem is a stream object, an outgoing video stream to an IP address and port is a stream object, the video streams coming from a IP multicast group are also considered as one stream object.</span></span> <span data-ttu-id="7800f-117">L'oggetto Stream è rappresentato dall'interfaccia [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) .</span><span class="sxs-lookup"><span data-stu-id="7800f-117">The Stream object is represented by the [**ITStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itstreamcontrol) interface.</span></span>

<span data-ttu-id="7800f-118">I sottoflussi consentono un controllo più preciso sui supporti.</span><span class="sxs-lookup"><span data-stu-id="7800f-118">SubStreams allow finer control over the media.</span></span> <span data-ttu-id="7800f-119">Nel caso del multicast IP, ad esempio, l'oggetto flusso video in entrata potrebbe rappresentare più persone.</span><span class="sxs-lookup"><span data-stu-id="7800f-119">For example, in the IP multicast case, the incoming video stream object might represent several people.</span></span> <span data-ttu-id="7800f-120">È probabile che l'applicazione disponga di un renderer separato per ogni partecipante.</span><span class="sxs-lookup"><span data-stu-id="7800f-120">The application will most likely want each participant to have a separate renderer.</span></span> <span data-ttu-id="7800f-121">Il flusso video in ingresso può essere suddiviso in più flussi, uno per ogni persona.</span><span class="sxs-lookup"><span data-stu-id="7800f-121">The incoming video stream can be divided into several substreams, one for each person.</span></span> <span data-ttu-id="7800f-122">Un sottoflusso corrisponderebbe a una persona e può essere configurato e controllato separatamente.</span><span class="sxs-lookup"><span data-stu-id="7800f-122">One substream would correspond to one person, and can be configured and controlled separately.</span></span> <span data-ttu-id="7800f-123">L'oggetto substream è rappresentato dall'interfaccia [**ITSubStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itsubstreamcontrol) .</span><span class="sxs-lookup"><span data-stu-id="7800f-123">The SubStream object is represented by the [**ITSubStreamControl**](/windows/win32/api/tapi3if/nn-tapi3if-itsubstreamcontrol) interface.</span></span>

<span data-ttu-id="7800f-124">Quando un'applicazione chiama [**ITAddress:: CreateCall**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) per impostare una chiamata, deve specificare il tipo di supporto richiesto.</span><span class="sxs-lookup"><span data-stu-id="7800f-124">When an application calls [**ITAddress::CreateCall**](/windows/desktop/api/tapi3if/nf-tapi3if-itaddress-createcall) to set up a call, it must specify the type of media required.</span></span> <span data-ttu-id="7800f-125">In una chiamata in uscita, indica semplicemente TAPI quando viene creata la chiamata.</span><span class="sxs-lookup"><span data-stu-id="7800f-125">On an outgoing call, it simply tells TAPI when the call is created.</span></span> <span data-ttu-id="7800f-126">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="7800f-126">For example:</span></span>

``` syntax
HRESULT hr = pAddress->CreateCall( 
       pszDestAddress, 
       lAddressType, 
       TAPIMEDIATYPE_AUDIO | TAPIMEDIATYPE_VIDEO, 
       &pCall 
       ); 
// If (hr != S_OK ) process the error here
```

<span data-ttu-id="7800f-127">In questo caso, l'applicazione sta creando una chiamata audio-video in uscita.</span><span class="sxs-lookup"><span data-stu-id="7800f-127">In this case, the application is creating an outgoing audio-video call.</span></span>

<span data-ttu-id="7800f-128">I tipi di supporto passati indicano i supporti a cui l'applicazione è interessata per la durata della chiamata.</span><span class="sxs-lookup"><span data-stu-id="7800f-128">The media types passed in indicate the media that the application is interested in over the lifetime of the call.</span></span> <span data-ttu-id="7800f-129">Ad esempio, l'applicazione può specificare audio e video durante la creazione della chiamata, ma selezionare solo terminali audio all'inizio.</span><span class="sxs-lookup"><span data-stu-id="7800f-129">For example, the application may specify audio and video when creating the call, but select only audio terminals at the beginning.</span></span> <span data-ttu-id="7800f-130">Il file MSP avvierà solo il flusso audio, ma non rifiuterà una richiesta video locale o remota effettuata successivamente nel corso della chiamata.</span><span class="sxs-lookup"><span data-stu-id="7800f-130">The MSP will start streaming only audio, but will not reject a local or remote video request made later in the lifetime of the call.</span></span>

<span data-ttu-id="7800f-131">Quando l'applicazione chiama [**ITBasicCallControl:: Connect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-connect), TAPI 3 chiama [**TSPI \_ lineMakeCall**](/windows/win32/api/tspi/nf-tspi-tspi_linemakecall) nel TSP.</span><span class="sxs-lookup"><span data-stu-id="7800f-131">When the application then calls [**ITBasicCallControl::Connect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-connect), TAPI 3 calls [**TSPI\_lineMakeCall**](/windows/win32/api/tspi/nf-tspi-tspi_linemakecall) in the TSP.</span></span> <span data-ttu-id="7800f-132">Dopo che è stata stabilita una chiamata, MSP e TSP possono comunicare secondo necessità.</span><span class="sxs-lookup"><span data-stu-id="7800f-132">After a call is established, the MSP and TSP can communicate as necessary.</span></span>

<span data-ttu-id="7800f-133">Quando si esegue la disconnessione di una chiamata, è necessario che l'MSP e il TSP comunicano in caso di interruzione della chiamata.</span><span class="sxs-lookup"><span data-stu-id="7800f-133">When a call is disconnecting, it is up to the MSP and TSP to communicate about tearing down the call.</span></span> <span data-ttu-id="7800f-134">Tapi3.dll chiamerà [**TSPI \_ lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) se l'applicazione chiama [**Disconnetti**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-disconnect).</span><span class="sxs-lookup"><span data-stu-id="7800f-134">Tapi3.dll will call [**TSPI\_lineDrop**](/windows/win32/api/tspi/nf-tspi-tspi_linedrop) if the application calls [**Disconnect**](/windows/desktop/api/tapi3if/nf-tapi3if-itbasiccallcontrol-disconnect).</span></span>

 

 
