---
description: Nella procedura seguente viene descritto come implementare un MSP utilizzando ATL versione 2,1 o ATL versione 3,0 e le classi base MSP.
ms.assetid: 7485c34a-3c8a-412f-9cb9-8eb895084292
title: Uso delle classi base MSP di TAPI 3
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eb8ad4fd160cf0fc4c7dd682a44f3a4ff0bcec25
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106318601"
---
# <a name="using-the-tapi-3-msp-base-classes"></a><span data-ttu-id="13909-103">Uso delle classi base MSP di TAPI 3</span><span class="sxs-lookup"><span data-stu-id="13909-103">Using The TAPI 3 MSP Base Classes</span></span>

<span data-ttu-id="13909-104">Nella procedura seguente viene descritto come implementare un MSP utilizzando ATL versione 2,1 o ATL versione 3,0 e le classi base MSP.</span><span class="sxs-lookup"><span data-stu-id="13909-104">The following procedure describes how to implement an MSP using ATL version 2.1 or ATL version 3.0 and the MSP base classes.</span></span> <span data-ttu-id="13909-105">Per ulteriori informazioni e per un elenco di librerie e intestazioni, vedere [classi di base msp di TAPI 3](tapi-3-msp-base-classes.md).</span><span class="sxs-lookup"><span data-stu-id="13909-105">For more information and a list of libraries and headers, see [TAPI 3 MSP Base Classes](tapi-3-msp-base-classes.md).</span></span> <span data-ttu-id="13909-106">Il contenuto contenuto in questo argomento presuppone che lo sviluppatore abbia una conoscenza approfondita di ATL e COM e abbia esperienza nell'implementazione di DLL COM con ATL.</span><span class="sxs-lookup"><span data-stu-id="13909-106">The content contained in this topic assumes that the developer has a working understanding of ATL and COM, and has experience implementing COM DLLs using ATL.</span></span>

<span data-ttu-id="13909-107">**Per implementare e MSP utilizzando ATL 2,1 o ATL 3,0**</span><span class="sxs-lookup"><span data-stu-id="13909-107">**To implement and MSP using ATL 2.1 or ATL 3.0**</span></span>

1.  <span data-ttu-id="13909-108">Creare un file IDL per l'MSP.</span><span class="sxs-lookup"><span data-stu-id="13909-108">Create an IDL file for your MSP.</span></span> <span data-ttu-id="13909-109">Questo file definisce un CLSID per l'MSP.</span><span class="sxs-lookup"><span data-stu-id="13909-109">This file defines a CLSID for your MSP.</span></span> <span data-ttu-id="13909-110">Dichiarare l'MSP "CoClass" come implementazione dell'interfaccia [**ITMSPAddress**](/windows/desktop/api/msp/nn-msp-itmspaddress) e dichiarare questa interfaccia come interfaccia predefinita nell'oggetto classe.</span><span class="sxs-lookup"><span data-stu-id="13909-110">Declare your MSP "coclass" as implementing the [**ITMSPAddress**](/windows/desktop/api/msp/nn-msp-itmspaddress) interface, and declare this interface as the default interface on your class object.</span></span> <span data-ttu-id="13909-111">Per la definizione di **ITMSPAddress**, importare il file "msp. idl".</span><span class="sxs-lookup"><span data-stu-id="13909-111">For the definition of **ITMSPAddress**, import the file "msp.idl".</span></span> <span data-ttu-id="13909-112">Includere la "coclasse" MSP in una libreria dei tipi per il MSP.</span><span class="sxs-lookup"><span data-stu-id="13909-112">Include your MSP "coclass" in a type library for your MSP.</span></span> <span data-ttu-id="13909-113">Se il MSP supporta le interfacce private (personalizzate), definirle qui e includerle nella libreria dei tipi.</span><span class="sxs-lookup"><span data-stu-id="13909-113">If your MSP supports private (custom) interfaces, define them here and include them in your type library.</span></span> <span data-ttu-id="13909-114">L'esempio di codice seguente è un file IDL come descritto in precedenza, senza interfacce personalizzate.</span><span class="sxs-lookup"><span data-stu-id="13909-114">The following code example is an IDL file as described above, without custom interfaces.</span></span>

    ``` syntax
    import "msp.idl";
    [
          uuid(4DDB6D35-3BC1-11d2-86F2-006008B0E5D2),
          version(2.0),
          helpstring("Wave MSP 2.0 Type Library")
    ]
    library WAVEMSPLib
    {
    importlib("stdole32.tlb");
    importlib("stdole2.tlb");

    [
    uuid(4DDB6D36-3BC1-11d2-86F2-006008B0E5D2),
    helpstring("Wave MSP Class")
    ]
    coclass WaveMSP
    {
    [default] interface ITMSPAddress;
    };
    };
    ```

2.  <span data-ttu-id="13909-115">Modificare il TSP per annunciare il CLSID del MSP quando Tapi3.dll richiesto.</span><span class="sxs-lookup"><span data-stu-id="13909-115">Modify your TSP to advertise the CLSID of your MSP when Tapi3.dll requests it.</span></span> <span data-ttu-id="13909-116">Verificare che (1) il TSP possa negoziare TAPI \_ VERSION3 \_ 0 o versione successiva nella funzione TSPI [**TSPI \_ lineNegotiateTSPIVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion), (2) la struttura del TSP [**LINEDEVCAPS**](/windows/win32/api/tapi/ns-tapi-linedevcaps) ha il \_ flag msp LINEDEVCAPFLAGS impostato nel membro **DWDEVCAPFLAGS** e (3) il TSP restituisce il CLSID msp nella funzione TSPI TSPI [**\_ lineMSPIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_linemspidentify).</span><span class="sxs-lookup"><span data-stu-id="13909-116">Ensure that (1) your TSP can negotiate TAPI\_VERSION3\_0 or higher in the TSPI function [**TSPI\_lineNegotiateTSPIVersion**](/windows/win32/api/tspi/nf-tspi-tspi_linenegotiatetspiversion), (2) your TSP [**LINEDEVCAPS**](/windows/win32/api/tapi/ns-tapi-linedevcaps) structure has the LINEDEVCAPFLAGS\_MSP flag set in the **dwDevCapFlags** member, and (3) your TSP returns your MSP CLSID in the TSPI function [**TSPI\_lineMSPIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_linemspidentify).</span></span> <span data-ttu-id="13909-117">Deve corrispondere al CLSID specificato nel file IDL. ad esempio, la seconda riga "UUID" nel file IDL di esempio nel passaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="13909-117">This should be the same CLSID specified in your IDL file; for example, the second "uuid" line in the example IDL file in the previous step.</span></span>
3.  <span data-ttu-id="13909-118">Compilare l'applicazione di esempio MSPBase, che si trova nella piattaforma Software Development Kit (SDK), per creare la libreria MSPBaseSample. lib.</span><span class="sxs-lookup"><span data-stu-id="13909-118">Compile the MSPBase sample application, located in the Platform Software Development Kit (SDK), to create the MSPBaseSample.lib library.</span></span>
4.  <span data-ttu-id="13909-119">Collegare la DLL MSP con la libreria MSPBaseSample. lib.</span><span class="sxs-lookup"><span data-stu-id="13909-119">Link your MSP DLL with the MSPBaseSample.lib library.</span></span>
5.  <span data-ttu-id="13909-120">Includere Mspbase. h dalle definizioni delle classi base di SDK per MSP.</span><span class="sxs-lookup"><span data-stu-id="13909-120">Include Mspbase.h from the SDK for MSP base class definitions.</span></span>
6.  <span data-ttu-id="13909-121">Implementare le esportazioni di DLL (ad esempio, DllMain).</span><span class="sxs-lookup"><span data-stu-id="13909-121">Implement your DLL exports (for example, DllMain).</span></span> <span data-ttu-id="13909-122">Microsoft Visual C++ li genererà automaticamente.</span><span class="sxs-lookup"><span data-stu-id="13909-122">Microsoft Visual C++ will generate these for you.</span></span> <span data-ttu-id="13909-123">In DllMain, nella DLL \_ processo di \_ collegamento e \_ \_ scollegamento processo dll, utilizzare rispettivamente le macro **MSPLOGREGISTER** e **MSPLOGDEREGISTER** per abilitare le funzionalità di registrazione per la dll.</span><span class="sxs-lookup"><span data-stu-id="13909-123">In DllMain, on DLL\_PROCESS\_ATTACH and DLL\_PROCESS\_DETACH, respectively, use the **MSPLOGREGISTER** and **MSPLOGDEREGISTER** macros to enable up logging features for your DLL.</span></span> <span data-ttu-id="13909-124">Specificare il nome della DLL nella chiamata **MSPLOGDEREGISTER** .</span><span class="sxs-lookup"><span data-stu-id="13909-124">Specify the name of your DLL in the **MSPLOGDEREGISTER** call.</span></span>
7.  <span data-ttu-id="13909-125">Utilizzare la macro LOG, definita in Msplog. h, per restituire i messaggi di traccia nello stesso modo delle classi di base.</span><span class="sxs-lookup"><span data-stu-id="13909-125">Use the LOG macro, defined in Msplog.h, to output trace messages in the same fashion as the base classes.</span></span> <span data-ttu-id="13909-126">Definire il simbolo del preprocessore MSPLOG per includere la registrazione nella DLL; lasciarlo indefinito per compilare una DLL che non dispone di registrazione.</span><span class="sxs-lookup"><span data-stu-id="13909-126">Define the MSPLOG preprocessor symbol to include logging in your DLL; leave it undefined to build a DLL that does not have logging.</span></span>
8.  <span data-ttu-id="13909-127">Derivare una classe da CMSPAddress che implementi gli indirizzi per l'MSP.</span><span class="sxs-lookup"><span data-stu-id="13909-127">Derive a class from CMSPAddress that implements addresses for your MSP.</span></span> <span data-ttu-id="13909-128">Dichiarare una mappa di oggetti ATL globale che indica ad ATL di creare un'istanza della classe Address quando viene richiesto di creare una **cocreazione** sul CLSID specificato nel file IDL.</span><span class="sxs-lookup"><span data-stu-id="13909-128">Declare a global ATL object map which instructs ATL to create an instance of your address class when asked to **CoCreate** on the CLSID you specified in your IDL file.</span></span> <span data-ttu-id="13909-129">Inoltre, derivare la classe Address dal modello ATL **CComCoClass** e includere una dichiarazione Declare \_ Registry \_ RESOURCEID nella classe Address.</span><span class="sxs-lookup"><span data-stu-id="13909-129">Also, derive your address class from the ATL **CComCoClass** template, and include a DECLARE\_REGISTRY\_RESOURCEID declaration in your address class.</span></span> <span data-ttu-id="13909-130">Costruire uno script di risorsa e un file di intestazione corrispondenti, come per qualsiasi altra DLL COM ATL.</span><span class="sxs-lookup"><span data-stu-id="13909-130">Construct a corresponding resource script and header file, as for any other ATL COM DLL.</span></span>
9.  <span data-ttu-id="13909-131">Implementare le sostituzioni CMSPAddress necessarie per la classe Address.</span><span class="sxs-lookup"><span data-stu-id="13909-131">Implement the required CMSPAddress overrides for your address class.</span></span> <span data-ttu-id="13909-132">Per [**MSPAddressAddRef**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressaddref) e [**MSPAddressRelease**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressrelease), chiamare i modelli di funzione helper forniti.</span><span class="sxs-lookup"><span data-stu-id="13909-132">For [**MSPAddressAddRef**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressaddref) and [**MSPAddressRelease**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-mspaddressrelease), call the provided helper function templates.</span></span> <span data-ttu-id="13909-133">Per [**GetCallMediaTypes**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-getcallmediatypes), è sufficiente restituire una bitmap **DWORD** con tutti i ORed TAPIMEDIAMODEs supportati da msp.</span><span class="sxs-lookup"><span data-stu-id="13909-133">For [**GetCallMediaTypes**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-getcallmediatypes), simply return a **DWORD** bitmap with all of your MSP-supported TAPIMEDIAMODEs ORed together.</span></span> <span data-ttu-id="13909-134">Per [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) e [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall), restituire e \_ NOTIMPL e compilare e collegare il msp a questo punto.</span><span class="sxs-lookup"><span data-stu-id="13909-134">For [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) and [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall), return E\_NOTIMPL and compile and link your MSP at this point.</span></span> <span data-ttu-id="13909-135">A questo punto, verificare che sia possibile registrare e creare un'istanza dell'MSP dalle applicazioni TAPI 3, ma non creare correttamente le chiamate.</span><span class="sxs-lookup"><span data-stu-id="13909-135">Now, verify that you can register and instantiate your MSP from TAPI 3 applications, but not successfully create calls.</span></span>
10. <span data-ttu-id="13909-136">Derivare una classe da CMSPCallMultiGraph per implementare gli oggetti chiamata MSP.</span><span class="sxs-lookup"><span data-stu-id="13909-136">Derive a class from CMSPCallMultiGraph to implement your MSP call objects.</span></span> <span data-ttu-id="13909-137">È possibile che si desideri derivare da [**CMSPCallBase**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallbase) anziché da [**CMSPCallMultiGraph**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallmultigraph) se il modello Filter-Graph-per-Stream non soddisfa i requisiti. in questo modo si aumenta la complessità dell'attività (al momento della stesura di questo articolo, tutti MSPs derivano gli oggetti Call direttamente da **CMSPCallMultiGraph**).</span><span class="sxs-lookup"><span data-stu-id="13909-137">You may want to derive from [**CMSPCallBase**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallbase) instead of [**CMSPCallMultiGraph**](/windows/desktop/api/Mspcall/nl-mspcall-cmspcallmultigraph) if the filter-graph-per-stream model does not fit your requirements; this will increase the complexity of the task (as of this writing, all MSPs derive call objects directly from **CMSPCallMultiGraph**).</span></span> <span data-ttu-id="13909-138">Nell'oggetto Address implementare [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) e [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall) per creare e arrestare il tipo specifico di oggetto call usando i modelli di funzione helper forniti.</span><span class="sxs-lookup"><span data-stu-id="13909-138">In your address object, implement [**CreateMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-createmspcall) and [**ShutdownMSPCall**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdownmspcall) to create and shut down your specific type of call object using the provided helper function templates.</span></span> <span data-ttu-id="13909-139">Nell'oggetto chiamata eseguire l'override di [**CreateStreamObject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) per restituire E \_ NOTIMPL.</span><span class="sxs-lookup"><span data-stu-id="13909-139">In your call object, override [**CreateStreamObject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) to return E\_NOTIMPL.</span></span> <span data-ttu-id="13909-140">Eseguire l'override di [**MSPCallAddRef**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcalladdref) e [**MSPCallRelease**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcallrelease) in modo identico ai metodi Address corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="13909-140">Override [**MSPCallAddRef**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcalladdref) and [**MSPCallRelease**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-mspcallrelease) in a manner identical to the corresponding address methods.</span></span> <span data-ttu-id="13909-141">Anche in questo caso, dovrebbe essere possibile compilare e collegare il proprio MSP; a questo punto dovrebbe essere in grado di creare e arrestare le chiamate, ma le chiamate non eseguiranno alcuna trasmissione utile.</span><span class="sxs-lookup"><span data-stu-id="13909-141">Again, you should be able to compile and link your MSP; it should now be able to create and shut down calls, but the calls will not do any useful streaming.</span></span>
11. <span data-ttu-id="13909-142">Derivare una classe da CMSPStream per implementare gli oggetti flusso MSP.</span><span class="sxs-lookup"><span data-stu-id="13909-142">Derive a class from CMSPStream to implement your MSP stream objects.</span></span> <span data-ttu-id="13909-143">Nell'oggetto chiamata implementare [**CreateStreamObject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) per creare e inizializzare l'oggetto flusso, in genere chiamando il **CreateInstance** ATL seguito da ATL **\_ InternalQueryInterface** per [**ITStream**](/windows/win32/api/tapi3if/nn-tapi3if-itstream) seguito dalla chiamata a **init** nell'oggetto flusso.</span><span class="sxs-lookup"><span data-stu-id="13909-143">In your call object, implement [**CreateStreamObject**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-createstreamobject) to create and initialize your stream object (typically by calling the ATL **CreateInstance** followed by the ATL **\_InternalQueryInterface** for [**ITStream**](/windows/win32/api/tapi3if/nn-tapi3if-itstream) followed by calling **Init** on your stream object).</span></span> <span data-ttu-id="13909-144">Per supportare un numero fisso di flussi (questo è comune per MSPs che non supportano la modifica delle configurazioni di flusso da parte di altri endpoint nella chiamata), eseguire l'override di **init**, [**CreateStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-createstream)e [**RemoveStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-removestream) nell'oggetto chiamata.</span><span class="sxs-lookup"><span data-stu-id="13909-144">To support a fixed number of streams (this is common for MSPs which do not support modification of stream configurations by other endpoints on the call), override **Init**, [**CreateStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-createstream), and [**RemoveStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstreamcontrol-removestream) on your call object.</span></span> <span data-ttu-id="13909-145">(Call **init** crea tutti i flussi inizialmente e **CreateStream** e **RemoveStream** restituiscono i codici di errore TAPI appropriati per impedire che l'applicazione crei o rimuovono i flussi).</span><span class="sxs-lookup"><span data-stu-id="13909-145">(The call **Init** creates all of your streams initially, and **CreateStream** and **RemoveStream** return the appropriate TAPI error codes to prevent the application from creating or removing streams).</span></span> <span data-ttu-id="13909-146">In caso contrario, eseguire l'override del metodo **init** della chiamata per creare una configurazione iniziale predefinita dei flussi usando i tipi di supporto richiesti per la chiamata.</span><span class="sxs-lookup"><span data-stu-id="13909-146">Otherwise, override the call's **Init** method to create some initial default configuration of streams using the media types requested for the call.</span></span> <span data-ttu-id="13909-147">Quando si creano oggetti flusso predefiniti nel metodo **init** della chiamata, usare il metodo helper [**InternalCreateStream**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-internalcreatestream) .</span><span class="sxs-lookup"><span data-stu-id="13909-147">When creating any default stream objects in your call's **Init** method, use the [**InternalCreateStream**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-internalcreatestream) helper method.</span></span>
12. <span data-ttu-id="13909-148">Implementare l'oggetto flusso.</span><span class="sxs-lookup"><span data-stu-id="13909-148">Implement your stream object.</span></span> <span data-ttu-id="13909-149">L'unico override obbligatorio è il metodo [**get \_ Name**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-get_name) , che restituisce semplicemente un nome descrittivo per il flusso.</span><span class="sxs-lookup"><span data-stu-id="13909-149">The only required override is the [**get\_Name**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-get_name) method, which simply returns a friendly name for the stream.</span></span> <span data-ttu-id="13909-150">Inoltre, sarà necessario eseguire l'override di diversi altri metodi.</span><span class="sxs-lookup"><span data-stu-id="13909-150">In addition, you will need to override several other methods.</span></span> <span data-ttu-id="13909-151">Esattamente i metodi di cui eseguire l'override dipendono dall'implementazione e quando si decide di eseguire le varie attività necessarie per la costruzione e la decostruzione del grafico di filtro.</span><span class="sxs-lookup"><span data-stu-id="13909-151">Exactly which methods to override depends on your implementation and when you decide to perform the various tasks involved in constructing and deconstructing your filter graph.</span></span> <span data-ttu-id="13909-152">Queste attività includono la creazione dei filtri di "trasporto" appropriati, i codec e così via e l'inserimento e la rimozione dei grafici dei filtri nei momenti appropriati.</span><span class="sxs-lookup"><span data-stu-id="13909-152">These tasks include creating the appropriate "transport" filters, codecs, and so on, and inserting them and removing them from the filter graphs at the appropriate times.</span></span> <span data-ttu-id="13909-153">Sarà anche necessario usare l'interfaccia [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) sugli oggetti terminal per connettere i terminali selezionati ai flussi.</span><span class="sxs-lookup"><span data-stu-id="13909-153">You will also have to use the [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) interface on terminal objects to connect the selected terminals to your streams.</span></span> <span data-ttu-id="13909-154">Potrebbe essere necessario eseguire l'override di [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) e [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) sull'oggetto Stream per limitare le configurazioni del terminale che i flussi accetteranno. la limitazione di ogni flusso a un singolo terminale semplificherà in particolare la costruzione dei grafici di filtro, ma sacrifica le funzionalità dell'applicazione, ad esempio l'anteprima video.</span><span class="sxs-lookup"><span data-stu-id="13909-154">You may want to override [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal) and [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) on your stream object to limit the terminal configurations that your streams will accept; limiting each stream to a single terminal will especially simplify construction of your filter graphs, but will sacrifice application functionality such as video preview.</span></span> <span data-ttu-id="13909-155">A seconda dell'implementazione, si inseriranno la costruzione del grafo, la decostruzione e il codice di connessione terminal nei metodi [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**Initialize**](/windows/desktop/api/msp/nf-msp-itmspaddress-initialize), [**Shutdown**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdown), [**SELECTTERMINAL**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal)e [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) oppure nei metodi personalizzati basati sulla comunicazione del TSP privato.</span><span class="sxs-lookup"><span data-stu-id="13909-155">Depending on your implementation, you will place your graph construction, deconstruction, and terminal connection code in the [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**Initialize**](/windows/desktop/api/msp/nf-msp-itmspaddress-initialize), [**Shutdown**](/windows/desktop/api/msp/nf-msp-itmspaddress-shutdown), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal), and [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) methods, or in your own methods based on private TSP communication.</span></span> <span data-ttu-id="13909-156">Tenere presente che un flusso senza terminali selezionati deve tenere traccia dello stato del grafico desiderato; una chiamata **StartStream** seguita da una chiamata **SelectTerminal** su un flusso di questo tipo deve generare un flusso di dati.</span><span class="sxs-lookup"><span data-stu-id="13909-156">Be aware that a stream with no terminals selected must track the desired graph state; a **StartStream** call followed by a **SelectTerminal** call on such a stream must result in a data stream.</span></span> <span data-ttu-id="13909-157">Eseguire l'override della maggior parte di questi metodi per assicurarsi che la costruzione, la decostruzione, la connessione e la disconnessione corrette avvengano in ogni caso a seconda dello stato del flusso.</span><span class="sxs-lookup"><span data-stu-id="13909-157">Override most of these methods to ensure that the correct construction, deconstruction, connection, and disconnection happens in each case depending on the state of the stream.</span></span>
13. <span data-ttu-id="13909-158">Implementare la comunicazione del TSP.</span><span class="sxs-lookup"><span data-stu-id="13909-158">Implement your TSP communication.</span></span> <span data-ttu-id="13909-159">Eseguire l'override di [**CMSPAddress:: ReceiveTSPAddressData**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-receivetspaddressdata) e/o [**CMSPCallBase:: ReceiveTSPCallData**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-receivetspcalldata)e/o chiamando [**postEvent**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-postevent) nell'oggetto Address oppure [**HandleStreamEvent**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-handlestreamevent) nell'oggetto chiamata (dagli oggetti chiamata o flusso).</span><span class="sxs-lookup"><span data-stu-id="13909-159">Override [**CMSPAddress::ReceiveTSPAddressData**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-receivetspaddressdata) and/or [**CMSPCallBase::ReceiveTSPCallData**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-receivetspcalldata), and/or by calling [**PostEvent**](/windows/desktop/api/Mspaddr/nf-mspaddr-cmspaddress-postevent) on your address object, or [**HandleStreamEvent**](/windows/desktop/api/Mspcall/nf-mspcall-cmspcallbase-handlestreamevent) on your call object (from either your call or stream objects).</span></span>
14. <span data-ttu-id="13909-160">Usare postEvent nell'oggetto Address o HandleStreamEvent nell'oggetto chiamata (dagli oggetti chiamata o flusso) per inviare chiamate a eventi multimediali all'applicazione tramite Tapi3.dll.</span><span class="sxs-lookup"><span data-stu-id="13909-160">Use PostEvent on your address object, or HandleStreamEvent on your call object (from either your call or stream objects) to send call media events to the application via Tapi3.dll.</span></span> <span data-ttu-id="13909-161">Questa operazione viene eseguita in genere nell'oggetto flusso, nei metodi sottoposti a override, inclusi i metodi [**ProcessGraphEvent**](/windows/desktop/api/Mspstrm/nf-mspstrm-cmspstream-processgraphevent), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal)e [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) , a seconda della modalità di implementazione dei flussi.</span><span class="sxs-lookup"><span data-stu-id="13909-161">You will typically do this on your stream object, in overridden methods including the [**ProcessGraphEvent**](/windows/desktop/api/Mspstrm/nf-mspstrm-cmspstream-processgraphevent), [**StopStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-stopstream), [**StartStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-startstream), [**PauseStream**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-pausestream), [**SelectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-selectterminal), and [**UnselectTerminal**](/windows/win32/api/tapi3if/nf-tapi3if-itstream-unselectterminal) methods, depending on how you implement your streams.</span></span>
15. <span data-ttu-id="13909-162">Implementare le interfacce private o i sottoflussi desiderati sugli oggetti esistenti (indirizzo, chiamata e flusso).</span><span class="sxs-lookup"><span data-stu-id="13909-162">Implement any desired private interfaces or substreams on your existing objects (address, call, and stream).</span></span> <span data-ttu-id="13909-163">In genere non è presente alcun valore.</span><span class="sxs-lookup"><span data-stu-id="13909-163">Usually there are none.</span></span> <span data-ttu-id="13909-164">Tenere presente che quando si implementano le interfacce private, specificare il LIBID della libreria dei tipi dal file IDL.</span><span class="sxs-lookup"><span data-stu-id="13909-164">Be aware that when implementing your private interfaces, specify the LIBID of your type library from your IDL file.</span></span> <span data-ttu-id="13909-165">Ovvero, i programmatori di applicazioni devono utilizzare la libreria dei tipi MSP quando si utilizzano le interfacce personalizzate.</span><span class="sxs-lookup"><span data-stu-id="13909-165">That is, application programmers must use your MSP type library when using your custom interfaces.</span></span> <span data-ttu-id="13909-166">Le interfacce MSP standard, implementate nelle classi di base MSP, usano la Tapi3.dll LIBID e sono pertanto accessibili a tutte le applicazioni TAPI 3.</span><span class="sxs-lookup"><span data-stu-id="13909-166">The standard MSP interfaces, implemented in the MSP base classes, use the Tapi3.dll LIBID and are therefore accessible to all TAPI 3 applications.</span></span>
16. <span data-ttu-id="13909-167">Se si implementano oggetti terminali statici o dinamici specifici di MSP o sostituzioni per i terminali statici predefiniti (non tipici), è possibile utilizzare le classi base del terminale fornite.</span><span class="sxs-lookup"><span data-stu-id="13909-167">If implementing MSP-specific static or dynamic terminal objects or replacements for the default static terminals (not typical), you can use the provided terminal base classes.</span></span> <span data-ttu-id="13909-168">Sarà necessario eseguire l'override di diversi metodi sull'oggetto Address per fornire metodi alternativi o aggiuntivi per la creazione di oggetti terminal.</span><span class="sxs-lookup"><span data-stu-id="13909-168">You will have to override various methods on your address object to provide alternative or additional methods of creating terminal objects.</span></span>
17. <span data-ttu-id="13909-169">Implementare l'interfaccia IObjectSafety sugli oggetti Address, Call, Stream e terminal.</span><span class="sxs-lookup"><span data-stu-id="13909-169">Implement the IObjectSafety interface on your Address, Call, Stream, and Terminal objects.</span></span> <span data-ttu-id="13909-170">Per usare il [Mapper di invio](dispatch-mapper.md) per eseguire query per le interfacce sugli oggetti msp, contrassegnare gli oggetti come sicuri per gli script in tali interfacce.</span><span class="sxs-lookup"><span data-stu-id="13909-170">To use [Dispatch Mapper](dispatch-mapper.md) to query for interfaces on your MSP objects, mark your objects as safe for scripting on these interfaces.</span></span> <span data-ttu-id="13909-171">A tale scopo, implementare l'interfaccia **IObjectSafety** sull'oggetto.</span><span class="sxs-lookup"><span data-stu-id="13909-171">To do this, implement the **IObjectSafety** interface on your object.</span></span> <span data-ttu-id="13909-172">La derivazione da **CMSPObjectSafetyImpl** (una classe helper fornita in Msputils. h) e l'aggiunta di **IOBJECTSAFETY** alla mappa COM ATL della classe renderà gli \_ oggetti sicuri per gli script in tutte le interfacce che espongono.</span><span class="sxs-lookup"><span data-stu-id="13909-172">Deriving from **CMSPObjectSafetyImpl** (a helper class provided in Msputils.h) and adding **IObjectSafety** to your class's ATL COM\_MAP will make your objects safe for scripting on all the interfaces they expose.</span></span> <span data-ttu-id="13909-173">Tenere presente che l'utilizzo del mapper di invio sugli oggetti MSP potrebbe essere implicito.</span><span class="sxs-lookup"><span data-stu-id="13909-173">Be aware that using Dispatch Mapper on MSP objects could be implicit.</span></span> <span data-ttu-id="13909-174">L'indirizzo MSP e la chiamata MSP sono aggregati in base all'indirizzo TAPI e agli oggetti chiamata TAPI.</span><span class="sxs-lookup"><span data-stu-id="13909-174">MSP Address and MSP Call are aggregated by TAPI Address and TAPI Call objects.</span></span> <span data-ttu-id="13909-175">Se il mapper di dispatch viene usato per gli oggetti TAPI per eseguire una query per le interfacce esposte dagli oggetti MSP aggregati, verrà eseguita una query sugli oggetti MSP aggregati per garantire la sicurezza delle interfacce richieste.</span><span class="sxs-lookup"><span data-stu-id="13909-175">If Dispatch Mapper is used on the TAPI objects to query for the interfaces exposed by the aggregated MSP objects, the aggregated MSP objects will be queried for safety of the requested interfaces.</span></span>

 

 
