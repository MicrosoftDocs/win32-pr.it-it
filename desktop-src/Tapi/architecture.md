---
description: Nella figura seguente viene illustrata l'architettura generale dei provider di servizi di telefonia e delle librerie di collegamento dinamico (dll UI) associate dell'interfaccia utente.
ms.assetid: b5efe57a-19b8-49c5-810f-180633ed50d2
title: Architettura (API di telefonia)
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 14423dba77af1ded38af4a6f2b896e76d28ca2cd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106311911"
---
# <a name="architecture-telephony-api"></a><span data-ttu-id="bcd7d-103">Architettura (API di telefonia)</span><span class="sxs-lookup"><span data-stu-id="bcd7d-103">Architecture (Telephony API)</span></span>

<span data-ttu-id="bcd7d-104">Nella figura seguente viene illustrata l'architettura generale dei provider di servizi di telefonia e delle librerie di collegamento dinamico (dll UI) associate dell'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-104">The following illustration shows the general architecture of telephony service providers and their associated user interface dynamic-link libraries (UI DLLs).</span></span>

![TSPs e dll UI associate](images/spuidl01.png)

<span data-ttu-id="bcd7d-106">Il provider di servizi è costituito da un minimo di due componenti.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-106">The service provider consists of a minimum of two components.</span></span> <span data-ttu-id="bcd7d-107">DLL del provider di servizi (designata nell'illustrazione come principale). TSP) viene eseguito nel contesto del processo TAPISRV ed esegue tutte le attività del provider di servizi che non sono correlate agli elementi dell'interfaccia utente associati all'uso del dispositivo da parte di un'applicazione specifica (probabilmente, in combinazione con componenti di livello inferiore non mostrati nell'illustrazione).</span><span class="sxs-lookup"><span data-stu-id="bcd7d-107">The service provider DLL (designated in the illustration as MAIN.TSP) executes in the context of the TAPISRV process, and performs all of the tasks of the service provider that are not related to user interface elements associated with a particular application's use of the device (most likely, in conjunction with lower-level components not shown in the illustration).</span></span> <span data-ttu-id="bcd7d-108">Tuttavia, a differenza delle versioni precedenti di TAPI, in cui il codice dell'interfaccia utente è stato integrato nel provider di servizi (ed eseguito, a causa dell'architettura precedente, all'interno del contesto dell'applicazione), il provider di servizi deve includere ora un componente separato che implementa gli elementi dell'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-108">But unlike previous versions of TAPI in which the user interface code was integrated into the service provider (and executed, because of the previous architecture, within the context of the application), the service provider must now include a separate component that implements the user interface elements.</span></span>

<span data-ttu-id="bcd7d-109">La DLL dell'interfaccia utente del provider di servizi deve esportare le funzioni chiamate da TAPI quando l'applicazione chiama funzioni TAPI che generano l'interfaccia utente: [**TUISPI \_ lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialog), [**TUISPI \_ lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialogedit), [**TUISPI \_ PhoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_phoneconfigdialog), [**TUISPI \_ providerConfig**](/windows/win32/api/tspi/nf-tspi-tuispi_providerconfig), TUISPI providerInstall e [**TUISPI \_**](/windows/win32/api/tspi/nf-tspi-tuispi_providerremove)providerRemove. [**\_**](/windows/win32/api/tspi/nf-tspi-tuispi_providerinstall)</span><span class="sxs-lookup"><span data-stu-id="bcd7d-109">The service provider UI DLL must export functions that are called by TAPI when the application calls TAPI functions that generate UI: [**TUISPI\_lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialog), [**TUISPI\_lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tuispi_lineconfigdialogedit), [**TUISPI\_phoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_phoneconfigdialog), [**TUISPI\_providerConfig**](/windows/win32/api/tspi/nf-tspi-tuispi_providerconfig), [**TUISPI\_providerInstall**](/windows/win32/api/tspi/nf-tspi-tuispi_providerinstall), and [**TUISPI\_providerRemove**](/windows/win32/api/tspi/nf-tspi-tuispi_providerremove).</span></span> <span data-ttu-id="bcd7d-110">Ognuna di queste funzioni include come parametro un puntatore a una funzione di callback in TAPI, di tipo [**TUISPIDLLCALLBACK**](/windows/win32/api/tspi/nc-tspi-tuispidllcallback), che la DLL dell'interfaccia utente può usare per comunicare in modo bidirezionale (entrambi i dati di invio e ricezione) con la dll del provider di servizi in esecuzione nel processo tapisrv.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-110">Each of these functions includes as a parameter a pointer to a callback function in TAPI, of type [**TUISPIDLLCALLBACK**](/windows/win32/api/tspi/nc-tspi-tuispidllcallback), which the UI DLL can use to communicate bidirectionally (both send and receive data) with the service provider DLL executing in the TAPISRV process.</span></span> <span data-ttu-id="bcd7d-111">Se il provider di servizi genera un'interfaccia utente spontanea, ad esempio la finestra di dialogo UniModel **Talk/hangup** , insieme a qualsiasi funzione TSPI per la quale non è prevista l'interfaccia utente (ad esempio, qualsiasi funzione che non ha un parametro *HWND* ), la DLL dell'interfaccia utente deve esportare [**TUISPI \_ providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) e [**TUISPI \_ providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata).</span><span class="sxs-lookup"><span data-stu-id="bcd7d-111">If the service provider ever generates spontaneous UI, such as the Unimodem **Talk/Hangup** dialog box, in conjunction with any TSPI function for which UI is not expected (for example, any function that does not have an *hwnd* parameter), then the UI DLL must export [**TUISPI\_providerGenericDialog**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialog) and [**TUISPI\_providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tuispi_providergenericdialogdata).</span></span>

> [!Note]  
> <span data-ttu-id="bcd7d-112">Le funzioni originali di generazione dell'interfaccia utente di TSPI ( [**TSPI \_ lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialog), [**TSPI \_ lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialogedit), TSPI [**\_ PhoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_phoneconfigdialog) [**, TSPI \_ providerConfig**](/windows/win32/api/tspi/nf-tspi-tspi_providerconfig), TSPI [**\_ PROVIDERINSTALL**](/windows/win32/api/tspi/nf-tspi-tspi_providerinstall)e TSPI providerRemove) sono obsolete e non vengono mai chiamate da TAPI. [**\_**](/windows/win32/api/tspi/nf-tspi-tspi_providerremove)</span><span class="sxs-lookup"><span data-stu-id="bcd7d-112">The original TSPI UI-generating functions ( [**TSPI\_lineConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialog), [**TSPI\_lineConfigDialogEdit**](/windows/win32/api/tspi/nf-tspi-tspi_lineconfigdialogedit), [**TSPI\_phoneConfigDialog**](/windows/win32/api/tspi/nf-tspi-tspi_phoneconfigdialog), [**TSPI\_providerConfig**](/windows/win32/api/tspi/nf-tspi-tspi_providerconfig), [**TSPI\_providerInstall**](/windows/win32/api/tspi/nf-tspi-tspi_providerinstall), and [**TSPI\_providerRemove**](/windows/win32/api/tspi/nf-tspi-tspi_providerremove)) are obsolete and never called by TAPI.</span></span> <span data-ttu-id="bcd7d-113">Pertanto, non è necessario che vengano esportate dalla DLL del provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-113">Therefore, these are not required to be exported by the service provider DLL.</span></span> <span data-ttu-id="bcd7d-114">Tuttavia, se il provider di servizi vuole essere elencato come uno che può essere aggiunto dal pannello di controllo della telefonia, un'utilità fornita con la telefonia Windows nelle versioni 1,4 e precedenti, deve esportare **TSPI \_ providerInstall**; se si desidera che il pulsante [**Rimuovi**](/windows/win32/api/tapi3if/nn-tapi3if-itcollection2) sia abilitato nel pannello di controllo della telefonia quando è selezionato, deve esportare **TSPI \_ providerRemove**; e se desidera che il pulsante di **installazione** sia abilitato nel pannello di controllo della telefonia quando è selezionato, deve esportare **TSPI \_** providerConfig.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-114">However, if the service provider wants to be listed as one that can be added by the Telephony Control Panel, a utility supplied with Windows Telephony in versions 1.4 and earlier, it must export **TSPI\_providerInstall**; if it wants to have the [**Remove**](/windows/win32/api/tapi3if/nn-tapi3if-itcollection2) button enabled in the Telephony Control Panel when it is selected, it must export **TSPI\_providerRemove**; and if it wants the **Setup** button to be enabled in the Telephony Control Panel when it is selected, it must export **TSPI\_providerConfig**.</span></span> <span data-ttu-id="bcd7d-115">Il pannello di controllo della telefonia verifica la presenza di queste funzioni nel file TSP del provider di servizi per regolare l'interfaccia utente in modo da riflettere le operazioni che possono essere eseguite.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-115">The Telephony Control Panel checks for the presence of these functions in the service provider TSP file to adjust its user interface to reflect which operations can be performed.</span></span>

 

<span data-ttu-id="bcd7d-116">La DLL del provider di servizi deve esportare la funzione [**TSPI \_ providerUIIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_provideruiidentify) utilizzata dal processo tapisrv per ottenere il nome della DLL dell'interfaccia utente da caricare nel processo dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-116">The service provider DLL must export the [**TSPI\_providerUIIdentify**](/windows/win32/api/tspi/nf-tspi-tspi_provideruiidentify) function that TAPISRV process uses to obtain the name of the UI DLL to load in the application process.</span></span> <span data-ttu-id="bcd7d-117">Deve esportare la funzione [**TSPI \_ providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tspi_providergenericdialogdata) per ricevere e rispondere alle richieste dalla DLL dell'interfaccia utente per la visualizzazione dei dati e deve esportare [**TSPI \_ providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) per il processo tapisrv per indicare al provider di servizi quando rilasciare un'associazione stabilita allo scopo di generare un'interfaccia utente spontanea insieme a una funzione non definita come presentazione dell'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-117">It must export the [**TSPI\_providerGenericDialogData**](/windows/win32/api/tspi/nf-tspi-tspi_providergenericdialogdata) function to receive and respond to requests from the UI DLL for data to display, and it must export [**TSPI\_providerFreeDialogInstance**](/windows/win32/api/tspi/nf-tspi-tspi_providerfreedialoginstance) for TAPISRV process to tell the service provider when to release an association established for the purpose of generating spontaneous UI in conjunction with a function that is not defined as presenting UI to the user.</span></span> <span data-ttu-id="bcd7d-118">La DLL del provider di servizi può inviare in modo unidirezionale i dati alla DLL dell'interfaccia utente usando la nuova riga di messaggio TSPI [**\_ SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md).</span><span class="sxs-lookup"><span data-stu-id="bcd7d-118">The service provider DLL can unidirectionally send data to the UI DLL by using the new TSPI message [**LINE\_SENDDIALOGINSTANCEDATA**](line-senddialoginstancedata.md).</span></span>

<span data-ttu-id="bcd7d-119">Poiché i nomi delle funzioni TSPI e TUISPI sono intenzionalmente definiti come diversi, la DLL del provider di servizi e la DLL dell'interfaccia utente possono essere lo stesso file DLL, se lo si desidera.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-119">Because the names of the TSPI and TUISPI functions are intentionally defined to be different, the service provider DLL and the UI DLL can be the same DLL file, if desired.</span></span> <span data-ttu-id="bcd7d-120">Con la segmentazione corretta, questo non comporta necessariamente un utilizzo non necessario della memoria nel contesto dell'applicazione e può semplificare il processo di installazione per i provider di servizi che attualmente possono essere implementati in una singola DLL.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-120">With proper segmentation, this does not necessarily result in any unnecessary usage of memory in the application context, and can simplify the installation process for service providers that can currently be implemented in a single DLL.</span></span> <span data-ttu-id="bcd7d-121">TAPI chiama solo le funzioni appropriate per il contesto in cui viene utilizzata la DLL.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-121">TAPI calls only the functions that are appropriate for the context in which the DLL is being used.</span></span>

<span data-ttu-id="bcd7d-122">Il provider di servizi di telefonia e la DLL dell'interfaccia utente devono essere entrambi progettati tenendo presente che le funzioni dell'interfaccia utente possono essere richiamate simultaneamente da più processi dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-122">The telephony service provider and the UI DLL must both be designed with the requirement in mind that the UI functions can be invoked from multiple application processes simultaneously.</span></span> <span data-ttu-id="bcd7d-123">Devono inoltre tenere presente che l'applicazione e il servizio TAPI in cui è in esecuzione il provider di servizi di telefonia possono trovarsi in computer distinti in una LAN.</span><span class="sxs-lookup"><span data-stu-id="bcd7d-123">They must also consider that the application and the TAPI service under which the telephony service provider is executing can be on separate computers on a LAN.</span></span>

 

 
