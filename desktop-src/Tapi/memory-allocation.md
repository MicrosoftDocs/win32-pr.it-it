---
description: Le applicazioni devono allocare memoria per questi dati. TAPI e il provider di servizi forniscono i dati. Se l'operazione è asincrona, i dati non saranno disponibili fino a quando il messaggio di risposta asincrono non indicherà l'esito positivo.
ms.assetid: 61313fe3-74a1-4195-b5af-37463dad02c1
title: Allocazione della memoria
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f192e34fdc652293c480277631c3839ecd2435fc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106305587"
---
# <a name="memory-allocation"></a><span data-ttu-id="e7b0a-104">Allocazione della memoria</span><span class="sxs-lookup"><span data-stu-id="e7b0a-104">Memory Allocation</span></span>

<span data-ttu-id="e7b0a-105">Le applicazioni devono allocare memoria per questi dati. TAPI e il provider di servizi forniscono i dati.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-105">Applications must allocate memory for this data; TAPI and the service provider provide the data.</span></span> <span data-ttu-id="e7b0a-106">Se l'operazione è asincrona, i dati non saranno disponibili fino a quando il messaggio di risposta asincrono non indicherà l'esito positivo.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-106">If the operation is asynchronous, the data is not available until the asynchronous reply message indicates success.</span></span>

<span data-ttu-id="e7b0a-107">Tutte le strutture di dati utilizzate per passare i dati tra l'applicazione e il TAPI sono *bidimensionali*.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-107">All data structures used to pass data between the application and the TAPI are *flattened*.</span></span> <span data-ttu-id="e7b0a-108">Ovvero le strutture dei dati non contengono puntatori a sottostrutture che contengono componenti di dati di dimensioni variabili.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-108">That is, data structures do not contain pointers to substructures that contain variably sized data components.</span></span> <span data-ttu-id="e7b0a-109">Al contrario, le strutture di dati utilizzate per passare quantità variabili di dati all'applicazione devono avere la metastruttura seguente:</span><span class="sxs-lookup"><span data-stu-id="e7b0a-109">Instead, data structures used to pass variable amounts of data back to the application must have the following metastructure:</span></span>

``` syntax
  DWORD  dwTotalSize;
  DWORD  dwNeededSize;
  DWORD  dwUsedSize; 
    <fixed size fields> 
  DWORD  dw<VarSizeField1>Size;
  DWORD  dw<VarSizeField1>Offset; 
    <fixed size fields> 
  DWORD  dw<VarSizeField2>Size;
  DWORD  dw<VarSizeField2>Offset; 
    <common extensions> 
    <var sized field1> 
    <var sized field2>
```

<span data-ttu-id="e7b0a-110">Il membro **dwTotalSize** è la dimensione, in byte, allocata a questa struttura di dati.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-110">The **dwTotalSize** member is the size, in bytes, allocated to this data structure.</span></span> <span data-ttu-id="e7b0a-111">Contrassegna la fine della struttura dei dati e viene impostata dall'applicazione prima di richiamare la funzione che usa questa struttura di dati.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-111">It marks the end of the data structure and is set by the application before it invokes the function that uses this data structure.</span></span> <span data-ttu-id="e7b0a-112">La funzione non legge o scrive oltre questa dimensione.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-112">The function does not read or write beyond this size.</span></span> <span data-ttu-id="e7b0a-113">Un'applicazione deve impostare il membro **dwTotalSize** per indicare il numero totale di byte allocati per TAPI per restituire il contenuto della struttura.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-113">An application must set the **dwTotalSize** member to indicate the total number of bytes allocated for TAPI to return the contents of the structure.</span></span>

<span data-ttu-id="e7b0a-114">TAPI compila il membro **dwNeededSize** .</span><span class="sxs-lookup"><span data-stu-id="e7b0a-114">TAPI fills in the **dwNeededSize** member.</span></span> <span data-ttu-id="e7b0a-115">Indica il numero di byte necessari per restituire tutti i dati richiesti.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-115">It indicates how many bytes are required to return all the requested data.</span></span> <span data-ttu-id="e7b0a-116">L'esistenza di campi di dimensioni variabili rende spesso impossibile per l'applicazione stimare la dimensione della struttura di dati necessaria per l'allocazione.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-116">The existence of variably sized fields often makes it impossible for the application to estimate the data structure size required to allocate.</span></span> <span data-ttu-id="e7b0a-117">Questo campo restituisce il numero di byte effettivamente necessari per i dati.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-117">This field returns the number of bytes actually required for the data.</span></span> <span data-ttu-id="e7b0a-118">Questo numero può essere minore, uguale o maggiore di **dwTotalSize** e include lo spazio per il membro **dwTotalSize** stesso.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-118">This number could be smaller than, equal to, or larger than **dwTotalSize**, and it includes space for the **dwTotalSize** member itself.</span></span> <span data-ttu-id="e7b0a-119">Se più grande, la struttura restituita viene riempita solo parzialmente.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-119">If larger, the returned structure is only partially filled.</span></span> <span data-ttu-id="e7b0a-120">Se i campi richiesti dall'applicazione sono disponibili nella struttura parziale, non è necessario eseguire altre operazioni.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-120">If the fields the application requires are available in the partial structure, nothing else must be done.</span></span> <span data-ttu-id="e7b0a-121">In caso contrario, l'applicazione deve allocare una struttura almeno la dimensione di **dwNeededSize** e richiamare di nuovo la funzione.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-121">Otherwise, the application should allocate a structure at least the size of **dwNeededSize** and invoke the function again.</span></span> <span data-ttu-id="e7b0a-122">In genere, è disponibile spazio sufficiente per restituire tutte le informazioni, anche se è possibile che le dimensioni siano aumentate.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-122">Usually, enough space is available this time to return all the information, although it is possible the size could have increased again.</span></span>

<span data-ttu-id="e7b0a-123">TAPI compila il membro **dwUsedSize** se restituisce dati all'applicazione per indicare le dimensioni effettive, in byte, della parte della struttura di dati che contiene dati utili.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-123">TAPI fills the **dwUsedSize** member if it returns data to the application to indicate the actual size, in bytes, of the portion of the data structure that contains useful data.</span></span> <span data-ttu-id="e7b0a-124">Se, ad esempio, una struttura allocata è troppo piccola e il campo troncato è un campo di dimensioni variabilmente, **dwNeededSize** è maggiore di **dwTotalSize** e il campo troncato viene lasciato vuoto.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-124">If, for example, a structure that was allocated was too small and the truncated field is a variably sized field, **dwNeededSize** is larger than **dwTotalSize**, and the truncated field is left empty.</span></span> <span data-ttu-id="e7b0a-125">Il membro **dwUsedSize** può quindi essere minore di **dwTotalSize**.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-125">The **dwUsedSize** member could therefore be smaller than **dwTotalSize**.</span></span> <span data-ttu-id="e7b0a-126">I valori dei campi parziali non vengono restituiti.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-126">Partial field values are not returned.</span></span>

<span data-ttu-id="e7b0a-127">L'intestazione seguente è la parte fissa della struttura dei dati.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-127">Following this header is the fixed part of the data structure.</span></span> <span data-ttu-id="e7b0a-128">Contiene campi normali e coppie di dimensioni/offset che descrivono i campi di dimensioni effettive.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-128">It contains regular fields and size/offset pairs that describe the actual variably sized fields.</span></span> <span data-ttu-id="e7b0a-129">Il campo Offset contiene l'offset in byte del campo di dimensioni variabili dall'inizio del record.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-129">The offset field contains the offset in bytes of the variably sized field from the beginning of the record.</span></span> <span data-ttu-id="e7b0a-130">Il campo dimensione contiene le dimensioni in byte del campo di dimensioni variabili.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-130">The size field contains the size in bytes of the variably sized field.</span></span> <span data-ttu-id="e7b0a-131">Se un campo di dimensioni variabili è vuoto, il campo dimensione è zero e l'offset è impostato su zero.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-131">If a variably sized field is empty, then the size field is zero and the offset is set to zero.</span></span> <span data-ttu-id="e7b0a-132">Campi di dimensioni variabili che verrebbero troncati se le dimensioni totali della struttura sono insufficienti.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-132">Variably sized fields that would be truncated if the total structure size is insufficient are left empty.</span></span> <span data-ttu-id="e7b0a-133">Ovvero il campo relativo alle dimensioni viene impostato su zero e l'offset viene impostato su zero.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-133">That is, their size field is set to zero and the offset is set to zero.</span></span> <span data-ttu-id="e7b0a-134">I campi di dimensioni variabili seguono i campi fissi.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-134">The variably sized fields follow the fixed fields.</span></span>

<span data-ttu-id="e7b0a-135">Se il provider di servizi deve riempire un membro variabile, TAPI Inizializza i membri size e offset corrispondenti su zero.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-135">If the service provider must fill a variable member, TAPI initializes the corresponding size and offset members to zero.</span></span> <span data-ttu-id="e7b0a-136">Se il provider di servizi compila il membro della variabile, deve impostare i membri di dimensioni e offset corrispondenti sui valori appropriati, inclusi **dwUsedSize** e **dwNeededSize** se imposta membri variabili.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-136">If the service provider fills in the variable member, it must set the corresponding size and offset members to appropriate values, including **dwUsedSize** and **dwNeededSize** if it sets variable members.</span></span> <span data-ttu-id="e7b0a-137">Il provider di servizi non deve troncare un membro della variabile per adattarlo allo spazio disponibile.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-137">The service provider must not truncate a variable member to make it fit into the available space.</span></span>

<span data-ttu-id="e7b0a-138">Il provider di servizi deve avviare membri variabili immediatamente dopo i membri fissi della struttura e lasciare spazio aggiuntivo alla fine della memoria allocata, in modo che TAPI possa usarlo per i membri a lunghezza variabile.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-138">The service provider must start variable members immediately after the fixed members of the structure, and leave any extra space at the end of the allocated memory so that TAPI can use it for the variable-length members.</span></span> <span data-ttu-id="e7b0a-139">Può inserire i membri della variabile in qualsiasi ordine, ma i membri devono essere contigui.</span><span class="sxs-lookup"><span data-stu-id="e7b0a-139">It can place the variable members in any order, but the members must be contiguous.</span></span>

 

 



