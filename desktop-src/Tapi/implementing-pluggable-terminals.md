---
description: Di seguito sono elencati i requisiti generali per l'implementazione del terminale collegabile.
ms.assetid: 7cee19b1-ceea-494a-b576-4deede759905
title: Implementazione di terminali collegabili
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 494b2f6bc5ccb214bc7101f570a4db3037fd8cae
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106313258"
---
# <a name="implementing-pluggable-terminals"></a><span data-ttu-id="1879a-103">Implementazione di terminali collegabili</span><span class="sxs-lookup"><span data-stu-id="1879a-103">Implementing Pluggable Terminals</span></span>

<span data-ttu-id="1879a-104">I requisiti generali per l'implementazione del terminale modulare sono:</span><span class="sxs-lookup"><span data-stu-id="1879a-104">The general requirements for pluggable terminal implementation are:</span></span>

-   <span data-ttu-id="1879a-105">Il codice di streaming sottostante di un terminale collegabile deve corrispondere alle funzionalità del MSPs desiderato.</span><span class="sxs-lookup"><span data-stu-id="1879a-105">A pluggable terminal's underlying streaming code should match the capabilities of the desired MSPs.</span></span>
-   <span data-ttu-id="1879a-106">Il terminale deve usare i filtri DirectShow per lavorare con la maggior parte dei MSPs (questa operazione si presuppone da qui in poi).</span><span class="sxs-lookup"><span data-stu-id="1879a-106">The terminal must use DirectShow filters to work with most MSPs (this is assumed from here on).</span></span>
-   <span data-ttu-id="1879a-107">Per la maggior parte dei MSPs, i terminali audio devono supportare un PCM lineare mono da 8 kHz a 16 bit.</span><span class="sxs-lookup"><span data-stu-id="1879a-107">Audio terminals must support 8 kHz 16-bit mono linear PCM for most MSPs.</span></span>
-   <span data-ttu-id="1879a-108">Il terminale deve abilitare il marshalling a thread libero mediante l'implementazione di [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span><span class="sxs-lookup"><span data-stu-id="1879a-108">The terminal should enable free threaded marshalling by implementing [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span></span> <span data-ttu-id="1879a-109">Il terminale può eseguire questa operazione chiamando l'API COM [**CoCreateFreeThreadedMarshaler**](/windows/win32/api/combaseapi/nf-combaseapi-cocreatefreethreadedmarshaler) e aggregando **IMarshal** al puntatore restituito.</span><span class="sxs-lookup"><span data-stu-id="1879a-109">The terminal can do this by calling the COM API [**CoCreateFreeThreadedMarshaler**](/windows/win32/api/combaseapi/nf-combaseapi-cocreatefreethreadedmarshaler) and aggregating **IMarshal** to the returned pointer.</span></span> <span data-ttu-id="1879a-110">Il distruttore dell'oggetto terminale deve chiamare [**IMarshal->versione**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span><span class="sxs-lookup"><span data-stu-id="1879a-110">The terminal object's destructor should call [**IMarshal->Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span>
-   <span data-ttu-id="1879a-111">Il terminale deve implementare o aggregare eventuali interfacce aggiuntive specifiche del terminale appropriate.</span><span class="sxs-lookup"><span data-stu-id="1879a-111">The terminal should implement or aggregate any additional terminal-specific interfaces that are appropriate.</span></span>
-   <span data-ttu-id="1879a-112">L'implementazione del terminale deve essere thread-safe.</span><span class="sxs-lookup"><span data-stu-id="1879a-112">The terminal implementation must be thread-safe.</span></span>
-   <span data-ttu-id="1879a-113">L'implementazione del terminale deve \# includere termmgr. h per la definizione di [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol).</span><span class="sxs-lookup"><span data-stu-id="1879a-113">The terminal implementation must \#include Termmgr.h for the definition of [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol).</span></span> <span data-ttu-id="1879a-114">Si tratta di un'aggiunta alle librerie usuali e alle librerie necessarie per le applicazioni TAPI 3 o TAPI 3 in Windows 2000 SP1.</span><span class="sxs-lookup"><span data-stu-id="1879a-114">This is in addition to the usual includes and libs that are needed for TAPI 3 or TAPI 3 applications under Windows 2000 SP1.</span></span>

<span data-ttu-id="1879a-115">Note sull'implementazione del metodo e dell'interfaccia:</span><span class="sxs-lookup"><span data-stu-id="1879a-115">Interface and method implementation notes:</span></span>

<span data-ttu-id="1879a-116">Il terminale deve implementare [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) (Dual Interface-vtable + [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)).</span><span class="sxs-lookup"><span data-stu-id="1879a-116">The terminal must implement [**ITTerminal**](/windows/win32/api/tapi3if/nn-tapi3if-itterminal) (dual interface–vtable + [**IDispatch**](/windows/win32/api/oaidl/nn-oaidl-idispatch)).</span></span>

[<span data-ttu-id="1879a-117">**ITTerminal:: Get \_ TerminalClass**</span><span class="sxs-lookup"><span data-stu-id="1879a-117">**ITTerminal::get\_TerminalClass**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_terminalclass)

<span data-ttu-id="1879a-118">Il terminale deve restituire una rappresentazione **BSTR** di un GUID selezionato che identifica il tipo di terminale.</span><span class="sxs-lookup"><span data-stu-id="1879a-118">The terminal must return a **BSTR** representation of a GUID you've picked that identifies your type of terminal.</span></span> <span data-ttu-id="1879a-119">Allocare **BSTR** tramite [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span><span class="sxs-lookup"><span data-stu-id="1879a-119">Allocate the **BSTR** via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span></span> <span data-ttu-id="1879a-120">Per eseguire la conversione da GUID a **BSTR**, chiamare [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid), **SysAllocString** e [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree).</span><span class="sxs-lookup"><span data-stu-id="1879a-120">To convert from GUID to **BSTR**, call [**StringFromCLSID**](/windows/win32/api/combaseapi/nf-combaseapi-stringfromclsid), **SysAllocString**, and [**CoTaskMemFree**](/windows/win32/api/combaseapi/nf-combaseapi-cotaskmemfree).</span></span>

[<span data-ttu-id="1879a-121">**ITTerminal:: Get \_ TerminalType**</span><span class="sxs-lookup"><span data-stu-id="1879a-121">**ITTerminal::get\_TerminalType**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_terminaltype)

<span data-ttu-id="1879a-122">Il terminale dovrebbe in genere restituire \_ la dinamica TT se un'applicazione implementa il terminale.</span><span class="sxs-lookup"><span data-stu-id="1879a-122">The terminal should generally return TT\_DYNAMIC if an application implements the terminal.</span></span> <span data-ttu-id="1879a-123">Il ripristino \_ della staticità TT funziona anche e la restituzione di questo valore può essere appropriata se il terminale corrisponde a un dispositivo hardware. Tuttavia, questa operazione può generare confusione per gli utenti perché un terminale statico non sarà presente nell'enumerazione del terminale statico di msp.</span><span class="sxs-lookup"><span data-stu-id="1879a-123">Returning TT\_STATIC will also work, and returning this value may be appropriate if the terminal corresponds to a hardware device; however, doing this may be confusing to users because a static terminal will not be present in the MSP's static terminal enumeration.</span></span>

[<span data-ttu-id="1879a-124">**Stato ITTerminal:: Get \_**</span><span class="sxs-lookup"><span data-stu-id="1879a-124">**ITTerminal::get\_State**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state)

<span data-ttu-id="1879a-125">Se l'implementazione del terminale non limita arbitrariamente il numero di flussi a cui il terminale può essere connesso contemporaneamente, il terminale deve sempre restituire NOTINUSE di Servizi terminal \_ .</span><span class="sxs-lookup"><span data-stu-id="1879a-125">If the terminal implementation does not arbitrarily limit the number of streams that the terminal can be concurrently connected to, then the terminal should always return TS\_NOTINUSE.</span></span>

<span data-ttu-id="1879a-126">In caso contrario, l'implementazione del terminale limita arbitrariamente il numero di flussi a cui è possibile connettere il terminale alla volta.</span><span class="sxs-lookup"><span data-stu-id="1879a-126">Otherwise, the terminal implementation arbitrarily limits the number of streams that the terminal can be connected to at a time.</span></span> <span data-ttu-id="1879a-127">In questo caso, il terminale deve tenere un conteggio del numero di flussi a cui è connesso.</span><span class="sxs-lookup"><span data-stu-id="1879a-127">In this case, the terminal should keep a count of how many streams it is connected to.</span></span> <span data-ttu-id="1879a-128">Il terminale deve incrementare il conteggio interno in una chiamata [**ITTerminalControl:: ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) riuscita e decrementare la chiamata a [**ITTerminalControl::D isconnectterminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal) .</span><span class="sxs-lookup"><span data-stu-id="1879a-128">The terminal should increment this internal count on a successful [**ITTerminalControl::ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) call and decrement it on a successful [**ITTerminalControl::DisconnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal) call.</span></span> <span data-ttu-id="1879a-129">Nello [**\_ stato ITTerminal:: Get**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state)deve restituire \_ InUse di Servizi terminal se il conteggio è uguale al numero massimo di flussi in cui è possibile selezionare il terminale alla volta; in caso contrario, deve restituire NOTINUSE Servizi terminal \_ .</span><span class="sxs-lookup"><span data-stu-id="1879a-129">In [**ITTerminal::get\_State**](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_state), it should return TS\_INUSE if this count is equal to the maximum number of streams that the terminal can be selected on at a time; otherwise, it should return TS\_NOTINUSE.</span></span> <span data-ttu-id="1879a-130">Si noti che se il limite è uno, il conteggio può essere semplicemente un valore booleano o un \_ valore dello stato del terminale.</span><span class="sxs-lookup"><span data-stu-id="1879a-130">Note that if the limit is one, the count can simply be a Boolean or a TERMINAL\_STATE value.</span></span>

[<span data-ttu-id="1879a-131">**ITTerminal:: Get \_ nome**</span><span class="sxs-lookup"><span data-stu-id="1879a-131">**ITTerminal::get\_Name**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_name)

<span data-ttu-id="1879a-132">Il terminale deve restituire un nome **BSTR** di propria scelta, allocato tramite [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span><span class="sxs-lookup"><span data-stu-id="1879a-132">The terminal should return a **BSTR** name of its choice, allocated via [**SysAllocString**](/windows/win32/api/oleauto/nf-oleauto-sysallocstring).</span></span> <span data-ttu-id="1879a-133">Questo nome deve essere significativo per l'utente e deve essere localizzato.</span><span class="sxs-lookup"><span data-stu-id="1879a-133">This name should be meaningful to the user and should be localized.</span></span>

[<span data-ttu-id="1879a-134">**ITTerminal:: Get \_ mediaType**</span><span class="sxs-lookup"><span data-stu-id="1879a-134">**ITTerminal::get\_MediaType**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_mediatype)

<span data-ttu-id="1879a-135">Il terminale deve restituire il tipo di supporto, ovvero TAPIMEDIATYPE \_ audio o TAPIMEDIATYPE \_ video.</span><span class="sxs-lookup"><span data-stu-id="1879a-135">The terminal should return its media type, either TAPIMEDIATYPE\_AUDIO or TAPIMEDIATYPE\_VIDEO.</span></span>

[<span data-ttu-id="1879a-136">**Direzione di ITTerminal:: Get \_**</span><span class="sxs-lookup"><span data-stu-id="1879a-136">**ITTerminal::get\_Direction**</span></span>](/windows/win32/api/tapi3if/nf-tapi3if-itterminal-get_direction)

<span data-ttu-id="1879a-137">Il terminale restituisce il \_ valore enum della direzione del terminale che indica la direzione del terminale.</span><span class="sxs-lookup"><span data-stu-id="1879a-137">The terminal returns the TERMINAL\_DIRECTION enum value indicating the direction of the terminal.</span></span> <span data-ttu-id="1879a-138">Se il terminale è bidirezionale (ad esempio, un Bridge), deve restituire TD \_ bidirezionale.</span><span class="sxs-lookup"><span data-stu-id="1879a-138">If the terminal is bidirectional (for example, a bridge), then it must return TD\_BIDIRECTIONAL.</span></span>

<span data-ttu-id="1879a-139">Il terminale deve implementare [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) (solo vtable).</span><span class="sxs-lookup"><span data-stu-id="1879a-139">The terminal must implement [**ITTerminalControl**](/windows/desktop/api/Termmgr/nn-termmgr-itterminalcontrol) (vtable only).</span></span>

[<span data-ttu-id="1879a-140">**ITTerminalControl:: Get \_ AddressHandle**</span><span class="sxs-lookup"><span data-stu-id="1879a-140">**ITTerminalControl::get\_AddressHandle**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-get_addresshandle)

<span data-ttu-id="1879a-141">Un terminale fornito dall'applicazione deve sempre restituire **null** come handle di indirizzo.</span><span class="sxs-lookup"><span data-stu-id="1879a-141">An application-provided terminal should always return **NULL** as the address handle.</span></span> <span data-ttu-id="1879a-142">Indica al MSP che questo terminale non è stato creato in un oggetto specifico di un indirizzo MSP.</span><span class="sxs-lookup"><span data-stu-id="1879a-142">This indicates to the MSP that this terminal was not created on a specific MSP address object.</span></span>

[<span data-ttu-id="1879a-143">**ITTerminalControl::ConnectTerminal**</span><span class="sxs-lookup"><span data-stu-id="1879a-143">**ITTerminalControl::ConnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal)

<span data-ttu-id="1879a-144">In questa chiamata il terminale aggiunge i filtri al grafico specificato e li connette tra loro, se applicabile.</span><span class="sxs-lookup"><span data-stu-id="1879a-144">On this call, the terminal will add its filter(s) to the given graph and connect them to each other, if applicable.</span></span> <span data-ttu-id="1879a-145">Il terminale deve quindi restituire i pin esposti dal terminale per la direzione del flusso specificata.</span><span class="sxs-lookup"><span data-stu-id="1879a-145">Then the terminal should return the pin(s) exposed by the terminal for the stream direction specified.</span></span>

<span data-ttu-id="1879a-146">Un terminale che non supporta la connessione simultanea a più flussi potrebbe impostare una variabile interna su INUSE di Servizi terminal al \_ completamento del metodo.</span><span class="sxs-lookup"><span data-stu-id="1879a-146">A terminal that does not support concurrent connection to multiple streams would set an internal variable to TS\_INUSE on successful completion of this method.</span></span>

<span data-ttu-id="1879a-147">Il terminale può usare il parametro *dwTerminalDirection* della chiamata per determinare la direzione del flusso a cui è connessa.</span><span class="sxs-lookup"><span data-stu-id="1879a-147">The terminal can use the *dwTerminalDirection* parameter from this call to determine the direction of the stream that it is being connected to.</span></span> <span data-ttu-id="1879a-148">Questa operazione è necessaria per i terminali bidirezionali.</span><span class="sxs-lookup"><span data-stu-id="1879a-148">This is required for bidirectional terminals.</span></span>

> [!Note]  
> <span data-ttu-id="1879a-149">In genere, nelle classi base MSP e in tutti i MSPs noti, il codice del flusso MSP non riuscirà a connettersi se il terminale restituisce più di un pin da una singola chiamata [**ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) .</span><span class="sxs-lookup"><span data-stu-id="1879a-149">Typically (in the MSP base classes and in all known MSPs), the MSP stream code will fail the connection if the terminal returns more than one pin from a single [**ConnectTerminal**](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-connectterminal) call.</span></span> <span data-ttu-id="1879a-150">Questo è corretto, perché un terminale che restituisce più di un PIN durante la connessione richiede che il MSP abbia una conoscenza speciale del terminale per poter usare i pin aggiuntivi in modo efficace.</span><span class="sxs-lookup"><span data-stu-id="1879a-150">This is fine, because a terminal that returns more than one pin during connection requires the MSP to have special knowledge of the terminal to make use of the extra pins effectively.</span></span>

 

[<span data-ttu-id="1879a-151">**ITTerminalControl::CompleteConnectTerminal**</span><span class="sxs-lookup"><span data-stu-id="1879a-151">**ITTerminalControl::CompleteConnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-completeconnectterminal)

<span data-ttu-id="1879a-152">Il terminale dovrebbe solo restituire S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="1879a-152">The terminal should just return S\_OK.</span></span> <span data-ttu-id="1879a-153">Il terminale può inoltre eseguire l'inizializzazione post-connessione, se necessario.</span><span class="sxs-lookup"><span data-stu-id="1879a-153">The terminal may also do post-connection initialization if it needs to.</span></span>

[<span data-ttu-id="1879a-154">**ITTerminalControl::D isconnectTerminal**</span><span class="sxs-lookup"><span data-stu-id="1879a-154">**ITTerminalControl::DisconnectTerminal**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-disconnectterminal)

<span data-ttu-id="1879a-155">Il terminale deve eseguire tutte le operazioni necessarie per disconnettere il terminale dal resto del grafo.</span><span class="sxs-lookup"><span data-stu-id="1879a-155">The terminal should do whatever is needed to disconnect the terminal from the rest of the graph.</span></span> <span data-ttu-id="1879a-156">Questa operazione comporta in genere la rimozione di tutti i filtri dei terminali dal grafico e l'impostazione dello stato finale su Servizi terminal \_ NOTINUSE.</span><span class="sxs-lookup"><span data-stu-id="1879a-156">Typically this involves removing all the terminals' filters from the graph and setting the terminal state to TS\_NOTINUSE.</span></span>

[<span data-ttu-id="1879a-157">**ITTerminalControl::RunRenderFilter**</span><span class="sxs-lookup"><span data-stu-id="1879a-157">**ITTerminalControl::RunRenderFilter**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-runrenderfilter)

<span data-ttu-id="1879a-158">Il terminale dovrebbe solo restituire E \_ NOTIMPL.</span><span class="sxs-lookup"><span data-stu-id="1879a-158">The terminal should just return E\_NOTIMPL.</span></span>

[<span data-ttu-id="1879a-159">**ITTerminalControl::StopRenderFilter**</span><span class="sxs-lookup"><span data-stu-id="1879a-159">**ITTerminalControl::StopRenderFilter**</span></span>](/windows/desktop/api/Termmgr/nf-termmgr-itterminalcontrol-stoprenderfilter)

<span data-ttu-id="1879a-160">Il terminale dovrebbe solo restituire E \_ NOTIMPL.</span><span class="sxs-lookup"><span data-stu-id="1879a-160">The terminal should just return E\_NOTIMPL.</span></span>

 

 
