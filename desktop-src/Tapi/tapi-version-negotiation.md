---
description: Nel tempo è possibile che esistano versioni diverse per TAPI, le applicazioni e i provider di servizi per una riga o un telefono.
ms.assetid: 36a17ae8-31db-4db9-a401-097d47aa26ad
title: Negoziazione della versione di TAPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f41f4ca6f12862d6fc19f982c48b90bdafe2aaa2
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106315262"
---
# <a name="tapi-version-negotiation"></a><span data-ttu-id="0699f-103">Negoziazione della versione di TAPI</span><span class="sxs-lookup"><span data-stu-id="0699f-103">TAPI Version Negotiation</span></span>

<span data-ttu-id="0699f-104">Nel tempo è possibile che esistano versioni diverse per TAPI, le applicazioni e i provider di servizi per una riga o un telefono.</span><span class="sxs-lookup"><span data-stu-id="0699f-104">Over time, different versions may exist for TAPI, applications, and service providers for a line or phone.</span></span> <span data-ttu-id="0699f-105">Le nuove versioni possono definire nuove funzionalità, nuovi campi per le strutture di dati e così via.</span><span class="sxs-lookup"><span data-stu-id="0699f-105">New versions may define new features, new fields to data structures, and so on.</span></span> <span data-ttu-id="0699f-106">I numeri di versione indicano pertanto come interpretare diverse strutture di dati.</span><span class="sxs-lookup"><span data-stu-id="0699f-106">Version numbers therefore indicate how to interpret various data structures.</span></span>

<span data-ttu-id="0699f-107">Per consentire l'interoperabilità ottimale di versioni diverse di applicazioni, versioni di TAPI e versioni di provider di servizi da fornitori diversi, TAPI fornisce un semplice meccanismo di negoziazione della versione in due passaggi per le applicazioni.</span><span class="sxs-lookup"><span data-stu-id="0699f-107">To allow optimal interoperability of different versions of applications, versions of TAPI itself, and versions of service providers by different vendors, TAPI provides a simple, two-step version negotiation mechanism for applications.</span></span> <span data-ttu-id="0699f-108">È necessario concordare due diverse versioni dell'applicazione, TAPI e del provider di servizi per ogni dispositivo line.</span><span class="sxs-lookup"><span data-stu-id="0699f-108">Two different versions must be agreed on by the application, TAPI, and the service provider for each line device.</span></span> <span data-ttu-id="0699f-109">Il primo è il numero di versione per la telefonia di base e supplementare e viene indicato come versione dell'API.</span><span class="sxs-lookup"><span data-stu-id="0699f-109">The first is the version number for Basic and Supplementary Telephony and is referred to as the API version.</span></span> <span data-ttu-id="0699f-110">L'altro è per le estensioni specifiche del provider, se presente, e viene indicato come versione dell'estensione.</span><span class="sxs-lookup"><span data-stu-id="0699f-110">The other is for provider-specific extensions, if any, and is referred to as the extension version.</span></span> <span data-ttu-id="0699f-111">Il formato delle strutture di dati e dei tipi di dati usati dalle funzionalità di base e supplementare di TAPI è definito dalla versione dell'API, mentre la versione dell'estensione determina il formato delle strutture di dati definite dalle estensioni specifiche del fornitore.</span><span class="sxs-lookup"><span data-stu-id="0699f-111">The format of the data structures and datatypes used by TAPI's basic and supplementary features is defined by the API version, while the extension version determines the format of the data structures defined by the vendor-specific extensions.</span></span>

<span data-ttu-id="0699f-112">La negoziazione della versione continua con due fasi.</span><span class="sxs-lookup"><span data-stu-id="0699f-112">Version negotiation proceeds in two phases.</span></span> <span data-ttu-id="0699f-113">Nella prima fase, il numero di versione dell'API viene negoziato e viene ottenuto l'identificatore dell'estensione associato a tutte le estensioni specifiche del fornitore supportate nel dispositivo.</span><span class="sxs-lookup"><span data-stu-id="0699f-113">In the first phase, the API version number is negotiated and the extension identifier associated with any vendor-specific extensions supported on the device is obtained.</span></span> <span data-ttu-id="0699f-114">Nella seconda fase viene negoziata la versione dell'estensione.</span><span class="sxs-lookup"><span data-stu-id="0699f-114">In the second phase, the extension version is negotiated.</span></span> <span data-ttu-id="0699f-115">Se l'applicazione non usa estensioni API, ignora la seconda fase e le estensioni non vengono attivate dal provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="0699f-115">If the application does not use any API extensions, it skips the second phase and extensions are not activated by the service provider.</span></span> <span data-ttu-id="0699f-116">Se l'applicazione vuole usare le estensioni, ma le estensioni del provider di servizi (l'identificatore dell'estensione) non sono riconosciute dall'applicazione, l'applicazione deve ignorare la negoziazione anche per la versione dell'estensione.</span><span class="sxs-lookup"><span data-stu-id="0699f-116">If the application does want to use extensions, but the service provider's extensions (the extension identifier) are not recognized by the application, the application should skip the negotiation for extension version as well.</span></span> <span data-ttu-id="0699f-117">Ogni fornitore dispone di un proprio set di versioni legali (riconosciute) per ogni set di specifiche di estensione che distribuisce.</span><span class="sxs-lookup"><span data-stu-id="0699f-117">Each vendor has its own set of legal (recognized) versions for each set of extension specifications it distributes.</span></span>

<span data-ttu-id="0699f-118">La funzione [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) viene usata per negoziare il numero di versione dell'API da usare.</span><span class="sxs-lookup"><span data-stu-id="0699f-118">The [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) function is used to negotiate the API version number to use.</span></span> <span data-ttu-id="0699f-119">Recupera anche l'identificatore dell'estensione supportato dal dispositivo a linee, restituendo gli zeri se non sono supportate estensioni.</span><span class="sxs-lookup"><span data-stu-id="0699f-119">It also retrieves the extension identifier supported by the line device, returning zeros if no extensions are supported.</span></span> <span data-ttu-id="0699f-120">Con questa chiamata di funzione, l'applicazione fornisce l'intervallo di versioni dell'API con cui è compatibile.</span><span class="sxs-lookup"><span data-stu-id="0699f-120">With this function call, the application provides the API version range it is compatible with.</span></span> <span data-ttu-id="0699f-121">TAPI a sua volta negozia con il provider di servizi della linea per determinare l'intervallo di versioni dell'API supportato.</span><span class="sxs-lookup"><span data-stu-id="0699f-121">TAPI in turn negotiates with the line's service provider to determine which API version range it supports.</span></span> <span data-ttu-id="0699f-122">Successivamente, TAPI seleziona un numero di versione (in genere, anche se non necessariamente, il numero di versione più alto) nell'intervallo di versioni sovrapposte fornito dall'applicazione, dalla DLL e dal provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="0699f-122">TAPI next selects a version number (typically, although not necessarily, the highest version number) in the overlapping version range that the application, the DLL, and the service provider have supplied.</span></span> <span data-ttu-id="0699f-123">Questo numero viene restituito all'applicazione, insieme all'identificatore dell'estensione che definisce le estensioni disponibili dal provider di servizi di tale riga.</span><span class="sxs-lookup"><span data-stu-id="0699f-123">This number is returned to the application, along with the extension identifier that defines the extensions available from that line's service provider.</span></span>

<span data-ttu-id="0699f-124">Se l'applicazione vuole usare le estensioni definite dall'identificatore di estensione restituito, deve prima chiamare [**lineNegotiateExtVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion) per negoziare la versione dell'estensione.</span><span class="sxs-lookup"><span data-stu-id="0699f-124">If the application wants to use the extensions defined by the returned extension identifier, it must first call [**lineNegotiateExtVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion) to negotiate the extension version.</span></span> <span data-ttu-id="0699f-125">In una fase di negoziazione simile, l'applicazione specifica la versione dell'API già concordata e l'intervallo di versioni dell'estensione che supporta.</span><span class="sxs-lookup"><span data-stu-id="0699f-125">In a similar negotiation phase, the application specifies the already agreed-upon API version and the extension version range it supports.</span></span> <span data-ttu-id="0699f-126">TAPI passa queste informazioni al provider di servizi per la riga.</span><span class="sxs-lookup"><span data-stu-id="0699f-126">TAPI passes this information to the service provider for the line.</span></span> <span data-ttu-id="0699f-127">Il provider di servizi controlla la versione dell'API e l'intervallo di versioni dell'estensione rispetto a se stesso e seleziona il numero di versione dell'estensione appropriato, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="0699f-127">The service provider checks the API version and the extension version range against its own, and selects the appropriate extension version number, if one exists.</span></span>

<span data-ttu-id="0699f-128">Quando l'applicazione chiama in un secondo momento [**lineGetDevCaps**](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps), restituisce un set di funzionalità del dispositivo per la riga che corrispondono ai risultati della negoziazione della versione.</span><span class="sxs-lookup"><span data-stu-id="0699f-128">When the application later calls [**lineGetDevCaps**](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps), it returns a set of device capabilities for the line that correspond to the results of version negotiation.</span></span> <span data-ttu-id="0699f-129">Sono incluse le funzionalità del dispositivo della linea coerenti con la versione dell'API e le funzionalità specifiche del dispositivo della linea coerenti con la versione dell'estensione.</span><span class="sxs-lookup"><span data-stu-id="0699f-129">These include the line's device capabilities consistent with the API version and the line's device-specific capabilities consistent with the extension version.</span></span> <span data-ttu-id="0699f-130">Quando si apre una riga, l'applicazione deve specificare entrambi i numeri di versione.</span><span class="sxs-lookup"><span data-stu-id="0699f-130">The application must specify both of these version numbers when it opens a line.</span></span> <span data-ttu-id="0699f-131">A questo punto, l'applicazione, la DLL e il provider di servizi si impegnano a usare le versioni concordate.</span><span class="sxs-lookup"><span data-stu-id="0699f-131">At that point, the application, the DLL, and the service provider are committed to using the agreed-upon versions.</span></span> <span data-ttu-id="0699f-132">Se le estensioni specifiche del dispositivo non devono essere usate, la versione dell'estensione deve essere specificata come zero.</span><span class="sxs-lookup"><span data-stu-id="0699f-132">If device-specific extensions are not to be used, the extension version should be specified as zero.</span></span>

<span data-ttu-id="0699f-133">In un ambiente in cui più applicazioni aprono lo stesso dispositivo a linee, la prima applicazione per aprire il dispositivo linea seleziona le versioni per tutte le applicazioni future che vogliono usare la linea (i provider di servizi non supportano più versioni simultaneamente). Analogamente, un'applicazione che apre più dispositivi linea può risultare più semplice utilizzare tutti i dispositivi linea con lo stesso numero di versione dell'API.</span><span class="sxs-lookup"><span data-stu-id="0699f-133">In an environment where multiple applications open the same line device, the first application to open the line device selects the versions for all future applications that want to use the line (service providers do not support multiple versions simultaneously.) Similarly, an application that opens multiple line devices may find it easier to operate all line devices under the same API version number.</span></span>

<span data-ttu-id="0699f-134">Ogni funzione che accetta un parametro *dwAPIVersion* o analogo deve impostare questo parametro sulla versione API più elevata supportata dall'applicazione o sulla versione dell'API negoziata usando la funzione [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) o [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) in un particolare dispositivo.</span><span class="sxs-lookup"><span data-stu-id="0699f-134">Every function that takes a *dwAPIVersion* or similar parameter must set this parameter to either the highest API version supported by the application or the API version negotiated using the [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion) or [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) function on a particular device.</span></span> <span data-ttu-id="0699f-135">Usare la tabella seguente come guida:</span><span class="sxs-lookup"><span data-stu-id="0699f-135">Use the following table as a guide:</span></span>



| <span data-ttu-id="0699f-136">Funzione</span><span class="sxs-lookup"><span data-stu-id="0699f-136">Function</span></span>                                                     | <span data-ttu-id="0699f-137">Significato</span><span class="sxs-lookup"><span data-stu-id="0699f-137">Meaning</span></span>                                                                               |
|--------------------------------------------------------------|---------------------------------------------------------------------------------------|
| [<span data-ttu-id="0699f-138">**lineGetAddressCaps**</span><span class="sxs-lookup"><span data-stu-id="0699f-138">**lineGetAddressCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetaddresscaps)             | <span data-ttu-id="0699f-139">Usa la versione restituita da [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="0699f-139">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="0699f-140">**lineGetCountry**</span><span class="sxs-lookup"><span data-stu-id="0699f-140">**lineGetCountry**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetcountry)                     | <span data-ttu-id="0699f-141">Usare la versione più recente supportata dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0699f-141">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="0699f-142">**lineGetDevCaps**</span><span class="sxs-lookup"><span data-stu-id="0699f-142">**lineGetDevCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetdevcaps)                     | <span data-ttu-id="0699f-143">Usa la versione restituita da [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="0699f-143">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="0699f-144">**lineGetProviderList**</span><span class="sxs-lookup"><span data-stu-id="0699f-144">**lineGetProviderList**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegetproviderlist)           | <span data-ttu-id="0699f-145">Usare la versione più recente supportata dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0699f-145">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="0699f-146">**lineGetTranslateCaps**</span><span class="sxs-lookup"><span data-stu-id="0699f-146">**lineGetTranslateCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linegettranslatecaps)         | <span data-ttu-id="0699f-147">Usare la versione più recente supportata dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0699f-147">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="0699f-148">**lineNegotiateAPIVersion**</span><span class="sxs-lookup"><span data-stu-id="0699f-148">**lineNegotiateAPIVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion)   | <span data-ttu-id="0699f-149">Usare la versione più recente supportata dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0699f-149">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="0699f-150">**lineNegotiateExtVersion**</span><span class="sxs-lookup"><span data-stu-id="0699f-150">**lineNegotiateExtVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linenegotiateextversion)   | <span data-ttu-id="0699f-151">Usa la versione restituita da [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="0699f-151">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="0699f-152">**lineOpen**</span><span class="sxs-lookup"><span data-stu-id="0699f-152">**lineOpen**</span></span>](/windows/desktop/api/Tapi/nf-tapi-lineopen)                                 | <span data-ttu-id="0699f-153">Usa la versione restituita da [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="0699f-153">Use version returned by [**lineNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-linenegotiateapiversion).</span></span>   |
| [<span data-ttu-id="0699f-154">**lineTranslateAddress**</span><span class="sxs-lookup"><span data-stu-id="0699f-154">**lineTranslateAddress**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linetranslateaddress)         | <span data-ttu-id="0699f-155">Usare la versione più recente supportata dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0699f-155">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="0699f-156">**lineTranslateDialog**</span><span class="sxs-lookup"><span data-stu-id="0699f-156">**lineTranslateDialog**</span></span>](/windows/desktop/api/Tapi/nf-tapi-linetranslatedialog)           | <span data-ttu-id="0699f-157">Usare la versione più recente supportata dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0699f-157">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="0699f-158">**phoneGetDevCaps**</span><span class="sxs-lookup"><span data-stu-id="0699f-158">**phoneGetDevCaps**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonegetdevcaps)                   | <span data-ttu-id="0699f-159">Usa la versione restituita da [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="0699f-159">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |
| [<span data-ttu-id="0699f-160">**phoneNegotiateAPIVersion**</span><span class="sxs-lookup"><span data-stu-id="0699f-160">**phoneNegotiateAPIVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion) | <span data-ttu-id="0699f-161">Usare la versione più recente supportata dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="0699f-161">Use highest version supported by the application.</span></span>                                     |
| [<span data-ttu-id="0699f-162">**phoneNegotiateExtVersion**</span><span class="sxs-lookup"><span data-stu-id="0699f-162">**phoneNegotiateExtVersion**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateextversion) | <span data-ttu-id="0699f-163">Usa la versione restituita da [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="0699f-163">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |
| [<span data-ttu-id="0699f-164">**phoneOpen**</span><span class="sxs-lookup"><span data-stu-id="0699f-164">**phoneOpen**</span></span>](/windows/desktop/api/Tapi/nf-tapi-phoneopen)                               | <span data-ttu-id="0699f-165">Usa la versione restituita da [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span><span class="sxs-lookup"><span data-stu-id="0699f-165">Use version returned by [**phoneNegotiateAPIVersion**](/windows/desktop/api/Tapi/nf-tapi-phonenegotiateapiversion).</span></span> |



 

> [!IMPORTANT]
> <span data-ttu-id="0699f-166">Quando si negozia una versione dell'API, impostare sempre i numeri di versione alta e bassa sull'intervallo di versioni che l'applicazione è in grado di supportare.</span><span class="sxs-lookup"><span data-stu-id="0699f-166">When negotiating an API version, always set the high and low version numbers to the range of versions that your application can support.</span></span> <span data-ttu-id="0699f-167">Ad esempio, non usare mai 0x00000000 per la versione bassa o 0xFFFFFFFF per l'alta perché questi valori richiedono che l'applicazione supporti tutte le versioni di TAPI, sia passate che future.</span><span class="sxs-lookup"><span data-stu-id="0699f-167">For example, never use 0x00000000 for the low version or 0xFFFFFFFF for the high because these values require that your application support all versions of TAPI, both past and future.</span></span>

 

 

 



