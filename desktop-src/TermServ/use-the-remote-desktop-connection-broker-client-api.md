---
title: Come usare l'API client di Connessione Desktop remoto broker
description: L'API client di Connessione Desktop remoto Broker consente ai fornitori di protocolli di terze parti di sfruttare il broker di connessione per accelerare la gestione delle connessioni che usano il protocollo per connettersi alle macchine virtuali o ai server Desktop remoto in una farm.
ms.assetid: 05C2D6CA-C9C5-4783-B196-6A02918046EF
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: c931245870cfb72aed54e5aaff24e12d03ddf9e7
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "104338878"
---
# <a name="how-to-use-the-remote-desktop-connection-broker-client-api"></a><span data-ttu-id="05be5-103">Come usare l'API client di Connessione Desktop remoto broker</span><span class="sxs-lookup"><span data-stu-id="05be5-103">How to use the Remote Desktop Connection Broker client API</span></span>

<span data-ttu-id="05be5-104">L'API client di Connessione Desktop remoto Broker consente ai fornitori di protocolli di terze parti di sfruttare il broker di connessione per accelerare la gestione delle connessioni che usano il protocollo per connettersi alle macchine virtuali o ai server Desktop remoto in una farm.</span><span class="sxs-lookup"><span data-stu-id="05be5-104">The Remote Desktop Connection Broker client API allows third party protocol vendors to leverage the Connection Broker to expedite the handling of connections that use their protocol to connect to virtual machines or Remote Desktop servers in a farm.</span></span>

## <a name="instructions"></a><span data-ttu-id="05be5-105">Istruzioni</span><span class="sxs-lookup"><span data-stu-id="05be5-105">Instructions</span></span>

### <a name="step-1-obtain-the-iconnectionbrokerclient-interface"></a><span data-ttu-id="05be5-106">Passaggio 1: ottenere l'interfaccia IConnectionBrokerClient</span><span class="sxs-lookup"><span data-stu-id="05be5-106">Step 1: Obtain the IConnectionBrokerClient interface</span></span>

<span data-ttu-id="05be5-107">Quando viene inizializzato il provider dell'applicazione o del protocollo, seguire questa procedura.</span><span class="sxs-lookup"><span data-stu-id="05be5-107">When your application or protocol provider is initialized, perform the following steps.</span></span>

1.  <span data-ttu-id="05be5-108">Chiamare la funzione [**CBCreateClientInstance**](cbcreateclientinstance.md) per ottenere l'interfaccia [**IConnectionBrokerClient**](iconnectionbrokerclient.md) .</span><span class="sxs-lookup"><span data-stu-id="05be5-108">Call the [**CBCreateClientInstance**](cbcreateclientinstance.md) function to obtain the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface.</span></span>
2.  <span data-ttu-id="05be5-109">Mantieni l'interfaccia [**IConnectionBrokerClient**](iconnectionbrokerclient.md) finché ti serve.</span><span class="sxs-lookup"><span data-stu-id="05be5-109">Keep the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface as long as you need it.</span></span>
3.  <span data-ttu-id="05be5-110">Quando l'interfaccia [**IConnectionBrokerClient**](iconnectionbrokerclient.md) non è più necessaria, chiamare il metodo [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) .</span><span class="sxs-lookup"><span data-stu-id="05be5-110">When the [**IConnectionBrokerClient**](iconnectionbrokerclient.md) interface is no longer needed, call the [**Release**](/windows/desktop/api/unknwn/nf-unknwn-iunknown-release) method.</span></span>

### <a name="step-2-request-the-target-information"></a><span data-ttu-id="05be5-111">Passaggio 2: richiedere le informazioni di destinazione</span><span class="sxs-lookup"><span data-stu-id="05be5-111">Step 2: Request the target information</span></span>

<span data-ttu-id="05be5-112">Quando il provider di protocollo riceve una richiesta di connessione in ingresso, seguire questa procedura per chiamare il metodo [**IConnectionBrokerClient:: GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) .</span><span class="sxs-lookup"><span data-stu-id="05be5-112">When your protocol provider receives an incoming connection request, perform the following steps to call the [**IConnectionBrokerClient::GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) method.</span></span> <span data-ttu-id="05be5-113">Questo metodo ottiene, dal gestore della connessione, il server appropriato a cui reindirizzare la connessione.</span><span class="sxs-lookup"><span data-stu-id="05be5-113">This method obtains, from the Connection Broker, the appropriate server to redirect the connection to.</span></span>

1.  <span data-ttu-id="05be5-114">Creare un evento che può essere segnalato usando [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), o funzione simile, da usare per il parametro *hStatusEvent* .</span><span class="sxs-lookup"><span data-stu-id="05be5-114">Create an event that can be signaled using the [**CreateEvent**](/windows/desktop/api/synchapi/nf-synchapi-createeventa), or similar function, to use for the *hStatusEvent* parameter.</span></span>
2.  <span data-ttu-id="05be5-115">Allocare memoria per i parametri *pTargetInfo* e *pResult* .</span><span class="sxs-lookup"><span data-stu-id="05be5-115">Allocate memory for the *pTargetInfo* and *pResult* parameters.</span></span> <span data-ttu-id="05be5-116">Questi blocchi di memoria devono rimanere sul posto finché l'intera sequenza non è completa.</span><span class="sxs-lookup"><span data-stu-id="05be5-116">These memory blocks must remain in place until after this entire sequence is complete.</span></span>
3.  <span data-ttu-id="05be5-117">Compilare una struttura [**di \_ \_ informazioni di connessione CB**](cb-connection-info.md) contenente tutte le informazioni sulla connessione in ingresso.</span><span class="sxs-lookup"><span data-stu-id="05be5-117">Fill out a [**CB\_CONNECTION\_INFO**](cb-connection-info.md) structure that contains all of the information about the incoming connection.</span></span>
4.  <span data-ttu-id="05be5-118">Chiamare il metodo [**GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) , passando tutti i parametri richiesti.</span><span class="sxs-lookup"><span data-stu-id="05be5-118">Call the [**GetTargetInfo**](iconnectionbrokerclient-gettargetinfo.md) method, passing all of the required parameters.</span></span> <span data-ttu-id="05be5-119">Si tratta di un metodo asincrono che restituirà un'istanza dell'interfaccia [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) .</span><span class="sxs-lookup"><span data-stu-id="05be5-119">This is an asynchronous method that will return an instance of the [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) interface.</span></span>
5.  <span data-ttu-id="05be5-120">Attendere l'impostazione dell'evento *hStatusEvent* .</span><span class="sxs-lookup"><span data-stu-id="05be5-120">Wait for the *hStatusEvent* event to become set.</span></span>
6.  <span data-ttu-id="05be5-121">Ogni volta che viene impostato l'evento *hStatusEvent* , chiamare il metodo [**IConnectionBrokerRequest:: CheckStatus**](iconnectionbrokerrequest-checkstatus.md) per determinare lo stato della richiesta.</span><span class="sxs-lookup"><span data-stu-id="05be5-121">Whenever the *hStatusEvent* event is set, call the [**IConnectionBrokerRequest::CheckStatus**](iconnectionbrokerrequest-checkstatus.md) method to determine the status of the request.</span></span>
7.  <span data-ttu-id="05be5-122">Quando [**checkStatus**](iconnectionbrokerrequest-checkstatus.md) restituisce **la \_ richiesta di stato CB \_ \_ completata**, i parametri *pTargetInfo* e *pResult* conterranno le informazioni.</span><span class="sxs-lookup"><span data-stu-id="05be5-122">When [**CheckStatus**](iconnectionbrokerrequest-checkstatus.md) returns **CB\_STATUS\_REQUEST\_COMPLETED**, the *pTargetInfo* and *pResult* parameters will contain their information.</span></span> <span data-ttu-id="05be5-123">È possibile interrompere il ciclo di attesa perché il parametro *hStatusEvent* non verrà più usato.</span><span class="sxs-lookup"><span data-stu-id="05be5-123">You can break out of the wait loop because the *hStatusEvent* parameter will no longer be used.</span></span>
8.  <span data-ttu-id="05be5-124">Usare le informazioni nella struttura [**di \_ \_ informazioni di destinazione CB**](cb-target-info.md) rappresentata dal parametro *pTargetInfo* per determinare la posizione in cui reindirizzare la connessione in ingresso.</span><span class="sxs-lookup"><span data-stu-id="05be5-124">Use the information in the [**CB\_TARGET\_INFO**](cb-target-info.md) structure represented by the *pTargetInfo* parameter to determine where to redirect the incoming connection to.</span></span>
9.  <span data-ttu-id="05be5-125">Rilasciare l'interfaccia [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) .</span><span class="sxs-lookup"><span data-stu-id="05be5-125">Release the [**IConnectionBrokerRequest**](iconnectionbrokerrequest.md) interface.</span></span>
10. <span data-ttu-id="05be5-126">Chiudere l'handle di evento *hStatusEvent* oppure riutilizzarlo per richieste di connessione successive.</span><span class="sxs-lookup"><span data-stu-id="05be5-126">Close the *hStatusEvent* event handle, or you can reuse it for subsequent connection requests.</span></span>

 

 