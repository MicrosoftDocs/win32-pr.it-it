---
title: DLL client canale virtuale
description: Il client di un'applicazione di canali virtuali è una DLL caricata durante l'inizializzazione del Servizi Desktop remoto nel computer client. La DLL deve essere registrata nel computer client.
ms.assetid: fca0505c-c4a9-4230-aeaa-ff3dfa62f581
ms.tgt_platform: multiple
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cfd7ffccda8b1da7dfc3920b0a47a12e97840e0a
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/16/2019
ms.locfileid: "104044775"
---
# <a name="virtual-channel-client-dll"></a><span data-ttu-id="f2d30-104">DLL client canale virtuale</span><span class="sxs-lookup"><span data-stu-id="f2d30-104">Virtual Channel Client DLL</span></span>

<span data-ttu-id="f2d30-105">Il client di un'applicazione di canali virtuali è una DLL caricata durante l'inizializzazione del Servizi Desktop remoto nel computer client.</span><span class="sxs-lookup"><span data-stu-id="f2d30-105">The client of a virtual channels application is a DLL that is loaded during the Remote Desktop Services initialization on the client computer.</span></span> <span data-ttu-id="f2d30-106">La DLL deve essere registrata nel computer client.</span><span class="sxs-lookup"><span data-stu-id="f2d30-106">The DLL must be registered on the client computer.</span></span> <span data-ttu-id="f2d30-107">Per ulteriori informazioni, vedere [registrazione client del canale virtuale](virtual-channel-client-registration.md).</span><span class="sxs-lookup"><span data-stu-id="f2d30-107">For more information, see [Virtual Channel Client Registration](virtual-channel-client-registration.md).</span></span>

<span data-ttu-id="f2d30-108">La DLL client deve esportare una funzione [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) , che Servizi Desktop remoto chiama durante l'inizializzazione.</span><span class="sxs-lookup"><span data-stu-id="f2d30-108">The client DLL must export a [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) function, which Remote Desktop Services calls during initialization.</span></span> <span data-ttu-id="f2d30-109">Il punto di ingresso **VirtualChannelEntry** riceve un puntatore a una struttura di [**punti di \_ ingresso \_ del canale**](/windows/win32/api/cchannel/ns-cchannel-channel_entry_points) .</span><span class="sxs-lookup"><span data-stu-id="f2d30-109">The **VirtualChannelEntry** entry point receives a pointer to a [**CHANNEL\_ENTRY\_POINTS**](/windows/win32/api/cchannel/ns-cchannel-channel_entry_points) structure.</span></span> <span data-ttu-id="f2d30-110">Questa struttura contiene i puntatori alle funzioni che la DLL client chiama per accedere ai canali virtuali.</span><span class="sxs-lookup"><span data-stu-id="f2d30-110">This structure contains pointers to the functions that the client DLL calls to access virtual channels.</span></span>



| <span data-ttu-id="f2d30-111">Funzione</span><span class="sxs-lookup"><span data-stu-id="f2d30-111">Function</span></span>                                                      | <span data-ttu-id="f2d30-112">Descrizione</span><span class="sxs-lookup"><span data-stu-id="f2d30-112">Description</span></span>                                                                                                                                                                                                                                                                           |
|---------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="f2d30-113">**VirtualChannelInit**</span><span class="sxs-lookup"><span data-stu-id="f2d30-113">**VirtualChannelInit**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit)<br/>   | <span data-ttu-id="f2d30-114">Registra i nomi dei canali virtuali che devono essere utilizzati dal client e fornisce una funzione di callback [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) tramite la quale Servizi Desktop remoto notifica al client gli eventi che influiscono sulla connessione client.</span><span class="sxs-lookup"><span data-stu-id="f2d30-114">Registers the names of the virtual channels to be used by the client and provides a [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) callback function through which Remote Desktop Services notifies the client about events that affect the client connection.</span></span><br/> |
| [<span data-ttu-id="f2d30-115">**VirtualChannelOpen**</span><span class="sxs-lookup"><span data-stu-id="f2d30-115">**VirtualChannelOpen**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen)<br/>   | <span data-ttu-id="f2d30-116">Apre l'estremità client di un canale virtuale specificato e fornisce una funzione di callback [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) tramite la quale Servizi Desktop remoto notifica al client gli eventi che influiscono sul canale virtuale.</span><span class="sxs-lookup"><span data-stu-id="f2d30-116">Opens the client end of a specified virtual channel and provides a [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) callback function through which Remote Desktop Services notifies the client about events that affect the virtual channel.</span></span><br/>                    |
| [<span data-ttu-id="f2d30-117">**VirtualChannelWrite**</span><span class="sxs-lookup"><span data-stu-id="f2d30-117">**VirtualChannelWrite**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite)<br/> | <span data-ttu-id="f2d30-118">Scrive i dati in un canale virtuale.</span><span class="sxs-lookup"><span data-stu-id="f2d30-118">Writes data to a virtual channel.</span></span> <span data-ttu-id="f2d30-119">Servizi Desktop remoto invia questi dati all'estremità server del canale virtuale.</span><span class="sxs-lookup"><span data-stu-id="f2d30-119">Remote Desktop Services sends this data to the server end of the virtual channel.</span></span> <span data-ttu-id="f2d30-120">Il termine server chiama la funzione [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) per leggere i dati.</span><span class="sxs-lookup"><span data-stu-id="f2d30-120">The server end calls the [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) function to read the data.</span></span><br/>                                             |
| [<span data-ttu-id="f2d30-121">**VirtualChannelClose**</span><span class="sxs-lookup"><span data-stu-id="f2d30-121">**VirtualChannelClose**</span></span>](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose)<br/> | <span data-ttu-id="f2d30-122">Chiude un canale virtuale.</span><span class="sxs-lookup"><span data-stu-id="f2d30-122">Closes a virtual channel.</span></span><br/>                                                                                                                                                                                                                                                  |



 

<span data-ttu-id="f2d30-123">La funzione [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) della dll deve chiamare la funzione [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) per inizializzare l'accesso ai canali virtuali.</span><span class="sxs-lookup"><span data-stu-id="f2d30-123">Your DLL's [**VirtualChannelEntry**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelentry) function must call the [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) function to initialize access to virtual channels.</span></span> <span data-ttu-id="f2d30-124">Quando si chiama **VirtualChannelInit**, è necessario passare un puntatore alla funzione di callback [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) .</span><span class="sxs-lookup"><span data-stu-id="f2d30-124">When you call **VirtualChannelInit**, you must pass a pointer to the [**VirtualChannelInitEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_init_event_fn) callback function.</span></span> <span data-ttu-id="f2d30-125">Servizi Desktop remoto chiama questa funzione di callback quando l'inizializzazione è completa e di nuovo quando viene stabilita una connessione con un server di host sessione Desktop remoto (host sessione Desktop remoto).</span><span class="sxs-lookup"><span data-stu-id="f2d30-125">Remote Desktop Services calls this callback function when initialization is complete and again when a connection has been established with a Remote Desktop Session Host (RD Session Host) server.</span></span>

<span data-ttu-id="f2d30-126">Una volta stabilita la connessione, è possibile chiamare la funzione [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) per aprire i canali virtuali registrati dalla chiamata [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) .</span><span class="sxs-lookup"><span data-stu-id="f2d30-126">After the connection is established, you can call the [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) function to open the virtual channels registered by the [**VirtualChannelInit**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelinit) call.</span></span> <span data-ttu-id="f2d30-127">La chiamata **VirtualChannelOpen** specifica un puntatore alla funzione di callback [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) .</span><span class="sxs-lookup"><span data-stu-id="f2d30-127">The **VirtualChannelOpen** call specifies a pointer to your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) callback function.</span></span>

<span data-ttu-id="f2d30-128">Dopo la restituzione della chiamata a [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) , è possibile chiamare la funzione [**VirtualChannelWrite**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite) per scrivere sul canale virtuale.</span><span class="sxs-lookup"><span data-stu-id="f2d30-128">After the [**VirtualChannelOpen**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelopen) call returns, you can call the [**VirtualChannelWrite**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelwrite) function to write to the virtual channel.</span></span> <span data-ttu-id="f2d30-129">L'operazione di scrittura è asincrona, pertanto non è necessario liberare o riutilizzare il buffer passato a **VirtualChannelWrite** fino a quando Servizi Desktop remoto chiama la funzione [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) per indicare che l'operazione di scrittura è stata completata.</span><span class="sxs-lookup"><span data-stu-id="f2d30-129">The write operation is asynchronous, so you must not free or reuse the buffer passed to **VirtualChannelWrite** until Remote Desktop Services calls your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) function to indicate that the write operation has been completed.</span></span> <span data-ttu-id="f2d30-130">Quando si chiama **VirtualChannelWrite**, è possibile passare una parte di dati utente che identifica l'operazione di scrittura.</span><span class="sxs-lookup"><span data-stu-id="f2d30-130">When you call **VirtualChannelWrite**, you can pass a piece of user data that identifies the write operation.</span></span> <span data-ttu-id="f2d30-131">Servizi Desktop remoto passa nuovamente i dati utente quando chiama **VirtualChannelOpenEvent** per notificare che l'operazione è stata completata.</span><span class="sxs-lookup"><span data-stu-id="f2d30-131">Remote Desktop Services passes this user data back when it calls **VirtualChannelOpenEvent** to notify you that the operation has completed.</span></span> <span data-ttu-id="f2d30-132">Sul lato server del canale virtuale, il componente aggiuntivo del server chiama la funzione [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) per leggere i dati.</span><span class="sxs-lookup"><span data-stu-id="f2d30-132">At the server end of the virtual channel, the server add-in calls the [**WTSVirtualChannelRead**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelread) function to read the data.</span></span>

<span data-ttu-id="f2d30-133">Servizi Desktop remoto chiama anche la funzione [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) quando i dati vengono scritti nel canale virtuale dal modulo server.</span><span class="sxs-lookup"><span data-stu-id="f2d30-133">Remote Desktop Services also calls your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) function when data is written to the virtual channel by the server module.</span></span> <span data-ttu-id="f2d30-134">Il modulo server chiama la funzione [**WTSVirtualChannelWrite**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelwrite) per scrivere i dati nell'entità finale del canale virtuale del server.</span><span class="sxs-lookup"><span data-stu-id="f2d30-134">The server module calls the [**WTSVirtualChannelWrite**](/windows/desktop/api/Wtsapi32/nf-wtsapi32-wtsvirtualchannelwrite) function to write data to the server end of the virtual channel.</span></span>

<span data-ttu-id="f2d30-135">I moduli client e server possono scrivere blocchi di dati di qualsiasi dimensione nel canale virtuale.</span><span class="sxs-lookup"><span data-stu-id="f2d30-135">The client and server modules can write data blocks of any size to the virtual channel.</span></span> <span data-ttu-id="f2d30-136">Prima di inviare i dati, tuttavia, Servizi Desktop remoto segmenta i dati in blocchi di byte di lunghezza del blocco del canale \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="f2d30-136">Before sending the data, however, Remote Desktop Services segments the data into chunks of CHANNEL\_CHUNK\_LENGTH bytes.</span></span> <span data-ttu-id="f2d30-137">Servizi Desktop remoto chiama la funzione [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) una volta per ogni blocco di dati, anziché ricompilare i dati in un blocco di dimensioni originali.</span><span class="sxs-lookup"><span data-stu-id="f2d30-137">Remote Desktop Services calls your [**VirtualChannelOpenEvent**](/windows/desktop/api/Cchannel/nc-cchannel-channel_open_event_fn) function once for each chunk of data, rather than rebuilding the data into a block of the original size.</span></span> <span data-ttu-id="f2d30-138">Ogni chiamata a **VirtualChannelOpenEvent** indica le dimensioni del blocco, la dimensione totale scritta dal server e se i dati costituiscono l'inizio, il centro o la fine di un blocco scritto dal server.</span><span class="sxs-lookup"><span data-stu-id="f2d30-138">Each call to **VirtualChannelOpenEvent** indicates the size of the chunk, the total size written by the server, and whether the data constitutes the beginning, middle, or end of a block written by the server.</span></span>

<span data-ttu-id="f2d30-139">È possibile chiamare la funzione [**VirtualChannelClose**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose) per chiudere un canale.</span><span class="sxs-lookup"><span data-stu-id="f2d30-139">You can call the [**VirtualChannelClose**](/windows/desktop/api/Cchannel/nc-cchannel-virtualchannelclose) function to close a channel.</span></span> <span data-ttu-id="f2d30-140">Tuttavia, non è necessario chiamarlo perché Servizi Desktop remoto chiude automaticamente tutti i canali quando il client si disconnette dal server.</span><span class="sxs-lookup"><span data-stu-id="f2d30-140">However, it is not necessary to call it because Remote Desktop Services closes all channels automatically when the client disconnects from the server.</span></span>

 

 





