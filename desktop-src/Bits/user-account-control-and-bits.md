---
title: Controllo dell'account utente e BITS
description: Quando un utente amministratore accede al computer, vengono creati due token di accesso. Uno è un token di accesso utente standard filtrato e l'altro è un token di accesso amministratore completo.
ms.assetid: 02439ab3-b885-4a2f-b507-0c48d2b30b76
ms.topic: article
ms.date: 7/12/2019
ms.openlocfilehash: 3017b3a0d816ba393d1427c5c1d2315a68b2dcc0
ms.sourcegitcommit: be77ed1f97d3be57a2f42070589de21b66034adf
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 05/29/2020
ms.locfileid: "103956269"
---
# <a name="bits-security-tokens-and-administrator-accounts"></a><span data-ttu-id="69e09-104">Sicurezza BITS, token e account amministratore</span><span class="sxs-lookup"><span data-stu-id="69e09-104">BITS Security, Tokens, and Administrator Accounts</span></span>

## <a name="http-server-certificate-callbacks"></a><span data-ttu-id="69e09-105">Callback del certificato del server HTTP</span><span class="sxs-lookup"><span data-stu-id="69e09-105">HTTP Server certificate callbacks</span></span>
<span data-ttu-id="69e09-106">La convalida corretta dei certificati server è una parte fondamentale della gestione della sicurezza HTTPS.</span><span class="sxs-lookup"><span data-stu-id="69e09-106">Correctly validating server certificates is a key part of maintaining HTTPS security.</span></span> <span data-ttu-id="69e09-107">BITS consente di convalidare sempre i certificati del server in base a un elenco di requisiti specificati da [**SetSecurityFlags**](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags).</span><span class="sxs-lookup"><span data-stu-id="69e09-107">BITS helps by always validating server certificates against a list of requirements specified by [**SetSecurityFlags**](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags).</span></span> <span data-ttu-id="69e09-108">Per impostazione predefinita, BITS usa la convalida del certificato di tipo "browser".</span><span class="sxs-lookup"><span data-stu-id="69e09-108">By default, BITS uses "browser" style certificate validation.</span></span>

<span data-ttu-id="69e09-109">È anche possibile specificare una funzione personalizzata da chiamare per convalidare ulteriormente il certificato.</span><span class="sxs-lookup"><span data-stu-id="69e09-109">You can also specify a custom function to call in order to further validate the certificate.</span></span> <span data-ttu-id="69e09-110">Impostare il callback del certificato server con il metodo [**SetServerCertificateValidationInterface**](/windows/desktop/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-setservercertificatevalidationinterface) .</span><span class="sxs-lookup"><span data-stu-id="69e09-110">Set the server certificate callback with the [**SetServerCertificateValidationInterface**](/windows/desktop/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-setservercertificatevalidationinterface) method.</span></span> <span data-ttu-id="69e09-111">Il metodo verrà chiamato solo dopo che il sistema operativo ha convalidato il certificato in base alla chiamata di [ **SetSecurityFlag** s](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags) .</span><span class="sxs-lookup"><span data-stu-id="69e09-111">Your method will only be called after the operating system has validated the certificate based on the [**SetSecurityFlag** s](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setsecurityflags) call.</span></span> 

## <a name="http-client-certificates"></a><span data-ttu-id="69e09-112">Certificati client HTTP</span><span class="sxs-lookup"><span data-stu-id="69e09-112">HTTP Client certificates</span></span>
<span data-ttu-id="69e09-113">È possibile impostare un certificato client in un processo HTTP con due diversi metodi di impostazioni del certificato.</span><span class="sxs-lookup"><span data-stu-id="69e09-113">You can set a client certificate on an HTTP job with two different certificate settings methods.</span></span> <span data-ttu-id="69e09-114">È possibile impostare un certificato in base all' [ID](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyid) o al [nome del soggetto](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyname)del certificato.</span><span class="sxs-lookup"><span data-stu-id="69e09-114">You can set a certificate either by [ID](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyid) or by the certificate [subject name](/windows/desktop/api/bits2_5/nf-bits2_5-ibackgroundcopyjobhttpoptions-setclientcertificatebyname).</span></span> <span data-ttu-id="69e09-115">Il certificato client verrà usato durante la negoziazione TLS (o la rinegoziazione) se il server richiede l'autenticazione client.</span><span class="sxs-lookup"><span data-stu-id="69e09-115">The client certificate will be used during TLS negotiation (or renegotiation) if the server requires client authentication.</span></span>

## <a name="write-only-http-headers"></a><span data-ttu-id="69e09-116">Intestazioni HTTP di sola scrittura</span><span class="sxs-lookup"><span data-stu-id="69e09-116">Write-only HTTP headers</span></span>
<span data-ttu-id="69e09-117">BITS consente di proteggere i token di autenticazione HTTP da accessi non desiderati.</span><span class="sxs-lookup"><span data-stu-id="69e09-117">BITS helps you protect HTTP authentication tokens from unwanted access.</span></span> <span data-ttu-id="69e09-118">Spesso un server HTTP necessita di un tipo di token o stringa di sicurezza durante il download o il caricamento di un file nei server HTTP.</span><span class="sxs-lookup"><span data-stu-id="69e09-118">Often an HTTP server will need some kind of security token or string when downloading or uploading a file to HTTP servers.</span></span>

<span data-ttu-id="69e09-119">BITS protegge i token di autenticazione in diversi modi.</span><span class="sxs-lookup"><span data-stu-id="69e09-119">BITS protects these authentication tokens in several ways.</span></span>
* <span data-ttu-id="69e09-120">BITS consente di usare connessioni HTTP protette da TLS e SSL specificando un URL HTTPS.</span><span class="sxs-lookup"><span data-stu-id="69e09-120">BITS lets you use TLS- and SSL-protected HTTP connections by specifying an HTTPS URL.</span></span>
* <span data-ttu-id="69e09-121">Le intestazioni personalizzate sono sempre mantenute in un formato crittografato su disco.</span><span class="sxs-lookup"><span data-stu-id="69e09-121">Custom headers are always persisted in an encrypted format on disk.</span></span>
* <span data-ttu-id="69e09-122">È possibile impedire che le intestazioni dei clienti vengano restituite ad altri programmi con il metodo [**IBackgroundCopyJobHttpOptions3:: MakeCustomHeadersWriteOnly**](/windows/win32/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-makecustomheaderswriteonly) .</span><span class="sxs-lookup"><span data-stu-id="69e09-122">You can prevent customer headers from being returned to other programs with the [**IBackgroundCopyJobHttpOptions3::MakeCustomHeadersWriteOnly**](/windows/win32/api/Bits10_3/nf-bits10_3-ibackgroundcopyjobhttpoptions3-makecustomheaderswriteonly) method.</span></span>


## <a name="standard-and-administrator-users"></a><span data-ttu-id="69e09-123">Utenti standard e amministratori</span><span class="sxs-lookup"><span data-stu-id="69e09-123">Standard and Administrator users</span></span>
<span data-ttu-id="69e09-124">Un utente appartenente al gruppo Administrator può eseguire un processo con accesso utente standard o con privilegi di amministratore.</span><span class="sxs-lookup"><span data-stu-id="69e09-124">A user who is in the administrator group can run a process with standard user access or in an elevated state (with administrator privileges).</span></span> <span data-ttu-id="69e09-125">BITS eseguirà il processo in uno dei due Stati, a condizione che l'utente venga registrato nel computer.</span><span class="sxs-lookup"><span data-stu-id="69e09-125">BITS will run the job in either state as long as the user is logged onto the computer.</span></span> <span data-ttu-id="69e09-126">Tuttavia, se l'utente ha creato il processo o ha assunto la proprietà del processo con privilegi elevati, l'utente deve essere nello stato con privilegi elevati per recuperare o modificare il processo. in caso contrario, la chiamata ha esito negativo con accesso negato (0x80070005).</span><span class="sxs-lookup"><span data-stu-id="69e09-126">However, if the user created the job or took ownership of the job in an elevated state, the user must be in the elevated state to retrieve or modify the job (otherwise, the call fails with Access Denied (0x80070005)).</span></span> <span data-ttu-id="69e09-127">Per determinare lo stato con privilegi elevati di un processo, chiamare il metodo [**IBackgroundCopyJob4:: GetOwnerElevationState**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerelevationstate) .</span><span class="sxs-lookup"><span data-stu-id="69e09-127">To determine the elevated state of a job, call the [**IBackgroundCopyJob4::GetOwnerElevationState**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerelevationstate) method.</span></span>

<span data-ttu-id="69e09-128">Un utente standard non può enumerare o modificare i processi di proprietà di altri utenti.</span><span class="sxs-lookup"><span data-stu-id="69e09-128">A standard user cannot enumerate or modify jobs owned by other users.</span></span>

## <a name="integrity-level"></a><span data-ttu-id="69e09-129">Livello di integrità</span><span class="sxs-lookup"><span data-stu-id="69e09-129">Integrity level</span></span>
<span data-ttu-id="69e09-130">Oltre allo stato con privilegi elevati, il livello di integrità del token può determinare se l'utente può modificare un processo.</span><span class="sxs-lookup"><span data-stu-id="69e09-130">In addition to the elevated state, the integrity level of the token can determine if the user can modify a job.</span></span> <span data-ttu-id="69e09-131">Un client non può modificare i processi creati da un token con un livello di integrità superiore.</span><span class="sxs-lookup"><span data-stu-id="69e09-131">A client cannot modify jobs created by a token with a higher integrity level.</span></span> <span data-ttu-id="69e09-132">In particolare, molti token di sistema locale presentano un livello di integrità superiore al livello di integrità di una finestra con privilegi elevati e pertanto non possono essere modificati da un amministratore da una finestra di comando con privilegi elevati.</span><span class="sxs-lookup"><span data-stu-id="69e09-132">In particular, many local-system tokens carry an integrity level higher than the integrity level of an elevated window, and so they cannot be modified by an administrator from an ordinary elevated command window.</span></span> <span data-ttu-id="69e09-133">Ad esempio, i processi Windows Update e SMS vengono eseguiti come LocalSystem con un livello di integrità superiore rispetto a un token con privilegi elevati, in modo che un amministratore non possa modificare o eliminare questi processi.</span><span class="sxs-lookup"><span data-stu-id="69e09-133">For example, Windows Update and SMS jobs run as LocalSystem which has a higher integrity level than an elevated token so an administrator cannot modify or delete these jobs.</span></span> <span data-ttu-id="69e09-134">Per modificare il processo, creare un'attività Utilità di pianificazione eseguita come sistema locale.</span><span class="sxs-lookup"><span data-stu-id="69e09-134">To modify these job, create a Task Scheduler task that runs as local system.</span></span> <span data-ttu-id="69e09-135">L'attività può eseguire un'applicazione console che usa l'API BITS oppure l'attività potrebbe eseguire uno script che chiama BitsAdmin.exe.</span><span class="sxs-lookup"><span data-stu-id="69e09-135">The task can execute a console application that uses the BITS API, or the task could execute a script that calls BitsAdmin.exe.</span></span> <span data-ttu-id="69e09-136">Per determinare il livello di integrità usato, chiamare il metodo [**IBackgroundCopyJob4:: GetOwnerIntegrityLevel**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerintegritylevel) .</span><span class="sxs-lookup"><span data-stu-id="69e09-136">To determine the integrity level used, call the [**IBackgroundCopyJob4::GetOwnerIntegrityLevel**](/windows/desktop/api/Bits3_0/nf-bits3_0-ibackgroundcopyjob4-getownerintegritylevel) method.</span></span>

## <a name="service-identity"></a><span data-ttu-id="69e09-137">Identità del servizio</span><span class="sxs-lookup"><span data-stu-id="69e09-137">Service identity</span></span>
<span data-ttu-id="69e09-138">A partire da Windows 10 può 2019 aggiornamento (10,0; Compilazione 18362), i processi BITS avviati da un servizio manterranno l'identità del servizio.</span><span class="sxs-lookup"><span data-stu-id="69e09-138">Starting in the Windows 10 May 2019 Update (10.0; Build 18362), BITS jobs started from a service will maintain the service identity.</span></span> <span data-ttu-id="69e09-139">Questo consente ai servizi che vogliono usare BITS di scaricare file o caricare file da una directory le cui autorizzazioni sono associate al SID del servizio.</span><span class="sxs-lookup"><span data-stu-id="69e09-139">This allows for services that wish to use BITS to download files to or upload files from a directory whose permissions are tied to the service SID.</span></span> <span data-ttu-id="69e09-140">Inoltre, il traffico di rete verrà attribuito correttamente al servizio che ha richiesto il processo BITS anziché essere attribuito a BITS.</span><span class="sxs-lookup"><span data-stu-id="69e09-140">Additionally, network traffic will be correctly attributed to the service that requested the BITS job instead of being attributed to BITS.</span></span>

 




