---
title: Token helper per i processi di trasferimento BITS
description: Token helper per i processi di trasferimento BITS
ms.assetid: f29f9870-e406-472b-9342-203def7453ae
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 52925a6e0d5a9601e21848d514214bfb843f6246
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "104474195"
---
# <a name="helper-tokens-for-bits-transfer-jobs"></a><span data-ttu-id="ba623-103">Token helper per i processi di trasferimento BITS</span><span class="sxs-lookup"><span data-stu-id="ba623-103">Helper Tokens for BITS Transfer Jobs</span></span>

<span data-ttu-id="ba623-104">In Windows Vista, il servizio Servizio trasferimento intelligente in background (BITS) consente a un'applicazione di associare un singolo token di sicurezza a un processo di trasferimento BITS.</span><span class="sxs-lookup"><span data-stu-id="ba623-104">In Windows Vista, the Background Intelligent Transfer Service (BITS) service allows an application to associate a single security token to a BITS transfer job.</span></span> <span data-ttu-id="ba623-105">Il processo di trasferimento BITS usa quindi questo token per l'autenticazione e per l'accesso alle risorse locali e remote.</span><span class="sxs-lookup"><span data-stu-id="ba623-105">The BITS transfer job then uses this token for authentication and for access to local and remote resources.</span></span>

<span data-ttu-id="ba623-106">In Windows 7, il servizio BITS associa un token aggiuntivo a un processo di trasferimento BITS.</span><span class="sxs-lookup"><span data-stu-id="ba623-106">In Windows 7, the BITS service associates an additional token to a BITS transfer job.</span></span> <span data-ttu-id="ba623-107">Il processo di trasferimento BITS può essere configurato con un token di sicurezza aggiuntivo, ovvero un token di rappresentazione creato da un'applicazione che chiama l'API COM BITS.</span><span class="sxs-lookup"><span data-stu-id="ba623-107">The BITS transfer job can be configured with an additional security token, which is an impersonation token created by an application calling the BITS COM API.</span></span> <span data-ttu-id="ba623-108">Questo modello di token Helper consente alle applicazioni di usare contemporaneamente due token di sicurezza diversi per accedere ai file locali, ai certificati sul lato client, ai file remoti e ai proxy.</span><span class="sxs-lookup"><span data-stu-id="ba623-108">This helper token model allows applications to simultaneously use two different security tokens to access local files, client-side certificates, remote files, and proxies.</span></span> <span data-ttu-id="ba623-109">Viene ad esempio creato un processo di trasferimento BITS che scrive i dati scaricati in una directory locale con privilegi, quindi presenta un'identità di dominio con diritti limitati al server HTTP e al server proxy.</span><span class="sxs-lookup"><span data-stu-id="ba623-109">For example, a BITS transfer job is created that writes the downloaded data to a privileged local directory, and then it presents a low-rights domain identity to the HTTP server and proxy server.</span></span>

<span data-ttu-id="ba623-110">Un'applicazione, in genere un servizio di Windows, specifica un token Helper usando la nuova interfaccia [**IBitsTokenOptions**](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions).</span><span class="sxs-lookup"><span data-stu-id="ba623-110">An application, typically a Windows service, specifies a helper token by using the new interface [**IBitsTokenOptions**](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions).</span></span> <span data-ttu-id="ba623-111">Questa interfaccia viene implementata dall'oggetto processo BITS.</span><span class="sxs-lookup"><span data-stu-id="ba623-111">This interface is implemented by the BITS job object.</span></span> <span data-ttu-id="ba623-112">L'applicazione chiama [**Metodo ibackgroundcopyjob:: QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) per ottenere il puntatore di interfaccia.</span><span class="sxs-lookup"><span data-stu-id="ba623-112">The application calls [**IBackgroundCopyJob::QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) to get the interface pointer.</span></span> <span data-ttu-id="ba623-113">L'applicazione rappresenta l'identità helper e chiama [**IBitsTokenOptions:: SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) per passare il token al servizio BITS.</span><span class="sxs-lookup"><span data-stu-id="ba623-113">The application impersonates the helper identity and calls [**IBitsTokenOptions::SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) to pass the token to the BITS service.</span></span> <span data-ttu-id="ba623-114">Quindi, l'applicazione specifica le risorse a cui si applica il token passando un set di flag di bit usando [**IBitsTokenOptions:: SetHelperTokenFlags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags).</span><span class="sxs-lookup"><span data-stu-id="ba623-114">Then the application specifies the resources to which the token applies by passing a set of bit flags using [**IBitsTokenOptions::SetHelperTokenFlags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags).</span></span> <span data-ttu-id="ba623-115">L'applicazione cancella tutti i flag (usando nuovamente **SetHelperTokenFlags** ) per ripristinare il comportamento.</span><span class="sxs-lookup"><span data-stu-id="ba623-115">The application clears all the flags (using **SetHelperTokenFlags** again) to revert the behavior.</span></span> <span data-ttu-id="ba623-116">Il servizio BITS archivia i flag di bit e il token nel processo di trasferimento BITS.</span><span class="sxs-lookup"><span data-stu-id="ba623-116">The BITS service stores the bit flags and the token in the BITS transfer job.</span></span>

<span data-ttu-id="ba623-117">Quando il proprietario dei processi di trasferimento BITS si disconnette, il servizio BITS Elimina tutti i token Helper associati al processo di trasferimento.</span><span class="sxs-lookup"><span data-stu-id="ba623-117">When the owner of the BITS transfer jobs logs off, the BITS service discards any helper tokens that are associated with the transfer job.</span></span> <span data-ttu-id="ba623-118">Se il trasferimento non è completo, il servizio BITS inserisce il processo in uno stato di errore con il token BG e il codice di errore **\_ \_ \_ richiesto** ed Elimina il token helper.</span><span class="sxs-lookup"><span data-stu-id="ba623-118">If the transfer is not complete, the BITS service places the job in an error state with the **BG\_E\_TOKEN\_REQUIRED** error code and discards the helper token.</span></span> <span data-ttu-id="ba623-119">L'applicazione client può aggiornare il token chiamando [**IBitsTokenOptions:: SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) e può riprendere il processo di trasferimento BITS.</span><span class="sxs-lookup"><span data-stu-id="ba623-119">The client application can refresh the token by calling [**IBitsTokenOptions::SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) and can then resume the BITS transfer job.</span></span> <span data-ttu-id="ba623-120">In alternativa, l'applicazione client può cancellare i flag del token helper utilizzando [**IBitsTokenOptions:: SetHelperTokenFlags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags) e quindi riprendere il processo di trasferimento senza un token helper.</span><span class="sxs-lookup"><span data-stu-id="ba623-120">Alternatively, the client application can clear the helper token flags using [**IBitsTokenOptions::SetHelperTokenFlags**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertokenflags) and then resume the transfer job without a helper token.</span></span>

<span data-ttu-id="ba623-121">Analogamente, quando il proprietario di una sessione di servizi Terminal si disconnette, il servizio BITS deve rimuovere tutti i token Helper da tale sessione e collocare i processi di trasferimento interessati in uno stato di errore con il codice di errore del **\_ \_ token \_ BG e** .</span><span class="sxs-lookup"><span data-stu-id="ba623-121">Similarly, when the owner of a terminal services session logs off, the BITS service must discard any helper tokens from that session and place the affected transfer jobs in an error state with the **BG\_E\_TOKEN\_REQUIRED** error code.</span></span>

<span data-ttu-id="ba623-122">Il modello di token Helper richiede una modifica ai criteri di controllo di accesso BITS.</span><span class="sxs-lookup"><span data-stu-id="ba623-122">The helper token model requires a change to BITS access control policy.</span></span> <span data-ttu-id="ba623-123">Le versioni precedenti di BITS implementavano i controlli di accesso in ogni chiamata al metodo.</span><span class="sxs-lookup"><span data-stu-id="ba623-123">Previous versions of BITS implemented access checks on every method call.</span></span> <span data-ttu-id="ba623-124">A partire da Windows 7, il controllo dell'accesso deve essere eseguito all'interno della chiamata [**Metodo ibackgroundcopyjob:: QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) ; in caso contrario, il token Helper potrebbe non avere accesso al processo di trasferimento.</span><span class="sxs-lookup"><span data-stu-id="ba623-124">Starting with Windows 7, the access check must be performed inside the [**IBackgroundCopyJob::QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) call; otherwise, the helper token might not have access to the transfer job.</span></span>

> [!Note]  
> <span data-ttu-id="ba623-125">Nelle implementazioni precedenti è necessario che gli utenti BITS dispongano dei privilegi di amministratore per impostare i token helper.</span><span class="sxs-lookup"><span data-stu-id="ba623-125">Older implementations effectively required that BITS users have administrator privileges in order to set helper tokens.</span></span> <span data-ttu-id="ba623-126">A partire da Windows 10, versione 1607, gli utenti BITS non amministratori possono usare [**IBitsTokenOptions:: SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) per impostare i token Helper non amministratori nei processi BITS di cui sono proprietari.</span><span class="sxs-lookup"><span data-stu-id="ba623-126">Starting with Windows 10, version 1607, non-administrator BITS users can use [**IBitsTokenOptions::SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) to set non-administrator helper tokens on BITS jobs they own.</span></span> <span data-ttu-id="ba623-127">Questa modifica consente agli utenti BITS non amministratori, ad esempio i servizi Downloader in background in esecuzione con l' [account NetworkService](/windows/desktop/Services/networkservice-account), di impostare i token helper.</span><span class="sxs-lookup"><span data-stu-id="ba623-127">This change enables non-administrator BITS users (such as background downloader services running under the [NetworkService account](/windows/desktop/Services/networkservice-account)) to set helper tokens.</span></span>
>
> <span data-ttu-id="ba623-128">In particolare, l'implementazione è stata modificata per consentire agli utenti senza privilegi di amministratore di impostare i token helper, purché vengano soddisfatte le condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="ba623-128">Specifically, the implementation has been changed to allow users without administrator privileges to set helper tokens, as long as the following conditions are met:</span></span>
>
> -   <span data-ttu-id="ba623-129">durante la chiamata a [**Metodo ibackgroundcopyjob:: QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) , il SID del token thread's del chiamante corrisponde al SID dell'account utente del proprietario del processo e</span><span class="sxs-lookup"><span data-stu-id="ba623-129">during the [**IBackgroundCopyJob::QueryInterface**](/windows/desktop/api/Bits/nn-bits-ibackgroundcopyjob) call, the SID of the caller's thread's token is the same as the SID of the job owner's user account, and</span></span>
> -   <span data-ttu-id="ba623-130">Quando viene chiamato [**IBitsTokenOptions:: SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) , il token Helper non dispone del SID amministratore (**Domain \_ alias \_ RID \_ Admins**) abilitato.</span><span class="sxs-lookup"><span data-stu-id="ba623-130">when [**IBitsTokenOptions::SetHelperToken**](/windows/desktop/api/Bits4_0/nf-bits4_0-ibitstokenoptions-sethelpertoken) is called, the helper token does not have the administrator SID (**DOMAIN\_ALIAS\_RID\_ADMINS**) enabled.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="ba623-131">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="ba623-131">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ba623-132">**IBitsTokenOptions**</span><span class="sxs-lookup"><span data-stu-id="ba623-132">**IBitsTokenOptions**</span></span>](/windows/desktop/api/Bits4_0/nn-bits4_0-ibitstokenoptions)
</dt> </dl>

 

 