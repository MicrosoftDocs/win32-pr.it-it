---
description: Poiché lo script di installazione può essere eseguito all'esterno della sessione di installazione in cui è stato scritto, la sessione potrebbe non esistere più durante l'esecuzione dello script di installazione.
ms.assetid: 13174c5d-c810-4b5d-9d1e-60ed30b8c44d
title: Recupero delle informazioni di contesto per le azioni personalizzate di esecuzione posticipata
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a13cd956509a5b8a4c92e0a53bfa455154a59bcc
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103753514"
---
# <a name="obtaining-context-information-for-deferred-execution-custom-actions"></a><span data-ttu-id="0bf57-103">Recupero delle informazioni di contesto per le azioni personalizzate di esecuzione posticipata</span><span class="sxs-lookup"><span data-stu-id="0bf57-103">Obtaining Context Information for Deferred Execution Custom Actions</span></span>

<span data-ttu-id="0bf57-104">Poiché lo script di installazione può essere eseguito all'esterno della sessione di installazione in cui è stato scritto, la sessione potrebbe non esistere più durante l'esecuzione dello script di installazione.</span><span class="sxs-lookup"><span data-stu-id="0bf57-104">Because installation script can be executed outside of the installation session in which it was written, the session may no longer exist during execution of the installation script.</span></span> <span data-ttu-id="0bf57-105">In questo caso, le proprietà e l'handle di sessione originali impostati durante la sequenza di installazione non sono disponibili per un'azione personalizzata di esecuzione posticipata.</span><span class="sxs-lookup"><span data-stu-id="0bf57-105">In this case, the original session handle and properties set during the installation sequence are not available to a deferred execution custom action.</span></span> <span data-ttu-id="0bf57-106">Tutte le funzioni che richiedono un handle di sessione sono limitate ad alcuni metodi che possono recuperare informazioni sul contesto oppure le proprietà necessarie durante l'esecuzione dello script devono essere scritte nello script di installazione.</span><span class="sxs-lookup"><span data-stu-id="0bf57-106">Any functions that require a session handle are restricted to a few methods that can retrieve context information, or else properties that are needed during script execution must be written into the installation script.</span></span> <span data-ttu-id="0bf57-107">Ad esempio, le azioni personalizzate posticipate che chiamano librerie a collegamento dinamico (dll) passano un handle che può essere utilizzato solo per ottenere una quantità molto limitata di informazioni.</span><span class="sxs-lookup"><span data-stu-id="0bf57-107">For example, deferred custom actions that call dynamic-link libraries (DLLs) pass a handle which can only be used to obtain a very limited amount of information.</span></span> <span data-ttu-id="0bf57-108">È possibile accedere alle funzioni che non richiedono un handle di sessione da un'azione personalizzata posticipata.</span><span class="sxs-lookup"><span data-stu-id="0bf57-108">Functions that do not require a session handle can be accessed from a deferred custom action.</span></span>

<span data-ttu-id="0bf57-109">Le azioni personalizzate di esecuzione posticipata sono limitate alla chiamata solo delle funzioni seguenti che richiedono un handle.</span><span class="sxs-lookup"><span data-stu-id="0bf57-109">Deferred execution custom actions are restricted to calling only the following functions requiring a handle.</span></span>



| <span data-ttu-id="0bf57-110">Funzione</span><span class="sxs-lookup"><span data-stu-id="0bf57-110">Function</span></span>                                       | <span data-ttu-id="0bf57-111">Descrizione</span><span class="sxs-lookup"><span data-stu-id="0bf57-111">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="0bf57-112">**MsiGetProperty**</span><span class="sxs-lookup"><span data-stu-id="0bf57-112">**MsiGetProperty**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya)       | <span data-ttu-id="0bf57-113">Supporta un set limitato di proprietà se utilizzato con [azioni personalizzate di esecuzione posticipata](deferred-execution-custom-actions.md): la proprietà CustomActionData, la proprietà [**ProductCode**](productcode.md) e la proprietà [**UserSID**](usersid.md) . Le [azioni personalizzate di commit](commit-custom-actions.md) non possono usare la funzione [**MsiGetProperty**](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya) per ottenere la proprietà [**ProductCode**](productcode.md) .</span><span class="sxs-lookup"><span data-stu-id="0bf57-113">Supports a limited set of properties when used with [deferred execution custom actions](deferred-execution-custom-actions.md): the CustomActionData property, [**ProductCode**](productcode.md) property, and [**UserSID**](usersid.md) property.[Commit custom actions](commit-custom-actions.md) cannot use the [**MsiGetProperty**](/windows/desktop/api/Msiquery/nf-msiquery-msigetpropertya) function to obtain the [**ProductCode**](productcode.md) property.</span></span> <span data-ttu-id="0bf57-114">Le azioni personalizzate di commit possono utilizzare la proprietà CustomActionData per ottenere il codice del prodotto.</span><span class="sxs-lookup"><span data-stu-id="0bf57-114">Commit custom actions can use the CustomActionData property to obtain the product code.</span></span><br/> |
| [<span data-ttu-id="0bf57-115">**MsiFormatRecord**</span><span class="sxs-lookup"><span data-stu-id="0bf57-115">**MsiFormatRecord**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msiformatrecorda)     | <span data-ttu-id="0bf57-116">Supporta un set limitato di proprietà quando viene usato con [azioni personalizzate di esecuzione posticipata](deferred-execution-custom-actions.md): le proprietà CustomActionData e ProductCode.</span><span class="sxs-lookup"><span data-stu-id="0bf57-116">Supports a limited set of properties when used with [deferred execution custom actions](deferred-execution-custom-actions.md): the CustomActionData and ProductCode properties.</span></span>                                                                                                                                                                                                                                                                                                                                                      |
| [<span data-ttu-id="0bf57-117">**MsiGetMode**</span><span class="sxs-lookup"><span data-stu-id="0bf57-117">**MsiGetMode**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode)               | <span data-ttu-id="0bf57-118">Quando viene chiamato da [azioni personalizzate di esecuzione posticipata](deferred-execution-custom-actions.md), [commit di azioni personalizzate](commit-custom-actions.md)o azioni personalizzate di [rollback](rollback-custom-actions.md), [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) restituisce true o false quando viene richiesto di controllare i parametri della modalità MSIRUNMODE \_ pianificato, MSIRUNMODE \_ commit o MSIRUNMODE \_ rollback.</span><span class="sxs-lookup"><span data-stu-id="0bf57-118">When called from [deferred execution custom actions](deferred-execution-custom-actions.md), [commit custom actions](commit-custom-actions.md), or [rollback custom actions](rollback-custom-actions.md), [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) returns True or False when requested to check the mode parameters MSIRUNMODE\_SCHEDULED, MSIRUNMODE\_COMMIT, or MSIRUNMODE\_ROLLBACK.</span></span> <span data-ttu-id="0bf57-119">Le richieste di controllo di qualsiasi altro parametro della modalità di esecuzione da un'azione personalizzata posticipata, di commit o di rollback restituiscono false.</span><span class="sxs-lookup"><span data-stu-id="0bf57-119">Requests to check any other run mode parameters from a deferred, commit, or rollback custom action returns False.</span></span><br/>                       |
| [<span data-ttu-id="0bf57-120">**MsiGetLanguage**</span><span class="sxs-lookup"><span data-stu-id="0bf57-120">**MsiGetLanguage**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage)       | <span data-ttu-id="0bf57-121">ID della lingua numerica per il prodotto corrente. Le [azioni personalizzate di commit](commit-custom-actions.md) non possono usare la funzione [**MsiGetLanguage**](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage) .</span><span class="sxs-lookup"><span data-stu-id="0bf57-121">The numeric language ID for the current product.[Commit custom actions](commit-custom-actions.md) cannot use the [**MsiGetLanguage**](/windows/desktop/api/Msiquery/nf-msiquery-msigetlanguage) function.</span></span> <span data-ttu-id="0bf57-122">Le azioni personalizzate di commit possono utilizzare la proprietà CustomActionData per ottenere l'ID della lingua numerica.</span><span class="sxs-lookup"><span data-stu-id="0bf57-122">Commit custom actions can use the CustomActionData property to get the numeric language ID.</span></span><br/>                                                                                                                                                                                                                                                           |
| [<span data-ttu-id="0bf57-123">**MsiProcessMessage**</span><span class="sxs-lookup"><span data-stu-id="0bf57-123">**MsiProcessMessage**</span></span>](/windows/desktop/api/Msiquery/nf-msiquery-msiprocessmessage) | <span data-ttu-id="0bf57-124">Elabora i messaggi di errore o di stato dall'azione personalizzata.</span><span class="sxs-lookup"><span data-stu-id="0bf57-124">Processes error or progress messages from the custom action.</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |



 

<span data-ttu-id="0bf57-125">Un'azione personalizzata scritta in JScript o VBScript richiede l'oggetto [**sessione**](session-object.md) di installazione.</span><span class="sxs-lookup"><span data-stu-id="0bf57-125">A custom action that is written in JScript or VBScript requires the install [**Session**](session-object.md) object.</span></span> <span data-ttu-id="0bf57-126">Si tratta dell' **oggetto Session** del tipo e il programma di installazione lo connette allo script con il nome "Session".</span><span class="sxs-lookup"><span data-stu-id="0bf57-126">This is of the type **Session Object** and the installer attaches it to the script with the name "Session".</span></span> <span data-ttu-id="0bf57-127">Poiché l'oggetto **Session** potrebbe non esistere durante il rollback dell'installazione, un'azione personalizzata posticipata scritta nello script deve usare uno dei metodi o delle proprietà seguenti dell'oggetto **Session** per recuperare il contesto.</span><span class="sxs-lookup"><span data-stu-id="0bf57-127">Because the **Session** object may not exist during an installation rollback, a deferred custom action written in script must use one of the following methods or properties of the **Session** object to retrieve its context.</span></span>



| <span data-ttu-id="0bf57-128">Nome</span><span class="sxs-lookup"><span data-stu-id="0bf57-128">Name</span></span>                                                           | <span data-ttu-id="0bf57-129">Descrizione</span><span class="sxs-lookup"><span data-stu-id="0bf57-129">Description</span></span>                                                                                                                        |
|----------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="0bf57-130">**Mode (proprietà)**</span><span class="sxs-lookup"><span data-stu-id="0bf57-130">**Mode Property**</span></span>](session-mode.md)                          | <span data-ttu-id="0bf57-131">Restituisce true per MSIRUNMODE \_ solo pianificato.</span><span class="sxs-lookup"><span data-stu-id="0bf57-131">Returns True for MSIRUNMODE\_SCHEDULED only.</span></span>                                                                                       |
| [<span data-ttu-id="0bf57-132">**Proprietà Property (oggetto Session)**</span><span class="sxs-lookup"><span data-stu-id="0bf57-132">**Property Property (Session Object)**</span></span>](session-session.md)  | <span data-ttu-id="0bf57-133">Restituisce la proprietà CustomActionData, la proprietà [**ProductCode**](productcode.md) o la proprietà [**UserSID**](usersid.md) .</span><span class="sxs-lookup"><span data-stu-id="0bf57-133">Returns the CustomActionData property, [**ProductCode**](productcode.md) property, or [**UserSID**](usersid.md) property.</span></span>        |
| [<span data-ttu-id="0bf57-134">**Proprietà Language (oggetto Session)**</span><span class="sxs-lookup"><span data-stu-id="0bf57-134">**Language Property (Session Object)**</span></span>](session-language.md) | <span data-ttu-id="0bf57-135">Restituisce l'ID della lingua numerica della sessione di installazione.</span><span class="sxs-lookup"><span data-stu-id="0bf57-135">Returns numeric language ID of the installation session.</span></span>                                                                           |
| [<span data-ttu-id="0bf57-136">**Message (metodo)**</span><span class="sxs-lookup"><span data-stu-id="0bf57-136">**Message Method**</span></span>](session-message.md)                      | <span data-ttu-id="0bf57-137">Chiamato per gestire gli errori e lo stato di avanzamento.</span><span class="sxs-lookup"><span data-stu-id="0bf57-137">Called to handle errors and progress.</span></span>                                                                                              |
| [<span data-ttu-id="0bf57-138">**Proprietà Installer**</span><span class="sxs-lookup"><span data-stu-id="0bf57-138">**Installer Property**</span></span>](session-installer.md)                | <span data-ttu-id="0bf57-139">Restituisce l'oggetto padre, utilizzato per le funzioni non di sessione, ad esempio l'accesso al registro di sistema e la gestione della configurazione del programma di installazione.</span><span class="sxs-lookup"><span data-stu-id="0bf57-139">Returns the parent object, which is used for non-session functions such as registry access and installer configuration management.</span></span> |



 

<span data-ttu-id="0bf57-140">I valori delle proprietà impostati al momento dell'elaborazione della sequenza di installazione nello script potrebbero non essere disponibili al momento dell'esecuzione dello script.</span><span class="sxs-lookup"><span data-stu-id="0bf57-140">Property values that are set at the time the installation sequence is processed into script may be unavailable at the time of script execution.</span></span> <span data-ttu-id="0bf57-141">Solo il set limitato di proprietà seguente è sempre accessibile per le azioni personalizzate durante l'esecuzione dello script.</span><span class="sxs-lookup"><span data-stu-id="0bf57-141">Only the following limited set of properties is always accessible to custom actions during script execution.</span></span>



| <span data-ttu-id="0bf57-142">Nome proprietà</span><span class="sxs-lookup"><span data-stu-id="0bf57-142">Property name</span></span>                      | <span data-ttu-id="0bf57-143">Descrizione</span><span class="sxs-lookup"><span data-stu-id="0bf57-143">Description</span></span>                                                                                                                                                                                                     |
|------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="0bf57-144">CustomActionData</span><span class="sxs-lookup"><span data-stu-id="0bf57-144">CustomActionData</span></span>                   | <span data-ttu-id="0bf57-145">Il valore in fase di azione personalizzata viene elaborato nella tabella di sequenza.</span><span class="sxs-lookup"><span data-stu-id="0bf57-145">Value at time custom action is processed in sequence table.</span></span> <span data-ttu-id="0bf57-146">La proprietà CustomActionData è disponibile solo per le azioni personalizzate di esecuzione posticipata.</span><span class="sxs-lookup"><span data-stu-id="0bf57-146">The CustomActionData property is only available to deferred execution custom actions.</span></span> <span data-ttu-id="0bf57-147">Le azioni personalizzate immediate non hanno accesso a questa proprietà.</span><span class="sxs-lookup"><span data-stu-id="0bf57-147">Immediate custom actions do not have access to this property.</span></span> |
| [<span data-ttu-id="0bf57-148">**ProductCode**</span><span class="sxs-lookup"><span data-stu-id="0bf57-148">**ProductCode**</span></span>](productcode.md) | <span data-ttu-id="0bf57-149">Codice univoco per il prodotto, una stringa [GUID](guid.md) .</span><span class="sxs-lookup"><span data-stu-id="0bf57-149">Unique code for the product, a [GUID](guid.md) string.</span></span>                                                                                                                                                         |
| [<span data-ttu-id="0bf57-150">**UserSID**</span><span class="sxs-lookup"><span data-stu-id="0bf57-150">**UserSID**</span></span>](usersid.md)         | <span data-ttu-id="0bf57-151">Impostato dal programma di installazione sull'ID di sicurezza (SID) dell'utente.</span><span class="sxs-lookup"><span data-stu-id="0bf57-151">Set by the installer to the user's security identifier (SID).</span></span>                                                                                                                                                   |



 

<span data-ttu-id="0bf57-152">Se gli altri dati della proprietà sono necessari per l'azione personalizzata esecuzione posticipata, i relativi valori devono essere archiviati nello script di installazione.</span><span class="sxs-lookup"><span data-stu-id="0bf57-152">If other property data is required by the deferred execution custom action, then their values must be stored in the installation script.</span></span> <span data-ttu-id="0bf57-153">Questa operazione può essere eseguita usando una seconda azione personalizzata.</span><span class="sxs-lookup"><span data-stu-id="0bf57-153">This can be done by using a second custom action.</span></span>

<span data-ttu-id="0bf57-154">**Per scrivere il valore di una proprietà nello script di installazione per l'utilizzo durante un'azione personalizzata di esecuzione posticipata**</span><span class="sxs-lookup"><span data-stu-id="0bf57-154">**To write the value of a property into the installation script for use during a deferred execution custom action**</span></span>

1.  <span data-ttu-id="0bf57-155">Inserire una piccola azione personalizzata nella sequenza di installazione che imposta la proprietà di interesse su una proprietà con lo stesso nome dell'azione personalizzata esecuzione posticipata.</span><span class="sxs-lookup"><span data-stu-id="0bf57-155">Insert a small custom action into the installation sequence that sets the property of interest to a property having the same name as the deferred execution custom action.</span></span> <span data-ttu-id="0bf57-156">Se, ad esempio, la chiave primaria per l'azione personalizzata esecuzione posticipata è "azione", impostare una proprietà denominata "azione" sulla proprietà X che è necessario recuperare.</span><span class="sxs-lookup"><span data-stu-id="0bf57-156">For example, if the primary key for the deferred execution custom action is "MyAction" set a property named "MyAction" to the property X which you need to retrieve.</span></span> <span data-ttu-id="0bf57-157">È necessario impostare la proprietà "azione" nella sequenza di installazione prima dell'azione personalizzata "azione".</span><span class="sxs-lookup"><span data-stu-id="0bf57-157">You must set the "MyAction" property in the installation sequence before the "MyAction" custom action.</span></span> <span data-ttu-id="0bf57-158">Sebbene qualsiasi tipo di azione personalizzata possa impostare i dati di contesto, il metodo più semplice consiste nell'usare un'azione personalizzata assegnazione proprietà (ad esempio, [tipo di azione personalizzata 51](custom-action-type-51.md)).</span><span class="sxs-lookup"><span data-stu-id="0bf57-158">Although any type of custom action can set the context data, the simplest method is to use a property assignment custom action (for example [Custom Action Type 51](custom-action-type-51.md)).</span></span>
2.  <span data-ttu-id="0bf57-159">Nel momento in cui viene elaborata la sequenza di installazione, il programma di installazione scriverà il valore della proprietà X nello script di esecuzione come valore della proprietà CustomActionData.</span><span class="sxs-lookup"><span data-stu-id="0bf57-159">At the time when the installation sequence is processed, the installer will write the value of property X into the execution script as the value of the property CustomActionData.</span></span>

## <a name="related-topics"></a><span data-ttu-id="0bf57-160">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="0bf57-160">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="0bf57-161">Informazioni sulle proprietà</span><span class="sxs-lookup"><span data-stu-id="0bf57-161">About Properties</span></span>](about-properties.md)
</dt> <dt>

[<span data-ttu-id="0bf57-162">Utilizzo delle proprietà</span><span class="sxs-lookup"><span data-stu-id="0bf57-162">Using Properties</span></span>](using-properties.md)
</dt> <dt>

[<span data-ttu-id="0bf57-163">Riferimento alla proprietà</span><span class="sxs-lookup"><span data-stu-id="0bf57-163">Property Reference</span></span>](property-reference.md)
</dt> </dl>

 

 




