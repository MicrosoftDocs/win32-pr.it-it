---
description: Quando il programma di installazione elabora lo script di installazione, genera contemporaneamente uno script di rollback.
ms.assetid: 5b9bfc5a-6a78-4b0e-aed8-f25aba089af1
title: Rollback delle azioni personalizzate
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1c4ad91f8f94145399d51ed2ef53999ab0a91d65
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103880185"
---
# <a name="rollback-custom-actions"></a><span data-ttu-id="7c773-103">Rollback delle azioni personalizzate</span><span class="sxs-lookup"><span data-stu-id="7c773-103">Rollback Custom Actions</span></span>

<span data-ttu-id="7c773-104">Quando il programma di installazione elabora lo script di installazione, genera contemporaneamente uno script di rollback.</span><span class="sxs-lookup"><span data-stu-id="7c773-104">When the installer processes the installation script, it simultaneously generates a rollback script.</span></span> <span data-ttu-id="7c773-105">Oltre allo script di rollback, il programma di installazione salva una copia di tutti i file eliminati durante l'installazione.</span><span class="sxs-lookup"><span data-stu-id="7c773-105">In addition to the rollback script, the installer saves a copy of every file it deletes during the installation.</span></span> <span data-ttu-id="7c773-106">Questi file vengono conservati in una directory di sistema nascosta.</span><span class="sxs-lookup"><span data-stu-id="7c773-106">These files are kept in a hidden system directory.</span></span> <span data-ttu-id="7c773-107">Al termine dell'installazione, vengono eliminati lo script di rollback e i file salvati.</span><span class="sxs-lookup"><span data-stu-id="7c773-107">Once the installation is complete, the rollback script and the saved files are deleted.</span></span> <span data-ttu-id="7c773-108">Se un'installazione ha esito negativo, il programma di installazione tenterà di eseguire il rollback delle modifiche apportate durante l'installazione e di ripristinare lo stato originale del computer.</span><span class="sxs-lookup"><span data-stu-id="7c773-108">If an installation is unsuccessful, the installer attempts to rollback the changes made during the installation and restore the original state of the computer.</span></span>

<span data-ttu-id="7c773-109">Sebbene le azioni personalizzate che pianificano le operazioni di sistema inserendo righe nella tabella di database siano invertite da un rollback dell'installazione, le azioni personalizzate che modificano direttamente il sistema o che inviano comandi ad altri servizi di sistema non possono essere sempre invertite da un rollback.</span><span class="sxs-lookup"><span data-stu-id="7c773-109">Although custom actions that schedule system operations by inserting rows into database table are reversed by a rollback of the installation, custom actions that change the system directly, or that issue commands to other system services, cannot always be reversed by a rollback.</span></span> <span data-ttu-id="7c773-110">Un'azione di rollback personalizzata è un'azione eseguita dal programma di installazione solo durante il rollback dell'installazione e il suo scopo è invertire un'azione personalizzata che ha apportato modifiche al sistema.</span><span class="sxs-lookup"><span data-stu-id="7c773-110">A rollback custom action is an action that the installer executes only during an installation rollback, and its purpose is to reverse a custom action that has made changes to the system.</span></span>

<span data-ttu-id="7c773-111">Un'azione di rollback personalizzata è un tipo di [azione personalizzata di esecuzione posticipata](deferred-execution-custom-actions.md), perché la sua esecuzione viene posticipata quando viene richiamata durante la sequenza di installazione.</span><span class="sxs-lookup"><span data-stu-id="7c773-111">A rollback custom action is a type of [deferred execution custom action](deferred-execution-custom-actions.md), because its execution is deferred when it is invoked during the installation sequence.</span></span> <span data-ttu-id="7c773-112">Si differenzia da una normale azione personalizzata posticipata in quanto viene eseguita solo durante un rollback.</span><span class="sxs-lookup"><span data-stu-id="7c773-112">It differs from a regular deferred custom action in that it is only executed during a rollback.</span></span> <span data-ttu-id="7c773-113">Un'azione di rollback personalizzata deve sempre precedere l'azione personalizzata rinviata che esegue il rollback nella sequenza di azione.</span><span class="sxs-lookup"><span data-stu-id="7c773-113">A rollback custom action must always precede the deferred custom action it rolls back in the action sequence.</span></span> <span data-ttu-id="7c773-114">Un'azione di rollback personalizzata deve anche gestire il caso in cui l'azione personalizzata rinviata viene interrotta durante l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="7c773-114">A rollback custom action should also handle the case where the deferred custom action is interrupted in the middle of execution.</span></span> <span data-ttu-id="7c773-115">Ad esempio, se l'utente preme il pulsante Annulla durante l'esecuzione dell'azione personalizzata.</span><span class="sxs-lookup"><span data-stu-id="7c773-115">For example, if the user were to press the Cancel button while the custom action was executing.</span></span>

<span data-ttu-id="7c773-116">Si noti che le azioni di rollback personalizzate non possono essere eseguite in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="7c773-116">Note that Rollback Custom Actions cannot run asynchronously.</span></span> <span data-ttu-id="7c773-117">Vedere [azioni personalizzate sincrone e asincrone](synchronous-and-asynchronous-custom-actions.md).</span><span class="sxs-lookup"><span data-stu-id="7c773-117">See [Synchronous and Asynchronous Custom Actions](synchronous-and-asynchronous-custom-actions.md).</span></span>

<span data-ttu-id="7c773-118">Il complemento a un'azione di rollback personalizzata è un' [azione personalizzata di commit](commit-custom-actions.md).</span><span class="sxs-lookup"><span data-stu-id="7c773-118">The complement to a rollback custom action is a [commit custom action](commit-custom-actions.md).</span></span> <span data-ttu-id="7c773-119">Il programma di installazione esegue un'azione personalizzata di commit durante la sequenza di installazione, copia l'azione personalizzata nello script di rollback, ma non esegue l'azione durante il rollback.</span><span class="sxs-lookup"><span data-stu-id="7c773-119">The installer executes a commit custom action during the installation sequence, copies the custom action into the rollback script, but does not execute the action during rollback.</span></span>

<span data-ttu-id="7c773-120">Si noti che un'azione di rollback personalizzata potrebbe non essere in grado di rimuovere tutte le modifiche apportate dalle azioni personalizzate di commit.</span><span class="sxs-lookup"><span data-stu-id="7c773-120">Note that a rollback custom action may not be able to remove all of the changes made by commit custom actions.</span></span> <span data-ttu-id="7c773-121">Sebbene il programma di installazione scriva le azioni personalizzate rollback e commit nello script rollback, le azioni personalizzate di commit vengono eseguite solo dopo che il programma di installazione ha elaborato correttamente lo script di installazione.</span><span class="sxs-lookup"><span data-stu-id="7c773-121">Although the installer writes both rollback and commit custom actions into the rollback script, commit custom actions only run after the installer has successfully processed the installation script.</span></span> <span data-ttu-id="7c773-122">Le azioni personalizzate di commit sono le prime azioni da eseguire nello script di rollback.</span><span class="sxs-lookup"><span data-stu-id="7c773-122">Commit custom actions are the first actions to run in the rollback script.</span></span> <span data-ttu-id="7c773-123">Se un'azione personalizzata di commit ha esito negativo, il programma di installazione avvia il rollback ma può solo eseguire il rollback delle operazioni già scritte nello script di rollback.</span><span class="sxs-lookup"><span data-stu-id="7c773-123">If a commit custom action fails, the installer initiates rollback but can only rollback those operations already written to the rollback script.</span></span> <span data-ttu-id="7c773-124">Ciò significa che, a seconda dell'azione personalizzata commit, un rollback potrebbe non essere in grado di annullare le modifiche apportate dall'azione.</span><span class="sxs-lookup"><span data-stu-id="7c773-124">This means that depending on the commit custom action, a rollback may not be able to undo the changes made by the action.</span></span> <span data-ttu-id="7c773-125">È possibile ignorare gli errori nelle azioni personalizzate di commit creando l'azione personalizzata per ignorare i codici restituiti.</span><span class="sxs-lookup"><span data-stu-id="7c773-125">You can ignore failures in commit custom actions by authoring the custom action to ignore return codes.</span></span>

<span data-ttu-id="7c773-126">Quando il programma di installazione esegue un'azione di rollback personalizzata, l'unico parametro di modalità che verrà impostato è MSIRUNMODE \_ rollback.</span><span class="sxs-lookup"><span data-stu-id="7c773-126">When the installer runs a rollback custom action, the only mode parameter it will set is MSIRUNMODE\_ROLLBACK.</span></span> <span data-ttu-id="7c773-127">Per una descrizione dei parametri della modalità di esecuzione, vedere [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) .</span><span class="sxs-lookup"><span data-stu-id="7c773-127">See [**MsiGetMode**](/windows/desktop/api/Msiquery/nf-msiquery-msigetmode) for a description of the run mode parameters.</span></span>

<span data-ttu-id="7c773-128">È possibile specificare un'azione di rollback personalizzata aggiungendo un flag di opzione al campo Type della [tabella CustomAction](customaction-table.md).</span><span class="sxs-lookup"><span data-stu-id="7c773-128">A rollback custom action can be specified by adding an option flag to the Type field of the [CustomAction table](customaction-table.md).</span></span> <span data-ttu-id="7c773-129">Vedere [azione personalizzata In-Script opzioni di esecuzione](custom-action-in-script-execution-options.md) per il flag di opzione che designa un'azione personalizzata di rollback.</span><span class="sxs-lookup"><span data-stu-id="7c773-129">See [Custom Action In-Script Execution Options](custom-action-in-script-execution-options.md) for the option flag designating a rollback custom action.</span></span>

<span data-ttu-id="7c773-130">Le azioni personalizzate rollback e commit non vengono eseguite quando il rollback è disabilitato.</span><span class="sxs-lookup"><span data-stu-id="7c773-130">Rollback and commit custom actions do not run when rollback is disabled.</span></span> <span data-ttu-id="7c773-131">Se l'autore di un pacchetto richiede questi tipi di azioni personalizzate per l'installazione corretta, è consigliabile usare la proprietà [**RollbackDisabled**](rollbackdisabled.md) in una condizione che impedisce che l'installazione continui quando il rollback è disabilitato.</span><span class="sxs-lookup"><span data-stu-id="7c773-131">If a package author requires these types of custom actions for proper installation, they should use the [**RollbackDisabled**](rollbackdisabled.md) property in a condition that prevents the installation from continuing when rollback is disabled.</span></span> <span data-ttu-id="7c773-132">Per informazioni su come disabilitare il rollback, vedere [rollback Installation (Windows Installer)](rollback-installation.md).</span><span class="sxs-lookup"><span data-stu-id="7c773-132">For information on how to disable rollback see [Rollback Installation (Windows Installer)](rollback-installation.md).</span></span>

 

 



