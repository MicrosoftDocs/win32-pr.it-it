---
description: In seguito a un ripristino, i writer controllano lo stato dell'operazione in modo che possano utilizzare i dati ripristinati e gestire gli errori.
ms.assetid: f9def67a-c4ea-4014-929f-51fbd10d770a
title: Panoramica della pulizia e della chiusura del ripristino
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 391e029cdb109589b42240b5482f6aba2ff43555
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104049848"
---
# <a name="overview-of-restore-clean-up-and-termination"></a><span data-ttu-id="01d93-103">Panoramica della pulizia e della chiusura del ripristino</span><span class="sxs-lookup"><span data-stu-id="01d93-103">Overview of Restore Clean up and Termination</span></span>

<span data-ttu-id="01d93-104">In seguito a un ripristino, i writer controllano lo stato dell'operazione in modo che possano utilizzare i dati ripristinati e gestire gli errori.</span><span class="sxs-lookup"><span data-stu-id="01d93-104">Following a restore, writers check the status of the operation so that they can make use of the restored data and deal with errors.</span></span> <span data-ttu-id="01d93-105">Il richiedente deve attendere il completamento di questa attività.</span><span class="sxs-lookup"><span data-stu-id="01d93-105">The requester must wait for the completion of this activity.</span></span> <span data-ttu-id="01d93-106">Per ulteriori informazioni, vedere [Cenni preliminari sull'elaborazione di un ripristino in VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="01d93-106">For more information, see [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="01d93-107">Nella tabella seguente viene illustrata la sequenza di azioni ed eventi necessari dopo che è stata eseguita un'operazione di ripristino.</span><span class="sxs-lookup"><span data-stu-id="01d93-107">The following table shows the sequence of actions and events that are required after a restore operation has taken place.</span></span>



| <span data-ttu-id="01d93-108">Azione del richiedente</span><span class="sxs-lookup"><span data-stu-id="01d93-108">Requester action</span></span>                                                                                                                                                                                                                                                                                                                                                              | <span data-ttu-id="01d93-109">Evento</span><span class="sxs-lookup"><span data-stu-id="01d93-109">Event</span></span>                                                           | <span data-ttu-id="01d93-110">Azione del writer</span><span class="sxs-lookup"><span data-stu-id="01d93-110">Writer action</span></span>                                                                                                                                                                                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="01d93-111">Il richiedente indica la fine del ripristino (vedere [**IVssBackupComponents::P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore)).</span><span class="sxs-lookup"><span data-stu-id="01d93-111">The requester indicates the end of the restore (see [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore)).</span></span>                                                                                                                                                                                                                                           | [<span data-ttu-id="01d93-112">*PostRestore*</span><span class="sxs-lookup"><span data-stu-id="01d93-112">*PostRestore*</span></span>](vssgloss-p.md) | <span data-ttu-id="01d93-113">Il writer esegue la pulizia post-ripristino e gestisce gli errori di ripristino e i file ripristinati in posizioni non standard (vedere [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)).</span><span class="sxs-lookup"><span data-stu-id="01d93-113">The writer conducts post-restore cleanup, and handles restoration failures and files that have been restored to nonstandard locations (see [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)).</span></span> |
| <span data-ttu-id="01d93-114">Il richiedente attende che i writer gestiscano l'evento [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) con [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span><span class="sxs-lookup"><span data-stu-id="01d93-114">The requester waits on writers to handle the [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) event with [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span></span> <span data-ttu-id="01d93-115">Deve inoltre verificare lo stato del writer (vedere [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)).</span><span class="sxs-lookup"><span data-stu-id="01d93-115">It should also verify writer status (see [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)).</span></span> | <span data-ttu-id="01d93-116">nessuno</span><span class="sxs-lookup"><span data-stu-id="01d93-116">None</span></span>                                                            | <span data-ttu-id="01d93-117">nessuno</span><span class="sxs-lookup"><span data-stu-id="01d93-117">None</span></span>                                                                                                                                                                                                                                               |
| <span data-ttu-id="01d93-118">Il richiedente rilascia l'interfaccia [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) .</span><span class="sxs-lookup"><span data-stu-id="01d93-118">The requester releases the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface.</span></span>                                                                                                                                                                                                                                                                                    | <span data-ttu-id="01d93-119">nessuno</span><span class="sxs-lookup"><span data-stu-id="01d93-119">None</span></span>                                                            | <span data-ttu-id="01d93-120">nessuno</span><span class="sxs-lookup"><span data-stu-id="01d93-120">None</span></span>                                                                                                                                                                                                                                               |



 

## <a name="requester-actions-during-cleanup-and-termination"></a><span data-ttu-id="01d93-121">Azioni del richiedente durante la pulizia e la terminazione</span><span class="sxs-lookup"><span data-stu-id="01d93-121">Requester Actions during Cleanup and Termination</span></span>

<span data-ttu-id="01d93-122">A questo punto, un richiedente indica la fine delle attività di ripristino del file generando un evento [*PostRestore*](vssgloss-p.md) chiamando [**IVssBackupComponents::P ostrestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span><span class="sxs-lookup"><span data-stu-id="01d93-122">At this point, a requester indicates the end of its file restoration activities by generating a [*PostRestore*](vssgloss-p.md) event by calling [**IVssBackupComponents::PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore).</span></span>

<span data-ttu-id="01d93-123">Le azioni del richiedente sono limitate all'attesa dei writer, che potrebbe dover eseguire una pulizia finale e gestire gli errori di ripristino e rilasciare l'interfaccia [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) dopo che tutti i writer hanno restituito la gestione dell'evento [*PostRestore*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="01d93-123">The requester's actions are limited to waiting on the writers, which may need to perform some final cleanup and handle restore errors, and releasing the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface after all writers have returned from handling the [*PostRestore*](vssgloss-p.md) event.</span></span>

## <a name="writer-actions-during-cleanup-and-termination"></a><span data-ttu-id="01d93-124">Azioni del writer durante la pulizia e la terminazione</span><span class="sxs-lookup"><span data-stu-id="01d93-124">Writer Actions during Cleanup and Termination</span></span>

<span data-ttu-id="01d93-125">L'evento [*PostRestore*](vssgloss-p.md) viene gestito dal metodo virtuale [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span><span class="sxs-lookup"><span data-stu-id="01d93-125">The [*PostRestore*](vssgloss-p.md) event is handled by the virtual method [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore).</span></span> <span data-ttu-id="01d93-126">L'implementazione predefinita restituisce semplicemente **true** senza eseguire alcuna azione.</span><span class="sxs-lookup"><span data-stu-id="01d93-126">The default implementation simply returns **true** without taking any action.</span></span> <span data-ttu-id="01d93-127">Se un writer deve esercitare un maggiore controllo sulla situazione di post-ripristino, può eseguire l'override di questo metodo.</span><span class="sxs-lookup"><span data-stu-id="01d93-127">If a writer needs to exercise more control of the post-restore situation, it can override this method.</span></span>

<span data-ttu-id="01d93-128">Oltre a qualsiasi pulizia normale, ad esempio la rimozione di file temporanei, che un writer può eseguire in [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), può gestire l'esito positivo o negativo delle operazioni di ripristino.</span><span class="sxs-lookup"><span data-stu-id="01d93-128">In addition to any normal cleanup (such as removing temporary files) that a writer might perform in [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore), it can handle the success or failure of restore operations.</span></span>

<span data-ttu-id="01d93-129">Il modo in cui gestisce gli errori di ripristino, i file ripristinati in un percorso alternativo e la necessità di ripristini futuri sono completamente a discrezione del writer.</span><span class="sxs-lookup"><span data-stu-id="01d93-129">How it handles restore errors, files restored to an alternate location, and the need for future restores are completely at the writer's discretion.</span></span> <span data-ttu-id="01d93-130">Le azioni tipiche possono includere il confronto di file in posizioni alternative o nuove con i file attualmente in uso, l'Unione di dati da più file o l'avvio di nuove sessioni connesse ai nuovi file di dati.</span><span class="sxs-lookup"><span data-stu-id="01d93-130">Typical actions might include comparing files in alternate or new locations with files currently in use, merging data from multiple files, or starting new sessions connected to the new data files.</span></span> <span data-ttu-id="01d93-131">VSS fornisce i meccanismi seguenti per supportare questa operazione in base a componenti:</span><span class="sxs-lookup"><span data-stu-id="01d93-131">VSS provides the following mechanisms for supporting this on a component-by-component basis:</span></span>

-   <span data-ttu-id="01d93-132">L'esito positivo o negativo del ripristino di un componente può essere trovato con [**IVssComponent:: GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus).</span><span class="sxs-lookup"><span data-stu-id="01d93-132">Success or failure in restoring any component can be found with [**IVssComponent::GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus).</span></span>
-   <span data-ttu-id="01d93-133">L'uso di mapping di percorsi alternativi nel ripristino dei file verrà indicato da [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="01d93-133">The use of alternate location mappings in restoring files will be indicated by [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span>
-   <span data-ttu-id="01d93-134">Per determinare se un ripristino è incrementale, è necessario eseguire ulteriori ripristini chiamando [**IVssComponent:: GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores).</span><span class="sxs-lookup"><span data-stu-id="01d93-134">Determining if a restore is incremental and will require further restores is done by calling [**IVssComponent::GetAdditionalRestores**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getadditionalrestores).</span></span> <span data-ttu-id="01d93-135">I writer che necessitano di un ripristino completo dei dati non devono essere riavviati finché il metodo non restituisce false.</span><span class="sxs-lookup"><span data-stu-id="01d93-135">Writers that need a complete restoration of their data should not restart until this method returns false.</span></span>
-   <span data-ttu-id="01d93-136">I writer possono determinare se il richiedente deve ripristinare i file in un percorso precedentemente non specificato usando [**IVssComponent:: GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) e [**IVssComponent:: GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)</span><span class="sxs-lookup"><span data-stu-id="01d93-136">Writers can determine if the requester has needed to restore files to a previously unspecified location using [**IVssComponent::GetNewTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtargetcount) and [**IVssComponent::GetNewTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getnewtarget)</span></span>

<span data-ttu-id="01d93-137">Per ulteriori informazioni sul ripristino dei file in percorsi non predefiniti, vedere [percorsi di backup e ripristino non predefiniti](non-default-backup-and-restore-locations.md).</span><span class="sxs-lookup"><span data-stu-id="01d93-137">(For more information on restoring files to non-default locations, see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md).)</span></span>

<span data-ttu-id="01d93-138">Come per qualsiasi metodo [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) , le informazioni restituite da una determinata istanza si applicano a tali componenti [*inclusi in modo esplicito*](vssgloss-e.md) per il backup e a tutti i sottocomponenti inclusi in modo [*implicito*](vssgloss-i.md) per il backup, inclusi quelli inclusi in modo esplicito per il ripristino da parte del richiedente tramite [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) . per informazioni dettagliate, vedere [utilizzo della selezione per il ripristino e i sottocomponenti](working-with-selectability-for-restore-and-subcomponents.md)</span><span class="sxs-lookup"><span data-stu-id="01d93-138">As with any [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) method, the information returned by a given instance applies to those components [*explicitly included*](vssgloss-e.md) for backup and any of its [*implicitly included*](vssgloss-i.md) for backup subcomponents, including those subcomponents explicitly included for restore by the requester using [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) (see [Working with Selectability For Restore and Subcomponents](working-with-selectability-for-restore-and-subcomponents.md) for details).</span></span>

<span data-ttu-id="01d93-139">Poiché i writer dovranno accedere al documento dei componenti di backup, è importante che il richiedente non rilasci l'interfaccia [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) fino a quando i writer non hanno terminato l'elaborazione.</span><span class="sxs-lookup"><span data-stu-id="01d93-139">Because the writers will require access to the Backup Components Document, it is important that the requester not release the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface until writers have finished processing.</span></span>

 

 



