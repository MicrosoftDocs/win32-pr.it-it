---
description: Il meccanismo di destinazione diretto consente ai writer di rimappare i file in fase di ripristino.
ms.assetid: c0b4ab26-2bb6-4b0f-b837-01057983b49b
title: Utilizzo di destinazioni dirette
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8bd2e15ec873b87030a2d01be69d2c3e5f95a193
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104049500"
---
# <a name="working-with-directed-targets"></a><span data-ttu-id="73351-103">Utilizzo di destinazioni dirette</span><span class="sxs-lookup"><span data-stu-id="73351-103">Working with Directed Targets</span></span>

<span data-ttu-id="73351-104">Il meccanismo di [*destinazione diretto*](vssgloss-d.md) consente ai writer di rimappare i file in fase di ripristino.</span><span class="sxs-lookup"><span data-stu-id="73351-104">The [*directed target*](vssgloss-d.md) mechanism allows writers to remap files at restore time.</span></span> <span data-ttu-id="73351-105">Questo consente ai writer di eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="73351-105">This allows writers to do the following:</span></span>

-   <span data-ttu-id="73351-106">Specificare i nuovi percorsi di destinazione (analogamente a un richiedente [**IVssBackupComponents:: AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)).</span><span class="sxs-lookup"><span data-stu-id="73351-106">Specify new target locations (analogous to a requester's [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)).</span></span>
-   <span data-ttu-id="73351-107">Recuperare spazio su disco ripristinando solo le parti necessarie di un file su disco, in particolare quando è stato eseguito il backup di un file utilizzando il meccanismo di [*file parziale*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="73351-107">Reclaim disk space by restoring only needed parts of a file to disk, particularly when a file was backed up using the [*partial file*](vssgloss-p.md) mechanism.</span></span>
-   <span data-ttu-id="73351-108">Modificare il formato del file in modo che soddisfi le esigenze correnti.</span><span class="sxs-lookup"><span data-stu-id="73351-108">Change the file format to meet current needs.</span></span>

<span data-ttu-id="73351-109">Qualsiasi file da usare con un'operazione di destinazione diretta deve avere una [*destinazione di ripristino*](vssgloss-r.md) di VSS \_ RT \_ diretta.</span><span class="sxs-lookup"><span data-stu-id="73351-109">Any file to be used with a directed target operation must have a [*restore target*](vssgloss-r.md) of VSS\_RT\_DIRECTED.</span></span>

<span data-ttu-id="73351-110">Una volta stabilito che un richiedente può supportare un'operazione di destinazione diretta, un writer (durante la gestione dell'evento di [**preripristino**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) ) utilizza [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) per l'istanza di [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corrispondente al componente che gestisce il file (o il componente che definisce il set di componenti che contiene il file) per definire la modalità di modifica del mapping del file durante il ripristino.</span><span class="sxs-lookup"><span data-stu-id="73351-110">Once it has been established that a requester can support a directed target operation, a writer (while handling the [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event) uses the [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file) to define how the file is to be remapped on restore.</span></span>

<span data-ttu-id="73351-111">Quando si usa [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget), i writer specificano il nome e il percorso del file usati per eseguire il backup del file, il nome del file e il percorso della destinazione di ripristino (questi valori possono corrispondere al nome e al percorso del file originale) e agli intervalli di file di origine e di destinazione.</span><span class="sxs-lookup"><span data-stu-id="73351-111">In using [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget), writers specify the file name and path used to back up the file, the file name and path of its restore destination (these values can be the same as the original file name and path), and source and destination file ranges.</span></span>

<span data-ttu-id="73351-112">Come per le operazioni di file parziali, gli elenchi di intervalli sono coppie di offset nel file di cui eseguire il backup (in byte) e la lunghezza della sezione da ripristinare (in byte), offset e lunghezza separati da due punti e ogni coppia è separata da una virgola: \*Offset1 \***:**_length1_*_,_* \* Offset2 \***:**_length2_.</span><span class="sxs-lookup"><span data-stu-id="73351-112">As with partial file operations, range lists are pairs of offsets into the file to be backed up (in bytes) and the length of the section to be restored (in bytes), the offset and length being separated by a colon, and each pair separated by a comma: *Offset1\***:**_Length1_*_,_\* \*Offset2\***:**_Length2_.</span></span> <span data-ttu-id="73351-113">Ogni valore è un Integer a 64 bit in formato esadecimale o decimale.</span><span class="sxs-lookup"><span data-stu-id="73351-113">Each value is a 64-bit integer in either hexadecimal or decimal format.</span></span>

<span data-ttu-id="73351-114">Se un writer deve usare il meccanismo di destinazione diretto per fare in modo che il richiedente ripristini un file in un nuovo percorso, avrebbe chiamato [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) con il nome e il percorso del file originale e il nome e il percorso del nuovo file e specificare gli intervalli di destinazione di origine con un offset zero e una lunghezza uguale a quella dell'intera dimensione del file.</span><span class="sxs-lookup"><span data-stu-id="73351-114">If a writer needs to use the directed target mechanism to have the requester restore a file to a new location, it would have called [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget) with the original file name and path and the new file name and path, and specify source destination ranges with a zero offset and a length equal to that of the entire file size.</span></span>

<span data-ttu-id="73351-115">Se ad esempio un writer deve avere un file da 200 mila, C: \\ WriterData \\ index. dat, ripristinato come c: \\ WriterData \\ OldIndex. dat, la stringa dell'intervallo di origine e di destinazione sarà "**0:204880**".</span><span class="sxs-lookup"><span data-stu-id="73351-115">For instance, if a writer needs to have a 200K file, C:\\WriterData\\Index.dat, restored as C:\\WriterData\\OldIndex.dat, the source and destination range string would be "**0:204880**."</span></span>

<span data-ttu-id="73351-116">Per modificare il mapping di un file di backup di grandi dimensioni parzialmente, il richiedente utilizzerebbe l'intervallo di origine utilizzato per eseguire il backup del file e un intervallo di destinazione che ridurrà le dimensioni del file.</span><span class="sxs-lookup"><span data-stu-id="73351-116">To remap a large, partially backed-up file, the requester would use the source range used to back up the file and a destination range that will reduce the file size.</span></span> <span data-ttu-id="73351-117">È possibile ottenere le informazioni sull'intervallo di origine utilizzando [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) per l'istanza di [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corrispondente al componente che gestisce il file (o il componente che definisce il set di componenti che contiene il file).</span><span class="sxs-lookup"><span data-stu-id="73351-117">The source range information can be obtained by using [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

<span data-ttu-id="73351-118">Se il file parzialmente sottoposto a backup era inizialmente un file di grandi dimensioni la cui intestazione, byte 64-512, contiene un numero di record e altre informazioni aggiornate di frequente e i cui dati più recenti si trovano negli ultimi 65536 byte del file, ovvero i byte da 0x1239E8577A a 0x1239E7577A, un writer potrebbe specificare un elenco di intervalli di origine come stringa "**64:448, 0x1239E8577A: 65536**".</span><span class="sxs-lookup"><span data-stu-id="73351-118">If the partially backed-up file was initially a large file whose header, bytes 64-512, contains a records count and other frequently updated information, and whose most recent data is to be found in the file's last 65536 bytes—bytes 0x1239E8577A to 0x1239E7577A, a writer could specify a source range list as the string "**64:448,0x1239E8577A:65536**."</span></span>

<span data-ttu-id="73351-119">Se il writer vuole modificare il mapping del file ripristinato in modo che contenga solo l'intestazione e i dati più recenti, l'elenco di intervalli potrebbe essere la stringa "**0:488488:65536**".</span><span class="sxs-lookup"><span data-stu-id="73351-119">If the writer wanted to remap the restored file to contain only the header and most recent data, the range list could be the string "**0:488,488:65536**."</span></span>

<span data-ttu-id="73351-120">Prima di eseguire effettivamente un'operazione di ripristino, un richiedente deve verificare se i file richiedono il supporto diretto della destinazione.</span><span class="sxs-lookup"><span data-stu-id="73351-120">Prior to actually performing a restore operation, a requester should check to see if any files require directed target support.</span></span>

<span data-ttu-id="73351-121">A tale scopo, il richiedente scorre prima i writer con i componenti archiviati nel documento relativo ai componenti di backup usando [**IVssBackupComponents:: GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) e [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span><span class="sxs-lookup"><span data-stu-id="73351-121">To do this, the requester first iterates over the writers with stored components in its Backup Components Document using [**IVssBackupComponents::GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) and [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span></span>

<span data-ttu-id="73351-122">L'interfaccia [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) viene quindi utilizzata per restituire le istanze dell'interfaccia [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) che fornisce i metodi [**IVssWriterComponentsExt:: getComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) e [**IVssWriterComponentsExt:: GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount) che consentono al richiedente di ottenere istanze di [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="73351-122">The [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) interface is then used to return instances of the [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) interface, which provides [**IVssWriterComponentsExt::GetComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) and [**IVssWriterComponentsExt::GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount) methods that allow the requester to obtain [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) instances.</span></span>

<span data-ttu-id="73351-123">Questo consente a un richiedente di ottenere i candidati indirizzati di destinazione usando [**IVssComponent:: GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) e [**IVssComponent:: GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget) per l'istanza di [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corrispondente al componente che gestisce il file (o il componente che definisce il set di componenti che contiene il file).</span><span class="sxs-lookup"><span data-stu-id="73351-123">This allows a requester to obtain directed target candidates by using [**IVssComponent::GetDirectedTargetCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtargetcount) and [**IVssComponent::GetDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getdirectedtarget) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

 

 
