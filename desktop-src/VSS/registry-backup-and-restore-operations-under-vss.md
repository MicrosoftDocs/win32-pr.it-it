---
description: Il servizio Registro di sistema di Windows supporta un VSS writer, denominato writer del registro di sistema, che consente ai richiedenti di eseguire il backup di un registro di sistema usando i dati archiviati in un volume copiato da un'ombreggiatura.
ms.assetid: 94a45b04-0bdc-4211-bed0-caeabba774af
title: Operazioni di backup e ripristino del registro di sistema in VSS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db1a3022ec2fb08b07bcff8b28455ae7154e4c40
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106310677"
---
# <a name="registry-backup-and-restore-operations-under-vss"></a><span data-ttu-id="7d16a-103">Operazioni di backup e ripristino del registro di sistema in VSS</span><span class="sxs-lookup"><span data-stu-id="7d16a-103">Registry Backup and Restore Operations Under VSS</span></span>

<span data-ttu-id="7d16a-104">Il servizio Registro di sistema di Windows supporta un VSS writer, denominato writer del registro di sistema, che consente ai richiedenti di eseguire il backup di un registro di sistema usando i dati archiviati in un volume copiato da un'ombreggiatura.</span><span class="sxs-lookup"><span data-stu-id="7d16a-104">The Windows Registry Service supports a VSS writer, called the registry writer, which allows requesters to back up a system registry using data stored on a shadow copied volume.</span></span> <span data-ttu-id="7d16a-105">Per ulteriori informazioni sul writer del registro di sistema, vedere la pagina relativa ai [writer VSS](in-box-vss-writers.md).</span><span class="sxs-lookup"><span data-stu-id="7d16a-105">For more information about the registry writer, see [In-Box VSS Writers](in-box-vss-writers.md).</span></span>

<span data-ttu-id="7d16a-106">Il writer del registro di sistema esegue backup sul posto e ripristini del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="7d16a-106">The registry writer performs in-place backups and restores of the registry.</span></span> <span data-ttu-id="7d16a-107">Inoltre, il writer del registro di sistema segnala solo hive di sistema; non segnala gli hive degli utenti.</span><span class="sxs-lookup"><span data-stu-id="7d16a-107">In addition, the registry writer reports only system hives; it does not report user hives.</span></span>

<span data-ttu-id="7d16a-108">**Windows Server 2003:** Il writer del registro di sistema utilizza un file di repository intermedio (noto anche come file spit) per archiviare i dati del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="7d16a-108">**Windows Server 2003:** The registry writer uses an intermediate repository file (also known as a spit file) to store registry data.</span></span> <span data-ttu-id="7d16a-109">Inoltre, il writer del registro di sistema segnala hive di sistema e hive utente.</span><span class="sxs-lookup"><span data-stu-id="7d16a-109">In addition, the registry writer reports system hives and user hives.</span></span>

<span data-ttu-id="7d16a-110">L'ID del writer per il writer del registro di sistema è AFBAB4A2-367D-4D15-A586-71DBB18F8485.</span><span class="sxs-lookup"><span data-stu-id="7d16a-110">The writer ID for the registry writer is AFBAB4A2-367D-4D15-A586-71DBB18F8485.</span></span>

<span data-ttu-id="7d16a-111">**Windows XP:** Nessun writer del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="7d16a-111">**Windows XP:** There is no registry writer.</span></span> <span data-ttu-id="7d16a-112">I dati del registro di sistema vengono segnalati dal writer dello stato di avvio, il cui ID writer è F2436E37-09F5-41AF-9B2A-4CA2435DBFD5.</span><span class="sxs-lookup"><span data-stu-id="7d16a-112">The registry data is reported by the Bootable State writer, whose writer ID is F2436E37-09F5-41AF-9B2A-4CA2435DBFD5.</span></span>

> [!Note]  
> <span data-ttu-id="7d16a-113">Microsoft non fornisce supporto tecnico per sviluppatori o professionisti IT per l'implementazione di ripristini dello stato del sistema online in Windows (tutte le versioni).</span><span class="sxs-lookup"><span data-stu-id="7d16a-113">Microsoft does not provide developer or IT professional technical support for implementing online system state restores on Windows (all releases).</span></span> <span data-ttu-id="7d16a-114">Per informazioni sull'uso di API e procedure fornite da Microsoft per implementare il ripristino dello stato del sistema online, vedere le risorse della community disponibili in [MSDN Community Center](https://msdn.microsoft.com/community/default.aspx).</span><span class="sxs-lookup"><span data-stu-id="7d16a-114">For information about using Microsoft-provided APIs and procedures to implement online system state restores, see the community resources available at the [MSDN Community Center](https://msdn.microsoft.com/community/default.aspx).</span></span>

 

> [!Note]  
> <span data-ttu-id="7d16a-115">Le informazioni seguenti si applicano solo a Windows Server 2003 e Windows XP.</span><span class="sxs-lookup"><span data-stu-id="7d16a-115">The following information only applies to Windows Server 2003 and Windows XP.</span></span>

 

## <a name="registry-backup-using-vss"></a><span data-ttu-id="7d16a-116">Backup del registro di sistema con VSS</span><span class="sxs-lookup"><span data-stu-id="7d16a-116">Registry Backup Using VSS</span></span>

<span data-ttu-id="7d16a-117">Il writer del registro di sistema esporterà e salverà i file del registro di sistema attivi nei percorsi definiti dalla chiave **HKEY \_ Local \_ Machine** \\ **System** \\ **CurrentControlSet** \\ **Control** \\ **hive**.</span><span class="sxs-lookup"><span data-stu-id="7d16a-117">The registry writer will export and save active registry files in the locations defined by the key **HKEY\_LOCAL\_MACHINE**\\**System**\\**CurrentControlSet**\\**Control**\\**hivelist**.</span></span>

<span data-ttu-id="7d16a-118">I nomi dei valori in questa voce del registro di sistema identificano l'hive del registro di sistema da salvare e i dati del valore forniscono il file che contiene il file (il file hive).</span><span class="sxs-lookup"><span data-stu-id="7d16a-118">The names of the values under this registry entry identify the registry hive to be saved, and the value's data provides the file containing the file (the hive file).</span></span> <span data-ttu-id="7d16a-119">I file hive vengono specificati con il formato seguente: \\ Device \\ *HarddiskVolumeX* \\ *path* \\ *filename*.</span><span class="sxs-lookup"><span data-stu-id="7d16a-119">The hive files are specified with the following format: \\Device\\*HarddiskVolumeX*\\*path*\\*filename*.</span></span>

<span data-ttu-id="7d16a-120">Ad esempio, in **HKEY \_ Local \_ Machine** \\ **System** \\ **CurrentControlSet** \\ **Control** \\ **hive**, è possibile vedere il registro di sistema **\\ del dispositivo \\ \\ software**  =  \\ Device \\ HarddiskVolume1 \\ Windows \\ system32 \\ config \\ software.</span><span class="sxs-lookup"><span data-stu-id="7d16a-120">For example, under **HKEY\_LOCAL\_MACHINE**\\**System**\\**CurrentControlSet**\\**Control**\\**hivelist**, you might see **\\REGISTRY\\MACHINE\\SOFTWARE** = \\Device\\HarddiskVolume1\\Windows\\System32\\config\\SOFTWARE.</span></span>

<span data-ttu-id="7d16a-121">Il writer del registro di sistema garantisce che i file hive vengano salvati su disco prima della relativa copia shadow.</span><span class="sxs-lookup"><span data-stu-id="7d16a-121">The registry writer ensures that hive files are saved to disk prior to its shadow copy.</span></span>

<span data-ttu-id="7d16a-122">Quando si esegue il backup degli hive del registro di sistema, un richiedente sostituisce il \\ dispositivo \\ *HarddiskVolumeX* con la stringa dell' [*oggetto dispositivo*](vssgloss-d.md) della copia shadow del volume.</span><span class="sxs-lookup"><span data-stu-id="7d16a-122">When backing up the registry hives, a requester would replace \\Device\\*HarddiskVolumeX* with the [*device object*](vssgloss-d.md) string of the volume's shadow copy.</span></span>

> [!Note]  
> <span data-ttu-id="7d16a-123">È possibile convertire il \\ percorso \\ *HarddiskVolumeX* del dispositivo in un percorso Win32 equivalente usando la funzione [**QueryDosDevice**](/windows/win32/api/fileapi/nf-fileapi-querydosdevicew) .</span><span class="sxs-lookup"><span data-stu-id="7d16a-123">You can convert the \\Device\\*HarddiskVolumeX* path to an equivalent Win32 path by using the [**QueryDosDevice**](/windows/win32/api/fileapi/nf-fileapi-querydosdevicew) function.</span></span> <span data-ttu-id="7d16a-124">Per ulteriori informazioni, vedere [ottenere un nome di file da un handle di file](../memory/obtaining-a-file-name-from-a-file-handle.md) o [visualizzare i nomi dei percorsi dei volumi](../fileio/displaying-volume-paths.md).</span><span class="sxs-lookup"><span data-stu-id="7d16a-124">For more information, see [Obtaining a File Name From a File Handle](../memory/obtaining-a-file-name-from-a-file-handle.md) or [Displaying Volume Path Names](../fileio/displaying-volume-paths.md).</span></span>

 

## <a name="registry-restore-using-non-vss-win32-apis"></a><span data-ttu-id="7d16a-125">Ripristino del registro di sistema mediante API Win32 non VSS</span><span class="sxs-lookup"><span data-stu-id="7d16a-125">Registry Restore Using Non-VSS Win32 APIs</span></span>

<span data-ttu-id="7d16a-126">Per un ripristino in linea (modalità provvisoria o completa), è necessario mantenere le sottochiavi della chiave del registro di sistema **HKEY \_ Local \_ computer** \\ **System** \\ **CurrentControlSet** \\ **Control** \\ **Session Manager** \\ **PendingFileRenameOperations** .</span><span class="sxs-lookup"><span data-stu-id="7d16a-126">For an online (safe mode or full operating system) restore, the subkeys in the **HKEY\_LOCAL\_MACHINE**\\**SYSTEM**\\**CurrentControlSet**\\**Control**\\**Session Manager**\\**PendingFileRenameOperations** registry key must be preserved.</span></span>

<span data-ttu-id="7d16a-127">Le funzioni [**MoveFileEx**](/windows/win32/api/winbase/nf-winbase-movefileexa) e [**MoveFileTransacted**](/windows/win32/api/winbase/nf-winbase-movefiletransacteda) usano questa chiave del registro di sistema per archiviare le informazioni sui file che sono stati rinominati usando il ritardo MOVEFILE \_ fino al \_ \_ valore di riavvio nel parametro *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="7d16a-127">The [**MoveFileEx**](/windows/win32/api/winbase/nf-winbase-movefileexa) and [**MoveFileTransacted**](/windows/win32/api/winbase/nf-winbase-movefiletransacteda) functions use this registry key to store information about files that were renamed by using the MOVEFILE\_DELAY\_UNTIL\_REBOOT value in the *dwFlags* parameter.</span></span>

<span data-ttu-id="7d16a-128">Per mantenere il contenuto della chiave del registro di sistema **PendingFileRenameOperations** , è necessario che l'applicazione di backup chiami la funzione [**RegLoadKey**](/windows/win32/api/winreg/nf-winreg-regloadkeya) per connettere il file del registro di sistema da ripristinare al registro di sistema attivo.</span><span class="sxs-lookup"><span data-stu-id="7d16a-128">To preserve the contents of the **PendingFileRenameOperations** registry key, your backup application should call the [**RegLoadKey**](/windows/win32/api/winreg/nf-winreg-regloadkeya) function to connect the registry file to be restored to the active registry.</span></span> <span data-ttu-id="7d16a-129">L'applicazione di backup può quindi usare le varie funzioni del registro di sistema per copiare le chiavi e i valori desiderati nell'hive caricato.</span><span class="sxs-lookup"><span data-stu-id="7d16a-129">Your backup application can then use the various registry functions to copy the desired keys and values into the loaded hive.</span></span> <span data-ttu-id="7d16a-130">Al termine della copia, è necessario chiamare le funzioni [**RegFlushKey ha**](/windows/win32/api/winreg/nf-winreg-regflushkey) e [**RegUnLoadKey**](/windows/win32/api/winreg/nf-winreg-regunloadkeya) .</span><span class="sxs-lookup"><span data-stu-id="7d16a-130">After the copy is complete, the [**RegFlushKey**](/windows/win32/api/winreg/nf-winreg-regflushkey) and [**RegUnloadKey**](/windows/win32/api/winreg/nf-winreg-regunloadkeya) functions should be called.</span></span>

<span data-ttu-id="7d16a-131">Per un ripristino offline (ambiente ripristino Windows o Windows PE), non è necessario rispettare la chiave del registro di sistema **PendingFileRenameOperations** .</span><span class="sxs-lookup"><span data-stu-id="7d16a-131">For an offline (Windows Recovery Environment or Windows PE) restore, it is not necessary to honor the **PendingFileRenameOperations** registry key.</span></span>

## <a name="registry-restore-using-non-vss-win32-apis-in-windows-server-2003"></a><span data-ttu-id="7d16a-132">Ripristino del registro di sistema mediante API Win32 non VSS in Windows Server 2003</span><span class="sxs-lookup"><span data-stu-id="7d16a-132">Registry Restore Using Non-VSS Win32 APIs in Windows Server 2003</span></span>

> [!Note]  
> <span data-ttu-id="7d16a-133">Le informazioni seguenti si applicano solo alle operazioni di ripristino correlate al ripristino di emergenza (noto anche come ripristino bare metal) che vengono eseguite in Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="7d16a-133">The following information applies only to restore operations related to disaster recovery (also known as bare-metal recovery) that are performed in Windows Server 2003.</span></span>

 

<span data-ttu-id="7d16a-134">Quando si ripristina il registro di sistema, un'applicazione di backup deve spostare alcune delle sottochiavi dal registro di sistema corrente al registro di sistema da ripristinare.</span><span class="sxs-lookup"><span data-stu-id="7d16a-134">When restoring the registry, a backup application needs to move some of the subkeys from the current registry into the registry that is to be restored.</span></span>

<span data-ttu-id="7d16a-135">A tale scopo, un'applicazione di backup può chiamare **RegLoadKey** per connettere il file del registro di sistema da ripristinare al registro di sistema attualmente attivo.</span><span class="sxs-lookup"><span data-stu-id="7d16a-135">To do this, a backup application can call **RegLoadKey** to connect the registry file to be restored to the currently active registry.</span></span> <span data-ttu-id="7d16a-136">Può quindi usare le varie funzioni del registro di sistema per copiare le chiavi e i valori desiderati nell'hive caricato.</span><span class="sxs-lookup"><span data-stu-id="7d16a-136">It can then use the various registry functions to copy the desired keys and values into the loaded hive.</span></span> <span data-ttu-id="7d16a-137">Al termine della copia, vengono chiamati **RegFlushKey ha** e **RegUnLoadKey** .</span><span class="sxs-lookup"><span data-stu-id="7d16a-137">After the copy is complete, **RegFlushKey** and **RegUnloadKey** are called.</span></span>

<span data-ttu-id="7d16a-138">È presente una chiave del registro di sistema che indica a un'applicazione di ripristino (richiedente) le chiavi del registro di **sistema in HKEY \_ \_ computer \\ locale** che non devono essere sovrascritte in fase di ripristino:</span><span class="sxs-lookup"><span data-stu-id="7d16a-138">There is a registry key that indicates to a restore application (requester) the registry keys under **HKEY\_LOCAL\_MACHINE\\SYSTEM** that should not be overwritten at restore time:</span></span>

<span data-ttu-id="7d16a-139">**HKEY \_ Local \_ computer \\ System \\ CurrentControlSet \\ Control \\ backuprestore \\ KeysNotToRestore**</span><span class="sxs-lookup"><span data-stu-id="7d16a-139">**HKEY\_LOCAL\_MACHINE\\System\\CurrentControlSet\\Control\\BackupRestore\\KeysNotToRestore**</span></span>

<span data-ttu-id="7d16a-140">Parte del processo di ripristino dello stato del sistema comporta il ripristino di un registro di sistema eseguito in precedenza.</span><span class="sxs-lookup"><span data-stu-id="7d16a-140">Part of the system state restore process involves restoring a previously backed-up registry.</span></span>

<span data-ttu-id="7d16a-141">Le applicazioni di backup devono prestare particolare attenzione durante il ripristino dell'hive di **\_ \_ \\ sistema del computer locale HKEY** , perché il processo di installazione di una versione temporanea del sistema operativo Windows avrà le chiavi stabilite nell'hive di sistema appena installato i cui valori devono sopravvivere all'operazione di ripristino.</span><span class="sxs-lookup"><span data-stu-id="7d16a-141">Backup applications need to take special care when restoring the **HKEY\_LOCAL\_MACHINE\\SYSTEM** hive because the process of installing a temporary version of the Windows operating system will have established keys in the newly installed system hive whose values must survive the restore operation.</span></span>

<span data-ttu-id="7d16a-142">Ad esempio, quando il sistema di sostituzione ha una scheda di interfaccia di rete diversa dal sistema originale, il ripristino delle chiavi originali per la scheda precedente comporterà risultati imprevedibili.</span><span class="sxs-lookup"><span data-stu-id="7d16a-142">For example, when the replacement system has a network interface card different from the original system, restoration of the original keys for the previous card will lead to unpredictable results.</span></span> <span data-ttu-id="7d16a-143">Questo è dovuto al fatto che il servizio Plug and Play ha rilevato e inserito nel registro di sistema le voci appropriate del registro di sistema del driver e del servizio.</span><span class="sxs-lookup"><span data-stu-id="7d16a-143">This is because the Plug and Play service has detected and placed proper service and driver registry entries into the registry.</span></span> <span data-ttu-id="7d16a-144">Questi valori devono essere conservati per eseguire correttamente l'avvio dopo il ripristino del sistema.</span><span class="sxs-lookup"><span data-stu-id="7d16a-144">These values must be preserved to properly boot after system restore.</span></span>

<span data-ttu-id="7d16a-145">Questa sezione descrive il modo in cui le applicazioni di backup possono individuare quali chiavi e file devono essere conservati durante l'esecuzione di un ripristino dell'hive di **\_ \_ \\ sistema del computer locale HKEY** .</span><span class="sxs-lookup"><span data-stu-id="7d16a-145">This section describes how backup applications can discover which keys and files are to be preserved when executing a restore of the **HKEY\_LOCAL\_MACHINE\\SYSTEM** hive.</span></span> <span data-ttu-id="7d16a-146">In alcuni casi, questa operazione comporterà la copia a livello di codice delle chiavi dall'hive di installazione appena installato nell'hive da ripristinare.</span><span class="sxs-lookup"><span data-stu-id="7d16a-146">In some cases, this will involve programmatically copying the keys from the newly installed installation hive into the hive to be restored.</span></span> <span data-ttu-id="7d16a-147">In altri casi, assicurandosi che le chiavi del registro di sistema di un prodotto non vengano sostituite, è sufficiente specificare tali chiavi nel file di configurazione INF del prodotto.</span><span class="sxs-lookup"><span data-stu-id="7d16a-147">In other cases, ensuring that a product's registry keys are not replaced is as simple as specifying such keys in the product's INF configuration file.</span></span>

<span data-ttu-id="7d16a-148">Le chiavi (e i dati chiave) che devono essere mantenute vengono enumerate nell'hive di **\_ \_ \\ sistema del computer locale HKEY** nel</span><span class="sxs-lookup"><span data-stu-id="7d16a-148">Keys (and key data) that are to be preserved are enumerated in the **HKEY\_LOCAL\_MACHINE\\SYSTEM** hive under the</span></span>

<span data-ttu-id="7d16a-149">**HKEY \_ Local \_ computer \\ System \\ CurrentControlSet \\ Control \\ backuprestore \\ KeysNotToRestore**</span><span class="sxs-lookup"><span data-stu-id="7d16a-149">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\BackupRestore\\KeysNotToRestore**</span></span>

<span data-ttu-id="7d16a-150">chiave come set di \_ stringhe reg \_ multisz (denominate *stringhe chiave* in questo documento).</span><span class="sxs-lookup"><span data-stu-id="7d16a-150">key as sets of REG\_MULTI\_SZ strings (called *key strings* in this document).</span></span>

<span data-ttu-id="7d16a-151">Un'applicazione di backup (richiedente) deve esaminare i valori di queste chiavi nel registro di sistema attivo e il registro di sistema appena ripristinato, perché qualsiasi applicazione o servizio può aggiungere valori in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="7d16a-151">A backup application (requester) must examine the values of these keys in the active registry and the newly restored registry because any application or service can add values at any time.</span></span>

<span data-ttu-id="7d16a-152">Il modo in cui le stringhe di chiave devono essere interpretate dalle applicazioni di backup è determinato dal carattere terminale:</span><span class="sxs-lookup"><span data-stu-id="7d16a-152">How key strings are to be interpreted by backup applications is determined by their terminal character:</span></span>

1.  <span data-ttu-id="7d16a-153">Le stringhe chiave terminate con una barra rovesciata (' \\ ') vengono interpretate come sottochiavi.</span><span class="sxs-lookup"><span data-stu-id="7d16a-153">Key strings terminated with a backslash ('\\') are interpreted as subkeys.</span></span> <span data-ttu-id="7d16a-154">Quando viene rilevata una sottostringa di questo tipo, l'applicazione di backup deve conservare tutti i dati e tutte le chiavi subordinate.</span><span class="sxs-lookup"><span data-stu-id="7d16a-154">When such a substring is encountered, the backup application must preserve all data and all subordinate keys.</span></span>

    <span data-ttu-id="7d16a-155">Ad esempio, il codice seguente specifica che tutte le chiavi e i dati subordinati devono essere conservati durante un'operazione di ripristino:</span><span class="sxs-lookup"><span data-stu-id="7d16a-155">For example, the following specifies that all subordinate keys and data are to be preserved across a restore operation:</span></span>

    <span data-ttu-id="7d16a-156">**HKEY \_ Local \_ computer \\ System \\ CurrentControlSet \\ Services \\ dmio \\ boot info\\**</span><span class="sxs-lookup"><span data-stu-id="7d16a-156">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\dmio\\boot info\\**</span></span>

    <span data-ttu-id="7d16a-157">A questo scopo, questa chiave e tutte le chiavi e i dati subordinati devono essere copiati dal registro di sistema esistente (ovvero quello creato dall'installazione di Windows) nel registro di sistema appena ripristinato.</span><span class="sxs-lookup"><span data-stu-id="7d16a-157">To this end, this key and all subordinate keys and data must be copied from the existing registry (that is, the one created by the installation of Windows) into the newly restored registry.</span></span> <span data-ttu-id="7d16a-158">Questa operazione è detta operazione di *sostituzione della chiave* .</span><span class="sxs-lookup"><span data-stu-id="7d16a-158">This is called a *key replace* operation.</span></span> <span data-ttu-id="7d16a-159">Questa operazione sostituisce la chiave corrispondente nel registro di sistema ripristinato.</span><span class="sxs-lookup"><span data-stu-id="7d16a-159">This operation replaces the corresponding key in the restored registry.</span></span>

2.  <span data-ttu-id="7d16a-160">Le stringhe chiave il cui carattere di terminazione è un asterisco (' \* ') specificano che tutte le sottochiavi devono essere unite.</span><span class="sxs-lookup"><span data-stu-id="7d16a-160">Key strings whose termination character is an asterisk ('\*') specifies that all subkeys should be merged.</span></span> <span data-ttu-id="7d16a-161">Ad esempio, la stringa chiave:</span><span class="sxs-lookup"><span data-stu-id="7d16a-161">For example, the key string:</span></span>

    <span data-ttu-id="7d16a-162">\**HKEY \_ \_ \\ \\ \\ Servizi \\ CurrentControlSet di sistema del computer locale \** _</span><span class="sxs-lookup"><span data-stu-id="7d16a-162">\**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\\** _</span></span>

    <span data-ttu-id="7d16a-163">Specifica che la chiave dei servizi nel registro di sistema esistente, ad esempio quelle create dall'installazione di Windows, deve essere unita nel registro di sistema ripristinato.</span><span class="sxs-lookup"><span data-stu-id="7d16a-163">specifies that the services key in the existing registry (for example those created by the installation of Windows) must be merged into the restored registry.</span></span> <span data-ttu-id="7d16a-164">Si tratta di un'operazione di merge \* _key e, se è presente una sottochiave nell'hive esistente e nell'hive ripristinato, la chiave nella directory ripristinata viene mantenuta con le eccezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="7d16a-164">This is called a _key merge\* operation, and if a subkey exists in both the existing hive and the restored hive, the key in the restored directory is preserved with the following exceptions:</span></span>

    -   <span data-ttu-id="7d16a-165">Se la sottochiave nell'hive esistente contiene un valore denominato "Start" e la sottochiave nel ripristino non lo è.</span><span class="sxs-lookup"><span data-stu-id="7d16a-165">If the subkey in the existing hive contains a value named "start", and the subkey in the restored does not.</span></span>
    -   <span data-ttu-id="7d16a-166">Se la sottochiave nell'hive esistente e ripristinato contiene un valore denominato "Start" e il relativo valore numerico nell'hive esistente è minore.</span><span class="sxs-lookup"><span data-stu-id="7d16a-166">If the subkey in both the existing and restored hive contain a value named "start", and its numeric value in the existing hive is less.</span></span>

    <span data-ttu-id="7d16a-167">Il valore "Start" nel registro di sistema specifica quando un servizio o un driver si avvierà e può avere un valore numerico compreso tra 0-4.</span><span class="sxs-lookup"><span data-stu-id="7d16a-167">The "start" value in the registry specifies when a service or driver will start and can have a numeric value from 0-4.</span></span> <span data-ttu-id="7d16a-168">Più basso è il valore, prima nel processo di avvio il servizio inizierà.</span><span class="sxs-lookup"><span data-stu-id="7d16a-168">The lower the value, the sooner in the boot process the service will start.</span></span>

    <span data-ttu-id="7d16a-169">Se questa chiave è presente nella directory esistente e ripristinata, è necessario esaminare il valore della chiave di avvio in ogni hive.</span><span class="sxs-lookup"><span data-stu-id="7d16a-169">If this key exists in both the existing and the restored directory, you must examine the value of the start key in each hive.</span></span> <span data-ttu-id="7d16a-170">Se il valore nell'hive esistente è inferiore al valore della directory ripristinata, è necessario mantenere il valore inferiore.</span><span class="sxs-lookup"><span data-stu-id="7d16a-170">If the value in the existing hive is lower than the value in the restored directory, the lower value must be preserved.</span></span>

    <span data-ttu-id="7d16a-171">Ancora una volta, questa chiave viene usata per determinare se un servizio o un driver deve essere avviato in fase di avvio, in fase di sistema, manualmente, automaticamente o essere disabilitato.</span><span class="sxs-lookup"><span data-stu-id="7d16a-171">Once again, this key is used to determine whether a service or driver is to be started at boot time, at system time, manually, automatically, or be disabled.</span></span> <span data-ttu-id="7d16a-172">Il valore inferiore rappresenta un'ora di inizio precedente.</span><span class="sxs-lookup"><span data-stu-id="7d16a-172">The lower value represents an earlier start time.</span></span> <span data-ttu-id="7d16a-173">L'ora di inizio precedente deve essere applicata al nuovo registro di sistema per assicurarsi che il servizio o i driver vengano avviati correttamente all'avvio successivo.</span><span class="sxs-lookup"><span data-stu-id="7d16a-173">The earlier start time must be applied to the new registry to ensure that the service or drivers are started properly at the next boot.</span></span>

3.  <span data-ttu-id="7d16a-174">Le stringhe chiave il cui carattere di terminazione non è né una barra rovesciata né un asterisco vengono interpretate come valori del registro di sistema da mantenere.</span><span class="sxs-lookup"><span data-stu-id="7d16a-174">Key strings whose termination character is neither a backslash nor an asterisk are interpreted as registry values to be preserved.</span></span>

    <span data-ttu-id="7d16a-175">Ad esempio, la stringa chiave:</span><span class="sxs-lookup"><span data-stu-id="7d16a-175">For example, the key string:</span></span>

    <span data-ttu-id="7d16a-176">**HKEY \_ Local \_ computer \\ System \\ CurrentControlSet \\ Control \\ Session Manager \\ PendingFileRenameOperations**</span><span class="sxs-lookup"><span data-stu-id="7d16a-176">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\PendingFileRenameOperations**</span></span>

    <span data-ttu-id="7d16a-177">Il meccanismo mediante il quale è possibile mantenere le chiavi a livello di codice comporta l'API del registro di sistema Win32.</span><span class="sxs-lookup"><span data-stu-id="7d16a-177">The mechanism by which keys can be preserved programmatically involves the Win32 registry API.</span></span> <span data-ttu-id="7d16a-178">Un algoritmo, ad esempio, è enumerato di seguito:</span><span class="sxs-lookup"><span data-stu-id="7d16a-178">For example, one algorithm is enumerated below:</span></span>

    1.  <span data-ttu-id="7d16a-179">Ripristinare il file hive di sistema di cui è stato eseguito il backup in un file.</span><span class="sxs-lookup"><span data-stu-id="7d16a-179">Restore the backed-up system hive file to a file.</span></span> <span data-ttu-id="7d16a-180">Per questo esempio, lasciare che il nome sia System. reg.</span><span class="sxs-lookup"><span data-stu-id="7d16a-180">For this example, let the name be System.reg.</span></span>
    2.  <span data-ttu-id="7d16a-181">Usare **RegLoadKey** per caricare System. reg nel **\_ \_ computer locale HKEY** con un nome temporaneo.</span><span class="sxs-lookup"><span data-stu-id="7d16a-181">Use **RegLoadKey** to load System.reg into **HKEY\_LOCAL\_MACHINE** under a temporary name.</span></span> <span data-ttu-id="7d16a-182">Ad esempio, un nome di questo tipo potrebbe essere</span><span class="sxs-lookup"><span data-stu-id="7d16a-182">For example, one such name might be</span></span>

        <span data-ttu-id="7d16a-183">**\_ \_ sistema TMP del computer locale \\ HKEY \_**</span><span class="sxs-lookup"><span data-stu-id="7d16a-183">**HKEY\_LOCAL\_MACHINE\\TMP\_SYSTEM**</span></span>

    3.  <span data-ttu-id="7d16a-184">Enumerare i valori nella sottochiave **KeysNotToRestore** da entrambe le copie del registro di sistema e creare un superset degli elenchi.</span><span class="sxs-lookup"><span data-stu-id="7d16a-184">Enumerate the values in the **KeysNotToRestore** subkey from both of the registry copies and create a superset of the lists.</span></span> <span data-ttu-id="7d16a-185">Copia ogni chiave di questo elemento dalla esistente</span><span class="sxs-lookup"><span data-stu-id="7d16a-185">Copy each such key from the existing</span></span>

        <span data-ttu-id="7d16a-186">**\_sistema del \_ computer \\ locale HKEY**</span><span class="sxs-lookup"><span data-stu-id="7d16a-186">**HKEY\_LOCAL\_MACHINE\\SYSTEM**</span></span>

        <span data-ttu-id="7d16a-187">chiave in</span><span class="sxs-lookup"><span data-stu-id="7d16a-187">key into the</span></span>

        <span data-ttu-id="7d16a-188">**\_ \_ sistema TMP del computer locale \\ HKEY \_**</span><span class="sxs-lookup"><span data-stu-id="7d16a-188">**HKEY\_LOCAL\_MACHINE\\TMP\_SYSTEM**</span></span>

        <span data-ttu-id="7d16a-189">chiave in base alla semantica descritta in precedenza.</span><span class="sxs-lookup"><span data-stu-id="7d16a-189">key according to the semantics described above.</span></span>

    4.  <span data-ttu-id="7d16a-190">Al termine, usare i  &  punti di ingresso **RegUnLoadKey** di RegFlushKey ha per salvare il</span><span class="sxs-lookup"><span data-stu-id="7d16a-190">When complete use the **RegFlushKey** & **RegUnloadKey** entry points to save the</span></span>

        <span data-ttu-id="7d16a-191">**\_ \_ sistema TMP del computer locale \\ HKEY \_**</span><span class="sxs-lookup"><span data-stu-id="7d16a-191">**HKEY\_LOCAL\_MACHINE\\TMP\_SYSTEM**</span></span>

        <span data-ttu-id="7d16a-192">tornare alla chiave System. reg.</span><span class="sxs-lookup"><span data-stu-id="7d16a-192">key back to System.reg.</span></span>

    5.  <span data-ttu-id="7d16a-193">Infine, usare **RegReplaceKey** per specificare che System. reg sostituisce il</span><span class="sxs-lookup"><span data-stu-id="7d16a-193">Finally, use **RegReplaceKey** to specify that System.reg is to replace the</span></span>

        <span data-ttu-id="7d16a-194">**\_sistema del \_ computer \\ locale HKEY**</span><span class="sxs-lookup"><span data-stu-id="7d16a-194">**HKEY\_LOCAL\_MACHINE\\SYSTEM**</span></span>

        <span data-ttu-id="7d16a-195">file hive, SYSTEM.</span><span class="sxs-lookup"><span data-stu-id="7d16a-195">hive file, SYSTEM.</span></span>

 

 
