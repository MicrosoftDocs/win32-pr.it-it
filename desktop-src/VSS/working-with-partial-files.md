---
description: A volte è utile eseguire il backup e il ripristino solo di sezioni di file. VSS fornisce meccanismi parziali dei file, che, se richiesti dai richiedenti, consentono ai writer di specificare backup e ripristini parziali dei file.
ms.assetid: 02b74a4e-d69f-4eeb-866a-3399598b7035
title: Utilizzo di file parziali
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7194f01df11f6c0e368941e17ef6ab1620b17f67
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106307126"
---
# <a name="working-with-partial-files"></a><span data-ttu-id="4c27b-104">Utilizzo di file parziali</span><span class="sxs-lookup"><span data-stu-id="4c27b-104">Working with Partial Files</span></span>

<span data-ttu-id="4c27b-105">A volte è utile eseguire il backup e il ripristino solo di sezioni di file.</span><span class="sxs-lookup"><span data-stu-id="4c27b-105">It is sometimes useful to back up and restore only sections of files.</span></span> <span data-ttu-id="4c27b-106">VSS fornisce meccanismi [*parziali dei file*](vssgloss-p.md) , che, se richiesti dai richiedenti, consentono ai writer di specificare backup e ripristini parziali dei file.</span><span class="sxs-lookup"><span data-stu-id="4c27b-106">VSS provides [*partial file*](vssgloss-p.md) mechanisms, which, if requesters support it, allows writers to specify partial file backups and restores.</span></span>

<span data-ttu-id="4c27b-107">Le operazioni parziali sui file sono spesso più utilizzate per i writer che gestiscono file di dimensioni molto grandi, ma solo una piccola parte del cambiamento tra le operazioni di backup.</span><span class="sxs-lookup"><span data-stu-id="4c27b-107">Partial file operations are frequently of greatest use to writers that maintain very large files, only a small fraction of which change between backup operations.</span></span> <span data-ttu-id="4c27b-108">Questo è il caso, spesso è utile copiare solo la sezione modificata nei supporti di backup.</span><span class="sxs-lookup"><span data-stu-id="4c27b-108">This being the case, it is frequently useful to copy only that section that changed to backup media.</span></span> <span data-ttu-id="4c27b-109">Per questo motivo, le operazioni di file parziali sono in genere, ma non esclusivamente, utilizzate per supportare operazioni di backup e ripristino incrementali.</span><span class="sxs-lookup"><span data-stu-id="4c27b-109">For this reason, partial file operations are typically, but not exclusively, used to support incremental backup and restore operations.</span></span>

<span data-ttu-id="4c27b-110">Se un writer desidera implementare un'operazione di file parziale, USA [**CVssWriter:: IsPartialFileSupportEnabled**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispartialfilesupportenabled) per determinare se il richiedente che sta utilizzando supporta l'operazione.</span><span class="sxs-lookup"><span data-stu-id="4c27b-110">If a writer wants to implement a partial file operation, it uses [**CVssWriter::IsPartialFileSupportEnabled**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispartialfilesupportenabled) to determine whether the requester it is working with supports the operation.</span></span>

<span data-ttu-id="4c27b-111">Se il richiedente supporta operazioni di file parziali e aggiunge il componente che gestisce il file (o il componente che definisce il set di componenti che contiene il file) al documento dei componenti di backup, un writer indica le sezioni del file da salvare, in genere durante la gestione di un evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) o [*PostSnapshot*](vssgloss-p.md) , chiamando [**IVssComponent:: AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span><span class="sxs-lookup"><span data-stu-id="4c27b-111">If the requester supports partial file operations, and if it adds the component that manages the file (or the component that defines the component set that contains the file) to the Backup Components Document, a writer indicates which sections of the file to save (typically while handling a [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) or [*PostSnapshot*](vssgloss-p.md) event) by calling [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span></span>

<span data-ttu-id="4c27b-112">Oltre a un percorso e un nome file, il writer fornisce l'intervallo, le informazioni facoltative sui metadati di [**IVssComponent:: AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span><span class="sxs-lookup"><span data-stu-id="4c27b-112">In addition to a path and file name, the writer supplies the range, optional metadata information to [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span></span>

<span data-ttu-id="4c27b-113">Le informazioni sull'intervallo vengono fornite come una stringa che contiene uno dei seguenti elementi:</span><span class="sxs-lookup"><span data-stu-id="4c27b-113">The range information is provided as a string that contains either of the following:</span></span>

-   <span data-ttu-id="4c27b-114">Coppie di offset nel file di cui eseguire il backup (in byte) e la lunghezza della sezione di cui eseguire il backup (in byte), l'offset e la lunghezza separati da due punti e ogni coppia separata da una virgola, ad esempio \*Offset1 \***:**_length1_*_,_* \* Offset2 \***:**_length2_.</span><span class="sxs-lookup"><span data-stu-id="4c27b-114">Pairs of offsets into the file to be backed up (in bytes) and the length of the section to be backed up (in bytes), the offset and length being separated by a colon, and each pair separated by a comma, for example, *Offset1\***:**_Length1_*_,_\* \*Offset2\***:**_Length2_.</span></span>

    <span data-ttu-id="4c27b-115">Ogni valore è un Integer a 64 bit, in formato esadecimale o decimale, che specifica rispettivamente un offset di byte e la lunghezza in byte.</span><span class="sxs-lookup"><span data-stu-id="4c27b-115">Each value is a 64-bit integer (in either hexadecimal or decimal format) specifying a byte offset and length in bytes, respectively.</span></span>

-   <span data-ttu-id="4c27b-116">Percorso completo, incluso il nome del file, nel sistema corrente di un file di intervalli binari che contiene gli elementi seguenti:</span><span class="sxs-lookup"><span data-stu-id="4c27b-116">The full path, including file name, on the current system of a binary ranges file containing the following:</span></span>
    -   <span data-ttu-id="4c27b-117">Numero (espresso come intero a 64 bit) di intervalli di file distinti contenuti nel file</span><span class="sxs-lookup"><span data-stu-id="4c27b-117">The number (expressed as a 64-bit integer) of distinct file ranges contained in the file</span></span>
    -   <span data-ttu-id="4c27b-118">Ogni intervallo espresso come coppia di interi a 64 bit: il primo membro della coppia che è l'offset nel file di cui viene eseguito il backup (in byte) e il secondo membro è la lunghezza dei dati di cui eseguire il backup (in byte)</span><span class="sxs-lookup"><span data-stu-id="4c27b-118">Each range expressed as a pair of 64-bit integers: the first member of the pair being the offset into the file being backed up (in bytes), and the second member being the length of data to be backed up (in bytes)</span></span>

<span data-ttu-id="4c27b-119">Se un writer utilizza un file di intervalli per specificare un'operazione di file parziale, un richiedente deve garantire che venga eseguito il backup di questo file (anche se il file non è necessariamente parte del set di backup predefinito) o che le informazioni sugli intervalli vengono conservate nel supporto di backup in altro modo.</span><span class="sxs-lookup"><span data-stu-id="4c27b-119">If a writer uses a ranges file to specify a partial file operation, a requester must guarantee that either this file is backed up (even if the file is not necessarily part of the default backup set) or that the ranges information is preserved on the backup media in some other way.</span></span> <span data-ttu-id="4c27b-120">Se non viene eseguito il backup delle informazioni del file degli intervalli, il ripristino del file di backup parziale non sarà possibile.</span><span class="sxs-lookup"><span data-stu-id="4c27b-120">If the ranges file's information is not backed up, restoring the partially backed up file will be impossible.</span></span>

<span data-ttu-id="4c27b-121">Il writer può anche aggiungere una stringa contenente i metadati.</span><span class="sxs-lookup"><span data-stu-id="4c27b-121">The writer can also add a string containing metadata.</span></span> <span data-ttu-id="4c27b-122">Questi metadati possono essere in un formato specifico del writer perché sono destinati a consentire al writer di convalidare eventuali ripristini futuri.</span><span class="sxs-lookup"><span data-stu-id="4c27b-122">This metadata can be in a writer-specific format because it is intended to allow the writer to validate any future restores.</span></span>

<span data-ttu-id="4c27b-123">Con queste informazioni, un richiedente di supporto può eseguire un backup parziale del file.</span><span class="sxs-lookup"><span data-stu-id="4c27b-123">With this information, a supporting requester can perform a partial file backup.</span></span>

<span data-ttu-id="4c27b-124">Si consideri ad esempio un file di grandi dimensioni la cui intestazione (byte 64-512) contiene un numero di record e altre informazioni aggiornate di frequente e i cui dati più recenti si trovano negli ultimi 65536 byte del file, ovvero i byte 0x1239E8577A in 0x1239E7577A.</span><span class="sxs-lookup"><span data-stu-id="4c27b-124">As an example, consider a large file whose header (bytes 64-512) contains a record count and other frequently updated information, and whose most recent data is to be found in the file's last 65536 bytes—bytes 0x1239E8577A to 0x1239E7577A.</span></span>

<span data-ttu-id="4c27b-125">Un writer può specificare un elenco di intervalli come stringa "**64:448, 0x1239E8577A: 65536**".</span><span class="sxs-lookup"><span data-stu-id="4c27b-125">A writer could specify a range list as the string "**64:448,0x1239E8577A:65536**."</span></span>

<span data-ttu-id="4c27b-126">In fase di ripristino e prima di eseguire effettivamente un'operazione di ripristino, un richiedente deve verificare se i file richiedono un supporto file parziale.</span><span class="sxs-lookup"><span data-stu-id="4c27b-126">On restore, and prior to actually performing a restore operation, a requester should check to see if any files require partial file support.</span></span>

<span data-ttu-id="4c27b-127">A tale scopo, il richiedente scorre prima i writer con i componenti archiviati nel documento relativo ai componenti di backup usando [**IVssBackupComponents:: GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) e [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span><span class="sxs-lookup"><span data-stu-id="4c27b-127">To do this, the requester first iterates over the writers with stored components in its Backup Components Document using [**IVssBackupComponents::GetWriterComponentsCount**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponentscount) and [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents).</span></span>

<span data-ttu-id="4c27b-128">L'interfaccia [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) viene quindi utilizzata per restituire le istanze dell'interfaccia [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) che forniscono [**IVssWriterComponentsExt:: getComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) e [**IVssWriterComponentsExt:: GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount), che consentono al richiedente di ottenere istanze di [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="4c27b-128">The [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents) interface is then used to return instances of the [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) interface, which provide [**IVssWriterComponentsExt::GetComponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponent) and [**IVssWriterComponentsExt::GetComponentCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswritercomponents-getcomponentcount), that allow the requester to obtain [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) instances.</span></span>

<span data-ttu-id="4c27b-129">Questo consente a un richiedente di ottenere informazioni sui file parzialmente sottoposti a backup per partecipare a un ripristino usando [**IVssComponent:: GetPartialFileCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount) e [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) per l'istanza di [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corrispondente al componente che gestisce il file (o il componente che definisce il set di componenti che contiene il file).</span><span class="sxs-lookup"><span data-stu-id="4c27b-129">This allows a requester to obtain information about the partially backed up files to participate in a restore by using [**IVssComponent::GetPartialFileCount**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfilecount) and [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) for the instance of [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corresponding to the component that manages the file (or the component that defines the component set that contains the file).</span></span>

<span data-ttu-id="4c27b-130">Se l'operazione relativa al file parziale è stata controllata da un file degli intervalli, il file deve essere ripristinato prima della copia dei dati sul disco.</span><span class="sxs-lookup"><span data-stu-id="4c27b-130">If the partial file operation was controlled by a ranges file, that file should be restored prior to copied data back to disk.</span></span> <span data-ttu-id="4c27b-131">È possibile che il richiedente ricopi il file degli intervalli in una nuova posizione sul disco.</span><span class="sxs-lookup"><span data-stu-id="4c27b-131">It may happen that the requester needed to copy the ranges file back to a new location on disk.</span></span> <span data-ttu-id="4c27b-132">In questo caso, indica che l'operazione è stata eseguita tramite [**IVssBackupComponents:: SetRangesFilePath**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrangesfilepath).</span><span class="sxs-lookup"><span data-stu-id="4c27b-132">In this case, it indicates that it has done so through the [**IVssBackupComponents::SetRangesFilePath**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrangesfilepath).</span></span>

<span data-ttu-id="4c27b-133">Il richiedente procede quindi alla copia dei dati nelle posizioni appropriate nella destinazione di ripristino già presente su disco.</span><span class="sxs-lookup"><span data-stu-id="4c27b-133">The requester then proceeds to copy data into the appropriate locations in the restore destination already on disk.</span></span>

<span data-ttu-id="4c27b-134">Un writer (durante la gestione di un evento [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) ), esaminando [**IVssComponent:: GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus) per i file indicati da [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile), determina se l'operazione di file parziale è stata completata correttamente.</span><span class="sxs-lookup"><span data-stu-id="4c27b-134">A writer (while handling a [**PostRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-postrestore) event), by examining [**IVssComponent::GetFileRestoreStatus**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getfilerestorestatus) for the files indicated by [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile), determines if the partial file operation was successful.</span></span> <span data-ttu-id="4c27b-135">Il writer deve sempre provare a verificare la correttezza del ripristino usando le informazioni di offset ed eventuali metadati inclusi nel documento dei componenti di backup.</span><span class="sxs-lookup"><span data-stu-id="4c27b-135">The writer should always attempt to verify the correctness of this restore using the offset information and any metadata included in the Backup Components Document.</span></span>

<span data-ttu-id="4c27b-136">Se il richiedente deve ripristinare il file degli intervalli in un nuovo percorso, VSS aggiornerà queste informazioni in modo che il percorso restituito da [**IVssComponent:: GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) sia corretto.</span><span class="sxs-lookup"><span data-stu-id="4c27b-136">If the requester has had to restore the ranges file to a new location, VSS will update this information so that the path returned by [**IVssComponent::GetPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpartialfile) is correct.</span></span>

 

 
