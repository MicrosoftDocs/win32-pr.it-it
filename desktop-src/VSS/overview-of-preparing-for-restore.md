---
description: Durante la preparazione per un ripristino, un richiedente usa i documenti dei metadati del writer archiviati insieme al documento relativo ai componenti di backup recuperati per determinare gli elementi da ripristinare e come.
ms.assetid: 36cf188f-fce6-467c-a200-cbd9dc8f31a6
title: Panoramica della preparazione per il ripristino
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: d8b1bc3e429da5be9872e8345fe6da32a5340005
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106310687"
---
# <a name="overview-of-preparing-for-restore"></a>Panoramica della preparazione per il ripristino

Durante la preparazione per un ripristino, un richiedente usa i documenti dei metadati del writer archiviati insieme al documento relativo ai componenti di backup recuperati per determinare gli elementi da ripristinare e come. Per ulteriori informazioni, vedere [Cenni preliminari sull'elaborazione di un ripristino in VSS](overview-of-processing-a-restore-under-vss.md).

Dopo la selezione dei componenti di ripristino candidati, i writer attualmente in esecuzione nel sistema accedono al documento componenti di backup del richiedente. I writer utilizzano questo accesso per indicare come provocare difficoltà minime per l'esecuzione dei servizi a causa del ripristino.

Al termine di questa operazione, il richiedente avrà a disposizione informazioni sufficienti per determinare quali file dovranno essere ripristinati, nonché la posizione e il modo in cui devono essere ripristinati. Per ulteriori informazioni, vedere [generazione di un set di ripristino](generating-a-restore-set.md).

Nella tabella seguente viene illustrata la sequenza di azioni ed eventi necessari per preparare un'operazione di ripristino.



| Azione del richiedente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Evento                                                         | Azione del writer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Recuperare le informazioni dal documento componenti di backup sui componenti [*inclusi in modo esplicito*](vssgloss-e.md) nell'operazione di backup (vedere [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)) esaminare i documenti dei metadati del writer recuperato per ottenere i dettagli relativi ai componenti inclusi in modo esplicito nel backup e tutti i componenti secondari [*inclusi in modo implicito*](vssgloss-i.md) . (Vedere [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata), [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent)).<br/> | nessuno                                                          | nessuno                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Selezionare i componenti e i set di componenti da ripristinare (vedere [**IVssBackupComponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) e [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent).)                                                                                                                                                                                                                                                                                                                                                                                          | nessuno                                                          | nessuno                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Il richiedente consente al writer di aggiornare il documento dei componenti di backup e, facoltativamente, di comunicare eventuali opzioni di ripristino speciali al writer. (Vedere [**IVssBackupComponents:: SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions), [**IVssBackupComponents:: AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)e [**IVssBackupComponents: rerestore:P**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).)                                                                                                                                                                                                                                         | [*PreRestore*](vssgloss-p.md) | Il writer determina la partecipazione al ripristino, prepara i file da ripristinare e, facoltativamente, modifica i componenti di backup del documento, se necessario. (Vedere [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent:: IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore), [**IVssComponent:: GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions), [**IVssComponent:: SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), [**IVssComponent:: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata), [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget).) |
| Il richiedente attende che i writer gestiscano l'evento di [**preripristino**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) con [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync). Deve inoltre verificare lo stato del writer. (Vedere [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).)                                                                                                                                                                                                                                                                                  | nessuno                                                          | nessuno                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |



 

## <a name="requester-actions-during-restore-preparations"></a>Azioni del richiedente durante i preparativi di ripristino

Per determinare quali componenti sono candidati per il ripristino, il richiedente deve eseguire le operazioni seguenti:

-   Stabilire il componente e la struttura del [*set di componenti*](vssgloss-c.md) utilizzata per eseguire il backup.
-   Esaminare la selezione dei componenti [*per il ripristino*](vssgloss-s.md).
-   Usare le linee guida per la selezione (utilizzo[della selezione per il ripristino e i sottocomponenti](working-with-selectability-for-restore-and-subcomponents.md)) per scegliere i componenti da includere.
-   Utilizzare le informazioni sui [*set di file*](vssgloss-f.md) dei componenti per determinare quali file nel supporto di backup devono essere ripristinati.

A tale scopo, il richiedente deve esaminare i componenti [*inclusi in modo esplicito*](vssgloss-e.md) nel documento relativo ai componenti di backup archiviati. Queste informazioni sul componente sono disponibili per Writer per Writer usando [**IVssBackupComponents:: GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents), che restituisce le istanze dell'interfaccia [**IVssWriterComponentsExt**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) , da cui è possibile recuperare sia le informazioni del writer sia le istanze dell'interfaccia [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .

Come indicato altrove ([utilizzo di componenti dal richiedente](use-of-components-by-the-requestor.md)), il documento componenti di backup e l'interfaccia **IVssComponent** non contengono informazioni sufficienti per supportare il backup. Pertanto, il richiedente deve esaminare il documento di metadati del writer archiviato corrispondente usando [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) (vedere [le informazioni di identificazione del writer](writer-metadata-document-contents.md)).

Il numero di componenti gestiti da ogni writer viene restituito da [**IVssExamineWriterMetadata:: GetFileCounts**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getfilecounts). Il richiedente può quindi usare [**IVssExamineWriterMetadata:: getComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) per ottenere un'interfaccia [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) per ogni componente gestito da un writer.

Esaminando la selezione dei componenti [*per*](vssgloss-s.md) i [*percorsi logici*](vssgloss-l.md) e di backup (vedere [utilizzo di selezione e percorsi logici](working-with-selectability-and-logical-paths.md)), un richiedente è in grado di identificare i componenti che definiscono set di componenti della fase di backup (componenti inclusi in modo esplicito) e i membri dei sottocomponenti di tali set (componenti inclusi in modo implicito).

I richiedenti indicano tramite il documento componenti di backup se un componente deve essere ripristinato in modo esplicito, utilizzando [**IVssBackupComponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) o [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent). La scelta del metodo dipenderà dal modo in cui il componente è stato originariamente sottoposto a backup e dalla relativa [*selezione per il ripristino*](vssgloss-s.md). Questi componenti inclusi in modo esplicito per il ripristino designano altri componenti inclusi in modo implicito (vedere [uso della selezione per il ripristino e i sottocomponenti](working-with-selectability-for-restore-and-subcomponents.md) per informazioni dettagliate).

Un richiedente può includere in modo esplicito nessuno dei componenti del writer attualmente in esecuzione per il ripristino usando [**IVssBackupComponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) o [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent). In questo caso, il writer non riceverà alcun evento VSS per il resto dell'operazione di ripristino.

L'utilizzo esplicito di [**IVssBackupComponents:: SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) o [**IVssBackupComponents:: AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) per selezionare un componente di un writer che non è attualmente in esecuzione restituisce un \_ errore VSS E \_ Object \_ non \_ trovato. Per informazioni sul ripristino dei dati di writer mancanti, vedere [ripristini senza partecipazione del writer](restores-without-writer-participation.md) .

Per consentire a un writer di avere informazioni complete su cui agire, le opzioni di ripristino specifiche del writer e l'indicazione di un ripristino incrementale possono essere inviate ai writer dalle chiamate del richiedente a [**IVssBackupComponents:: SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) e [**IVssBackupComponents:: SetAdditionalRestores**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores), rispettivamente.

A questo punto, un richiedente ha completato la preparazione e genera un evento di **Preripristino** chiamando [**IVssBackupComponents::P rerestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), consentendo ai writer di prepararsi per il ripristino effettivo.

## <a name="writer-actions-during-restore-preparations"></a>Azioni del writer durante i preparativi di ripristino

La preparazione del writer per l'operazione di ripristino si verifica quando si gestisce l'evento di [**preripristino**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) con il metodo virtuale [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore). L'implementazione predefinita restituisce semplicemente senza eseguire alcuna azione. È possibile che i writer scelgano di eseguire l'override dell'implementazione predefinita per esercitare un maggiore controllo:

-   Override dei [*metodi di ripristino*](vssgloss-r.md) con [*destinazioni Restore*](vssgloss-r.md)
-   Definizione di [ *destinazioni dirette*](vssgloss-d.md)
-   Creazione di messaggi di errore e dati aggiuntivi
-   Fornire informazioni sul timbro di backup

Il gestore eventi [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) riceve un'istanza di [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), da cui può ottenere le interfacce [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) per i componenti inclusi in modo esplicito nel documento componenti di backup durante il backup.

Informazioni sui sottocomponenti inclusi in modo implicito nelle operazioni di backup e incluse in modo esplicito nei ripristini utilizzando un'istanza di **IVssComponent** corrispondente al componente che ha definito il relativo [*set di componenti*](vssgloss-c.md)di backup.

Il metodo [**IVssComponent:: IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore) viene usato per determinare se deve essere ripristinato un componente incluso in modo esplicito per il backup.

Per determinare se un sottocomponente di backup è stato incluso in modo esplicito nel ripristino, i writer utilizzano [**IVssComponent:: GetRestoreSubcomponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoresubcomponent).

Il writer deve esaminare il [*set di file*](vssgloss-f.md) in ogni componente e determinare se è necessario eseguire azioni per supportare il ripristino. Il writer dovrà valutare se desidera che i file correnti vengano sovrascritti o se sarà necessario ripristinare i nuovi percorsi. Le azioni possono includere quanto segue:

-   Come ottenere e agire su qualsiasi opzione specifica del writer o del richiedente che regola le operazioni di ripristino (vedere [**IVssComponent:: GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions))
-   Chiusura e rendere scrivibile tutti i file attualmente aperti
-   Aggiornamento della destinazione di ripristino, ad esempio per forzare il ripristino in un mapping del percorso alternativo. Vedere [**IVssComponent:: SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget).
-   Comunicazione con il richiedente tramite metadati privati (vedere [**IVssComponent:: SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata))
-   Che indica che un file deve essere ripristinato tramite un nuovo mapping tramite la definizione di [*destinazioni dirette*](vssgloss-d.md) (vedere [**IVssComponent:: AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget))

L'istanza di [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) utilizzata sarà creata dall'inclusione esplicita del componente nel documento componenti di backup durante il backup o dal componente che definisce il set di componenti di backup di cui è membro (vedere [utilizzo della selezione per il ripristino e i sottocomponenti](working-with-selectability-for-restore-and-subcomponents.md)).

 

 
