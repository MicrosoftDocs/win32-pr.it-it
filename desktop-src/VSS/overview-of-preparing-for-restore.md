---
description: Durante la preparazione per un ripristino, un richiedente usa i documenti dei metadati del writer archiviati insieme al proprio documento dei componenti di backup recuperato per determinare cosa deve essere ripristinato e come.
ms.assetid: 36cf188f-fce6-467c-a200-cbd9dc8f31a6
title: Panoramica della preparazione per il ripristino
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fa9748ff3d6602695dfde703b020e10ab05791d5eeb3957d23a1d1a4fcb82cc2
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/11/2021
ms.locfileid: "118998157"
---
# <a name="overview-of-preparing-for-restore"></a>Panoramica della preparazione per il ripristino

Durante la preparazione per un ripristino, un richiedente usa i documenti dei metadati del writer archiviati insieme al proprio documento dei componenti di backup recuperato per determinare cosa deve essere ripristinato e come. Per altre informazioni, vedere [Panoramica dell'elaborazione di un ripristino in VSS.](overview-of-processing-a-restore-under-vss.md)

Dopo la selezione dei componenti candidati di ripristino, i writer attualmente in esecuzione nel sistema accedono al documento Dei componenti di backup del richiedente. I writer usano questo accesso per indicare come causare una difficoltà minima per l'esecuzione dei servizi a causa del ripristino.

Al termine, il richiedente dispone di informazioni sufficienti per determinare quali file dovranno essere ripristinati, nonché dove e come devono essere ripristinati. Per altre informazioni, vedere [Generazione di un set di ripristino.](generating-a-restore-set.md)

La tabella seguente illustra la sequenza di azioni ed eventi necessari per preparare un'operazione di ripristino.



| Azione richiedente                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | Evento                                                         | Azione writer                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Recuperare informazioni dal documento Componenti di backup sui componenti inclusi [*in*](vssgloss-e.md) modo esplicito nell'operazione di backup (vedere [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents)) Esaminare i documenti dei metadati del writer recuperati per ottenere informazioni dettagliate sui componenti inclusi in modo esplicito nel backup ed eventuali sottocomponenti inclusi [*implicitamente.*](vssgloss-i.md) Vedere [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata), [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent).<br/> | Nessuno                                                          | Nessuno                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Selezionare i componenti e i set di componenti da ripristinare (vedere [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) e [**IVssBackupComponents::AddRestoreSubcomponent).**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent)                                                                                                                                                                                                                                                                                                                                                                                          | Nessuno                                                          | Nessuno                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Il richiedente consente al writer di aggiornare il documento dei componenti di backup e può facoltativamente comunicare eventuali opzioni di ripristino speciali al writer. Vedere [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions), [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget)e [**IVssBackupComponents::P restore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore).                                                                                                                                                                                                                                         | [*PreRestore*](vssgloss-p.md) | Il writer determina la partecipazione al ripristino, prepara i file da ripristinare e facoltativamente modifica il documento dei componenti di backup, se necessario. Vedere [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent::IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore), [**IVssComponent::GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions), [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget), [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata), [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget). |
| Il richiedente attende i writer per gestire [**l'evento PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) con [**IVssAsync.**](/windows/desktop/api/Vss/nn-vss-ivssasync) Deve anche verificare lo stato del writer. Vedere [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus).                                                                                                                                                                                                                                                                                  | Nessuno                                                          | Nessuno                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |



 

## <a name="requester-actions-during-restore-preparations"></a>Azioni del richiedente durante la preparazione del ripristino

Per determinare quali componenti sono candidati per il ripristino, il richiedente deve eseguire le operazioni seguenti:

-   Stabilire il componente e la [*struttura del set di*](vssgloss-c.md) componenti usata per eseguire il backup.
-   Esaminare la selezionabilità [*dei componenti per il ripristino*](vssgloss-s.md)di .
-   Usare le linee guida sulla selezionabilità ( Utilizzo della selezionabilità per il ripristino e i[sottocomponenti](working-with-selectability-for-restore-and-subcomponents.md)) per scegliere i componenti da includere.
-   Usare le [*informazioni sul set di file*](vssgloss-f.md) dei componenti per determinare quali file del supporto di backup devono essere ripristinati.

A tale scopo, il richiedente deve esaminare [*i*](vssgloss-e.md) componenti inclusi in modo esplicito nel documento dei componenti di backup archiviati. Queste informazioni sui componenti sono disponibili in scrittura per writer usando [**IVssBackupComponents::GetWriterComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwritercomponents), che restituisce istanze [**dell'interfaccia IVssWriterComponentsExt,**](/windows/win32/api/vsbackup/nl-vsbackup-ivsswritercomponentsext) da cui è possibile recuperare sia le informazioni sul writer che le istanze dell'interfaccia [**IVssComponent.**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent)

Come illustrato altrove [(](use-of-components-by-the-requestor.md)Uso di componenti dal richiedente ), il documento Componenti di backup e l'interfaccia **IVssComponent** non contengono informazioni sufficienti per supportare il backup. Pertanto, il richiedente deve esaminare il documento di metadati del writer archiviato corrispondente usando [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) (vedere Informazioni di identificazione [del writer](writer-metadata-document-contents.md)).

Il numero di componenti gestiti da ogni writer viene restituito da [**IVssExamineWriterMetadata::GetFileCounts**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getfilecounts). Il richiedente può quindi usare [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) per ottenere [**un'interfaccia IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) per ogni componente che un writer gestisce.

Esaminando la selezionabilità dei componenti per il [*backup*](vssgloss-s.md) e i percorsi logici [*(vedere*](vssgloss-l.md) Uso della selezionabilità e dei percorsi logici), [](working-with-selectability-and-logical-paths.md)un richiedente è in grado di identificare i componenti che hanno definito set di componenti in fase di backup (componenti inclusi in modo esplicito) e i membri dei sottocomponenti di tali set (componenti inclusi in modo implicito).

I richiedenti indicano tramite il documento Componenti di backup se un componente deve essere ripristinato in modo esplicito, usando [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) o [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent). La scelta del metodo dipende dal modo in cui il componente è stato originariamente sottoposto a backup e dalla [*sua selezionabilità per il ripristino.*](vssgloss-s.md) Questi componenti inclusi in modo esplicito per il ripristino designano altri componenti inclusi in modo implicito (per informazioni dettagliate, vedere Uso della selezionabilità per il ripristino e [i sottocomponenti).](working-with-selectability-for-restore-and-subcomponents.md)

Un richiedente può includere in modo esplicito nessuno dei componenti del writer attualmente in esecuzione per il ripristino usando [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) o [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent). In questo caso, tale writer non riceverà eventi vss per il resto dell'operazione di ripristino.

L'uso esplicito di [**IVssBackupComponents::SetSelectedForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setselectedforrestore) o [**IVssBackupComponents::AddRestoreSubcomponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addrestoresubcomponent) per selezionare un componente di un writer che non è attualmente in esecuzione restituisce un errore VSS \_ E OBJECT NOT \_ \_ \_ FOUND. Per [informazioni sul ripristino dei](restores-without-writer-participation.md) dati dei writer mancanti, vedere Ripristini senza partecipazione al writer.

Per consentire a un writer di avere informazioni complete su cui intervenire, le opzioni di ripristino specifiche del writer e l'indicazione di un ripristino incrementale possono essere inviate ai writer dalle chiamate del richiedente rispettivamente a [**IVssBackupComponents::SetRestoreOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setrestoreoptions) e [**IVssBackupComponents::SetAdditionalRestores.**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setadditionalrestores)

A questo punto, un richiedente ha completato la preparazione e genera un evento **PreRestore** chiamando [**IVssBackupComponents::P reRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore), consentendo ai writer di prepararsi per il ripristino effettivo.

## <a name="writer-actions-during-restore-preparations"></a>Azioni writer durante le operazioni di preparazione del ripristino

La preparazione del writer per l'operazione di ripristino si verifica quando si gestisce l'evento [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) con il metodo virtuale [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore). L'implementazione predefinita restituisce semplicemente senza eseguire alcuna azione. I writer possono scegliere di eseguire l'override dell'implementazione predefinita per esercitare un maggiore controllo tramite:

-   Override dei [*metodi di ripristino con*](vssgloss-r.md) destinazioni di [*ripristino*](vssgloss-r.md)
-   Definizione di [ *destinazioni dirette*](vssgloss-d.md)
-   Creazione di messaggi di errore e dati aggiuntivi
-   Fornire informazioni sul timbro di backup

Il gestore eventi [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore) riceve un'istanza di [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), da cui può ottenere interfacce [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) per quelli dei relativi componenti inclusi in modo esplicito nel documento Componenti di backup durante il backup.

Informazioni sui sottocomponenti inclusi in modo implicito nelle operazioni di backup e incluse in modo esplicito nei ripristini usando un'istanza di **IVssComponent** corrispondente al componente che ha definito il [*relativo set di componenti di*](vssgloss-c.md)backup.

Il [**metodo IVssComponent::IsSelectedForRestore**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-isselectedforrestore) viene usato per determinare se deve essere ripristinato un componente di backup incluso in modo esplicito.

Per determinare se un sottocomponente di backup è stato incluso in modo esplicito nel ripristino, i writer usano [**IVssComponent::GetRestoreSubcomponent**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoresubcomponent).

Il writer deve esaminare il [*set di file*](vssgloss-f.md) in ogni componente e determinare se è necessario eseguire azioni per supportare il ripristino. Il writer dovrà valutare se vuole che i file correnti verranno sovrascritti o se richiederà il ripristino in nuovi percorsi. Le azioni possono includere quanto segue:

-   Ottenere e agire su qualsiasi opzione specifica del writer o del richiedente che regola le operazioni di ripristino (vedere [**IVssComponent::GetRestoreOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoreoptions))
-   Chiusura e creazione di file scrivibili per tutti i file attualmente aperti
-   Aggiornamento della destinazione di ripristino (ad esempio, per forzare il ripristino in un mapping di percorso alternativo). Vedere [**IVssComponent::SetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoretarget).
-   Comunicazione con il richiedente tramite metadati privati (vedere [**IVssComponent::SetRestoreMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setrestoremetadata))
-   Indica che un file deve essere ripristinato tramite il mapping tramite la definizione delle destinazioni indirizzate [*(vedere*](vssgloss-d.md) [**IVssComponent::AddDirectedTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddirectedtarget))

L'istanza di [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) usata sarà quella creata dall'inclusione esplicita del componente nel documento Componenti di backup durante il backup o quella del componente che definisce il set di componenti di backup di cui era membro (vedere Uso della selezionabilità per il ripristino e i [sottocomponenti](working-with-selectability-for-restore-and-subcomponents.md)).

 

 
