---
description: I richiedenti hanno la responsabilità principale del ciclo di vita di un documento dei componenti di backup.
ms.assetid: 287b7b9a-ac04-4a74-83c1-2cdd4a571ac1
title: Ciclo di vita del documento dei componenti di backup
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a4bcb0263f46466d7be2bc19f3c8809167b2da08
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106318908"
---
# <a name="backup-components-document-life-cycle"></a><span data-ttu-id="d1dde-103">Ciclo di vita del documento dei componenti di backup</span><span class="sxs-lookup"><span data-stu-id="d1dde-103">Backup Components Document Life Cycle</span></span>

<span data-ttu-id="d1dde-104">I richiedenti hanno la responsabilità principale del ciclo di vita di un documento dei componenti di backup.</span><span class="sxs-lookup"><span data-stu-id="d1dde-104">Requesters have primary responsibility for the life cycle of a Backup Components Document.</span></span>

<span data-ttu-id="d1dde-105">Questo controllo viene esercitato da un'istanza dell'oggetto interfaccia [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) restituito da [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents).</span><span class="sxs-lookup"><span data-stu-id="d1dde-105">This control is exercised by an instance of the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface object returned by [**CreateVssBackupComponents**](/windows/desktop/api/VsBackup/nf-vsbackup-createvssbackupcomponents).</span></span>

<span data-ttu-id="d1dde-106">Un richiedente deve inizializzare un documento di componenti di backup prima di eseguire un backup o un ripristino chiamando [**IVssBackupComponents:: InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) o [**IVssBackupComponents:: InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore).</span><span class="sxs-lookup"><span data-stu-id="d1dde-106">A requester must initialize a Backup Components Document prior to a backup or restore by calling [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) or [**IVssBackupComponents::InitializeForRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforrestore).</span></span> <span data-ttu-id="d1dde-107">Il richiedente può inizializzare il documento come vuoto oppure può caricare una copia precedentemente archiviata del documento.</span><span class="sxs-lookup"><span data-stu-id="d1dde-107">The requester can initialize the document as empty, or it can load a previously stored copy of the document.</span></span>

<span data-ttu-id="d1dde-108">Per le operazioni di backup, un documento relativo ai componenti di backup viene in genere inizializzato come vuoto.</span><span class="sxs-lookup"><span data-stu-id="d1dde-108">For backup operations, a Backup Components Document is typically initialized as empty.</span></span> <span data-ttu-id="d1dde-109">I dati verranno compilati con la collaborazione dei writer del sistema nel corso dell'elaborazione del backup.</span><span class="sxs-lookup"><span data-stu-id="d1dde-109">Its data will be filled in with cooperation from the system's writers in the course of processing the backup.</span></span>

<span data-ttu-id="d1dde-110">Per le operazioni di ripristino, un documento relativo ai componenti di backup viene in genere inizializzato da un documento archiviato generato durante il backup iniziale.</span><span class="sxs-lookup"><span data-stu-id="d1dde-110">For restore operations, a Backup Components Document is typically initialized from a stored document generated during the initial backup.</span></span> <span data-ttu-id="d1dde-111">In questo modo il ripristino (insieme all'esame dei documenti dei metadati del writer archiviato) consente di determinare quali dati sono stati inizialmente sottoposti a backup e come devono essere ripristinati.</span><span class="sxs-lookup"><span data-stu-id="d1dde-111">This allows the restore (in conjunction with examination of stored Writer Metadata Documents) to determine what data was initially backed up and how it should be restored.</span></span>

<span data-ttu-id="d1dde-112">Il backup delle [*copie shadow trasportabili*](vssgloss-t.md) è un'eccezione a questa regola.</span><span class="sxs-lookup"><span data-stu-id="d1dde-112">Backing up [*transportable shadow copies*](vssgloss-t.md) is an exception to this rule.</span></span> <span data-ttu-id="d1dde-113">In tal caso, è possibile che una copia shadow sia stata spostata da un sistema (in cui è stata creata insieme al documento componenti di backup iniziale) a un'altra per mezzo della riassegnazione dell'unità logica di un dispositivo di archiviazione condivisa.</span><span class="sxs-lookup"><span data-stu-id="d1dde-113">In this case, a shadow copy could have been moved from one system (where it was created along with the initial Backup Components Document) to another by means of reassigning a shared storage device's logical unit.</span></span> <span data-ttu-id="d1dde-114">Per eseguire il backup in queste circostanze, un richiedente carica lo stato di backup archiviato e procede dal punto in cui il sistema iniziale è stato interrotto.</span><span class="sxs-lookup"><span data-stu-id="d1dde-114">To back up under these circumstances, a requester loads the stored backup state and proceeds from where the initial system left off.</span></span> <span data-ttu-id="d1dde-115">Per ulteriori informazioni, vedere [importazione di volumi con copia shadow trasportabili](importing-transportable-shadow-copied-volumes.md).</span><span class="sxs-lookup"><span data-stu-id="d1dde-115">(For more information, see [Importing Transportable Shadow Copied Volumes](importing-transportable-shadow-copied-volumes.md).)</span></span>

<span data-ttu-id="d1dde-116">Nel corso dell'elaborazione di un backup, il richiedente decide quali componenti copiare effettivamente sulla base dei componenti contrassegnati come [*selezionabili per il backup*](vssgloss-s.md), i [*percorsi logici*](vssgloss-l.md)del componente e la propria logica interna.</span><span class="sxs-lookup"><span data-stu-id="d1dde-116">In the course of processing a backup, the requester decides which components to actually copy on the basis of which components are marked as [*selectable for backup*](vssgloss-s.md), the component's [*logical paths*](vssgloss-l.md), and its own internal logic.</span></span>

<span data-ttu-id="d1dde-117">Alcuni componenti verranno [*inclusi in modo esplicito*](vssgloss-e.md) nell'operazione di backup; le informazioni sul componente verranno aggiunte al documento componenti di backup.</span><span class="sxs-lookup"><span data-stu-id="d1dde-117">Some of the components will be [*explicitly included*](vssgloss-e.md) in the backup operation; information about the component will be added to the Backup Components Document.</span></span> <span data-ttu-id="d1dde-118">Altri verranno [*inclusi in modo implicito*](vssgloss-i.md) nel backup; le informazioni sui componenti aggiunti non verranno aggiunte al documento componenti di backup.</span><span class="sxs-lookup"><span data-stu-id="d1dde-118">Others will be [*implicitly included*](vssgloss-i.md) in the backup; information about the added components will not be added to the Backup Components Document.</span></span>

<span data-ttu-id="d1dde-119">Tutti i componenti non selezionabili di un writer per i componenti di backup senza predecessore selezionabili nel percorso logico e quelli selezionabili per i componenti di backup scelti dal richiedente verranno aggiunti in modo esplicito.</span><span class="sxs-lookup"><span data-stu-id="d1dde-119">All of a writer's nonselectable for backup components without a selectable ancestor in their logical path, and those selectable for backup components the requester chooses, will be added explicitly.</span></span>

<span data-ttu-id="d1dde-120">È possibile aggiungere in modo implicito i componenti non selezionabili e selezionabili per il backup se hanno un predecessore selezionabile nel percorso logico, incluso in modo esplicito nel backup.</span><span class="sxs-lookup"><span data-stu-id="d1dde-120">Both nonselectable and selectable for backup components can be added implicitly if they have a selectable ancestor in their logical path, which is explicitly included in the backup.</span></span> <span data-ttu-id="d1dde-121">Questi componenti ([*sottocomponenti*](vssgloss-s.md)) sono membri dei [*set di componenti*](vssgloss-s.md) definiti dal predecessore selezionabile.</span><span class="sxs-lookup"><span data-stu-id="d1dde-121">These components ([*subcomponents*](vssgloss-s.md)) are members of [*component sets*](vssgloss-s.md) defined by their selectable ancestor.</span></span>

<span data-ttu-id="d1dde-122">Quando si gestiscono le operazioni di ripristino, il richiedente usa la [*selezione per il ripristino*](vssgloss-s.md) anziché la selezione per il backup in combinazione con le informazioni sul percorso logico e la relativa logica interna per decidere quali file ripristinare.</span><span class="sxs-lookup"><span data-stu-id="d1dde-122">When handling restore operations, the requester uses [*selectability for restore*](vssgloss-s.md) instead of selectability for backup in conjunction with logical path information and its own internal logic to decide which files to restore.</span></span>

<span data-ttu-id="d1dde-123">Se un componente che è stato aggiunto in modo implicito al backup è ora aggiunto in modo esplicito al ripristino, il richiedente aggiornerà il documento relativo ai componenti di backup con le informazioni di tale componente.</span><span class="sxs-lookup"><span data-stu-id="d1dde-123">If a component that had been implicitly added to the backup is now to be explicitly added to the restore, the requester will update the Backup Components Document with that component's information.</span></span>

<span data-ttu-id="d1dde-124">Le informazioni sui componenti archiviati sono disponibili sia per i richiedenti che per i writer tramite istanze dell'interfaccia [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) .</span><span class="sxs-lookup"><span data-stu-id="d1dde-124">Information about the stored components is available both to requesters and writers through instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface.</span></span>

<span data-ttu-id="d1dde-125">Tramite le interfacce [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) che i writer possono eseguire query e (fino alla fine di eventi [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) e [**PostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) ) modificare le informazioni nel documento componenti di backup.</span><span class="sxs-lookup"><span data-stu-id="d1dde-125">It is through [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interfaces that writers can query and (until the end of [**PostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) and [**PostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) events) modify information in the Backup Components Document.</span></span>

<span data-ttu-id="d1dde-126">Quando viene chiamato il gestore eventi [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter:: OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot), [**CVssWriter:: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete)o [**CVssWriter:: OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) , un writer riceve un'istanza di un'interfaccia [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) .</span><span class="sxs-lookup"><span data-stu-id="d1dde-126">When the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter::OnPreRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onprerestore), [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot), [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete), or [**CVssWriter::OnPostRestore**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostrestore) event handler is called, a writer receives an instance of an [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface.</span></span>

<span data-ttu-id="d1dde-127">Si noti che al momento della generazione dell'evento [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) , il documento componenti di backup viene reso di sola lettura e pertanto [**CVssWriter:: OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) non può utilizzare l'interfaccia [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) per modificarlo.</span><span class="sxs-lookup"><span data-stu-id="d1dde-127">Note that upon generation of the [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event, the Backup Components Document is made read-only, and therefore [**CVssWriter::OnBackupComplete**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupcomplete) cannot use the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to modify it.</span></span>

<span data-ttu-id="d1dde-128">Dall'interfaccia [**IVSSWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) , il writer può recuperare le istanze dell'interfaccia [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) che consentiranno all'IT di accedere a tutti i componenti aggiunti in modo esplicito al documento dei componenti di backup e di modificarne lo stato.</span><span class="sxs-lookup"><span data-stu-id="d1dde-128">From the [**IVSSWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface, the writer can retrieve instances of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface that will allow it to access all of its components explicitly added to the Backup Components Document and to alter their state.</span></span> <span data-ttu-id="d1dde-129">Per ulteriori informazioni, vedere [Cenni preliminari sull'elaborazione di un backup in VSS](overview-of-processing-a-backup-under-vss.md) e [Panoramica sull'elaborazione di un ripristino in VSS](overview-of-processing-a-restore-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="d1dde-129">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md) and [Overview of Processing a Restore Under VSS](overview-of-processing-a-restore-under-vss.md).</span></span>

<span data-ttu-id="d1dde-130">I documenti dei componenti di backup vengono rimossi dalla memoria quando viene rilasciata l'interfaccia [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) e devono essere archiviati con [**IVssBackupComponents:: saveasxml**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml)o tutte le relative informazioni andranno perse.</span><span class="sxs-lookup"><span data-stu-id="d1dde-130">Backup Components Documents are removed from memory when the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) interface is released, and must be stored using [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml), or all their information will be lost.</span></span>

<span data-ttu-id="d1dde-131">Inoltre, quando un documento [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) viene rilasciato correttamente, viene generato un evento [**BackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) e vengono eliminate le [*copie shadow di rilascio automatico*](vssgloss-a.md) .</span><span class="sxs-lookup"><span data-stu-id="d1dde-131">In addition, when an [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) document is properly released, a [**BackupShutdown**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onbackupshutdown) event is generated and [*auto-release shadow copies*](vssgloss-a.md) are deleted.</span></span>

 

 



