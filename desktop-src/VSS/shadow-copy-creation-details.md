---
description: In generale, la modalità di creazione di una copia shadow dipende dal tipo di copia shadow da creare, dal relativo contesto e dal ruolo associato ai writer nell'operazione di copia shadow.
ms.assetid: eab3b39b-dfa7-43ea-adba-cd0b495c373f
title: Dettagli creazione copia shadow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8b9281b899593ca0751f1d549aed60305041b18c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106310664"
---
# <a name="shadow-copy-creation-details"></a><span data-ttu-id="73e32-103">Dettagli creazione copia shadow</span><span class="sxs-lookup"><span data-stu-id="73e32-103">Shadow Copy Creation Details</span></span>

<span data-ttu-id="73e32-104">In generale, la modalità di creazione di una copia shadow dipende dal tipo di copia shadow da creare, dal relativo contesto e dal ruolo associato ai writer nell'operazione di copia shadow.</span><span class="sxs-lookup"><span data-stu-id="73e32-104">In general, how a shadow copy is created depends on the type of shadow copy to be created, its context, and the role accorded to writers in the shadow copy operation.</span></span> <span data-ttu-id="73e32-105">Per ulteriori informazioni, vedere [configurazioni del contesto per copie shadow](shadow-copy-context-configurations.md) .</span><span class="sxs-lookup"><span data-stu-id="73e32-105">(See [Shadow Copy Context Configurations](shadow-copy-context-configurations.md) for more information.)</span></span>

<span data-ttu-id="73e32-106">Il contesto della copia shadow viene impostato chiamando il metodo [**IVssBackupComponents:: secontext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) .</span><span class="sxs-lookup"><span data-stu-id="73e32-106">The shadow copy context is set by calling the [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) method.</span></span> <span data-ttu-id="73e32-107">Prima di chiamare il metodo [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) per creare una copia shadow, i richiedenti devono chiamare i metodi [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) nell'ordine specificato nelle sezioni riportate di seguito.</span><span class="sxs-lookup"><span data-stu-id="73e32-107">Before calling the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) method to create a shadow copy, requesters must call the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) methods in the order specified in the following sections.</span></span>

## <a name="prerequisites-for-all-shadow-copies"></a><span data-ttu-id="73e32-108">Prerequisiti per tutte le copie shadow</span><span class="sxs-lookup"><span data-stu-id="73e32-108">Prerequisites for All Shadow Copies</span></span>

<span data-ttu-id="73e32-109">Indipendentemente dal livello di partecipazione del writer, per la creazione di qualsiasi copia shadow sarà sempre necessario inizializzare il richiedente con le chiamate a [**IVssBackupComponents:: InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) e [**IVssBackupComponents:: StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset).</span><span class="sxs-lookup"><span data-stu-id="73e32-109">Regardless of the level of writer participation, the creation of any shadow copy will always require the requestor be initialized with calls to [**IVssBackupComponents::InitializeForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-initializeforbackup) and [**IVssBackupComponents::StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset).</span></span>

<span data-ttu-id="73e32-110">Se questa chiamata non viene eseguita, il metodo [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) restituirà un errore.</span><span class="sxs-lookup"><span data-stu-id="73e32-110">If this call is not made, the [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) method will return an error.</span></span>

## <a name="shadow-copies-with-writer-participation"></a><span data-ttu-id="73e32-111">Copie shadow con partecipazione del writer</span><span class="sxs-lookup"><span data-stu-id="73e32-111">Shadow Copies with Writer Participation</span></span>

<span data-ttu-id="73e32-112">Se il contesto della copia shadow specifica la partecipazione del writer (ovvero, [**IVssBackupComponents:: secontext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) viene chiamato con il **\_ \_ backup VSS CTX** o il **rollback dell' \_ \_ app \_ VSS CTX**):</span><span class="sxs-lookup"><span data-stu-id="73e32-112">If the shadow copy context specifies writer participation (that is, [**IVssBackupComponents::SetContext**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setcontext) is called with **VSS\_CTX\_BACKUP**, or **VSS\_CTX\_APP\_ROLLBACK**):</span></span>

-   <span data-ttu-id="73e32-113">I richiedenti devono chiamare sempre [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) quando il contesto della copia shadow supporta la partecipazione del writer.</span><span class="sxs-lookup"><span data-stu-id="73e32-113">Requesters must always call [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata) when the shadow copy context supports writer participation.</span></span> <span data-ttu-id="73e32-114">Se il contesto della copia shadow supporta la partecipazione del writer e **IVssBackupComponents:: GatherWriterMetadata** non viene chiamato prima di [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), viene restituito un errore.</span><span class="sxs-lookup"><span data-stu-id="73e32-114">If the shadow copy context supports writer participation and **IVssBackupComponents::GatherWriterMetadata** is not called prior to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), an error will be returned.</span></span>
-   <span data-ttu-id="73e32-115">Se un richiedente desidera selezionare componenti writer specifici, deve chiamare [**IVssBackupComponents:: AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) prima di chiamare [**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) per creare il set di copie shadow.</span><span class="sxs-lookup"><span data-stu-id="73e32-115">If a requester wants to select specific writer components, it must call [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent) before calling [**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) to create the shadow copy set.</span></span>
-   <span data-ttu-id="73e32-116">È necessario chiamare [**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) per creare il set di copie shadow.</span><span class="sxs-lookup"><span data-stu-id="73e32-116">[**StartSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-startsnapshotset) must be called to create the shadow copy set.</span></span>
-   <span data-ttu-id="73e32-117">I richiedenti possono aggiungere uno o più volumi al set di copie shadow chiamando [**AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="73e32-117">Requesters may add one or more volumes to the shadow copy set by calling [**AddToSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addtosnapshotset).</span></span> <span data-ttu-id="73e32-118">Alcuni componenti del writer non possono specificare alcun volume interessato.</span><span class="sxs-lookup"><span data-stu-id="73e32-118">Some writer components may not specify any affected volumes.</span></span> <span data-ttu-id="73e32-119">In questo caso è accettabile che un set di snapshot sia vuoto, ovvero che non contenga volumi.</span><span class="sxs-lookup"><span data-stu-id="73e32-119">In this case, it is acceptable for a snapshot set to be empty (that is, to contain no volumes).</span></span>
-   <span data-ttu-id="73e32-120">Per garantire la coerenza dei metadati del writer, è necessario che un richiedente chiami sempre [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) anche se non è selezionato alcun componente.</span><span class="sxs-lookup"><span data-stu-id="73e32-120">To guarantee the consistency of writer metadata, a requester should always call [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) even if no components are selected.</span></span> <span data-ttu-id="73e32-121">In questo modo VSS genera un evento **PrepareForBackup** , in cui VSS chiama il metodo [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) per ogni writer partecipante.</span><span class="sxs-lookup"><span data-stu-id="73e32-121">This causes VSS to generate a **PrepareForBackup** event, in which VSS calls the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) method for each participating writer.</span></span>
-   <span data-ttu-id="73e32-122">VSS genera [*PrepareForSnapshot*](vssgloss-p.md) e [*blocca*](vssgloss-f.md) gli eventi prima di creare la copia shadow in risposta a [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="73e32-122">VSS will generate [*PrepareForSnapshot*](vssgloss-p.md) and [*Freeze*](vssgloss-f.md) events before creating the shadow copy in response to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="73e32-123">I writer gestiranno gli eventi con [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) e [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze).</span><span class="sxs-lookup"><span data-stu-id="73e32-123">Writers will handle the events with [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) and [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze).</span></span>
-   <span data-ttu-id="73e32-124">VSS genera eventi di [*sblocco*](vssgloss-t.md) e post- [*snapshot*](vssgloss-p.md) dopo la creazione di una copia shadow in risposta a [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="73e32-124">VSS will generate [*Thaw*](vssgloss-t.md) events and [*PostSnapshot*](vssgloss-p.md) events after creating a shadow copy in response to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span> <span data-ttu-id="73e32-125">I writer gestiranno gli eventi con [**CVssWriter:: Onscongelate**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) e [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot).</span><span class="sxs-lookup"><span data-stu-id="73e32-125">Writers will handle the events with [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) and [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot).</span></span>

## <a name="shadow-copies-without-writer-participation"></a><span data-ttu-id="73e32-126">Copie shadow senza partecipazione del writer</span><span class="sxs-lookup"><span data-stu-id="73e32-126">Shadow Copies without Writer Participation</span></span>

<span data-ttu-id="73e32-127">La creazione di copie shadow senza partecipazione del writer è sconsigliata per le applicazioni di backup standard. vedere [backup senza partecipazione al writer](backups-without-writer-participation.md).</span><span class="sxs-lookup"><span data-stu-id="73e32-127">Creating shadow copies without writer participation is discouraged for standard backup applications (see [Backups without Writer Participation](backups-without-writer-participation.md)).</span></span>

<span data-ttu-id="73e32-128">Sono disponibili usi, ad esempio backup veloci di un disco per fornire una rete di protezione contro il danneggiamento accidentale dei file, che può essere eseguito senza una partecipazione esplicita del writer.</span><span class="sxs-lookup"><span data-stu-id="73e32-128">There are uses, such as fast backups of a disk to provide a safety net against accidental file corruption, which can be conducted without explicit writer participation.</span></span> <span data-ttu-id="73e32-129">Una copia shadow di questo tipo avrà un contesto di **\_ backup della \_ \_ condivisione file \_ VSS CTX** o del **\_ \_ \_ rollback del Server VSS CTX**.</span><span class="sxs-lookup"><span data-stu-id="73e32-129">Such a shadow copy would have a context of either **VSS\_CTX\_FILE\_SHARE\_BACKUP** or **VSS\_CTX\_NAS\_ROLLBACK**.</span></span>

<span data-ttu-id="73e32-130">Per questo tipo di copia shadow, tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="73e32-130">For this type of shadow copy, note the following:</span></span>

-   <span data-ttu-id="73e32-131">I richiedenti devono comunque chiamare i metodi richiesti elencati in [prerequisiti per tutte le copie shadow](#prerequisites-for-all-shadow-copies).</span><span class="sxs-lookup"><span data-stu-id="73e32-131">Requesters must still call the required methods listed in [Prerequisites for All Shadow Copies](#prerequisites-for-all-shadow-copies).</span></span>
-   <span data-ttu-id="73e32-132">I richiedenti possono chiamare [**IVssBackupComponents:: GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), ma questa operazione non è obbligatoria.</span><span class="sxs-lookup"><span data-stu-id="73e32-132">Requesters may call [**IVssBackupComponents::GatherWriterMetadata**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwritermetadata), but this is not required.</span></span>
-   <span data-ttu-id="73e32-133">Se i richiedenti chiamano [**IVssBackupComponents:: AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent), [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)o [**IVssBackupComponents:: BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete), verrà restituito un errore.</span><span class="sxs-lookup"><span data-stu-id="73e32-133">If requesters call [**IVssBackupComponents::AddComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addcomponent), [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup), or [**IVssBackupComponents::BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete), an error will be returned.</span></span>
-   <span data-ttu-id="73e32-134">I provider non genereranno eventi [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*scongelate*](vssgloss-t.md)o [*PostSnapshot*](vssgloss-p.md) per questo tipo di copia shadow.</span><span class="sxs-lookup"><span data-stu-id="73e32-134">Providers will not generate [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*Thaw*](vssgloss-t.md), or [*PostSnapshot*](vssgloss-p.md) events for this type of shadow copy.</span></span>

 

 



