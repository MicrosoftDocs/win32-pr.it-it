---
description: Le attività di pre-backup in VSS sono incentrate sulla creazione di una copia shadow dei volumi contenenti i dati per il backup.
ms.assetid: e6b082af-719b-4426-8217-0fc940f5884d
title: Panoramica delle attività di pre-backup
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 709345b8aa0421699efe26ad2901cc497b7d4ac0
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106310688"
---
# <a name="overview-of-pre-backup-tasks"></a><span data-ttu-id="4c40d-103">Panoramica delle attività di pre-backup</span><span class="sxs-lookup"><span data-stu-id="4c40d-103">Overview of Pre-Backup Tasks</span></span>

<span data-ttu-id="4c40d-104">Le attività di pre-backup in VSS sono incentrate sulla creazione di una copia shadow dei volumi contenenti i dati per il backup.</span><span class="sxs-lookup"><span data-stu-id="4c40d-104">Pre-backup tasks under VSS are focused on creating a shadow copy of the volumes containing data for backup.</span></span> <span data-ttu-id="4c40d-105">L'applicazione di backup salverà i dati della copia shadow, non del volume effettivo.</span><span class="sxs-lookup"><span data-stu-id="4c40d-105">The backup application will save data from the shadow copy, not the actual volume.</span></span> <span data-ttu-id="4c40d-106">Per ulteriori informazioni, vedere [Cenni preliminari sull'elaborazione di un backup in VSS](overview-of-processing-a-backup-under-vss.md).</span><span class="sxs-lookup"><span data-stu-id="4c40d-106">For more information, see [Overview of Processing a Backup Under VSS](overview-of-processing-a-backup-under-vss.md).</span></span>

<span data-ttu-id="4c40d-107">I richiedenti in genere attendono che i writer siano pronti per il backup e creino la copia shadow.</span><span class="sxs-lookup"><span data-stu-id="4c40d-107">Requesters typically wait for writers to prepare for backup and creating the shadow copy.</span></span> <span data-ttu-id="4c40d-108">Il writer deve determinare se è necessario partecipare al backup e, in caso contrario, configurarne i file e in modo che sia pronto per il backup e la copia shadow.</span><span class="sxs-lookup"><span data-stu-id="4c40d-108">The writer must determine if it is to participate in the backup and, if it is, configure its files and itself to be ready for backup and shadow copy.</span></span> <span data-ttu-id="4c40d-109">Nella tabella seguente viene illustrata la sequenza di azioni ed eventi necessari per preparare un'operazione di backup.</span><span class="sxs-lookup"><span data-stu-id="4c40d-109">The following table shows the sequence of actions and events that are required to prepare for a backup operation.</span></span>



| <span data-ttu-id="4c40d-110">Azione del richiedente</span><span class="sxs-lookup"><span data-stu-id="4c40d-110">Requester action</span></span>                                                                                                                                                                                                                                                                                                            | <span data-ttu-id="4c40d-111">Evento</span><span class="sxs-lookup"><span data-stu-id="4c40d-111">Event</span></span>                                                                      | <span data-ttu-id="4c40d-112">Azione del writer</span><span class="sxs-lookup"><span data-stu-id="4c40d-112">Writer action</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="4c40d-113">Il richiedente può impostare le opzioni di backup (vedere [**IVssBackupComponents:: SetBackupOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions))</span><span class="sxs-lookup"><span data-stu-id="4c40d-113">The requester can set backup options (see [**IVssBackupComponents::SetBackupOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions))</span></span>                                                                                                                                                                                          | <span data-ttu-id="4c40d-114">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-114">None</span></span>                                                                       | <span data-ttu-id="4c40d-115">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-115">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="4c40d-116">Supportare operazioni di backup incrementali e differenziali esaminando tutti gli indicatori di backup archiviati (vedere [**IVssComponent:: GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp), [**IVssBackupComponents:: SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp))</span><span class="sxs-lookup"><span data-stu-id="4c40d-116">Support incremental and differential backup operations by examining any stored backup stamps (see [**IVssComponent::GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp), [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp))</span></span>                                               | <span data-ttu-id="4c40d-117">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-117">None</span></span>                                                                       | <span data-ttu-id="4c40d-118">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-118">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="4c40d-119">Inviare una notifica ai writer per preparare un'operazione di backup usando [ **IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)</span><span class="sxs-lookup"><span data-stu-id="4c40d-119">Notify writers to prepare for a backup operation using [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup)</span></span>                                                                                                                                                                              | [<span data-ttu-id="4c40d-120">*PrepareForBackup*</span><span class="sxs-lookup"><span data-stu-id="4c40d-120">*PrepareForBackup*</span></span>](vssgloss-p.md)  | <span data-ttu-id="4c40d-121">Le preparazioni del writer includono determinare se è necessario eseguire il backup dei file, se il writer parteciperà al blocco della copia shadow, nonché creare metadati specifici del writer (vedere [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter:: IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected), [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) [**, IVssComponent,**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) [**IVssComponent:: GetBackupOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupoptions), [**CVssWriter:: AreComponentsSelected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected), [**IVssComponent:: SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata)e [**IVssComponent:: GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="4c40d-121">Writer preparations include determining if files are to be backed up, whether the writer will participate in the shadow copy freeze, as well as creating writer-specific metadata (see [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup), [**CVssWriter::IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected), [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents), [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent), [**IVssComponent::GetBackupOptions**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupoptions), [**CVssWriter::AreComponentsSelected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected), [**IVssComponent::SetBackupMetadata**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupmetadata), and [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span> |
| <span data-ttu-id="4c40d-122">Il richiedente attende la configurazione dei writer per il backup mediante [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span><span class="sxs-lookup"><span data-stu-id="4c40d-122">The requester waits for writers to set up for backup using [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync).</span></span> <span data-ttu-id="4c40d-123">Deve inoltre verificare lo stato del writer (vedere [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus))</span><span class="sxs-lookup"><span data-stu-id="4c40d-123">It should also verify writer status (see [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus))</span></span>     | <span data-ttu-id="4c40d-124">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-124">None</span></span>                                                                       | <span data-ttu-id="4c40d-125">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-125">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="4c40d-126">Il richiedente richiede una copia shadow usando [ **IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)</span><span class="sxs-lookup"><span data-stu-id="4c40d-126">Requester requests a shadow copy using [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset)</span></span>                                                                                                                                                                                                    | <span data-ttu-id="4c40d-127">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-127">None</span></span>                                                                       | <span data-ttu-id="4c40d-128">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-128">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| <span data-ttu-id="4c40d-129">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-129">None</span></span>                                                                                                                                                                                                                                                                                                                        | [<span data-ttu-id="4c40d-130">*PrepareForSnapshot*</span><span class="sxs-lookup"><span data-stu-id="4c40d-130">*PrepareForSnapshot*</span></span>](vssgloss-p.md) | <span data-ttu-id="4c40d-131">[**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot): inserire il writer in uno stato pronto per la copia shadow.</span><span class="sxs-lookup"><span data-stu-id="4c40d-131">[**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot): Put the writer into a shadow copy ready state.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| <span data-ttu-id="4c40d-132">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-132">None</span></span>                                                                                                                                                                                                                                                                                                                        | [<span data-ttu-id="4c40d-133">*Freeze*</span><span class="sxs-lookup"><span data-stu-id="4c40d-133">*Freeze*</span></span>](vssgloss-f.md)                      | <span data-ttu-id="4c40d-134">[**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze): installazione finale prima della copia shadow.</span><span class="sxs-lookup"><span data-stu-id="4c40d-134">[**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze): Final setup before the shadow copy.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| <span data-ttu-id="4c40d-135">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-135">None</span></span>                                                                                                                                                                                                                                                                                                                        | [<span data-ttu-id="4c40d-136">*Sblocca*</span><span class="sxs-lookup"><span data-stu-id="4c40d-136">*Thaw*</span></span>](vssgloss-t.md)                          | <span data-ttu-id="4c40d-137">[**CVssWriter:: Onscongelate**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw): è possibile riprendere il normale funzionamento (incluse le operazioni di I/O).</span><span class="sxs-lookup"><span data-stu-id="4c40d-137">[**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw): Normal functioning (including I/O) can resume.</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <span data-ttu-id="4c40d-138">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-138">None</span></span>                                                                                                                                                                                                                                                                                                                        | [<span data-ttu-id="4c40d-139">*PostSnapshot*</span><span class="sxs-lookup"><span data-stu-id="4c40d-139">*PostSnapshot*</span></span>](vssgloss-p.md)          | <span data-ttu-id="4c40d-140">[**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot): pulizia finale dei preparativi per le copie shadow.</span><span class="sxs-lookup"><span data-stu-id="4c40d-140">[**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot): Final clean ups of shadow copy preparations.</span></span> <span data-ttu-id="4c40d-141">Vedere [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) e [**IVssComponent:: SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="4c40d-141">See [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime) and [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span></span><br/>                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span data-ttu-id="4c40d-142">Il richiedente attende il completamento della copia shadow con: [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync), deve anche verificare lo stato del writer (vedere [**IVssBackupComponents:: GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents:: GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)</span><span class="sxs-lookup"><span data-stu-id="4c40d-142">Requester waits for completion of shadow copy using: [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync), it should also verify writer status (see [**IVssBackupComponents::GatherWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-gatherwriterstatus), [**IVssBackupComponents::GetWriterStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getwriterstatus)</span></span><br/> | <span data-ttu-id="4c40d-143">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-143">None</span></span>                                                                       | <span data-ttu-id="4c40d-144">nessuno</span><span class="sxs-lookup"><span data-stu-id="4c40d-144">None</span></span>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |



 

## <a name="requester-pre-backup-tasks"></a><span data-ttu-id="4c40d-145">Attività di pre-backup del richiedente</span><span class="sxs-lookup"><span data-stu-id="4c40d-145">Requester Pre-Backup Tasks</span></span>

<span data-ttu-id="4c40d-146">Inoltre, prima di creare un evento [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) , un richiedente può impostare anche le opzioni di backup per i singoli writer usando [**IVssBackupComponents:: SetBackupOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions) a seconda delle specifiche di ogni writer e se un richiedente ne è a conoscenza.</span><span class="sxs-lookup"><span data-stu-id="4c40d-146">In addition, before creating a [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event, a requester may also set backup options for individual writers using [**IVssBackupComponents::SetBackupOptions**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setbackupoptions) depending on the specifics of each writer and whether a requester is aware of them.</span></span>

<span data-ttu-id="4c40d-147">Per supportare le operazioni incrementali e differenziali, i richiedenti possono a questo punto scegliere di esaminare i componenti per i timestamp dell'operazione di backup precedente (usando [**IVssComponent:: GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp)) e di usare tali informazioni per impostare un timestamp precedente affinché un writer possa elaborare (usando [**IVssBackupComponents:: SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp)).</span><span class="sxs-lookup"><span data-stu-id="4c40d-147">To support incremental and differential operations, requesters may at this point choose to examine components for time stamps of earlier backup operation (using [**IVssComponent::GetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getbackupstamp)) and use that information to set a previous time stamp for a writer to process (using [**IVssBackupComponents::SetPreviousBackupStamp**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setpreviousbackupstamp)).</span></span> <span data-ttu-id="4c40d-148">Per ulteriori informazioni, vedere [backup incrementali e differenziali](incremental-and-differential-backups.md) .</span><span class="sxs-lookup"><span data-stu-id="4c40d-148">See [Incremental and Differential Backups](incremental-and-differential-backups.md) for more information.</span></span>

<span data-ttu-id="4c40d-149">Un richiedente può ora indirizzare i writer del sistema a completare preparazioni di pre-backup e gestire la creazione di una copia shadow.</span><span class="sxs-lookup"><span data-stu-id="4c40d-149">A requester can now direct the system's writers to complete pre-backup preparations and to handle the creation of a shadow copy.</span></span>

<span data-ttu-id="4c40d-150">Innanzitutto, il richiedente genera un evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) chiamando [**IVssBackupComponents::P repareforbackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup).</span><span class="sxs-lookup"><span data-stu-id="4c40d-150">First, the requester generates a [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event by calling [**IVssBackupComponents::PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup).</span></span>

<span data-ttu-id="4c40d-151">Dopo che tutti i writer partecipanti hanno restituito la gestione dell'evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) (che un richiedente determina usando l'istanza dell'interfaccia [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync) restituita da **PrepareForBackup**), il richiedente può avviare la copia shadow chiamando [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), che, durante l'avanzamento, genererà gli eventi [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*scongelate*](vssgloss-t.md)e [*PostSnapshot*](vssgloss-p.md) per la gestione dei writer.</span><span class="sxs-lookup"><span data-stu-id="4c40d-151">After all participating writers return from handling the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event (which a requester determines by using the instance of the [**IVssAsync**](/windows/desktop/api/Vss/nn-vss-ivssasync) interface returned by **PrepareForBackup**), the requester can initiate the shadow copy by calling [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset), which, as it progresses, will generate [*PrepareForSnapshot*](vssgloss-p.md), [*Freeze*](vssgloss-f.md), [*Thaw*](vssgloss-t.md), and [*PostSnapshot*](vssgloss-p.md) events for the writers to handle.</span></span>

<span data-ttu-id="4c40d-152">In alcuni casi è possibile che un richiedente non debba creare una copia shadow.</span><span class="sxs-lookup"><span data-stu-id="4c40d-152">There are some cases where a requester may not need to create a shadow copy.</span></span> <span data-ttu-id="4c40d-153">In particolare, ogni [*set di file*](vssgloss-f.md) gestito da uno dei componenti di un determinato writer dispone di una maschera di backup per la specifica dei file, indicata da un operatore OR bit per bit di valori del [**\_ \_ \_ \_ tipo di backup delle specifiche del file VSS**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) , impostato durante l'evento di [*Identificazione*](vssgloss-i.md) .</span><span class="sxs-lookup"><span data-stu-id="4c40d-153">Specifically, each [*file set*](vssgloss-f.md) managed by one of a given writer's components has a File Specification Backup mask (indicated by a bitwise OR of [**VSS\_FILE\_SPEC\_BACKUP\_TYPE**](/windows/desktop/api/Vss/ne-vss-vss_file_spec_backup_type) values) set during the [*Identify*](vssgloss-i.md) event.</span></span> <span data-ttu-id="4c40d-154">Questa maschera specifica, tra le altre cose, se un set di file richiede la copia shadow del sistema prima che venga eseguito il backup.</span><span class="sxs-lookup"><span data-stu-id="4c40d-154">This mask specifies, among other things, whether a file set requires the system to be shadow copied before its backup is performed.</span></span>

<span data-ttu-id="4c40d-155">Se non è necessario eseguire il backup di alcun set di file in alcun volume, è necessario che sia presente una copia shadow, quindi non è necessario chiamare [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) .</span><span class="sxs-lookup"><span data-stu-id="4c40d-155">If no file sets to be backed up on any volumes require a shadow copy, then [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) need not be called.</span></span>

## <a name="writer-pre-backup-tasks"></a><span data-ttu-id="4c40d-156">Attività di pre-backup del writer</span><span class="sxs-lookup"><span data-stu-id="4c40d-156">Writer Pre-Backup Tasks</span></span>

<span data-ttu-id="4c40d-157">Quando si gestisce l'evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) , VSS chiama il metodo [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) di ogni writer, un metodo virtuale, che per impostazione predefinita restituisce semplicemente true.</span><span class="sxs-lookup"><span data-stu-id="4c40d-157">When handling the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event, VSS will call each writer's [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) method, a virtual method, which by default simply returns true.</span></span>

<span data-ttu-id="4c40d-158">I writer possono eseguire l'override di questa implementazione predefinita e utilizzare la gestione per trovare informazioni sul backup imminente e intraprendere un'azione.</span><span class="sxs-lookup"><span data-stu-id="4c40d-158">Writers can override this default implementation and use the handling to find information about the upcoming backup and take action.</span></span>

<span data-ttu-id="4c40d-159">Un writer può determinare le informazioni sul tipo di operazione di backup contemplate mediante i metodi seguenti:</span><span class="sxs-lookup"><span data-stu-id="4c40d-159">A writer can determine information about the sort of backup operation contemplated by using the following methods:</span></span>

1.  [<span data-ttu-id="4c40d-160">**CVssWriter:: GetBackupType**</span><span class="sxs-lookup"><span data-stu-id="4c40d-160">**CVssWriter::GetBackupType**</span></span>](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-getbackuptype)
2.  [<span data-ttu-id="4c40d-161">**CVssWriter:: IsBootableStateBackedUp**</span><span class="sxs-lookup"><span data-stu-id="4c40d-161">**CVssWriter::IsBootableStateBackedUp**</span></span>](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-isbootablesystemstatebackedup)
3.  [<span data-ttu-id="4c40d-162">**CVssWriter:: AreComponentsSelected**</span><span class="sxs-lookup"><span data-stu-id="4c40d-162">**CVssWriter::AreComponentsSelected**</span></span>](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-arecomponentsselected)

<span data-ttu-id="4c40d-163">Un writer determina se i file gestiti saranno interessati dalla copia shadow usando [**CVssWriter:: IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected).</span><span class="sxs-lookup"><span data-stu-id="4c40d-163">A writer determines if the files it manages will be involved in the shadow copy by using [**CVssWriter::IsPathAffected**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-ispathaffected).</span></span>

<span data-ttu-id="4c40d-164">Più importante, quando VSS chiama il metodo [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) , passa un'istanza dell'interfaccia [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) , che consente l'accesso diretto tramite l'interfaccia [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) a quelli dei componenti [*inclusi in modo esplicito*](vssgloss-e.md) nel documento relativo ai componenti di backup del richiedente.</span><span class="sxs-lookup"><span data-stu-id="4c40d-164">More important, when VSS calls the [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) method, it passes in an instance of the [**IVssWriterComponents**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswritercomponents) interface, which allows direct access through the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to those of its components [*explicitly included*](vssgloss-e.md) in the requester's Backup Components Document.</span></span> <span data-ttu-id="4c40d-165">Il writer ha utilizzato le istanze dell'interfaccia **IVssComponent** che definiscono i set di componenti per ottenere l'accesso al componente *incluso in modo implicito* (vedere [selezione e utilizzo delle proprietà del componente](selectability-and-working-with-component-properties.md)).</span><span class="sxs-lookup"><span data-stu-id="4c40d-165">The writer used the instances of the **IVssComponent** interface that define component sets to gain access to its *implicitly included* component (see [Selectability and working with Component Properties](selectability-and-working-with-component-properties.md)).</span></span>

<span data-ttu-id="4c40d-166">Durante la gestione dell'evento [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) , i writer utilizzano l'interfaccia [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) per eseguire operazioni Component-by-Component (o set di componenti per set di componenti), tra cui:</span><span class="sxs-lookup"><span data-stu-id="4c40d-166">During the handling of the [**PrepareForBackup**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prepareforbackup) event, writers use the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface to perform component-by-component (or component set by component set) operations, including:</span></span>

1.  <span data-ttu-id="4c40d-167">Aggiunta di [*file parziali*](vssgloss-p.md) (se supportati) chiamando [**IVssComponent:: AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span><span class="sxs-lookup"><span data-stu-id="4c40d-167">Adding [*partial files*](vssgloss-p.md) (if supported) by calling [**IVssComponent::AddPartialFile**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-addpartialfile).</span></span>
2.  <span data-ttu-id="4c40d-168">Impostazione di tutti i metadati privati che dovranno essere gestiti dal writer per il ripristino.</span><span class="sxs-lookup"><span data-stu-id="4c40d-168">Setting any private metadata that the writer will need to handle the restore.</span></span>
3.  <span data-ttu-id="4c40d-169">Se il writer supporta i backup incrementali e differenziali (vedere [backup incrementali e differenziali](incremental-and-differential-backups.md)), eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="4c40d-169">If the writer supports incremental and differential backups (see [Incremental and Differential Backups](incremental-and-differential-backups.md)), doing the following:</span></span>
    -   <span data-ttu-id="4c40d-170">Verifica degli indicatori di data e ora di backup precedenti chiamando [**IVssComponent:: GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="4c40d-170">Checking for previous backup time stamps by calling [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp).</span></span>
    -   <span data-ttu-id="4c40d-171">Aggiunta di eventuali [*file differenziati*](vssgloss-d.md) necessari chiamando [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).</span><span class="sxs-lookup"><span data-stu-id="4c40d-171">Adding any required [*differenced files*](vssgloss-d.md) by calling [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).</span></span>
    -   <span data-ttu-id="4c40d-172">Se il writer supporta lo schema del **\_ \_ timestamp** del servizio Copia Shadow del volume, aggiunge le stringhe di timestamp nel formato del writer usando [**IVssComponent:: SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="4c40d-172">If the writer supports the **VSS\_BS\_TIMESTAMPED** schema, adding backup time-stamp strings in the writer's own format using [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span></span>
4.  <span data-ttu-id="4c40d-173">Avvio di operazioni asincrone molto dispendiose in termini di tempo, ad esempio la sincronizzazione dei dati su più dischi.</span><span class="sxs-lookup"><span data-stu-id="4c40d-173">Initiating very time-consuming asynchronous operations, such as synchronizing data across multiple disks.</span></span> <span data-ttu-id="4c40d-174">In questo modo il writer continuerà a funzionare durante l'elaborazione dell'operazione, inclusa la gestione di altri eventi VSS.</span><span class="sxs-lookup"><span data-stu-id="4c40d-174">This will allow the writer to continue working while the operation is processed, including handling other VSS events.</span></span> <span data-ttu-id="4c40d-175">Queste operazioni devono terminare prima dell'evento [*Freeze*](vssgloss-f.md) .</span><span class="sxs-lookup"><span data-stu-id="4c40d-175">These operations must terminate before the [*Freeze*](vssgloss-f.md) event.</span></span>

<span data-ttu-id="4c40d-176">La chiamata del richiedente a [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) avvia la copia shadow e genera gli eventi seguenti per la gestione dei writer:</span><span class="sxs-lookup"><span data-stu-id="4c40d-176">The requester's call to [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset) initiates the shadow copy and generates the following events for the writers to handle:</span></span>

-   [<span data-ttu-id="4c40d-177">*PrepareForSnapshot*</span><span class="sxs-lookup"><span data-stu-id="4c40d-177">*PrepareForSnapshot*</span></span>](vssgloss-p.md)
-   [<span data-ttu-id="4c40d-178">*Freeze*</span><span class="sxs-lookup"><span data-stu-id="4c40d-178">*Freeze*</span></span>](vssgloss-f.md)
-   [<span data-ttu-id="4c40d-179">*Sblocca*</span><span class="sxs-lookup"><span data-stu-id="4c40d-179">*Thaw*</span></span>](vssgloss-t.md)
-   [<span data-ttu-id="4c40d-180">*PostSnapshot*</span><span class="sxs-lookup"><span data-stu-id="4c40d-180">*PostSnapshot*</span></span>](vssgloss-p.md)

<span data-ttu-id="4c40d-181">Tre dei gestori del writer ([**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot), [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze)e [**CVssWriter:: onscongelate**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)) sono metodi virtuali puri e ogni writer deve implementarli anziché basarsi sulle impostazioni predefinite.</span><span class="sxs-lookup"><span data-stu-id="4c40d-181">Three of the writer's handlers—[**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot), [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze), and [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw)—are pure virtual methods, and each writer must implement them rather than relying on defaults.</span></span> <span data-ttu-id="4c40d-182">A seconda delle esigenze di un writer, possono essere codificati come metodi fittizi, restituendo semplicemente **true**.</span><span class="sxs-lookup"><span data-stu-id="4c40d-182">Depending on a writer's needs, they may be coded as dummy methods, simply returning **TRUE**.</span></span>

<span data-ttu-id="4c40d-183">Poiché in genere è presente un intervallo di tempo ridotto tra l'emissione di un evento di [*blocco*](vssgloss-f.md) e l'emissione di un evento di [*sblocco*](vssgloss-t.md) , la maggior parte dei principali lavori di preparazione per la copia shadow, ad esempio l'arresto dei processi, la creazione di file temporanei o lo svuotamento delle code di I/O, verrebbe gestita in [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot).</span><span class="sxs-lookup"><span data-stu-id="4c40d-183">Because there is typically a narrow time window between the issuing of a [*Freeze*](vssgloss-f.md) event and the issuing of a [*Thaw*](vssgloss-t.md) event, most of the major work in preparing for the shadow copy—such as shutting down processes, creating temporary files, or draining I/O queues—would be handled in [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot).</span></span>

<span data-ttu-id="4c40d-184">Il modo in cui un writer può utilizzare [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) per gestire le operazioni di i/O prima che la creazione di una copia shadow dipenda fortemente dalla propria architettura del writer.</span><span class="sxs-lookup"><span data-stu-id="4c40d-184">How a writer might use [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) to handle its I/O before the creation of a shadow copy is highly dependent on the writer's own architecture.</span></span>

<span data-ttu-id="4c40d-185">È consigliabile che i writer che possono contenere tutte le Scritture e mantengano i dati in uno stato coerente assoluto prima del [*blocco*](vssgloss-f.md).</span><span class="sxs-lookup"><span data-stu-id="4c40d-185">Writers that can afford to hold all writes and keep the data in an absolute consistent state before [*Freeze*](vssgloss-f.md), should do so.</span></span>

<span data-ttu-id="4c40d-186">Se il writer non è in grado di bloccare le operazioni di I/O, è necessario eseguire le operazioni per creare un'origine stabile per il backup e per ridurre il tempo di recupero per una copia shadow.</span><span class="sxs-lookup"><span data-stu-id="4c40d-186">If the writer cannot freeze its I/O, then it should take actions to create a stable source for backup and to reduce the recovery time for a shadow copy.</span></span> <span data-ttu-id="4c40d-187">Ad esempio l'accodamento delle richieste di I/O in ingresso o la generazione di un set duplicato di file in un [*percorso alternativo*](vssgloss-a.md) da usare come origine di un backup.</span><span class="sxs-lookup"><span data-stu-id="4c40d-187">Examples of this might include queuing incoming I/O requests or generating a duplicate set of files in an [*alternate path*](vssgloss-a.md) to be used as the source of a backup.</span></span>

<span data-ttu-id="4c40d-188">Il metodo [**CVssWriter:: OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) esegue attività semplici e brevi, ad esempio la verifica che lo stato di i/O di [**CVssWriter:: OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) è stato corretto e che tutte le attività asincrone avviate da [**CVssWriter:: OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) siano state completate.</span><span class="sxs-lookup"><span data-stu-id="4c40d-188">The [**CVssWriter::OnFreeze**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onfreeze) method performs simple, short tasks such as verifying that the [**CVssWriter::OnPrepareSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparesnapshot) left I/O in the correct state, and that any asynchronous tasks started by [**CVssWriter::OnPrepareBackup**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpreparebackup) completed.</span></span> <span data-ttu-id="4c40d-189">Questo metodo è l'ultima possibilità di un writer di veto a una copia shadow in caso di problemi (vedere [errori e veto del writer](writer-errors-and-vetoes.md)).</span><span class="sxs-lookup"><span data-stu-id="4c40d-189">This method is a writer's last chance to veto a shadow copy if there are problems (see [Writer Errors and Vetoes](writer-errors-and-vetoes.md)).</span></span>

<span data-ttu-id="4c40d-190">È in genere possibile che un writer riprenda l'operazione normale dopo un evento di [*sblocco*](vssgloss-t.md) : una copia shadow potrebbe non essere immediatamente pronta per il backup dopo il ripristino, ma un writer dovrebbe essere in grado di riprendere il normale funzionamento.</span><span class="sxs-lookup"><span data-stu-id="4c40d-190">It is generally possible for a writer to resume normal operation following a [*Thaw*](vssgloss-t.md) event: a shadow copy may not be immediately ready for backup after the Thaw, but a writer should be able to resume normal operation.</span></span> <span data-ttu-id="4c40d-191">Di conseguenza, in genere [**CVssWriter:: Onscongelate**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) viene usato dai writer per tornare a uno stato di pre-blocco.</span><span class="sxs-lookup"><span data-stu-id="4c40d-191">Therefore, typically [**CVssWriter::OnThaw**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onthaw) is used by writers to return to a pre-freeze state.</span></span> <span data-ttu-id="4c40d-192">Tuttavia, tutti i file temporanei creati per supportare la copia shadow devono essere lasciati sul posto fino all'evento [*PostSnapshot*](vssgloss-p.md) .</span><span class="sxs-lookup"><span data-stu-id="4c40d-192">However, any temporary files created to support the shadow copy should be left in place until the [*PostSnapshot*](vssgloss-p.md) event.</span></span> <span data-ttu-id="4c40d-193">In genere, è necessario utilizzare [**CVssWriter:: OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) per questo tipo di pulizia.</span><span class="sxs-lookup"><span data-stu-id="4c40d-193">Typically, you would use [**CVssWriter::OnPostSnapshot**](/windows/desktop/api/VsWriter/nf-vswriter-cvsswriter-onpostsnapshot) for this sort of cleanup.</span></span> <span data-ttu-id="4c40d-194">Poiché molte applicazioni non richiedono questo tipo di pulizia, **CVssWriter:: OnPostSnapshot** è un metodo virtuale con un'implementazione predefinita che restituisce semplicemente **true**.</span><span class="sxs-lookup"><span data-stu-id="4c40d-194">Because many applications do not require this sort of cleanup, **CVssWriter::OnPostSnapshot** is a virtual method with a default implementation that simply returns **TRUE**.</span></span> <span data-ttu-id="4c40d-195">Se viene eseguito un backup incrementale o differenziale, il writer può chiamare [**IVssComponent:: GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp) e [**IVssComponent:: SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span><span class="sxs-lookup"><span data-stu-id="4c40d-195">If an incremental or differential backup is being performed, the writer may call [**IVssComponent::GetPreviousBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getpreviousbackupstamp) and [**IVssComponent::SetBackupStamp**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-setbackupstamp).</span></span> <span data-ttu-id="4c40d-196">Per ulteriori informazioni, vedere [ruolo di writer nel backup di archivi complessi](writer-role-in-backing-up-complex-stores.md).</span><span class="sxs-lookup"><span data-stu-id="4c40d-196">For more information, see [Writer Role in Backing Up Complex Stores](writer-role-in-backing-up-complex-stores.md).</span></span> <span data-ttu-id="4c40d-197">Un altro metodo che può essere chiamato in questo momento è [**IVssComponent:: AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).</span><span class="sxs-lookup"><span data-stu-id="4c40d-197">Another method that can be called at this time is [**IVssComponent::AddDifferencedFilesByLastModifyTime**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-adddifferencedfilesbylastmodifytime).</span></span>

 

 




