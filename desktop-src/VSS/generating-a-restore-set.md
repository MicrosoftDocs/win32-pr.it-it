---
description: Un set di ripristino è un elenco di tutti i file da ripristinare e i percorsi in cui verranno ripristinati.
ms.assetid: 3196c26c-3407-4c00-a800-c3497df583e5
title: Generazione di un set di ripristino
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: db3447ba6d258a5f22fff958761abc7ac0e4f27f
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106310718"
---
# <a name="generating-a-restore-set"></a><span data-ttu-id="9118c-103">Generazione di un set di ripristino</span><span class="sxs-lookup"><span data-stu-id="9118c-103">Generating A Restore Set</span></span>

<span data-ttu-id="9118c-104">Un set di ripristino è un elenco di tutti i file da ripristinare e i percorsi in cui verranno ripristinati.</span><span class="sxs-lookup"><span data-stu-id="9118c-104">A restore set is a list of all files to be restored and the locations to which they will be restored.</span></span>

<span data-ttu-id="9118c-105">Come durante la generazione dell'elenco dei file di backup (vedere [generazione di un set di backup](generating-a-backup-set.md)), un algoritmo per determinare quali file ripristinare e dove ripristinarli deve continuare l' [*istanza*](vssgloss-w.md) del writer in base all'istanza del writer e per ogni istanza del writer.</span><span class="sxs-lookup"><span data-stu-id="9118c-105">As when generating the backup file list (see [Generating A Backup Set](generating-a-backup-set.md)), an algorithm for determining which files to restore and where to restore them must proceed [*writer instance*](vssgloss-w.md) by writer instance, and on a component-by-component basis for each writer instance.</span></span>

<span data-ttu-id="9118c-106">È necessario associare ogni file sul supporto di backup con il componente che lo ha gestito.</span><span class="sxs-lookup"><span data-stu-id="9118c-106">It is necessary to associate each file on the backup media with the component that managed it.</span></span> <span data-ttu-id="9118c-107">È anche necessario ottenere il [*metodo di ripristino*](vssgloss-r.md)del componente di gestione e le informazioni sulla [*destinazione di ripristino*](vssgloss-r.md) del file e i relativi [*mapping del percorso alternativo*](vssgloss-a.md) (se presenti).</span><span class="sxs-lookup"><span data-stu-id="9118c-107">It is also necessary to obtain the managing component's [*restore method*](vssgloss-r.md), and the file's [*restore target*](vssgloss-r.md) information, and its [*alternate location mappings*](vssgloss-a.md) (if any).</span></span>

<span data-ttu-id="9118c-108">Alcuni file possono anche richiedere operazioni [*parziali sui file*](vssgloss-p.md) o [*destinazioni dirette*](vssgloss-d.md) per il ripristino.</span><span class="sxs-lookup"><span data-stu-id="9118c-108">Some files may also require [*partial files*](vssgloss-p.md) operations or [*directed targets*](vssgloss-d.md) for restore.</span></span>

<span data-ttu-id="9118c-109">Esaminando la selezione dei componenti [*per*](vssgloss-s.md) i [*percorsi logici*](vssgloss-l.md) e di backup (vedere [utilizzo di selezione e percorsi logici](working-with-selectability-and-logical-paths.md)), un richiedente è in grado di determinare la struttura del componente dell'operazione di backup che verrà ripristinata.</span><span class="sxs-lookup"><span data-stu-id="9118c-109">By examining the components' [*selectability for backup*](vssgloss-s.md) and [*logical paths*](vssgloss-l.md) (see [Working with Selectability and Logical Paths](working-with-selectability-and-logical-paths.md)), a requester is able to determine the component structure of the backup operation it is going to restore.</span></span>

<span data-ttu-id="9118c-110">Con la struttura del componente del backup stabilita, il richiedente può ottenere le informazioni sul [*set di file*](vssgloss-f.md) di ogni componente (specifica del file, percorso e flag di ricorsione).</span><span class="sxs-lookup"><span data-stu-id="9118c-110">With the component structure of the backup established, the requester can get each component's [*file set*](vssgloss-f.md) information (file specification, path, and recursion flag).</span></span> <span data-ttu-id="9118c-111">Un richiedente può quindi generare un set di ripristino.</span><span class="sxs-lookup"><span data-stu-id="9118c-111">A requester can then generate a restore set.</span></span>

<span data-ttu-id="9118c-112">I file che richiedono [*file parziali*](vssgloss-p.md)o [*destinazioni dirette*](vssgloss-d.md) forniscono le proprie istruzioni di ripristino dettagliate (vedere [percorsi di backup e ripristino non predefiniti](non-default-backup-and-restore-locations.md)), che possono essere aggiunti al set di ripristino.</span><span class="sxs-lookup"><span data-stu-id="9118c-112">Files requiring [*partial files*](vssgloss-p.md), or [*directed targets*](vssgloss-d.md) provide their own detailed restoration instructions (see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md)), which can then be added to the restore set.</span></span>

<span data-ttu-id="9118c-113">Un meccanismo tipico per la generazione di un set di ripristino per i file non interessati da operazioni di file parziali o per le [*destinazioni dirette*](vssgloss-d.md) può procedere con le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="9118c-113">A typical mechanism for generating a restore set for files not involved with partial files operations, or [*directed targets*](vssgloss-d.md) might proceed by doing the following:</span></span>

1.  <span data-ttu-id="9118c-114">Ottenere un elenco di file nel supporto di backup, inclusi i percorsi originali.</span><span class="sxs-lookup"><span data-stu-id="9118c-114">Obtain a list of files on the backup media, including their original paths.</span></span>

2.  <span data-ttu-id="9118c-115">Identificare la [*classe*](vssgloss-w.md) e il componente writer per ogni file nel supporto di backup effettuando le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="9118c-115">Identify the [*writer class*](vssgloss-w.md) and component for each file on the backup media by doing the following:</span></span>

    -   <span data-ttu-id="9118c-116">Per ogni writer, ottenere informazioni sul componente ([**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent)) chiamando [**IVssExamineWriterMetadata:: getComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) su tutti i relativi componenti.</span><span class="sxs-lookup"><span data-stu-id="9118c-116">For each writer, obtain component information ([**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent)) by calling [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) on all its components.</span></span>
    -   <span data-ttu-id="9118c-117">Per ogni componente, ottenere informazioni sul descrittore del file ([**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc)) per ogni set di file contenuti nel componente (a seconda dei tipi di dati contenuti nel componente chiamando [**IVssWMComponent:: GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile), [**IVssWMComponent:: GetDatabaseFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabasefile)e [**IVssWMComponent:: GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile).</span><span class="sxs-lookup"><span data-stu-id="9118c-117">For each component, obtain file descriptor ([**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc)) information for every set of files the component contains (depending on the types of data the component contains by calling [**IVssWMComponent::GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile), [**IVssWMComponent::GetDatabaseFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabasefile), and [**IVssWMComponent::GetDatabaseLogFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getdatabaselogfile).</span></span>
    -   <span data-ttu-id="9118c-118">Confrontare le informazioni sul nome e sul percorso del file rispetto a quelle restituite dalle informazioni sul percorso contenute nel descrittore di file per ogni set di file in un componente (restituito da [**IVssWMFiledesc:: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc:: GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec)e [**IVssWMFiledesc:: getricorsivy**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive)) sulle informazioni sul percorso dei file archiviati per determinare se il file fa parte del componente.</span><span class="sxs-lookup"><span data-stu-id="9118c-118">Compare the file's name and path information against that returned by the path information contained in the file descriptor for each set of files in a component (returned by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc::GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec), and [**IVssWMFiledesc::GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive)) against stored files path information to determine whether the file is part of the component.</span></span>
        > [!Note]  
        > <span data-ttu-id="9118c-119">È necessario ignorare tutte le informazioni sul percorso alternativo nel descrittore di file recuperato da un componente trovato in un documento di metadati del writer archiviato, ovvero [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) non restituisce **null**.</span><span class="sxs-lookup"><span data-stu-id="9118c-119">You should ignore any alternate location information in the file descriptor retrieved from a component found in a stored Writer Metadata Document (that is, [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) does not return **NULL**).</span></span> <span data-ttu-id="9118c-120">Questo percorso alternativo è il [*percorso alternativo*](vssgloss-a.md), che viene usato solo durante il backup.</span><span class="sxs-lookup"><span data-stu-id="9118c-120">This alternate location is the [*alternate path*](vssgloss-a.md), which is used only during backup.</span></span>

         

3.  <span data-ttu-id="9118c-121">Ottenere informazioni di mapping alternative per ogni file nel supporto di backup:</span><span class="sxs-lookup"><span data-stu-id="9118c-121">Obtain alternate mapping information for each file on the backup media:</span></span>

    -   <span data-ttu-id="9118c-122">I mapping di file alternativi vengono archiviati nel writer, non a livello di componente e ottenuti dall'oggetto [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) restituito da [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="9118c-122">Alternate file mappings are stored at the writer, not the component level, and are obtained from the object [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) returned by [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping).</span></span>
    -   <span data-ttu-id="9118c-123">È possibile determinare se un determinato file ha un mapping del percorso alternativo controllando il percorso e il nome del file in base al percorso e alla specifica del file contenuti nel mapping del percorso alternativo restituito da [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), tramite [**IVssWMFiledesc:: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc:: GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec)e [**IVssWMFiledesc:: getricorsivy**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive).</span><span class="sxs-lookup"><span data-stu-id="9118c-123">You can determine if a particular file has an alternate location mapping by checking the file's path and name against the path and file specification contained in the alternate location mapping returned by [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), via [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), [**IVssWMFiledesc::GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec), and [**IVssWMFiledesc::GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive).</span></span> <span data-ttu-id="9118c-124">Se durante il backup è stato utilizzato un percorso alternativo, tali informazioni devono essere ignorate durante questa verifica durante l'elaborazione di un ripristino.</span><span class="sxs-lookup"><span data-stu-id="9118c-124">(If an alternate path was used during backup, that information should be ignored during this check in processing a restore.)</span></span>
    -   <span data-ttu-id="9118c-125">Se un file e un percorso alternativo esegue il mapping dei descrittori di file, si usa il metodo [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) dell'oggetto [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) restituito da [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) per trovare il percorso alternativo in cui è possibile ripristinare il file.</span><span class="sxs-lookup"><span data-stu-id="9118c-125">If a file and an alternate location mappings file descriptors match, you then use the [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) method of the [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) object returned by [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) to find the alternate location to which you can restore the file.</span></span>
    -   <span data-ttu-id="9118c-126">Il mapping del percorso alternativo ottenuto in questo modo non corrisponderà necessariamente a quello restituito dal documento componenti di backup di [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="9118c-126">The alternate location mapping obtained in this way will not necessarily agree with that returned from the Backup Components Document by [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span> <span data-ttu-id="9118c-127">Il valore [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) non è vuoto solo se per un file viene usato il mapping del percorso alternativo.</span><span class="sxs-lookup"><span data-stu-id="9118c-127">The [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) value is nonblank only if the alternate location mapping is used for a file.</span></span>

4.  <span data-ttu-id="9118c-128">Con questo file e informazioni sul componente, è possibile eseguire query sul documento componenti di backup per ottenere informazioni sulle destinazioni di ripristino, sulle opzioni e sui nuovi percorsi di ripristino per ogni file.</span><span class="sxs-lookup"><span data-stu-id="9118c-128">With this file and component information, the Backup Components Document can be queried to obtain information about restore targets, options, and new restore locations for each file.</span></span> <span data-ttu-id="9118c-129">Queste informazioni possono essere combinate con l'elenco di file, componenti e posizioni alternative.</span><span class="sxs-lookup"><span data-stu-id="9118c-129">This information can be combined with the list of files, components, and alternate locations.</span></span>

5.  <span data-ttu-id="9118c-130">I file non protetti dai writer possono essere selezionati in modo coerente con le normali operazioni di ripristino.</span><span class="sxs-lookup"><span data-stu-id="9118c-130">Files not protected by writers can be selected in a manner consistent with traditional restore operations.</span></span>

<span data-ttu-id="9118c-131">A questo punto, un richiedente deve avere un elenco di tutti i file necessari per il ripristino, oltre a istruzioni su come ripristinarli, e può iniziare a ripristinare i file in base a:</span><span class="sxs-lookup"><span data-stu-id="9118c-131">At this point, a requester should have a list of all the files it needs to restore, along with instructions about how to restore them, and can begin restoring files on the basis of:</span></span>

-   <span data-ttu-id="9118c-132">Se i mapping del percorso alternativo o il percorso del file originale deve essere usato come destinazione per il ripristino, dipenderà dalla presenza o dall'assenza di un file in tale percorso di destinazione e dalle impostazioni dei componenti della [**\_ \_ destinazione di ripristino VSS**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restore_target) e dell' [**\_ \_ enumerazione RESTOREMETHOD VSS**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) (vedere i [percorsi di backup e ripristino non predefiniti](non-default-backup-and-restore-locations.md)).</span><span class="sxs-lookup"><span data-stu-id="9118c-132">Whether alternate location mappings, or the original file location is to be used as the target for the restore will depend on the presence or absence of a file at that target location and component settings of [**VSS\_RESTORE\_TARGET**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restore_target) and [**VSS\_RESTOREMETHOD\_ENUM**](/windows/desktop/api/VsWriter/ne-vswriter-vss_restoremethod_enum) (see [Non-Default Backup and Restore Locations](non-default-backup-and-restore-locations.md)).</span></span>
-   <span data-ttu-id="9118c-133">Se un tentativo di ripristino ha esito positivo dipenderà da problemi quali le autorizzazioni di accesso della destinazione, se i file di destinazione sono bloccati e altri problemi convenzionali correlati al ripristino del file.</span><span class="sxs-lookup"><span data-stu-id="9118c-133">Whether an attempt at restoration succeeds will depend on issues such as the access permissions of the target, if target files are locked, and other conventional issues involved in file restoration.</span></span>
-   <span data-ttu-id="9118c-134">L'esito positivo o negativo del ripristino di un determinato componente per una determinata istanza di writer deve essere mantenuto nel documento componenti di backup chiamando [**IVssBackupComponents:: SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus).</span><span class="sxs-lookup"><span data-stu-id="9118c-134">The success or failure of restoring a given component for a given writer instance should be preserved in the Backup Components Document by calling [**IVssBackupComponents::SetFileRestoreStatus**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-setfilerestorestatus).</span></span> <span data-ttu-id="9118c-135">In questo modo le informazioni potranno essere accessibili ai writer quando elaborano l'evento PostRestore.</span><span class="sxs-lookup"><span data-stu-id="9118c-135">This will make the information accessible to writers when they process the PostRestore event.</span></span>
-   <span data-ttu-id="9118c-136">Se un file viene ripristinato in un mapping di percorso alternativo, il richiedente deve chiamare [**IVssBackupComponents:: AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="9118c-136">If a file is restored to an alternate location mapping, the requester must call [**IVssBackupComponents::AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping).</span></span> <span data-ttu-id="9118c-137">Ciò consentirà ai writer di determinare se i file sono stati ripristinati in percorsi alternativi tramite [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="9118c-137">This will allow writers to determine whether their files have been restored to alternate locations through the [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span>
-   <span data-ttu-id="9118c-138">I richiedenti possono essere utili per ripristinare i file in posizioni completamente nuove.</span><span class="sxs-lookup"><span data-stu-id="9118c-138">Requesters may find it desirable to restore files to completely new locations.</span></span> <span data-ttu-id="9118c-139">Questa operazione è accettabile, ma il richiedente deve indicare questo oggetto al writer usando il metodo [**IVssBackupComponents:: AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget) .</span><span class="sxs-lookup"><span data-stu-id="9118c-139">This is acceptable, but the requester must indicate this to the writer by using the [**IVssBackupComponents::AddNewTarget**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addnewtarget) method.</span></span>

 

 



