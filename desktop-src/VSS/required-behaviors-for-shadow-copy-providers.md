---
description: Un provider di copie shadow deve essere conforme alle linee guida per garantire la compatibilità del richiedente.
ms.assetid: 49baeb89-1dc9-45c2-a532-071085a8e52f
title: Comportamenti necessari per i provider di copie shadow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f451dea7154a313cd64a3a46fbcc3b5fe663ec12
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106310675"
---
# <a name="required-behaviors-for-shadow-copy-providers"></a><span data-ttu-id="046b2-103">Comportamenti necessari per i provider di copie shadow</span><span class="sxs-lookup"><span data-stu-id="046b2-103">Required Behaviors for Shadow Copy Providers</span></span>

<span data-ttu-id="046b2-104">Un provider di copie shadow deve essere conforme alle linee guida per garantire la compatibilità del richiedente.</span><span class="sxs-lookup"><span data-stu-id="046b2-104">A shadow copy provider must conform to guidelines to ensure requester compatibility.</span></span> <span data-ttu-id="046b2-105">In fase di esecuzione, un'applicazione di backup o qualsiasi altro richiedente che utilizza copie shadow deve funzionare correttamente senza conoscere i dettagli specifici dell'implementazione del provider.</span><span class="sxs-lookup"><span data-stu-id="046b2-105">At runtime, a backup application or any other requester that uses shadow copies must function correctly without any knowledge of specific provider implementation details.</span></span>

## <a name="automagic-resource-management"></a><span data-ttu-id="046b2-106">Gestione delle risorse automagiche</span><span class="sxs-lookup"><span data-stu-id="046b2-106">Automagic Resource Management</span></span>

<span data-ttu-id="046b2-107">È necessario che il richiedente aggiunga semplicemente un volume a un set di copie shadow.</span><span class="sxs-lookup"><span data-stu-id="046b2-107">It must be possible for the requester to simply add a volume to a shadow copy set.</span></span> <span data-ttu-id="046b2-108">Il richiedente può specificare attributi di copia shadow come **VSS \_ VolSnap \_ attr \_ Transportable**, **VSS \_ VolSnap \_ attr \_ differenziale** e/o **VSS \_ VolSnap \_ attr \_** nel [**\_ \_ \_ contesto dello snapshot VSS**](/windows/desktop/api/Vss/ne-vss-vss_snapshot_context).</span><span class="sxs-lookup"><span data-stu-id="046b2-108">The requester can specify shadow copy attributes such as **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**, **VSS\_VOLSNAP\_ATTR\_DIFFERENTIAL**, and/or **VSS\_VOLSNAP\_ATTR\_PLEX** in the [**\_VSS\_SNAPSHOT\_CONTEXT**](/windows/desktop/api/Vss/ne-vss-vss_snapshot_context).</span></span> <span data-ttu-id="046b2-109">Il provider deve rispettare tali attributi.</span><span class="sxs-lookup"><span data-stu-id="046b2-109">The provider must honor those attributes.</span></span> <span data-ttu-id="046b2-110">Se non è possibile rispettare tali attributi, dovrebbe indicare che il set di copie shadow non è supportato impostando \* *PbIsSupported* in [**IVssHardwareSnapshotProvider:: AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) su **false**.</span><span class="sxs-lookup"><span data-stu-id="046b2-110">If it cannot honor those attributes, then it should indicate that the shadow copy set is unsupported by setting the \**pbIsSupported* in [**IVssHardwareSnapshotProvider::AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) to **FALSE**.</span></span>

<span data-ttu-id="046b2-111">Il provider non deve mai accettare di supportare una copia shadow che non è in grado di creare.</span><span class="sxs-lookup"><span data-stu-id="046b2-111">The provider must never agree to support a shadow copy that it cannot create.</span></span> <span data-ttu-id="046b2-112">Se il richiedente non specifica un attributo Plex o differenziale, il provider deve includere la logica di automagic per l'allocazione dello spazio del sottosistema per la copia shadow e creare la copia shadow usando il metodo più appropriato.</span><span class="sxs-lookup"><span data-stu-id="046b2-112">If the requester does not specify a plex or differential attribute, the provider must include automagic logic for allocating subsystem space for the shadow copy and create the shadow copy using the most appropriate method.</span></span> <span data-ttu-id="046b2-113">Il provider hardware non deve includere un'API specifica del provider per la gestione delle proprietà delle copie shadow richieste.</span><span class="sxs-lookup"><span data-stu-id="046b2-113">The hardware provider must not include a provider-specific API for managing required shadow copy properties.</span></span>

## <a name="created-shadow-copy-volumes-are-read-only-and-hidden"></a><span data-ttu-id="046b2-114">I volumi creati per le copie shadow sono Read-Only e nascosti</span><span class="sxs-lookup"><span data-stu-id="046b2-114">Created Shadow Copy Volumes Are Read-Only and Hidden</span></span>

<span data-ttu-id="046b2-115">VSS imposta i flag su ogni LUN interessato in modo che i volumi di copia shadow risultanti siano nascosti e in sola lettura quando vengono rilevati da un computer che esegue Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="046b2-115">VSS sets flags on each affected LUN such that the resulting shadow copy volumes will be hidden and read-only when detected by a computer running Windows Server 2003.</span></span> <span data-ttu-id="046b2-116">Le lettere di unità e le cartelle montate non vengono assegnate automaticamente.</span><span class="sxs-lookup"><span data-stu-id="046b2-116">Drive letters and mounted folders are not automatically assigned.</span></span> <span data-ttu-id="046b2-117">VSS mantiene questi flag per tutto il ciclo di vita di una copia shadow.</span><span class="sxs-lookup"><span data-stu-id="046b2-117">VSS maintains these flags throughout the life cycle of a shadow copy.</span></span>

## <a name="hardware-shadow-copy-luns-must-be-readwrite"></a><span data-ttu-id="046b2-118">I LUN della copia shadow hardware devono essere di lettura/scrittura</span><span class="sxs-lookup"><span data-stu-id="046b2-118">Hardware Shadow Copy LUNs Must Be Read/Write</span></span>

<span data-ttu-id="046b2-119">VSS supporta le copie shadow dell'hardware solo quando il LUN sottostante viene mappato come lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="046b2-119">VSS supports hardware shadow copies only where the underlying LUN is mapped as read/write.</span></span> <span data-ttu-id="046b2-120">Questa operazione deve essere eseguita prima della creazione della copia shadow. non può essere eseguita dopo il fatto.</span><span class="sxs-lookup"><span data-stu-id="046b2-120">This must be done before the shadow copy is created; it cannot be done after the fact.</span></span> <span data-ttu-id="046b2-121">I provider hardware non devono modificare questi flag.</span><span class="sxs-lookup"><span data-stu-id="046b2-121">Hardware providers should not modify these flags.</span></span> <span data-ttu-id="046b2-122">Per ulteriori informazioni su come VSS utilizza questi flag, vedere [il processo di creazione della copia shadow](the-shadow-copy-creation-process.md).</span><span class="sxs-lookup"><span data-stu-id="046b2-122">For more information about how VSS uses these flags, see [The Shadow Copy Creation Process](the-shadow-copy-creation-process.md).</span></span>

## <a name="auto-import-hardware-shadow-copies-are-not-supported-on-windows-cluster-service"></a><span data-ttu-id="046b2-123">L'importazione automatica delle copie shadow hardware non è supportata nel servizio cluster Windows</span><span class="sxs-lookup"><span data-stu-id="046b2-123">Auto-Import Hardware Shadow Copies Are Not Supported on Windows Cluster Service</span></span>

<span data-ttu-id="046b2-124">Windows Servizio cluster non può contenere lun con firme duplicate e layout di partizione.</span><span class="sxs-lookup"><span data-stu-id="046b2-124">Windows Cluster service cannot accommodate LUNs with duplicate signatures and partition layout.</span></span> <span data-ttu-id="046b2-125">I LUN delle copie shadow devono essere trasportati in un host esterno al cluster.</span><span class="sxs-lookup"><span data-stu-id="046b2-125">The shadow copy LUNs must be transported to a host outside the cluster.</span></span> <span data-ttu-id="046b2-126">Per altre informazioni, vedere [ripristino rapido con volumi copiati shadow trasportabili](fast-recovery-using-transportable-shadow-copied-volumes.md).</span><span class="sxs-lookup"><span data-stu-id="046b2-126">For more information, see [Fast Recovery Using Transportable Shadow Copied Volumes](fast-recovery-using-transportable-shadow-copied-volumes.md).</span></span>

## <a name="shadow-copies-that-contain-dynamic-disks-must-be-transported-to-a-different-host"></a><span data-ttu-id="046b2-127">Le copie shadow contenenti dischi dinamici devono essere trasferite in un host diverso</span><span class="sxs-lookup"><span data-stu-id="046b2-127">Shadow Copies That Contain Dynamic Disks Must Be Transported to a Different Host</span></span>

<span data-ttu-id="046b2-128">**Prima di Windows Server 2008:** Il supporto nativo per i dischi dinamici non può contenere lun con firme duplicate e contenuti del database di configurazione.</span><span class="sxs-lookup"><span data-stu-id="046b2-128">**Prior to Windows Server 2008:** The native support for dynamic disks cannot accommodate LUNs with duplicate signatures and configuration database contents.</span></span> <span data-ttu-id="046b2-129">I LUN delle copie shadow devono essere trasportati in un host diverso.</span><span class="sxs-lookup"><span data-stu-id="046b2-129">The shadow copy LUNs must be transported to a different host.</span></span> <span data-ttu-id="046b2-130">Il servizio Copia Shadow del volume impone questo problema senza consentire l'importazione automatica di dischi dinamici.</span><span class="sxs-lookup"><span data-stu-id="046b2-130">VSS enforces this by not allowing auto-import shadow copies of dynamic disks.</span></span> <span data-ttu-id="046b2-131">Un richiedente non deve importare nuovamente una copia shadow trasportabile nello stesso host.</span><span class="sxs-lookup"><span data-stu-id="046b2-131">A requester should not import a transportable shadow copy back to the same host.</span></span>

<span data-ttu-id="046b2-132">**A partire da Windows Server 2008:** Questa limitazione è stata rimossa.</span><span class="sxs-lookup"><span data-stu-id="046b2-132">**Beginning with Windows Server 2008:** This limitation is removed.</span></span>

## <a name="providers-are-out-of-process"></a><span data-ttu-id="046b2-133">I provider sono out-of-process</span><span class="sxs-lookup"><span data-stu-id="046b2-133">Providers Are Out-of-Process</span></span>

<span data-ttu-id="046b2-134">Tutti i provider devono essere implementati come componenti COM out-of-process.</span><span class="sxs-lookup"><span data-stu-id="046b2-134">All providers must be implemented as out-of-process COM components.</span></span>

## <a name="time-critical-operations"></a><span data-ttu-id="046b2-135">Operazioni di Time-Critical</span><span class="sxs-lookup"><span data-stu-id="046b2-135">Time-Critical Operations</span></span>

<span data-ttu-id="046b2-136">Le operazioni lunghe, ad esempio la sincronizzazione di Plex, devono essere avviate in [**IVssHardwareSnapshotProvider:: BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot).</span><span class="sxs-lookup"><span data-stu-id="046b2-136">Long operations, such as syncing plexes, should be initiated in [**IVssHardwareSnapshotProvider::BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot).</span></span> <span data-ttu-id="046b2-137">Questa funzione deve avviare il lavoro di preparazione asincrona e restituire rapidamente.</span><span class="sxs-lookup"><span data-stu-id="046b2-137">This function should start the asynchronous preparation work and return quickly.</span></span> <span data-ttu-id="046b2-138">[**IVssProviderCreateSnapshotSet:: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots) funge da funzione "Rendezvous", il provider può attendere in modo sincrono in questo metodo per il completamento del lavoro di preparazione avviato da **BeginPrepareSnapshot**.</span><span class="sxs-lookup"><span data-stu-id="046b2-138">[**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots) serves as a "rendezvous" function—the provider can wait synchronously in this method for the completion of the preparation work that was started by **BeginPrepareSnapshot**.</span></span>

<span data-ttu-id="046b2-139">I provider non devono aggiungere ritardi in [**IVssProviderCreateSnapshotSet::P recommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots), [**IVssProviderCreateSnapshotSet:: CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots)o [**IVssProviderCreateSnapshotSet::P ostcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) perché le applicazioni sono bloccate durante tali chiamate.</span><span class="sxs-lookup"><span data-stu-id="046b2-139">Providers must not add delays in [**IVssProviderCreateSnapshotSet::PreCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-precommitsnapshots), [**IVssProviderCreateSnapshotSet::CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), or [**IVssProviderCreateSnapshotSet::PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) as applications are frozen during these calls.</span></span> <span data-ttu-id="046b2-140">**CommitSnapshots** deve restituire in pochi secondi, perché viene chiamato durante la finestra di scaricamento e attesa e il supporto del kernel VSS Annulla lo scaricamento e il mantenimento se la versione non viene ricevuta entro 10 secondi, causando il mancato restituzione del processo di creazione della copia shadow da parte di VSS.</span><span class="sxs-lookup"><span data-stu-id="046b2-140">**CommitSnapshots** should return within seconds, because this is called during the Flush and Hold window, and VSS Kernel Support will cancel the Flush and Hold if the release is not received within 10 seconds, which would cause VSS to fail the shadow copy creation process.</span></span> <span data-ttu-id="046b2-141">Se il provider richiede più di alcuni secondi per completare questa chiamata, è molto probabile che la creazione della copia shadow abbia esito negativo.</span><span class="sxs-lookup"><span data-stu-id="046b2-141">If the provider takes more than a few seconds to complete this call, there is a high probability that the shadow copy creation will fail.</span></span>

## <a name="careful-io-during-commitsnapshots"></a><span data-ttu-id="046b2-142">Accuratezza di I/O durante CommitSnapshots</span><span class="sxs-lookup"><span data-stu-id="046b2-142">Careful I/O During CommitSnapshots</span></span>

<span data-ttu-id="046b2-143">I provider hardware non devono eseguire alcuna operazione di I/O nei volumi necessari per la copia shadow durante [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots).</span><span class="sxs-lookup"><span data-stu-id="046b2-143">Hardware providers should not need to do any I/O to the volumes involved in the shadow copy during [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots).</span></span> <span data-ttu-id="046b2-144">Se sono necessarie operazioni di I/O, i provider non devono avviare alcun I/O su un volume originale gestendo il metodo **CommitSnapshots** .</span><span class="sxs-lookup"><span data-stu-id="046b2-144">If any I/O is required, providers must not initiate any I/O to an original volume while handling the **CommitSnapshots** method.</span></span>

<span data-ttu-id="046b2-145">Durante [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), i driver del supporto del kernel VSS bloccano i/O nei volumi originali di cui viene eseguita la copia shadow.</span><span class="sxs-lookup"><span data-stu-id="046b2-145">During [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), VSS Kernel Support drivers block I/O to the original volumes that are being shadow copied.</span></span> <span data-ttu-id="046b2-146">Se il provider utilizza l'I/O sincrono in un volume che si trova nel set di copie shadow, l'I/O verrà bloccato e il processo di commit della copia shadow sarà deadlock.</span><span class="sxs-lookup"><span data-stu-id="046b2-146">If the provider uses synchronous I/O to a volume which is in the shadow copy set, then that I/O will be blocked and the shadow copy commit process will be deadlocked.</span></span> <span data-ttu-id="046b2-147">Il provider non deve chiamare alcuna API Win32 durante **CommitSnapshots** poiché avrà una probabilità elevata di causare i/O e un deadlock.</span><span class="sxs-lookup"><span data-stu-id="046b2-147">The provider should not call any Win32 APIs during **CommitSnapshots** as they will have a high probability of causing I/O and a deadlock.</span></span> <span data-ttu-id="046b2-148">Il timeout del supporto del kernel VSS interrompe il deadlock dopo 10 secondi, ma la creazione della copia shadow avrà esito negativo.</span><span class="sxs-lookup"><span data-stu-id="046b2-148">The VSS Kernel Support timeout will break this deadlock after 10 seconds, but this will cause the shadow copy creation to fail.</span></span>

<span data-ttu-id="046b2-149">Se deve essere eseguito un tentativo di I/O, è necessario eseguirlo in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="046b2-149">If I/O must be attempted, it must be performed asynchronously.</span></span> <span data-ttu-id="046b2-150">L'i/O non verrà completato finché non vengono restituiti tutti i provider dai rispettivi metodi [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) .</span><span class="sxs-lookup"><span data-stu-id="046b2-150">The I/O will not complete until after all providers have returned from their [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots) methods.</span></span> <span data-ttu-id="046b2-151">In generale, è preferibile eseguire tali operazioni nella chiamata [**PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) .</span><span class="sxs-lookup"><span data-stu-id="046b2-151">In general, it is better to perform such operations in the [**PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots) call.</span></span>

## <a name="readwrite-shadow-copy-luns"></a><span data-ttu-id="046b2-152">Lun copia shadow di lettura/scrittura</span><span class="sxs-lookup"><span data-stu-id="046b2-152">Read/Write Shadow Copy LUNs</span></span>

<span data-ttu-id="046b2-153">In questa versione, VSS supporta solo i LUN di copia shadow di lettura/scrittura anche se i volumi sono esposti come di sola lettura.</span><span class="sxs-lookup"><span data-stu-id="046b2-153">In this version, VSS supports only read/write shadow copy LUNs even if the volumes are exposed as read-only.</span></span> <span data-ttu-id="046b2-154">Il motivo è che il sistema deve modificare le strutture dei dati su disco, ad esempio:</span><span class="sxs-lookup"><span data-stu-id="046b2-154">The reason is that the system needs to change on-disk data structures such as:</span></span>

-   <span data-ttu-id="046b2-155">Firma del disco, che cambia durante il processo di copia shadow</span><span class="sxs-lookup"><span data-stu-id="046b2-155">Disk signature, which changes during the shadow copy process</span></span>
-   <span data-ttu-id="046b2-156">Strutture di dati correlate alle partizioni, incluse quelle che indicano che la partizione è di sola lettura, nascosta, una copia shadow e non deve essere assegnata una lettera di unità.</span><span class="sxs-lookup"><span data-stu-id="046b2-156">Partition-related data structures, including those indicating the partition is read-only, hidden, a shadow copy, and should not be assigned a drive letter.</span></span>

## <a name="unique-page-83-information"></a><span data-ttu-id="046b2-157">Informazioni sulla pagina univoca 83</span><span class="sxs-lookup"><span data-stu-id="046b2-157">Unique Page 83 Information</span></span>

<span data-ttu-id="046b2-158">Sia il lun originale che il LUN della copia shadow appena creato devono avere almeno un identificatore di archiviazione univoco nella pagina 83 dati.</span><span class="sxs-lookup"><span data-stu-id="046b2-158">Both the original LUN and the newly created shadow copy LUN must have at least one unique storage identifier in the page 83 data.</span></span> <span data-ttu-id="046b2-159">Almeno un identificatore di archiviazione \_ con tipo 1, 2, 3 o 8 e un'associazione di 0 devono essere univoci nel LUN originale e nel LUN della copia shadow appena creato.</span><span class="sxs-lookup"><span data-stu-id="046b2-159">At least one STORAGE\_IDENTIFIER with a type of 1, 2, 3, or 8, and an association of 0 must be unique on the original LUN and the newly created shadow copy LUN.</span></span>

 

 



