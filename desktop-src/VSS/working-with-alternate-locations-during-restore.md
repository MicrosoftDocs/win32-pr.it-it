---
description: Esistono molti motivi per cui un richiedente non deve o non può essere in grado di ripristinare i file dal supporto di backup nel percorso originale.
ms.assetid: 2a9cfd99-5a2c-4c0c-98ff-11c745298cda
title: Utilizzo di percorsi alternativi durante il ripristino
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1338d76f98153ccb388e86e738b408c03dd253b4
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106307130"
---
# <a name="working-with-alternate-locations-during-restore"></a><span data-ttu-id="60cf8-103">Utilizzo di percorsi alternativi durante il ripristino</span><span class="sxs-lookup"><span data-stu-id="60cf8-103">Working with Alternate Locations during Restore</span></span>

<span data-ttu-id="60cf8-104">Esistono molti motivi per cui un richiedente non deve o non può essere in grado di ripristinare i file dal supporto di backup nel percorso originale.</span><span class="sxs-lookup"><span data-stu-id="60cf8-104">There are many reasons why a requester either should not, or may not, be able to restore files from backup media to their original location.</span></span> <span data-ttu-id="60cf8-105">Ad esempio, un metodo o una destinazione di ripristino può richiedere un ripristino di questo tipo oppure il percorso di ripristino corrente può essere occupato e non scrivibile.</span><span class="sxs-lookup"><span data-stu-id="60cf8-105">For example, a restore method or target may require such a restoration, or the current restoration location may be occupied and unwritable.</span></span>

<span data-ttu-id="60cf8-106">Per gestire questi casi, un writer potrebbe avere definito un [*mapping del percorso alternativo*](vssgloss-a.md), una destinazione di ripristino non standard da usare per circostanze particolari.</span><span class="sxs-lookup"><span data-stu-id="60cf8-106">To handle such cases, a writer may have defined an [*alternate location mapping*](vssgloss-a.md), a nonstandard restore destination to be used for special circumstances.</span></span>

<span data-ttu-id="60cf8-107">Il termine mapping del percorso alternativo, come usato con VSS, non deve essere confuso con il termine [*percorso alternativo*](vssgloss-a.md).</span><span class="sxs-lookup"><span data-stu-id="60cf8-107">The term alternate location mapping, as used with VSS, should not be confused with the term [*alternate path*](vssgloss-a.md).</span></span> <span data-ttu-id="60cf8-108">I mapping dei percorsi alternativi vengono utilizzati solo durante le operazioni di ripristino e fanno riferimento a una destinazione alternativa per le operazioni di ripristino.</span><span class="sxs-lookup"><span data-stu-id="60cf8-108">Alternate location mappings are used only during restore operations, and refer to an alternate destination for restore operations.</span></span> <span data-ttu-id="60cf8-109">I percorsi alternativi vengono usati solo durante le operazioni di backup e fanno riferimento a un'origine alternativa da cui eseguire il backup.</span><span class="sxs-lookup"><span data-stu-id="60cf8-109">Alternate paths are used only during backup operations, and refer to an alternate source from which to back up.</span></span>

<span data-ttu-id="60cf8-110">Per utilizzare i mapping dei percorsi alternativi durante il ripristino, un richiedente esegue le seguenti operazioni (in genere dopo la generazione di un evento di [**preripristino**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) ):</span><span class="sxs-lookup"><span data-stu-id="60cf8-110">To use alternate location mappings during restore, a requester would do the following (typically following the generation of a [**PreRestore**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-prerestore) event):</span></span>

1.  <span data-ttu-id="60cf8-111">Usando un'istanza dell'interfaccia [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) ottenuta recuperando un writer archiviato, un richiedente usa il metodo [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) per ottenere i mapping del percorso alternativo del writer come istanze dell'interfaccia [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) .</span><span class="sxs-lookup"><span data-stu-id="60cf8-111">Using an instance of the [**IVssExamineWriterMetadata**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssexaminewritermetadata) interface obtained by retrieving a stored writer, a requester uses the [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) method to obtain a writer's alternate location mappings as instances of the [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) interface.</span></span>

    > [!Note]  
    > <span data-ttu-id="60cf8-112">Il richiedente USA [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), non [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="60cf8-112">The requester uses [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping), not [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span> <span data-ttu-id="60cf8-113">Il primo restituisce i mapping dei percorsi alternativi disponibili per l'uso da parte di un richiedente.</span><span class="sxs-lookup"><span data-stu-id="60cf8-113">The former returns those alternate location mappings available for use by a requester.</span></span> <span data-ttu-id="60cf8-114">Quest'ultimo viene usato per indicare i mapping dei percorsi alternativi effettivamente usati da un richiedente.</span><span class="sxs-lookup"><span data-stu-id="60cf8-114">The latter is used to indicate those alternate location mappings actually used by a requester.</span></span>

     

2.  <span data-ttu-id="60cf8-115">La chiamata a [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) restituisce un'istanza dell'interfaccia [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) .</span><span class="sxs-lookup"><span data-stu-id="60cf8-115">The call to the [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) returns an instance of the [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) interface.</span></span> <span data-ttu-id="60cf8-116">Questa istanza contiene le informazioni sui set di file, ovvero un percorso specificato da [**IVssWMFiledesc:: GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), una specifica del file restituita tramite [**IVssWMFiledesc:: GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec)e un flag di ricorsione ottenuto da [**IVssWMFiledesc:: getricorsivy**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive), che corrisponde a uno dei set di file aggiunti (usando [**IVssCreateWriterMetadata:: AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata:**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles) [](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)</span><span class="sxs-lookup"><span data-stu-id="60cf8-116">This instance contains file set information—a path specified by [**IVssWMFiledesc::GetPath**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getpath), a file specification returned through [**IVssWMFiledesc::GetFilespec**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getfilespec), and a recursion flag obtained from [**IVssWMFiledesc::GetRecursive**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getrecursive)—matching one of the file sets added (using [**IVssCreateWriterMetadata::AddDatabaseFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabasefiles), [**IVssCreateWriterMetadata::AddDatabaseLogFiles**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-adddatabaselogfiles), or [**IVssCreateWriterMetadata::AddFilesToFileGroup**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscreatewritermetadata-addfilestofilegroup)) to one of the components managed by the writer.</span></span>

    <span data-ttu-id="60cf8-117">Il valore restituito da [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) è il mapping del percorso alternativo per questo set di file.</span><span class="sxs-lookup"><span data-stu-id="60cf8-117">The value returned by [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation) is the alternate location mapping for this file set.</span></span>

3.  <span data-ttu-id="60cf8-118">I mapping dei percorsi alternativi non contengono informazioni sul componente, pertanto sarà necessario confrontare le informazioni del set di file (percorso, specifica del file e flag di ricorsione) ottenute chiamando [**IVssExamineWriterMetadata:: GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) a quello contenuto dai componenti del writer.</span><span class="sxs-lookup"><span data-stu-id="60cf8-118">Alternate location mappings do not contain component information, so it will be necessary to compare the file set information (path, file specification, and recursion flag) obtained by calling [**IVssExamineWriterMetadata::GetAlternateLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getalternatelocationmapping) to that contained by the writer's components.</span></span>

    <span data-ttu-id="60cf8-119">Queste informazioni sono reperibili scorrendo i componenti del writer e chiamando [**IVssExamineWriterMetadata:: getComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) per ottenere un'istanza dell'interfaccia [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) e usare [**IVssWMComponent:: GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) per ottenere un'istanza di [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) contenente le informazioni sul set di file del componente.</span><span class="sxs-lookup"><span data-stu-id="60cf8-119">This information can be found by iterating over the writer's components and calling [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) to get an instance of the [**IVssWMComponent**](/windows/desktop/api/VsBackup/nl-vsbackup-ivsswmcomponent) interface and use [**IVssWMComponent::GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) to obtain a [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) instance containing the component file set information.</span></span>

    <span data-ttu-id="60cf8-120">Quando le informazioni del set di file restituite dall'istanza di [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) ottenute da [**IVssExamineWriterMetadata:: getComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) e [**IVssWMComponent:: GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) corrispondono a quelle ottenute dall'istanza **IVssWMFiledesc** derivata da [**IVssWMFiledesc:: GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation), è stato trovato il componente che gestisce i file con il mapping del percorso alternativo specifico.</span><span class="sxs-lookup"><span data-stu-id="60cf8-120">When the file set information returned by the instance of [**IVssWMFiledesc**](/windows/desktop/api/VsWriter/nl-vswriter-ivsswmfiledesc) obtained from [**IVssExamineWriterMetadata::GetComponent**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getcomponent) and [**IVssWMComponent::GetFile**](/windows/desktop/api/VsBackup/nf-vsbackup-ivsswmcomponent-getfile) matches that obtained from the **IVssWMFiledesc** instance derived from [**IVssWMFiledesc::GetAlternateLocation**](/windows/desktop/api/VsWriter/nf-vswriter-ivsswmfiledesc-getalternatelocation), the component managing the files with the specific alternate location mapping has been found.</span></span>

4.  <span data-ttu-id="60cf8-121">Dopo aver individuato il componente, il richiedente può determinare le condizioni in base alle quali deve essere usato un mapping del percorso alternativo eseguendo le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="60cf8-121">Having located the component, the requester can determine the conditions under which an alternate location mapping should be used by doing the following:</span></span>

    -   <span data-ttu-id="60cf8-122">Esame del metodo Restore del componente, ottenuto chiamando [**IVssExamineWriterMetadata:: GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).</span><span class="sxs-lookup"><span data-stu-id="60cf8-122">Examining the component's restore method, which is obtained by calling [**IVssExamineWriterMetadata::GetRestoreMethod**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-getrestoremethod).</span></span>
    -   <span data-ttu-id="60cf8-123">Verifica per determinare se una destinazione di ripristino esegue l'override del metodo Restore, chiamando [**IVssComponent:: GetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoretarget).</span><span class="sxs-lookup"><span data-stu-id="60cf8-123">Checking to see if a restore target overrides the restore method, by calling [**IVssComponent::GetRestoreTarget**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getrestoretarget).</span></span>

        <span data-ttu-id="60cf8-124">Se il componente trovato nel documento di metadati del writer è stato [*incluso in modo esplicito*](vssgloss-e.md) nel backup, l'istanza dell'interfaccia [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) corrisponderà a tale componente.</span><span class="sxs-lookup"><span data-stu-id="60cf8-124">If the component found in the Writer Metadata Document had been [*explicitly included*](vssgloss-e.md) in the backup, the instance of the [**IVssComponent**](/windows/desktop/api/VsWriter/nl-vswriter-ivsscomponent) interface will correspond to that component.</span></span> <span data-ttu-id="60cf8-125">Se il componente è stato [*incluso in modo implicito*](vssgloss-i.md) nel backup, l'istanza di **IVssComponent** corrisponderà al componente che definisce il set di componenti di cui il componente nel documento di metadati del writer è un sottocomponente.</span><span class="sxs-lookup"><span data-stu-id="60cf8-125">If the component had been [*implicitly included*](vssgloss-i.md) in the backup, then the instance of **IVssComponent** will correspond to the component defining the component set of which the component in the Writer Metadata Document is a subcomponent.</span></span>

5.  <span data-ttu-id="60cf8-126">Con queste informazioni, il richiedente può determinare una base componente per componente se deve ripristinare un determinato set di file di un determinato componente in una destinazione definita dal mapping del percorso alternativo.</span><span class="sxs-lookup"><span data-stu-id="60cf8-126">With this information, the requester can determine on a component-by-component basis if it needs to restore a given file set of a given component to a destination defined by the alternate location mapping.</span></span>

6.  <span data-ttu-id="60cf8-127">Quando si usa un mapping del percorso alternativo, il richiedente rispetta il descrittore di file del set di file e il flag ricorsivo e usa il percorso fornito dal mapping del percorso alternativo.</span><span class="sxs-lookup"><span data-stu-id="60cf8-127">When using an alternate location mapping, the requester respects the file set's file descriptor and recursive flag and uses the path provided by the alternate location mapping.</span></span>

    <span data-ttu-id="60cf8-128">Il richiedente indica che è stato usato un mapping del percorso alternativo durante un'operazione di ripristino chiamando [**IVssBackupComponents:: AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping) con le informazioni sul percorso predefinito del set di file, la destinazione di ripristino alternativa utilizzata e il nome di un componente.</span><span class="sxs-lookup"><span data-stu-id="60cf8-128">The requester indicates that it has used an alternate location mapping during a restore operation by calling the [**IVssBackupComponents::AddAlternativeLocationMapping**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-addalternativelocationmapping) with the file set's default location information, the alternate restore destination used, and a component name.</span></span>

    <span data-ttu-id="60cf8-129">Se il set di file è stato gestito da un componente incluso in modo esplicito nel backup, verrà utilizzato il nome del componente.</span><span class="sxs-lookup"><span data-stu-id="60cf8-129">If the file set was managed by a component that was explicitly included in the backup, that component name will be used.</span></span> <span data-ttu-id="60cf8-130">Se il set di file è stato gestito da un componente incluso in modo implicito nel backup, il nome utilizzato sarà quello del componente che definisce il set di componenti di cui il componente gestisce il set di file è un sottocomponente.</span><span class="sxs-lookup"><span data-stu-id="60cf8-130">If the file set was managed by a component that was implicitly included in the backup, then the name used will be that of the component defining the component set of which the component managing the file set is a subcomponent.</span></span>

<span data-ttu-id="60cf8-131">I writer verificano se i set di file di uno dei relativi componenti sono stati ripristinati nel mapping di un percorso alternativo chiamando [**IVssComponent:: GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span><span class="sxs-lookup"><span data-stu-id="60cf8-131">Writers verify whether file sets from one of their components were restored to an alternate location mapping by calling [**IVssComponent::GetAlternateLocationMapping**](/windows/desktop/api/VsWriter/nf-vswriter-ivsscomponent-getalternatelocationmapping).</span></span>

 

 



