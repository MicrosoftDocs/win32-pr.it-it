---
description: Processo di creazione della copia shadow
ms.assetid: ca484eec-31c6-4790-9232-3ed67263f6fb
title: Processo di creazione della copia shadow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4239e2b671edcaeb35b404d9b9411b43316c0212
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103751599"
---
# <a name="the-shadow-copy-creation-process"></a><span data-ttu-id="6c441-103">Processo di creazione della copia shadow</span><span class="sxs-lookup"><span data-stu-id="6c441-103">The Shadow Copy Creation Process</span></span>

<span data-ttu-id="6c441-104">Di seguito è riportata una descrizione dettagliata del ruolo del provider hardware nella creazione di un set di copie shadow.</span><span class="sxs-lookup"><span data-stu-id="6c441-104">The following is a detailed description of the hardware provider's role in the creation of a shadow copy set.</span></span> <span data-ttu-id="6c441-105">Per un diagramma di questo processo, vedere [creazione di copie shadow per i provider](shadow-copy-creation-for-providers.md).</span><span class="sxs-lookup"><span data-stu-id="6c441-105">For a diagram of this process, see [Shadow Copy Creation for Providers](shadow-copy-creation-for-providers.md).</span></span>

1.  <span data-ttu-id="6c441-106">Quando il richiedente aggiunge ogni volume al set di copie shadow, VSS determina i LUN associati.</span><span class="sxs-lookup"><span data-stu-id="6c441-106">As the requester adds each volume to the shadow copy set, VSS determines the associated LUNs.</span></span> <span data-ttu-id="6c441-107">Ad esempio, un volume con spanning potrebbe essere composto da più lun.</span><span class="sxs-lookup"><span data-stu-id="6c441-107">For example, a spanned volume could be composed of multiple LUNs.</span></span> <span data-ttu-id="6c441-108">VSS crea [**\_ \_ le informazioni iniziali del LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) usando le informazioni sul dispositivo fisico per ogni lun.</span><span class="sxs-lookup"><span data-stu-id="6c441-108">VSS creates an initial [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) using physical device information for each LUN.</span></span>
2.  <span data-ttu-id="6c441-109">VSS chiama [**AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) per determinare se il provider supporta una copia shadow per il lun.</span><span class="sxs-lookup"><span data-stu-id="6c441-109">VSS calls [**AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported) to determine if the provider supports a shadow copy for that LUN.</span></span> <span data-ttu-id="6c441-110">Il provider hardware utilizza le [**\_ \_ informazioni del LUN VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) per determinare se i LUN sono supportati.</span><span class="sxs-lookup"><span data-stu-id="6c441-110">The hardware provider uses the [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) to determine whether the LUNs are supported.</span></span> <span data-ttu-id="6c441-111">Questa determinazione deve essere costituita solo da un valore qualsiasi, ovvero lo stesso provider hardware deve supportare tutti i LUN che contribuiscono a un volume specifico.</span><span class="sxs-lookup"><span data-stu-id="6c441-111">This determination must be all or nothing—the same hardware provider must support all LUNs contributing to a specific volume.</span></span> <span data-ttu-id="6c441-112">Nell'esempio relativo al volume con spanning, il provider non può indicare che supporta solo uno dei LUN che comprendono il volume.</span><span class="sxs-lookup"><span data-stu-id="6c441-112">In the spanned volume example, the provider cannot indicate that it supports only one of the LUNs that comprise the volume.</span></span>
3.  <span data-ttu-id="6c441-113">Per ogni volume nel set di copie shadow, VSS chiama [**IVssHardwareSnapshotProvider:: BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot) con la stessa matrice di strutture di [**\_ \_ informazioni lun VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) .</span><span class="sxs-lookup"><span data-stu-id="6c441-113">For each volume in the shadow copy set, VSS calls [**IVssHardwareSnapshotProvider::BeginPrepareSnapshot**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-beginpreparesnapshot) with the same array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures.</span></span> <span data-ttu-id="6c441-114">All'interno di una singola chiamata, tutti i LUN nella matrice sono univoci, ma lo stesso LUN può essere visualizzato in una chiamata successiva ogni volta che lo stesso LUN contribuisce a più volumi.</span><span class="sxs-lookup"><span data-stu-id="6c441-114">Within a single call, all LUNs in the array are unique, but the same LUN may appear in a subsequent call whenever the same LUN contributes to multiple volumes.</span></span> <span data-ttu-id="6c441-115">Il provider deve gestire correttamente tale caso.</span><span class="sxs-lookup"><span data-stu-id="6c441-115">The provider must handle that case correctly.</span></span>
4.  <span data-ttu-id="6c441-116">Subito dopo [**IVssProviderCreateSnapshotSet:: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots), il servizio Copia Shadow del volume imposta i flag di sola lettura, nascosti, nessuna lettera di unità e copia shadow su tutti i LUN interessati.</span><span class="sxs-lookup"><span data-stu-id="6c441-116">Immediately after [**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots), VSS will set the read-only, hidden, no drive letter, and shadow copy flags on all affected LUNs.</span></span> <span data-ttu-id="6c441-117">I flag vengono implementati usando settori nascosti nei dischi MBR o BITS specifici del sistema operativo nella voce di intestazione della partizione nei dischi GPT.</span><span class="sxs-lookup"><span data-stu-id="6c441-117">The flags are implemented using hidden sectors on MBR disks or operating-system-specific bits in the partition header entry on GPT disks.</span></span> <span data-ttu-id="6c441-118">I flag comporteranno la superficie di tutti i volumi sui dischi interessati nei computer riceventi come di sola lettura e nascosti.</span><span class="sxs-lookup"><span data-stu-id="6c441-118">The flags will cause all volumes on the affected disks to be surfaced on the receiving machines as read-only and hidden.</span></span> <span data-ttu-id="6c441-119">Si noti che in questa fase non è stato eseguito il commit dei lun copiati in Shadow, quindi, in caso di arresto anomalo del sistema, i flag verranno cancellati e il LUN originale non sarà interessato.</span><span class="sxs-lookup"><span data-stu-id="6c441-119">Note that the shadow-copied LUNs have not been committed at this stage, so that in the event of a system crash, the flags will be cleared and the original LUN will not be affected.</span></span> <span data-ttu-id="6c441-120">Ovvero tutti i volumi nel LUN originale verranno considerati normali, mantenendo le assegnazioni di lettera di unità, le cartelle montate e lo stato di lettura/scrittura originali.</span><span class="sxs-lookup"><span data-stu-id="6c441-120">That is, all volumes on the original LUN will be treated as normal—and keep their original drive-letter assignments, mounted folders, and read/write status.</span></span>
    > [!Note]  
    > <span data-ttu-id="6c441-121">I provider non devono tentare di modificare i flag LUN.</span><span class="sxs-lookup"><span data-stu-id="6c441-121">Providers should not attempt to modify any of the LUN flags.</span></span>

     

5.  <span data-ttu-id="6c441-122">In [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), viene eseguito il commit dei lun delle copie shadow.</span><span class="sxs-lookup"><span data-stu-id="6c441-122">At [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), the shadow copy LUNs are committed.</span></span> <span data-ttu-id="6c441-123">**CommitSnapshots** deve essere restituito entro pochi secondi o l'intero processo di creazione della copia shadow avrà probabilmente esito negativo.</span><span class="sxs-lookup"><span data-stu-id="6c441-123">**CommitSnapshots** should be returned within a few seconds or the whole shadow copy creation process will probably fail.</span></span>
6.  <span data-ttu-id="6c441-124">Dopo [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), VSS Cancella i flag su tutti i LUN originali necessari per la copia shadow.</span><span class="sxs-lookup"><span data-stu-id="6c441-124">After [**CommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-commitsnapshots), VSS clears the flags on all original LUNs involved in the shadow copy.</span></span> <span data-ttu-id="6c441-125">Poiché è stato eseguito il commit dei lun delle copie shadow, i LUN della copia shadow mantengono questi flag.</span><span class="sxs-lookup"><span data-stu-id="6c441-125">Since the shadow copy LUNs have been committed at this point, the shadow copy LUNs retain these flags.</span></span>
7.  <span data-ttu-id="6c441-126">Dopo [**IVssProviderCreateSnapshotSet::P ostcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots), VSS Cancella i flag lun (impostati dopo [**IVssProviderCreateSnapshotSet:: EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)) e invia una notifica ai writer per sbloccarli.</span><span class="sxs-lookup"><span data-stu-id="6c441-126">After [**IVssProviderCreateSnapshotSet::PostCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postcommitsnapshots), VSS clears the LUN flags (that it set after [**IVssProviderCreateSnapshotSet::EndPrepareSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-endpreparesnapshots)) and notifies the writers to thaw.</span></span> <span data-ttu-id="6c441-127">VSS chiama quindi i metodi [**IVssProviderCreateSnapshotSet::P refinalcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-prefinalcommitsnapshots) e [**IVssProviderCreateSnapshotSet::P ostfinalcommitsnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postfinalcommitsnapshots) del provider.</span><span class="sxs-lookup"><span data-stu-id="6c441-127">VSS then calls the provider's [**IVssProviderCreateSnapshotSet::PreFinalCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-prefinalcommitsnapshots) and [**IVssProviderCreateSnapshotSet::PostFinalCommitSnapshots**](/windows/desktop/api/VsProv/nf-vsprov-ivssprovidercreatesnapshotset-postfinalcommitsnapshots) methods.</span></span>
8.  <span data-ttu-id="6c441-128">VSS recupera una matrice di strutture di [**\_ \_ informazioni lun VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) , una per ogni LUN di copia shadow appena creato, chiamando [**IVssHardwareSnapshotProvider:: GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns).</span><span class="sxs-lookup"><span data-stu-id="6c441-128">VSS retrieves an array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures, one for each newly created shadow copy LUN, by calling [**IVssHardwareSnapshotProvider::GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns).</span></span> <span data-ttu-id="6c441-129">Il provider deve fornire informazioni sufficienti per consentire a VSS e al provider di identificare le copie shadow in un secondo momento e in qualsiasi sistema connesso al sottosistema.</span><span class="sxs-lookup"><span data-stu-id="6c441-129">The provider must provide enough information to allow VSS and the provider to identify the shadow copies at any later time and on any system connected to the subsystem.</span></span> <span data-ttu-id="6c441-130">Al momento, i LUN delle copie shadow non devono essere accessibili a questo computer. il provider deve usare un meccanismo diverso da semplicemente leggendo le informazioni del LUN.</span><span class="sxs-lookup"><span data-stu-id="6c441-130">At this time, the shadow copy LUNs should be inaccessible to this machine—the provider must use some mechanism other than by simply reading the information from the LUN.</span></span>
9.  <span data-ttu-id="6c441-131">Per le copie shadow trasportabili, VSS aggiunge quanto segue al documento componenti di backup che descrive il set di copie shadow:</span><span class="sxs-lookup"><span data-stu-id="6c441-131">For transportable shadow copies, VSS appends the following to the Backup Components Document describing the shadow copy set:</span></span>
    1.  <span data-ttu-id="6c441-132">Matrice di [**\_ \_ informazioni lun VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) lun originale.</span><span class="sxs-lookup"><span data-stu-id="6c441-132">The original LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array.</span></span>
    2.  <span data-ttu-id="6c441-133">La nuova matrice di [**\_ \_ informazioni lun VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) di copia shadow.</span><span class="sxs-lookup"><span data-stu-id="6c441-133">The new shadow copy LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array.</span></span>
    3.  <span data-ttu-id="6c441-134">Extent del disco per ogni volume nel set di copie shadow.</span><span class="sxs-lookup"><span data-stu-id="6c441-134">The disk extents for each volume in the shadow copy set.</span></span>
10. <span data-ttu-id="6c441-135">Per le copie shadow di importazione automatica, inizia il processo di importazione.</span><span class="sxs-lookup"><span data-stu-id="6c441-135">For auto-import shadow copies, the import process begins.</span></span> <span data-ttu-id="6c441-136">In [**IVssHardwareSnapshotProvider:: LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns)al provider verranno fornite le [**\_ \_ informazioni relative al lun VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) generate in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) al momento della creazione.</span><span class="sxs-lookup"><span data-stu-id="6c441-136">In [**IVssHardwareSnapshotProvider::LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), the provider will be given the [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) generated in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) at creation time.</span></span> <span data-ttu-id="6c441-137">Durante **LocateLuns**, il provider deve rendere visibili al sistema tali LUN di copia shadow.</span><span class="sxs-lookup"><span data-stu-id="6c441-137">During **LocateLuns**, the provider should make those shadow copy LUNs visible to the system.</span></span> <span data-ttu-id="6c441-138">Il provider non deve causare una ripetizione dell'analisi del bus.</span><span class="sxs-lookup"><span data-stu-id="6c441-138">The provider should not cause a bus rescan.</span></span> <span data-ttu-id="6c441-139">VSS determinerà la ripetizione dell'analisi e l'enumerazione per consentire l'individuazione dei LUN da parte di PNP e i volumi da portare online.</span><span class="sxs-lookup"><span data-stu-id="6c441-139">VSS will cause the rescan and enumeration to allow the LUNs to be discovered by PNP and the volumes to come online.</span></span>
11. <span data-ttu-id="6c441-140">VSS chiama [**IVssHardwareSnapshotProvider:: FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) per i dischi appena arrivati nel sistema.</span><span class="sxs-lookup"><span data-stu-id="6c441-140">VSS calls [**IVssHardwareSnapshotProvider::FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) for the newly arrived disks in the system.</span></span> <span data-ttu-id="6c441-141">VSS usa la matrice di [**\_ \_ informazioni**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) del LUN VDS di copia shadow da **FillInLunInfo**, confrontandolo con **le \_ \_ informazioni relative al lun VDS** generate durante la creazione in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) e gli extent del disco per ogni volume nel set di copie shadow per identificare i LUN delle copie shadow appena raggiunte.</span><span class="sxs-lookup"><span data-stu-id="6c441-141">VSS uses the shadow copy LUN [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) array from **FillInLunInfo**, comparing it with the **VDS\_LUN\_INFORMATION** generated during creation in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) and the disk extents for each volume in the shadow copy set to identify the newly arrived shadow copy LUNs.</span></span>
12. <span data-ttu-id="6c441-142">A questo punto, tutti i volumi contenuti nei lun delle copie shadow sono montati nascosti e di sola lettura e VSS dispone di un mapping dal volume originale al volume di copia shadow.</span><span class="sxs-lookup"><span data-stu-id="6c441-142">At this point, all volumes contained on the shadow copy LUNs are mounted hidden and read-only, and VSS has a mapping from original volume to shadow copy volume.</span></span>

<span data-ttu-id="6c441-143">Poiché un singolo LUN può contenere parti di più volumi, il set di lun delle copie shadow può includere volumi "aggiuntivi".</span><span class="sxs-lookup"><span data-stu-id="6c441-143">Because a single LUN can contain portions of multiple volumes, the set of shadow copy LUNs may include "extra" volumes.</span></span> <span data-ttu-id="6c441-144">Questi volumi non fanno parte del set di copie shadow e non devono essere usati perché non sono necessariamente coerenti.</span><span class="sxs-lookup"><span data-stu-id="6c441-144">Those volumes are not part of the shadow copy set and should not be used as they are not guaranteed to be consistent.</span></span>

<span data-ttu-id="6c441-145">Dopo l'importazione, è possibile accedere alla copia shadow tramite il metodo [**IVssBackupComponents:: query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query) .</span><span class="sxs-lookup"><span data-stu-id="6c441-145">After import, the shadow copy can be accessed via the [**IVssBackupComponents::Query**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-query) method.</span></span> <span data-ttu-id="6c441-146">Una copia shadow può essere esposta anche come lettera di unità, cartella montata o condivisione usando [**IVssBackupComponents:: ExposeSnapshot**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-exposesnapshot).</span><span class="sxs-lookup"><span data-stu-id="6c441-146">A shadow copy can also be exposed as a drive letter, mounted folder, or share using [**IVssBackupComponents::ExposeSnapshot**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-exposesnapshot).</span></span> <span data-ttu-id="6c441-147">Un set di copie shadow può anche essere convertito in un LUN normale usando il metodo [**IVssBackupComponents:: BreakSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-breaksnapshotset) .</span><span class="sxs-lookup"><span data-stu-id="6c441-147">A shadow copy set may also be converted to a regular LUN by using the [**IVssBackupComponents::BreakSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-breaksnapshotset) method.</span></span> <span data-ttu-id="6c441-148">Le applicazioni di gestione possono usare le API di gestione del disco appropriate per gestire ulteriormente il LUN, ad esempio la modifica degli attributi di lettura/scrittura.</span><span class="sxs-lookup"><span data-stu-id="6c441-148">From there management applications can use appropriate disk management APIs to further manage the LUN (such as changing the read/write attributes).</span></span>

### <a name="transportable-shadow-copies-on-a-san"></a><span data-ttu-id="6c441-149">Copie shadow trasportabili in una rete SAN</span><span class="sxs-lookup"><span data-stu-id="6c441-149">Transportable Shadow Copies on a SAN</span></span>

<span data-ttu-id="6c441-150">A partire da Windows Server 2003, Datacenter Edition e Windows Server 2003, Enterprise Edition, VSS consente i set di copie shadow trasportabili in una rete SAN.</span><span class="sxs-lookup"><span data-stu-id="6c441-150">Beginning with Windows Server 2003, Datacenter Edition and Windows Server 2003, Enterprise Edition, VSS enables transportable shadow copy sets on a SAN.</span></span> <span data-ttu-id="6c441-151">Dal punto di vista di un provider in grado di trasportare i LUN tra gli host, non esiste una differenza minima tra un set non transportabile e una copia shadow trasportabile.</span><span class="sxs-lookup"><span data-stu-id="6c441-151">From the point of view of a provider capable of transporting LUNs between hosts, there is little or no difference between a non-transportable and a transportable shadow copy set.</span></span>

<span data-ttu-id="6c441-152">**Windows server 2003, Standard Edition, Windows server 2003, Web Edition e Windows XP:** I set di copie shadow trasportabili non sono supportati.</span><span class="sxs-lookup"><span data-stu-id="6c441-152">**Windows Server 2003, Standard Edition, Windows Server 2003, Web Edition and Windows XP:** Transportable shadow copy sets are not supported.</span></span> <span data-ttu-id="6c441-153">Tutte le edizioni di Windows Server 2003 con Service Pack 1 (SP1) supportano set di copie shadow trasportabili.</span><span class="sxs-lookup"><span data-stu-id="6c441-153">All editions of Windows Server 2003 with Service Pack 1 (SP1) support transportable shadow copy sets.</span></span>

<span data-ttu-id="6c441-154">I set di copie shadow trasportabili devono essere creati con l'attributo **\_ \_ \_ Transportable VSS VolSnap attr** aggiunto al contesto della copia shadow descritto dall'enumerazione [**\_ VSS \_ volume \_ snapshot \_ Attributes**](/windows/desktop/api/Vss/ne-vss-vss_volume_snapshot_attributes) .</span><span class="sxs-lookup"><span data-stu-id="6c441-154">Transportable shadow copy sets must be created with the **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE** attribute added to the shadow copy context described by the [**\_VSS\_VOLUME\_SNAPSHOT\_ATTRIBUTES**](/windows/desktop/api/Vss/ne-vss-vss_volume_snapshot_attributes) enumeration.</span></span> <span data-ttu-id="6c441-155">Tutti i volumi nel set devono essere trasportabili.</span><span class="sxs-lookup"><span data-stu-id="6c441-155">All volumes in the set must be transportable.</span></span> <span data-ttu-id="6c441-156">Restituendo esito positivo da [**IVssHardwareSnapshotProvider:: AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported), il provider indica che non solo supporta il lun, ma anche che può trasportare il lun.</span><span class="sxs-lookup"><span data-stu-id="6c441-156">By returning success from [**IVssHardwareSnapshotProvider::AreLunsSupported**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-arelunssupported), the provider is indicating that not only does it support the LUN, but also that it can transport the LUN.</span></span> <span data-ttu-id="6c441-157">La creazione di un set di copie shadow trasportabili si conclude quando VSS registra le informazioni LUN nel documento componenti di backup.</span><span class="sxs-lookup"><span data-stu-id="6c441-157">The creation of a transportable shadow copy set concludes when VSS records the LUN information in the Backup Components Document.</span></span> <span data-ttu-id="6c441-158">Un set di copie shadow può essere importato solo una volta dopo la creazione iniziale.</span><span class="sxs-lookup"><span data-stu-id="6c441-158">A shadow copy set may only be imported once after initial creation.</span></span>

<span data-ttu-id="6c441-159">Nel computer ricevente, il richiedente importa il set di copie shadow.</span><span class="sxs-lookup"><span data-stu-id="6c441-159">On the receiving machine, the requester imports the shadow copy set.</span></span> <span data-ttu-id="6c441-160">Il metodo [**IVssBackupComponents:: ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) usa il documento relativo ai componenti di backup che descrive il set di copie shadow come input.</span><span class="sxs-lookup"><span data-stu-id="6c441-160">The [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) method uses the Backup Components Document describing the shadow copy set as input.</span></span> <span data-ttu-id="6c441-161">Importazione di procedimenti per:</span><span class="sxs-lookup"><span data-stu-id="6c441-161">Importing proceeds by:</span></span>

1.  <span data-ttu-id="6c441-162">VSS crea una matrice di strutture di [**informazioni del \_ lun \_ VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) della copia shadow dal documento dei componenti di backup.</span><span class="sxs-lookup"><span data-stu-id="6c441-162">VSS constructs an array of shadow copy [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures from the Backup Components Document.</span></span>
2.  <span data-ttu-id="6c441-163">Quando VSS chiama [**IVssHardwareSnapshotProvider:: LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), la matrice di strutture di [**\_ \_ informazioni lun VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) generate in [**IVssHardwareSnapshotProvider:: GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) verrà passata al provider.</span><span class="sxs-lookup"><span data-stu-id="6c441-163">When VSS calls [**IVssHardwareSnapshotProvider::LocateLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-locateluns), the array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures generated in [**IVssHardwareSnapshotProvider::GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) will be passed to the provider.</span></span> <span data-ttu-id="6c441-164">Durante l'elaborazione di questo metodo, il provider deve rendere visibili al sistema tali LUN di copia shadow.</span><span class="sxs-lookup"><span data-stu-id="6c441-164">While processing this method, the provider should make those shadow copy LUNs visible to the system.</span></span> <span data-ttu-id="6c441-165">Il provider non deve causare una ripetizione dell'analisi del bus.</span><span class="sxs-lookup"><span data-stu-id="6c441-165">The provider should not cause a bus rescan.</span></span> <span data-ttu-id="6c441-166">VSS attiverà la ripetizione dell'analisi e l'enumerazione per consentire l'individuazione dei LUN da parte di PNP e i volumi da riportare online.</span><span class="sxs-lookup"><span data-stu-id="6c441-166">VSS will trigger the rescan and enumeration to allow the LUNs to be discovered by PNP and the volumes to come online.</span></span>
3.  <span data-ttu-id="6c441-167">VSS chiama [**IVssHardwareSnapshotProvider:: FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) per i dischi appena arrivati nel sistema.</span><span class="sxs-lookup"><span data-stu-id="6c441-167">VSS calls [**IVssHardwareSnapshotProvider::FillInLunInfo**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-fillinluninfo) for the newly arrived disks in the system.</span></span> <span data-ttu-id="6c441-168">VSS usa la matrice di LUN copia shadow delle strutture di [**\_ \_ informazioni lun VDS**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) da **FillInLunInfo**, confrontandolo con **le \_ \_ informazioni relative al lun VDS** generate durante la creazione del set di copie shadow in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) e gli extent del disco per ogni volume nel set di copie shadow per identificare i LUN delle copie shadow appena raggiunte.</span><span class="sxs-lookup"><span data-stu-id="6c441-168">VSS uses the shadow copy LUN array of [**VDS\_LUN\_INFORMATION**](/windows/win32/api/vdslun/ns-vdslun-vds_lun_information) structures from **FillInLunInfo**, comparing it with the **VDS\_LUN\_INFORMATION** generated during shadow copy set creation in [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) and the disk extents for each volume in the shadow copy set to identify the newly arrived shadow copy LUNs.</span></span>
4.  <span data-ttu-id="6c441-169">A questo punto, tutti i volumi contenuti nei lun trasportati vengono montati come nascosti e in sola lettura e VSS dispone di un mapping dal volume originale al volume di copia shadow.</span><span class="sxs-lookup"><span data-stu-id="6c441-169">At this point, all volumes contained on the transported LUNs are mounted hidden and read-only and VSS has a mapping from the original volume to the shadow copy volume.</span></span>

<span data-ttu-id="6c441-170">Sia per il singolo computer che per il caso trasportabile, la sequenza è simile a partire dal punto in cui viene chiamato [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) .</span><span class="sxs-lookup"><span data-stu-id="6c441-170">For both the single machine and transportable case, the sequence is similar starting with the point that [**GetTargetLuns**](/windows/desktop/api/VsProv/nf-vsprov-ivsshardwaresnapshotprovider-gettargetluns) is called.</span></span> <span data-ttu-id="6c441-171">Per l'importazione automatica, i passaggi vengono eseguiti direttamente dopo la creazione.</span><span class="sxs-lookup"><span data-stu-id="6c441-171">For auto-import, the steps happen directly after creation.</span></span>

 

 
