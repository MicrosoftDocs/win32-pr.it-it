---
description: A volte è consigliabile creare una copia shadow in un sistema, ma usare la copia shadow in un secondo sistema.
ms.assetid: 4ec63917-03c0-434e-892e-3d9d4c47740e
title: Importazione di volumi di copie shadow trasportabili
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3d259fbc047d088ee1f7064804a3ee98fe48da1b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104131279"
---
# <a name="importing-transportable-shadow-copied-volumes"></a><span data-ttu-id="62392-103">Importazione di volumi di copie shadow trasportabili</span><span class="sxs-lookup"><span data-stu-id="62392-103">Importing Transportable Shadow Copied Volumes</span></span>

<span data-ttu-id="62392-104">A volte è consigliabile creare una copia shadow in un sistema, ma usare la copia shadow in un secondo sistema.</span><span class="sxs-lookup"><span data-stu-id="62392-104">It is sometimes desirable to create a shadow copy on one system, but use the shadow copy on a second system.</span></span>

<span data-ttu-id="62392-105">Si consideri il caso in cui i dati di cui eseguire il backup vengono in genere gestiti da un determinato sistema (*systemOne*) durante le normali operazioni e che questi dati vengono archiviati fisicamente in un array di archiviazione o in un dispositivo.</span><span class="sxs-lookup"><span data-stu-id="62392-105">Consider the case where data to be backed up is normally managed by a given system (*systemOne*) during normal operations, and that this data is physically stored on a storage array or an appliance.</span></span>

<span data-ttu-id="62392-106">Per ridurre al minimo eventuali problemi di *systemOne* (poiché le operazioni di backup possono richiedere un utilizzo intensivo delle risorse), è consigliabile eseguire il backup mediante *systemTwo*, un server di backup, che ha accesso allo stesso array di archiviazione di *systemOne*.</span><span class="sxs-lookup"><span data-stu-id="62392-106">To minimize any disruption to *systemOne* (because backup operations can be resource intensive), it is desirable to perform the backup using *systemTwo*, a backup server, which has access to the same storage array as *systemOne*.</span></span>

<span data-ttu-id="62392-107">Per garantire una copia shadow corretta, cooperando con i writer in *systemOne* e mantenendo lo stato appropriato per le attività in corso, la copia shadow deve essere eseguita da *systemOne*.</span><span class="sxs-lookup"><span data-stu-id="62392-107">To ensure a proper shadow copy—cooperating with the writers on *systemOne* and preserving the state appropriately for ongoing tasks—the shadow copy should be performed by *systemOne*.</span></span>

<span data-ttu-id="62392-108">Pertanto, *systemOne* deve creare una [*copia shadow trasportabile*](vssgloss-t.md), che verrà quindi importata da *systemTwo* .</span><span class="sxs-lookup"><span data-stu-id="62392-108">Therefore, *systemOne* must create a [*transportable shadow copy*](vssgloss-t.md), which *systemTwo* will then import.</span></span>

<span data-ttu-id="62392-109">**Windows server 2003, Standard Edition, Windows server 2003, Web Edition e Windows XP:** I set di copie shadow trasportabili non sono supportati.</span><span class="sxs-lookup"><span data-stu-id="62392-109">**Windows Server 2003, Standard Edition, Windows Server 2003, Web Edition and Windows XP:** Transportable shadow copy sets are not supported.</span></span> <span data-ttu-id="62392-110">Tutte le edizioni di Windows Server 2003 con Service Pack 1 (SP1) supportano set di copie shadow trasportabili.</span><span class="sxs-lookup"><span data-stu-id="62392-110">All editions of Windows Server 2003 with Service Pack 1 (SP1) support transportable shadow copy sets.</span></span>

<span data-ttu-id="62392-111">Un esempio tipico di importazione di una copia shadow trasportabile può procedere nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="62392-111">A typical example of importing a transportable shadow copy can proceed in the following way:</span></span>

1.  <span data-ttu-id="62392-112">Inizialmente, l'unità logica (LUN) fornita dall'array di archiviazione viene montata come volume in *systemOne* (ad esempio, F:).</span><span class="sxs-lookup"><span data-stu-id="62392-112">Initially, the logical unit (LUN) that is provided by the storage array is mounted as a volume on *systemOne* (say, F:).</span></span>
2.  <span data-ttu-id="62392-113">Un richiedente in esecuzione su *systemOne* crea un'istanza di [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) e procede come se fosse preparato per un backup.</span><span class="sxs-lookup"><span data-stu-id="62392-113">A requester that is running on *systemOne* instantiates an instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) and proceeds as if it were preparing for a backup.</span></span> <span data-ttu-id="62392-114">Per ulteriori informazioni, vedere [Panoramica dell'inizializzazione del backup](overview-of-backup-initialization.md), [Panoramica della fase di individuazione dei backup](overview-of-the-backup-discovery-phase.md)e [Panoramica delle attività di pre-backup](overview-of-pre-backup-tasks.md) .</span><span class="sxs-lookup"><span data-stu-id="62392-114">(See [Overview of Backup Initialization](overview-of-backup-initialization.md), [Overview of the Backup Discovery Phase](overview-of-the-backup-discovery-phase.md), and [Overview of Pre-Backup Tasks](overview-of-pre-backup-tasks.md) for more information.)</span></span>
3.  <span data-ttu-id="62392-115">Il richiedente in *systemOne* modifica il contesto di copia shadow usato in genere per l'operazione di backup locale (**\_ backup dell' \_ app \_ VSS CTX**) per indicare che verrà creata una copia shadow trasportabile (**VSS \_ VolSnap \_ attr \_ Transportable**).</span><span class="sxs-lookup"><span data-stu-id="62392-115">The requester on *systemOne* modifies the shadow copy context that is typically used for local backup operation (**VSS\_CTX\_APP\_BACKUP**) to indicate that a transportable shadow copy will be created (**VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**).</span></span> <span data-ttu-id="62392-116">L'attributo trasportabile può essere aggiunto anche ad altri contesti di copia shadow.</span><span class="sxs-lookup"><span data-stu-id="62392-116">The transportable attribute can be added to other shadow copy contexts as well.</span></span>
4.  <span data-ttu-id="62392-117">Con un contesto di copia shadow **di \_ VSS CTX \_ app \_ backup** \| **VSS \_ VolSnap \_ attr \_ Transportable**, il richiedente in *systemOne* crea una copia shadow chiamando [**IVssBackupComponents::D osnapshotset**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span><span class="sxs-lookup"><span data-stu-id="62392-117">With a shadow copy context of **VSS\_CTX\_APP\_BACKUP** \| **VSS\_VOLSNAP\_ATTR\_TRANSPORTABLE**, the requester that is on *systemOne* creates a shadow copy by calling [**IVssBackupComponents::DoSnapshotSet**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-dosnapshotset).</span></span>
5.  <span data-ttu-id="62392-118">*SystemOne* utilizza [**IVssBackupComponents:: saveasxml**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) per salvare lo stato corrente del documento dei componenti di backup e [**IVssExamineWriterMetadata:: saveasxml**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml) per salvare i documenti di metadati del writer del writer.</span><span class="sxs-lookup"><span data-stu-id="62392-118">*SystemOne* uses [**IVssBackupComponents::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-saveasxml) to save the current state of the Backup Components Document and [**IVssExamineWriterMetadata::SaveAsXML**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssexaminewritermetadata-saveasxml) to save each writer's Writer Metadata Documents.</span></span> <span data-ttu-id="62392-119">Le stringhe XML che contengono questi documenti vengono quindi rese disponibili a un richiedente in esecuzione in *systemTwo*.</span><span class="sxs-lookup"><span data-stu-id="62392-119">The XML strings that contain these documents are then made available to a requester that is running on *systemTwo*.</span></span>

    <span data-ttu-id="62392-120">Il richiedente trasferisce il documento componenti di backup in *systemTwo*.</span><span class="sxs-lookup"><span data-stu-id="62392-120">The requester transfers the Backup Components Document to *systemTwo*.</span></span>

    <span data-ttu-id="62392-121">Si noti che il richiedente in *systemOne* non rilascia la propria istanza di [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) in questa fase se lo scopo della copia shadow è per il backup.</span><span class="sxs-lookup"><span data-stu-id="62392-121">Note that the requester on *systemOne* does not release its instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) at this point if the purpose of the shadow copy is for backup.</span></span> <span data-ttu-id="62392-122">L'interfaccia deve rimanere aperta fino a quando *systemTwo* non completa correttamente le operazioni di backup.</span><span class="sxs-lookup"><span data-stu-id="62392-122">The interface should remain open until *systemTwo* successfully finishes its backup operations.</span></span> <span data-ttu-id="62392-123">Solo a questo punto il richiedente emette un evento [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) poiché alcuni writer troncano i log ed eseguono altre operazioni dopo un backup riuscito.</span><span class="sxs-lookup"><span data-stu-id="62392-123">Only then should the requester issue a [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event since some writers will truncate logs and do other work after a successful backup.</span></span> <span data-ttu-id="62392-124">Se l'obiettivo della copia shadow è data mining o altri scopi, l'interfaccia può essere chiusa in questo passaggio.</span><span class="sxs-lookup"><span data-stu-id="62392-124">If the goal of the shadow copy is data mining or other purposes, then the interface can be closed at this step.</span></span>

6.  <span data-ttu-id="62392-125">Il richiedente in *systemTwo* chiama quindi [**IVssBackupComponents:: ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) per ottenere l'accesso alla copia shadow creata dal richiedente in *systemOne*.</span><span class="sxs-lookup"><span data-stu-id="62392-125">The requester on *systemTwo* then calls [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) to get access to the shadow copy that was created by the requester on *systemOne*.</span></span>
    > [!Note]  
    > <span data-ttu-id="62392-126">Il richiedente è responsabile della serializzazione dell'operazione di copia shadow di importazione.</span><span class="sxs-lookup"><span data-stu-id="62392-126">The requester is responsible for serializing the import shadow copy operation.</span></span> <span data-ttu-id="62392-127">Se inoltre la chiamata a [**IVssBackupComponents:: ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) ha esito negativo, il servizio Copia Shadow del volume non esegue la pulizia dei lun.</span><span class="sxs-lookup"><span data-stu-id="62392-127">Also, if the call to [**IVssBackupComponents::ImportSnapshots**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-importsnapshots) fails, the VSS won't clean up LUNs on it's own.</span></span> <span data-ttu-id="62392-128">Il richiedente deve avviare la pulizia dei lun.</span><span class="sxs-lookup"><span data-stu-id="62392-128">The requester has to initiate the cleanup of LUNs.</span></span>

     

7.  <span data-ttu-id="62392-129">Il richiedente in *systemTwo* procede con il backup del materiale copia shadow esattamente come se eseguisse il backup di una copia shadow creata da se stessa. vedere [Panoramica del backup effettivo dei file](overview-of-actual-backup-of-files.md).</span><span class="sxs-lookup"><span data-stu-id="62392-129">The requester on *systemTwo* proceeds with the backup of the shadow copied material exactly as if it were backing up a shadow copy that it created by itself (see [Overview of Actual Backup Of Files](overview-of-actual-backup-of-files.md)).</span></span>

    <span data-ttu-id="62392-130">Il richiedente in *systemTwo* Ottiene l' [*oggetto dispositivo*](vssgloss-d.md) della copia shadow usando [**IVssBackupComponents:: GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties) sulla copia shadow importata e lo aggiunge all'inizio dei percorsi file originali ottenuti dai metadati per accedere ai file di cui eseguire il backup.</span><span class="sxs-lookup"><span data-stu-id="62392-130">The requester on *systemTwo* obtains the shadow copy's [*device object*](vssgloss-d.md) using [**IVssBackupComponents::GetSnapshotProperties**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-getsnapshotproperties) on the imported shadow copy and appends that to the beginning of the original file paths that were obtained from the metadata to access files to be backed up.</span></span>

8.  <span data-ttu-id="62392-131">Dopo aver utilizzato la copia shadow, il richiedente in *systemTwo* deve eliminare la copia shadow.</span><span class="sxs-lookup"><span data-stu-id="62392-131">After using the shadow copy, the requester on *systemTwo* must delete the shadow copy.</span></span> <span data-ttu-id="62392-132">Come per le copie shadow non trasportabili, se il contesto della copia shadow indica le copie shadow della versione automatica (ad esempio, il **\_ \_ backup VSS CTX**), il rilascio di [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) in *systemTwo* provocherà l'eliminazione della copia shadow da parte del servizio VSS.</span><span class="sxs-lookup"><span data-stu-id="62392-132">As with non-transportable shadow copies, if the shadow copy context indicates auto-release shadow copies (for example, **VSS\_CTX\_BACKUP**), then releasing the [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents) on *systemTwo* will cause the VSS service to delete the shadow copy.</span></span> <span data-ttu-id="62392-133">In caso contrario, se il contesto indica una copia shadow permanente (ad esempio, il **\_ \_ \_ rollback dell'app VSS CTX**), il richiedente in *systemTwo* deve eliminare in modo esplicito la copia shadow.</span><span class="sxs-lookup"><span data-stu-id="62392-133">Otherwise, if the context indicates a persistent shadow copy (for example, **VSS\_CTX\_APP\_ROLLBACK**), then the requester on *systemTwo* must explicitly delete the shadow copy.</span></span>

    <span data-ttu-id="62392-134">Il richiedente in *systemTwo* segnala al richiedente in *systemOne* che è terminato con il backup della copia shadow trasportabile.</span><span class="sxs-lookup"><span data-stu-id="62392-134">Then the requester on *systemTwo* signals the requester on *systemOne* that it has finished with the backup of the transportable shadow copy.</span></span>

9.  <span data-ttu-id="62392-135">Dopo che il richiedente in *systemOne* ha ricevuto la notifica che il richiedente in *systemTwo* ha completato il backup della copia shadow trasportabile, invia una notifica ai writer del sistema generando un evento [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) con una chiamata a **IVssBackupComponents:: BackupComplete**.</span><span class="sxs-lookup"><span data-stu-id="62392-135">After the requester on *systemOne* has received notification that the requester on *systemTwo* has finished the backup of the transportable shadow copy, it notifies the writers on its system by generating a [**BackupComplete**](/windows/desktop/api/VsBackup/nf-vsbackup-ivssbackupcomponents-backupcomplete) event with a call to **IVssBackupComponents::BackupComplete**.</span></span> <span data-ttu-id="62392-136">A questo punto, il richiedente in *systemOne* è libero di rilasciare l'istanza di [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span><span class="sxs-lookup"><span data-stu-id="62392-136">At this point, the requester on *systemOne* is free to release its instance of [**IVssBackupComponents**](/windows/desktop/api/VsBackup/nl-vsbackup-ivssbackupcomponents).</span></span>

<span data-ttu-id="62392-137">**Copie shadow trasportabili in un cluster:** Le copie shadow trasportabili devono essere importate dall'esterno del cluster, purché il volume originale sia montato all'interno del cluster.</span><span class="sxs-lookup"><span data-stu-id="62392-137">**Transportable shadow copies in a cluster:** Transportable shadow copies must be imported from outside the cluster as long as the original volume is mounted within the cluster.</span></span> <span data-ttu-id="62392-138">Per informazioni sull'implementazione di un ripristino rapido in un cluster, vedere [ripristino rapido con volumi copiati shadow trasportabili](fast-recovery-using-transportable-shadow-copied-volumes.md).</span><span class="sxs-lookup"><span data-stu-id="62392-138">For information about implementing a fast recovery in a cluster, see [Fast Recovery Using Transportable Shadow Copied Volumes](fast-recovery-using-transportable-shadow-copied-volumes.md).</span></span>

 

 



