---
description: In questa sezione vengono Windows messaggi e le code di messaggi.
ms.assetid: 21a4d40b-52da-49e4-a374-afc4927e96e8
title: Informazioni sui messaggi e sulle code di messaggi
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b237b13447abf6a1db2edc698e84755d44b6b3859714ad11af1184c6121ae7be
ms.sourcegitcommit: e858bbe701567d4583c50a11326e42d7ea51804b
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/11/2021
ms.locfileid: "118200857"
---
# <a name="about-messages-and-message-queues"></a>Informazioni sui messaggi e sulle code di messaggi

A differenza delle applicazioni basate su MS-DOS, Windows basate su Windows sono basate su eventi. Non eseguono chiamate di funzione esplicite (ad esempio chiamate della libreria di runtime C) per ottenere l'input. Al contrario, attendono che il sistema passi l'input.

Il sistema passa tutto l'input per un'applicazione alle varie finestre dell'applicazione. Ogni finestra ha una funzione, denominata routine della finestra, che il sistema chiama ogni volta che ha input per la finestra. La routine della finestra elabora l'input e restituisce il controllo al sistema. Per altre informazioni sulle routine della finestra, vedere [Routine della finestra.](window-procedures.md)

Se una finestra di primo livello smette di rispondere ai messaggi per più di alcuni secondi, il sistema considera che la finestra non risponde. In questo caso, il sistema nasconde la finestra e la sostituisce con una finestra fantasma con gli stessi attributi Z order, location, size e visual. In questo modo l'utente può spostarlo, ridimensionarlo o persino chiudere l'applicazione. Tuttavia, queste sono le uniche azioni disponibili perché l'applicazione in realtà non risponde. In modalità debugger, il sistema non genera una finestra fantasma.

In questa sezione vengono illustrati gli argomenti seguenti:

-   [Windows Messaggi](#windows-messages)
-   [Tipi di messaggio](#message-types)
    -   [Messaggi definiti dal sistema](#system-defined-messages)
    -   [Messaggi definiti dall'applicazione](#application-defined-messages)
-   [Routing dei messaggi](#message-routing)
    -   [Messaggi in coda](#queued-messages)
    -   [Messaggi non accodati](#nonqueued-messages)
-   [Gestione dei messaggi](#message-handling)
    -   [Ciclo di messaggi](#message-loop)
    -   [Routine della finestra](#window-procedure)
-   [Filtro messaggi](#message-filtering)
-   [Pubblicazione e invio di messaggi](#posting-and-sending-messages)
    -   [Pubblicazione di messaggi](#posting-messages)
    -   [sending messages](#sending-messages)
-   [Deadlock dei messaggi](#message-deadlocks)
-   [Trasmissione di messaggi](#broadcasting-messages)
-   [Messaggi di query](#query-messages)

## <a name="windows-messages"></a>Windows Messaggi

Il sistema passa l'input a una routine della finestra sotto forma di *messaggio*. I messaggi vengono generati sia dal sistema che dalle applicazioni. Il sistema genera un messaggio a ogni evento di input, ad esempio quando l'utente fa clic, sposta il mouse o fa clic su un controllo, ad esempio una barra di scorrimento. Il sistema genera anche messaggi in risposta alle modifiche apportate al sistema da un'applicazione, ad esempio quando un'applicazione modifica il pool di risorse del tipo di carattere di sistema o ridimensiona una delle relative finestre. Un'applicazione può generare messaggi per indirizzare le proprie finestre per l'esecuzione di attività o per comunicare con le finestre in altre applicazioni.

Il sistema invia un messaggio a una routine della finestra con un set di quattro parametri: un handle di finestra, un identificatore di messaggio e due valori denominati *parametri del messaggio.* *L'handle di* finestra identifica la finestra a cui è destinato il messaggio. Il sistema lo usa per determinare quale routine della finestra deve ricevere il messaggio.

Un *identificatore di* messaggio è una costante denominata che identifica lo scopo di un messaggio. Quando una routine della finestra riceve un messaggio, usa un identificatore di messaggio per determinare come elaborarlo. Ad esempio, l'identificatore di messaggio [**WM \_ PAINT**](/windows/desktop/gdi/wm-paint) indica alla routine della finestra che l'area client della finestra è stata modificata e deve essere ridisegnata.

I parametri del messaggio specificano i dati o il percorso dei dati utilizzati da una routine della finestra durante l'elaborazione di un messaggio. Il significato e il valore dei parametri del messaggio dipendono dal messaggio. Un parametro di messaggio può contenere un numero intero, flag di bit di tipo pack, un puntatore a una struttura contenente dati aggiuntivi e così via. Quando un messaggio non usa parametri di messaggio, vengono in genere impostati su **NULL.** Una routine della finestra deve controllare l'identificatore del messaggio per determinare come interpretare i parametri del messaggio.

## <a name="message-types"></a>Tipi di messaggi

Questa sezione descrive i due tipi di messaggi:

-   [Messaggi definiti dal sistema](#system-defined-messages)
-   [Messaggi definiti dall'applicazione](#application-defined-messages)

### <a name="system-defined-messages"></a>System-Defined messaggi

Il sistema invia o invia *un messaggio definito dal* sistema quando comunica con un'applicazione. Usa questi messaggi per controllare le operazioni delle applicazioni e per fornire input e altre informazioni che le applicazioni possono elaborare. Un'applicazione può anche inviare o inviare messaggi definiti dal sistema. Le applicazioni usano in genere questi messaggi per controllare il funzionamento delle finestre di controllo create usando classi finestra preregistrate.

Ogni messaggio definito dal sistema ha un identificatore di messaggio univoco e una costante simbolica corrispondente (definita nei file di intestazione del Software Development Kit (SDK) che indica lo scopo del messaggio. Ad esempio, la costante [**WM \_ PAINT**](/windows/desktop/gdi/wm-paint) richiede che una finestra dipinga il proprio contenuto.

Le costanti simboliche specificano la categoria a cui appartengono i messaggi definiti dal sistema. Il prefisso della costante identifica il tipo di finestra in grado di interpretare ed elaborare il messaggio. Di seguito sono riportati i prefissi e le categorie di messaggi correlate.



| Prefisso                               | Categoria di messaggi             | Documentazione                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|--------------------------------------|------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ABM** e **ABN**                  | Barra degli strumenti del desktop dell'applicazione  | [Messaggi e notifiche della shell](/windows/desktop/shell/control-panel-applications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **ACM** e **ACN**                  | Controllo Animation            | [Messaggi di controllo animation e](/windows/desktop/Controls/bumper-animation-control-reference-messages) notifiche del controllo [Animation](/windows/desktop/Controls/bumper-animation-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **BCM,** **BCN,** **BM** e **BN** | Controllo Button               | [Messaggi di controllo Pulsante e](/windows/desktop/Controls/bumper-button-control-reference-messages) Notifiche dei controlli [Pulsante](/windows/desktop/Controls/bumper-button-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **CB** e **CBN**                   | ComboBox (controllo)             | [Messaggi del controllo ComboBox e](/windows/desktop/Controls/bumper-combobox-control-reference-messages) [notifiche del controllo ComboBox](/windows/desktop/Controls/bumper-combobox-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **CBEM** e **CBEN**                | Controllo ComboBoxEx           | [Messaggi ComboBoxEx e](/windows/desktop/Controls/bumper-comboboxex-control-reference-messages) [notifiche ComboBoxEx](/windows/desktop/Controls/bumper-comboboxex-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Ccm**                              | Controllo generale              | [Messaggi di controllo](/windows/desktop/Controls/bumper-general-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **CDM**                              | Finestra di dialogo Comune            | [Messaggi comuni delle finestre di dialogo](/windows/desktop/dlgbox/common-dialog-box-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Dfm**                              | Menu di scelta rapida predefinito         | [Messaggi e notifiche della shell](/windows/desktop/shell/control-panel-applications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **DL**                               | Trascinare la casella di riepilogo                | [Trascinare le notifiche della casella di riepilogo](/previous-versions//ff485914(v=vs.85))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **DM**                               | Controllo pulsante di comando predefinito  | [Messaggi della finestra di dialogo](/windows/desktop/dlgbox/dialog-box-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **DTM** e **DTN**                  | Controllo selezione data e ora | [Messaggi di selezione data e ora e](/windows/desktop/Controls/bumper-date-and-time-picker-control-reference-messages) notifiche di selezione data e [ora](/windows/desktop/Controls/bumper-date-and-time-picker-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **EM** ed **EN**                    | Controllo Edit                 | [Modifica messaggi di controllo,](/windows/desktop/Controls/bumper-edit-control-reference-messages) [Notifiche di controllo di modifica,](/windows/desktop/Controls/bumper-edit-control-reference-notifications)Messaggi Rich [Edit](/windows/desktop/Controls/bumper-rich-edit-control-reference-messages)e Notifiche [Rich Edit](/windows/desktop/Controls/bumper-rich-edit-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **HDM** e **HDN**                  | Controllo Header               | [Messaggi di controllo intestazione e](/windows/desktop/Controls/bumper-header-control-reference-messages) notifiche di controllo [intestazione](/windows/desktop/Controls/bumper-header-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **HKM**                              | Controllo tasto di scelta rapida              | [Messaggi di controllo tasto di scelta rapida](/windows/desktop/Controls/bumper-hot-key-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **IPM** e **IPN**                  | controllo indirizzo IP           | [Messaggi di indirizzo IP](/windows/desktop/Controls/bumper-ip-address-control-reference-messages) e [notifiche degli indirizzi IP](/windows/desktop/Controls/bumper-ip-address-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **LB** e **LBN**                   | Controllo casella di riepilogo             | [Messaggi della casella di riepilogo](/windows/desktop/Controls/bumper-list-box-control-reference-messages) e notifiche della casella di [riepilogo](/windows/desktop/Controls/bumper-list-box-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Lm**                               | Controllo SysLink              | [Messaggi di controllo SysLink](/windows/desktop/Controls/bumper-syslink-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **LVM** e **LVN**                  | Controllo visualizzazione elenco            | [Visualizzazione elenco Messaggi](/windows/desktop/Controls/bumper-list-view-control-reference-messages) e [Notifiche visualizzazione elenco](/windows/desktop/Controls/bumper-list-view-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **MCM** e **MCN**                  | Controllo calendario mensile       | [Messaggi del calendario mensile](/windows/desktop/Controls/bumper-month-calendar-control-reference-messages) e [notifiche del calendario mensile](/windows/desktop/Controls/bumper-month-calendar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **gestione basata su criteri**                              | Barra di stato                 | [Messaggi dell'indicatore di stato](/windows/desktop/Controls/bumper-progress-bar-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **PGM** e **PGN**                  | Controllo Pager                | [Messaggi di controllo pager e](/windows/desktop/Controls/bumper-pager-control-reference-messages) [notifiche del controllo Pager](/windows/desktop/Controls/bumper-pager-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **PSM** e **PSN**                  | Finestra delle proprietà               | [Messaggi della finestra delle proprietà](/windows/desktop/Controls/bumper-property-sheets-reference-messages) e notifiche della finestra delle [proprietà](/windows/desktop/Controls/bumper-property-sheets-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **RB** e **RBN**                   | Controllo Rebar                | [Messaggi di controllo Rebar e](/windows/desktop/Controls/bumper-rebar-control-reference-messages) [Notifiche di controllo Rebar](/windows/desktop/Controls/bumper-rebar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **SB** e **SBN**                   | Finestra della barra di stato            | [Messaggi della barra di stato](/windows/desktop/Controls/bumper-status-bars-reference-messages) e notifiche della barra di [stato](/windows/desktop/Controls/bumper-status-bars-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **Sbm**                              | Controllo Scroll Bar           | [Messaggi della barra di scorrimento](/windows/desktop/Controls/bumper-scroll-bars-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Smc**                              | Menu Shell                   | [Messaggi e notifiche della shell](/windows/desktop/shell/control-panel-applications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **STM** e **STN**                  | Controllo statico               | [Messaggi di controllo statico e](/windows/desktop/Controls/bumper-static-control-reference-messages) notifiche di controllo [statico](/windows/desktop/Controls/bumper-static-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **TB** e **TBN**                   | Barra degli strumenti                      | [Messaggi di controllo barra degli strumenti e](/windows/desktop/Controls/bumper-toolbar-control-reference-messages) notifiche dei controlli barra degli [strumenti](/windows/desktop/Controls/bumper-toolbar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **TBM** e **TRBN**                 | Controllo Trackbar             | [Messaggi di controllo Trackbar e](/windows/desktop/Controls/bumper-trackbar-control-reference-messages) [notifiche di controllo Trackbar](/windows/desktop/Controls/bumper-trackbar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **TCM** e **TCN**                  | Controllo Tab                  | [Messaggi di controllo Struttura a schede](/windows/desktop/Controls/bumper-tab-control-reference-messages) e Notifiche del controllo Struttura a [schede](/windows/desktop/Controls/bumper-tab-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **TDM** e **TDN**                  | Finestra di dialogo Attività                  | [Messaggi della finestra di dialogo attività](/windows/desktop/Controls/bumper-task-dialogs-reference-messages) e notifiche della finestra di dialogo [attività](/windows/desktop/Controls/bumper-task-dialogs-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **TTM** e **TTN**                  | Controllo descrizione comando              | [Messaggi di controllo della descrizione comando](/windows/desktop/Controls/bumper-tooltip-control-reference-messages) e [notifiche di controllo della descrizione comando](/windows/desktop/Controls/bumper-tooltip-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **TVM** e **TVN**                  | Controllo visualizzazione struttura ad albero            | [Messaggi della visualizzazione albero e](/windows/desktop/Controls/bumper-tree-view-control-reference-messages) notifiche della visualizzazione [albero](/windows/desktop/Controls/bumper-tree-view-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **UDM** e **UDN**                  | Controllo up-down              | [Messaggi di up-down](/windows/desktop/Controls/bumper-up-down-control-reference-messages) e [notifiche di up-down](/windows/desktop/Controls/bumper-up-down-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Wm**                               | Generale                      | <dl> <dt>[](/windows/desktop/dataxchg/clipboard-messages)</dt> <dt>[](/windows/desktop/dataxchg/clipboard-notifications)</dt> <dt>[](/windows/desktop/dlgbox/common-dialog-box-notifications)</dt> Notifiche degli Appunti Notifiche appunti Comuni notifiche della finestra di dialogo Comuni Notifiche <dt>[](/windows/desktop/Controls/bumper-scroll-bars-reference-notifications)</dt> <dt>[](timer-notifications.md)</dt> <dt>[](window-messages.md)</dt> <dt>[cursore](/windows/desktop/menurc/cursor-notifications)</dt> <dt>[](/windows/desktop/dataxchg/wm-copydata)</dt> Notifica messaggio copia dati <dt>[](multiple-document-interface-messages.md)</dt> <dt>[](/windows/desktop/inputdev/raw-input-notifications)</dt> <dt>[Gestione finestre desktop](/windows/desktop/dwm/dwm-messages)</dt> <dt>[](/windows/desktop/DevIO/device-management-messages)</dt> <dt>[](/windows/desktop/dlgbox/dialog-box-notifications)</dt> messaggi messaggi di gestione del dispositivo finestra di dialogo Notifiche Dynamic Data Exchange messaggi <dt>[](/windows/desktop/menurc/keyboard-accelerator-messages)</dt> <dt>[](/windows/desktop/menurc/keyboard-accelerator-notifications)</dt> <dt>[](/windows/desktop/inputdev/keyboard-input-messages)</dt> <dt>[](/windows/desktop/inputdev/keyboard-input-notifications)</dt> <dt>[](/windows/desktop/dataxchg/dynamic-data-exchange-messages)</dt> <dt>[Dynamic Data Exchange](/windows/desktop/dataxchg/dynamic-data-exchange-notifications)</dt> Notifiche <dt>[Hook](hook-notifications.md)</dt> Notifiche tasti di scelta rapida Tasti di scelta rapida Input tastiera Messaggi input tastiera Notifiche <dt>[menu](/windows/desktop/menurc/menu-notifications)</dt> Notifiche input del <dt>[mouse](/windows/desktop/inputdev/mouse-input-notifications)</dt> Notifiche input del documento Notifiche input non elaborato Notifiche della barra di scorrimento Notifiche timer finestra Notifiche finestra <dt>[Notifiche](window-notifications.md)</dt> </dl> |



 

I messaggi di finestra generali coprono un'ampia gamma di informazioni e richieste, inclusi i messaggi per l'input tramite mouse e tastiera, l'input di menu e finestre di dialogo, la creazione e la gestione delle finestre e Dynamic Data Exchange (DDE).

### <a name="application-defined-messages"></a>Application-Defined messaggi

Un'applicazione può creare messaggi da usare dalle proprie finestre o per comunicare con le finestre in altri processi. Se un'applicazione crea i propri messaggi, la routine della finestra che li riceve deve interpretare i messaggi e fornire l'elaborazione appropriata.

I valori dell'identificatore di messaggio vengono usati come segue:

-   Il sistema riserva i valori dell'identificatore di messaggio nell'intervallo 0x0000 a 0x03FF (il valore [**di WM \_ USER**](wm-user.md)  – 1) per i messaggi definiti dal sistema. Le applicazioni non possono usare questi valori per i messaggi privati.
-   I valori nell'intervallo 0x0400 (il valore di [**WM \_ USER**](wm-user.md)) 0x7FFF disponibili per gli identificatori di messaggio per le classi di finestre private.
-   Se l'applicazione è contrassegnata con la versione 4.0, è possibile usare i valori dell'identificatore di messaggio nell'intervallo 0x8000 ([**WM \_ APP**](wm-app.md)) tramite 0xBFFF per i messaggi privati.
-   Il sistema restituisce un identificatore di messaggio nell'intervallo 0xC000 attraverso 0xFFFF quando un'applicazione chiama la funzione [**RegisterWindowMessage**](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea) per registrare un messaggio. L'identificatore del messaggio restituito da questa funzione è garantito come univoco in tutto il sistema. L'uso di questa funzione impedisce conflitti che possono verificarsi se altre applicazioni usano lo stesso identificatore di messaggio per scopi diversi.

## <a name="message-routing"></a>Routing dei messaggi

Il sistema usa due metodi per instradare i messaggi a una routine di finestra: la pubblicazione di messaggi in una coda first-in e first-out denominata coda di messaggi *,* un oggetto di memoria definito dal sistema che archivia temporaneamente i messaggi e l'invio di messaggi direttamente a una routine della finestra.

Un messaggio inviato a una coda di messaggi viene chiamato messaggio *in coda.* Si tratta principalmente del risultato dell'input dell'utente immesso tramite il mouse o la tastiera, ad esempio i messaggi [**WM \_ MOUSEMOVE,**](/windows/desktop/inputdev/wm-mousemove) [**WM \_ LBUTTONDOWN,**](/windows/desktop/inputdev/wm-lbuttondown) [**WM \_ KEYDOWN**](/windows/desktop/inputdev/wm-keydown)e [**WM \_ CHAR.**](/windows/desktop/inputdev/wm-char) Altri messaggi in coda includono i messaggi timer, paint e quit: [**WM \_ TIMER,**](wm-timer.md) [**WM \_ PAINT**](/windows/desktop/gdi/wm-paint)e [**WM \_ QUIT.**](wm-quit.md) La maggior parte degli altri messaggi, che vengono inviati direttamente a una routine della finestra, sono detti *messaggi non accodati.*

-   [Messaggi in coda](#queued-messages)
-   [Messaggi non accodati](#nonqueued-messages)

### <a name="queued-messages"></a>Messaggi in coda

Il sistema può visualizzare qualsiasi numero di finestre alla volta. Per indirizzare l'input del mouse e della tastiera alla finestra appropriata, il sistema usa le code di messaggi.

Il sistema gestisce una singola coda di messaggi di sistema e una coda di messaggi specifica del thread per ogni thread dell'interfaccia utente grafica. Per evitare il sovraccarico della creazione di una coda di messaggi per thread non GUI, tutti i thread vengono creati inizialmente senza una coda di messaggi. Il sistema crea una coda di messaggi specifica del thread solo quando il thread effettua la prima chiamata a una delle funzioni utente specifiche. Nessuna chiamata di funzione GUI comporta la creazione di una coda di messaggi.

Ogni volta che l'utente sposta il mouse, fa clic sui pulsanti del mouse o si tipi sulla tastiera, il driver di dispositivo per il mouse o la tastiera converte l'input in messaggi e li inserisce nella coda dei messaggi di sistema. Il sistema rimuove i messaggi, uno alla volta, dalla coda dei messaggi di sistema, li esamina per determinare la finestra di destinazione e quindi li invia alla coda dei messaggi del thread che ha creato la finestra di destinazione. La coda di messaggi di un thread riceve tutti i messaggi del mouse e della tastiera per le finestre create dal thread. Il thread rimuove i messaggi dalla coda e indica al sistema di inviarli alla procedura di finestra appropriata per l'elaborazione.

Ad eccezione del messaggio [**WM \_ PAINT,**](/windows/desktop/gdi/wm-paint) del messaggio [**WM \_ TIMER**](wm-timer.md) e del messaggio [**WM \_ QUIT,**](wm-quit.md) il sistema invia sempre messaggi alla fine di una coda di messaggi. Ciò garantisce che una finestra riceva i messaggi di input nella sequenza FIFO (First In, First Out) corretta. Il **messaggio WM \_ PAINT,** il messaggio **WM \_ TIMER** e il messaggio **WM \_ QUIT,** tuttavia, vengono mantenuti nella coda e inoltrati alla routine della finestra solo quando la coda non contiene altri messaggi. Inoltre, più **messaggi WM \_ PAINT** per la stessa finestra vengono combinati in un singolo messaggio **WM \_ PAINT,** consolidando tutte le parti non valide dell'area client in un'unica area. La **\_ combinazione di** messaggi WM PAINT riduce il numero di volte in cui una finestra deve ridisegnare il contenuto della relativa area client.

Il sistema invia un messaggio alla coda di messaggi di un thread compilando una [**struttura MSG**](/windows/win32/api/winuser/ns-winuser-msg) e quindi copiando il messaggio nella coda di messaggi. Le informazioni in **MSG** includono: l'handle della finestra a cui è destinato il messaggio, l'identificatore del messaggio, i due parametri del messaggio, l'ora di invio del messaggio e la posizione del cursore del mouse. Un thread può pubblicare un messaggio nella propria coda di messaggi o nella coda di un altro thread usando la [**funzione PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) o [**PostThreadMessage.**](/windows/win32/api/winuser/nf-winuser-postthreadmessagea)

Un'applicazione può rimuovere un messaggio dalla coda usando la [**funzione GetMessage.**](/windows/win32/api/winuser/nf-winuser-getmessage) Per esaminare un messaggio senza rimuoverlo dalla coda, un'applicazione può usare la [**funzione PeekMessage.**](/windows/win32/api/winuser/nf-winuser-peekmessagea) Questa funzione riempie [**MSG**](/windows/win32/api/winuser/ns-winuser-msg) con informazioni sul messaggio.

Dopo aver rimosso un messaggio dalla coda, un'applicazione può usare la funzione [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) per indirizzare il sistema all'invio del messaggio a una routine di finestra per l'elaborazione. **DispatchMessage** accetta un puntatore a [**MSG**](/windows/win32/api/winuser/ns-winuser-msg) compilato da una chiamata precedente alla [**funzione GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) [**o PeekMessage.**](/windows/win32/api/winuser/nf-winuser-peekmessagea) **DispatchMessage** passa l'handle di finestra, l'identificatore del messaggio e i due parametri del messaggio alla routine della finestra, ma non passa l'ora di invio del messaggio o la posizione del cursore del mouse. Un'applicazione può recuperare queste informazioni chiamando le [**funzioni GetMessageTime**](/windows/win32/api/winuser/nf-winuser-getmessagetime) e [**GetMessagePos**](/windows/win32/api/winuser/nf-winuser-getmessagepos) durante l'elaborazione di un messaggio.

Un thread può usare la [**funzione WaitMessage**](/windows/win32/api/winuser/nf-winuser-waitmessage) per cedere il controllo ad altri thread quando non ha messaggi nella coda di messaggi. La funzione sospende il thread e non restituisce un valore finché non viene inserito un nuovo messaggio nella coda di messaggi del thread.

È possibile chiamare la [**funzione SetMessageExtraInfo**](/windows/win32/api/winuser/nf-winuser-setmessageextrainfo) per associare un valore alla coda di messaggi del thread corrente. Chiamare quindi la [**funzione GetMessageExtraInfo**](/windows/win32/api/winuser/nf-winuser-getmessageextrainfo) per ottenere il valore associato all'ultimo messaggio recuperato dalla [**funzione GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) [**o PeekMessage.**](/windows/win32/api/winuser/nf-winuser-peekmessagea)

### <a name="nonqueued-messages"></a>Messaggi non accodati

I messaggi non accodati vengono inviati immediatamente alla procedura della finestra di destinazione, ignorando la coda di messaggi di sistema e la coda di messaggi del thread. Il sistema in genere invia messaggi non accodati per notificare a una finestra gli eventi che lo interessano. Ad esempio, quando l'utente attiva una nuova finestra dell'applicazione, il sistema invia alla finestra una serie di messaggi, tra cui [**WM \_ ACTIVATE,**](/windows/desktop/inputdev/wm-activate) [**WM \_ SETFOCUS**](/windows/desktop/inputdev/wm-setfocus)e [**WM \_ SETCURSOR.**](/windows/desktop/menurc/wm-setcursor) Questi messaggi notificano alla finestra che è stata attivata, che l'input da tastiera viene indirizzato alla finestra e che il cursore del mouse è stato spostato all'interno dei bordi della finestra. I messaggi non accodati possono verificarsi anche quando un'applicazione chiama determinate funzioni di sistema. Ad esempio, il sistema invia il messaggio [**WM \_ WINDOWPOSCHANGED**](wm-windowposchanged.md) dopo che un'applicazione usa la [**funzione SetWindowPos**](/windows/win32/api/winuser/nf-winuser-setwindowpos) per spostare una finestra.

Alcune funzioni che inviano messaggi non accodati sono [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage), [**BroadcastSystemMessageEx**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessageexa), [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage), [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta)e [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea).

## <a name="message-handling"></a>Gestione dei messaggi

Un'applicazione deve rimuovere ed elaborare i messaggi inviati alle code di messaggi dei relativi thread. Un'applicazione a thread singolo usa *in* genere un ciclo di messaggi nella relativa funzione [**WinMain**](/windows/win32/api/winbase/nf-winbase-winmain) per rimuovere e inviare messaggi alle procedure di finestra appropriate per l'elaborazione. Le applicazioni con più thread possono includere un ciclo di messaggi in ogni thread che crea una finestra. Le sezioni seguenti descrivono il funzionamento di un ciclo di messaggi e illustrano il ruolo di una routine di finestra:

-   [Ciclo di messaggi](#message-loop)
-   [Routine della finestra](#window-procedure)

### <a name="message-loop"></a>Ciclo di messaggi

Un ciclo di messaggi semplice è costituito da una chiamata di funzione a ognuna di queste tre funzioni: [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage), [**TranslateMessage**](/windows/win32/api/winuser/nf-winuser-translatemessage)e [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage). Si noti che se si verifica un errore, **GetMessage** restituisce -1, quindi la necessità di un test speciale.


```
MSG msg;
BOOL bRet;

while( (bRet = GetMessage( &msg, NULL, 0, 0 )) != 0)
{ 
    if (bRet == -1)
    {
        // handle the error and possibly exit
    }
    else
    {
        TranslateMessage(&msg); 
        DispatchMessage(&msg); 
    }
}
```



La [**funzione GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) recupera un messaggio dalla coda e lo copia in una struttura di tipo [**MSG.**](/windows/win32/api/winuser/ns-winuser-msg) Restituisce un valore diverso da zero, a meno che non venga rilevato il messaggio [**WM \_ QUIT,**](wm-quit.md) nel qual caso restituisce **FALSE** e termina il ciclo. In un'applicazione a thread singolo, la chiusura del ciclo di messaggi è spesso il primo passaggio della chiusura dell'applicazione. Un'applicazione può terminare il proprio ciclo usando la funzione [**PostQuitMessage,**](/windows/win32/api/winuser/nf-winuser-postquitmessage) in genere in risposta al messaggio [**WM \_ DESTROY**](wm-destroy.md) nella procedura della finestra della finestra principale dell'applicazione.

Se si specifica un handle di finestra come secondo parametro di [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage), solo i messaggi per la finestra specificata vengono recuperati dalla coda. **GetMessage** può anche filtrare i messaggi nella coda, recuperando solo i messaggi che rientrano in un intervallo specificato. Per altre informazioni sul filtro dei messaggi, vedere [Filtro messaggi.](#message-filtering)

Il ciclo di messaggi di un thread deve includere [**TranslateMessage**](/windows/win32/api/winuser/nf-winuser-translatemessage) se il thread deve ricevere l'input di caratteri dalla tastiera. Il sistema genera messaggi di tasti virtuali [**(WM \_ KEYDOWN**](/windows/desktop/inputdev/wm-keydown) e [**WM \_ KEYUP)**](/windows/desktop/inputdev/wm-keyup)ogni volta che l'utente preme un tasto. Un messaggio di chiave virtuale contiene un codice di tasto virtuale che identifica quale tasto è stato premuto, ma non il relativo valore di carattere. Per recuperare questo valore, il ciclo di messaggi deve contenere **TranslateMessage,** che converte il messaggio della chiave virtuale in un messaggio di tipo carattere ([**WM \_ CHAR)**](/windows/desktop/inputdev/wm-char)e lo inserisce nuovamente nella coda di messaggi dell'applicazione. Il messaggio di tipo carattere può quindi essere rimosso in un'iterazione successiva del ciclo di messaggi e inviato a una routine della finestra.

La [**funzione DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) invia un messaggio alla routine della finestra associata all'handle di finestra specificato nella [**struttura MSG.**](/windows/win32/api/winuser/ns-winuser-msg) Se l'handle di finestra **è HWND \_ TOPMOST,** **DispatchMessage** invia il messaggio alle routine della finestra di tutte le finestre di primo livello nel sistema. Se l'handle di finestra **è NULL,** **DispatchMessage** non esegue alcuna operazione con il messaggio.

Il thread principale di un'applicazione avvia il ciclo di messaggi dopo l'inizializzazione dell'applicazione e la creazione di almeno una finestra. Dopo l'avvio, il ciclo di messaggi continua a recuperare i messaggi dalla coda di messaggi del thread e a inviare i messaggi alle finestre appropriate. Il ciclo di messaggi termina quando la [**funzione GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) rimuove il [**messaggio WM \_ QUIT**](wm-quit.md) dalla coda di messaggi.

Per una coda di messaggi è necessario un solo ciclo di messaggi, anche se un'applicazione contiene molte finestre. [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) invia sempre il messaggio alla finestra appropriata. ciò è dovuto al fatto che ogni messaggio nella coda è una [**struttura MSG**](/windows/win32/api/winuser/ns-winuser-msg) che contiene l'handle della finestra a cui appartiene il messaggio.

È possibile modificare un ciclo di messaggi in diversi modi. Ad esempio, è possibile recuperare i messaggi dalla coda senza inviare i messaggi a una finestra. Ciò è utile per le applicazioni che pubblicano messaggi che non specificano una finestra. È anche possibile [**indirizzare GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) alla ricerca di messaggi specifici, lasciando altri messaggi nella coda. Ciò è utile se è necessario ignorare temporaneamente il normale ordine FIFO della coda di messaggi.

Un'applicazione che usa i tasti di scelta rapida deve essere in grado di convertire i messaggi della tastiera in messaggi di comando. A tale scopo, il ciclo di messaggi dell'applicazione deve includere una chiamata alla [**funzione TranslateAccelerator.**](/windows/desktop/api/winuser/nf-winuser-translateacceleratora) Per altre informazioni sui tasti di scelta rapida, vedere [Tasti di scelta rapida.](/windows/desktop/menurc/keyboard-accelerators)

Se un thread usa una finestra di dialogo non modabile, il ciclo di messaggi deve includere la [**funzione IsDialogMessage**](/windows/desktop/api/winuser/nf-winuser-isdialogmessagea) in modo che la finestra di dialogo possa ricevere l'input da tastiera.

### <a name="window-procedure"></a>Routine della finestra

Una routine della finestra è una funzione che riceve ed elabora tutti i messaggi inviati alla finestra. Ogni classe di finestra ha una routine della finestra e ogni finestra creata con tale classe usa la stessa routine della finestra per rispondere ai messaggi.

Il sistema invia un messaggio a una routine della finestra passando i dati del messaggio come argomenti alla routine. La routine della finestra esegue quindi un'azione appropriata per il messaggio. controlla l'identificatore del messaggio e, durante l'elaborazione del messaggio, usa le informazioni specificate dai parametri del messaggio.

Una routine della finestra in genere non ignora un messaggio. Se non elabora un messaggio, deve inviare il messaggio al sistema per l'elaborazione predefinita. La routine della finestra esegue questa operazione chiamando la [**funzione DefWindowProc,**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) che esegue un'azione predefinita e restituisce un risultato del messaggio. La routine della finestra deve quindi restituire questo valore come risultato del messaggio. La maggior parte delle procedure di finestra elabora solo alcuni messaggi e passa gli altri al sistema chiamando **DefWindowProc.**

Poiché una routine della finestra è condivisa da tutte le finestre appartenenti alla stessa classe, può elaborare i messaggi per diverse finestre. Per identificare la finestra specifica interessata dal messaggio, una routine della finestra può esaminare l'handle di finestra passato con un messaggio. Per altre informazioni sulle routine della finestra, vedere [Routine della finestra.](window-procedures.md)

## <a name="message-filtering"></a>Filtro messaggi

Un'applicazione può scegliere messaggi specifici da recuperare dalla coda di messaggi (ignorando gli altri messaggi) usando la [**funzione GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) o [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea) per specificare un filtro messaggi. Il filtro è un intervallo di identificatori di messaggio (specificati da un primo e dall'ultimo identificatore), un handle di finestra o entrambi. **GetMessage** e **PeekMessage usano** un filtro messaggi per selezionare i messaggi da recuperare dalla coda. Il filtro dei messaggi è utile se un'applicazione deve cercare nella coda i messaggi che sono arrivati in un secondo momento nella coda. È utile anche se un'applicazione deve elaborare i messaggi di input (hardware) prima di elaborare i messaggi inviati.

Le costanti **WM \_ KEYFIRST** e **WM \_ KEYLAST** possono essere usate come valori di filtro per recuperare tutti i messaggi della tastiera. Le costanti **WM \_ MOUSEFIRST** e **WM \_ MOUSELAST** possono essere usate per recuperare tutti i messaggi del mouse.

Qualsiasi applicazione che filtra i messaggi deve garantire che sia possibile pubblicare un messaggio che soddisfa il filtro messaggi. Ad esempio, se un'applicazione filtra per un messaggio [**WM \_ CHAR**](/windows/desktop/inputdev/wm-char) in una finestra che non riceve l'input da tastiera, la [**funzione GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) non restituisce alcun valore. Questo "blocca" in modo efficace l'applicazione.

## <a name="posting-and-sending-messages"></a>Pubblicazione e invio di messaggi

Qualsiasi applicazione può pubblicare e inviare messaggi. Analogamente al sistema, un'applicazione invia un messaggio copiarlo in una coda di messaggi e invia un messaggio passando i dati del messaggio come argomenti a una routine della finestra. Per pubblicare messaggi, un'applicazione usa [**la funzione PostMessage.**](/windows/win32/api/winuser/nf-winuser-postmessagea) Un'applicazione può inviare un messaggio chiamando la funzione [**SendMessage,**](/windows/win32/api/winuser/nf-winuser-sendmessage) [**BroadcastSystemMessage,**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) [**SendMessageCallback,**](/windows/win32/api/winuser/nf-winuser-sendmessagecallbacka) [**SendMessageTimeout,**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta) [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea)o [**SendDlgItemMessage.**](/windows/desktop/api/winuser/nf-winuser-senddlgitemmessagea)

### <a name="posting-messages"></a>Pubblicazione di messaggi

Un'applicazione invia in genere un messaggio per notificare a una finestra specifica di eseguire un'attività. [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) crea una [**struttura MSG**](/windows/win32/api/winuser/ns-winuser-msg) per il messaggio e copia il messaggio nella coda di messaggi. Il ciclo di messaggi dell'applicazione recupera infine il messaggio e lo invia alla routine della finestra appropriata.

Un'applicazione può inviare un messaggio senza specificare una finestra. Se l'applicazione fornisce un handle di finestra **NULL** quando si chiama [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea), il messaggio viene inviato alla coda associata al thread corrente. Poiché non viene specificato alcun handle di finestra, l'applicazione deve elaborare il messaggio nel ciclo di messaggi. Questo è un modo per creare un messaggio che si applica all'intera applicazione, anziché a una finestra specifica.

In alcuni casi, può essere necessario inviare un messaggio a tutte le finestre di primo livello del sistema. Un'applicazione può inviare un messaggio a tutte le finestre di primo livello chiamando [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) e specificando **HWND \_ TOPMOST** nel *parametro hwnd.*

Un errore di programmazione comune è presupporre che la [**funzione PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) inseri sempre un messaggio. Questo non vale quando la coda di messaggi è piena. Un'applicazione deve controllare il valore restituito della funzione **PostMessage** per determinare se il messaggio è stato pubblicato e, in caso contrario, ripubblicarlo.

### <a name="sending-messages"></a>sending messages

Un'applicazione in genere invia un messaggio per notificare a una routine della finestra di eseguire immediatamente un'attività. La [**funzione SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) invia il messaggio alla routine della finestra corrispondente alla finestra specificata. La funzione attende il completamento dell'elaborazione della routine della finestra e quindi restituisce il risultato del messaggio. Le finestre padre e figlio comunicano spesso inviando messaggi tra loro. Ad esempio, una finestra padre con un controllo di modifica come finestra figlio può impostare il testo del controllo inviando un messaggio. Il controllo può inviare una notifica alla finestra padre delle modifiche al testo eseguite dall'utente inviando messaggi all'elemento padre.

La [**funzione SendMessageCallback**](/windows/win32/api/winuser/nf-winuser-sendmessagecallbacka) invia anche un messaggio alla routine della finestra corrispondente alla finestra specificata. Tuttavia, questa funzione restituisce immediatamente . Dopo che la routine della finestra ha elaborata il messaggio, il sistema chiama la funzione di callback specificata. Per altre informazioni sulla funzione di callback, vedere la [**funzione SendAsyncProc.**](/windows/win32/api/winuser/nc-winuser-sendasyncproc)

In alcuni casi, può essere necessario inviare un messaggio a tutte le finestre di primo livello del sistema. Ad esempio, se l'applicazione modifica l'ora di sistema, deve notificare a tutte le finestre di primo livello la modifica inviando un [**messaggio WM \_ TIMECHANGE.**](../sysinfo/wm-timechange.md) Un'applicazione può inviare un messaggio a tutte le finestre di primo livello chiamando [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) e specificando **HWND \_ TOPMOST** nel *parametro hwnd.* È anche possibile trasmettere un messaggio a tutte le applicazioni chiamando la funzione [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) e specificando **BSM \_ APPLICATIONS** nel *parametro lpdwRecipients.*

Usando la [**funzione InSendMessage**](/windows/win32/api/winuser/nf-winuser-insendmessage) o [**InSendMessageEx,**](/windows/win32/api/winuser/nf-winuser-insendmessageex) una routine della finestra può determinare se sta elaborando un messaggio inviato da un altro thread. Questa funzionalità è utile quando l'elaborazione dei messaggi dipende dall'origine del messaggio.

## <a name="message-deadlocks"></a>Deadlock dei messaggi

Un thread che chiama la [**funzione SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) per inviare un messaggio a un altro thread non può continuare l'esecuzione finché non viene restituita la routine della finestra che riceve il messaggio. Se il thread ricevente restituisce il controllo durante l'elaborazione del messaggio, l'esecuzione del thread mittente non può continuare perché è in attesa della restituzione di **SendMessage.** Se il thread ricevente è collegato alla stessa coda del mittente, può verificarsi un deadlock dell'applicazione. Si noti che gli hook journal collegano thread alla stessa coda.

Si noti che il thread ricevente non deve cedere il controllo in modo esplicito. Se si chiama una delle funzioni seguenti, un thread può produrre il controllo in modo implicito.

-   [**Finestra di dialogo**](/windows/desktop/api/winuser/nf-winuser-dialogboxa)
-   [**DialogBoxIndirect**](/windows/desktop/api/winuser/nf-winuser-dialogboxindirecta)
-   [**DialogBoxIndirectParam**](/windows/desktop/api/winuser/nf-winuser-dialogboxindirectparama)
-   [**DialogBoxParam**](/windows/desktop/api/winuser/nf-winuser-dialogboxparama)
-   [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage)
-   [**MessageBox**](/windows/desktop/api/winuser/nf-winuser-messagebox)
-   [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea)
-   [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage)

Per evitare potenziali deadlock nell'applicazione, è consigliabile usare le [**funzioni SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea) [**o SendMessageTimeout.**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta) In caso contrario, una routine della finestra può determinare se un messaggio ricevuto è stato inviato da un altro thread chiamando la [**funzione InSendMessage**](/windows/win32/api/winuser/nf-winuser-insendmessage) o [**InSendMessageEx.**](/windows/win32/api/winuser/nf-winuser-insendmessageex) Prima di chiamare una delle funzioni nell'elenco precedente durante l'elaborazione di un messaggio, la routine della finestra deve chiamare **prima InSendMessage** o **InSendMessageEx**. Se questa funzione restituisce **TRUE,** la routine della finestra deve chiamare la [**funzione ReplyMessage**](/windows/win32/api/winuser/nf-winuser-replymessage) prima di qualsiasi funzione che causa la produzione del controllo da parte del thread.

## <a name="broadcasting-messages"></a>Trasmissione di messaggi

Ogni messaggio è costituito da un identificatore di messaggio e da due parametri, *wParam* *e lParam*. L'identificatore del messaggio è un valore univoco che specifica lo scopo del messaggio. I parametri forniscono informazioni aggiuntive specifiche del messaggio, ma il *parametro wParam* è in genere un valore di tipo che fornisce altre informazioni sul messaggio.

Una *trasmissione di* messaggi è semplicemente l'invio di un messaggio a più destinatari nel sistema. Per trasmettere un messaggio da un'applicazione, usare la [**funzione BroadcastSystemMessage,**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) specificando i destinatari del messaggio. Anziché specificare singoli destinatari, è necessario specificare uno o più tipi di destinatari. Questi tipi sono applicazioni, driver installabili, driver di rete e driver di dispositivo a livello di sistema. Il sistema invia messaggi broadcast a tutti i membri di ogni tipo specificato.

Il sistema trasmette in genere i messaggi in risposta alle modifiche che si verificano all'interno di driver di dispositivo a livello di sistema o componenti correlati. Il driver o il componente correlato trasmette il messaggio alle applicazioni e ad altri componenti per notificare la modifica. Ad esempio, il componente responsabile delle unità disco trasmette un messaggio ogni volta che il driver di dispositivo per l'unità disco floppy rileva una modifica dei supporti, ad esempio quando l'utente inserisce un disco nell'unità.

Il sistema trasmette i messaggi ai destinatari nell'ordine seguente: driver di dispositivo a livello di sistema, driver di rete, driver installabili e applicazioni. Ciò significa che i driver di dispositivo a livello di sistema, se scelti come destinatari, hanno sempre la prima opportunità di rispondere a un messaggio. All'interno di un determinato tipo di destinatario, non è garantito che nessun driver riceva un determinato messaggio prima di qualsiasi altro driver. Ciò significa che un messaggio destinato a un driver specifico deve avere un identificatore di messaggio univoco a livello globale in modo che nessun altro driver lo elavi involontariamente.

È anche possibile trasmettere messaggi a tutte le finestre di primo livello specificando **HWND \_ BROADCAST** nella funzione [**SendMessage,**](/windows/win32/api/winuser/nf-winuser-sendmessage) [**SendMessageCallback,**](/windows/win32/api/winuser/nf-winuser-sendmessagecallbacka) [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta) [**o SendNotifyMessage.**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea)

Le applicazioni ricevono messaggi tramite la procedura della finestra delle finestre di primo livello. I messaggi non vengono inviati alle finestre figlio. I servizi possono ricevere messaggi tramite una routine della finestra o i relativi gestori di controllo del servizio.

> [!Note]  
> I driver di dispositivo a livello di sistema usano una funzione correlata a livello di sistema per trasmettere i messaggi di sistema.

 

## <a name="query-messages"></a>Messaggi di query

È possibile creare messaggi personalizzati e usarli per coordinare le attività tra le applicazioni e altri componenti del sistema. Ciò è particolarmente utile se sono stati creati driver installabili o driver di dispositivo a livello di sistema. I messaggi personalizzati possono contenere informazioni da e verso il driver e le applicazioni che usano il driver.

Per eseguire il polling dei destinatari per ottenere l'autorizzazione per eseguire una determinata azione, usare un *messaggio di query*. È possibile generare messaggi di query personalizzati impostando il **valore \_ query BSF** nel *parametro dwFlags* quando si chiama [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage). Ogni destinatario del messaggio di query deve restituire **TRUE** perché la funzione invii il messaggio al destinatario successivo. Se un destinatario restituisce **BROADCAST \_ QUERY \_ DENY,** la trasmissione termina immediatamente e la funzione restituisce uno zero.

 

 
