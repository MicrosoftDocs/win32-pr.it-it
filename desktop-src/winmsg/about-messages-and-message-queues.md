---
description: Questa sezione illustra i messaggi e le code di messaggi di Windows.
ms.assetid: 21a4d40b-52da-49e4-a374-afc4927e96e8
title: Informazioni sui messaggi e sulle code di messaggi
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7f0bcf68dbacaae868de3aea1fdc4a5d11290821
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106319098"
---
# <a name="about-messages-and-message-queues"></a>Informazioni sui messaggi e sulle code di messaggi

Diversamente dalle applicazioni basate su MS-DOS, le applicazioni basate su Windows sono basate su eventi. Non eseguono chiamate di funzione esplicite, ad esempio chiamate della libreria di runtime C, per ottenere input. Ma attendono che il sistema passi l'input.

Il sistema passa tutti gli input per un'applicazione alle varie finestre dell'applicazione. Ogni finestra ha una funzione, denominata routine della finestra, che il sistema chiama ogni volta che è presente un input per la finestra. La routine della finestra elabora l'input e restituisce il controllo al sistema. Per ulteriori informazioni sulle routine della finestra, vedere [routine della finestra](window-procedures.md).

Se una finestra di primo livello smette di rispondere ai messaggi per più di alcuni secondi, il sistema considera che la finestra non risponde. In questo caso, il sistema nasconde la finestra e la sostituisce con una finestra fantasma con lo stesso z order, posizione, dimensioni e attributi visivi. Ciò consente all'utente di spostarlo, ridimensionarlo o persino chiudere l'applicazione. Tuttavia, queste sono le uniche azioni disponibili perché l'applicazione in realtà non risponde. Quando è in modalità debugger, il sistema non genera una finestra fantasma.

In questa sezione vengono illustrati gli argomenti seguenti:

-   [Messaggi di Windows](#windows-messages)
-   [Tipi di messaggio](#message-types)
    -   [Messaggi definiti dal sistema](#system-defined-messages)
    -   [Messaggi definiti dall'applicazione](#application-defined-messages)
-   [Routing del messaggio](#message-routing)
    -   [Messaggi in coda](#queued-messages)
    -   [Messaggi non accodati](#nonqueued-messages)
-   [Gestione dei messaggi](#message-handling)
    -   [Ciclo di messaggi](#message-loop)
    -   [Routine della finestra](#window-procedure)
-   [Filtro messaggi](#message-filtering)
-   [Invio e invio di messaggi](#posting-and-sending-messages)
    -   [Invio di messaggi](#posting-messages)
    -   [sending messages](#sending-messages)
-   [Deadlock del messaggio](#message-deadlocks)
-   [Trasmissione di messaggi](#broadcasting-messages)
-   [Messaggi di query](#query-messages)

## <a name="windows-messages"></a>Messaggi di Windows

Il sistema passa l'input a una routine della finestra sotto forma di *messaggio*. I messaggi vengono generati dal sistema e dalle applicazioni. Il sistema genera un messaggio a ogni evento di input, ad esempio quando l'utente digita, sposta il mouse o fa clic su un controllo, ad esempio una barra di scorrimento. Il sistema genera anche messaggi in risposta alle modifiche del sistema introdotte da un'applicazione, ad esempio quando un'applicazione modifica il pool di risorse del tipo di carattere del sistema o ridimensiona una delle finestre. Un'applicazione può generare messaggi per indirizzare le proprie finestre per eseguire attività o per comunicare con Windows in altre applicazioni.

Il sistema invia un messaggio a una routine della finestra con un set di quattro parametri: un handle di finestra, un identificatore di messaggio e due valori denominati *parametri del messaggio*. L' *handle della finestra* identifica la finestra a cui è destinato il messaggio. Il sistema lo utilizza per determinare quale routine della finestra deve ricevere il messaggio.

Un *identificatore di messaggio* è una costante denominata che identifica lo scopo di un messaggio. Quando una routine della finestra riceve un messaggio, usa un identificatore di messaggio per determinare la modalità di elaborazione del messaggio. Ad esempio, l'identificatore del messaggio [**WM \_ Paint**](/windows/desktop/gdi/wm-paint) indica alla routine della finestra che l'area client della finestra è cambiata e deve essere ridisegnata.

I parametri del messaggio specificano i dati o il percorso dei dati utilizzati da una routine della finestra durante l'elaborazione di un messaggio. Il significato e il valore dei parametri del messaggio dipendono dal messaggio. Un parametro del messaggio può contenere un numero intero, flag di bit compressi, un puntatore a una struttura che contiene dati aggiuntivi e così via. Quando un messaggio non usa parametri del messaggio, vengono in genere impostati su **null**. Una routine della finestra deve controllare l'identificatore del messaggio per determinare come interpretare i parametri del messaggio.

## <a name="message-types"></a>Tipi di messaggi

In questa sezione vengono descritti i due tipi di messaggi:

-   [Messaggi definiti dal sistema](#system-defined-messages)
-   [Messaggi definiti dall'applicazione](#application-defined-messages)

### <a name="system-defined-messages"></a>Messaggi di System-Defined

Il sistema invia o Invia un *messaggio definito dal sistema* durante la comunicazione con un'applicazione. Questi messaggi vengono usati per controllare le operazioni delle applicazioni e fornire l'input e altre informazioni per l'elaborazione delle applicazioni. Un'applicazione può anche inviare o inviare messaggi definiti dal sistema. In genere, le applicazioni utilizzano questi messaggi per controllare l'operazione delle finestre di controllo create utilizzando le classi di finestra pre-registrate.

Ogni messaggio definito dal sistema dispone di un identificatore univoco del messaggio e di una costante simbolica corrispondente (definita nei file di intestazione Software Development Kit (SDK)) che indica lo scopo del messaggio. Ad esempio, la costante di [**\_ disegno WM**](/windows/desktop/gdi/wm-paint) richiede che una finestra ridisegni il contenuto.

Le costanti simboliche specificano la categoria a cui appartengono i messaggi definiti dal sistema. Il prefisso della costante identifica il tipo di finestra che può interpretare ed elaborare il messaggio. Di seguito sono riportati i prefissi e le categorie di messaggi correlati.



| Prefisso                               | Categoria messaggio             | Documentazione                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|--------------------------------------|------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ABM** e **ABN**                  | Barra degli strumenti del desktop applicazione  | [Messaggi e notifiche della shell](/windows/desktop/shell/control-panel-applications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **ACM** e **ACN**                  | Controllo Animation            | [Messaggi di controllo animazione](/windows/desktop/Controls/bumper-animation-control-reference-messages) e [notifiche di controllo animazione](/windows/desktop/Controls/bumper-animation-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **BCM**, **BCN**, **BM** e **BN** | Controllo Button               | [Messaggi di controllo Button](/windows/desktop/Controls/bumper-button-control-reference-messages) e [notifiche di controllo Button](/windows/desktop/Controls/bumper-button-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **CB** e **CBN**                   | ComboBox (controllo)             | [Messaggi di controllo ComboBox](/windows/desktop/Controls/bumper-combobox-control-reference-messages) e [notifiche del controllo ComboBox](/windows/desktop/Controls/bumper-combobox-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **CBEM** e **CBEN**                | Controllo ComboBoxEx           | [Messaggi ComboBoxEx](/windows/desktop/Controls/bumper-comboboxex-control-reference-messages) e [notifiche ComboBoxEx](/windows/desktop/Controls/bumper-comboboxex-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **CCM**                              | Controllo generale              | [Messaggi di controllo](/windows/desktop/Controls/bumper-general-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **CDM**                              | Finestra di dialogo comune            | [Messaggi comuni della finestra di dialogo](/windows/desktop/dlgbox/common-dialog-box-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **DFM**                              | Menu di scelta rapida predefinito         | [Messaggi e notifiche della shell](/windows/desktop/shell/control-panel-applications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **DL**                               | Casella di riepilogo di trascinamento                | [Trascinare le notifiche della casella di riepilogo](/previous-versions//ff485914(v=vs.85))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| **DM**                               | Controllo pulsante di push predefinito  | [Messaggi della finestra di dialogo](/windows/desktop/dlgbox/dialog-box-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **DTM** e **DTN**                  | Controllo selezione data e ora | [Messaggi selezione data e ora](/windows/desktop/Controls/bumper-date-and-time-picker-control-reference-messages) e [notifiche selezione data e ora](/windows/desktop/Controls/bumper-date-and-time-picker-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Em** e **en**                    | Controllo Edit                 | [Modificare i messaggi di controllo](/windows/desktop/Controls/bumper-edit-control-reference-messages), [modificare le notifiche dei controlli](/windows/desktop/Controls/bumper-edit-control-reference-notifications), [i messaggi Rich Edit](/windows/desktop/Controls/bumper-rich-edit-control-reference-messages)e le [notifiche Rich Edit](/windows/desktop/Controls/bumper-rich-edit-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **HDM** e **HDN**                  | Controllo intestazione               | [Messaggi di controllo intestazione](/windows/desktop/Controls/bumper-header-control-reference-messages) e [notifiche di controllo intestazione](/windows/desktop/Controls/bumper-header-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **HKM**                              | Controllo tasto di scelta              | [Messaggi di controllo tasto di scelta](/windows/desktop/Controls/bumper-hot-key-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **IPM** e **IPN**                  | controllo indirizzo IP           | [Messaggi di indirizzi IP](/windows/desktop/Controls/bumper-ip-address-control-reference-messages) e [notifiche degli indirizzi IP](/windows/desktop/Controls/bumper-ip-address-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Lb** e **LBN**                   | Controllo casella di riepilogo             | [Messaggi della casella di riepilogo](/windows/desktop/Controls/bumper-list-box-control-reference-messages) e [notifiche della casella di riepilogo](/windows/desktop/Controls/bumper-list-box-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **LM**                               | Controllo SysLink              | [Messaggi di controllo SysLink](/windows/desktop/Controls/bumper-syslink-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **LVM** e **LVN**                  | Controllo visualizzazione elenco            | [Visualizzazione elenco messaggi](/windows/desktop/Controls/bumper-list-view-control-reference-messages) e [notifiche visualizzazione elenco](/windows/desktop/Controls/bumper-list-view-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **MCM** e **MCN**                  | Controllo calendario mensile       | [Messaggi del calendario mensile](/windows/desktop/Controls/bumper-month-calendar-control-reference-messages) e [notifiche del calendario mensile](/windows/desktop/Controls/bumper-month-calendar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **gestione basata su criteri**                              | Barra di stato                 | [Messaggi indicatore di stato](/windows/desktop/Controls/bumper-progress-bar-control-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **PGM** e **PGN**                  | Controllo pager                | [Messaggi di controllo pager](/windows/desktop/Controls/bumper-pager-control-reference-messages) e [notifiche del controllo pager](/windows/desktop/Controls/bumper-pager-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **PSM** e **PSN**                  | Finestra delle proprietà               | [Messaggi della finestra delle proprietà](/windows/desktop/Controls/bumper-property-sheets-reference-messages) e [notifiche della finestra delle proprietà](/windows/desktop/Controls/bumper-property-sheets-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **RB** e **RBN**                   | Controllo Rebar                | [Messaggi di controllo Rebar](/windows/desktop/Controls/bumper-rebar-control-reference-messages) e [notifiche del controllo Rebar](/windows/desktop/Controls/bumper-rebar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **SB** e **SBN**                   | Finestra della barra di stato            | [Messaggi della barra](/windows/desktop/Controls/bumper-status-bars-reference-messages) di stato e [notifiche della barra di stato](/windows/desktop/Controls/bumper-status-bars-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| **SBM**                              | Controllo Scroll Bar           | [Messaggi barra di scorrimento](/windows/desktop/Controls/bumper-scroll-bars-reference-messages)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **SMC**                              | Menu della shell                   | [Messaggi e notifiche della shell](/windows/desktop/shell/control-panel-applications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **STM** e **STN**                  | Controllo statico               | [Messaggi di controllo statico](/windows/desktop/Controls/bumper-static-control-reference-messages) e [notifiche del controllo statico](/windows/desktop/Controls/bumper-static-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **TB** e **TBN**                   | Barra degli strumenti                      | [Messaggi di controllo della barra degli strumenti](/windows/desktop/Controls/bumper-toolbar-control-reference-messages) e [notifiche del controllo Toolbar](/windows/desktop/Controls/bumper-toolbar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **TBM** e **Trbn**                 | Controllo TrackBar             | [Messaggi di controllo TrackBar](/windows/desktop/Controls/bumper-trackbar-control-reference-messages) e [notifiche del controllo TrackBar](/windows/desktop/Controls/bumper-trackbar-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **TCM** e **TCN**                  | Controllo Tab                  | [Messaggi di controllo Tab](/windows/desktop/Controls/bumper-tab-control-reference-messages) e [notifiche di controllo scheda](/windows/desktop/Controls/bumper-tab-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **TDM** e **TDN**                  | Finestra di dialogo attività                  | [Messaggi](/windows/desktop/Controls/bumper-task-dialogs-reference-messages) e notifiche della [finestra](/windows/desktop/Controls/bumper-task-dialogs-reference-notifications) di dialogo attività                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **TTM** e **TTN**                  | ToolTip (controllo)              | [Messaggi di controllo ToolTip](/windows/desktop/Controls/bumper-tooltip-control-reference-messages) e [notifiche del controllo ToolTip](/windows/desktop/Controls/bumper-tooltip-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **TVM** e **TVN**                  | Controllo visualizzazione albero            | [Messaggi visualizzazione albero](/windows/desktop/Controls/bumper-tree-view-control-reference-messages) e [notifiche visualizzazione albero](/windows/desktop/Controls/bumper-tree-view-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **UDM** e **UDN**                  | Controllo di scorrimento              | [Messaggi di scorrimento](/windows/desktop/Controls/bumper-up-down-control-reference-messages) e [notifiche di scorrimento](/windows/desktop/Controls/bumper-up-down-control-reference-notifications)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **WM**                               | Generale                      | <dl> <dt>[Messaggi appunti](/windows/desktop/dataxchg/clipboard-messages)</dt> <dt>[Appunti](/windows/desktop/dataxchg/clipboard-notifications)</dt> notifiche finestra di <dt>[dialogo](/windows/desktop/dlgbox/common-dialog-box-notifications)</dt> notifiche del cursore notifiche del <dt>[cursore](/windows/desktop/menurc/cursor-notifications)</dt> <dt>[notifiche](/windows/desktop/dataxchg/wm-copydata)</dt> del cursore messaggi <dt>[Gestione finestre desktop messaggi](/windows/desktop/dwm/dwm-messages)</dt> <dt>[di gestione dispositivo](/windows/desktop/DevIO/device-management-messages)</dt> notifiche finestra di dialogo messaggi <dt>[Dynamic Data Exchange messaggi](/windows/desktop/dataxchg/dynamic-data-exchange-messages)</dt> <dt>[Dynamic Data Exchange notifiche](/windows/desktop/dataxchg/dynamic-data-exchange-notifications)</dt> <dt>[hook](hook-notifications.md)</dt> notifiche tasti <dt>[di scelta rapida](/windows/desktop/menurc/keyboard-accelerator-messages)</dt> <dt>[notifiche acceleratore](/windows/desktop/menurc/keyboard-accelerator-notifications)</dt> <dt>[](/windows/desktop/inputdev/keyboard-input-messages)</dt> tastiera messaggi di input tastiera notifiche di input <dt>[del mouse](/windows/desktop/inputdev/mouse-input-notifications)</dt> <dt>[notifiche](/windows/desktop/menurc/menu-notifications)</dt> <dt>[input tastiera](/windows/desktop/inputdev/keyboard-input-notifications)</dt> <dt>[messaggi di interfaccia](multiple-document-interface-messages.md)</dt> di scorrimento notifiche <dt>[di input](/windows/desktop/inputdev/raw-input-notifications)</dt> <dt>[barra di scorrimento notifiche](/windows/desktop/Controls/bumper-scroll-bars-reference-notifications)</dt> <dt>[timer](timer-notifications.md)</dt> <dt>[finestra di](window-notifications.md)</dt> <dt>[dialogo](/windows/desktop/dlgbox/dialog-box-notifications)</dt> <dt>[notifiche messaggio](window-messages.md)</dt> </dl> |



 

I messaggi della finestra generale coprono un'ampia gamma di informazioni e richieste, inclusi i messaggi per l'input del mouse e della tastiera, l'input del menu e della finestra di dialogo, la creazione e la gestione delle finestre e la Dynamic Data Exchange (DDE).

### <a name="application-defined-messages"></a>Messaggi di Application-Defined

Un'applicazione può creare messaggi che devono essere usati dalle proprie finestre o per comunicare con Windows in altri processi. Se un'applicazione crea messaggi propri, la routine della finestra che li riceve deve interpretare i messaggi e fornire l'elaborazione appropriata.

I valori dell'identificatore di messaggio vengono usati come indicato di seguito:

-   Il sistema riserva i valori dell'identificatore di messaggio nell'intervallo 0x0000 tramite 0x03FF (il valore di [**WM \_ User**](wm-user.md)  – 1) per i messaggi definiti dal sistema. Le applicazioni non possono utilizzare questi valori per i messaggi privati.
-   I valori nell'intervallo 0x0400 (il valore di [**WM \_ User**](wm-user.md)) tramite 0x7FFF sono disponibili per gli identificatori di messaggio per le classi di finestre private.
-   Se l'applicazione è contrassegnata con la versione 4,0, è possibile usare i valori dell'identificatore di messaggio nell'intervallo 0x8000 ([**WM \_ app**](wm-app.md)) tramite 0xBFFF per i messaggi privati.
-   Il sistema restituisce un identificatore di messaggio nell'intervallo compreso tra 0xC000 e 0xFFFF quando un'applicazione chiama la funzione [**RegisterWindowMessage**](/windows/win32/api/winuser/nf-winuser-registerwindowmessagea) per registrare un messaggio. L'identificatore del messaggio restituito da questa funzione è sicuramente univoco nel sistema. L'utilizzo di questa funzione impedisce conflitti che possono verificarsi se altre applicazioni utilizzano lo stesso identificatore di messaggio per scopi diversi.

## <a name="message-routing"></a>Routing del messaggio

Il sistema utilizza due metodi per indirizzare i messaggi a una procedura della finestra: l'invio di messaggi a una coda di prima, in uscita denominata *coda di messaggi*, un oggetto memoria definito dal sistema che archivia temporaneamente i messaggi e l'invio di messaggi direttamente a una routine della finestra.

Un messaggio inviato a una coda di messaggi viene chiamato messaggio in *coda*. Si tratta principalmente del risultato dell'input dell'utente immesso tramite mouse o tastiera, ad [**esempio \_ WM MOUSEMOVE**](/windows/desktop/inputdev/wm-mousemove), [**WM \_ LBUTTONDOWN**](/windows/desktop/inputdev/wm-lbuttondown), [**WM \_ KeyDown**](/windows/desktop/inputdev/wm-keydown)e [**WM \_ char**](/windows/desktop/inputdev/wm-char) messages. Altri messaggi in coda includono i messaggi timer, Paint e quit, ovvero [**WM \_ timer**](wm-timer.md), [**WM \_ Paint**](/windows/desktop/gdi/wm-paint)e [**WM \_ Quit**](wm-quit.md). La maggior parte degli altri messaggi, che vengono inviati direttamente a una routine della finestra, sono denominati *messaggi non accodati*.

-   [Messaggi in coda](#queued-messages)
-   [Messaggi non accodati](#nonqueued-messages)

### <a name="queued-messages"></a>Messaggi in coda

Il sistema può visualizzare un numero qualsiasi di finestre alla volta. Per instradare l'input del mouse e della tastiera alla finestra appropriata, il sistema utilizza le code di messaggi.

Il sistema gestisce una sola coda di messaggi di sistema e una coda di messaggi specifica del thread per ogni thread GUI. Per evitare il sovraccarico dovuto alla creazione di una coda di messaggi per thread non GUI, tutti i thread vengono creati inizialmente senza una coda di messaggi. Il sistema crea una coda di messaggi specifica del thread solo quando il thread effettua la prima chiamata a una delle funzioni utente specifiche. Nessuna chiamata di funzione GUI comporta la creazione di una coda di messaggi.

Ogni volta che l'utente sposta il mouse, fa clic sui pulsanti del mouse o sui tipi sulla tastiera, il driver di dispositivo per il mouse o la tastiera converte l'input in messaggi e li inserisce nella coda dei messaggi di sistema. Il sistema rimuove i messaggi, uno alla volta, dalla coda di messaggi di sistema, li esamina per determinare la finestra di destinazione e quindi li inserisce nella coda di messaggi del thread che ha creato la finestra di destinazione. La coda di messaggi di un thread riceve tutti i messaggi di mouse e tastiera per le finestre create dal thread. Il thread rimuove i messaggi dalla relativa coda e indica al sistema di inviarli alla procedura della finestra appropriata per l'elaborazione.

Fatta eccezione per il messaggio [**di \_ disegno WM**](/windows/desktop/gdi/wm-paint) , il messaggio del [**\_ timer WM**](wm-timer.md) e il messaggio [**WM \_ Quit**](wm-quit.md) , il sistema inserisce sempre i messaggi alla fine di una coda di messaggi. In questo modo si garantisce che una finestra riceva i messaggi di input nella sequenza FIFO (First in, First out) corretta. Il messaggio di **\_ disegno WM** , il messaggio del **\_ timer WM** e il messaggio **WM \_ Quit** , tuttavia, vengono mantenuti nella coda e vengono inviati alla routine della finestra solo quando la coda non contiene altri messaggi. Inoltre, più messaggi **di \_ disegno WM** per la stessa finestra vengono combinati in un singolo messaggio di **\_ disegno WM** , consolidando tutte le parti non valide dell'area client in un'unica area. La combinazione di messaggi di **\_ disegno WM** riduce il numero di volte in cui una finestra deve ridisegnare il contenuto della relativa area client.

Il sistema invia un messaggio alla coda di messaggi di un thread compilando [**una struttura di messaggi e**](/windows/win32/api/winuser/ns-winuser-msg) quindi copiando il messaggio nella coda di messaggi. Le informazioni contenute in **msg** includono: l'handle della finestra per cui è previsto il messaggio, l'identificatore del messaggio, i due parametri del messaggio, l'ora in cui il messaggio è stato pubblicato e la posizione del cursore del mouse. Un thread può inviare un messaggio alla propria coda di messaggi o alla coda di un altro thread utilizzando la funzione [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) o [**PostThreadMessage**](/windows/win32/api/winuser/nf-winuser-postthreadmessagea) .

Un'applicazione può rimuovere un messaggio dalla coda usando la funzione [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) . Per esaminare un messaggio senza rimuoverlo dalla coda, un'applicazione può usare la funzione [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea) . Questa funzione riempie [**msg**](/windows/win32/api/winuser/ns-winuser-msg) con le informazioni sul messaggio.

Dopo la rimozione di un messaggio dalla coda, un'applicazione può utilizzare la funzione [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) per indicare al sistema di inviare il messaggio a una procedura della finestra per l'elaborazione. **DispatchMessage** accetta un puntatore a [**msg**](/windows/win32/api/winuser/ns-winuser-msg) che è stato riempito da una chiamata precedente alla funzione [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) o [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea) . **DispatchMessage** passa l'handle della finestra, l'identificatore del messaggio e i due parametri del messaggio alla routine della finestra, ma non passa l'ora in cui è stato pubblicato il messaggio o la posizione del cursore del mouse. Un'applicazione può recuperare queste informazioni chiamando le funzioni [**GetMessageTime**](/windows/win32/api/winuser/nf-winuser-getmessagetime) e [**GetMessagePos**](/windows/win32/api/winuser/nf-winuser-getmessagepos) durante l'elaborazione di un messaggio.

Un thread può utilizzare la funzione [**WaitMessage**](/windows/win32/api/winuser/nf-winuser-waitmessage) per restituire il controllo ad altri thread se non sono presenti messaggi nella coda di messaggi. La funzione sospende il thread e non restituisce alcun valore fino a quando non viene inserito un nuovo messaggio nella coda di messaggi del thread.

È possibile chiamare la funzione [**SetMessageExtraInfo**](/windows/win32/api/winuser/nf-winuser-setmessageextrainfo) per associare un valore alla coda di messaggi del thread corrente. Chiamare quindi la funzione [**GetMessageExtraInfo**](/windows/win32/api/winuser/nf-winuser-getmessageextrainfo) per ottenere il valore associato all'ultimo messaggio recuperato dalla funzione [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) o [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea) .

### <a name="nonqueued-messages"></a>Messaggi non accodati

I messaggi non accodati vengono inviati immediatamente alla routine della finestra di destinazione, ignorando la coda dei messaggi di sistema e la coda dei messaggi del thread. Il sistema invia in genere messaggi non in coda per notificare una finestra degli eventi che lo influiscono. Ad esempio, quando l'utente attiva una nuova finestra dell'applicazione, il sistema invia alla finestra una serie di messaggi, tra cui [**WM \_ Activate**](/windows/desktop/inputdev/wm-activate), [**WM \_ SetFocus**](/windows/desktop/inputdev/wm-setfocus)e [**WM \_ secursor**](/windows/desktop/menurc/wm-setcursor). Questi messaggi notificano alla finestra che è stata attivata, che l'input da tastiera viene indirizzato alla finestra e che il cursore del mouse è stato spostato all'interno dei bordi della finestra. I messaggi non accodati possono anche verificarsi quando un'applicazione chiama determinate funzioni di sistema. Ad esempio, il sistema invia il [**messaggio \_ WINDOWPOSCHANGED di WM**](wm-windowposchanged.md) dopo che un'applicazione usa la funzione [**SetWindowPos**](/windows/win32/api/winuser/nf-winuser-setwindowpos) per spostare una finestra.

Alcune funzioni che inviano messaggi non accodati sono [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage), [**BroadcastSystemMessageEx**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessageexa), [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage), [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta)e [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea).

## <a name="message-handling"></a>Gestione dei messaggi

Un'applicazione deve rimuovere ed elaborare i messaggi inviati alle code di messaggi dei relativi thread. Un'applicazione a thread singolo usa in genere un *ciclo di messaggi* nella relativa funzione [**WinMain**](/windows/win32/api/winbase/nf-winbase-winmain) per rimuovere e inviare messaggi alle procedure della finestra appropriate per l'elaborazione. Le applicazioni con più thread possono includere un ciclo di messaggi in ogni thread che crea una finestra. Nelle sezioni seguenti viene descritto il funzionamento di un ciclo di messaggi e viene illustrato il ruolo di una routine della finestra:

-   [Ciclo di messaggi](#message-loop)
-   [Routine della finestra](#window-procedure)

### <a name="message-loop"></a>Ciclo di messaggi

Un semplice ciclo di messaggi è costituito da una chiamata di funzione a ognuna di queste tre funzioni: [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage), [**TranslateMessage**](/windows/win32/api/winuser/nf-winuser-translatemessage)e [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage). Si noti che se si verifica un errore, **GetMessage** restituisce – 1, quindi la necessità del test speciale.


```
MSG msg;
BOOL bRet;

while( (bRet = GetMessage( &msg, NULL, 0, 0 )) != 0)
{ 
    if (bRet == -1)
    {
        // handle the error and possibly exit
    }
    else
    {
        TranslateMessage(&msg); 
        DispatchMessage(&msg); 
    }
}
```



La funzione [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) recupera un messaggio dalla coda e lo copia in una struttura di tipo [**msg**](/windows/win32/api/winuser/ns-winuser-msg). Restituisce un valore diverso da zero, a meno che non riscontri il messaggio [**WM \_ Quit**](wm-quit.md) , nel qual caso restituisce **false** e termina il ciclo. In un'applicazione a thread singolo, la fine del ciclo di messaggi è spesso il primo passaggio per la chiusura dell'applicazione. Un'applicazione può terminare il proprio ciclo usando la funzione [**PostQuitMessage**](/windows/win32/api/winuser/nf-winuser-postquitmessage) , in genere in risposta al messaggio [**WM \_ Destroy**](wm-destroy.md) nella procedura della finestra principale dell'applicazione.

Se si specifica un handle di finestra come secondo parametro di [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage), verranno recuperati dalla coda solo i messaggi per la finestra specificata. **GetMessage** consente inoltre di filtrare i messaggi nella coda, recuperando solo i messaggi che rientrano in un intervallo specificato. Per ulteriori informazioni sul filtro dei messaggi, vedere [filtro messaggi](#message-filtering).

Il ciclo di messaggi di un thread deve includere [**TranslateMessage**](/windows/win32/api/winuser/nf-winuser-translatemessage) se il thread deve ricevere input di caratteri dalla tastiera. Il sistema genera messaggi di chiave virtuale ([**WM \_ KeyDown**](/windows/desktop/inputdev/wm-keydown) e [**WM \_ KEYUP**](/windows/desktop/inputdev/wm-keyup)) ogni volta che l'utente preme un tasto. Un messaggio di chiave virtuale contiene un codice di chiave virtuale che identifica il tasto premuto, ma non il relativo valore del carattere. Per recuperare questo valore, il ciclo di messaggi deve contenere **TranslateMessage**, che converte il messaggio della chiave virtuale in un messaggio di tipo carattere ([**WM \_ char**](/windows/desktop/inputdev/wm-char)) e lo inserisce nuovamente nella coda di messaggi dell'applicazione. Il messaggio di tipo carattere può quindi essere rimosso dopo un'iterazione successiva del ciclo di messaggi e inviato a una routine di finestra.

La funzione [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) Invia un messaggio alla routine della finestra associata all'handle della finestra specificato nella struttura [**msg**](/windows/win32/api/winuser/ns-winuser-msg) . Se l'handle della finestra è in primo piano **HWND \_**, **DispatchMessage** invia il messaggio alle routine della finestra di tutte le finestre di primo livello nel sistema. Se l'handle della finestra è **null**, **DispatchMessage** non esegue alcuna operazione con il messaggio.

Il thread principale di un'applicazione avvia il ciclo di messaggi dopo l'inizializzazione dell'applicazione e la creazione di almeno una finestra. Una volta avviato, il ciclo di messaggi continua a recuperare i messaggi dalla coda di messaggi del thread e a inviarli alle finestre appropriate. Il ciclo di messaggi termina quando la funzione [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) rimuove il messaggio [**WM \_ Quit**](wm-quit.md) dalla coda di messaggi.

Per una coda di messaggi è necessario un solo ciclo di messaggi, anche se un'applicazione contiene molte finestre. [**DispatchMessage**](/windows/win32/api/winuser/nf-winuser-dispatchmessage) Invia sempre il messaggio alla finestra appropriata; Questo è dovuto al fatto che ogni messaggio nella coda [**è una struttura di messaggi contenente**](/windows/win32/api/winuser/ns-winuser-msg) l'handle della finestra a cui appartiene il messaggio.

È possibile modificare un ciclo di messaggi in diversi modi. Ad esempio, è possibile recuperare i messaggi dalla coda senza inviarli a una finestra. Questa operazione è utile per le applicazioni che inviano messaggi che non specificano una finestra. È inoltre possibile indirizzare [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) per la ricerca di messaggi specifici, lasciando altri messaggi nella coda. Questa operazione è utile se è necessario ignorare temporaneamente il consueto ordine FIFO della coda di messaggi.

Un'applicazione che utilizza tasti di scelta rapida deve essere in grado di convertire i messaggi della tastiera in messaggi di comando. A tale scopo, il ciclo di messaggi dell'applicazione deve includere una chiamata alla funzione [**TranslateAccelerator**](/windows/desktop/api/winuser/nf-winuser-translateacceleratora) . Per ulteriori informazioni sui tasti di scelta rapida [, vedere Tasti di scelta rapida.](/windows/desktop/menurc/keyboard-accelerators)

Se un thread utilizza una finestra di dialogo non modale, il ciclo di messaggi deve includere la funzione [**IsDialogMessage**](/windows/desktop/api/winuser/nf-winuser-isdialogmessagea) in modo che la finestra di dialogo possa ricevere input da tastiera.

### <a name="window-procedure"></a>Routine della finestra

Una routine della finestra è una funzione che riceve ed elabora tutti i messaggi inviati alla finestra. Ogni classe della finestra dispone di una routine della finestra e ogni finestra creata con tale classe utilizza la stessa routine della finestra per rispondere ai messaggi.

Il sistema invia un messaggio a una routine della finestra passando i dati del messaggio come argomenti alla procedura. La routine della finestra esegue quindi un'azione appropriata per il messaggio. Controlla l'identificatore del messaggio e, durante l'elaborazione del messaggio, USA le informazioni specificate dai parametri del messaggio.

Una routine di finestra in genere non ignora un messaggio. Se non elabora un messaggio, deve inviare di nuovo il messaggio al sistema per l'elaborazione predefinita. La procedura della finestra esegue questa operazione chiamando la funzione [**DefWindowProc**](/windows/desktop/api/winuser/nf-winuser-defwindowproca) , che esegue un'azione predefinita e restituisce un risultato del messaggio. La routine della finestra deve quindi restituire questo valore come risultato del messaggio. La maggior parte delle routine della finestra elabora solo alcuni messaggi e passa gli altri al sistema chiamando **DefWindowProc**.

Poiché una routine di finestra è condivisa da tutte le finestre appartenenti alla stessa classe, può elaborare i messaggi per diverse finestre diverse. Per identificare la finestra specifica interessata dal messaggio, una routine della finestra può esaminare l'handle di finestra passato con un messaggio. Per ulteriori informazioni sulle routine della finestra, vedere [routine della finestra](window-procedures.md).

## <a name="message-filtering"></a>Filtro messaggi

Un'applicazione può scegliere messaggi specifici da recuperare dalla coda di messaggi (ignorando altri messaggi) utilizzando la funzione [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) o [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea) per specificare un filtro messaggi. Il filtro è un intervallo di identificatori di messaggi (specificati da un primo e l'ultimo identificatore), un handle di finestra o entrambi. **GetMessage** e **PeekMessage** utilizzano un filtro messaggi per selezionare i messaggi da recuperare dalla coda. Il filtro dei messaggi è utile se un'applicazione deve eseguire la ricerca nella coda di messaggi per i messaggi ricevuti in un secondo momento nella coda. È utile anche se un'applicazione deve elaborare messaggi di input (hardware) prima di elaborare i messaggi inviati.

Per recuperare tutti i messaggi della tastiera, è possibile usare le costanti WM per **\_ First** e WM per l' **\_ Ultima** volta con i valori di filtro. è possibile usare le costanti WM **\_ MOUSEFIRST** e **WM \_ MOUSELAST** per recuperare tutti i messaggi del mouse.

Qualsiasi applicazione che filtra i messaggi deve garantire che sia possibile inviare un messaggio che soddisfi il filtro messaggi. Se, ad esempio, un'applicazione filtra un messaggio [**WM \_ char**](/windows/desktop/inputdev/wm-char) in una finestra che non riceve input da tastiera, la funzione [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage) non restituisce. In questo modo si "blocca" l'applicazione.

## <a name="posting-and-sending-messages"></a>Invio e invio di messaggi

Qualsiasi applicazione può inserire e inviare messaggi. Analogamente al sistema, un'applicazione pubblica un messaggio copiando il messaggio in una coda di messaggi e invia un messaggio passando i dati del messaggio come argomenti a una routine della finestra. Per inserire messaggi, un'applicazione utilizza la funzione [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) . Un'applicazione può inviare un messaggio chiamando la funzione [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage), [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage), [**SendMessageCallback**](/windows/win32/api/winuser/nf-winuser-sendmessagecallbacka), [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta), [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea)o [**SendDlgItemMessage**](/windows/desktop/api/winuser/nf-winuser-senddlgitemmessagea) .

### <a name="posting-messages"></a>Invio di messaggi

Un'applicazione in genere invia un messaggio per notificare a una finestra specifica di eseguire un'attività. [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) crea una struttura [**msg**](/windows/win32/api/winuser/ns-winuser-msg) per il messaggio e copia il messaggio nella coda di messaggi. Il ciclo di messaggi dell'applicazione consente infine di recuperare il messaggio e di inviarlo alla routine della finestra appropriata.

Un'applicazione può inviare un messaggio senza specificare una finestra. Se l'applicazione fornisce un handle di finestra **null** quando si chiama [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea), il messaggio viene inserito nella coda associata al thread corrente. Poiché non viene specificato alcun handle di finestra, l'applicazione deve elaborare il messaggio nel ciclo di messaggi. Questo è un modo per creare un messaggio che si applica all'intera applicazione, anziché a una finestra specifica.

Occasionalmente, potrebbe essere necessario inviare un messaggio a tutte le finestre di primo livello nel sistema. Un'applicazione può inviare un messaggio a tutte le finestre di primo livello chiamando [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) e specificando HWND in primo piano nel parametro *HWND* . **\_**

Un errore di programmazione comune è quello di presupporre che la funzione [**PostMessage**](/windows/win32/api/winuser/nf-winuser-postmessagea) invii sempre un messaggio. Questa operazione non si verifica quando la coda di messaggi è piena. Un'applicazione deve controllare il valore restituito della funzione **PostMessage** per determinare se il messaggio è stato inviato e, in caso contrario, reinviarlo.

### <a name="sending-messages"></a>sending messages

Un'applicazione in genere invia un messaggio per notificare a una routine della finestra di eseguire immediatamente un'attività. La funzione [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) invia il messaggio alla routine della finestra corrispondente alla finestra specificata. La funzione attende il completamento dell'elaborazione della routine della finestra e quindi restituisce il risultato del messaggio. Le finestre padre e figlio comunicano spesso inviando messaggi tra loro. Ad esempio, una finestra padre con un controllo di modifica come la finestra figlio può impostare il testo del controllo inviando un messaggio. Il controllo può notificare alla finestra padre le modifiche apportate al testo che vengono eseguite dall'utente inviando i messaggi all'elemento padre.

La funzione [**SendMessageCallback**](/windows/win32/api/winuser/nf-winuser-sendmessagecallbacka) invia anche un messaggio alla routine della finestra corrispondente alla finestra specificata. Tuttavia, questa funzione restituisce immediatamente un risultato. Dopo che la routine della finestra ha elaborato il messaggio, il sistema chiama la funzione di callback specificata. Per ulteriori informazioni sulla funzione di callback, vedere la funzione [**SendAsyncProc**](/windows/win32/api/winuser/nc-winuser-sendasyncproc) .

Occasionalmente, potrebbe essere necessario inviare un messaggio a tutte le finestre di primo livello nel sistema. Se, ad esempio, l'applicazione cambia l'ora di sistema, deve notificare tutte le finestre di primo livello sulla modifica inviando un messaggio [**WM \_ TIMECHANGE**](../sysinfo/wm-timechange.md) . Un'applicazione può inviare un messaggio a tutte le finestre di primo livello chiamando [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) e specificando HWND in primo piano nel parametro *HWND* . **\_** È anche possibile trasmettere un messaggio a tutte le applicazioni chiamando la funzione [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) e specificando le **\_ applicazioni BSM** nel parametro *lpdwRecipients* .

Utilizzando la funzione [**InSendMessage**](/windows/win32/api/winuser/nf-winuser-insendmessage) o [**InSendMessageEx**](/windows/win32/api/winuser/nf-winuser-insendmessageex) , una routine della finestra può determinare se è in corso l'elaborazione di un messaggio inviato da un altro thread. Questa funzionalità è utile quando l'elaborazione dei messaggi dipende dall'origine del messaggio.

## <a name="message-deadlocks"></a>Deadlock del messaggio

Un thread che chiama la funzione [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) per inviare un messaggio a un altro thread non può continuare l'esecuzione fino a quando non viene restituita la routine della finestra che riceve il messaggio. Se il thread ricevente restituisce il controllo durante l'elaborazione del messaggio, non è possibile continuare l'esecuzione del thread di invio perché è in attesa della restituzione di **SendMessage** . Se il thread ricevente è collegato alla stessa coda del mittente, può causare il verificarsi di un deadlock dell'applicazione. Si noti che gli hook del Journal alleghino i thread alla stessa coda.

Si noti che il thread di ricezione non deve restituire il controllo in modo esplicito; la chiamata a una qualsiasi delle funzioni seguenti può causare la produzione implicita del controllo da parte di un thread.

-   [**DialogBox**](/windows/desktop/api/winuser/nf-winuser-dialogboxa)
-   [**DialogBoxIndirect**](/windows/desktop/api/winuser/nf-winuser-dialogboxindirecta)
-   [**DialogBoxIndirectParam**](/windows/desktop/api/winuser/nf-winuser-dialogboxindirectparama)
-   [**DialogBoxParam**](/windows/desktop/api/winuser/nf-winuser-dialogboxparama)
-   [**GetMessage**](/windows/win32/api/winuser/nf-winuser-getmessage)
-   [**MessageBox**](/windows/desktop/api/winuser/nf-winuser-messagebox)
-   [**PeekMessage**](/windows/win32/api/winuser/nf-winuser-peekmessagea)
-   [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage)

Per evitare potenziali deadlock nell'applicazione, provare a usare le funzioni [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea) o [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta) . In caso contrario, una routine della finestra può determinare se un messaggio ricevuto è stato inviato da un altro thread chiamando la funzione [**InSendMessage**](/windows/win32/api/winuser/nf-winuser-insendmessage) o [**InSendMessageEx**](/windows/win32/api/winuser/nf-winuser-insendmessageex) . Prima di chiamare qualsiasi funzione nell'elenco precedente durante l'elaborazione di un messaggio, la routine della finestra deve prima chiamare **InSendMessage** o **InSendMessageEx**. Se questa funzione restituisce **true**, è necessario che la routine della finestra chiami la funzione [**ReplyMessage**](/windows/win32/api/winuser/nf-winuser-replymessage) prima di qualsiasi funzione che causa la produzione del controllo da parte del thread.

## <a name="broadcasting-messages"></a>Trasmissione di messaggi

Ogni messaggio è costituito da un identificatore di messaggio e da due parametri, *wParam* e *lParam*. L'identificatore del messaggio è un valore univoco che specifica lo scopo del messaggio. I parametri forniscono informazioni aggiuntive specifiche del messaggio, ma il parametro *wParam* è in genere un valore di tipo che fornisce ulteriori informazioni sul messaggio.

La *trasmissione* di un messaggio è semplicemente l'invio di un messaggio a più destinatari nel sistema. Per trasmettere un messaggio da un'applicazione, usare la funzione [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage) , specificando i destinatari del messaggio. Anziché specificare singoli destinatari, è necessario specificare uno o più tipi di destinatari. Questi tipi sono le applicazioni, i driver installabili, i driver di rete e i driver di dispositivo a livello di sistema. Il sistema invia messaggi broadcast a tutti i membri di ogni tipo specificato.

Il sistema trasmette in genere i messaggi in risposta alle modifiche che si verificano all'interno di driver di dispositivo a livello di sistema o componenti correlati. Il driver o il componente correlato trasmette il messaggio ad applicazioni e altri componenti per notificare la modifica. Ad esempio, il componente responsabile delle unità disco trasmette un messaggio ogni volta che il driver di dispositivo per l'unità disco floppy rileva una modifica di supporti, ad esempio quando l'utente inserisce un disco nell'unità.

Il sistema trasmette i messaggi ai destinatari nell'ordine seguente: i driver di dispositivo a livello di sistema, i driver di rete, i driver installabili e le applicazioni. Ciò significa che i driver di dispositivo a livello di sistema, se scelti come destinatari, ottengono sempre la prima opportunità per rispondere a un messaggio. All'interno di un determinato tipo di destinatario, nessun driver deve ricevere un determinato messaggio prima di qualsiasi altro driver. Questo significa che un messaggio destinato a un driver specifico deve avere un identificatore di messaggio univoco globale, in modo che nessun altro driver lo elabori involontariamente.

È inoltre possibile trasmettere messaggi a tutte le finestre di primo livello specificando **HWND \_ broadcast** nella funzione [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage), [**SendMessageCallback**](/windows/win32/api/winuser/nf-winuser-sendmessagecallbacka), [**SendMessageTimeout**](/windows/win32/api/winuser/nf-winuser-sendmessagetimeouta)o [**SendNotifyMessage**](/windows/win32/api/winuser/nf-winuser-sendnotifymessagea) .

Le applicazioni ricevono messaggi tramite la procedura della finestra delle finestre di primo livello. I messaggi non vengono inviati alle finestre figlio. I servizi possono ricevere messaggi tramite una routine della finestra o i relativi gestori di controllo del servizio.

> [!Note]  
> I driver di dispositivo a livello di sistema utilizzano una funzione correlata a livello di sistema per trasmettere i messaggi di sistema.

 

## <a name="query-messages"></a>Messaggi di query

È possibile creare messaggi personalizzati e usarli per coordinare le attività tra le applicazioni e gli altri componenti nel sistema. Questa operazione è particolarmente utile se sono stati creati driver installabili o driver di dispositivo a livello di sistema personalizzati. I messaggi personalizzati possono contenere informazioni da e verso il driver e le applicazioni che utilizzano il driver.

Per eseguire il polling dei destinatari per l'autorizzazione a eseguire un'azione specifica, usare un *messaggio di query*. È possibile generare messaggi di query personalizzati impostando il valore di **\_ query BSF** nel parametro *DwFlags* quando si chiama [**BroadcastSystemMessage**](/windows/win32/api/winuser/nf-winuser-broadcastsystemmessage). Ogni destinatario del messaggio di query deve restituire **true** affinché la funzione invii il messaggio al destinatario successivo. Se un destinatario restituisce **la \_ query broadcast \_ Deny**, la trasmissione termina immediatamente e la funzione restituisce zero.

 

 
