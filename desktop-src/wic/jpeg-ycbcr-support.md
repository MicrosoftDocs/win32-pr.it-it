---
description: A partire da Windows 8.1, il codec JPEG di Windows Imaging Component (WIC) supporta la lettura e la scrittura di dati immagine nel formato YCbCr nativo.
ms.assetid: 50B89A96-72E8-4771-9109-207F4CDD06CB
title: Supporto di YCbCr JPEG
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: b6a8f05fe55e724a12513f24fc7401d277ebf097
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103967568"
---
# <a name="jpeg-ycbcr-support"></a><span data-ttu-id="90cb3-103">Supporto di YCbCr JPEG</span><span class="sxs-lookup"><span data-stu-id="90cb3-103">JPEG YCbCr Support</span></span>

<span data-ttu-id="90cb3-104">A partire da Windows 8.1, il codec JPEG di [Windows Imaging Component (WIC)](-wic-about-windows-imaging-codec.md) supporta la lettura e la scrittura di dati immagine nel formato nativo YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-104">Starting with Windows 8.1, the [Windows Imaging Component (WIC)](-wic-about-windows-imaging-codec.md) JPEG codec supports reading and writing image data in its native YC<sub>b</sub>C<sub>r</sub> form.</span></span> <span data-ttu-id="90cb3-105">Il supporto di WIC YC<sub>b</sub>c<sub>r</sub> può essere usato insieme a [Direct2D](../direct2d/direct2d-portal.md) per eseguire il rendering dei dati di YC<sub>b</sub>c<sub>r</sub> pixel con effetto immagine.</span><span class="sxs-lookup"><span data-stu-id="90cb3-105">WIC YC<sub>b</sub>C<sub>r</sub> support can be used in conjunction with [Direct2D](../direct2d/direct2d-portal.md) to render YC<sub>b</sub>C<sub>r</sub> pixel data with an image effect.</span></span> <span data-ttu-id="90cb3-106">Inoltre, il codec JPEG di WIC può utilizzare i dati di YC<sub>b</sub>C<sub>r</sub> pixel prodotti da determinati driver della fotocamera tramite Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="90cb3-106">In addition, the WIC JPEG codec can consume YC<sub>b</sub>C<sub>r</sub> pixel data produced by certain camera drivers via Media Foundation.</span></span>

<span data-ttu-id="90cb3-107">I dati di YC<sub>b</sub>C<sub>r</sub> pixel utilizzano una quantità di memoria significativamente inferiore rispetto ai formati BGRA pixel standard.</span><span class="sxs-lookup"><span data-stu-id="90cb3-107">YC<sub>b</sub>C<sub>r</sub> pixel data consumes significantly less memory than standard BGRA pixel formats.</span></span> <span data-ttu-id="90cb3-108">Inoltre, l'accesso ai dati di YC<sub>b</sub>C<sub>r</sub> consente di eseguire l'offload di alcune fasi della pipeline di decodifica/codifica JPEG in Direct2D con accelerazione GPU.</span><span class="sxs-lookup"><span data-stu-id="90cb3-108">In addition, accessing YC<sub>b</sub>C<sub>r</sub> data allows you to offload some stages of the JPEG decode/encode pipeline to Direct2D which is GPU accelerated.</span></span> <span data-ttu-id="90cb3-109">Con YC<sub>b</sub>C<sub>r</sub>, l'app può ridurre il consumo di memoria JPEG e i tempi di caricamento per le stesse immagini di dimensioni e qualità.</span><span class="sxs-lookup"><span data-stu-id="90cb3-109">By using YC<sub>b</sub>C<sub>r</sub>, your app can reduce JPEG memory consumption and load times for the same size and quality images.</span></span> <span data-ttu-id="90cb3-110">In alternativa, l'app può usare immagini JPEG di risoluzione più elevata senza subire penalizzazioni delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="90cb3-110">Or, your app can use more, higher resolution JPEG images without suffering from performance penalties.</span></span>

<span data-ttu-id="90cb3-111">In questo argomento viene descritto il funzionamento<sub>dei dati</sub> di YC<sub>b</sub>C e viene illustrato come utilizzarlo in WIC e Direct2D.</span><span class="sxs-lookup"><span data-stu-id="90cb3-111">This topic describes how YC<sub>b</sub>C<sub>r</sub> data works and how to use it in WIC and Direct2D.</span></span>

-   [<span data-ttu-id="90cb3-112">Informazioni sui dati JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-112">About JPEG YC<sub>b</sub>C<sub>r</sub> Data</span></span>](#about-jpeg-ycbcr-data)
    -   [<span data-ttu-id="90cb3-113">Modello colori YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-113">YC<sub>b</sub>C<sub>r</sub> Color Model</span></span>](#ycbcr-color-model)
    -   [<span data-ttu-id="90cb3-114">Layout di memoria planare e Interleaved</span><span class="sxs-lookup"><span data-stu-id="90cb3-114">Planar Versus Interleaved Memory Layouts</span></span>](#planar-versus-interleaved-memory-layouts)
    -   [<span data-ttu-id="90cb3-115">Sottocampionamento Chroma</span><span class="sxs-lookup"><span data-stu-id="90cb3-115">Chroma Subsampling</span></span>](#chroma-subsampling)
    -   [<span data-ttu-id="90cb3-116">Utilizzo JPEG di YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-116">JPEG Usage of YC<sub>b</sub>C<sub>r</sub></span></span>](#jpeg-usage-of-ycbcr)
-   [<span data-ttu-id="90cb3-117">Uso dei dati JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-117">Using JPEG YC<sub>b</sub>C<sub>r</sub> Data</span></span>](#using-jpeg-ycbcr-data)
    -   [<span data-ttu-id="90cb3-118">Uso delle immagini JPEG di YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-118">Using YC<sub>b</sub>C<sub>r</sub> JPEG images</span></span>](#using-ycbcr-jpeg-images)
    -   [<span data-ttu-id="90cb3-119">API componenti Windows Imaging</span><span class="sxs-lookup"><span data-stu-id="90cb3-119">Windows Imaging Component APIs</span></span>](#windows-imaging-component-apis)
    -   [<span data-ttu-id="90cb3-120">API Direct2D</span><span class="sxs-lookup"><span data-stu-id="90cb3-120">Direct2D APIs</span></span>](#direct2d-apis)
    -   [<span data-ttu-id="90cb3-121">Determinazione della configurazione di YC<sub>b</sub>C<sub>r</sub> supportata</span><span class="sxs-lookup"><span data-stu-id="90cb3-121">Determining if the YC<sub>b</sub>C<sub>r</sub> Configuration is Supported</span></span>](#determining-if-the-ycbcr-configuration-is-supported)
    -   [<span data-ttu-id="90cb3-122">Decodifica dei dati di YC<sub>b</sub>C<sub>r</sub> pixel</span><span class="sxs-lookup"><span data-stu-id="90cb3-122">Decoding YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>](#decoding-ycbcr-pixel-data)
    -   [<span data-ttu-id="90cb3-123">Trasformazione dei dati di YC<sub>b</sub>C<sub>r</sub> pixel</span><span class="sxs-lookup"><span data-stu-id="90cb3-123">Transforming YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>](#transforming-ycbcr-pixel-data)
    -   [<span data-ttu-id="90cb3-124">Codifica dei dati dei pixel di YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-124">Encoding YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>](#encoding-ycbcr-pixel-data)
    -   [<span data-ttu-id="90cb3-125">Decodifica dei dati di YC<sub>b</sub>C<sub>r</sub> pixel in Windows 10</span><span class="sxs-lookup"><span data-stu-id="90cb3-125">Decoding YC<sub>b</sub>C<sub>r</sub> pixel data in Windows 10</span></span>](#decoding-ycbcr-pixel-data-in-windows-10)
-   [<span data-ttu-id="90cb3-126">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="90cb3-126">Related topics</span></span>](#related-topics)

## <a name="about-jpeg-ycsubbsubcsubrsub-data"></a><span data-ttu-id="90cb3-127">Informazioni sui dati JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-127">About JPEG YC<sub>b</sub>C<sub>r</sub> Data</span></span>

<span data-ttu-id="90cb3-128">In questa sezione vengono illustrati alcuni concetti chiave necessari per comprendere in che modo il supporto di YC<sub>b</sub>C<sub>r</sub> in WIC funziona e i vantaggi principali.</span><span class="sxs-lookup"><span data-stu-id="90cb3-128">This section explains some key concepts necessary to understand how YC<sub>b</sub>C<sub>r</sub> support in WIC works and its key benefits.</span></span>

### <a name="ycsubbsubcsubrsub-color-model"></a><span data-ttu-id="90cb3-129">Modello colori YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-129">YC<sub>b</sub>C<sub>r</sub> Color Model</span></span>

<span data-ttu-id="90cb3-130">WIC in Windows 8 e versioni precedenti supporta quattro diversi [modelli di colore](-wic-codec-native-pixel-formats.md), il più comune dei quali è RGB/BGR.</span><span class="sxs-lookup"><span data-stu-id="90cb3-130">WIC in Windows 8 and earlier supports four different [color models](-wic-codec-native-pixel-formats.md), the most common of which is RGB/BGR.</span></span> <span data-ttu-id="90cb3-131">Questo modello di colori definisce i dati dei colori utilizzando i componenti rosso, verde e blu; è possibile utilizzare anche un quarto componente alfa.</span><span class="sxs-lookup"><span data-stu-id="90cb3-131">This color model defines color data using red, green and blue components; a fourth alpha component may also be used.</span></span>

<span data-ttu-id="90cb3-132">Ecco un'immagine scomposta nei relativi componenti rosso, verde e blu.</span><span class="sxs-lookup"><span data-stu-id="90cb3-132">Here is an image decomposed into its red, green and blue components.</span></span>

![immagine scomposta nei relativi componenti rosso, verde e blu.](graphics/ycbcr1.png)

<span data-ttu-id="90cb3-134">YC<sub>b</sub>C<sub>r</sub> è un modello di colore alternativo che definisce i dati di colore utilizzando un componente di luminanza (Y) e due componenti cromatura (c<sub>b</sub> e c<sub>r</sub>).</span><span class="sxs-lookup"><span data-stu-id="90cb3-134">YC<sub>b</sub>C<sub>r</sub> is an alternate color model that defines color data using a luminance component (Y) and two chrominance components (C<sub>b</sub> and C<sub>r</sub>).</span></span> <span data-ttu-id="90cb3-135">Viene in genere usato in scenari di imaging digitale e video.</span><span class="sxs-lookup"><span data-stu-id="90cb3-135">It is commonly used in digital imaging and video scenarios.</span></span> <span data-ttu-id="90cb3-136">Il termine YC<sub>b</sub>C<sub>r</sub> viene spesso usato in modo interscambiabile con YUV, sebbene i due siano tecnicamente distinti.</span><span class="sxs-lookup"><span data-stu-id="90cb3-136">The term YC<sub>b</sub>C<sub>r</sub> is often used interchangeably with YUV, although the two are technically distinct.</span></span>

<span data-ttu-id="90cb3-137">Sono disponibili diverse varianti di YC<sub>b</sub>c<sub>r</sub> che differiscono nello spazio dei colori e nelle definizioni di intervallo dinamico: WIC supporta specificamente i dati JPEG JFIF YC<sub>b</sub>c<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-137">There are several variations of YC<sub>b</sub>C<sub>r</sub> which differ in color space and dynamic range definitions – WIC specifically supports JPEG JFIF YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="90cb3-138">Per ulteriori informazioni, vedere la [specifica di JPEG ITU-T81](https://www.w3.org/Graphics/JPEG/itu-t81.pdf).</span><span class="sxs-lookup"><span data-stu-id="90cb3-138">For more information, refer to the [JPEG ITU-T81 specification](https://www.w3.org/Graphics/JPEG/itu-t81.pdf).</span></span>

<span data-ttu-id="90cb3-139">Ecco un'immagine scomposta nei componenti Y, C<sub>b</sub>e c<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-139">Here is an image decomposed into its Y, C<sub>b</sub>, and C<sub>r</sub> components.</span></span>

![immagine scomposta nei componenti y, CB e CR.](graphics/ycbcr2.png)

### <a name="planar-versus-interleaved-memory-layouts"></a><span data-ttu-id="90cb3-141">Layout di memoria planare e Interleaved</span><span class="sxs-lookup"><span data-stu-id="90cb3-141">Planar Versus Interleaved Memory Layouts</span></span>

<span data-ttu-id="90cb3-142">In questa sezione vengono descritte alcune differenze tra l'accesso e l'archiviazione dei dati pixel RGB in memoria rispetto ai dati YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-142">This section describes some differences between accessing and storing RGB pixel data in memory versus YC<sub>b</sub>C<sub>r</sub> data.</span></span>

<span data-ttu-id="90cb3-143">I dati pixel RGB vengono in genere archiviati usando un layout di memoria con interfoliazione.</span><span class="sxs-lookup"><span data-stu-id="90cb3-143">RGB pixel data is typically stored using an interleaved memory layout.</span></span> <span data-ttu-id="90cb3-144">Ciò significa che i dati per un singolo componente a colori sono interfogliati tra i pixel e ogni pixel viene archiviato in modo contiguo nella memoria.</span><span class="sxs-lookup"><span data-stu-id="90cb3-144">This means that data for a single color component is interleaved between pixels, and each pixel is stored contiguously in memory.</span></span>

<span data-ttu-id="90cb3-145">Ecco una figura che mostra i dati pixel RGBA archiviati in un layout di memoria interleaved.</span><span class="sxs-lookup"><span data-stu-id="90cb3-145">Here is a figure showing RGBA pixel data stored in an interleaved memory layout.</span></span>

![figura che mostra i dati pixel RGBA archiviati in un layout di memoria interleaved.](graphics/ycbcr3.png)

<span data-ttu-id="90cb3-147">I dati YC<sub>b</sub>C<sub>r</sub> vengono in genere archiviati usando un layout di memoria planare.</span><span class="sxs-lookup"><span data-stu-id="90cb3-147">YC<sub>b</sub>C<sub>r</sub> data is typically stored using a planar memory layout.</span></span> <span data-ttu-id="90cb3-148">Ciò significa che ogni componente colore viene archiviato separatamente nel proprio piano contiguo, per un totale di tre piani.</span><span class="sxs-lookup"><span data-stu-id="90cb3-148">This means that each color component is stored separately in its own contiguous plane, for a total of three planes.</span></span> <span data-ttu-id="90cb3-149">In un'altra configurazione comune, i componenti C<sub>b</sub> e c<sub>r</sub> vengono Interleaved e archiviati insieme, mentre il componente Y rimane nel proprio piano, per un totale di due piani.</span><span class="sxs-lookup"><span data-stu-id="90cb3-149">In another common configuration, the C<sub>b</sub> and C<sub>r</sub> components are interleaved and stored together, while the Y component remains in its own plane, for a total of two planes.</span></span>

<span data-ttu-id="90cb3-150">Ecco una figura che mostra i dati planari Y e Interleaved C<sub>b</sub>c<sub>r</sub> pixel, un layout comune YC<sub>b</sub>c<sub>r</sub> Memory.</span><span class="sxs-lookup"><span data-stu-id="90cb3-150">Here is a figure showing planar Y and interleaved C<sub>b</sub>C<sub>r</sub> pixel data, a common YC<sub>b</sub>C<sub>r</sub> memory layout.</span></span>

![figura che mostra i dati planari y e CbCr con interfoliazione pixel, un layout comune della memoria YCbCr.](graphics/ycbcr4.png)

<span data-ttu-id="90cb3-152">In WIC e Direct2D ogni piano di colore viene considerato come un oggetto distinto ( [IWICBitmapSource](-wic-imp-iwicbitmapsource.md) o [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap)) e collettivamente questi piani formano i dati di supporto per un'immagine YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-152">In both WIC and Direct2D, each color plane is treated as its own distinct object (either an [IWICBitmapSource](-wic-imp-iwicbitmapsource.md) or [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap)), and collectively these planes form the backing data for a YC<sub>b</sub>C<sub>r</sub> image.</span></span>

<span data-ttu-id="90cb3-153">Mentre WIC supporta l'accesso<sub>ai dati YC</sub> <sub>b</sub>C in entrambe le configurazioni del piano 2 e 3, Direct2D supporta solo la prima (Y e c<sub>b</sub>c<sub>r</sub>).</span><span class="sxs-lookup"><span data-stu-id="90cb3-153">While WIC supports accessing YC<sub>b</sub>C<sub>r</sub> data in both the 2 and 3 plane configurations, Direct2D only supports the former (Y and C<sub>b</sub>C<sub>r</sub>).</span></span> <span data-ttu-id="90cb3-154">Pertanto, quando si utilizzano WIC e Direct2D insieme, è necessario utilizzare sempre la configurazione 2 del piano YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-154">Therefore, when using WIC and Direct2D together you should always use the 2 plane YC<sub>b</sub>C<sub>r</sub> configuration.</span></span>

### <a name="chroma-subsampling"></a><span data-ttu-id="90cb3-155">Sottocampionamento Chroma</span><span class="sxs-lookup"><span data-stu-id="90cb3-155">Chroma Subsampling</span></span>

<span data-ttu-id="90cb3-156">Il modello di colore YC<sub>b</sub>C<sub>r</sub> è particolarmente adatto per scenari di imaging digitale, in quanto può trarre vantaggio da determinati aspetti del sistema visivo umano.</span><span class="sxs-lookup"><span data-stu-id="90cb3-156">The YC<sub>b</sub>C<sub>r</sub> color model is well suited for digital imaging scenarios because it can take advantage of certain aspects of the human visual system.</span></span> <span data-ttu-id="90cb3-157">In particolare, gli utenti sono più sensibili alle modifiche apportate alla luminanza (luminosità) di un'immagine e meno sensibili a cromatura (Color).</span><span class="sxs-lookup"><span data-stu-id="90cb3-157">In particular, humans are more sensitive to changes in the luminance (brightness) of an image and less sensitive to chrominance (color).</span></span> <span data-ttu-id="90cb3-158">Suddividendo i dati dei colori in componenti di luminanza e cromatura distinti, è possibile comprimere selettivamente solo i componenti cromatura per ottenere risparmi di spazio con una perdita minima di qualità.</span><span class="sxs-lookup"><span data-stu-id="90cb3-158">By splitting the color data into separate luminance and chrominance components, we can selectively compress just the chrominance components to achieve space savings with a minimal loss in quality.</span></span>

<span data-ttu-id="90cb3-159">Una tecnica per eseguire questa operazione è detta sottocampionatura Chroma.</span><span class="sxs-lookup"><span data-stu-id="90cb3-159">One technique for doing this is called chroma subsampling.</span></span> <span data-ttu-id="90cb3-160">I piani C<sub>b</sub> e c<sub>r</sub> sono sottocampionati (downscaling) in una o in entrambe le dimensioni orizzontali e verticali.</span><span class="sxs-lookup"><span data-stu-id="90cb3-160">The C<sub>b</sub> and C<sub>r</sub> planes are subsampled (downscaled) in one or both of the horizontal and vertical dimensions.</span></span> <span data-ttu-id="90cb3-161">Per motivi cronologici, a ogni modalità di sottocampionamento Chroma viene comunemente fatto riferimento utilizzando un rapporto in tre parti J:a: b.</span><span class="sxs-lookup"><span data-stu-id="90cb3-161">For historical reasons, each chroma subsampling mode is commonly referred to using a three part J:a:b ratio.</span></span>



| <span data-ttu-id="90cb3-162">Modalità sottocampionamento</span><span class="sxs-lookup"><span data-stu-id="90cb3-162">Subsampling mode</span></span> | <span data-ttu-id="90cb3-163">Downscaling orizzontale</span><span class="sxs-lookup"><span data-stu-id="90cb3-163">Horizontal downscale</span></span> | <span data-ttu-id="90cb3-164">Downscaling verticali</span><span class="sxs-lookup"><span data-stu-id="90cb3-164">Vertical downscale</span></span> | <span data-ttu-id="90cb3-165">Bit per pixel\*</span><span class="sxs-lookup"><span data-stu-id="90cb3-165">Bits per pixel\*</span></span> |
|------------------|----------------------|--------------------|------------------|
| <span data-ttu-id="90cb3-166">4:4:4</span><span class="sxs-lookup"><span data-stu-id="90cb3-166">4:4:4</span></span>            | <span data-ttu-id="90cb3-167">1x</span><span class="sxs-lookup"><span data-stu-id="90cb3-167">1x</span></span>                   | <span data-ttu-id="90cb3-168">1x</span><span class="sxs-lookup"><span data-stu-id="90cb3-168">1x</span></span>                 | <span data-ttu-id="90cb3-169">24</span><span class="sxs-lookup"><span data-stu-id="90cb3-169">24</span></span>               |
| <span data-ttu-id="90cb3-170">4:2:2</span><span class="sxs-lookup"><span data-stu-id="90cb3-170">4:2:2</span></span>            | <span data-ttu-id="90cb3-171">2x</span><span class="sxs-lookup"><span data-stu-id="90cb3-171">2x</span></span>                   | <span data-ttu-id="90cb3-172">1x</span><span class="sxs-lookup"><span data-stu-id="90cb3-172">1x</span></span>                 | <span data-ttu-id="90cb3-173">16</span><span class="sxs-lookup"><span data-stu-id="90cb3-173">16</span></span>               |
| <span data-ttu-id="90cb3-174">4:4:0</span><span class="sxs-lookup"><span data-stu-id="90cb3-174">4:4:0</span></span>            | <span data-ttu-id="90cb3-175">1x</span><span class="sxs-lookup"><span data-stu-id="90cb3-175">1x</span></span>                   | <span data-ttu-id="90cb3-176">2x</span><span class="sxs-lookup"><span data-stu-id="90cb3-176">2x</span></span>                 | <span data-ttu-id="90cb3-177">16</span><span class="sxs-lookup"><span data-stu-id="90cb3-177">16</span></span>               |
| <span data-ttu-id="90cb3-178">4:2:0</span><span class="sxs-lookup"><span data-stu-id="90cb3-178">4:2:0</span></span>            | <span data-ttu-id="90cb3-179">2x</span><span class="sxs-lookup"><span data-stu-id="90cb3-179">2x</span></span>                   | <span data-ttu-id="90cb3-180">2x</span><span class="sxs-lookup"><span data-stu-id="90cb3-180">2x</span></span>                 | <span data-ttu-id="90cb3-181">12</span><span class="sxs-lookup"><span data-stu-id="90cb3-181">12</span></span>               |



 

<span data-ttu-id="90cb3-182">\* Include i dati Y.</span><span class="sxs-lookup"><span data-stu-id="90cb3-182">\* Includes Y data.</span></span>

<span data-ttu-id="90cb3-183">Dalla tabella precedente, se si usa YC<sub>b</sub>C<sub>r</sub> per archiviare i dati di immagine non compressi, è possibile ottenere un risparmio di memoria del 25% 32 rispetto al 62,5% rispetto ai dati RGBA di bit per pixel, a seconda della modalità di campionamento secondario Chroma.</span><span class="sxs-lookup"><span data-stu-id="90cb3-183">From the above table, if you use YC<sub>b</sub>C<sub>r</sub> to store uncompressed image data you can achieve a memory savings of 25% to 62.5% versus 32 bit per pixel RGBA data, depending on which chroma subsampling mode is used.</span></span>

### <a name="jpeg-usage-of-ycsubbsubcsubrsub"></a><span data-ttu-id="90cb3-184">Utilizzo JPEG di YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-184">JPEG Usage of YC<sub>b</sub>C<sub>r</sub></span></span>

<span data-ttu-id="90cb3-185">A un livello elevato, la pipeline di decompressione JPEG è costituita dalle seguenti fasi:</span><span class="sxs-lookup"><span data-stu-id="90cb3-185">At a high level, the JPEG decompression pipeline consists of the following stages:</span></span>

1.  <span data-ttu-id="90cb3-186">Eseguire la decompressione entropia (ad esempio, Huffman)</span><span class="sxs-lookup"><span data-stu-id="90cb3-186">Perform entropy (e.g. Huffman) decompression</span></span>
2.  <span data-ttu-id="90cb3-187">Esegui dequantizzazione</span><span class="sxs-lookup"><span data-stu-id="90cb3-187">Perform dequantization</span></span>
3.  <span data-ttu-id="90cb3-188">Esegui trasformazione coseno discreta inversa</span><span class="sxs-lookup"><span data-stu-id="90cb3-188">Perform inverse discrete cosine transform</span></span>
4.  <span data-ttu-id="90cb3-189">Eseguire il campionamento di crominanza sui dati C<sub>b</sub>c<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-189">Perform chroma upsampling on C<sub>b</sub>C<sub>r</sub> data</span></span>
5.  <span data-ttu-id="90cb3-190">Convertire i dati YC<sub>b</sub>C<sub>r</sub> in RGBA (se necessario)</span><span class="sxs-lookup"><span data-stu-id="90cb3-190">Convert YC<sub>b</sub>C<sub>r</sub> data to RGBA (if needed)</span></span>

<span data-ttu-id="90cb3-191">Con il codec JPEG che produce i dati di YC<sub>b</sub>C<sub>r</sub> , è possibile evitare i due passaggi finali del processo di decodifica oppure rinviarli alla GPU.</span><span class="sxs-lookup"><span data-stu-id="90cb3-191">By having the JPEG codec produce YC<sub>b</sub>C<sub>r</sub> data, we can avoid the final two steps of the decode process, or defer them to the GPU.</span></span> <span data-ttu-id="90cb3-192">Oltre ai risparmi di memoria elencati nella sezione precedente, questo riduce in modo significativo il tempo complessivo necessario per decodificare l'immagine.</span><span class="sxs-lookup"><span data-stu-id="90cb3-192">In addition to the memory savings listed in the previous section, this significantly reduces overall time needed to decode the image.</span></span> <span data-ttu-id="90cb3-193">Lo stesso risparmio si applica quando si codificano i dati YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-193">The same savings apply when encoding YC<sub>b</sub>C<sub>r</sub> data.</span></span>

## <a name="using-jpeg-ycsubbsubcsubrsub-data"></a><span data-ttu-id="90cb3-194">Uso dei dati JPEG YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-194">Using JPEG YC<sub>b</sub>C<sub>r</sub> Data</span></span>

<span data-ttu-id="90cb3-195">In questa sezione viene illustrato come utilizzare WIC e Direct2D per operare sui dati di YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-195">This section explains how to use WIC and Direct2D to operate on YC<sub>b</sub>C<sub>r</sub> data.</span></span>

<span data-ttu-id="90cb3-196">Per visualizzare le indicazioni fornite in questo documento, vedere l'esempio relativo alle [ottimizzazioni JPEG YCbCr in Direct2D e WIC](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample) , che illustra tutti i passaggi necessari per decodificare e eseguire il rendering del contenuto YC<sub>b</sub>C<sub>r</sub> in un'app Direct2D.</span><span class="sxs-lookup"><span data-stu-id="90cb3-196">To see the guidance from this document used in practice, see the [JPEG YCbCr optimizations in Direct2D and WIC sample](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample) which demonstrates all of the steps needed to decode and render YC<sub>b</sub>C<sub>r</sub> content in a Direct2D app.</span></span>

### <a name="using-ycsubbsubcsubrsub-jpeg-images"></a><span data-ttu-id="90cb3-197">Uso delle immagini JPEG di YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-197">Using YC<sub>b</sub>C<sub>r</sub> JPEG images</span></span>

<span data-ttu-id="90cb3-198">La maggior parte delle immagini JPEG viene archiviata come YC<sub>b</sub>C<sub>r</sub>.</span><span class="sxs-lookup"><span data-stu-id="90cb3-198">The vast majority of JPEG images are stored as YC<sub>b</sub>C<sub>r</sub>.</span></span> <span data-ttu-id="90cb3-199">Alcuni file JPEG contengono dati CMYK o in scala di grigi e non utilizzano YC<sub>b</sub>C<sub>r</sub>.</span><span class="sxs-lookup"><span data-stu-id="90cb3-199">Some JPEGs contain CMYK or grayscale data and do not use YC<sub>b</sub>C<sub>r</sub>.</span></span> <span data-ttu-id="90cb3-200">Ciò significa che in genere, ma non sempre, può usare direttamente il contenuto JPEG preesistente senza alcuna modifica.</span><span class="sxs-lookup"><span data-stu-id="90cb3-200">This means that you typically, but not always, can directly use pre-existing JPEG content without any modifications.</span></span>

<span data-ttu-id="90cb3-201">WIC e Direct2D non supportano tutte le<sub>possibili configurazioni di</sub> YC<sub>b</sub>c e il supporto di YC<sub>b</sub>c<sub>r</sub> in Direct2D dipende dall'hardware e dal driver grafici sottostanti.</span><span class="sxs-lookup"><span data-stu-id="90cb3-201">WIC and Direct2D do not support every possible YC<sub>b</sub>C<sub>r</sub> configuration, and YC<sub>b</sub>C<sub>r</sub> support in Direct2D is dependent upon the underlying graphics hardware and driver.</span></span> <span data-ttu-id="90cb3-202">Per questo motivo, una pipeline di imaging generica deve essere affidabile per le immagini che non usano YC<sub>b</sub>c<sub>r</sub> (inclusi altri formati di immagine comuni come PNG o BMP) oppure nei casi in cui il supporto di YC<sub>b</sub>c<sub>r</sub> non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="90cb3-202">Because of this, a general purpose imaging pipeline needs to be robust to images that do not use YC<sub>b</sub>C<sub>r</sub> (including other common image formats such as PNG or BMP) or to cases where YC<sub>b</sub>C<sub>r</sub> support is not available.</span></span> <span data-ttu-id="90cb3-203">Si consiglia di proteggere la pipeline di imaging basata su BGRA esistente e di abilitare YC<sub>b</sub>C<sub>r</sub> come ottimizzazione delle prestazioni, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="90cb3-203">We recommend that you keep your existing BGRA based imaging pipeline and enable YC<sub>b</sub>C<sub>r</sub> as a performance optimization when available.</span></span>

### <a name="windows-imaging-component-apis"></a><span data-ttu-id="90cb3-204">API componenti Windows Imaging</span><span class="sxs-lookup"><span data-stu-id="90cb3-204">Windows Imaging Component APIs</span></span>

<span data-ttu-id="90cb3-205">WIC in Windows 8.1 aggiunge tre nuove interfacce per fornire l'accesso ai dati JPEG YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-205">WIC in Windows 8.1 adds three new interfaces to provide access to JPEG YC<sub>b</sub>C<sub>r</sub> data.</span></span>

### <a name="iwicplanarbitmapsourcetransform"></a><span data-ttu-id="90cb3-206">IWICPlanarBitmapSourceTransform</span><span class="sxs-lookup"><span data-stu-id="90cb3-206">IWICPlanarBitmapSourceTransform</span></span>

<span data-ttu-id="90cb3-207">[**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform) è analogo a [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform), ad eccezione del fatto che produce pixel in una configurazione planare, inclusi i dati di YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-207">[**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform) is analogous to [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform), except that it produces pixels in a planar configuration, including YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="90cb3-208">È possibile ottenere questa interfaccia chiamando QueryInterface su un'implementazione di [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) che supporta l'accesso planare.</span><span class="sxs-lookup"><span data-stu-id="90cb3-208">You can obtain this interface by calling QueryInterface on an implementation of [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) that supports planar access.</span></span> <span data-ttu-id="90cb3-209">Ciò include l'implementazione del codec JPEG di [**IWICBitmapFrameDecode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframedecode) , nonché [**IWICBitmapScaler**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapscaler), [**IWICBitmapFlipRotator**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapfliprotator)e [**IWICColorTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwiccolortransform).</span><span class="sxs-lookup"><span data-stu-id="90cb3-209">This includes the JPEG codec’s implementation of [**IWICBitmapFrameDecode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframedecode) as well as [**IWICBitmapScaler**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapscaler), [**IWICBitmapFlipRotator**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapfliprotator), and [**IWICColorTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwiccolortransform).</span></span>

### <a name="iwicplanarbitmapframeencode"></a><span data-ttu-id="90cb3-210">IWICPlanarBitmapFrameEncode</span><span class="sxs-lookup"><span data-stu-id="90cb3-210">IWICPlanarBitmapFrameEncode</span></span>

<span data-ttu-id="90cb3-211">[**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode) offre la possibilità di codificare i dati planari dei pixel, inclusi i dati di YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-211">[**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode) provides the ability to encode planar pixel data, including YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="90cb3-212">È possibile ottenere questa interfaccia chiamando QueryInterface sull'implementazione del codec JPEG di [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span><span class="sxs-lookup"><span data-stu-id="90cb3-212">You can obtain this interface by calling QueryInterface on the JPEG codec’s implementation of [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span></span>

### <a name="iwicplanarformatconverter"></a><span data-ttu-id="90cb3-213">IWICPlanarFormatConverter</span><span class="sxs-lookup"><span data-stu-id="90cb3-213">IWICPlanarFormatConverter</span></span>

<span data-ttu-id="90cb3-214">[**IWICPlanarFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarformatconverter) consente a [**IWICFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicformatconverter) di utilizzare dati planari in pixel, tra cui YC <sub>b</sub>C <sub>r</sub>, e di convertirli in un formato pixel Interleaved.</span><span class="sxs-lookup"><span data-stu-id="90cb3-214">[**IWICPlanarFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarformatconverter) allows [**IWICFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicformatconverter) to consume planar pixel data, including YC<sub>b</sub>C<sub>r</sub>, and convert it to an interleaved pixel format.</span></span> <span data-ttu-id="90cb3-215">Non è in grado di convertire i dati dei pixel con interfoliazione in un formato planare.</span><span class="sxs-lookup"><span data-stu-id="90cb3-215">It does not expose the ability to convert interleaved pixel data to a planar format.</span></span> <span data-ttu-id="90cb3-216">È possibile ottenere questa interfaccia chiamando QueryInterface sull'implementazione di **IWICFormatConverter** fornita da Windows.</span><span class="sxs-lookup"><span data-stu-id="90cb3-216">You can obtain this interface by calling QueryInterface on the Windows provided implementation of **IWICFormatConverter**.</span></span>

### <a name="direct2d-apis"></a><span data-ttu-id="90cb3-217">API Direct2D</span><span class="sxs-lookup"><span data-stu-id="90cb3-217">Direct2D APIs</span></span>

<span data-ttu-id="90cb3-218">Direct2D in Windows 8.1 supporta i dati in pixel planari di YC<sub>b</sub>c<sub>r</sub> con il nuovo effetto immagine YC<sub>b</sub>c<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-218">Direct2D in Windows 8.1 supports YC<sub>b</sub>C<sub>r</sub> planar pixel data with the new YC<sub>b</sub>C<sub>r</sub> image effect .</span></span> <span data-ttu-id="90cb3-219">Questo effetto fornisce la possibilità di eseguire il rendering dei dati di YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-219">This effect provides the ability to render YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="90cb3-220">L'effetto accetta come input due interfacce [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) : una contenente i dati planari Y nel formato \_ DXGI \_ R8 \_ UNORM e l'altra che contiene dati CbCr con interfoliazione nel formato \_ \_ DXGI R8G8 \_ formato UNORM.</span><span class="sxs-lookup"><span data-stu-id="90cb3-220">The effect takes as input two [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) interfaces: one containing planar Y data in the DXGI\_FORMAT\_R8\_UNORM format, and one containing interleaved CbCr data in the DXGI\_FORMAT\_R8G8\_UNORM format.</span></span> <span data-ttu-id="90cb3-221">Questo effetto viene in genere usato al posto di **ID2D1Bitmap** che contenevano dati BGRA pixel.</span><span class="sxs-lookup"><span data-stu-id="90cb3-221">You typically use this effect in place of the **ID2D1Bitmap** that would have contained BGRA pixel data.</span></span>

<span data-ttu-id="90cb3-222">L'effetto immagine YC<sub>b</sub>c<sub>r</sub> deve essere usato insieme alle API WIC YC<sub>b</sub>c<sub>r</sub> che forniscono i dati di YC<sub>b</sub>c<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-222">The YC<sub>b</sub>C<sub>r</sub> image effect is intended to be used in conjunction with the WIC YC<sub>b</sub>C<sub>r</sub> APIs which provide the YC<sub>b</sub>C<sub>r</sub> data.</span></span> <span data-ttu-id="90cb3-223">Questo agisce efficacemente per eseguire l'offload di parte del lavoro di decodifica dalla CPU alla GPU, dove può essere elaborato molto più rapidamente e in parallelo.</span><span class="sxs-lookup"><span data-stu-id="90cb3-223">This effectively acts to offload some of the decode work from the CPU to the GPU, where it can be processed much quicker and in parallel.</span></span>

### <a name="determining-if-the-ycsubbsubcsubrsub-configuration-is-supported"></a><span data-ttu-id="90cb3-224">Determinazione della configurazione di YC<sub>b</sub>C<sub>r</sub> supportata</span><span class="sxs-lookup"><span data-stu-id="90cb3-224">Determining if the YC<sub>b</sub>C<sub>r</sub> Configuration is Supported</span></span>

<span data-ttu-id="90cb3-225">Come indicato in precedenza, l'app deve essere affidabile nei casi in cui il supporto di YC<sub>b</sub>C<sub>r</sub> non è disponibile.</span><span class="sxs-lookup"><span data-stu-id="90cb3-225">As noted before, your app should be robust to cases where YC<sub>b</sub>C<sub>r</sub> support is not available.</span></span> <span data-ttu-id="90cb3-226">Questa sezione illustra le condizioni che l'app deve verificare.</span><span class="sxs-lookup"><span data-stu-id="90cb3-226">This section discusses the conditions that your app should check for.</span></span> <span data-ttu-id="90cb3-227">Se uno dei controlli seguenti ha esito negativo, l'app deve eseguire il fallback a una pipeline basata su BGRA standard.</span><span class="sxs-lookup"><span data-stu-id="90cb3-227">If any of the following checks fail, your app should fall back to a standard BGRA-based pipeline.</span></span>

### <a name="does-the-wic-component-support-ycsubbsubcsubrsub-data-access"></a><span data-ttu-id="90cb3-228">Il componente WIC supporta l'accesso ai dati YC<sub>b</sub>C<sub>r</sub> ?</span><span class="sxs-lookup"><span data-stu-id="90cb3-228">Does the WIC component support YC<sub>b</sub>C<sub>r</sub> data access?</span></span>

<span data-ttu-id="90cb3-229">Solo il codec JPEG fornito da Windows e alcune trasformazioni WIC supportano l'accesso ai dati YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-229">Only the Windows provided JPEG codec and certain WIC transforms support YC<sub>b</sub>C<sub>r</sub> data access.</span></span> <span data-ttu-id="90cb3-230">Per un elenco completo, vedere la sezione [API componenti Windows Imaging](#windows-imaging-component-apis) .</span><span class="sxs-lookup"><span data-stu-id="90cb3-230">For a complete list, refer to the [Windows Imaging Component APIs](#windows-imaging-component-apis) section.</span></span>

<span data-ttu-id="90cb3-231">Per ottenere una delle interfacce planare YC<sub>b</sub>C<sub>r</sub> , chiamare QueryInterface sull'interfaccia originale.</span><span class="sxs-lookup"><span data-stu-id="90cb3-231">To obtain one of the planar YC<sub>b</sub>C<sub>r</sub> interfaces, call QueryInterface on the original interface.</span></span> <span data-ttu-id="90cb3-232">Questa operazione avrà esito negativo se il componente non supporta l'accesso ai dati YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-232">This will fail if the component does not support YC<sub>b</sub>C<sub>r</sub> data access.</span></span>

### <a name="is-the-requested-wic-transform-supported-for-ycsubbsubcsubrsub"></a><span data-ttu-id="90cb3-233">La trasformazione WIC richiesta è supportata per YC<sub>b</sub>C<sub>r</sub>?</span><span class="sxs-lookup"><span data-stu-id="90cb3-233">Is the requested WIC transform supported for YC<sub>b</sub>C<sub>r</sub>?</span></span>

<span data-ttu-id="90cb3-234">Dopo aver ottenuto un [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform), è necessario prima chiamare [**DoesSupportTransform**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-doessupporttransform).</span><span class="sxs-lookup"><span data-stu-id="90cb3-234">After obtaining an [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform), you should first call [**DoesSupportTransform**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-doessupporttransform).</span></span> <span data-ttu-id="90cb3-235">Questo metodo accetta come parametri di input il set completo di trasformazioni che si vuole applicare ai dati planare YC<sub>b</sub>C<sub>r</sub> e restituisce un valore booleano che indica il supporto, nonché le dimensioni più vicine alle dimensioni richieste che possono essere restituite.</span><span class="sxs-lookup"><span data-stu-id="90cb3-235">This method takes as input parameters the complete set of transforms that you want to be applied to the planar YC<sub>b</sub>C<sub>r</sub> data, and returns a Boolean indicating support, as well as the closest dimensions to the requested size that can be returned.</span></span> <span data-ttu-id="90cb3-236">È consigliabile controllare tutti e tre i valori prima di accedere ai dati pixel con [**IWICPlanarBitmapSourceTransform:: CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-copypixels).</span><span class="sxs-lookup"><span data-stu-id="90cb3-236">You should check all three values before accessing the pixel data with [**IWICPlanarBitmapSourceTransform::CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-copypixels).</span></span>

<span data-ttu-id="90cb3-237">Questo modello è simile al modo in cui viene usato [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform) .</span><span class="sxs-lookup"><span data-stu-id="90cb3-237">This pattern is similar to how [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform) is used.</span></span>

### <a name="does-the-graphics-driver-support-the-features-necessary-to-use-ycsubbsubcsubrsub-with-direct2d"></a><span data-ttu-id="90cb3-238">Il driver di grafica supporta le funzionalità necessarie per usare YC<sub>b</sub>C<sub>r</sub> con Direct2D?</span><span class="sxs-lookup"><span data-stu-id="90cb3-238">Does the graphics driver support the features necessary to use YC<sub>b</sub>C<sub>r</sub> with Direct2D?</span></span>

<span data-ttu-id="90cb3-239">Questo controllo è necessario solo se si usa l'effetto Direct2D YC<sub>b</sub>c<sub>r</sub> per il rendering del contenuto YC<sub>b</sub>c<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-239">This check is only necessary if you are using the Direct2D YC<sub>b</sub>C<sub>r</sub> effect to render YC<sub>b</sub>C<sub>r</sub> content.</span></span> <span data-ttu-id="90cb3-240">Direct2D archivia i dati di YC<sub>b</sub>C<sub>r</sub> usando \_ i \_ formati DXGI R8 \_ UNORM e DXGI \_ Format \_ R8G8 \_ UNORM pixel, che non sono disponibili da tutti i driver grafici.</span><span class="sxs-lookup"><span data-stu-id="90cb3-240">Direct2D stores YC<sub>b</sub>C<sub>r</sub> data using the DXGI\_FORMAT\_R8\_UNORM and DXGI\_FORMAT\_R8G8\_UNORM pixel formats, which are not available from all graphics drivers.</span></span>

<span data-ttu-id="90cb3-241">Prima di usare l'effetto immagine YC <sub>b</sub>C <sub>r</sub> , è necessario chiamare [**ID2D1DeviceContext:: IsDxgiFormatSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isdxgiformatsupported) per assicurarsi che entrambi i formati siano supportati dal driver.</span><span class="sxs-lookup"><span data-stu-id="90cb3-241">Before using the YC <sub>b</sub>C <sub>r</sub> image effect, you should call [**ID2D1DeviceContext::IsDxgiFormatSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isdxgiformatsupported) to ensure that both formats are supported by the driver.</span></span>

### <a name="sample-code"></a><span data-ttu-id="90cb3-242">Codice di esempio</span><span class="sxs-lookup"><span data-stu-id="90cb3-242">Sample code</span></span>

<span data-ttu-id="90cb3-243">Di seguito è riportato un esempio di codice che illustra i controlli consigliati.</span><span class="sxs-lookup"><span data-stu-id="90cb3-243">Below is a code example demonstrating the recommended checks.</span></span> <span data-ttu-id="90cb3-244">Questo esempio è stato ricavato dalle [ottimizzazioni JPEG YCbCr nell'esempio Direct2D e WIC](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample).</span><span class="sxs-lookup"><span data-stu-id="90cb3-244">This example was taken from the [JPEG YCbCr optimizations in Direct2D and WIC sample](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample).</span></span>


```C++
bool DirectXSampleRenderer::DoesWicSupportRequestedYCbCr()
{
    ComPtr<IWICPlanarBitmapSourceTransform> wicPlanarSource;
    HRESULT hr = m_wicScaler.As(&wicPlanarSource);
    if (SUCCEEDED(hr))
    {
        BOOL isTransformSupported;
        uint32 supportedWidth = m_cachedBitmapPixelWidth;
        uint32 supportedHeight = m_cachedBitmapPixelHeight;
        DX::ThrowIfFailed(
            wicPlanarSource->DoesSupportTransform(
                &supportedWidth,
                &supportedHeight,
                WICBitmapTransformRotate0,
                WICPlanarOptionsDefault,
                SampleConstants::WicYCbCrFormats,
                m_planeDescriptions,
                SampleConstants::NumPlanes,
                &isTransformSupported
                )
            );

        // The returned width and height may be larger if IWICPlanarBitmapSourceTransform does not
        // exactly support what is requested.
        if ((isTransformSupported == TRUE) &&
            (supportedWidth == m_cachedBitmapPixelWidth) &&
            (supportedHeight == m_cachedBitmapPixelHeight))
        {
            return true;
        }
    }

    return false;
}

bool DirectXSampleRenderer::DoesDriverSupportYCbCr()
{
    auto d2dContext = m_deviceResources->GetD2DDeviceContext();

    return (d2dContext->IsDxgiFormatSupported(DXGI_FORMAT_R8_UNORM)) &&
        (d2dContext->IsDxgiFormatSupported(DXGI_FORMAT_R8G8_UNORM));
}
```



### <a name="decoding-ycsubbsubcsubrsub-pixel-data"></a><span data-ttu-id="90cb3-245">Decodifica dei dati di YC<sub>b</sub>C<sub>r</sub> pixel</span><span class="sxs-lookup"><span data-stu-id="90cb3-245">Decoding YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>

<span data-ttu-id="90cb3-246">Se si desidera ottenere i dati di YC <sub>b</sub>C <sub>r</sub> pixel, è necessario chiamare [**IWICPlanarBitmapSourceTransform:: CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-copypixels).</span><span class="sxs-lookup"><span data-stu-id="90cb3-246">If you want to obtain YC <sub>b</sub>C <sub>r</sub> pixel data you should call [**IWICPlanarBitmapSourceTransform::CopyPixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapsourcetransform-copypixels).</span></span> <span data-ttu-id="90cb3-247">Questo metodo copia i dati pixel in una matrice di strutture [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) compilate, una per ogni piano di dati desiderato, ad esempio Y e c <sub>b</sub>c <sub>r</sub>.</span><span class="sxs-lookup"><span data-stu-id="90cb3-247">This method copies pixel data into an array of filled-out [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) structures, one for each plane of data you want (for example, Y and C<sub>b</sub>C<sub>r</sub>).</span></span> <span data-ttu-id="90cb3-248">Un **WICBitmapPlane** contiene informazioni sui dati pixel e punta al buffer di memoria che riceverà i dati.</span><span class="sxs-lookup"><span data-stu-id="90cb3-248">A **WICBitmapPlane** contains info about the pixel data and points to the memory buffer that will receive the data.</span></span>

<span data-ttu-id="90cb3-249">Se si desidera usare i dati di YC <sub>b</sub>c <sub>r</sub> pixel con altre API WIC, è necessario creare un [**IWICBitmap**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmap)configurato in modo appropriato, chiamare [**Lock**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmap-lock) per ottenere il buffer di memoria sottostante e associare il buffer al [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) usato per ricevere i dati YC <sub>b</sub>C <sub>r</sub> pixel.</span><span class="sxs-lookup"><span data-stu-id="90cb3-249">If you want to use the YC <sub>b</sub>C <sub>r</sub> pixel data with other WIC APIs you should create an appropriately configured [**IWICBitmap**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmap), call [**Lock**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmap-lock) to obtain the underlying memory buffer, and associate the buffer with the [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) used to receive the YC<sub>b</sub>C<sub>r</sub> pixel data.</span></span> <span data-ttu-id="90cb3-250">È quindi possibile usare [IWICBitmap](-wic-imp-iwicbitmapdecoder.md) in genere.</span><span class="sxs-lookup"><span data-stu-id="90cb3-250">You can then use the [IWICBitmap](-wic-imp-iwicbitmapdecoder.md) normally.</span></span>

<span data-ttu-id="90cb3-251">Infine, se si desidera eseguire il rendering dei dati YC <sub>b</sub>c <sub>r</sub> in Direct2D, è necessario creare un [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) da ogni [**IWICBitmap**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmap) e utilizzarli come origine per l'effetto immagine YC <sub>b</sub>c <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-251">Finally, if you want to render the YC <sub>b</sub>C <sub>r</sub> data in Direct2D, you should create an [**ID2D1Bitmap**](/windows/win32/api/d2d1/nn-d2d1-id2d1bitmap) from each [**IWICBitmap**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmap) and use them as source for the YC<sub>b</sub>C<sub>r</sub> image effect.</span></span> <span data-ttu-id="90cb3-252">WIC consente di richiedere più configurazioni planari.</span><span class="sxs-lookup"><span data-stu-id="90cb3-252">WIC allows you to request multiple planar configurations.</span></span> <span data-ttu-id="90cb3-253">Quando si interopera con Direct2D è necessario richiedere due piani, uno con GUID \_ WICPixelFormat8bppY e l'altro usando GUID \_ WICPixelFormat16bppCbCr, in quanto questa è la configurazione prevista da Direct2D.</span><span class="sxs-lookup"><span data-stu-id="90cb3-253">When interoperating with Direct2D you should request two planes, one using GUID\_WICPixelFormat8bppY and the other using GUID\_WICPixelFormat16bppCbCr, as this is the configuration expected by Direct2D.</span></span>

### <a name="code-sample"></a><span data-ttu-id="90cb3-254">Codice di esempio</span><span class="sxs-lookup"><span data-stu-id="90cb3-254">Code Sample</span></span>

<span data-ttu-id="90cb3-255">Di seguito è riportato un esempio di codice che illustra i passaggi per decodificare ed eseguire il rendering dei dati YC<sub>b</sub>C<sub>r</sub> in Direct2D.</span><span class="sxs-lookup"><span data-stu-id="90cb3-255">Below is a code example demonstrating the steps to decode and render YC<sub>b</sub>C<sub>r</sub> data in Direct2D.</span></span> <span data-ttu-id="90cb3-256">Questo esempio è stato ricavato dalle [ottimizzazioni JPEG YCbCr nell'esempio Direct2D e WIC](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample).</span><span class="sxs-lookup"><span data-stu-id="90cb3-256">This example was taken from the [JPEG YCbCr optimizations in Direct2D and WIC sample](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample).</span></span>


```C++
void DirectXSampleRenderer::CreateYCbCrDeviceResources()
{
    auto wicFactory = m_deviceResources->GetWicImagingFactory();
    auto d2dContext = m_deviceResources->GetD2DDeviceContext();

    ComPtr<IWICPlanarBitmapSourceTransform> wicPlanarSource;
    DX::ThrowIfFailed(
        m_wicScaler.As(&wicPlanarSource)
        );

    ComPtr<IWICBitmap> bitmaps[SampleConstants::NumPlanes];
    ComPtr<IWICBitmapLock> locks[SampleConstants::NumPlanes];
    WICBitmapPlane planes[SampleConstants::NumPlanes];

    for (uint32 i = 0; i < SampleConstants::NumPlanes; i++)
    {
        DX::ThrowIfFailed(
            wicFactory->CreateBitmap(
                m_planeDescriptions[i].Width,
                m_planeDescriptions[i].Height,
                m_planeDescriptions[i].Format,
                WICBitmapCacheOnLoad,
                &bitmaps[i]
                )
            );

        LockBitmap(bitmaps[i].Get(), WICBitmapLockWrite, nullptr, &locks[i], &planes[i]);
    }

    DX::ThrowIfFailed(
        wicPlanarSource->CopyPixels(
            nullptr, // Copy the entire source region.
            m_cachedBitmapPixelWidth,
            m_cachedBitmapPixelHeight,
            WICBitmapTransformRotate0,
            WICPlanarOptionsDefault,
            planes,
            SampleConstants::NumPlanes
            )
        );

    DX::ThrowIfFailed(d2dContext->CreateEffect(CLSID_D2D1YCbCr, &m_d2dYCbCrEffect));

    ComPtr<ID2D1Bitmap1> d2dBitmaps[SampleConstants::NumPlanes];
    for (uint32 i = 0; i < SampleConstants::NumPlanes; i++)
    {
        // IWICBitmapLock must be released before using the IWICBitmap.
        locks[i] = nullptr;

        // First ID2D1Bitmap1 is DXGI_FORMAT_R8 (Y), second is DXGI_FORMAT_R8G8 (CbCr).
        DX::ThrowIfFailed(d2dContext->CreateBitmapFromWicBitmap(bitmaps[i].Get(), &d2dBitmaps[i]));
        m_d2dYCbCrEffect->SetInput(i, d2dBitmaps[i].Get());
    }
}

void DirectXSampleRenderer::LockBitmap(
    _In_ IWICBitmap *pBitmap,
    DWORD bitmapLockFlags,
    _In_opt_ const WICRect *prcSource,
    _Outptr_ IWICBitmapLock **ppBitmapLock,
    _Out_ WICBitmapPlane *pPlane
    )
{
    // ComPtr guarantees the IWICBitmapLock is released if an exception is thrown.
    ComPtr<IWICBitmapLock> lock;
    DX::ThrowIfFailed(pBitmap->Lock(prcSource, bitmapLockFlags, &lock));
    DX::ThrowIfFailed(lock->GetStride(&pPlane->cbStride));
    DX::ThrowIfFailed(lock->GetDataPointer(&pPlane->cbBufferSize, &pPlane->pbBuffer));
    DX::ThrowIfFailed(lock->GetPixelFormat(&pPlane->Format));
    *ppBitmapLock = lock.Detach();
}
```



### <a name="transforming-ycsubbsubcsubrsub-pixel-data"></a><span data-ttu-id="90cb3-257">Trasformazione dei dati di YC<sub>b</sub>C<sub>r</sub> pixel</span><span class="sxs-lookup"><span data-stu-id="90cb3-257">Transforming YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>

<span data-ttu-id="90cb3-258">La trasformazione dei dati di YC <sub>b</sub>C <sub>r</sub> è quasi identica alla decodifica, perché entrambi coinvolgono [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform).</span><span class="sxs-lookup"><span data-stu-id="90cb3-258">Transforming YC <sub>b</sub>C <sub>r</sub> data is nearly identical to decoding, as both involve [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform).</span></span> <span data-ttu-id="90cb3-259">L'unica differenza è rappresentata dall'oggetto WIC da cui è stata ottenuta l'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="90cb3-259">The only difference is which WIC object you obtained the interface from.</span></span> <span data-ttu-id="90cb3-260">Il scaler fornito da Windows, Flip rotatorio and Color Transform All supporta YC<sub>b</sub>C<sub>r</sub> Access.</span><span class="sxs-lookup"><span data-stu-id="90cb3-260">The Windows provided scaler, flip rotator and color transform all support YC<sub>b</sub>C<sub>r</sub> access.</span></span>

### <a name="chaining-transforms-together"></a><span data-ttu-id="90cb3-261">Concatenamento di trasformazioni</span><span class="sxs-lookup"><span data-stu-id="90cb3-261">Chaining Transforms Together</span></span>

<span data-ttu-id="90cb3-262">WIC supporta la nozione di concatenamento di più trasformazioni.</span><span class="sxs-lookup"><span data-stu-id="90cb3-262">WIC supports the notion of chaining together multiple transforms.</span></span> <span data-ttu-id="90cb3-263">Ad esempio, è possibile creare la pipeline WIC seguente:</span><span class="sxs-lookup"><span data-stu-id="90cb3-263">For example, you can create the following WIC pipeline:</span></span>

![diagramma di una pipeline WIC che inizia con un decodificatore JPEG.](graphics/ycbcr5.png)

<span data-ttu-id="90cb3-265">È quindi possibile chiamare QueryInterface su [**IWICColorTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwiccolortransform) per ottenere [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform).</span><span class="sxs-lookup"><span data-stu-id="90cb3-265">You can then call QueryInterface on the [**IWICColorTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwiccolortransform) to obtain [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform).</span></span> <span data-ttu-id="90cb3-266">La trasformazione colore può comunicare con le trasformazioni precedenti e può esporre le funzionalità di aggregazione di ogni fase della pipeline.</span><span class="sxs-lookup"><span data-stu-id="90cb3-266">The color transform can communicate with the preceding transforms and can expose the aggregate capabilities of every stage in the pipeline.</span></span> <span data-ttu-id="90cb3-267">WIC garantisce che i dati YC<sub>b</sub>C<sub>r</sub> vengano conservati nell'intero processo.</span><span class="sxs-lookup"><span data-stu-id="90cb3-267">WIC ensures that the YC<sub>b</sub>C<sub>r</sub> data is preserved through the entire process.</span></span> <span data-ttu-id="90cb3-268">Questo concatenamento funziona solo quando si usano componenti che supportano l'accesso a YC<sub>b</sub>C<sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-268">This chaining only works when using components that support YC<sub>b</sub>C<sub>r</sub> access.</span></span>

### <a name="jpeg-codec-optimizations"></a><span data-ttu-id="90cb3-269">Ottimizzazioni del codec JPEG</span><span class="sxs-lookup"><span data-stu-id="90cb3-269">JPEG Codec Optimizations</span></span>

<span data-ttu-id="90cb3-270">Analogamente all'implementazione di decodifica del frame JPEG di [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform), l'implementazione di decodifica del frame JPEG di [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform) supporta la scalabilità e la rotazione del dominio DCT JPEG nativo.</span><span class="sxs-lookup"><span data-stu-id="90cb3-270">Similar to the JPEG frame decode implementation of [**IWICBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsourcetransform), the JPEG frame decode implementation of [**IWICPlanarBitmapSourceTransform**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapsourcetransform) supports native JPEG DCT domain scaling and rotation.</span></span> <span data-ttu-id="90cb3-271">È possibile richiedere una potenza di due downscaling o una rotazione direttamente dal decodificatore JPEG.</span><span class="sxs-lookup"><span data-stu-id="90cb3-271">You can request a power of two downscale or a rotation directly from the JPEG decoder.</span></span> <span data-ttu-id="90cb3-272">Ciò comporta in genere una maggiore qualità e prestazioni rispetto all'uso delle trasformazioni discrete.</span><span class="sxs-lookup"><span data-stu-id="90cb3-272">This typically results in higher quality and performance than using the discrete transforms.</span></span>

<span data-ttu-id="90cb3-273">Inoltre, quando si concatenano una o più trasformazioni WIC dopo il decodificatore JPEG, è possibile sfruttare la scala e la rotazione JPEG native per soddisfare l'operazione di aggregazione richiesta.</span><span class="sxs-lookup"><span data-stu-id="90cb3-273">In addition, when you chain one or more WIC transforms after the JPEG decoder, it can leverage native JPEG scaling and rotation to satisfy the aggregate requested operation.</span></span>

### <a name="format-conversions"></a><span data-ttu-id="90cb3-274">Conversioni di formato</span><span class="sxs-lookup"><span data-stu-id="90cb3-274">Format Conversions</span></span>

<span data-ttu-id="90cb3-275">Usare [**IWICPlanarFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarformatconverter) per convertire i dati Planar YC <sub>b</sub>C <sub>r</sub> pixel in un formato pixel Interleaved, ad esempio GUID \_ WICPixelFormat32bppPBGRA.</span><span class="sxs-lookup"><span data-stu-id="90cb3-275">Use [**IWICPlanarFormatConverter**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarformatconverter) to convert planar YC<sub>b</sub>C<sub>r</sub> pixel data to an interleaved pixel format such as GUID\_WICPixelFormat32bppPBGRA.</span></span> <span data-ttu-id="90cb3-276">WIC in Windows 8.1 non offre la possibilità di eseguire la conversione in un formato planare YC<sub>b</sub>C<sub>r</sub> pixel.</span><span class="sxs-lookup"><span data-stu-id="90cb3-276">WIC in Windows 8.1 does not provide the ability to convert to a planar YC<sub>b</sub>C<sub>r</sub> pixel format.</span></span>

### <a name="encoding-ycsubbsubcsubrsub-pixel-data"></a><span data-ttu-id="90cb3-277">Codifica dei dati dei pixel di YC<sub>b</sub>C<sub>r</sub></span><span class="sxs-lookup"><span data-stu-id="90cb3-277">Encoding YC<sub>b</sub>C<sub>r</sub> Pixel Data</span></span>

<span data-ttu-id="90cb3-278">Usare [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode) per codificare i dati di YC <sub>b</sub>C <sub>r</sub> pixel nel codificatore JPEG.</span><span class="sxs-lookup"><span data-stu-id="90cb3-278">Use [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode) to encode YC<sub>b</sub>C<sub>r</sub> pixel data to the JPEG encoder.</span></span> <span data-ttu-id="90cb3-279">La codifica YC <sub>b</sub>C <sub>r</sub> data **IWICPlanarBitmapFrameEncode** è simile, ma non identica, per la codifica di dati con interfoliazione con [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span><span class="sxs-lookup"><span data-stu-id="90cb3-279">Encoding YC <sub>b</sub>C <sub>r</sub> data **IWICPlanarBitmapFrameEncode** is similar but not identical to encoding interleaved data using [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode).</span></span> <span data-ttu-id="90cb3-280">L'interfaccia planare espone solo la possibilità di scrivere dati di immagini di frame planari ed è necessario continuare a usare l'interfaccia di codifica dei frame per impostare i metadati o un'anteprima e per eseguire il commit al termine dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="90cb3-280">The planar interface only exposes the ability to write planar frame image data, and you should continue to use the frame encode interface to set metadata or a thumbnail and to commit at the end of the operation.</span></span>

<span data-ttu-id="90cb3-281">Per il caso tipico, attenersi alla procedura seguente:</span><span class="sxs-lookup"><span data-stu-id="90cb3-281">For the typical case, you should follow these steps:</span></span>

1.  <span data-ttu-id="90cb3-282">Ottenere il [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) come di consueto.</span><span class="sxs-lookup"><span data-stu-id="90cb3-282">Obtain the [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) as normal.</span></span> <span data-ttu-id="90cb3-283">Se si vuole configurare il campionamento secondario Chroma, impostare l'opzione del codificatore [**JpegYCrCbSubsampling**](/windows/desktop/api/Wincodec/ne-wincodec-wicjpegycrcbsubsamplingoption) durante la creazione del frame.</span><span class="sxs-lookup"><span data-stu-id="90cb3-283">If you want to configure chroma subsampling, set the [**JpegYCrCbSubsampling**](/windows/desktop/api/Wincodec/ne-wincodec-wicjpegycrcbsubsamplingoption) encoder option when creating the frame.</span></span>
2.  <span data-ttu-id="90cb3-284">Se è necessario impostare metadati o un'anteprima, usare [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) come di consueto.</span><span class="sxs-lookup"><span data-stu-id="90cb3-284">If you need to set metadata or a thumbnail, do this using [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) as normal.</span></span>
3.  <span data-ttu-id="90cb3-285">QueryInterface per [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode).</span><span class="sxs-lookup"><span data-stu-id="90cb3-285">QueryInterface for the [**IWICPlanarBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicplanarbitmapframeencode).</span></span>
4.  <span data-ttu-id="90cb3-286">Impostare i dati di YC <sub>b</sub>C <sub>r</sub> pixel usando [**IWICPlanarBitmapFrameEncode:: WriteSource**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapframeencode-writesource) o [**IWICPlanarBitmapFrameEncode:: WritePixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapframeencode-writepixels).</span><span class="sxs-lookup"><span data-stu-id="90cb3-286">Set the YC <sub>b</sub>C <sub>r</sub> pixel data using [**IWICPlanarBitmapFrameEncode::WriteSource**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapframeencode-writesource) or [**IWICPlanarBitmapFrameEncode::WritePixels**](/windows/desktop/api/Wincodec/nf-wincodec-iwicplanarbitmapframeencode-writepixels).</span></span> <span data-ttu-id="90cb3-287">A differenza delle rispettive controparti [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) , è possibile fornire questi metodi con una matrice di [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) o [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) che contengono i piani di YC <sub>b</sub>C <sub>r</sub> pixel.</span><span class="sxs-lookup"><span data-stu-id="90cb3-287">Unlike with their [**IWICBitmapFrameEncode**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapframeencode) counterparts, you provide these methods with an array of [**IWICBitmapSource**](/windows/desktop/api/Wincodec/nn-wincodec-iwicbitmapsource) or [**WICBitmapPlane**](/windows/desktop/api/Wincodec/ns-wincodec-wicbitmapplane) which contain the YC<sub>b</sub>C<sub>r</sub> pixel planes.</span></span>
5.  <span data-ttu-id="90cb3-288">Al termine, chiamare [**IWICBitmapFrameEncode:: commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapframeencode-commit).</span><span class="sxs-lookup"><span data-stu-id="90cb3-288">When you are finished, call [**IWICBitmapFrameEncode::Commit**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapframeencode-commit).</span></span>

### <a name="decoding-ycsubbsubcsubrsub-pixel-data-in-windows-10"></a><span data-ttu-id="90cb3-289">Decodifica dei dati di YC<sub>b</sub>C<sub>r</sub> pixel in Windows 10</span><span class="sxs-lookup"><span data-stu-id="90cb3-289">Decoding YC<sub>b</sub>C<sub>r</sub> pixel data in Windows 10</span></span>

<span data-ttu-id="90cb3-290">A partire da Windows 10 Build 1507, Direct2D fornisce [**ID2D1ImageSourceFromWic**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesourcefromwic), un modo più semplice per decodificare i file JPEG in Direct2D sfruttando al tempo stesso le ottimizzazioni YC <sub>b</sub>C <sub>r</sub> .</span><span class="sxs-lookup"><span data-stu-id="90cb3-290">Starting in Windows 10 build 1507, Direct2D provides [**ID2D1ImageSourceFromWic**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesourcefromwic), a simpler way to decode JPEGs into Direct2D while leveraging YC<sub>b</sub>C<sub>r</sub> optimizations.</span></span> <span data-ttu-id="90cb3-291">**ID2D1ImageSourceFromWic** esegue automaticamente tutte le necessarie verifiche della funzionalità YC <sub>b</sub>C <sub>r</sub> . Usa il percorso di codeoptimize ottimizzato quando possibile e usa un fallback in caso contrario.</span><span class="sxs-lookup"><span data-stu-id="90cb3-291">**ID2D1ImageSourceFromWic** automatically performs all of the necessary YC<sub>b</sub>C<sub>r</sub> capability checks for you; it uses the optimized codepath when possible, and uses a fallback otherwise.</span></span> <span data-ttu-id="90cb3-292">Consente inoltre nuove ottimizzazioni, ad esempio la memorizzazione nella cache delle sottoaree dell'immagine necessarie alla volta.</span><span class="sxs-lookup"><span data-stu-id="90cb3-292">It also enables new optimizations such as only caching subregions of the image that are needed at a time.</span></span>

<span data-ttu-id="90cb3-293">Per altre informazioni sull'uso di [**ID2D1ImageSourceFromWic**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesourcefromwic), vedere l' [esempio](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/D2DPhotoAdjustment)dell'SDK per la regolazione della foto Direct2D.</span><span class="sxs-lookup"><span data-stu-id="90cb3-293">For more information about using [**ID2D1ImageSourceFromWic**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesourcefromwic), refer to the Direct2D Photo Adjustment SDK [sample](https://github.com/Microsoft/Windows-universal-samples/tree/master/Samples/D2DPhotoAdjustment).</span></span>

## <a name="related-topics"></a><span data-ttu-id="90cb3-294">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="90cb3-294">Related topics</span></span>

* [<span data-ttu-id="90cb3-295">Ottimizzazioni di YCbCr JPEG nell'esempio Direct2D e WIC</span><span class="sxs-lookup"><span data-stu-id="90cb3-295">JPEG YCbCr optimizations in Direct2D and WIC sample</span></span>](https://github.com/microsoftarchive/msdn-code-gallery-microsoft/tree/master/Official%20Windows%20Platform%20Sample/JPEG%20YCbCr%20optimizations%20in%20Direct2D%20and%20WIC%20sample)
