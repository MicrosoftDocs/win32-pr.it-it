---
description: Altre informazioni su come funziona il componente Windows Imaging
ms.assetid: c233e25b-bec6-4e67-8fbf-2bf9b70c7522
title: Funzionamento del componente Windows Imaging
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9bc9fe31ae4346f2c2d1f0b273e78ed10a0ec7e6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "103757835"
---
# <a name="how-the-windows-imaging-component-works"></a><span data-ttu-id="33612-103">Funzionamento del componente Windows Imaging</span><span class="sxs-lookup"><span data-stu-id="33612-103">How the Windows Imaging Component Works</span></span>

<span data-ttu-id="33612-104">In questo argomento sono incluse le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="33612-104">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="33612-105">Individuazione e arbitraggio</span><span class="sxs-lookup"><span data-stu-id="33612-105">Discovery and Arbitration</span></span>](#discovery-and-arbitration)
-   [<span data-ttu-id="33612-106">Decodifica</span><span class="sxs-lookup"><span data-stu-id="33612-106">Decoding</span></span>](#decoding)
-   [<span data-ttu-id="33612-107">Encoding</span><span class="sxs-lookup"><span data-stu-id="33612-107">Encoding</span></span>](#encoding)
-   [<span data-ttu-id="33612-108">Durata di un codec</span><span class="sxs-lookup"><span data-stu-id="33612-108">The Lifetime of a Codec</span></span>](#the-lifetime-of-a-codec)
-   [<span data-ttu-id="33612-109">Come abilitare con WIC un codec</span><span class="sxs-lookup"><span data-stu-id="33612-109">How to WIC-enabled a Codec</span></span>](#how-to-wic-enabled-a-codec)
-   [<span data-ttu-id="33612-110">Supporto di Apartment multithread in WIC</span><span class="sxs-lookup"><span data-stu-id="33612-110">Multi-Threaded Apartment Support in WIC</span></span>](#multi-threaded-apartment-support-in-wic)
-   [<span data-ttu-id="33612-111">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="33612-111">Related topics</span></span>](#related-topics)

## <a name="discovery-and-arbitration"></a><span data-ttu-id="33612-112">Individuazione e arbitraggio</span><span class="sxs-lookup"><span data-stu-id="33612-112">Discovery and Arbitration</span></span>

<span data-ttu-id="33612-113">Prima di poter decodificare un'immagine, è necessario trovare un codec appropriato in grado di decodificare il formato di immagine.</span><span class="sxs-lookup"><span data-stu-id="33612-113">Before an image can be decoded, an appropriate codec must be found that can decode that image format.</span></span> <span data-ttu-id="33612-114">Nella maggior parte dei sistemi, poiché i formati di immagine supportati sono hardcoded, non è necessario alcun processo di individuazione.</span><span class="sxs-lookup"><span data-stu-id="33612-114">In most systems, because the supported image formats are hard-coded, no discovery process is required.</span></span> <span data-ttu-id="33612-115">Poiché la piattaforma Windows Imaging Component (WIC) è estendibile, è necessario essere in grado di identificare il formato di un'immagine e di associarla a un codec appropriato.</span><span class="sxs-lookup"><span data-stu-id="33612-115">Because the Windows Imaging Component (WIC) platform is extensible, it’s necessary to be able to identify the format of an image and match it with an appropriate codec.</span></span>

<span data-ttu-id="33612-116">Per supportare l'individuazione in fase di esecuzione, ogni formato di immagine deve avere un modello di identificazione che può essere usato per identificare il decodificatore appropriato per tale formato.</span><span class="sxs-lookup"><span data-stu-id="33612-116">To support run-time discovery, each image format must have an identifying pattern that can be used to identify the appropriate decoder for that format.</span></span> <span data-ttu-id="33612-117">Per i nuovi formati di file si consiglia di usare un GUID per il modello di identificazione, perché è garantito che sia univoco. Il modello di identificazione deve essere incorporato in ogni file di immagine conforme al formato di immagine.</span><span class="sxs-lookup"><span data-stu-id="33612-117">(It is strongly recommended that, for new file formats, you use a GUID for the identifying pattern, because it is guaranteed to be unique.) The identifying pattern must be embedded in each image file that conforms to that image format.</span></span> <span data-ttu-id="33612-118">Ogni decodificatore include una voce del registro di sistema che specifica il modello di identificazione o i modelli dei formati di immagine che può decodificare.</span><span class="sxs-lookup"><span data-stu-id="33612-118">Each decoder has a registry entry that specifies the identifying pattern or patterns of the image formats it can decode.</span></span> <span data-ttu-id="33612-119">Quando un'applicazione deve aprire un'immagine, richiede un decodificatore da WIC.</span><span class="sxs-lookup"><span data-stu-id="33612-119">When an application needs to open an image, it requests a decoder from WIC.</span></span> <span data-ttu-id="33612-120">WIC Cerca i decodificatori disponibili nel registro di sistema e controlla ogni voce del registro di sistema per individuare un modello di identificazione corrispondente al modello incorporato nel file di immagine.</span><span class="sxs-lookup"><span data-stu-id="33612-120">WIC looks up the available decoders in the registry, and checks each registry entry for an identifying pattern that matches the pattern embedded in the image file.</span></span> <span data-ttu-id="33612-121">Per altre informazioni sulle voci del registro di sistema decoder, vedere [voci del registro di sistema specifiche del codificatore](-wic-decoderregentries.md)</span><span class="sxs-lookup"><span data-stu-id="33612-121">For more information on decoder registry entries, see [Encoder-Specific Registry Entries](-wic-decoderregentries.md)</span></span>

<span data-ttu-id="33612-122">Quando WIC trova un singolo decodificatore che corrisponde al modello di identificazione nell'immagine, crea un'istanza del decodificatore e lo passa al file di immagine.</span><span class="sxs-lookup"><span data-stu-id="33612-122">When WIC finds a single decoder that matches the identifying pattern in the image, it creates an instance of the decoder and passes the image file to it.</span></span> <span data-ttu-id="33612-123">Se WIC trova più di una corrispondenza, richiama un metodo denominato [**QueryCapability**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-querycapability) in ogni decodificatore corrispondente per eseguire l'arbitrario tra di essi e trovare la migliore corrispondenza.</span><span class="sxs-lookup"><span data-stu-id="33612-123">If WIC finds more than one match, it invokes a method called [**QueryCapability**](/windows/desktop/api/Wincodec/nf-wincodec-iwicbitmapdecoder-querycapability) on each matching decoder to arbitrate among them and find the best match.</span></span> <span data-ttu-id="33612-124">Per ulteriori informazioni, vedere la sezione [QueryCapabilities](-wic-imp-iwicbitmapdecoder.md) nell' [implementazione di IWICBitmapDecoder](-wic-imp-iwicbitmapdecoder.md).</span><span class="sxs-lookup"><span data-stu-id="33612-124">For more information, see the [QueryCapabilities](-wic-imp-iwicbitmapdecoder.md) section in the [Implementing IWICBitmapDecoder](-wic-imp-iwicbitmapdecoder.md).</span></span>

## <a name="decoding"></a><span data-ttu-id="33612-125">Decodifica</span><span class="sxs-lookup"><span data-stu-id="33612-125">Decoding</span></span>

<span data-ttu-id="33612-126">Dopo che il decodificatore appropriato è stato selezionato e ne è stata creata un'istanza, l'applicazione comunica direttamente con il decodificatore.</span><span class="sxs-lookup"><span data-stu-id="33612-126">After the appropriate decoder has been selected and instantiated, the application talks directly to the decoder.</span></span> <span data-ttu-id="33612-127">Il decodificatore ha diverse responsabilità, implementate tramite varie interfacce.</span><span class="sxs-lookup"><span data-stu-id="33612-127">The decoder has several responsibilities, which it implements through various interfaces.</span></span> <span data-ttu-id="33612-128">Questi servizi possono essere classificati come:</span><span class="sxs-lookup"><span data-stu-id="33612-128">These services can be classified as:</span></span>

-   <span data-ttu-id="33612-129">Servizi a livello di contenitore</span><span class="sxs-lookup"><span data-stu-id="33612-129">Container-level services</span></span>
-   <span data-ttu-id="33612-130">Servizi a livello di frame</span><span class="sxs-lookup"><span data-stu-id="33612-130">Frame-level services</span></span>
-   <span data-ttu-id="33612-131">Servizi di enumerazione dei metadati</span><span class="sxs-lookup"><span data-stu-id="33612-131">Metadata enumeration services</span></span>
-   <span data-ttu-id="33612-132">Trasformazioni del decodificatore Native</span><span class="sxs-lookup"><span data-stu-id="33612-132">Native decoder transforms</span></span>
-   <span data-ttu-id="33612-133">Notifiche sullo stato di avanzamento e supporto per l'annullamento</span><span class="sxs-lookup"><span data-stu-id="33612-133">Progress notifications and cancellation support</span></span>
-   <span data-ttu-id="33612-134">Servizi di elaborazione non elaborati</span><span class="sxs-lookup"><span data-stu-id="33612-134">Raw processing services</span></span>

<span data-ttu-id="33612-135">I servizi a livello di contenitore includono il recupero dell'anteprima di primo livello (se supportata), l'anteprima, i contesti dei colori, la tavolozza (se applicabile) e il formato del contenitore, oltre a fornire l'accesso ai singoli fotogrammi dell'immagine all'interno del contenitore.</span><span class="sxs-lookup"><span data-stu-id="33612-135">Container-level services include retrieving the top-level thumbnail (if supported), preview, color contexts, palette (if applicable), and container format, as well as providing access to the individual image frames within the container.</span></span> <span data-ttu-id="33612-136">Alcuni contenitori contengono solo un singolo frame, mentre altri, ad esempio Tagged Image File Format (TIFF), possono contenere più frame. Questo set di servizi include anche informazioni sul decodificatore stesso e sulle relative funzionalità rispetto a un file di immagine specifico.</span><span class="sxs-lookup"><span data-stu-id="33612-136">(Some containers contain only a single frame while others, such as Tagged Image File Format (TIFF), can contain multiple frames.) This set of services also includes providing information about the decoder itself, and its capabilities with respect to a specific image file.</span></span>

<span data-ttu-id="33612-137">I singoli frame hanno anteprime specifiche e possono avere anche contesti di colore, tavolozze e altre proprietà esposte a livello di frame.</span><span class="sxs-lookup"><span data-stu-id="33612-137">Individual frames have their own thumbnails, and may also have their own color contexts, palettes, and other properties, which are exposed at the frame level.</span></span> <span data-ttu-id="33612-138">L'operazione più importante eseguita a livello di frame, tuttavia, è la decodifica effettiva dei bit dell'immagine per quel frame.</span><span class="sxs-lookup"><span data-stu-id="33612-138">The most important operation performed at the frame level, though, is the actual decoding of the image bits for that frame.</span></span>

<span data-ttu-id="33612-139">WIC fornisce lettori di metadati per i formati di metadati più comuni (IFD, EXIF, IPTC, XMP, APP0, APP1 e altri formati) e supporta anche l'estendibilità per i formati di metadati di terze parti.</span><span class="sxs-lookup"><span data-stu-id="33612-139">WIC provides metadata readers for the most common metadata formats (IFD, EXIF, IPTC, XMP, APP0, APP1, and other formats), and also supports extensibility for third-party metadata formats.</span></span> <span data-ttu-id="33612-140">Questo consente di liberare il codec di responsabilità dell'analisi dei metadati.</span><span class="sxs-lookup"><span data-stu-id="33612-140">This frees the codec of the responsibility for parsing metadata.</span></span> <span data-ttu-id="33612-141">Tuttavia, il codec è responsabile dell'enumerazione dei blocchi di metadati e della richiesta di un lettore di metadati per ogni blocco.</span><span class="sxs-lookup"><span data-stu-id="33612-141">However, the codec is responsible for enumerating the metadata blocks and requesting a metadata reader for each block.</span></span> <span data-ttu-id="33612-142">WIC esegue l'individuazione per i gestori di metadati nello stesso modo in cui avviene per i codec, in base a un modello nell'intestazione del blocco corrispondente a un modello nella voce del registro di sistema del gestore dei metadati.</span><span class="sxs-lookup"><span data-stu-id="33612-142">WIC performs discovery for metadata handlers the same way it does for codecs, based on a pattern in the block header matching a pattern in the metadata handler’s registry entry.</span></span> <span data-ttu-id="33612-143">Per ulteriori informazioni, vedere le [voci del registro di sistema specifiche del codificatore](-wic-decoderregentries.md)</span><span class="sxs-lookup"><span data-stu-id="33612-143">For more information, see the [Encoder-Specific Registry Entries](-wic-decoderregentries.md)</span></span>

<span data-ttu-id="33612-144">I decodificatori non sono obbligatori a supportare in modo nativo le operazioni di trasformazione, ma in questo modo vengono abilitate ottimizzazioni delle prestazioni significative che offrono una migliore esperienza dell'utente finale.</span><span class="sxs-lookup"><span data-stu-id="33612-144">Decoders are not required to natively support transform operations, but doing so enables significant performance optimizations that provide a better end-user experience.</span></span> <span data-ttu-id="33612-145">Un'applicazione, ad esempio, può creare una pipeline di varie trasformazioni (ridimensionamento, ritaglio, rotazione e conversione del formato pixel) da eseguire su un'immagine prima che venga eseguito il rendering dell'immagine.</span><span class="sxs-lookup"><span data-stu-id="33612-145">For example, an application can create a pipeline of various transforms (scaling, cropping, rotation, and pixel format conversion) to perform on an image before the image is rendered.</span></span> <span data-ttu-id="33612-146">Per ulteriori informazioni sulle pipeline di trasformazione, vedere [IWICBitmapSource](-wic-imp-iwicbitmapsource.md).</span><span class="sxs-lookup"><span data-stu-id="33612-146">For more information on transform pipelines, see [IWICBitmapSource](-wic-imp-iwicbitmapsource.md).</span></span> <span data-ttu-id="33612-147">Dopo la creazione di una pipeline di trasformazione, l'applicazione richiede la trasformazione finale nella pipeline per produrre la bitmap risultante dall'applicazione di tutte le trasformazioni all'origine dell'immagine.</span><span class="sxs-lookup"><span data-stu-id="33612-147">After creating a transform pipeline, the application requests the final transform in the pipeline to produce the bitmap that results from applying all the transforms to the image source.</span></span> <span data-ttu-id="33612-148">A questo punto, se il decodificatore stesso è in grado di eseguire operazioni di trasformazione, WIC chiede quale delle trasformazioni richieste è in grado di eseguire.</span><span class="sxs-lookup"><span data-stu-id="33612-148">At that point, if the decoder itself is able to perform transform operations, WIC asks which of the requested transforms it can perform.</span></span> <span data-ttu-id="33612-149">Tutte le trasformazioni richieste che non possono essere eseguite dal decodificatore verranno eseguite da WIC sull'immagine decodificata prima di restituirla al chiamante.</span><span class="sxs-lookup"><span data-stu-id="33612-149">Any requested transforms the decoder cannot perform will be performed by WIC on the decoded image before returning it to the caller.</span></span> <span data-ttu-id="33612-150">Questa pipeline di trasformazione ottimizzata offre prestazioni migliori rispetto all'esecuzione sequenziale di ogni trasformazione in memoria, in particolare quando è possibile eseguire alcune o tutte le trasformazioni durante il processo di decodifica.</span><span class="sxs-lookup"><span data-stu-id="33612-150">This optimized transform pipeline provides better performance than performing each transform sequentially in memory, particularly when some or all of the transforms can be accomplished during the decoding process.</span></span>

<span data-ttu-id="33612-151">Le notifiche di stato e il supporto per l'annullamento consentono a un'applicazione di richiedere notifiche sullo stato di avanzamento per operazioni di lunga durata e di consentire all'applicazione di fornire all'utente la possibilità di annullare un'operazione che richiede troppo tempo.</span><span class="sxs-lookup"><span data-stu-id="33612-151">Progress notifications and cancellation support enable an application to request progress notifications for lengthy operations, and also enable the application to give the user an opportunity to cancel an operation that is taking too long.</span></span> <span data-ttu-id="33612-152">Questo è importante perché se un utente non è in grado di annullare un'operazione, potrebbe sentire che il processo è bloccato e provare a annullarlo chiudendo l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="33612-152">This is important because if a user cannot cancel an operation, he or she may feel the process has hung, and try to cancel it by closing the application.</span></span>

<span data-ttu-id="33612-153">Queste interfacce sono descritte in dettaglio nella sezione relativa all' [implementazione di un Decodificatore WIC-Enabled](-wic-implementingwicdecoder.md).</span><span class="sxs-lookup"><span data-stu-id="33612-153">These interfaces are described in detail in the section on [Implementing a WIC-Enabled Decoder](-wic-implementingwicdecoder.md).</span></span>

<span data-ttu-id="33612-154">I servizi di elaborazione RAW includono la regolazione delle impostazioni della fotocamera, ad esempio l'esposizione, il contrasto e l'affilatura o la modifica dello spazio colore prima di elaborare i bit non elaborati.</span><span class="sxs-lookup"><span data-stu-id="33612-154">Raw processing services include adjusting camera settings, such as exposure, contrast, and sharpening, or changing the color space before processing the raw bits.</span></span>

## <a name="encoding"></a><span data-ttu-id="33612-155">Codifica</span><span class="sxs-lookup"><span data-stu-id="33612-155">Encoding</span></span>

<span data-ttu-id="33612-156">Come i decodificatori, i codificatori hanno responsabilità che implementano attraverso le interfacce.</span><span class="sxs-lookup"><span data-stu-id="33612-156">Like decoders, encoders have responsibilities that they implement through interfaces.</span></span> <span data-ttu-id="33612-157">I servizi forniti dai codificatori sono complementari ai servizi forniti dai decodificatori, con la differenza che scrivono i dati dell'immagine anziché leggerli.</span><span class="sxs-lookup"><span data-stu-id="33612-157">The services that encoders provide are complementary to the services provided by decoders, except they write out image data rather than reading it.</span></span> <span data-ttu-id="33612-158">I codificatori forniscono anche servizi nelle categorie seguenti:</span><span class="sxs-lookup"><span data-stu-id="33612-158">Encoders also provide services in the following categories:</span></span>

-   <span data-ttu-id="33612-159">Servizi a livello di contenitore</span><span class="sxs-lookup"><span data-stu-id="33612-159">Container-level services</span></span>
-   <span data-ttu-id="33612-160">Servizi a livello di frame</span><span class="sxs-lookup"><span data-stu-id="33612-160">Frame-level services</span></span>
-   <span data-ttu-id="33612-161">Enumerazione dei metadati e servizi di aggiornamento</span><span class="sxs-lookup"><span data-stu-id="33612-161">Metadata enumeration and update services</span></span>
-   <span data-ttu-id="33612-162">Supporto per notifiche di stato e annullamento</span><span class="sxs-lookup"><span data-stu-id="33612-162">Progress notification and cancellation support</span></span>

<span data-ttu-id="33612-163">I servizi a livello di contenitore per un codificatore includono l'impostazione dell'anteprima di primo livello (se supportata), l'anteprima e la tavolozza (se applicabile) e l'iterazione nei singoli frame dell'immagine in modo che possano essere serializzati nel contenitore.</span><span class="sxs-lookup"><span data-stu-id="33612-163">Container-level services for an encoder include setting the top-level thumbnail (if supported), preview, and palette (if applicable), and iterating through the individual image frames so they can be serialized into the container.</span></span>

<span data-ttu-id="33612-164">I servizi a livello di frame per un codificatore eseguono il mirroring di quelli per il decodificatore, ad eccezione del fatto che scrivono i dati dell'immagine, l'anteprima e qualsiasi tavolozza associato o altro componente, anziché leggerli.</span><span class="sxs-lookup"><span data-stu-id="33612-164">Frame-level services for an encoder mirror those for the decoder, except that they write out the image data, thumbnail, and any associated palette or other component, rather than reading them.</span></span>

<span data-ttu-id="33612-165">Inoltre, i servizi di enumerazione dei metadati per un codificatore includono l'iterazione dei blocchi di metadati da scrivere e il richiamo dei writer di metadati appropriati per serializzare i metadati su disco.</span><span class="sxs-lookup"><span data-stu-id="33612-165">Also, metadata enumeration services for an encoder include iterating through the metadata blocks to be written, and invoking the appropriate metadata writers to serialize the metadata to disk.</span></span>

<span data-ttu-id="33612-166">Queste interfacce sono descritte in dettaglio nella sezione relativa all' [implementazione di un codificatore WIC-Enabled](-wic-implementingwicencoder.md).</span><span class="sxs-lookup"><span data-stu-id="33612-166">These interfaces are described in detail in the section on [Implementing a WIC-Enabled Encoder](-wic-implementingwicencoder.md).</span></span>

## <a name="the-lifetime-of-a-codec"></a><span data-ttu-id="33612-167">Durata di un codec</span><span class="sxs-lookup"><span data-stu-id="33612-167">The Lifetime of a Codec</span></span>

<span data-ttu-id="33612-168">Viene creata un'istanza di un codec WIC per gestire una singola immagine e in genere è presente una durata breve.</span><span class="sxs-lookup"><span data-stu-id="33612-168">A WIC codec is instantiated to handle a single image, and usually has a short lifetime.</span></span> <span data-ttu-id="33612-169">Viene creato quando viene caricata un'immagine e viene rilasciata quando l'immagine viene chiusa.</span><span class="sxs-lookup"><span data-stu-id="33612-169">It’s created when an image is loaded and is released when the image is closed.</span></span> <span data-ttu-id="33612-170">Un'applicazione può usare un numero elevato di codec contemporaneamente a una durata sovrapposta (si può pensare di scorrere una directory contenente centinaia di immagini) e più applicazioni possono eseguire questa operazione nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="33612-170">An application may use a large number of codecs simultaneously with overlapping lifetimes (think of scrolling through a directory containing hundreds of images), and multiple applications may be doing this at the same time.</span></span>

<span data-ttu-id="33612-171">Anche se alcuni codec hanno una durata che ha come ambito la durata del processo in cui si trovano, questo non avviene con i codec WIC.</span><span class="sxs-lookup"><span data-stu-id="33612-171">Although some codecs have a lifetime that is scoped to the lifetime of the process in which they live, this is not the case with WIC codecs.</span></span> <span data-ttu-id="33612-172">Raccolta foto di Windows Vista, Esplora risorse e Visualizzatore foto, nonché numerose altre applicazioni, sono basate su WIC e utilizzeranno il codec per visualizzare immagini e anteprime.</span><span class="sxs-lookup"><span data-stu-id="33612-172">The Windows Vista Photo Gallery, Windows Explorer, and Photo Viewer, as well as numerous other applications, are built on WIC and will be using your codec to display images and thumbnails.</span></span> <span data-ttu-id="33612-173">Se la durata del codec è stata assegnata all'ambito della durata del processo, ogni volta che un'immagine o un'anteprima è stata visualizzata in Esplora risorse di Windows Vista, il codec di cui è stata creata un'istanza per decodificare l'immagine rimarrà in memoria fino al successivo riavvio del computer da parte dell'utente.</span><span class="sxs-lookup"><span data-stu-id="33612-173">If the lifetime of your codec were scoped to the lifetime of the process, every time an image or thumbnail was displayed in the Windows Vista Explorer, the codec instantiated to decode that image would remain in memory until the next time the user restarted his or her computer.</span></span> <span data-ttu-id="33612-174">Se il codec non viene mai scaricato, le relative risorse sono in effetti "perse" perché non possono essere usate da altri componenti nel sistema.</span><span class="sxs-lookup"><span data-stu-id="33612-174">If your codec is never unloaded, its resources are, in effect, "leaked" because they can't be used by any other component in the system.</span></span>

## <a name="how-to-wic-enabled-a-codec"></a><span data-ttu-id="33612-175">Come abilitare con WIC un codec</span><span class="sxs-lookup"><span data-stu-id="33612-175">How to WIC-enabled a Codec</span></span>

1.  <span data-ttu-id="33612-176">Implementare una classe decoder a livello di contenitore e una classe decodificatore a livello di frame che espone le interfacce WIC necessarie per la decodifica delle immagini e l'iterazione nei blocchi di metadati.</span><span class="sxs-lookup"><span data-stu-id="33612-176">Implement a container-level decoder class and a frame-level decoder class that exposes the required WIC interfaces for decoding images and iterating through blocks of metadata.</span></span> <span data-ttu-id="33612-177">Ciò consente a tutte le applicazioni basate su WIC di interagire con il codec nello stesso modo in cui interagiscono con i formati di immagine standard.</span><span class="sxs-lookup"><span data-stu-id="33612-177">This enables all WIC-based applications to interact with your codec the same way they interact with standard image formats.</span></span>
2.  <span data-ttu-id="33612-178">Implementare una classe del codificatore a livello di contenitore e una classe del codificatore a livello di frame che espone le interfacce WIC necessarie per la codifica di immagini e la serializzazione di blocchi di metadati in un file di immagine.</span><span class="sxs-lookup"><span data-stu-id="33612-178">Implement a container-level encoder class and a frame-level encoder class that exposes the required WIC interfaces for encoding images and serializing blocks of metadata into an image file.</span></span>
3.  <span data-ttu-id="33612-179">Se il formato del contenitore non è basato su un contenitore TIFF o JPEG, potrebbe essere necessario scrivere gestori di metadati per i formati di metadati comuni (EXIF, XMP).</span><span class="sxs-lookup"><span data-stu-id="33612-179">If your container format is not based on a TIFF or JPEG container, you may need to write metadata handlers for the common metadata formats (EXIF, XMP).</span></span> <span data-ttu-id="33612-180">Tuttavia, se si usa un formato di contenitore basato su TIFF o JPEG, questa operazione non è necessaria perché è possibile delegare ai gestori di metadati forniti dal sistema.</span><span class="sxs-lookup"><span data-stu-id="33612-180">However, if you use a TIFF-based or JPEG-based container format, this is not necessary because you can delegate to the system-provided metadata handlers.</span></span>
4.  <span data-ttu-id="33612-181">Incorporare un modello di identificazione univoco (si consiglia un GUID) in tutti i file di immagine.</span><span class="sxs-lookup"><span data-stu-id="33612-181">Embed a unique identifying pattern (we recommend a GUID) in all your image files.</span></span> <span data-ttu-id="33612-182">In questo modo è possibile trovare una corrispondenza tra il formato dell'immagine e il codec durante l'individuazione.</span><span class="sxs-lookup"><span data-stu-id="33612-182">This enables your image format to be matched against your codec during the discovery.</span></span> <span data-ttu-id="33612-183">Se si scrive un wrapper WIC per un formato di immagine esistente, è necessario trovare un modello di bit che il codificatore scrive sempre nei propri file di immagine, che è univoco per tale formato di immagine, e utilizzarlo come modello di identificazione.</span><span class="sxs-lookup"><span data-stu-id="33612-183">If you are writing a WIC wrapper for an existing image format, you must find a pattern of bits that the encoder always writes into its image files that’s unique to that image format, and use this as the identifying pattern.)</span></span>
5.  <span data-ttu-id="33612-184">Registrare il codec al momento dell'installazione.</span><span class="sxs-lookup"><span data-stu-id="33612-184">Register your codec at installation time.</span></span> <span data-ttu-id="33612-185">In questo modo, il codec viene individuato in fase di esecuzione associando il modello di identificazione nel registro di sistema al modello incorporato nel file di immagine.</span><span class="sxs-lookup"><span data-stu-id="33612-185">This enables your codec to be discovered at run time by matching the identifying pattern in the registry with the pattern embedded in the image file.</span></span>
6.  <span data-ttu-id="33612-186">A partire da Windows 7, per WIC è necessario che i codec siano di tipo apartment COM "both".</span><span class="sxs-lookup"><span data-stu-id="33612-186">As of Windows 7, WIC requires that codecs be of COM apartment type "Both".</span></span> <span data-ttu-id="33612-187">Ciò significa che è necessario eseguire il blocco appropriato per gestire i chiamanti e i chiamanti tra più Apartment negli scenari multithread.</span><span class="sxs-lookup"><span data-stu-id="33612-187">This means that you must do the appropriate locking to handle cross-apartment callers and callers in multi-threaded scenarios.</span></span> <span data-ttu-id="33612-188">Per ulteriori informazioni, vedere la sezione successiva sul supporto di Apartment multithread.</span><span class="sxs-lookup"><span data-stu-id="33612-188">For more information, see the next section on multi-threaded apartment support.</span></span>
7.  <span data-ttu-id="33612-189">Supporto per piattaforme a 64 bit: per Windows 7, per WIC è necessario che i codec WIC di terze parti siano distribuiti sia come file binari nativi a 32 bit che a 64 bit.</span><span class="sxs-lookup"><span data-stu-id="33612-189">Support for 64-bit platforms: For Windows 7, WIC will require that third-party WIC codecs be delivered as both 32-bit and 64-bit native binaries.</span></span> <span data-ttu-id="33612-190">Il modulo a 32 bit, inoltre, deve essere installato ed eseguito nei sistemi a 64 bit e il programma di installazione del codec Windows 7 di terze parti deve installare sia i file binari 32 bit che 64 bit nei sistemi a 64 bit.</span><span class="sxs-lookup"><span data-stu-id="33612-190">Further, the 32-bit form must install and run on 64-bit systems, and the third party Windows 7 codec installer must install both the 32-bit and 64-bit binaries on 64-bit systems.</span></span>

## <a name="multi-threaded-apartment-support-in-wic"></a><span data-ttu-id="33612-191">Supporto di Apartment multithread in WIC</span><span class="sxs-lookup"><span data-stu-id="33612-191">Multi-Threaded Apartment Support in WIC</span></span>

<span data-ttu-id="33612-192">Gli oggetti all'interno di un Apartment a thread multipli (MTA) possono essere chiamati simultaneamente da un numero qualsiasi di thread all'interno dell'MTA.</span><span class="sxs-lookup"><span data-stu-id="33612-192">Objects within a Multi-Threaded Apartment (MTA) may be called concurrently by any number of threads within the MTA.</span></span> <span data-ttu-id="33612-193">In questo modo è possibile ottenere prestazioni migliori nei sistemi multicore e in alcuni scenari server.</span><span class="sxs-lookup"><span data-stu-id="33612-193">This allows for better performance on multi-core systems and certain server scenarios.</span></span> <span data-ttu-id="33612-194">Inoltre, i codec WIC in un MTA possono chiamare altri oggetti nell'MTA senza il costo di marshalling associato alla chiamata tra thread in diversi apartment STA.</span><span class="sxs-lookup"><span data-stu-id="33612-194">In addition, WIC codecs in an MTA can call other objects in the MTA without the marshalling cost associated with calling between threads in different STA apartments.</span></span> <span data-ttu-id="33612-195">In Windows 7, tutti i codec WIC inclusi sono stati aggiornati per supportare gli MTA, tra cui JPEG, TIFF, PNG, GIF, ICO e BMP.</span><span class="sxs-lookup"><span data-stu-id="33612-195">In Windows 7, all in-box WIC codecs have been updated to support MTAs, including JPEG, TIFF, PNG, GIF, ICO, and BMP.</span></span> <span data-ttu-id="33612-196">È consigliabile scrivere codec di terze parti per supportare gli MTA.</span><span class="sxs-lookup"><span data-stu-id="33612-196">It is highly recommended that third-party codecs be written to support MTAs.</span></span> <span data-ttu-id="33612-197">I codec di terze parti che non supportano gli MTA causano costi significativi in termini di prestazioni nelle applicazioni multithread a causa del marshalling.</span><span class="sxs-lookup"><span data-stu-id="33612-197">Third-party codecs that do not to support MTAs cause significant performance costs in multi-threaded applications because of marshaling.</span></span> <span data-ttu-id="33612-198">Per abilitare il supporto MTA, è necessario implementare una sincronizzazione corretta nel codec di terze parti.</span><span class="sxs-lookup"><span data-stu-id="33612-198">Enabling MTA support requires proper synchronization to be implemented in the third-party codec.</span></span> <span data-ttu-id="33612-199">L'implementazione esatta di queste tecniche di sincronizzazione esula dall'ambito di questo documento.</span><span class="sxs-lookup"><span data-stu-id="33612-199">Exact implementation of these synchronization techniques is beyond the scope of this paper.</span></span> <span data-ttu-id="33612-200">Per ulteriori informazioni sulla sincronizzazione degli oggetti COM, vedere [Understanding and using com Threading Models](/previous-versions/ms809971(v=msdn.10)).</span><span class="sxs-lookup"><span data-stu-id="33612-200">For more information on synchronizing COM objects, see [Understanding and Using COM Threading Models](/previous-versions/ms809971(v=msdn.10)).</span></span>

## <a name="related-topics"></a><span data-ttu-id="33612-201">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="33612-201">Related topics</span></span>

<dl> <dt>

<span data-ttu-id="33612-202">**Informazioni concettuali**</span><span class="sxs-lookup"><span data-stu-id="33612-202">**Conceptual**</span></span>
</dt> <dt>

[<span data-ttu-id="33612-203">Introduzione (come scrivere un CODEC WIC-Enabled)</span><span class="sxs-lookup"><span data-stu-id="33612-203">Introduction (How to Write a WIC-Enabled CODEC)</span></span>](-wic-howtowriteacodec-intro.md)
</dt> <dt>

[<span data-ttu-id="33612-204">Implementazione di un decodificatore WIC-Enabled</span><span class="sxs-lookup"><span data-stu-id="33612-204">Implementing a WIC-Enabled Decoder</span></span>](-wic-implementingwicdecoder.md)
</dt> <dt>

[<span data-ttu-id="33612-205">Come scrivere un CODEC WIC-Enabled</span><span class="sxs-lookup"><span data-stu-id="33612-205">How to Write a WIC-Enabled CODEC</span></span>](-wic-howtowriteacodec.md)
</dt> <dt>

[<span data-ttu-id="33612-206">Panoramica del componente imaging Windows</span><span class="sxs-lookup"><span data-stu-id="33612-206">Windows Imaging Component Overview</span></span>](-wic-about-windows-imaging-codec.md)
</dt> <dt>

[<span data-ttu-id="33612-207">Cenni preliminari sui metadati WIC</span><span class="sxs-lookup"><span data-stu-id="33612-207">WIC Metadata Overview</span></span>](-wic-about-metadata.md)
</dt> </dl>

 

 



