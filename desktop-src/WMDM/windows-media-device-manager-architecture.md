---
title: Architettura di Windows Media Gestione dispositivi
description: Architettura di Windows Media Gestione dispositivi
ms.assetid: 3c1b2da4-559d-427b-b502-5ef8dc055a8e
keywords:
- Windows Media Gestione dispositivi, architettura
- Gestione dispositivi, architettura
- architettura per Windows Media Gestione dispositivi
- Windows Media Gestione dispositivi, applicazioni desktop
- Gestione dispositivi, applicazioni desktop
- Windows Media Gestione dispositivi, provider di servizi
- Gestione dispositivi, provider di servizi
- Windows Media Gestione dispositivi, plug-in
- Gestione dispositivi, plug-in
- applicazioni desktop, architettura Windows Media Gestione dispositivi
- provider di servizi, architettura di Windows Media Gestione dispositivi
- plug-in, architettura di Windows Media Gestione dispositivi
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9fda87e4ed4bce2c82bbb9c0863c119851965940
ms.sourcegitcommit: 2d531328b6ed82d4ad971a45a5131b430c5866f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 09/16/2019
ms.locfileid: "104221159"
---
# <a name="windows-media-device-manager-architecture"></a><span data-ttu-id="80fa1-115">Architettura di Windows Media Gestione dispositivi</span><span class="sxs-lookup"><span data-stu-id="80fa1-115">Windows Media Device Manager Architecture</span></span>

<span data-ttu-id="80fa1-116">Windows Media Gestione dispositivi consente a un'applicazione o a un plug-in di comunicare con un dispositivo.</span><span class="sxs-lookup"><span data-stu-id="80fa1-116">Windows Media Device Manager enables an application or plug-in to communicate with a device.</span></span> <span data-ttu-id="80fa1-117">Le applicazioni possono richiedere i metadati del dispositivo, enumerare ed esplorare i dispositivi collegati e inviare o ricevere oggetti (cartelle, file, playlist e così via).</span><span class="sxs-lookup"><span data-stu-id="80fa1-117">Applications can request device metadata, enumerate and explore attached devices, and send or receive objects (folders, files, playlists, and so on).</span></span> <span data-ttu-id="80fa1-118">Windows Media Gestione dispositivi fornisce un'unica API all'applicazione chiamante, indipendentemente dal tipo di dispositivo chiamato (MTP o classe di archiviazione di massa, provider di servizi basati sulla versione 10 o provider di servizi basati su versioni precedenti di Windows Media Gestione dispositivi).</span><span class="sxs-lookup"><span data-stu-id="80fa1-118">Windows Media Device Manager provides a single API to the calling application, no matter what type of device is being called (MTP or Mass Storage Class, service providers built on version 10 or service providers built on earlier versions of Windows Media Device Manager).</span></span>

<span data-ttu-id="80fa1-119">Windows Media Gestione dispositivi funge da intermediario per i tre componenti principali del sistema: l'applicazione, che effettua richieste (per informazioni, leggere o scrivere dati e così via); un provider di contenuti protetto, ovvero un componente che gestisce la comunicazione con file protetti da DRM; e un provider di servizi, che riceve le richieste dall'applicazione e comunica con il dispositivo per eseguire queste richieste.</span><span class="sxs-lookup"><span data-stu-id="80fa1-119">Windows Media Device Manager acts as a go-between for the three major components of the system: the application, which makes requests (for information, to read or write data, and so on); a secure content provider, which is a component that handles communication with DRM-protected files; and a service provider, which receives requests from the application and communicates with the device to perform these requests.</span></span> <span data-ttu-id="80fa1-120">Sia l'applicazione che il provider di servizi sono basati su Windows Media Gestione dispositivi SDK.</span><span class="sxs-lookup"><span data-stu-id="80fa1-120">Both the application and the service provider are built on the Windows Media Device Manager SDK.</span></span>

<span data-ttu-id="80fa1-121">Il diagramma seguente illustra il modo in cui un'applicazione desktop comunica con un dispositivo usando Windows Media Gestione dispositivi 11.</span><span class="sxs-lookup"><span data-stu-id="80fa1-121">The following diagram shows how a desktop application communicates with a device using Windows Media Device Manager 11.</span></span>

![diagramma che mostra un'applicazione che comunica con quattro tipi diversi di dispositivi.](images/wmdm-device-communication.gif)

<span data-ttu-id="80fa1-123">Il diagramma precedente mostra un'applicazione che comunica con quattro tipi diversi di dispositivi, ognuno con il proprio provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="80fa1-123">The preceding diagram shows an application communicating with four different types of devices, each with its own service provider.</span></span> <span data-ttu-id="80fa1-124">Ogni provider di servizi è progettato per comunicare con un tipo specifico di dispositivo; Questo diagramma illustra i tre provider di servizi forniti da Microsoft (driver di classe generici per i dispositivi di classe di archiviazione di massa, i dispositivi RAPI e i dispositivi MTP), nonché un provider di servizi personalizzato per un dispositivo proprietario creato da terze parti.</span><span class="sxs-lookup"><span data-stu-id="80fa1-124">Every service provider is designed to communicate with a specific type of device; this diagram shows the three Microsoft-provided service providers (generic class drivers for Mass Storage Class devices, RAPI devices, and MTP devices), as well as a custom service provider for a proprietary device built by a third party.</span></span> <span data-ttu-id="80fa1-125">Quando un dispositivo si connette, Windows Media Gestione dispositivi crea un'istanza del provider di servizi registrato per tale dispositivo.</span><span class="sxs-lookup"><span data-stu-id="80fa1-125">When a device connects, Windows Media Device Manager instantiates an instance of the service provider registered for that device.</span></span> <span data-ttu-id="80fa1-126">I provider di servizi ottengono richieste dall'applicazione tramite Windows Media Gestione dispositivi interfacce implementate, usano i driver appropriati per comunicare con il dispositivo e restituiscono risultati appropriati.</span><span class="sxs-lookup"><span data-stu-id="80fa1-126">The service providers get requests from the application through Windows Media Device Manager interfaces that they implement, use appropriate drivers to communicate with the device, and return appropriate results.</span></span> <span data-ttu-id="80fa1-127">La comunicazione tra il provider di servizi e il dispositivo esula dal dominio di Windows Media Gestione dispositivi.</span><span class="sxs-lookup"><span data-stu-id="80fa1-127">Communication between the service provider and the device is outside the domain of Windows Media Device Manager.</span></span>

<span data-ttu-id="80fa1-128">I provider di servizi sono invisibili all'applicazione; in un'applicazione viene visualizzato solo un elenco di "dispositivi" poiché Windows Media Gestione dispositivi espone un set standard di metodi e interfacce per tutti i dispositivi.</span><span class="sxs-lookup"><span data-stu-id="80fa1-128">Service providers are invisible to the application; an application sees only a list of "devices" because Windows Media Device Manager exposes a standard set of methods and interfaces for all devices.</span></span> <span data-ttu-id="80fa1-129">Se un produttore crea un provider di servizi personalizzato, deve gestire tutti i metodi Windows Media Gestione dispositivi standard se le applicazioni devono essere in grado di usare il dispositivo.</span><span class="sxs-lookup"><span data-stu-id="80fa1-129">If a manufacturer creates a custom service provider, it must handle all the standard Windows Media Device Manager methods if applications are to be able to use the device.</span></span>

<span data-ttu-id="80fa1-130">Questo diagramma mostra anche un modulo SCP (Secure Content Provider).</span><span class="sxs-lookup"><span data-stu-id="80fa1-130">This diagram also shows a secure content provider (SCP) module.</span></span> <span data-ttu-id="80fa1-131">Questo modulo è responsabile della gestione dei contenuti protetti Digital Rights Management (DRM).</span><span class="sxs-lookup"><span data-stu-id="80fa1-131">This module is responsible for handling digital rights management (DRM) protected content.</span></span> <span data-ttu-id="80fa1-132">Microsoft fornisce un modulo SCP in grado di gestire file WMA e WMV protetti da DRM.</span><span class="sxs-lookup"><span data-stu-id="80fa1-132">Microsoft provides an SCP module that can handle DRM-protected WMA and WMV files.</span></span> <span data-ttu-id="80fa1-133">Se un'applicazione o un dispositivo intende gestire altri formati protetti, deve fornire il proprio modulo SCP.</span><span class="sxs-lookup"><span data-stu-id="80fa1-133">If an application or device intends to handle other protected formats, it must provide its own SCP module.</span></span> <span data-ttu-id="80fa1-134">Né l'applicazione né il provider di servizi si occupano direttamente dell'SCP.</span><span class="sxs-lookup"><span data-stu-id="80fa1-134">Neither the application nor the service provider deals with the SCP directly.</span></span>

<span data-ttu-id="80fa1-135">Sia l'applicazione che il provider di servizi sono basati su Windows Media Gestione dispositivi, che instrada le chiamate tra l'applicazione e il provider di servizi appropriato per un dispositivo; il provider di servizi è responsabile della comunicazione diretta con il dispositivo.</span><span class="sxs-lookup"><span data-stu-id="80fa1-135">Both the application and the service provider are built on Windows Media Device Manager, which routes calls between the application and the appropriate service provider for a device; the service provider is responsible for communicating directly with the device.</span></span> <span data-ttu-id="80fa1-136">Windows Media Gestione dispositivi esegue alcune azioni, ad esempio l'enumerazione dei dispositivi connessi, le chiamate di routing e la gestione della verifica dei componenti. Tuttavia, la maggior parte del lavoro viene eseguita dal provider di servizi, che riceve le richieste dall'applicazione e comunica con il dispositivo.</span><span class="sxs-lookup"><span data-stu-id="80fa1-136">Windows Media Device Manager does perform some actions itself (such as enumerating connected devices, routing calls, and handling component verification); however, most of the work is done by the service provider, which receives requests from the application and communicates with the device.</span></span>

<span data-ttu-id="80fa1-137">Un'applicazione basata su Windows Media Gestione dispositivi può comunicare con i dispositivi e i provider di servizi compilati in versioni precedenti di Windows Media Gestione dispositivi; Tuttavia, questi dispositivi meno recenti verranno eseguiti con i componenti della serie 9 (non mostrati) e non supporteranno le funzionalità più recenti, in particolare la tecnologia Digital Rights Management più avanzata.</span><span class="sxs-lookup"><span data-stu-id="80fa1-137">An application built on Windows Media Device Manager can communicate with devices and service providers built on earlier versions of Windows Media Device Manager; however, these older devices will be run through 9 Series components (not shown), and will not support the newest features, particularly the more advanced digital rights management technology.</span></span>

<span data-ttu-id="80fa1-138">Architettura di un dispositivo</span><span class="sxs-lookup"><span data-stu-id="80fa1-138">Architecture of a Device</span></span>

<span data-ttu-id="80fa1-139">Il diagramma seguente mostra una gerarchia semplificata dei dispositivi e delle archiviazioni come visto da un'applicazione che usa Windows Media Gestione dispositivi.</span><span class="sxs-lookup"><span data-stu-id="80fa1-139">The following diagram shows a simplified hierarchy of devices and storages as seen by an application using Windows Media Device Manager.</span></span>

![diagramma che mostra le archiviazioni in un dispositivo.](images/wmdm-basic-device-layout.gif)

<span data-ttu-id="80fa1-141">Il diagramma precedente mostra una versione semplificata di un'unità flash connessa, come visto da un'applicazione Windows Media Gestione dispositivi.</span><span class="sxs-lookup"><span data-stu-id="80fa1-141">The preceding diagram shows a simplified version of a connected flash drive, as seen by a Windows Media Device Manager application.</span></span> <span data-ttu-id="80fa1-142">L'unità flash contiene attributi e proprietà, ad esempio un numero di serie e configurazioni di formato supportate.</span><span class="sxs-lookup"><span data-stu-id="80fa1-142">The flash drive has attributes and properties, such as a serial number and supported format configurations.</span></span> <span data-ttu-id="80fa1-143">Un figlio immediato del dispositivo flash è l'oggetto di archiviazione radice, che contiene una cartella, che a sua volta contiene un'immagine e un brano.</span><span class="sxs-lookup"><span data-stu-id="80fa1-143">An immediate child of the flash device is the root storage object, which contains a folder, which itself contains an image and a song.</span></span>

<span data-ttu-id="80fa1-144">Un'applicazione enumera l'elenco di dispositivi collegati chiamando un metodo di enumerazione esposto dall'interfaccia [**IWMDeviceManager**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdevicemanager) radice.</span><span class="sxs-lookup"><span data-stu-id="80fa1-144">An application enumerates the list of attached devices by calling an enumeration method exposed by the root [**IWMDeviceManager**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdevicemanager) interface.</span></span> <span data-ttu-id="80fa1-145">I dispositivi sono rappresentati da un'interfaccia [**IWMDMDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmdevice) (o derivata).</span><span class="sxs-lookup"><span data-stu-id="80fa1-145">Devices are represented by an [**IWMDMDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmdevice) (or a derived) interface.</span></span> <span data-ttu-id="80fa1-146">Questa interfaccia espone i metodi per recuperare il nome del dispositivo, le funzionalità di formattazione, il numero di serie e così via, nonché un metodo che enumera le *archiviazioni* sul dispositivo.</span><span class="sxs-lookup"><span data-stu-id="80fa1-146">This interface exposes methods to retrieve the device name, format capabilities, serial number, and so on, as well as a method that enumerates *storages* on the device.</span></span> <span data-ttu-id="80fa1-147">In Windows Media Gestione dispositivi, una risorsa di archiviazione è qualsiasi tipo di oggetto nel dispositivo, indipendentemente dal fatto che si tratti di un BLOB di dati effettivo.</span><span class="sxs-lookup"><span data-stu-id="80fa1-147">In Windows Media Device Manager, a storage is any kind of object on the device, whether or not it is an actual blob of data.</span></span> <span data-ttu-id="80fa1-148">Ad esempio, i file audio, i file di testo, le cartelle, le playlist archiviate come file e le playlist archiviate come metadati sono tutti considerati archiviazione, anche se le cartelle e gli elementi di metadati probabilmente non rappresentano un file fisico.</span><span class="sxs-lookup"><span data-stu-id="80fa1-148">For example: audio files, text files, folders, playlists stored as files, and playlists stored as metadata are all considered storages, even though folders and metadata items probably do not represent a physical file.</span></span> <span data-ttu-id="80fa1-149">Il tipo o il formato di un'archiviazione può essere recuperato chiamando [**GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) (o [**GetMetadata**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage3-getmetadata), richiedendo il formato di archiviazione).</span><span class="sxs-lookup"><span data-stu-id="80fa1-149">The type (or format) of a storage can be retrieved by calling [**GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) (or [**GetMetadata**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage3-getmetadata), requesting the format of the storage).</span></span>

<span data-ttu-id="80fa1-150">Le archiviazioni in un dispositivo vengono archiviate in modo gerarchico e tutti i dispositivi hanno un archivio radice.</span><span class="sxs-lookup"><span data-stu-id="80fa1-150">Storages on a device are stored hierarchically, and all devices have a root storage.</span></span> <span data-ttu-id="80fa1-151">Ogni archiviazione può ospitare zero o più oggetti figlio, enumerati chiamando il metodo [**IWMDMStorage:: EnumStorage**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-enumstorage) dell'archiviazione.</span><span class="sxs-lookup"><span data-stu-id="80fa1-151">Each storage can hold zero or more child objects, enumerated by calling that storage's [**IWMDMStorage::EnumStorage**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-enumstorage) method.</span></span>

<span data-ttu-id="80fa1-152">Si noti che a ogni archiviazione nel diagramma sono associati attributi e metadati (non tutti i valori vengono visualizzati).</span><span class="sxs-lookup"><span data-stu-id="80fa1-152">Note that each storage in the diagram has attributes and metadata associated with it (not all values are shown).</span></span> <span data-ttu-id="80fa1-153">Gli attributi sono semplici informazioni booleane che spesso descrivono le informazioni di gestione o di spostamento (ad esempio "has Folders" o "can delete"), mentre i metadati possono essere valori stringa, numeri o informazioni complesse, ad esempio le funzionalità di rendering.</span><span class="sxs-lookup"><span data-stu-id="80fa1-153">Attributes are simple, Boolean information often describing management or navigational information (such as "has folders" or "can delete"), whereas metadata can be string values, numbers, or complex information (such as rendering capabilities).</span></span> <span data-ttu-id="80fa1-154">Gli attributi vengono descritti da un set di flag piuttosto limitati definito dall'SDK e recuperati chiamando [**IWMDMStorage:: GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) o [**IWMDMStorage2:: GetAttributes2**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage2-getattributes2).</span><span class="sxs-lookup"><span data-stu-id="80fa1-154">Attributes are described by a fairly limited set of flags defined by the SDK and retrieved by calling [**IWMDMStorage::GetAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-getattributes) or [**IWMDMStorage2::GetAttributes2**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage2-getattributes2).</span></span> <span data-ttu-id="80fa1-155">I valori dei metadati vengono recuperati con un nome univoco. l'SDK definisce un numero di valori di metadati che i dispositivi devono supportare, ma i dispositivi possono definire le proprie [costanti di metadati](metadata-constants.md).</span><span class="sxs-lookup"><span data-stu-id="80fa1-155">Metadata values are retrieved by a unique name; the SDK defines a number of metadata values that devices should support, but devices can define their own [metadata constants](metadata-constants.md).</span></span> <span data-ttu-id="80fa1-156">Tuttavia, se un dispositivo o un provider di servizi definisce una nuova costante di metadati, le applicazioni non saranno in grado di richiedere o impostare questo valore a meno che gli sviluppatori di applicazioni non siano a conoscenza di questa nuova costante.</span><span class="sxs-lookup"><span data-stu-id="80fa1-156">However, if a device or service provider defines a new metadata constant, applications won't be able to request or set this value unless the application developers were aware of this new constant.</span></span> <span data-ttu-id="80fa1-157">Per supportare il recupero o l'impostazione dei metadati, un provider di servizi deve supportare [**IWMDMStorage3**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmstorage3) o versioni successive.</span><span class="sxs-lookup"><span data-stu-id="80fa1-157">A service provider must support [**IWMDMStorage3**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmstorage3) or later to support retrieving or setting metadata.</span></span> <span data-ttu-id="80fa1-158">Per altre informazioni, vedere [Getting and setting Metadata and Attributes](getting-and-setting-metadata-and-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="80fa1-158">For more information, see [Getting and Setting Metadata and Attributes](getting-and-setting-metadata-and-attributes.md).</span></span>

<span data-ttu-id="80fa1-159">Provider di servizi</span><span class="sxs-lookup"><span data-stu-id="80fa1-159">Service Providers</span></span>

<span data-ttu-id="80fa1-160">Il provider di servizi funge da intermediario tra l'applicazione e il dispositivo.</span><span class="sxs-lookup"><span data-stu-id="80fa1-160">The service provider acts as a middleman between the application and the device.</span></span> <span data-ttu-id="80fa1-161">Il provider di servizi è invisibile allo sviluppatore di applicazioni, quindi uno sviluppatore di applicazioni non deve sapere nulla sullo sviluppo di un provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="80fa1-161">The service provider is invisible to the application developer, so an application developer does not need to know anything about developing a service provider.</span></span> <span data-ttu-id="80fa1-162">Tuttavia, si tratta del provider di servizi che esegue le comunicazioni con un dispositivo.</span><span class="sxs-lookup"><span data-stu-id="80fa1-162">However, it is the service provider that does the work of communicating with a device.</span></span>

<span data-ttu-id="80fa1-163">Un provider di servizi è una DLL COM basata su Windows Media Gestione dispositivi che riceve le richieste da un'applicazione e comunica con il dispositivo per eseguirle.</span><span class="sxs-lookup"><span data-stu-id="80fa1-163">A service provider is a COM DLL built on Windows Media Device Manager that receives requests from an application and communicates with the device to perform them.</span></span> <span data-ttu-id="80fa1-164">La comunicazione con l'applicazione desktop è mediata da Windows Media Gestione dispositivi; la comunicazione con il dispositivo è sotto il controllo del provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="80fa1-164">Communication with the desktop application is mediated by Windows Media Device Manager; communication with the device is under the control of the service provider.</span></span>

<span data-ttu-id="80fa1-165">Un provider di servizi riceve le richieste dall'applicazione per enumerare il contenuto del dispositivo, le richieste per le funzionalità del dispositivo, le richieste di lettura o scrittura dei dati e così via.</span><span class="sxs-lookup"><span data-stu-id="80fa1-165">A service provider receives requests from the application to enumerate device content, requests for device capabilities, requests to read or write data, and so on.</span></span> <span data-ttu-id="80fa1-166">Deve essere a conoscenza della progettazione di un dispositivo in grado di inviare comandi nel formato e nel protocollo appropriati.</span><span class="sxs-lookup"><span data-stu-id="80fa1-166">It must know the design of a device well enough that it can send commands in the proper format and protocol.</span></span> <span data-ttu-id="80fa1-167">Deve anche essere in grado di nascondere i requisiti specifici del dispositivo, ad esempio un'estensione di file necessaria per le playlist, in modo che le applicazioni non debbano essere a conoscenza di questi requisiti per poter usare il dispositivo.</span><span class="sxs-lookup"><span data-stu-id="80fa1-167">It should also be able to hide device-specific requirements, such as a required file extension for playlists, so that applications do not need to know these requirements in order to use the device.</span></span>

<span data-ttu-id="80fa1-168">Microsoft fornisce diversi provider di servizi per i tipi di dispositivi standard, inclusi i dispositivi MTP generici, i dispositivi di classe di archiviazione di massa e i dispositivi RAPI.</span><span class="sxs-lookup"><span data-stu-id="80fa1-168">Microsoft provides a number of service providers for standard device types, including generic MTP devices, Mass Storage Class devices, and RAPI devices.</span></span> <span data-ttu-id="80fa1-169">Il solo motivo per cui un progettista di dispositivi deve creare un provider di servizi personalizzato è se un dispositivo presenta requisiti di archiviazione dati specifici o insoliti che non vengono gestiti dai provider di servizi standard, ad esempio se i file devono essere archiviati in percorsi specifici e il sistema operativo del dispositivo non la gestisce automaticamente.</span><span class="sxs-lookup"><span data-stu-id="80fa1-169">The only reason a device designer should need to create a custom service provider is if a device has some specific or unusual data storage requirements that the standard service providers do not handle—for instance, if files must be stored in specific locations and the device operating system does not handle this automatically.</span></span>

<span data-ttu-id="80fa1-170">Quando un dispositivo è connesso al computer, il sistema operativo crea un'istanza del provider di servizi appropriato per ogni applicazione Windows Media Gestione dispositivi.</span><span class="sxs-lookup"><span data-stu-id="80fa1-170">When a device is connected to the computer, the operating system creates one instance of the appropriate service provider for each Windows Media Device Manager application.</span></span> <span data-ttu-id="80fa1-171">Se viene avviata una seconda applicazione Windows Media Gestione dispositivi, viene caricata una seconda istanza del provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="80fa1-171">If a second Windows Media Device Manager application starts, a second instance of the service provider will be loaded.</span></span> <span data-ttu-id="80fa1-172">Tuttavia, ogni provider di servizi è in grado di gestire più dispositivi.</span><span class="sxs-lookup"><span data-stu-id="80fa1-172">However, each service provider can handle multiple devices.</span></span> <span data-ttu-id="80fa1-173">come illustrato nel diagramma seguente.</span><span class="sxs-lookup"><span data-stu-id="80fa1-173">The following diagram illustrates this.</span></span>

![diagramma che mostra due dispositivi MTP che comunicano con due applicazioni.](images/wmdm-sp-to-device.gif)

<span data-ttu-id="80fa1-175">Il diagramma precedente mostra due applicazioni diverse che comunicano con due dispositivi MTP.</span><span class="sxs-lookup"><span data-stu-id="80fa1-175">The preceding diagram shows two different applications communicating with two MTP devices.</span></span> <span data-ttu-id="80fa1-176">I dispositivi usano la stessa classe del provider di servizi, ma ogni applicazione dispone di una propria istanza dello stesso provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="80fa1-176">The devices use the same service provider class, but each application has its own instance of the same service provider.</span></span> <span data-ttu-id="80fa1-177">Ogni istanza del provider di servizi sta comunicando con i dispositivi.</span><span class="sxs-lookup"><span data-stu-id="80fa1-177">Each service provider instance is communicating with devices.</span></span> <span data-ttu-id="80fa1-178">Le diverse istanze del provider di servizi non sono consapevoli l'una dall'altra.</span><span class="sxs-lookup"><span data-stu-id="80fa1-178">The different instances of the service provider are not aware of each other.</span></span>

<span data-ttu-id="80fa1-179">Molti metodi dell'applicazione hanno un metodo del provider di servizi denominato corrispondente.</span><span class="sxs-lookup"><span data-stu-id="80fa1-179">Many application methods have a correspondingly named service provider method.</span></span> <span data-ttu-id="80fa1-180">Quando l'applicazione chiama un metodo, Windows Media Gestione dispositivi instrada la chiamata al metodo corrispondente sul provider di servizi (anche se potrebbe eseguire prima alcune azioni interne aggiuntive).</span><span class="sxs-lookup"><span data-stu-id="80fa1-180">When the application calls a method, Windows Media Device Manager routes the call to the corresponding method on the service provider (though it might perform some additional internal actions first).</span></span> <span data-ttu-id="80fa1-181">Ad esempio, quando l'applicazione chiama [**IWMDMDevice3:: GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-getproperty), Windows Media Gestione dispositivi instrada questa chiamata all'implementazione del provider di servizi di [**IMDSPDevice3:: GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-imdspdevice3-getproperty).</span><span class="sxs-lookup"><span data-stu-id="80fa1-181">For example, when the application calls [**IWMDMDevice3::GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-getproperty), Windows Media Device Manager routes this call to the service provider's implementation of [**IMDSPDevice3::GetProperty**](/windows/desktop/api/mswmdm/nf-mswmdm-imdspdevice3-getproperty).</span></span> <span data-ttu-id="80fa1-182">La maggior parte delle interfacce dell'applicazione inizia con IWMDM e l'interfaccia del provider di servizi corrispondente inizia con IMDSP).</span><span class="sxs-lookup"><span data-stu-id="80fa1-182">(Most application interfaces begin with IWMDM, and the corresponding service provider interface begins with IMDSP).</span></span> <span data-ttu-id="80fa1-183">È previsto che il provider di servizi gestisca la chiamata al metodo e restituisca un risultato appropriato.</span><span class="sxs-lookup"><span data-stu-id="80fa1-183">The service provider is expected to handle this method call and return an appropriate result.</span></span>

<span data-ttu-id="80fa1-184">Un'applicazione non Esplora né comunica direttamente con un dispositivo (a meno che non chiami [**IWMDMDevice3::D eviceiocontrol**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-deviceiocontrol) o [**IWMDMStorage:: SendOpaqueCommand**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-sendopaquecommand)); l'applicazione comunica con il provider di servizi, che deve rappresentare un dispositivo nel modo più logico e semplice possibile.</span><span class="sxs-lookup"><span data-stu-id="80fa1-184">An application never explores or communicates with a device directly (unless it calls [**IWMDMDevice3::DeviceIoControl**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmdevice3-deviceiocontrol) or [**IWMDMStorage::SendOpaqueCommand**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmstorage-sendopaquecommand)); the application communicates with the service provider, which must represent a device in the most logical and simple manner possible.</span></span> <span data-ttu-id="80fa1-185">Quando l'applicazione richiede informazioni sul dispositivo o enumera gli oggetti nel dispositivo, il provider di servizi esegue una query sul dispositivo in modo appropriato e acquisisce e restituisce le informazioni appropriate.</span><span class="sxs-lookup"><span data-stu-id="80fa1-185">When the application requests information about the device, or enumerates objects on the device, the service provider queries the device in an appropriate manner and acquires and returns the appropriate information.</span></span> <span data-ttu-id="80fa1-186">È possibile che l'organizzazione di file nel dispositivo venga esposta in modo diverso rispetto alla modalità di archiviazione fisica del dispositivo, se appropriato.</span><span class="sxs-lookup"><span data-stu-id="80fa1-186">It may expose the file organization on the device differently from how it is physically stored on the device, if that is appropriate.</span></span> <span data-ttu-id="80fa1-187">Tuttavia, il dispositivo viene esposto in modo coerente e logico, per consentire all'applicazione di trovare le informazioni necessarie e gestire i comandi inviati.</span><span class="sxs-lookup"><span data-stu-id="80fa1-187">However it exposes the device, it should be in a consistent, logical manner, to enable the application to find what it needs and handle the commands it sends.</span></span> <span data-ttu-id="80fa1-188">Un provider di servizi valido nasconde le peculiarità specifiche del dispositivo, ad esempio se il dispositivo archivia fisicamente una playlist come file con un'estensione di file personalizzata, il provider di servizi deve aggiungere automaticamente tale estensione quando l'applicazione crea una playlist nel dispositivo. Quando si crea un oggetto playlist, l'applicazione non deve essere in grado di conoscerne l'estensione corretta.</span><span class="sxs-lookup"><span data-stu-id="80fa1-188">A good service provider will hide device-specific peculiarities—for example, if the device physically stores a playlist as a file with a custom file extension, the service provider should add that extension automatically when the application creates a playlist on the device; it should not expect the application to know the proper extension when creating a playlist object.</span></span>

<span data-ttu-id="80fa1-189">I provider di servizi vengono eseguiti nel processo dell'applicazione chiamante.</span><span class="sxs-lookup"><span data-stu-id="80fa1-189">Service providers run inside the process of the calling application.</span></span> <span data-ttu-id="80fa1-190">L'unica eccezione è rappresentata dal provider di servizi MTP, che viene eseguito nel proprio processo.</span><span class="sxs-lookup"><span data-stu-id="80fa1-190">The only exception to this is the MTP service provider, which runs in its own process.</span></span> <span data-ttu-id="80fa1-191">Per questo motivo, esiste il rischio che un provider di servizi bloccati provochi il blocco dell'applicazione chiamante.</span><span class="sxs-lookup"><span data-stu-id="80fa1-191">Because of this, there is some risk that a blocked service provider will cause the calling application to block.</span></span> <span data-ttu-id="80fa1-192">Pertanto, i provider di servizi devono essere progettati in modo da essere affidabili e impedire il blocco e le applicazioni devono essere progettate in modo da evitare il blocco se una particolare chiamata al metodo non restituisce rapidamente.</span><span class="sxs-lookup"><span data-stu-id="80fa1-192">Therefore, service providers should be designed to be robust and prevent blocking, and applications should be designed to avoid stalling if a particular method call does not return quickly.</span></span>

## <a name="related-topics"></a><span data-ttu-id="80fa1-193">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="80fa1-193">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="80fa1-194">**Introduzione**</span><span class="sxs-lookup"><span data-stu-id="80fa1-194">**Getting Started**</span></span>](getting-started.md)
</dt> </dl>

 

 




