---
title: Creazione di un provider di servizi
description: Creazione di un provider di servizi
ms.assetid: 7da27fe2-8a57-4adb-94b2-448b6362dc33
keywords:
- Windows Media Gestione dispositivi, creazione di provider di servizi
- Gestione dispositivi, creazione di provider di servizi
- Windows Media Gestione dispositivi, Guida alla programmazione
- Gestione dispositivi, Guida alla programmazione
- Guida per programmatori, provider di servizi
- Guida per programmatori, Windows Media Gestione dispositivi
- Guida per programmatori, creazione di provider di servizi
- Windows Media Gestione dispositivi, provider di servizi
- Gestione dispositivi, provider di servizi
- provider di servizi, creazione
- creazione di provider di servizi, informazioni
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8469c3d656d151457ed818ea6b4192a3c79ed061
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "106299890"
---
# <a name="creating-a-service-provider"></a><span data-ttu-id="2854b-114">Creazione di un provider di servizi</span><span class="sxs-lookup"><span data-stu-id="2854b-114">Creating a Service Provider</span></span>

<span data-ttu-id="2854b-115">Un provider di servizi è un componente che funge da intermediario tra un'applicazione e un dispositivo.</span><span class="sxs-lookup"><span data-stu-id="2854b-115">A service provider is component that serves as a middleman between an application and a device.</span></span> <span data-ttu-id="2854b-116">Windows Media Gestione dispositivi instrada le richieste dall'applicazione al provider di servizi, che è quindi responsabile della comunicazione con il dispositivo o dell'esecuzione dell'azione richiesta.</span><span class="sxs-lookup"><span data-stu-id="2854b-116">Windows Media Device Manager routes requests from the application to the service provider, which is then responsible for communicating with the device or performing the requested action.</span></span> <span data-ttu-id="2854b-117">Un provider di servizi comunica in genere con un driver per consentire la comunicazione con il dispositivo.</span><span class="sxs-lookup"><span data-stu-id="2854b-117">A service provider usually communicates with a driver to enable communication with the device.</span></span> <span data-ttu-id="2854b-118">Un provider di servizi è un componente COM che implementa le interfacce chiamate da Windows Media Gestione dispositivi.</span><span class="sxs-lookup"><span data-stu-id="2854b-118">A service provider is a COM component that implements the interfaces called by Windows Media Device Manager.</span></span> <span data-ttu-id="2854b-119">L'interfaccia radice dell'oggetto provider di servizi è [**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider).</span><span class="sxs-lookup"><span data-stu-id="2854b-119">The root interface of the service provider object is [**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider).</span></span> <span data-ttu-id="2854b-120">Dopo aver ottenuto questa interfaccia, Windows Media Gestione dispositivi possibile ottenere altre interfacce tramite l'implementazione del provider di servizi di diversi metodi.</span><span class="sxs-lookup"><span data-stu-id="2854b-120">After obtaining this interface, Windows Media Device Manager can obtain other interfaces through the service provider's implementation of various methods.</span></span> <span data-ttu-id="2854b-121">Le interfacce che devono essere implementate da un provider di servizi sono elencate in [interfacce obbligatorie e facoltative](mandatory-and-optional-interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="2854b-121">The interfaces that a service provider must implement are listed in [Mandatory and Optional Interfaces](mandatory-and-optional-interfaces.md).</span></span> <span data-ttu-id="2854b-122">La gerarchia delle interfacce viene visualizzata in [interfacce per i provider di servizi](interfaces-for-service-providers.md).</span><span class="sxs-lookup"><span data-stu-id="2854b-122">The hierarchy of interfaces is shown in [Interfaces for Service Providers](interfaces-for-service-providers.md).</span></span>

> [!Note]  
> <span data-ttu-id="2854b-123">Non provare a creare un provider di servizi MTP; è invece consigliabile usare il provider di servizi MTP e i driver forniti da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2854b-123">You should not try to create an MTP service provider; instead, you should use the MTP service provider and drivers provided by Microsoft.</span></span>

 

<span data-ttu-id="2854b-124">Prima di provare a creare un provider di servizi, è necessario comprendere in modo approfondito le chiamate effettuate da un'applicazione su un provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="2854b-124">Before trying to create a service provider, you should thoroughly understand what calls an application will make on a service provider.</span></span> <span data-ttu-id="2854b-125">Per informazioni sulle attività di base e sulle chiamate effettuate da un'applicazione su un provider di servizi durante il tentativo di comunicare con un dispositivo, vedere [creazione di un'applicazione Windows Media Gestione dispositivi](creating-a-windows-media-device-manager-application.md) .</span><span class="sxs-lookup"><span data-stu-id="2854b-125">Read [Creating a Windows Media Device Manager Application](creating-a-windows-media-device-manager-application.md) to get some idea of the basic tasks and calls that an application will make on a service provider when it is attempting to communicate with a device.</span></span>

<span data-ttu-id="2854b-126">Nell'elenco seguente vengono illustrati i passaggi principali per lo sviluppo di un provider di servizi:</span><span class="sxs-lookup"><span data-stu-id="2854b-126">The following list shows the key steps in developing a service provider:</span></span>

1.  <span data-ttu-id="2854b-127">Includere (e, facoltativamente, compilare) i file di intestazione e di libreria necessari per il progetto.</span><span class="sxs-lookup"><span data-stu-id="2854b-127">Include (and optionally compile) the required header and library files for your project.</span></span> <span data-ttu-id="2854b-128">Per l'elenco dei file necessari, vedere le [librerie e le intestazioni obbligatorie per un provider di servizi](required-libraries-and-headers-for-a-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="2854b-128">See [Required Libraries and Headers for a Service Provider](required-libraries-and-headers-for-a-service-provider.md) for the list of required files.</span></span>
2.  <span data-ttu-id="2854b-129">Implementare tutte le altre interfacce del provider di servizi obbligatorie o facoltative (vedere [interfacce obbligatorie e facoltative](mandatory-and-optional-interfaces.md)).</span><span class="sxs-lookup"><span data-stu-id="2854b-129">Implement all the other required or optional service provider interfaces (see [Mandatory and Optional Interfaces](mandatory-and-optional-interfaces.md)).</span></span> <span data-ttu-id="2854b-130">In genere, le interfacce verranno chiamate in questo ordine:</span><span class="sxs-lookup"><span data-stu-id="2854b-130">Typically, interfaces will be called in this order:</span></span>
    -   [<span data-ttu-id="2854b-131">**IComponentAuthenticate**</span><span class="sxs-lookup"><span data-stu-id="2854b-131">**IComponentAuthenticate**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate)
    -   <span data-ttu-id="2854b-132">[**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2</span><span class="sxs-lookup"><span data-stu-id="2854b-132">[**IMDServiceProvider**](/windows/desktop/api/mswmdm/nn-mswmdm-imdserviceprovider)/2</span></span>
    -   [<span data-ttu-id="2854b-133">**IMDSPEnumDevice**</span><span class="sxs-lookup"><span data-stu-id="2854b-133">**IMDSPEnumDevice**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumdevice)
    -   <span data-ttu-id="2854b-134">[**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2</span><span class="sxs-lookup"><span data-stu-id="2854b-134">[**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice)/2</span></span>
    -   [<span data-ttu-id="2854b-135">**IMDSPEnumStorage**</span><span class="sxs-lookup"><span data-stu-id="2854b-135">**IMDSPEnumStorage**</span></span>](/windows/desktop/api/mswmdm/nn-mswmdm-imdspenumstorage)
    -   <span data-ttu-id="2854b-136">[**IMDSPStorage**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3</span><span class="sxs-lookup"><span data-stu-id="2854b-136">[**IMDSPStorage**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspstorage)/2/3</span></span>
3.  <span data-ttu-id="2854b-137">Verificare che il provider di servizi o il dispositivo installi le chiavi del registro di sistema appropriate durante l'installazione.</span><span class="sxs-lookup"><span data-stu-id="2854b-137">Be sure your service provider or device installs the proper registry keys during installation.</span></span> <span data-ttu-id="2854b-138">Queste chiavi specificano i parametri del dispositivo, registrano il provider di servizi come plug-in e abilitano Plug and Play notifiche per l'arrivo e la rimozione dei dispositivi.</span><span class="sxs-lookup"><span data-stu-id="2854b-138">These keys specify device parameters, register the service provider as a plug-in, and enable Plug and Play notifications for device arrival and removal.</span></span> <span data-ttu-id="2854b-139">Vedere [parametri del dispositivo](device-parameters.md), [registrazione del provider di servizi](registering-the-service-provider.md)e [Abilitazione di PNP per i dispositivi](enabling-pnp-for-devices.md).</span><span class="sxs-lookup"><span data-stu-id="2854b-139">See [Device Parameters](device-parameters.md), [Registering the Service Provider](registering-the-service-provider.md), and [Enabling PnP for Devices](enabling-pnp-for-devices.md).</span></span>
4.  <span data-ttu-id="2854b-140">Quando si crea un'istanza della classe, autenticare il provider di servizi nel costruttore.</span><span class="sxs-lookup"><span data-stu-id="2854b-140">On instantiation of your class, authenticate the service provider in the constructor.</span></span> <span data-ttu-id="2854b-141">A tale scopo, creare una classe [CSecureChannelServer](csecurechannelserver-class.md) e impostare il certificato.</span><span class="sxs-lookup"><span data-stu-id="2854b-141">To do this, create a [CSecureChannelServer](csecurechannelserver-class.md) class and set the certificate.</span></span> <span data-ttu-id="2854b-142">Implementare l'interfaccia [**IComponentAuthenticate**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) e chiamare i metodi della classe CSecureChannelServer di cui è stata creata un'istanza in precedenza.</span><span class="sxs-lookup"><span data-stu-id="2854b-142">Implement the [**IComponentAuthenticate**](/windows/desktop/api/mswmdm/nn-mswmdm-icomponentauthenticate) interface and call the methods of the CSecureChannelServer class instantiated previously.</span></span> <span data-ttu-id="2854b-143">Per informazioni su come creare un'istanza della classe CSecureChannelServer e implementare i metodi IComponentAuthenticate, vedere [autenticazione del provider di servizi](authenticating-the-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="2854b-143">See [Authenticating the Service Provider](authenticating-the-service-provider.md) to learn how to instantiate the CSecureChannelServer class and implement the IComponentAuthenticate methods.</span></span>
5.  <span data-ttu-id="2854b-144">Windows Media Gestione dispositivi eseguirà una query sul provider di servizi per un elenco di dispositivi connessi chiamando [**IMDServiceProvider2:: CreateDevice**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) o [**IMDServiceProvider:: EnumDevices**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices), a seconda che il provider di servizi gestisca plug and Play dispositivi.</span><span class="sxs-lookup"><span data-stu-id="2854b-144">Windows Media Device Manager will query your service provider for a list of connected devices by calling [**IMDServiceProvider2::CreateDevice**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider2-createdevice) or [**IMDServiceProvider::EnumDevices**](/windows/desktop/api/mswmdm/nf-mswmdm-imdserviceprovider-enumdevices), depending on whether the service provider handles Plug and Play devices.</span></span> <span data-ttu-id="2854b-145">Il provider di servizi deve restituire un elenco di oggetti [**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) che rappresentano i dispositivi connessi.</span><span class="sxs-lookup"><span data-stu-id="2854b-145">The service provider must return a list of [**IMDSPDevice**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspdevice) objects representing connected devices.</span></span> <span data-ttu-id="2854b-146">Per altri dettagli, vedere [enumerazione dei dispositivi](enumerating-devices-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="2854b-146">See [Enumerating Devices](enumerating-devices-service-provider.md) for more details.</span></span>
6.  <span data-ttu-id="2854b-147">Prima di gestire qualsiasi chiamata, verificare che sia stato stabilito un canale sicuro.</span><span class="sxs-lookup"><span data-stu-id="2854b-147">Before handling any call, verify that a secure channel has been established.</span></span> <span data-ttu-id="2854b-148">Chiamare [**CSecureChannelServer:: fIsAuthenticated**](/previous-versions/bb231600(v=vs.85)) prima di eseguire qualsiasi azione.</span><span class="sxs-lookup"><span data-stu-id="2854b-148">Call [**CSecureChannelServer::fIsAuthenticated**](/previous-versions/bb231600(v=vs.85)) before performing any actions.</span></span> <span data-ttu-id="2854b-149">Se la chiamata ha esito negativo, restituire WMDM \_ E \_ NOTCERTIFIED.</span><span class="sxs-lookup"><span data-stu-id="2854b-149">If this call fails, return WMDM\_E\_NOTCERTIFIED.</span></span>
7.  <span data-ttu-id="2854b-150">Per poter gestire il materiale protetto da DRM, sarà necessaria una coppia di certificati/chiavi rilasciata da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2854b-150">You will need a certificate/key pair issued by Microsoft to be able to handle DRM-protected material.</span></span> <span data-ttu-id="2854b-151">Per ulteriori informazioni, vedere [gestione del contenuto protetto nel provider di servizi](handling-protected-content-in-the-service-provider.md) .</span><span class="sxs-lookup"><span data-stu-id="2854b-151">See [Handling Protected Content in the Service Provider](handling-protected-content-in-the-service-provider.md) for more information.</span></span>
8.  <span data-ttu-id="2854b-152">Per consentire la sincronizzazione automatica del dispositivo con Windows Media Player, è necessario che soddisfi i requisiti indicati in [Abilitazione della sincronizzazione con windows media player](enabling-synchronization-with-windows-media-player.md).</span><span class="sxs-lookup"><span data-stu-id="2854b-152">To enable your device to synchronize automatically with Windows Media Player, it must fulfill the requirements listed in [Enabling Synchronization with Windows Media Player](enabling-synchronization-with-windows-media-player.md).</span></span>
9.  <span data-ttu-id="2854b-153">Per consentire la visualizzazione del dispositivo in Esplora risorse, è necessario eseguire alcuni passaggi speciali, descritti in dettaglio nei [requisiti per la visualizzazione dei lettori audio portatili in Esplora risorse](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md).</span><span class="sxs-lookup"><span data-stu-id="2854b-153">To enable your device to appear in Windows Explorer, you must take a few special steps, detailed in [Requirements for Portable Audio Players to Appear in Windows Explorer](requirements-for-portable-audio-players-to-appear-in-windows-explorer.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="2854b-154">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="2854b-154">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2854b-155">**Guida per programmatori**</span><span class="sxs-lookup"><span data-stu-id="2854b-155">**Programming Guide**</span></span>](programming-guide.md)
</dt> </dl>

 

 