---
title: Gestione manuale dei trasferimenti di file
description: Gestione manuale dei trasferimenti di file
ms.assetid: ff94191b-a0f2-4118-996c-d040f214fb9b
keywords:
- Windows Media Gestione dispositivi, trasferimenti di file manuali
- Gestione dispositivi, trasferimenti manuali di file
- Guida per programmatori, trasferimenti di file manuali
- applicazioni desktop, trasferimenti di file manuali
- creazione di applicazioni Windows Media Gestione dispositivi, trasferimenti manuali di file
- trasferimenti di file manuali
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: a2bf12404e8cd83b6f0c0e4f1c8ec8b0b7bda205
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "103728938"
---
# <a name="handling-file-transfers-manually"></a><span data-ttu-id="664a0-109">Gestione manuale dei trasferimenti di file</span><span class="sxs-lookup"><span data-stu-id="664a0-109">Handling File Transfers Manually</span></span>

<span data-ttu-id="664a0-110">L'applicazione può implementare l'interfaccia [**IWMDMOperation**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmoperation) per gestire parte del processo di lettura o scrittura.</span><span class="sxs-lookup"><span data-stu-id="664a0-110">Your application can implement the [**IWMDMOperation**](/windows/desktop/api/mswmdm/nn-mswmdm-iwmdmoperation) interface to manage part of the reading or writing process.</span></span> <span data-ttu-id="664a0-111">In una lettura dal dispositivo, l'implementazione consente all'applicazione di ricevere blocchi di dati non elaborati da un file del dispositivo.</span><span class="sxs-lookup"><span data-stu-id="664a0-111">On a read from device, the implementation enables the application to receive blocks of raw data from a device file.</span></span> <span data-ttu-id="664a0-112">In una scrittura nel dispositivo, consente all'applicazione di inviare blocchi di dati non elaborati a un file nel dispositivo.</span><span class="sxs-lookup"><span data-stu-id="664a0-112">On a write to device, it enables the application to send blocks of raw data to a file on the device.</span></span>

<span data-ttu-id="664a0-113">Nelle operazioni di lettura e scrittura il metodo [**IWMDMOperation:: TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) passa i dati tra il computer e il dispositivo.</span><span class="sxs-lookup"><span data-stu-id="664a0-113">In both read and write operations, the [**IWMDMOperation::TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) method passes the data between the computer and the device.</span></span> <span data-ttu-id="664a0-114">Per comprendere la direzione del trasferimento dei dati, l'applicazione deve impostare un flag quando Windows Media Gestione dispositivi chiama [**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) o [**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite).</span><span class="sxs-lookup"><span data-stu-id="664a0-114">To know the direction of the data transfer, your application must set a flag when Windows Media Device Manager calls [**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) or [**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite).</span></span> <span data-ttu-id="664a0-115">Quando viene chiamato il metodo [**end**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) , l'applicazione deve reimpostare questo flag.</span><span class="sxs-lookup"><span data-stu-id="664a0-115">When the [**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) method is called, the application should reset this flag.</span></span>

> [!Note]  
> <span data-ttu-id="664a0-116">Se il provider di servizi e il dispositivo implementano correttamente [**IMDSPObject2**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspobject2), verrà prima chiamato il metodo [IWMDMOperation3:: TransferObjectDataOnClearChannel](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation3-transferobjectdataonclearchannel) dell'applicazione, se implementato.</span><span class="sxs-lookup"><span data-stu-id="664a0-116">If the service provider and device properly implement [**IMDSPObject2**](/windows/desktop/api/mswmdm/nn-mswmdm-imdspobject2), it will first call the application's [IWMDMOperation3::TransferObjectDataOnClearChannel](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation3-transferobjectdataonclearchannel) method, if implemented.</span></span> <span data-ttu-id="664a0-117">Questo metodo rappresenta un modo più efficiente per trasferire i dati.</span><span class="sxs-lookup"><span data-stu-id="664a0-117">This method is a more efficient way of transferring data.</span></span> <span data-ttu-id="664a0-118">**TransferObjectDataOnClearChannel** viene gestito allo stesso modo di **TransferObjectData**, ad eccezione del fatto che i dati non vengono mai crittografati e non sono presenti valori Mac da verificare.</span><span class="sxs-lookup"><span data-stu-id="664a0-118">**TransferObjectDataOnClearChannel** is handled the same way as **TransferObjectData**, except that the data is never encrypted and has no MAC values to verify.</span></span>

 

<span data-ttu-id="664a0-119">Le sezioni seguenti descrivono sia il processo di lettura che quello di scrittura, quando l'applicazione implementa **IWMDMOperation**.</span><span class="sxs-lookup"><span data-stu-id="664a0-119">The following sections describe both the reading and the writing process, when your application implements **IWMDMOperation**.</span></span>

<span data-ttu-id="664a0-120">**Lettura da un dispositivo**</span><span class="sxs-lookup"><span data-stu-id="664a0-120">**Reading from a device**</span></span>

<span data-ttu-id="664a0-121">Quando si legge un file da un dispositivo, Windows Media Gestione dispositivi chiama i metodi **IWMDMOperation** seguenti nell'ordine indicato:</span><span class="sxs-lookup"><span data-stu-id="664a0-121">When reading a file from a device, Windows Media Device Manager calls the following **IWMDMOperation** methods in order:</span></span>

-   <span data-ttu-id="664a0-122">[**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) Chiamato per notificare all'applicazione l'inizio di una lettura dal dispositivo.</span><span class="sxs-lookup"><span data-stu-id="664a0-122">[**BeginRead**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginread) Called to notify the application that a read from device is beginning.</span></span>
-   <span data-ttu-id="664a0-123">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Chiamato una o più volte.</span><span class="sxs-lookup"><span data-stu-id="664a0-123">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Called one or more times.</span></span> <span data-ttu-id="664a0-124">L'elaborazione dei dati viene descritta nei passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="664a0-124">The processing of data is described in the following steps:</span></span>
    1.  <span data-ttu-id="664a0-125">**TransferObjectData** riceve un buffer, *pData*, di dimensioni *pdwSize* byte, compilato con dati e un Mac per verificare i dati in arrivo.</span><span class="sxs-lookup"><span data-stu-id="664a0-125">**TransferObjectData** receives a buffer, *pData*, of size *pdwSize* bytes, filled with data, and a MAC to verify the incoming data.</span></span>
    2.  <span data-ttu-id="664a0-126">L'applicazione verifica i parametri in ingresso con il MAC dei dati in arrivo.</span><span class="sxs-lookup"><span data-stu-id="664a0-126">The application verifies the incoming parameters with the incoming data MAC.</span></span>
    3.  <span data-ttu-id="664a0-127">Tramite l'applicazione vengono decrittografati e letti tutti i dati in *pData* come possibile e viene modificato il valore restituito di *pdwSize* per indicare il numero di byte effettivamente letti.</span><span class="sxs-lookup"><span data-stu-id="664a0-127">The application decrypts and reads as much of the data in *pData* as it can, and modifies the returned value of *pdwSize* to indicate how many bytes were actually read.</span></span>
    4.  <span data-ttu-id="664a0-128">L'applicazione decrittografa i dati, usando [**CSecureChannelClient::D ecryptparam**](/previous-versions/bb231586(v=vs.85))e li archivia o li usa, in base alle esigenze.</span><span class="sxs-lookup"><span data-stu-id="664a0-128">The application decrypts the data, using [**CSecureChannelClient::DecryptParam**](/previous-versions/bb231586(v=vs.85)), and stores it or uses it, as needed.</span></span>
    5.  <span data-ttu-id="664a0-129">**TransferObjectData** restituisce \_ OK.</span><span class="sxs-lookup"><span data-stu-id="664a0-129">**TransferObjectData** returns S\_OK.</span></span>
    6.  <span data-ttu-id="664a0-130">Windows Media Gestione dispositivi continua a chiamare **TransferObjectData** fino a quando l'applicazione non ha letto tutti i dati dal file o l'applicazione restituisce WMDM \_ E l' \_ utente \_ annullato per annullare l'operazione (nel qual caso la lettura viene annullata e Windows Media Gestione dispositivi chiama **end**).</span><span class="sxs-lookup"><span data-stu-id="664a0-130">Windows Media Device Manager continues to call **TransferObjectData** until the application has read all the data from the file, or the application returns WMDM\_E\_USER\_CANCELLED to cancel the operation (in which case the read is canceled, and Windows Media Device Manager calls **End**).</span></span>
-   <span data-ttu-id="664a0-131">[**Fine**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Chiamato per notificare all'applicazione che la lettura dal dispositivo sta per essere terminata.</span><span class="sxs-lookup"><span data-stu-id="664a0-131">[**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Called to notify the application that a read from device is ending.</span></span>

<span data-ttu-id="664a0-132">**Scrittura in un dispositivo**</span><span class="sxs-lookup"><span data-stu-id="664a0-132">**Writing to a device**</span></span>

<span data-ttu-id="664a0-133">Quando si scrive un file nel dispositivo, Windows Media Gestione dispositivi chiama i metodi **IWMDMOperation** seguenti nell'ordine indicato:</span><span class="sxs-lookup"><span data-stu-id="664a0-133">When writing a file to the device, Windows Media Device Manager calls the following **IWMDMOperation** methods in order:</span></span>

-   <span data-ttu-id="664a0-134">[**GetObjectName**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectname) Chiamato per consentire all'applicazione di specificare un nome per la nuova risorsa di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="664a0-134">[**GetObjectName**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectname) Called to allow the application to specify a name for the new storage.</span></span> <span data-ttu-id="664a0-135">Questo metodo viene chiamato solo se l'applicazione non ha specificato un nome nel metodo **Insert** .</span><span class="sxs-lookup"><span data-stu-id="664a0-135">This method is only called if the application did not specify a name in the **Insert** method.</span></span>
-   <span data-ttu-id="664a0-136">[**GetObjectAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectattributes) Chiamato per consentire all'applicazione di specificare gli attributi per la nuova risorsa di archiviazione nel dispositivo.</span><span class="sxs-lookup"><span data-stu-id="664a0-136">[**GetObjectAttributes**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjectattributes) Called to allow the application to specify attributes for the new storage on the device.</span></span>
-   <span data-ttu-id="664a0-137">[**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite) Chiamato per notificare l'inizio di una scrittura nel dispositivo.</span><span class="sxs-lookup"><span data-stu-id="664a0-137">[**BeginWrite**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-beginwrite) Called to notify that that a write to device is beginning.</span></span>
-   <span data-ttu-id="664a0-138">[**GetObjectTotalSize**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjecttotalsize) Chiamata eseguita per recuperare le dimensioni totali dell'oggetto scritto nel dispositivo, per consentire l'ottimizzazione del trasferimento e anche per concedere a Windows Media Gestione dispositivi la possibilità di annullare il trasferimento se il file è troppo grande per il dispositivo.</span><span class="sxs-lookup"><span data-stu-id="664a0-138">[**GetObjectTotalSize**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-getobjecttotalsize) Called to retrieve the total size of the object being written to the device, to enable optimization of the transfer, and also to give Windows Media Device Manager an opportunity to cancel the transfer if the file is too large for the device.</span></span>
-   <span data-ttu-id="664a0-139">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Chiamato una o più volte.</span><span class="sxs-lookup"><span data-stu-id="664a0-139">[**TransferObjectData**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-transferobjectdata) Called one or more times.</span></span> <span data-ttu-id="664a0-140">L'elaborazione dei dati viene descritta nei passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="664a0-140">The processing of data is described in the following steps:</span></span>
    1.  <span data-ttu-id="664a0-141">**TransferObjectData** riceve un puntatore a un buffer di dimensioni di *pdwSize* byte.</span><span class="sxs-lookup"><span data-stu-id="664a0-141">**TransferObjectData** receives a pointer to a buffer of size *pdwSize* bytes.</span></span>
    2.  <span data-ttu-id="664a0-142">L'applicazione ottiene un blocco di dati da inviare al dispositivo, in genere leggendo i dati da un file e riempie il buffer ricevuto fino a *pdwSize* byte.</span><span class="sxs-lookup"><span data-stu-id="664a0-142">The application gets a block of data to send to the device, usually by reading data from a file, and fills the received buffer with up to *pdwSize* bytes.</span></span> <span data-ttu-id="664a0-143">Deve modificare *pdwSize* (se necessario) per riflettere il numero di byte aggiunti al buffer.</span><span class="sxs-lookup"><span data-stu-id="664a0-143">It should modify *pdwSize* (if necessary) to reflect how many bytes were added to the buffer.</span></span>
    3.  <span data-ttu-id="664a0-144">L'applicazione crea un MAC di tutti i parametri del metodo.</span><span class="sxs-lookup"><span data-stu-id="664a0-144">The application creates a MAC of all the method parameters.</span></span>
    4.  <span data-ttu-id="664a0-145">L'applicazione crittografa i dati nel buffer usando [**CSecureChannelClient:: EncryptParam**](/previous-versions/bb231587(v=vs.85)).</span><span class="sxs-lookup"><span data-stu-id="664a0-145">The application encrypts the data in the buffer, using [**CSecureChannelClient::EncryptParam**](/previous-versions/bb231587(v=vs.85)).</span></span>
    5.  <span data-ttu-id="664a0-146">**TransferObjectData** restituisce \_ OK per indicare la presenza di più dati oppure s \_ false per indicare che non sono disponibili altri dati.</span><span class="sxs-lookup"><span data-stu-id="664a0-146">**TransferObjectData** returns S\_OK to indicate that there is more data, or S\_FALSE to indicate that there is no more data.</span></span> <span data-ttu-id="664a0-147">Se l'applicazione restituisce WMDM \_ e \_ \_ l'utente è stato annullato, l'operazione di scrittura viene annullata e Windows Media Gestione dispositivi chiamerà **end**.</span><span class="sxs-lookup"><span data-stu-id="664a0-147">If the application returns WMDM\_E\_USER\_CANCELLED, the write operation is canceled and Windows Media Device Manager will call **End**.</span></span>
    6.  <span data-ttu-id="664a0-148">Windows Media Gestione dispositivi continua a chiamare **TransferObjectData** a condizione che l'applicazione restituisca S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="664a0-148">Windows Media Device Manager continues to call **TransferObjectData** as long as the application returns S\_OK.</span></span>
-   <span data-ttu-id="664a0-149">[**Fine**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Chiamato per notificare la fine di una scrittura nel dispositivo.</span><span class="sxs-lookup"><span data-stu-id="664a0-149">[**End**](/windows/desktop/api/mswmdm/nf-mswmdm-iwmdmoperation-end) Called to notify that a write to device is ending.</span></span>

<span data-ttu-id="664a0-150">Per un esempio di codice, vedere [crittografia e decrittografia](encryption-and-decryption.md).</span><span class="sxs-lookup"><span data-stu-id="664a0-150">For a code example, see [Encryption and Decryption](encryption-and-decryption.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="664a0-151">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="664a0-151">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="664a0-152">**Creazione di un'applicazione Windows Media Gestione dispositivi**</span><span class="sxs-lookup"><span data-stu-id="664a0-152">**Creating a Windows Media Device Manager Application**</span></span>](creating-a-windows-media-device-manager-application.md)
</dt> </dl>

 

 