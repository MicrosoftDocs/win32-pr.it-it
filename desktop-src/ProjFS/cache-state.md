---
title: Stato della cache nella radice di virtualizzazione
description: Descrive i diversi Stati della cache che un file o una directory gestita dal provider può avere.
ms.assetid: <GUID-GOES-HERE>
ms.date: 01/17/2020
ms.topic: article
ms.openlocfilehash: 43d62ceb1f5ef5bf07000666f336077270b1e86a
ms.sourcegitcommit: 62e758931c610782807c7c9fad284921a6c56232
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/22/2020
ms.locfileid: "104398433"
---
# <a name="cache-state-in-the-virtualization-root"></a><span data-ttu-id="a16a2-103">Stato della cache nella radice di virtualizzazione</span><span class="sxs-lookup"><span data-stu-id="a16a2-103">Cache State In the Virtualization Root</span></span>

<span data-ttu-id="a16a2-104">Il provider usa il file system locale sotto la radice di virtualizzazione come una cache degli elementi gestiti.</span><span class="sxs-lookup"><span data-stu-id="a16a2-104">The provider uses the local file system under the virtualization root as a cache of the items that it manages.</span></span>  <span data-ttu-id="a16a2-105">Un elemento (file o directory) può trovarsi in uno dei sei Stati del file system locale:</span><span class="sxs-lookup"><span data-stu-id="a16a2-105">An item (file or directory) can be in one of six states on the local file system:</span></span>

* <span data-ttu-id="a16a2-106">Le macchine</span><span class="sxs-lookup"><span data-stu-id="a16a2-106">Virtual</span></span>

  <span data-ttu-id="a16a2-107">L'elemento non esiste localmente sul disco.</span><span class="sxs-lookup"><span data-stu-id="a16a2-107">The item does not exist locally on disk.</span></span>  <span data-ttu-id="a16a2-108">Viene proiettata, ad esempio sintetizzata, durante le enumerazioni della relativa directory padre.</span><span class="sxs-lookup"><span data-stu-id="a16a2-108">It is projected, i.e. synthesized, during enumerations of its parent directory.</span></span>  <span data-ttu-id="a16a2-109">Gli elementi virtuali vengono uniti con tutti gli elementi che possono esistere sul disco per presentare il contenuto completo della directory padre.</span><span class="sxs-lookup"><span data-stu-id="a16a2-109">Virtual items are merged with any items that may exist on disk to present the full contents of the parent directory.</span></span>

* <span data-ttu-id="a16a2-110">Segnaposto</span><span class="sxs-lookup"><span data-stu-id="a16a2-110">Placeholder</span></span>

  <span data-ttu-id="a16a2-111">Per i file: il contenuto del file (flusso di dati primario) non è presente sul disco.</span><span class="sxs-lookup"><span data-stu-id="a16a2-111">For files: The file's content (primary data stream) is not present on the disk.</span></span>  <span data-ttu-id="a16a2-112">I metadati del file (nome, dimensioni, timestamp, attributi e così via) vengono memorizzati nella cache del disco.</span><span class="sxs-lookup"><span data-stu-id="a16a2-112">The file’s metadata (name, size, timestamps, attributes, etc.) is cached on the disk.</span></span>
  
  <span data-ttu-id="a16a2-113">Per le directory: alcuni o tutti i discendenti immediati della directory (i file e le directory nella directory) non sono presenti sul disco, ovvero sono ancora virtuali.</span><span class="sxs-lookup"><span data-stu-id="a16a2-113">For directories: Some or all of the directory’s immediate descendants (the files and directories in the directory) are not present on the disk, i.e. they are still virtual.</span></span>  <span data-ttu-id="a16a2-114">I metadati della directory (nome, timestamp, attributi e così via) vengono memorizzati nella cache del disco.</span><span class="sxs-lookup"><span data-stu-id="a16a2-114">The directory’s metadata (name, timestamps, attributes, etc.) is cached on the disk.</span></span>

* <span data-ttu-id="a16a2-115">Segnaposto idrato</span><span class="sxs-lookup"><span data-stu-id="a16a2-115">Hydrated placeholder</span></span>

  <span data-ttu-id="a16a2-116">Per i file: il contenuto e i metadati del file sono stati memorizzati nella cache sul disco.</span><span class="sxs-lookup"><span data-stu-id="a16a2-116">For files: The file’s content and metadata have been cached to the disk.</span></span>  <span data-ttu-id="a16a2-117">Definito anche "file parziale".</span><span class="sxs-lookup"><span data-stu-id="a16a2-117">Also referred to as a "partial file".</span></span>
  
  <span data-ttu-id="a16a2-118">Per le directory: una directory creata su disco come segnaposto non diventa mai una directory di segnaposto idratata.</span><span class="sxs-lookup"><span data-stu-id="a16a2-118">For directories: A directory that was created on disk as a placeholder never becomes a hydrated placeholder directory.</span></span>  <span data-ttu-id="a16a2-119">In questo modo, il provider può aggiungere o rimuovere elementi dalla directory nell'archivio di backup e fare in modo che tali modifiche vengano riflesse nella cache locale.</span><span class="sxs-lookup"><span data-stu-id="a16a2-119">This allows the provider to add or remove items from the directory in its backing store and have those changes be reflected in the local cache.</span></span>

* <span data-ttu-id="a16a2-120">Segnaposto Dirty (idrato o meno)</span><span class="sxs-lookup"><span data-stu-id="a16a2-120">Dirty placeholder (hydrated or not)</span></span>

  <span data-ttu-id="a16a2-121">I metadati dell'elemento sono stati modificati localmente e non è più una cache dello stato nell'archivio del provider.</span><span class="sxs-lookup"><span data-stu-id="a16a2-121">The item's metadata has been locally modified and is no longer a cache of its state in the provider's store.</span></span> <span data-ttu-id="a16a2-122">Si noti che la creazione o l'eliminazione di un file o di una directory in una directory segnaposto fa sì che la directory segnaposto diventi Dirty.</span><span class="sxs-lookup"><span data-stu-id="a16a2-122">Note that creating or deleting a file or directory under a placeholder directory causes that placeholder directory to become dirty.</span></span>

* <span data-ttu-id="a16a2-123">File/directory completa</span><span class="sxs-lookup"><span data-stu-id="a16a2-123">Full file/directory</span></span>

  <span data-ttu-id="a16a2-124">Per i file: il contenuto del file (flusso di dati primario) è stato modificato.</span><span class="sxs-lookup"><span data-stu-id="a16a2-124">For files: The file's content (primary data stream) has been modified.</span></span>  <span data-ttu-id="a16a2-125">Il file non è più una cache dello stato nell'archivio del provider.</span><span class="sxs-lookup"><span data-stu-id="a16a2-125">The file is no longer a cache of its state in the provider's store.</span></span>  <span data-ttu-id="a16a2-126">Anche i file che sono stati creati nel file system locale (ovvero che non esistono nell'archivio del provider) sono considerati file completi.</span><span class="sxs-lookup"><span data-stu-id="a16a2-126">Files that have been created on the local file system (i.e. that do not exist in the provider's store at all) are also considered to be full files.</span></span>
  
  <span data-ttu-id="a16a2-127">Per le directory: le directory che sono state create nel file system locale (ovvero che non esistono nell'archivio del provider) sono considerate directory complete.</span><span class="sxs-lookup"><span data-stu-id="a16a2-127">For directories: Directories that have been created on the local file system (i.e. that do not exist in the provider's store at all) are considered to be full directories.</span></span>  <span data-ttu-id="a16a2-128">Una directory creata su disco come segnaposto non diventa mai una directory completa.</span><span class="sxs-lookup"><span data-stu-id="a16a2-128">A directory that was created on disk as a placeholder never becomes a full directory.</span></span>
  
* <span data-ttu-id="a16a2-129">Rimozione definitiva</span><span class="sxs-lookup"><span data-stu-id="a16a2-129">Tombstone</span></span>

  <span data-ttu-id="a16a2-130">Segnaposto nascosto speciale che rappresenta un elemento eliminato dalla file system locale.</span><span class="sxs-lookup"><span data-stu-id="a16a2-130">A special hidden placeholder that represents an item that has been deleted from the local file system.</span></span>  <span data-ttu-id="a16a2-131">Quando una directory viene enumerata ProjFS unisce il set di elementi locali (segnaposto, file completi e così via) con il set di elementi proiettati virtuali.</span><span class="sxs-lookup"><span data-stu-id="a16a2-131">When a directory is enumerated ProjFS merges the set of local items (placeholders, full files, etc.) with the set of virtual projected items.</span></span>  <span data-ttu-id="a16a2-132">Se un elemento viene visualizzato sia nei set locali che in quelli proiettati, l'elemento locale ha la precedenza.</span><span class="sxs-lookup"><span data-stu-id="a16a2-132">If an item appears in both the local and projected sets, the local item takes precedence.</span></span>  <span data-ttu-id="a16a2-133">Se un file non esiste nel file system locale, non esiste alcuno stato locale, quindi verrebbe visualizzato nell'enumerazione.</span><span class="sxs-lookup"><span data-stu-id="a16a2-133">If a file does not exist in the local file system there is no local state, so it would appear in the enumeration.</span></span>  <span data-ttu-id="a16a2-134">Tuttavia, se l'elemento è stato eliminato, la relativa visualizzazione nell'enumerazione risulterebbe imprevista.</span><span class="sxs-lookup"><span data-stu-id="a16a2-134">However if that item had been deleted, having it appear in the enumeration would be unexpected.</span></span>  <span data-ttu-id="a16a2-135">La sostituzione di un elemento eliminato con un oggetto contrassegnato per la rimozione definitiva comporta gli effetti seguenti:</span><span class="sxs-lookup"><span data-stu-id="a16a2-135">Replacing a deleted item with a tombstone results in the following effects:</span></span>

  * <span data-ttu-id="a16a2-136">Enumerazioni per non rivelare l'elemento.</span><span class="sxs-lookup"><span data-stu-id="a16a2-136">Enumerations to not reveal the item.</span></span>
  * <span data-ttu-id="a16a2-137">Si apre un file che prevede che l'elemento esista, ad esempio "file non trovato".</span><span class="sxs-lookup"><span data-stu-id="a16a2-137">File opens that expect the item to exist fail with e.g. "file not found".</span></span>
  * <span data-ttu-id="a16a2-138">Creazione di file che prevede la riuscita solo se l'elemento non esiste correttamente; ProjFS rimuove l'oggetto contrassegnato per la rimozione definitiva come parte dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="a16a2-138">File creates that expect to succeed only if the item does not exist succeed; ProjFS removes the tombstone as part of the operation.</span></span>

<span data-ttu-id="a16a2-139">Per illustrare gli stati precedenti, considerare la sequenza seguente, dato un provider ProjFS con un singolo file "foo.txt" situato nella radice di virtualizzazione C:\Root.</span><span class="sxs-lookup"><span data-stu-id="a16a2-139">To illustrate the above states, consider the following sequence, given a ProjFS provider that has a single file "foo.txt" located in the virtualization root C:\root.</span></span>

1. <span data-ttu-id="a16a2-140">Un'app enumera C:\Root.</span><span class="sxs-lookup"><span data-stu-id="a16a2-140">An app enumerates C:\root.</span></span>  <span data-ttu-id="a16a2-141">Viene visualizzato il file virtuale "foo.txt".</span><span class="sxs-lookup"><span data-stu-id="a16a2-141">It sees the virtual file "foo.txt".</span></span>  <span data-ttu-id="a16a2-142">Poiché non è ancora stato eseguito l'accesso al file, il file non esiste sul disco.</span><span class="sxs-lookup"><span data-stu-id="a16a2-142">Since the file has not yet been accessed, the file does not exist on disk.</span></span>
1. <span data-ttu-id="a16a2-143">L'app apre un handle per C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="a16a2-143">The app opens a handle to C:\root\foo.txt.</span></span>  <span data-ttu-id="a16a2-144">ProjFS indica al provider di creare un segnaposto.</span><span class="sxs-lookup"><span data-stu-id="a16a2-144">ProjFS tells the provider to create a placeholder for it.</span></span>
1. <span data-ttu-id="a16a2-145">L'app legge il contenuto del file.</span><span class="sxs-lookup"><span data-stu-id="a16a2-145">The app reads the content of the file.</span></span>  <span data-ttu-id="a16a2-146">Il provider fornisce il contenuto del file a ProjFS e viene memorizzato nella cache per C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="a16a2-146">The provider provides the file content to ProjFS and it is cached to C:\root\foo.txt.</span></span>  <span data-ttu-id="a16a2-147">Il file è ora un segnaposto idrato.</span><span class="sxs-lookup"><span data-stu-id="a16a2-147">The file is now a hydrated placeholder.</span></span>
1. <span data-ttu-id="a16a2-148">L'app Aggiorna il timestamp dell'Ultima modifica.</span><span class="sxs-lookup"><span data-stu-id="a16a2-148">The app updates the Last Modified timestamp.</span></span>  <span data-ttu-id="a16a2-149">Il file è ora un segnaposto Dirty idratato.</span><span class="sxs-lookup"><span data-stu-id="a16a2-149">The file is now a dirty hydrated placeholder.</span></span>
1. <span data-ttu-id="a16a2-150">L'app apre un handle per l'accesso in scrittura al file.</span><span class="sxs-lookup"><span data-stu-id="a16a2-150">The app opens a handle for write access to the file.</span></span>  <span data-ttu-id="a16a2-151">C:\root\foo.txt ora è un file completo.</span><span class="sxs-lookup"><span data-stu-id="a16a2-151">C:\root\foo.txt is now a full file.</span></span>
1. <span data-ttu-id="a16a2-152">L'app Elimina C:\root\foo.txt.</span><span class="sxs-lookup"><span data-stu-id="a16a2-152">The app deletes C:\root\foo.txt.</span></span>  <span data-ttu-id="a16a2-153">ProjFS sostituisce il file con un oggetto contrassegnato per la rimozione definitiva.</span><span class="sxs-lookup"><span data-stu-id="a16a2-153">ProjFS replaces the file with a tombstone.</span></span>  <span data-ttu-id="a16a2-154">A questo punto, quando l'app enumera c: root, non viene visualizzato foo.txt.</span><span class="sxs-lookup"><span data-stu-id="a16a2-154">Now when the app enumerates C:\root it does not see foo.txt.</span></span>  <span data-ttu-id="a16a2-155">Se tenta di aprire il file, l'apertura ha esito negativo con ERROR_FILE_NOT_FOUND.</span><span class="sxs-lookup"><span data-stu-id="a16a2-155">If it tries to open the file, the open fails with ERROR_FILE_NOT_FOUND.</span></span>
