---
title: App Direct2D multithreading
description: Descrive le procedure consigliate per la creazione di app Direct2D multithread.
ms.assetid: FDD770D4-817F-44D9-86C4-15DD04D214AE
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6be979b867edd6d36583959c4a595dbd507ca94f
ms.sourcegitcommit: c3243ec4ada05b7faf9d563853cb667ecef825e8
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/03/2020
ms.locfileid: "103734791"
---
# <a name="multithreaded-direct2d-apps"></a><span data-ttu-id="83675-103">App Direct2D multithreading</span><span class="sxs-lookup"><span data-stu-id="83675-103">Multithreaded Direct2D Apps</span></span>

<span data-ttu-id="83675-104">Se si sviluppano applicazioni [Direct2D](./direct2d-portal.md) , potrebbe essere necessario accedere alle risorse Direct2D da più di un thread.</span><span class="sxs-lookup"><span data-stu-id="83675-104">If you develop [Direct2D](./direct2d-portal.md) apps, you may need to access Direct2D resources from more than one thread.</span></span> <span data-ttu-id="83675-105">In altri casi, è consigliabile usare il multithreading per ottenere prestazioni migliori o una maggiore velocità di risposta, ad esempio l'uso di un thread per la visualizzazione dello schermo e di un thread separato per il rendering offline.</span><span class="sxs-lookup"><span data-stu-id="83675-105">In other cases, you may want to use multi-threading to get better performance or better responsiveness (like using one thread for screen display and a separate thread for offline rendering).</span></span>

<span data-ttu-id="83675-106">Questo argomento descrive le procedure consigliate per lo sviluppo di app [Direct2D](./direct2d-portal.md) multithreading con rendering [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) ridotto.</span><span class="sxs-lookup"><span data-stu-id="83675-106">This topic describes the best practices for developing multithreaded [Direct2D](./direct2d-portal.md) apps with little to no [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) rendering.</span></span> <span data-ttu-id="83675-107">Gli errori software causati da problemi di concorrenza possono essere difficili da rilevare ed è utile pianificare i criteri di multithreading e seguire le procedure consigliate descritte di seguito.</span><span class="sxs-lookup"><span data-stu-id="83675-107">Software defects caused by concurrency issues can be difficult to track down, and it is helpful to plan your multithreading policy and to follow the best practices described here.</span></span>

> [!Note]  
> <span data-ttu-id="83675-108">Se si accede a due risorse [Direct2D](./direct2d-portal.md) create da due diverse factory Direct2D a thread singolo, non si verificano conflitti di accesso finché i dispositivi [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) e i contesti di dispositivo sottostanti sono anche distinti.</span><span class="sxs-lookup"><span data-stu-id="83675-108">If you access two [Direct2D](./direct2d-portal.md) resources created from two different single threaded Direct2D factories it doesn't cause access conflicts as long as the underlying [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) devices and device contexts are also distinct.</span></span> <span data-ttu-id="83675-109">Quando si parla di "accesso alle risorse Direct2D" in questo articolo, significa semplicemente "accesso alle risorse Direct2D create dallo stesso dispositivo Direct2D", a meno che non sia specificato diversamente.</span><span class="sxs-lookup"><span data-stu-id="83675-109">When talking about "accessing Direct2D resources" in this article, it really means "accessing Direct2D resources created from the same Direct2D Device" unless stated otherwise.</span></span>

## <a name="developing-thread-safe-apps-that-call-only-direct2d-apis"></a><span data-ttu-id="83675-110">Sviluppo di app Thread-Safe che chiamano solo API Direct2D</span><span class="sxs-lookup"><span data-stu-id="83675-110">Developing Thread-Safe Apps that Call Only Direct2D APIs</span></span>

<span data-ttu-id="83675-111">È possibile creare un'istanza di factory [Direct2D](./direct2d-portal.md) multithreading.</span><span class="sxs-lookup"><span data-stu-id="83675-111">You can create a multithreaded [Direct2D](./direct2d-portal.md) factory instance.</span></span> <span data-ttu-id="83675-112">È possibile usare e condividere una factory multithreading e tutte le relative risorse da più di un thread, ma gli accessi a tali risorse (tramite chiamate Direct2D) vengono serializzati da Direct2D, quindi non si verificano conflitti di accesso.</span><span class="sxs-lookup"><span data-stu-id="83675-112">You can use and share a multithreaded factory and all its resources from more than one thread, but accesses to those resources (via Direct2D calls) are serialized by Direct2D, so no access conflicts occur.</span></span> <span data-ttu-id="83675-113">Se l'app chiama solo le API Direct2D, tale protezione viene eseguita automaticamente da Direct2D in un livello granulare con sovraccarico minimo.</span><span class="sxs-lookup"><span data-stu-id="83675-113">If your app calls only Direct2D APIs, such protection is automatically done by Direct2D in a granular level with minimum overhead.</span></span> <span data-ttu-id="83675-114">Il codice per creare una factory multithreading qui.</span><span class="sxs-lookup"><span data-stu-id="83675-114">The code to create a multithreaded factory here.</span></span>

```cpp
ID2D1Factory* m_D2DFactory;

// Create a Direct2D factory.
HRESULT hr = D2D1CreateFactory(
    D2D1_FACTORY_TYPE_MULTI_THREADED,
    &m_D2DFactory
);
```

<span data-ttu-id="83675-115">Nell'immagine seguente viene illustrato il modo in cui [Direct2D](./direct2d-portal.md) serializza due thread che effettuano chiamate utilizzando solo l'API Direct2D.</span><span class="sxs-lookup"><span data-stu-id="83675-115">The image here shows how [Direct2D](./direct2d-portal.md) serializes two threads that make calls using only the Direct2D API.</span></span>

![diagramma di due thread serializzati.](images/multi-thread.png)

## <a name="developing-thread-safe-direct2d-apps-with-minimal-direct3d-or-dxgi-calls"></a><span data-ttu-id="83675-117">Sviluppo di applicazioni Direct2D Thread-Safe con chiamate Direct3D o DXGI minime</span><span class="sxs-lookup"><span data-stu-id="83675-117">Developing Thread-Safe Direct2D Apps with minimal Direct3D or DXGI Calls</span></span>

<span data-ttu-id="83675-118">È più spesso che un'app [Direct2D](./direct2d-portal.md) esegue anche alcune chiamate a [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) o dxgi.</span><span class="sxs-lookup"><span data-stu-id="83675-118">It is more than often that a [Direct2D](./direct2d-portal.md) app also makes some [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls.</span></span> <span data-ttu-id="83675-119">Ad esempio, un thread di visualizzazione verrà disegnato in Direct2D, quindi presenterà usando una [**catena di scambio DXGI**](/windows/desktop/api/dxgi/nn-dxgi-idxgiswapchain).</span><span class="sxs-lookup"><span data-stu-id="83675-119">For example, a display thread will draw in Direct2D then present using a [**DXGI swap chain**](/windows/desktop/api/dxgi/nn-dxgi-idxgiswapchain).</span></span>

<span data-ttu-id="83675-120">In questo caso, garantire la sicurezza dei thread è più complessa: alcune chiamate [Direct2D](./direct2d-portal.md) accedono indirettamente alle risorse [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) sottostanti, che potrebbero essere accessibili contemporaneamente da un altro thread che chiama Direct3D o dxgi.</span><span class="sxs-lookup"><span data-stu-id="83675-120">In this case, assuring thread-safety is more complicated: some [Direct2D](./direct2d-portal.md) calls indirectly access the underlying [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) resources, which might be simultaneously accessed by another thread which calls Direct3D or DXGI.</span></span> <span data-ttu-id="83675-121">Poiché le chiamate Direct3D o DXGI sono fuori da le convenzioni Awareness and Control, è necessario creare una factory Direct2D multithreading, ma è necessario eseguire Mor per evitare conflitti di accesso.</span><span class="sxs-lookup"><span data-stu-id="83675-121">Since those Direct3D or DXGI calls are out of Direct2D’s awareness and control, you need to create a multithreaded Direct2D factory, but you must do mor to avoid access conflicts.</span></span>

<span data-ttu-id="83675-122">Il diagramma mostra un conflitto di accesso alle risorse [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) a causa del thread T0 che accede indirettamente a una risorsa tramite una chiamata [Direct2D](./direct2d-portal.md) e T2 che accede alla stessa risorsa direttamente tramite una chiamata Direct3D o dxgi.</span><span class="sxs-lookup"><span data-stu-id="83675-122">The diagram here shows a [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) resource access conflict due to thread T0 accessing a resource indirectly via a [Direct2D](./direct2d-portal.md) call and T2 accessing the same resource directly via a Direct3D or DXGI call.</span></span>

> [!Note]  
> <span data-ttu-id="83675-123">La protezione dei thread fornita da [Direct2D](./direct2d-portal.md) (il blocco blu in questa immagine) non è utile in questo caso.</span><span class="sxs-lookup"><span data-stu-id="83675-123">The thread protection that [Direct2D](./direct2d-portal.md) provides (the blue lock in this image) doesn't help in this case.</span></span>

 

![diagramma di protezione thread.](images/multi-thread2.png)

<span data-ttu-id="83675-125">Per evitare il conflitto di accesso alle risorse, è consigliabile acquisire in modo esplicito il blocco usato da [Direct2D](./direct2d-portal.md) per la sincronizzazione dell'accesso interno e applicare tale blocco quando un thread deve effettuare chiamate [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) o DXGI che potrebbero causare conflitti di accesso, come illustrato di seguito.</span><span class="sxs-lookup"><span data-stu-id="83675-125">To avoid resource access conflict here, we recommend you explicitly acquire the lock that [Direct2D](./direct2d-portal.md) uses for internal access synchronization, and apply that lock when a thread needs to make [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls that might cause access conflict as shown here.</span></span> <span data-ttu-id="83675-126">In particolare, è necessario prestare particolare attenzione al codice che usa le eccezioni o un sistema di primo in uscita in base ai codici restituiti HRESULT.</span><span class="sxs-lookup"><span data-stu-id="83675-126">In particular, you should take special care with code that uses exceptions or an early out system based on HRESULT return codes.</span></span> <span data-ttu-id="83675-127">Per questo motivo, è consigliabile usare un criterio di inizializzazione di RAII (acquisizione di risorse) per chiamare i metodi [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) e [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) .</span><span class="sxs-lookup"><span data-stu-id="83675-127">For this reason, we recommend you use an RAII (Resource Acquisition Is Initialization) pattern to call the [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) and [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) methods.</span></span>

> [!Note]  
> <span data-ttu-id="83675-128">È importante associare le chiamate ai metodi [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) e [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) . in caso contrario, l'app può essere bloccata in deadlock.</span><span class="sxs-lookup"><span data-stu-id="83675-128">It is important that you pair up calls to the [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) and [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) methods, otherwise your app can deadlock.</span></span>

 

<span data-ttu-id="83675-129">Il codice mostra un esempio di quando bloccare e quindi sbloccare le chiamate [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) o dxgi.</span><span class="sxs-lookup"><span data-stu-id="83675-129">The code here shows an example of when to lock and then and unlock around [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls.</span></span>


```C++
void MyApp::DrawFromThread2()
{
    // We are accessing Direct3D resources directly without Direct2D's knowledge, so we
    // must manually acquire and apply the Direct2D factory lock.
    ID2D1Multithread* m_D2DMultithread;
    m_D2DFactory->QueryInterface(IID_PPV_ARGS(&m_D2DMultithread));
    m_D2DMultithread->Enter();
    
    // Now it is safe to make Direct3D/DXGI calls, such as IDXGISwapChain::Present
    MakeDirect3DCalls();

    // It is absolutely critical that the factory lock be released upon
    // exiting this function, or else any consequent Direct2D calls will be blocked.
    m_D2DMultithread->Leave();
}
```



> [!Note]  
> <span data-ttu-id="83675-130">Alcune chiamate [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) o DXGI (in particolare [**IDXGISwapChain::P**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-present)reinviate) possono acquisire i blocchi e/o i callback del trigger nel codice della funzione o del metodo chiamante.</span><span class="sxs-lookup"><span data-stu-id="83675-130">Some [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls (notably [**IDXGISwapChain::Present**](/windows/desktop/api/dxgi/nf-dxgi-idxgiswapchain-present)) may acquire locks and/or trigger callbacks into the code of the calling function or method.</span></span> <span data-ttu-id="83675-131">È necessario tenere presente questo comportamento e assicurarsi che tale comportamento non provochi deadlock.</span><span class="sxs-lookup"><span data-stu-id="83675-131">You should be aware of this and make sure that such behavior doesn't cause deadlocks.</span></span> <span data-ttu-id="83675-132">Per altre informazioni, vedere l'argomento [Panoramica di DXGI](/windows/desktop/direct3ddxgi/d3d10-graphics-programming-guide-dxgi) .</span><span class="sxs-lookup"><span data-stu-id="83675-132">For more info, see the [DXGI Overview](/windows/desktop/direct3ddxgi/d3d10-graphics-programming-guide-dxgi) topic.</span></span>

 

![diagramma di blocco del thread Direct2D e Direct3D.](images/multi-thread3.png)

<span data-ttu-id="83675-134">Quando si usano i metodi [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) e [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) , le chiamate sono protette dal [Direct2D](./direct2d-portal.md) automatico e dal blocco esplicito, quindi l'app non raggiunge il conflitto di accesso.</span><span class="sxs-lookup"><span data-stu-id="83675-134">When you use the [**Enter**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-enter) and [**Leave**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1multithread-leave) methods, the calls are protected by the automatic [Direct2D](./direct2d-portal.md) and the explicit lock, so the app doesn't hit access conflict.</span></span>

<span data-ttu-id="83675-135">Esistono altri approcci per risolvere questo problema.</span><span class="sxs-lookup"><span data-stu-id="83675-135">There are other approaches to work around this issue.</span></span> <span data-ttu-id="83675-136">Tuttavia, si consiglia di proteggere in modo esplicito le chiamate [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) o DXGI con il blocco [Direct2D](./direct2d-portal.md) , perché in genere fornisce prestazioni migliori in quanto protegge la concorrenza a un livello più preciso e con un sovraccarico inferiore nella copertura di le convenzioni.</span><span class="sxs-lookup"><span data-stu-id="83675-136">However, we recommend you explicitly guard [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls with the [Direct2D](./direct2d-portal.md) lock because it usually provides better performance as it protects concurrency at a much finer level and with lower overhead under Direct2D’s cover.</span></span>

## <a name="ensuring-atomicity-of-stateful-operations"></a><span data-ttu-id="83675-137">Verifica dell'atomicità delle operazioni con stato</span><span class="sxs-lookup"><span data-stu-id="83675-137">Ensuring Atomicity of Stateful Operations</span></span>

<span data-ttu-id="83675-138">Sebbene le funzionalità di thread safety di [DirectX](/previous-versions//ee663301(v=vs.85)) contribuiscano a garantire che non vengano effettuate due singole chiamate API contemporaneamente, è necessario assicurarsi anche che i thread che eseguono chiamate API con stato non interferiscano tra loro.</span><span class="sxs-lookup"><span data-stu-id="83675-138">While thread-safety features of [DirectX](/previous-versions//ee663301(v=vs.85)) can help ensure that no two individual API calls are made concurrently, you must also ensure that threads that make stateful API calls don't interfere with each other.</span></span> <span data-ttu-id="83675-139">Ecco un esempio.</span><span class="sxs-lookup"><span data-stu-id="83675-139">Here is an example.</span></span>

1.  <span data-ttu-id="83675-140">Ci sono due righe di testo di cui si vuole eseguire il rendering sia sullo schermo (dal thread 0) sia sullo schermo (dal thread 1): la riga \# 1 è "a è maggiore" e \# la riga 2 è "than B", entrambe che verranno disegnate usando un pennello nero a tinta unita.</span><span class="sxs-lookup"><span data-stu-id="83675-140">There are two lines of text that you want to render to both on-screen (by Thread 0) and off-screen (by Thread 1): Line \#1 is "A is greater" and Line \#2 is "than B", both of which will be drawn using a solid black brush.</span></span>
2.  <span data-ttu-id="83675-141">Il thread 1 disegna la prima riga di testo.</span><span class="sxs-lookup"><span data-stu-id="83675-141">Thread 1 draws the first line of text.</span></span>
3.  <span data-ttu-id="83675-142">Il thread 0 reagisce a un input dell'utente, aggiorna entrambe le righe di testo a "B" e "rispettivamente" e "di un" e ha modificato il colore del pennello in rosso continuo per il proprio disegno;</span><span class="sxs-lookup"><span data-stu-id="83675-142">Thread 0 reacts to a user input, updates both text lines to "B is smaller" and "than A" respectively, and changed the brush color to solid red for its own drawing;</span></span>
4.  <span data-ttu-id="83675-143">Il thread 1 continua a disegnare la seconda riga di testo, che ora è "Than A", con il pennello di colore rosso;</span><span class="sxs-lookup"><span data-stu-id="83675-143">Thread 1 continues drawing the second line of text, which is now "than A", with the red color brush;</span></span>
5.  <span data-ttu-id="83675-144">Infine, si ottengono due righe di testo nella destinazione del disegno fuori schermo: "A è maggiore" in nero e "di a" in rosso.</span><span class="sxs-lookup"><span data-stu-id="83675-144">Finally, we get two lines of text on the off-screen drawing target: "A is greater" in black and "than A" in red.</span></span>

![diagramma dei thread su schermo.](images/multi-thread4.png)

<span data-ttu-id="83675-146">Nella riga superiore, il thread 0 disegna con le stringhe di testo correnti e il pennello nero corrente.</span><span class="sxs-lookup"><span data-stu-id="83675-146">In the top row, Thread 0 draws with current text strings and the current black brush.</span></span> <span data-ttu-id="83675-147">Il thread 1 termina solo il disegno fuori schermo sulla metà superiore.</span><span class="sxs-lookup"><span data-stu-id="83675-147">Thread 1 only finishes off-screen drawing on the top half.</span></span>

<span data-ttu-id="83675-148">Nella riga intermedia, il thread 0 risponde all'interazione dell'utente, aggiorna le stringhe di testo e il pennello, quindi aggiorna la schermata.</span><span class="sxs-lookup"><span data-stu-id="83675-148">In the middle row, Thread 0 responds to user interaction, updates the text strings and the brush, then refreshes the screen.</span></span> <span data-ttu-id="83675-149">A questo punto, il thread 1 è bloccato.</span><span class="sxs-lookup"><span data-stu-id="83675-149">At this point, Thread 1 is blocked.</span></span> <span data-ttu-id="83675-150">Nella riga inferiore, il rendering finale fuori schermo dopo il thread 1 riprende a disegnare la metà inferiore con un pennello modificato e una stringa di testo modificata.</span><span class="sxs-lookup"><span data-stu-id="83675-150">In the bottom row, the final off-screen rendering after Thread 1 resumes drawing the bottom half with an altered brush and an altered text string.</span></span>

<span data-ttu-id="83675-151">Per risolvere questo problema, è consigliabile disporre di un contesto separato per ogni thread, in modo che:</span><span class="sxs-lookup"><span data-stu-id="83675-151">To address this issue, we recommend you have a separate context for each thread, so that:</span></span>

-   <span data-ttu-id="83675-152">È necessario creare una copia del contesto di dispositivo in modo che le risorse modificabili, ad esempio le risorse che possono variare durante la visualizzazione o la stampa, come il contenuto di testo o il pennello tinta unita nell'esempio, non cambino quando si esegue il rendering.</span><span class="sxs-lookup"><span data-stu-id="83675-152">You should create a copy of the device context so that mutable resources (i.e. resources that may vary during display or printing, such as text contents or the solid color brush in the example) don't change when you render.</span></span> <span data-ttu-id="83675-153">In questo esempio, è consigliabile mantenere una copia di queste due righe di testi e il pennello del colore prima di creare.</span><span class="sxs-lookup"><span data-stu-id="83675-153">In this sample, you should maintain a copy of those two lines of texts and the color brush before you draw.</span></span> <span data-ttu-id="83675-154">In questo modo, si garantisce che ogni thread abbia contenuto completo e coerente da creare e presentare.</span><span class="sxs-lookup"><span data-stu-id="83675-154">By doing so, you guarantee each thread has complete and consistent content to draw and present.</span></span>
-   <span data-ttu-id="83675-155">È consigliabile condividere risorse di peso elevato, come bitmap e grafici con effetti complessi, che vengono inizializzate una volta e quindi mai modificate tra i thread per migliorare le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="83675-155">You should share heavy-weight resources (like bitmaps and complex effect graphs) that are initialized once and then never modified across threads to increase performance.</span></span>
-   <span data-ttu-id="83675-156">È possibile condividere risorse leggere (ad esempio, pennelli a tinta unita e formati di testo) che vengono inizializzate una sola volta e non vengono mai modificate tra i thread</span><span class="sxs-lookup"><span data-stu-id="83675-156">You can either share light-weight resources (like solid color brushes and text formats) that are initialized once and then never modified across threads or not</span></span>

## <a name="summary"></a><span data-ttu-id="83675-157">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="83675-157">Summary</span></span>

<span data-ttu-id="83675-158">Quando si sviluppano applicazioni [Direct2D](./direct2d-portal.md) multithreading, è necessario creare una factory Direct2D multithreading, quindi derivare tutte le risorse Direct2D da tale factory.</span><span class="sxs-lookup"><span data-stu-id="83675-158">When you develop multithreaded [Direct2D](./direct2d-portal.md) apps, you must create a multithreaded Direct2D factory then derive all Direct2D resources from that factory.</span></span> <span data-ttu-id="83675-159">Se un thread effettuerà chiamate [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) o DXGI, è anche necessario acquisire in modo esplicito, quindi applicare il blocco Direct2D per proteggere le chiamate Direct3D o dxgi.</span><span class="sxs-lookup"><span data-stu-id="83675-159">If a thread will make [Direct3D](/windows/desktop/direct3d11/atoc-dx-graphics-direct3d-11) or DXGI calls, you also must explicitly acquire then apply the Direct2D lock to guard those Direct3D or DXGI calls.</span></span> <span data-ttu-id="83675-160">Inoltre, è necessario garantire l'integrità del contesto con una copia delle risorse modificabili per ogni thread.</span><span class="sxs-lookup"><span data-stu-id="83675-160">Moreover, you must ensure context integrity by having a copy of mutable resources for each thread.</span></span>
