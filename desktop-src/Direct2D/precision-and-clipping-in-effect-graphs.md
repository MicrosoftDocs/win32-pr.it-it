---
title: Precisione e ritaglio numerico nei grafici effettivi
description: Le applicazioni che eseguono il rendering degli effetti utilizzando Direct2D devono prestare attenzione a raggiungere il livello di qualità e prevedibilità desiderato rispetto alla precisione numerica.
ms.assetid: 6fd1d77f-e613-534f-3205-bad11fa24c30
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 90628661ec8cd3f16ff6a6149aecbb7e8be3e5a9
ms.sourcegitcommit: 592c9bbd22ba69802dc353bcb5eb30699f9e9403
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/20/2020
ms.locfileid: "104047200"
---
# <a name="precision-and-numerical-clipping-in-effect-graphs"></a><span data-ttu-id="61af1-103">Precisione e ritaglio numerico nei grafici effettivi</span><span class="sxs-lookup"><span data-stu-id="61af1-103">Precision and numerical clipping in effect graphs</span></span>

<span data-ttu-id="61af1-104">Le applicazioni che eseguono il rendering degli effetti utilizzando Direct2D devono prestare attenzione a raggiungere il livello di qualità e prevedibilità desiderato rispetto alla precisione numerica.</span><span class="sxs-lookup"><span data-stu-id="61af1-104">Applications that render effects using Direct2D must take care to achieve the desired level of quality and predictability with respect to numerical precision.</span></span> <span data-ttu-id="61af1-105">In questo argomento vengono descritte le procedure consigliate e le impostazioni rilevanti in Direct2D utili se:</span><span class="sxs-lookup"><span data-stu-id="61af1-105">This topic describes best practices and relevant settings in Direct2D which are useful if:</span></span>

-   <span data-ttu-id="61af1-106">Il grafico degli effetti si basa su colori o precisione numerica elevata al di fuori dell' \[ intervallo 0, 1 \] e si desidera assicurarsi che siano sempre disponibili</span><span class="sxs-lookup"><span data-stu-id="61af1-106">Your effect graph relies on high numerical precision or colors outside of the \[0, 1\] range, and you want to make sure these will always be available</span></span>
-   <span data-ttu-id="61af1-107">In alternativa, il grafico degli effetti si basa sull'implementazione del rendering per bloccare i colori intermedi all' \[ intervallo 0, 1 \] e si vuole garantire che questo blocco avvenga sempre</span><span class="sxs-lookup"><span data-stu-id="61af1-107">Or, your effect graph relies on the rendering implementation to clamp intermediate colors to the \[0, 1\] range, and you want to ensure this clamping always occurs</span></span>

<span data-ttu-id="61af1-108">Direct2D spesso divide un grafico effetto in sezioni ed esegue il rendering di ogni sezione in un passaggio separato.</span><span class="sxs-lookup"><span data-stu-id="61af1-108">Direct2D often divides an effect graph into sections, and renders each section in a separate step.</span></span> <span data-ttu-id="61af1-109">L'output di alcuni passaggi può essere archiviato in trame Direct3D intermedie, che per impostazione predefinita hanno un intervallo numerico e una precisione limitati.</span><span class="sxs-lookup"><span data-stu-id="61af1-109">The output of some steps may be stored in intermediate Direct3D textures which by default have limited numerical range and precision.</span></span> <span data-ttu-id="61af1-110">Direct2D non fornisce alcuna garanzia su se o dove vengono utilizzate queste trame intermedie.</span><span class="sxs-lookup"><span data-stu-id="61af1-110">Direct2D makes no guarantees about if or where these intermediate textures are used.</span></span> <span data-ttu-id="61af1-111">Questo comportamento può variare in base alle funzionalità GPU, oltre che tra le versioni di Windows.</span><span class="sxs-lookup"><span data-stu-id="61af1-111">This behavior may vary according to GPU capabilities as well as between Windows versions.</span></span>

<span data-ttu-id="61af1-112">In Windows 10, Direct2D utilizza un minor numero di trame intermedie a causa dell'utilizzo del collegamento dello shader.</span><span class="sxs-lookup"><span data-stu-id="61af1-112">In Windows 10, Direct2D uses fewer intermediate textures due to its use of shader linking.</span></span> <span data-ttu-id="61af1-113">Direct2D può pertanto produrre risultati diversi con le impostazioni predefinite rispetto alle versioni precedenti di Windows.</span><span class="sxs-lookup"><span data-stu-id="61af1-113">Direct2D may therefore produce different results with default settings than in prior Windows releases.</span></span> <span data-ttu-id="61af1-114">Ciò influisce principalmente sugli scenari in cui è possibile il collegamento dello shader in un grafico effetto e tale grafico contiene anche gli effetti che producono colori di output con intervallo esteso.</span><span class="sxs-lookup"><span data-stu-id="61af1-114">This primarily affects scenarios where shader linking is possible in an effect graph, and that graph also contains effects that produce extended-range output colors.</span></span>

## <a name="overview-of-effect-rendering-and-intermediates"></a><span data-ttu-id="61af1-115">Panoramica del rendering degli effetti e dei intermedi</span><span class="sxs-lookup"><span data-stu-id="61af1-115">Overview of effect rendering and intermediates</span></span>

<span data-ttu-id="61af1-116">Per eseguire il rendering di un grafico effetto, Direct2D trova innanzitutto il grafico sottostante di "trasformazioni", dove una trasformazione è un nodo grafico utilizzato in un effetto.</span><span class="sxs-lookup"><span data-stu-id="61af1-116">To render an effect graph, Direct2D first finds the underlying graph of “transforms,” where a transform is a graph node used within an effect.</span></span> <span data-ttu-id="61af1-117">Sono disponibili tipi diversi di trasformazioni, inclusi quelli che forniscono Direct3D shader per Direct2D da usare.</span><span class="sxs-lookup"><span data-stu-id="61af1-117">There are different types of transforms, including those which provide Direct3D shaders for Direct2D to use.</span></span>

<span data-ttu-id="61af1-118">Ad esempio, Direct2D può eseguire il rendering di un grafico effetto come segue:</span><span class="sxs-lookup"><span data-stu-id="61af1-118">For example, Direct2D may render an effect graph as follows:</span></span>

![grafico effetto con trame intermedie](images/precision-and-clipping-1.png)

<span data-ttu-id="61af1-120">Direct2D Cerca le opportunità per ridurre il numero di trame intermedie usate per eseguire il rendering del grafico di effetto; Questa logica è opaca per le applicazioni.</span><span class="sxs-lookup"><span data-stu-id="61af1-120">Direct2D looks for opportunities to reduce the number intermediate textures used to render the effect graph; this logic is opaque to applications.</span></span> <span data-ttu-id="61af1-121">Il grafico seguente, ad esempio, può essere sottoposto a rendering tramite Direct2D usando una chiamata di disegno Direct3D e nessuna trama intermedia:</span><span class="sxs-lookup"><span data-stu-id="61af1-121">For example, the following graph can be rendered by Direct2D using one Direct3D draw call and no intermediate textures:</span></span>

![grafico effetto senza trame intermedie](images/precision-and-clipping-2.png)

<span data-ttu-id="61af1-123">Prima di Windows 10, Direct2D usava sempre le trame intermedie se venivano usati più pixel shader nello stesso grafico effetto.</span><span class="sxs-lookup"><span data-stu-id="61af1-123">Prior to Windows 10, Direct2D would always use intermediate textures if multiple pixels shaders were used within the same effect graph.</span></span> <span data-ttu-id="61af1-124">La maggior parte degli effetti predefiniti che regolano semplicemente i valori dei colori, ad esempio luminosità o saturazione, usano pixel shader.</span><span class="sxs-lookup"><span data-stu-id="61af1-124">Most built-in effects that simply adjust color values (for example, Brightness or Saturation) do so using pixel shaders.</span></span>

<span data-ttu-id="61af1-125">In Windows 10, Direct2D può ora evitare l'uso di trame intermedie in tali casi.</span><span class="sxs-lookup"><span data-stu-id="61af1-125">In Windows 10, Direct2D may now avoid using intermediate textures in such cases.</span></span> <span data-ttu-id="61af1-126">A tale scopo, collega internamente i pixel shader adiacenti.</span><span class="sxs-lookup"><span data-stu-id="61af1-126">It does this by internally linking adjacent pixel shaders.</span></span> <span data-ttu-id="61af1-127">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="61af1-127">For example:</span></span>

![grafico effetto Windows 10 con più pixel shader e nessuna trama intermedia](images/precision-and-clipping-3.png)

<span data-ttu-id="61af1-129">Si noti che non tutti i pixel shader adiacenti in un grafico possono essere collegati tra loro e, di conseguenza, solo determinati grafici produrranno output diversi in Windows 10.</span><span class="sxs-lookup"><span data-stu-id="61af1-129">Note that not all adjacent pixel shaders in a graph may be linked together, and therefore only certain graphs will produce different output on Windows 10.</span></span> <span data-ttu-id="61af1-130">Per i dettagli completi, vedere [Effect shader linking](effect-shader-linking.md).</span><span class="sxs-lookup"><span data-stu-id="61af1-130">For full details see [Effect Shader Linking](effect-shader-linking.md).</span></span> <span data-ttu-id="61af1-131">Le restrizioni principali sono:</span><span class="sxs-lookup"><span data-stu-id="61af1-131">The primary restrictions are:</span></span>

-   <span data-ttu-id="61af1-132">Un effetto non verrà collegato agli effetti che utilizzano l'output, se il primo effetto è connesso come input a più effetti.</span><span class="sxs-lookup"><span data-stu-id="61af1-132">An effect will not be linked with effects consuming its output, if the first effect is connected as an input to multiple effects.</span></span>
-   <span data-ttu-id="61af1-133">Un effetto non verrà collegato con un set di effetti come input, se il primo effetto esegue il campionamento dell'input in una posizione logica diversa rispetto all'output.</span><span class="sxs-lookup"><span data-stu-id="61af1-133">An effect will not be linked with an effect set as its input, if the first effect samples its input at a different logical position than its output.</span></span> <span data-ttu-id="61af1-134">Ad esempio, un effetto della matrice di colori potrebbe essere collegato al relativo input, ma un effetto di convoluzione non sarà.</span><span class="sxs-lookup"><span data-stu-id="61af1-134">For example, a Color Matrix effect might be linked with its input, but a Convolution effect will not be.</span></span>

## <a name="built-in-effect-behavior"></a><span data-ttu-id="61af1-135">Comportamento degli effetti predefiniti</span><span class="sxs-lookup"><span data-stu-id="61af1-135">Built-in effect behavior</span></span>

<span data-ttu-id="61af1-136">Molti effetti predefiniti possono produrre colori al di fuori dell' \[ intervallo compreso tra 0 e 1 \] nello spazio colore unpremultiplied, anche quando i relativi colori di input sono compresi in tale intervallo.</span><span class="sxs-lookup"><span data-stu-id="61af1-136">Many built-in effects may produce colors outside of the \[0, 1\] range in the unpremultiplied color space, even when their input colors are within that range.</span></span> <span data-ttu-id="61af1-137">Quando si verifica questo problema, questi colori possono essere soggetti a ritaglio numerico.</span><span class="sxs-lookup"><span data-stu-id="61af1-137">When this happens, such colors may be subject to numerical clipping.</span></span> <span data-ttu-id="61af1-138">Si noti che è importante considerare l'intervallo di colori nello spazio unpremultiplied, anche se gli effetti predefiniti producono in genere colori nello spazio premoltiplicato.</span><span class="sxs-lookup"><span data-stu-id="61af1-138">Note that it’s important to consider the color range in unpremultiplied space, even though built-in effects typically produce colors in premultiplied space.</span></span> <span data-ttu-id="61af1-139">Ciò garantisce che i colori rientrino nell'intervallo, anche se altri effetti li unpremultiply successivamente.</span><span class="sxs-lookup"><span data-stu-id="61af1-139">This ensures that colors stay within range, even if other effects subsequently unpremultiply them.</span></span>

<span data-ttu-id="61af1-140">Alcuni degli effetti che possono generare questi colori fuori intervallo offrono una proprietà "ClampOutput".</span><span class="sxs-lookup"><span data-stu-id="61af1-140">Some of the effects which may emit these out-of-range colors offer a “ClampOutput” property.</span></span> <span data-ttu-id="61af1-141">Tra queste sono incluse:</span><span class="sxs-lookup"><span data-stu-id="61af1-141">These include:</span></span>

-   [<span data-ttu-id="61af1-142">Matrice colori</span><span class="sxs-lookup"><span data-stu-id="61af1-142">Color Matrix</span></span>](color-matrix.md)
-   [<span data-ttu-id="61af1-143">Composizione aritmetica</span><span class="sxs-lookup"><span data-stu-id="61af1-143">Arithmetic Composite</span></span>](arithmetic-composite.md)
-   [<span data-ttu-id="61af1-144">Condensa</span><span class="sxs-lookup"><span data-stu-id="61af1-144">Convolve</span></span>](convolve-matrix.md)
-   [<span data-ttu-id="61af1-145">Effetti di trasferimento</span><span class="sxs-lookup"><span data-stu-id="61af1-145">Transfer effects</span></span>](built-in-effects.md)

<span data-ttu-id="61af1-146">L'impostazione della proprietà ClampOutput su TRUE per questi effetti garantisce che venga ottenuto un risultato coerente indipendentemente da fattori quali il collegamento dello shader.</span><span class="sxs-lookup"><span data-stu-id="61af1-146">Setting the ClampOutput property to TRUE on these effects ensures a consistent result will be achieved regardless of factors such as shader linking.</span></span> <span data-ttu-id="61af1-147">Si noti che la pressione si verifica nello spazio unpremultiplied.</span><span class="sxs-lookup"><span data-stu-id="61af1-147">Note that clamping occurs in unpremultiplied space.</span></span>

<span data-ttu-id="61af1-148">Altri effetti predefiniti possono anche produrre colori di output oltre l' \[ intervallo compreso tra 0 e 1 \] nello spazio unpremultiplied, anche quando i colori pixel (e le eventuali proprietà "color") sono compresi in tale intervallo.</span><span class="sxs-lookup"><span data-stu-id="61af1-148">Other built-in effects may also produce output colors beyond the \[0, 1\] range in unpremultiplied space, even when their colors pixels (and “Color” properties if any) are within that range.</span></span> <span data-ttu-id="61af1-149">Tra queste sono incluse:</span><span class="sxs-lookup"><span data-stu-id="61af1-149">These include:</span></span>

-   <span data-ttu-id="61af1-150">[Trasformazione e scalabilità degli effetti](built-in-effects.md) (quando la proprietà modalità di interpolazione è cubica o di alta qualità)</span><span class="sxs-lookup"><span data-stu-id="61af1-150">[Transforming and Scaling effects](built-in-effects.md) (When the Interpolation Mode property is Cubic or High Quality Cubic)</span></span>
-   [<span data-ttu-id="61af1-151">Effetti sull'illuminazione</span><span class="sxs-lookup"><span data-stu-id="61af1-151">Lighting effects</span></span>](built-in-effects.md)
-   <span data-ttu-id="61af1-152">[Rilevamento Edge](edge-detection-effect.md) (quando la proprietà bordi sovrapposti è true)</span><span class="sxs-lookup"><span data-stu-id="61af1-152">[Edge detection](edge-detection-effect.md) (When the Overlay Edges property is TRUE)</span></span>
-   [<span data-ttu-id="61af1-153">Esposizione</span><span class="sxs-lookup"><span data-stu-id="61af1-153">Exposure</span></span>](exposure-effect.md)
-   <span data-ttu-id="61af1-154">[Composite](composite.md) (quando la proprietà Mode è più)</span><span class="sxs-lookup"><span data-stu-id="61af1-154">[Composite](composite.md) (When the Mode property is Plus)</span></span>
-   [<span data-ttu-id="61af1-155">Temperatura e tinta</span><span class="sxs-lookup"><span data-stu-id="61af1-155">Temperature and Tint</span></span>](temperature-and-tint-effect.md)
-   [<span data-ttu-id="61af1-156">Seppia</span><span class="sxs-lookup"><span data-stu-id="61af1-156">Sepia</span></span>](sepia-effect.md)
-   [<span data-ttu-id="61af1-157">Saturazione</span><span class="sxs-lookup"><span data-stu-id="61af1-157">Saturation</span></span>](saturation.md)

## <a name="forcing-numerical-clipping-within-an-effect-graph"></a><span data-ttu-id="61af1-158">Forzare il ritaglio numerico in un grafico effetto</span><span class="sxs-lookup"><span data-stu-id="61af1-158">Forcing numerical clipping within an effect graph</span></span>

<span data-ttu-id="61af1-159">Quando si usano gli effetti elencati sopra che non dispongono di una proprietà ClampOutput, le applicazioni devono prendere in considerazione la forzatura della pressione numerica.</span><span class="sxs-lookup"><span data-stu-id="61af1-159">While using effects listed above which do not have a ClampOutput property, applications should consider forcing numerical clamping.</span></span> <span data-ttu-id="61af1-160">Questa operazione può essere eseguita inserendo un effetto aggiuntivo nel grafico che blocca i pixel.</span><span class="sxs-lookup"><span data-stu-id="61af1-160">This can be done by inserting an additional effect into the graph that clamps its pixels.</span></span> <span data-ttu-id="61af1-161">È possibile utilizzare un effetto matrice di colori, con la proprietà' ClampOutput ' impostata su TRUE e lasciando la proprietà' ColorMatrix ' come valore predefinito (pass-through).</span><span class="sxs-lookup"><span data-stu-id="61af1-161">A Color Matrix effect may be used, with its ‘ClampOutput’ property set to TRUE and leaving the ‘ColorMatrix’ property as the default (pass-through) value.</span></span>

<span data-ttu-id="61af1-162">Una seconda opzione per ottenere risultati coerenti consiste nel richiedere che Direct2D usi trame intermedie con maggiore precisione.</span><span class="sxs-lookup"><span data-stu-id="61af1-162">A second option to achieve consistent results is to request that Direct2D use intermediate textures which have greater precision.</span></span> <span data-ttu-id="61af1-163">Questa procedura è descritta di seguito.</span><span class="sxs-lookup"><span data-stu-id="61af1-163">This is described below.</span></span>

## <a name="controlling-precision-of-intermediate-textures"></a><span data-ttu-id="61af1-164">Controllo della precisione delle trame intermedie</span><span class="sxs-lookup"><span data-stu-id="61af1-164">Controlling precision of intermediate textures</span></span>

<span data-ttu-id="61af1-165">Direct2D fornisce alcuni modi per controllare la precisione di un grafico.</span><span class="sxs-lookup"><span data-stu-id="61af1-165">Direct2D provides a few ways to control the precision of a graph.</span></span> <span data-ttu-id="61af1-166">Prima di usare formati a precisione elevata in Direct2D, le applicazioni devono assicurarsi che siano supportate in modo sufficiente dalla GPU.</span><span class="sxs-lookup"><span data-stu-id="61af1-166">Before using high precision formats in Direct2D, applications must ensure they are supported sufficiently by the GPU.</span></span> <span data-ttu-id="61af1-167">Per verificarlo, usare [**ID2D1DeviceContext:: IsBufferPrecisionSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isbufferprecisionsupported).</span><span class="sxs-lookup"><span data-stu-id="61af1-167">To check this, use [**ID2D1DeviceContext::IsBufferPrecisionSupported**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-isbufferprecisionsupported).</span></span>

<span data-ttu-id="61af1-168">Le applicazioni possono creare un dispositivo Direct3D usando WARP (emulazione software) per garantire che tutte le precisioni del buffer siano supportate indipendentemente dall'hardware GPU effettivo sul dispositivo.</span><span class="sxs-lookup"><span data-stu-id="61af1-168">Applications may create a Direct3D device using WARP (software emulation) to guarantee that all buffer precisions are supported independent of the actual GPU hardware on the device.</span></span> <span data-ttu-id="61af1-169">Questa operazione è consigliata in scenari come l'applicazione di effetti a una foto durante il salvataggio su disco.</span><span class="sxs-lookup"><span data-stu-id="61af1-169">This is recommended in scenarios such as applying effects to a photo while saving to disk.</span></span> <span data-ttu-id="61af1-170">Anche se Direct2D supporta formati di buffer a precisione elevata sulla GPU, l'uso di WARP è consigliato in questo scenario sulle GPU a livello di funzionalità 9. X, a causa della precisione limitata dell'aritmetica e del campionamento di shader in alcune GPU mobili a basso consumo.</span><span class="sxs-lookup"><span data-stu-id="61af1-170">Even if Direct2D supports high precision buffer formats on the GPU, using WARP is recommended in this scenario on feature level 9.X GPUs, due to the limited precision of shader arithmetic and sampling on some low-power mobile GPUs.</span></span>

<span data-ttu-id="61af1-171">In ogni caso di seguito, la precisione richiesta è in realtà la precisione minima che verrà usata da Direct2D.</span><span class="sxs-lookup"><span data-stu-id="61af1-171">In each case below, the requested precision is actually the minimum precision Direct2D will use.</span></span> <span data-ttu-id="61af1-172">Se non sono necessari intermediari, è possibile utilizzare una precisione più elevata.</span><span class="sxs-lookup"><span data-stu-id="61af1-172">Higher precision may be used if intermediates are not required.</span></span> <span data-ttu-id="61af1-173">Direct2D può inoltre condividere trame intermedie per diverse parti dello stesso grafico o grafici diversi.</span><span class="sxs-lookup"><span data-stu-id="61af1-173">Direct2D may also share intermediate textures for different parts of the same graph or different graphs entirely.</span></span> <span data-ttu-id="61af1-174">In questo caso Direct2D usa la precisione massima richiesta per tutte le operazioni necessarie.</span><span class="sxs-lookup"><span data-stu-id="61af1-174">In this case Direct2D uses the maximum precision requested for all involved operations.</span></span>

### <a name="precision-selection-from-id2d1devicecontextsetrenderingcontrols"></a><span data-ttu-id="61af1-175">Selezione precisione da ID2D1DeviceContext:: SetRenderingControls</span><span class="sxs-lookup"><span data-stu-id="61af1-175">Precision selection from ID2D1DeviceContext::SetRenderingControls</span></span>

<span data-ttu-id="61af1-176">Il modo più semplice per controllare la precisione delle trame intermedie le convenzioni consiste nell'usare [**ID2D1DeviceContext:: SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls)).</span><span class="sxs-lookup"><span data-stu-id="61af1-176">The simplest way to control the precision of Direct2D’s intermediate textures is to use [**ID2D1DeviceContext::SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls)).</span></span> <span data-ttu-id="61af1-177">Consente di controllare la precisione di tutte le trame intermedie, purché una precisione non venga impostata manualmente su effetti o trasformazioni direttamente.</span><span class="sxs-lookup"><span data-stu-id="61af1-177">This controls the precision of all intermediate textures, as long as a precision is not also set manually on effects or transforms directly.</span></span>


```cpp
if (Device->IsBufferPrecisionSupported(D2D1_BUFFER_PRECISION_32BPC_FLOAT))
{
  // Get the current rendering controls
  D2D1_RENDERING_CONTROLS renderingControls = {};
  Context->GetRenderingControls(&renderingControls);

  // Switch the precision within the rendering controls and set it
  renderingControls.bufferPrecision = D2D1_BUFFER_PRECISION_32BPC_FLOAT;
  Context->SetRenderingControls(&renderingControls);
}
              
```



### <a name="precision-selection-from-inputs-and-render-targets"></a><span data-ttu-id="61af1-178">Selezione della precisione dagli input e dalle destinazioni di rendering</span><span class="sxs-lookup"><span data-stu-id="61af1-178">Precision selection from inputs and render targets</span></span>

<span data-ttu-id="61af1-179">Le applicazioni possono anche basarsi sulla precisione degli input in un grafico effetto per controllare la precisione delle trame intermedie.</span><span class="sxs-lookup"><span data-stu-id="61af1-179">Applications may also rely on the precision of the inputs to an effect graph to control the precision of intermediate textures.</span></span> <span data-ttu-id="61af1-180">Questa condizione è vera purché una precisione del buffer non venga specificata con [**ID2D1DeviceContext:: SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls))e non sia impostata manualmente su effetti e trasforma direttamente.</span><span class="sxs-lookup"><span data-stu-id="61af1-180">This is true as long as a buffer precision is not specified using [**ID2D1DeviceContext::SetRenderingControls**](/windows/win32/api/d2d1_1/nf-d2d1_1-id2d1devicecontext-setrenderingcontrols(constd2d1_rendering_controls)), and is not set manually on effects and transform directly.</span></span>

<span data-ttu-id="61af1-181">Le precisioni degli input agli effetti vengono propagate tramite il grafo per selezionare la precisione dei intermediari downstream.</span><span class="sxs-lookup"><span data-stu-id="61af1-181">The precisions of inputs to effects are propagated through the graph to select the precision of downstream intermediates.</span></span> <span data-ttu-id="61af1-182">Quando vengono soddisfatti rami diversi nel grafico degli effetti, viene usata la massima precisione di qualsiasi input.</span><span class="sxs-lookup"><span data-stu-id="61af1-182">Where different branches in the effect graph meet, the greatest precision of any input is used.</span></span>

<span data-ttu-id="61af1-183">La precisione selezionata in base a una bitmap Direct2D è determinata dal formato pixel.</span><span class="sxs-lookup"><span data-stu-id="61af1-183">The precision selected based on a Direct2D bitmap is determined from its pixel format.</span></span> <span data-ttu-id="61af1-184">La precisione selezionata per un [**ID2D1ImageSource**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesource) è determinata dal formato pixel WIC del IWICBitmapSource sottostante utilizzato per creare **ID2D1ImageSource**.</span><span class="sxs-lookup"><span data-stu-id="61af1-184">The precision selected for an [**ID2D1ImageSource**](/windows/win32/api/d2d1_3/nn-d2d1_3-id2d1imagesource) is determined from the WIC pixel format of the underlying IWICBitmapSource used to create the **ID2D1ImageSource**.</span></span> <span data-ttu-id="61af1-185">Si noti che Direct2D non consente la creazione di origini di immagini con origini WIC usando le precisioni non supportate da Direct2D e dalla GPU.</span><span class="sxs-lookup"><span data-stu-id="61af1-185">Note that Direct2D doesn’t allow image sources to be created with WIC sources using precisions unsupported by Direct2D and the GPU.</span></span>

<span data-ttu-id="61af1-186">È possibile che Direct2D non possa assegnare un effetto a una precisione in base ai relativi input.</span><span class="sxs-lookup"><span data-stu-id="61af1-186">It is possible that Direct2D cannot assign an effect a precision based on its inputs.</span></span> <span data-ttu-id="61af1-187">Ciò si verifica quando un effetto non ha input o quando viene usato un [**ID2D1CommandList**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1commandlist) , che non ha precisione specifica.</span><span class="sxs-lookup"><span data-stu-id="61af1-187">This happens when an effect has no inputs, or when an [**ID2D1CommandList**](/windows/win32/api/d2d1_1/nn-d2d1_1-id2d1commandlist) is used, which has no specific precision.</span></span> <span data-ttu-id="61af1-188">In questo caso, la precisione delle trame intermedie viene determinata dalla bitmap impostata come destinazione di rendering corrente del contesto.</span><span class="sxs-lookup"><span data-stu-id="61af1-188">In this case, the precision of intermediate textures is determined from the bitmap set as the context’s current render target.</span></span>

### <a name="precision-selection-directly-on-the-effect-and-transforms"></a><span data-ttu-id="61af1-189">Selezione di precisione direttamente sull'effetto e le trasformazioni</span><span class="sxs-lookup"><span data-stu-id="61af1-189">Precision selection directly on the effect and transforms</span></span>

<span data-ttu-id="61af1-190">La precisione minima per le trame intermedie può essere impostata anche in posizioni esplicite all'interno di un grafico effetto.</span><span class="sxs-lookup"><span data-stu-id="61af1-190">The minimum precision for intermediate textures may also be set at explicit locations within an effect graph.</span></span> <span data-ttu-id="61af1-191">Questa opzione è consigliata solo per scenari avanzati.</span><span class="sxs-lookup"><span data-stu-id="61af1-191">This is only recommended for advanced scenarios.</span></span>

<span data-ttu-id="61af1-192">La precisione minima può essere impostata utilizzando una proprietà in un effetto come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="61af1-192">The minimum precision may be set using a property on an effect as follows:</span></span>


```cpp
if (Device->IsBufferPrecisionSupported(D2D1_BUFFER_PRECISION_32BPC_FLOAT))
{
  hr = Effect->SetValue(D2D1_PROPERTY_PRECISION, D2D1_BUFFER_PRECISION_32BPC_FLOAT);
}
              
```



<span data-ttu-id="61af1-193">All'interno di un'implementazione di effetto, la precisione minima può essere impostata usando ID2D1RenderInfo:: SetOutputPrecision come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="61af1-193">Within an effect implementation, the minimum precision may be set using ID2D1RenderInfo::SetOutputPrecision as follows:</span></span>


```cpp
if (EffectContext->IsBufferPrecisionSupported(D2D1_BUFFER_PRECISION_32BPC_FLOAT))
{
  hr = RenderInfo->SetOutputBuffer(
  D2D1_BUFFER_PRECISION_32BPC_FLOAT,
  D2D1_CHANNEL_DEPTH_4);
}
              
```



<span data-ttu-id="61af1-194">Si noti che la precisione impostata su un effetto verrà propagata agli effetti downstream nello stesso grafico effetto, a meno che non venga impostata una precisione diversa per tali effetti downstream.</span><span class="sxs-lookup"><span data-stu-id="61af1-194">Note that the precision set on an effect will propagate to downstream effects in the same effect graph, unless a different precision is set on those downstream effects.</span></span> <span data-ttu-id="61af1-195">Il set di precisione in una trasformazione all'interno di un effetto non influisce sulla precisione per i nodi di trasformazione downstream.</span><span class="sxs-lookup"><span data-stu-id="61af1-195">The precision set on a transform within an effect does not affect the precision for downstream transform nodes.</span></span>

<span data-ttu-id="61af1-196">Di seguito è riportata la logica ricorsiva completa utilizzata per determinare la precisione minima per un buffer intermedio che archivia l'output di un nodo di trasformazione specificato:</span><span class="sxs-lookup"><span data-stu-id="61af1-196">Below is the full recursive logic used to determine the minimum precision for an intermediate buffer storing the output of a given transform node:</span></span>

![Logica minima di precisione del buffer intermedio](images/precision-and-clipping-4.png)

 

 