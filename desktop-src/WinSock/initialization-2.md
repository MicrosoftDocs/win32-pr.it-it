---
description: Il \_32.dll WS2 carica la dll di interfaccia del provider di servizi nel sistema utilizzando i meccanismi standard di caricamento della libreria dinamica di Microsoft Windows e la inizializza chiamando WSPStartup.
ms.assetid: 6df28d93-8757-45b3-8f05-86381c3be64e
title: Inizializzazione
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 84d6ef10db421ef15f2bb94eb67e96fc2cfc5924
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106306949"
---
# <a name="initialization"></a><span data-ttu-id="bd29e-103">Inizializzazione</span><span class="sxs-lookup"><span data-stu-id="bd29e-103">Initialization</span></span>

<span data-ttu-id="bd29e-104">Il *\_32.dllWS2* carica la dll di interfaccia del provider di servizi nel sistema utilizzando i meccanismi standard di caricamento della libreria dinamica di Microsoft Windows e la inizializza chiamando [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span><span class="sxs-lookup"><span data-stu-id="bd29e-104">The *Ws2\_32.dll* loads the service provider's interface DLL into the system by using the standard Microsoft Windows dynamic library loading mechanisms, and initializes it by calling [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span></span> <span data-ttu-id="bd29e-105">Questa operazione viene in genere attivata da un'applicazione che chiama [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) o [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) per creare un nuovo socket da associare a un provider di servizi la cui dll di interfaccia non è attualmente caricata in memoria.</span><span class="sxs-lookup"><span data-stu-id="bd29e-105">This is typically triggered by an application calling either [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) or [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) to create a new socket to be associated with a service provider whose interface DLL is not currently loaded into memory.</span></span> <span data-ttu-id="bd29e-106">Il percorso della DLL dell'interfaccia di ogni provider di servizi viene archiviato dal *Ws2 \_32.dll* al momento dell'installazione del provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="bd29e-106">The path to each service provider's interface DLL is stored by the *Ws2\_32.dll* at the time the service provider is being installed.</span></span> <span data-ttu-id="bd29e-107">Per ulteriori informazioni, vedere [funzioni di installazione e configurazione](installation-and-configuration-functions-2.md) .</span><span class="sxs-lookup"><span data-stu-id="bd29e-107">See [Installation and Configuration Functions](installation-and-configuration-functions-2.md) for more information.</span></span>

<span data-ttu-id="bd29e-108">Nel corso del tempo potrebbero esistere versioni diverse per le dll, le applicazioni e i provider di servizi Winsock.</span><span class="sxs-lookup"><span data-stu-id="bd29e-108">Over time, different versions may exist for the Winsock DLLs, applications, and service providers.</span></span> <span data-ttu-id="bd29e-109">Le nuove versioni possono definire nuove funzionalità e nuovi parametri per le strutture di dati e i parametri di bit e così via. I numeri di versione indicano pertanto come interpretare diverse strutture di dati.</span><span class="sxs-lookup"><span data-stu-id="bd29e-109">New versions may define new features and new parameters to data structures and bit parameters, etc. Version numbers therefore indicate how to interpret various data structures.</span></span>

<span data-ttu-id="bd29e-110">Per consentire la combinazione e la corrispondenza ottimali delle diverse versioni delle applicazioni, delle versioni di WS2 \_32.dll e delle versioni dei provider di servizi da parte di fornitori diversi, SPI fornisce un meccanismo di negoziazione della versione da utilizzare tra i *\_32.dllWS2* e i provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="bd29e-110">To allow optimal mixing and matching of different versions of applications, versions of the Ws2\_32.dll itself, and versions of service providers by different vendors, the SPI provides a version negotiation mechanism for use between the *Ws2\_32.dll* and the service providers.</span></span> <span data-ttu-id="bd29e-111">Questa negoziazione della versione viene gestita da [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span><span class="sxs-lookup"><span data-stu-id="bd29e-111">This version negotiation is handled by [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span></span> <span data-ttu-id="bd29e-112">Fondamentalmente, il *Ws2 \_32.dll* passa al provider di servizi i numeri di versione più elevati con cui è compatibile.</span><span class="sxs-lookup"><span data-stu-id="bd29e-112">Basically, the *Ws2\_32.dll* passes to the service provider the highest version numbers with which it is compatible.</span></span> <span data-ttu-id="bd29e-113">Il provider di servizi confronta questo oggetto con un intervallo di numeri di versione supportato.</span><span class="sxs-lookup"><span data-stu-id="bd29e-113">The service provider compares this with its own supported range of version numbers.</span></span> <span data-ttu-id="bd29e-114">Se questi intervalli si sovrappongono, il provider di servizi restituisce un valore all'interno della parte sovrapposta dell'intervallo come risultato della negoziazione.</span><span class="sxs-lookup"><span data-stu-id="bd29e-114">If these ranges overlap, the service provider returns a value within the overlapping portion of the range as the result of the negotiation.</span></span> <span data-ttu-id="bd29e-115">In genere, deve essere il valore massimo possibile.</span><span class="sxs-lookup"><span data-stu-id="bd29e-115">Usually, this should be the highest possible value.</span></span> <span data-ttu-id="bd29e-116">Se gli intervalli non si sovrappongono, le due entità sono incompatibili e la funzione restituisce un errore.</span><span class="sxs-lookup"><span data-stu-id="bd29e-116">If the ranges do not overlap, the two parties are incompatible and the function returns an error.</span></span>

<span data-ttu-id="bd29e-117">[**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) deve essere chiamato almeno una volta da ogni processo client e può essere chiamato più volte da WS2 \_32.dll o da altre entità.</span><span class="sxs-lookup"><span data-stu-id="bd29e-117">[**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) must be called at least once by each client process, and may be called multiple times by Ws2\_32.dll or other entities.</span></span> <span data-ttu-id="bd29e-118">Per ogni chiamata **WSPStartup** riuscita, è necessario chiamare un [**WSPCleanup**](/previous-versions/windows/hardware/network/ff566270(v=vs.85)) corrispondente.</span><span class="sxs-lookup"><span data-stu-id="bd29e-118">A matching [**WSPCleanup**](/previous-versions/windows/hardware/network/ff566270(v=vs.85)) must be called for each successful **WSPStartup** call.</span></span> <span data-ttu-id="bd29e-119">Il provider di servizi deve mantenere un conteggio dei riferimenti in base al processo.</span><span class="sxs-lookup"><span data-stu-id="bd29e-119">The service provider should maintain a reference count on a per-process basis.</span></span> <span data-ttu-id="bd29e-120">Per ogni chiamata a **WSPStartup** , il chiamante può specificare qualsiasi numero di versione supportato dalla dll SP.</span><span class="sxs-lookup"><span data-stu-id="bd29e-120">On each **WSPStartup** call, the caller may specify any version number supported by the SP DLL.</span></span>

<span data-ttu-id="bd29e-121">Un provider di servizi deve archiviare il puntatore alla tabella dispatch del client ricevuta come parametro [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) in base al processo.</span><span class="sxs-lookup"><span data-stu-id="bd29e-121">A service provider must store the pointer to the client's upcall dispatch table that is received as a [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) parameter on a per-process basis.</span></span> <span data-ttu-id="bd29e-122">Se un determinato processo chiama **WSPStartup** più volte, il provider di servizi deve utilizzare solo il puntatore alla tabella dispatch fornito più di recente.</span><span class="sxs-lookup"><span data-stu-id="bd29e-122">If a given process calls **WSPStartup** multiple times, the service provider must use only the most recently supplied dispatch table pointer.</span></span>

<span data-ttu-id="bd29e-123">Come parte del processo di inizializzazione del provider di servizi, WS2 \_32.dll recupera la tabella dispatch del provider di servizi tramite il parametro *lpProcTable* per ottenere punti di ingresso al resto delle funzioni SPI specificate in questo documento.</span><span class="sxs-lookup"><span data-stu-id="bd29e-123">As part of the service provider initialization process The Ws2\_32.dll retrieves the service provider's dispatch table through the *lpProcTable* parameter in order to obtain entry points to the rest of the SPI functions specified in this document.</span></span>

<span data-ttu-id="bd29e-124">L'utilizzo di una tabella dispatch (in contrapposizione ai normali meccanismi DLL per l'accesso ai punti di ingresso) svolge due finalità:</span><span class="sxs-lookup"><span data-stu-id="bd29e-124">Using a dispatch table (as opposed to the usual DLL mechanisms for accessing entry points) serves two purposes:</span></span>

-   <span data-ttu-id="bd29e-125">È più utile per la32.dll WS2, \_ in quanto è possibile effettuare una singola chiamata per individuare l'intero set di punti di ingresso.</span><span class="sxs-lookup"><span data-stu-id="bd29e-125">It is more convenient for the Ws2\_32.dll since a single call can be made to discover the entire set of entry points.</span></span>
-   <span data-ttu-id="bd29e-126">Consente ai provider di servizi su più livelli formati in catene di protocolli di funzionare in modo più efficiente.</span><span class="sxs-lookup"><span data-stu-id="bd29e-126">It enables layered service providers formed into protocol chains to operate more efficiently.</span></span>

## <a name="initializing-protocol-chains"></a><span data-ttu-id="bd29e-127">Inizializzazione di catene di protocollo</span><span class="sxs-lookup"><span data-stu-id="bd29e-127">Initializing Protocol Chains</span></span>

<span data-ttu-id="bd29e-128">Quando viene installata la struttura delle [**\_ informazioni di WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) per una catena di protocolli, viene specificato anche il percorso del primo provider a livelli nella catena.</span><span class="sxs-lookup"><span data-stu-id="bd29e-128">At the time the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure for a protocol chain is installed, the path to the first layered provider in the chain is also specified.</span></span> <span data-ttu-id="bd29e-129">Quando viene inizializzata una catena di protocolli, WS2 \_32.dll utilizza questo percorso per caricare la dll del provider e quindi richiama [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span><span class="sxs-lookup"><span data-stu-id="bd29e-129">When a protocol chain is initialized, the Ws2\_32.dll uses this path to load the provider DLL and then invokes [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup).</span></span> <span data-ttu-id="bd29e-130">Poiché **WSPStartup** include un puntatore alla struttura delle **\_ informazioni di WSAPROTOCOL** della catena come uno dei parametri, i provider sovrapposti possono determinare il tipo di catena in cui vengono inizializzate e l'identità del livello inferiore successivo nella catena.</span><span class="sxs-lookup"><span data-stu-id="bd29e-130">Since **WSPStartup** includes a pointer to the chain's **WSAPROTOCOL\_INFO** structure as one of its parameters, layered providers can determine what type of chain they are being initialized into, and the identity of the next lower layer in the chain.</span></span> <span data-ttu-id="bd29e-131">Un provider su più livelli caricherà a sua volta il provider del protocollo successivo nella catena e lo inizializza con una chiamata a **WSPStartup** e così via.</span><span class="sxs-lookup"><span data-stu-id="bd29e-131">A layered provider would then in turn load the next protocol provider in the chain and initialize it with a call to **WSPStartup**, and so forth.</span></span> <span data-ttu-id="bd29e-132">Ogni volta che il livello inferiore successivo è un altro provider a più livelli, nella chiamata **WSPStartup** è necessario fare riferimento alla struttura delle **\_ informazioni WSAPROTOCOL** della catena.</span><span class="sxs-lookup"><span data-stu-id="bd29e-132">Whenever the next lower layer is another layered provider, the chain's **WSAPROTOCOL\_INFO** structure must be referenced in the **WSPStartup** call.</span></span> <span data-ttu-id="bd29e-133">Quando il livello inferiore successivo è un protocollo di base (che indica la fine della catena), la struttura di **\_ informazioni WSAPROTOCOL** della catena non viene più propagata verso il basso.</span><span class="sxs-lookup"><span data-stu-id="bd29e-133">When the next lower layer is a base protocol (signifying the end of the chain), the chain's **WSAPROTOCOL\_INFO** structure is no longer propagated downward.</span></span> <span data-ttu-id="bd29e-134">Al contrario, il livello corrente deve fare riferimento a una struttura di **\_ informazioni WSAPROTOCOL** che corrisponde al protocollo che deve essere utilizzato dal provider di base.</span><span class="sxs-lookup"><span data-stu-id="bd29e-134">Instead, the current layer must reference a **WSAPROTOCOL\_INFO** structure that corresponds to the protocol that the base provider should use.</span></span> <span data-ttu-id="bd29e-135">Pertanto, il provider di base non ha alcun concetto di essere associato a una catena di protocolli.</span><span class="sxs-lookup"><span data-stu-id="bd29e-135">Thus, the base provider has no notion of being involved in a protocol chain.</span></span>

<span data-ttu-id="bd29e-136">La tabella dispatch fornita da un determinato provider a più livelli consente, in molti casi, di duplicare i punti di ingresso di un provider sottostante.</span><span class="sxs-lookup"><span data-stu-id="bd29e-136">The dispatch table provided by any given layered provider will, in many instances, duplicate the entry points of an underlying provider.</span></span> <span data-ttu-id="bd29e-137">Il provider su più livelli inserisce solo i propri punti di ingresso per le funzioni di cui è necessario essere direttamente in relazione.</span><span class="sxs-lookup"><span data-stu-id="bd29e-137">The layered provider would only insert its own entry points for functions that it needed to be directly involved in.</span></span> <span data-ttu-id="bd29e-138">Si noti, tuttavia, che è imperativo che un provider su più livelli non modifichi il contenuto della tabella di chiamata ricevuta durante la chiamata di [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) sul livello inferiore successivo in una catena di protocolli.</span><span class="sxs-lookup"><span data-stu-id="bd29e-138">Note, however, that it is imperative that a layered provider not modify the contents of the upcall table that it received when calling [**WSPStartup**](/windows/desktop/api/Ws2spi/nf-ws2spi-wspstartup) on the next lower layer in a protocol chain.</span></span> <span data-ttu-id="bd29e-139">Queste chiamate devono essere apportate direttamente alla DLL di Windows Sockets 2.</span><span class="sxs-lookup"><span data-stu-id="bd29e-139">These upcalls must be made directly to the Windows Sockets 2 DLL.</span></span>

 

 
