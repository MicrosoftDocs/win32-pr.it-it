---
description: La funzione WSAAccept consente a un'applicazione di ottenere informazioni sul chiamante, ad esempio l'identificatore del chiamante e la qualità del servizio, prima di decidere se accettare una richiesta di connessione in ingresso.
ms.assetid: 65883556-6890-4d0a-8c7f-c4ff68642caf
title: Configurazione della connessione e teardown
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f9c4ac1f32524d097e11825f8104eb41fee3c528
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106307007"
---
# <a name="connection-setup-and-teardown"></a><span data-ttu-id="64f0a-103">Configurazione della connessione e teardown</span><span class="sxs-lookup"><span data-stu-id="64f0a-103">Connection Setup and Teardown</span></span>

<span data-ttu-id="64f0a-104">La funzione [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) consente a un'applicazione di ottenere informazioni sul chiamante, ad esempio l'identificatore del chiamante e la qualità del servizio, prima di decidere se accettare una richiesta di connessione in ingresso.</span><span class="sxs-lookup"><span data-stu-id="64f0a-104">The [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) function lets an application obtain caller information such as caller identifier and Quality of Service before deciding whether to accept an incoming connection request.</span></span> <span data-ttu-id="64f0a-105">Questa operazione viene eseguita con un callback a una funzione di condizione fornita dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="64f0a-105">This is done with a callback to an application-supplied condition function.</span></span>

<span data-ttu-id="64f0a-106">I dati da utente a utente specificati dai parametri nella funzione [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) e la funzione Condition di [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) possono essere trasferiti al peer durante lo stabilimento della connessione, purché questa funzionalità sia supportata dal provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="64f0a-106">User-to-user data specified by parameters in the [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) function and the condition function of [**WSAAccept**](/windows/desktop/api/Winsock2/nf-winsock2-wsaaccept) can be transferred to the peer during connection establishment, provided this feature is supported by the service provider.</span></span>

<span data-ttu-id="64f0a-107">È anche possibile (per i protocolli che lo supportano) per scambiare dati utente tra gli endpoint al momento della connessione teardown.</span><span class="sxs-lookup"><span data-stu-id="64f0a-107">It is also possible (for protocols that support this) to exchange user data between the endpoints at connection teardown time.</span></span> <span data-ttu-id="64f0a-108">La fine che avvia teardown può chiamare la funzione [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) per indicare che non vengono inviati altri dati e per avviare la sequenza di teardown della connessione.</span><span class="sxs-lookup"><span data-stu-id="64f0a-108">The end that initiates the teardown can call the [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) function to indicate that no more data be sent and to initiate the connection teardown sequence.</span></span> <span data-ttu-id="64f0a-109">Per alcuni protocolli, parte di teardown è la consegna dei dati di disconnessione dall'iniziatore teardown.</span><span class="sxs-lookup"><span data-stu-id="64f0a-109">For certain protocols, part of teardown is the delivery of disconnect data from the teardown initiator.</span></span> <span data-ttu-id="64f0a-110">Dopo aver ricevuto l'avviso che l'estremità remota ha avviato teardown (in genere dall' \_ indicazione di chiusura FD), è possibile chiamare la funzione [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) per ricevere i dati di disconnessione, se presenti.</span><span class="sxs-lookup"><span data-stu-id="64f0a-110">After receiving notice that the remote end has initiated teardown (typically by the FD\_CLOSE indication), the [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) function can be called to receive the disconnect data, if any.</span></span>

<span data-ttu-id="64f0a-111">Per illustrare il modo in cui è possibile usare i dati di disconnessione, considerare lo scenario seguente.</span><span class="sxs-lookup"><span data-stu-id="64f0a-111">To illustrate how disconnect data can be used, consider the following scenario.</span></span> <span data-ttu-id="64f0a-112">La metà client di un'applicazione client/server è responsabile della terminazione di una connessione socket.</span><span class="sxs-lookup"><span data-stu-id="64f0a-112">The client half of a client/server application is responsible for terminating a socket connection.</span></span> <span data-ttu-id="64f0a-113">In coincidenza con la terminazione, fornisce (usando i dati di disconnessione) il numero totale di transazioni elaborate con il server.</span><span class="sxs-lookup"><span data-stu-id="64f0a-113">Coincident with the termination, it provides (using disconnect data) the total number of transactions it processed with the server.</span></span> <span data-ttu-id="64f0a-114">Il server a sua volta risponde con il totale cumulativo delle transazioni elaborate con tutti i client.</span><span class="sxs-lookup"><span data-stu-id="64f0a-114">The server in turn responds with the cumulative total of transactions that it has processed with all clients.</span></span> <span data-ttu-id="64f0a-115">La sequenza di chiamate e indicazioni potrebbe verificarsi come segue:</span><span class="sxs-lookup"><span data-stu-id="64f0a-115">The sequence of calls and indications might occur as follows:</span></span>

| <span data-ttu-id="64f0a-116">Lato client</span><span class="sxs-lookup"><span data-stu-id="64f0a-116">Client side</span></span>                                                                                                              | <span data-ttu-id="64f0a-117">Sul lato server</span><span class="sxs-lookup"><span data-stu-id="64f0a-117">Server side</span></span>                                                                                                                                                                                                                   |
|--------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="64f0a-118">(1) richiamare [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) per terminare la sessione e fornire il totale della transazione.</span><span class="sxs-lookup"><span data-stu-id="64f0a-118">(1) Invoke [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) to conclude session and supply transaction total.</span></span>            |                                                                                                                                                                                                                               |
|                                                                                                                          | <span data-ttu-id="64f0a-119">(2) ottenere FD \_ Close, [**ricezione**](/windows/desktop/api/winsock/nf-winsock-recv) con un valore restituito pari a zero oppure [WSAEDISCON nativo](windows-sockets-error-codes-2.md) error return from [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) che indica un normale arresto in corso.</span><span class="sxs-lookup"><span data-stu-id="64f0a-119">(2) Get FD\_CLOSE, [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) with a return value of zero, or [WSAEDISCON](windows-sockets-error-codes-2.md) error return from [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) indicating graceful shutdown in progress.</span></span> |
|                                                                                                                          | <span data-ttu-id="64f0a-120">(3) richiamare [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) per ottenere il totale della transazione del client.</span><span class="sxs-lookup"><span data-stu-id="64f0a-120">(3) Invoke [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) to get client's transaction total.</span></span>                                                                                                                                |
|                                                                                                                          | <span data-ttu-id="64f0a-121">(4) calcolo del totale complessivo cumulativo di tutte le transazioni.</span><span class="sxs-lookup"><span data-stu-id="64f0a-121">(4) Compute cumulative grand total of all transactions.</span></span>                                                                                                                                                                       |
|                                                                                                                          | <span data-ttu-id="64f0a-122">(5) richiamare [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) per trasmettere il totale complessivo.</span><span class="sxs-lookup"><span data-stu-id="64f0a-122">(5) Invoke [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) to transmit grand total.</span></span>                                                                                                                                          |
| <span data-ttu-id="64f0a-123">(6) ricevere l' \_ indicazione di chiusura FD.</span><span class="sxs-lookup"><span data-stu-id="64f0a-123">(6) Receive FD\_CLOSE indication.</span></span>                                                                                        | <span data-ttu-id="64f0a-124">(5a) richiamare [**chiamata closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span><span class="sxs-lookup"><span data-stu-id="64f0a-124">(5a) Invoke [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span>                                                                                                                                                                             |
| <span data-ttu-id="64f0a-125">(7) richiamare [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) per ricevere e archiviare il totale complessivo di transazioni cumulative.</span><span class="sxs-lookup"><span data-stu-id="64f0a-125">(7) Invoke [**WSARecvDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvdisconnect) to receive and store cumulative grand total of transactions.</span></span> |                                                                                                                                                                                                                               |
| <span data-ttu-id="64f0a-126">(8) richiamare [ **chiamata closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)</span><span class="sxs-lookup"><span data-stu-id="64f0a-126">(8) Invoke [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket)</span></span>                                                                          |                                                                                                                                                                                                                               |



 

<span data-ttu-id="64f0a-127">Si noti che Step (5a) deve seguire step (5), ma non ha alcuna relazione temporale con STEP (6), (7) o (8).</span><span class="sxs-lookup"><span data-stu-id="64f0a-127">Note that step (5a) must follow step (5), but has no timing relationship with step (6), (7), or (8).</span></span>

 

 



