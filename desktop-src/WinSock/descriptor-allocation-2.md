---
description: Sebbene i provider di servizi Windows Sockets siano invitati a implementare i socket come oggetti installabili file system (IFS), l'architettura Winsock consente inoltre di gestire i provider di servizi i cui handle di socket non sono oggetti IFS.
ms.assetid: ed5e10f4-fa17-4a07-9cac-43767915b8e9
title: Allocazione descrittore
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 095301798eb850fc4eb63e1939712379b5ead85e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106306998"
---
# <a name="descriptor-allocation"></a><span data-ttu-id="f8a2c-103">Allocazione descrittore</span><span class="sxs-lookup"><span data-stu-id="f8a2c-103">Descriptor Allocation</span></span>

<span data-ttu-id="f8a2c-104">Sebbene i provider di servizi Windows Sockets siano invitati a implementare i socket come oggetti installabili file system (IFS), l'architettura Winsock consente inoltre di gestire i provider di servizi i cui handle di socket non sono oggetti IFS.</span><span class="sxs-lookup"><span data-stu-id="f8a2c-104">While Windows Sockets service providers are encouraged to implement sockets as installable file system (IFS) objects, the Winsock architecture also accommodates service providers whose socket handles are not IFS objects.</span></span> <span data-ttu-id="f8a2c-105">I provider con handle IFS indicano questo problema tramite il \_ bit dell'attributo XP1 IFS \_ Handles nella struttura delle [**\_ informazioni di WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) .</span><span class="sxs-lookup"><span data-stu-id="f8a2c-105">Providers with IFS handles indicate this through the XP1\_IFS\_HANDLES attribute bit in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure.</span></span> <span data-ttu-id="f8a2c-106">(Nota: XP1 \_ Il \_ bit dell'attributo di gestione IFS non è stato incluso nella versione 2.0.8 della specifica dell'API, ma è stato aggiunto dal meccanismo degli errori. I client Winsock SPI possono sfruttare i provider i cui descrittori di socket sono handle IFS usando questi descrittori con le funzionalità di I/O standard di Windows, ad esempio [ReadFile](/windows/win32/api/fileapi/nf-fileapi-readfile) e [WriteFile](/windows/win32/api/fileapi/nf-fileapi-writefile).</span><span class="sxs-lookup"><span data-stu-id="f8a2c-106">(Note: the XP1\_IFS\_HANDLES attribute bit was not included in release 2.0.8 of the API specification, but has since been added through the errata mechanism.) Winsock SPI clients may take advantage of providers whose socket descriptors are IFS handles by using these descriptors with standard Windows I/O facilities, such as [ReadFile](/windows/win32/api/fileapi/nf-fileapi-readfile) and [WriteFile](/windows/win32/api/fileapi/nf-fileapi-writefile).</span></span>

<span data-ttu-id="f8a2c-107">Ogni volta che un provider IFS crea un nuovo descrittore di socket, è obbligatorio che il provider chiami [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle) prima di fornire il nuovo handle a un client Windows Sockets SPI.</span><span class="sxs-lookup"><span data-stu-id="f8a2c-107">Whenever an IFS provider creates a new socket descriptor, it is mandatory that the provider call [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle) prior to supplying the new handle to a Windows Sockets SPI client.</span></span> <span data-ttu-id="f8a2c-108">Questa funzione accetta un identificatore del provider e un handle IFS proposto dal provider come input e restituisce un handle (possibilmente) modificato.</span><span class="sxs-lookup"><span data-stu-id="f8a2c-108">This function takes a provider identifier and a proposed IFS handle from the provider as input and returns a (possibly) modified handle.</span></span> <span data-ttu-id="f8a2c-109">Il provider IFS deve fornire solo l'handle modificato per il client e tutte le richieste dal client faranno riferimento solo a questo handle modificato.</span><span class="sxs-lookup"><span data-stu-id="f8a2c-109">The IFS provider must supply only the modified handle to its client, and all requests from the client will reference only this modified handle.</span></span> <span data-ttu-id="f8a2c-110">L'handle modificato è sicuramente indistinguibile dall'handle proposto per quanto riguarda il sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="f8a2c-110">The modified handle is guaranteed to be indistinguishable from the proposed handle as far as the operating system is concerned.</span></span> <span data-ttu-id="f8a2c-111">Nella maggior parte dei casi, pertanto, il provider di servizi sceglierà semplicemente di utilizzare solo l'handle modificato in tutta l'elaborazione interna.</span><span class="sxs-lookup"><span data-stu-id="f8a2c-111">Thus in most instances, the service provider will simply choose to use only the modified handle in all of its internal processing.</span></span> <span data-ttu-id="f8a2c-112">Lo scopo di questa funzione di modifica consiste nel consentire all' \_32.dll WS2 di semplificare significativamente il processo di identificazione del provider di servizi associato a un socket specificato.</span><span class="sxs-lookup"><span data-stu-id="f8a2c-112">The purpose of this modification function is to allow the Ws2\_32.dll to greatly streamline the process of identifying the service provider associated with a given socket.</span></span>

<span data-ttu-id="f8a2c-113">I provider che non restituiscono handle IFS devono ottenere un handle valido da WS2 \_32.dll tramite la chiamata [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) .</span><span class="sxs-lookup"><span data-stu-id="f8a2c-113">Providers that do not return IFS handles must obtain a valid handle from the Ws2\_32.dll via the [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) call.</span></span> <span data-ttu-id="f8a2c-114">Il provider nonIFS deve offrire al client solo un handle di Windows Sockets 2.DLL fornito e tutte le richieste dal client faranno riferimento solo a questi handle.</span><span class="sxs-lookup"><span data-stu-id="f8a2c-114">The nonIFS provider must offer only a Windows Sockets 2.DLL-supplied handle to its client, and all requests from the client will reference only these handles.</span></span> <span data-ttu-id="f8a2c-115">Per praticità degli implementatori del provider di servizi, uno dei parametri di input forniti da un provider in **WPUCreateSocketHandle** è un valore di contesto DWORD.</span><span class="sxs-lookup"><span data-stu-id="f8a2c-115">As a convenience to service provider implementers, one of the input parameters supplied by a provider in **WPUCreateSocketHandle** is a DWORD context value.</span></span> <span data-ttu-id="f8a2c-116">WS2 \_32.dll associa questo valore di contesto all'handle del socket allocato e consente a un provider di servizi di recuperare il valore di contesto in qualsiasi momento tramite la chiamata [**WPUQuerySocketHandleContext**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuquerysockethandlecontext) .</span><span class="sxs-lookup"><span data-stu-id="f8a2c-116">The Ws2\_32.dll associates this context value with the allocated socket handle and allows a service provider to retrieve the context value at any time through the [**WPUQuerySocketHandleContext**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuquerysockethandlecontext) call.</span></span> <span data-ttu-id="f8a2c-117">Un utilizzo tipico di questo valore di contesto consiste nell'archiviare un puntatore a una struttura di dati gestita del provider di servizi utilizzata per archiviare le informazioni sullo stato del socket.</span><span class="sxs-lookup"><span data-stu-id="f8a2c-117">A typical use for this context value would be to store a pointer to a service provider maintained data structure used to store socket state information.</span></span>

 

 
