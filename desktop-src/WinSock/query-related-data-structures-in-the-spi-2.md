---
description: La struttura WSAQUERYSET viene utilizzata per creare query per la funzione NSPLookupServiceBegin e per recapitare i risultati della query per la funzione NSPLookupServiceNext.
ms.assetid: 017b5828-bc6e-42b7-aba7-21648b2dd707
title: Query-Related le strutture dei dati in SPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57ce5a7016bd2ad96f464137177036b470c64a95
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104554976"
---
# <a name="query-related-data-structures-in-the-spi"></a><span data-ttu-id="ba0f5-103">Query-Related le strutture dei dati in SPI</span><span class="sxs-lookup"><span data-stu-id="ba0f5-103">Query-Related Data Structures in the SPI</span></span>

<span data-ttu-id="ba0f5-104">La struttura [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) viene utilizzata per creare query per [**NSPLookupServiceBegin**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicebegin)e per recapitare i risultati delle query per [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span><span class="sxs-lookup"><span data-stu-id="ba0f5-104">The [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure is used to form queries for [**NSPLookupServiceBegin**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicebegin), and used to deliver query results for [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span></span> <span data-ttu-id="ba0f5-105">Si tratta di una struttura complessa perché contiene puntatori a diverse altre strutture, alcune delle quali fanno riferimento ancora ad altre strutture.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-105">It is a complex structure because it contains pointers to several other structures, some of which reference still other structures.</span></span> <span data-ttu-id="ba0f5-106">La relazione tra **WSAQUERYSET** e le strutture a cui fa riferimento è illustrata di seguito:</span><span class="sxs-lookup"><span data-stu-id="ba0f5-106">The relationship between **WSAQUERYSET** and the structures it references is illustrated as follows:</span></span>

![strutture WSAQUERYSET](images/ovrvw3-2.png)

<span data-ttu-id="ba0f5-108">All'interno della struttura [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) , la maggior parte dei membri è autonoma, ma alcuni meritano una spiegazione aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-108">Within the [**WSAQUERYSET**](/windows/desktop/api/Winsock2/ns-winsock2-wsaquerysetw) structure, most of the members are self explanatory, but some deserve additional explanation.</span></span> <span data-ttu-id="ba0f5-109">**DwSize** verrà compilato con sizeof ( **WSAQUERYSET**) e potrà essere usato dai provider dello spazio dei nomi per rilevare e adattare a versioni diverse della struttura **WSAQUERYSET** che possono essere visualizzate.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-109">The **dwSize** will be filled in with sizeof( **WSAQUERYSET**), and can be used by namespace providers to detect and adapt to different versions of the **WSAQUERYSET** structure that may appear.</span></span>

<span data-ttu-id="ba0f5-110">Il membro **dwOutputFlags** viene utilizzato da un provider dello spazio dei nomi per fornire dati aggiuntivi sui risultati della query.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-110">The **dwOutputFlags** member is used by a namespace provider to provide additional data about query results.</span></span> <span data-ttu-id="ba0f5-111">Per ulteriori informazioni, vedere [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span><span class="sxs-lookup"><span data-stu-id="ba0f5-111">For more information, see [**NSPLookupServiceNext**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpnsplookupservicenext).</span></span>

<span data-ttu-id="ba0f5-112">La struttura [**WSAECOMPARATOR**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator) a cui fa riferimento **lpVersion** viene usata sia per il vincolo di query che per i risultati.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-112">The [**WSAECOMPARATOR**](/windows/desktop/api/Winsock2/ne-winsock2-wsaecomparator) structure referenced by **lpversion** is used for both query constraint and results.</span></span> <span data-ttu-id="ba0f5-113">Per le query, il membro **dwVersion** indica la versione desiderata del servizio.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-113">For queries, the **dwVersion** member indicates the desired version of the service.</span></span> <span data-ttu-id="ba0f5-114">Il membro **ecHow** è un tipo enumerato che specifica come verrà eseguito il confronto.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-114">The **ecHow** member is an enumerated type which specifies how the comparison will be made.</span></span> <span data-ttu-id="ba0f5-115">Le scelte sono COMP \_ Equals, che richiede una corrispondenza esatta nella versione, oppure comp \_ NOTLESS, che specifica che il numero di versione del servizio non deve essere inferiore al valore di **dwVersion**.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-115">The choices are COMP\_EQUALS which requires that an exact match in version occurs, or COMP\_NOTLESS which specifies that the service's version number be no less than the value of **dwVersion**.</span></span>

<span data-ttu-id="ba0f5-116">L'interpretazione di **dwNameSpace** e **lpNSProviderId** dipende dal modo in cui viene utilizzata la struttura e viene descritta ulteriormente nelle singole descrizioni di funzioni che utilizzano questa struttura.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-116">The interpretation of **dwNameSpace** and **lpNSProviderId** depends upon how the structure is being used and is described further in the individual function descriptions that utilize this structure.</span></span>

<span data-ttu-id="ba0f5-117">Il membro **lpszContext** si applica agli spazi dei nomi gerarchici e specifica il punto iniziale di una query o la posizione all'interno della gerarchia in cui risiede il servizio.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-117">The **lpszContext** member applies to hierarchical namespaces, and specifies the starting point of a query or the location within the hierarchy where the service resides.</span></span> <span data-ttu-id="ba0f5-118">Le regole generali sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="ba0f5-118">The general rules are:</span></span>

-   <span data-ttu-id="ba0f5-119">Il valore **null**, Blank ("") avvierà la ricerca nel contesto predefinito.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-119">A value of **NULL**, blank ("") will start the search at the default context.</span></span>
-   <span data-ttu-id="ba0f5-120">Il valore " \\ " avvia la ricerca nella parte superiore dello spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-120">A value of "\\" starts the search at the top of the namespace.</span></span>
-   <span data-ttu-id="ba0f5-121">Qualsiasi altro valore avvia la ricerca nel punto designato.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-121">Any other value starts the search at the designated point.</span></span>

<span data-ttu-id="ba0f5-122">I provider che non supportano containment possono restituire un errore se è specificato un valore diverso da "" o " \\ ".</span><span class="sxs-lookup"><span data-stu-id="ba0f5-122">Providers that do not support containment may return an error if anything other than "" or "\\" is specified.</span></span> <span data-ttu-id="ba0f5-123">I provider che supportano il contenimento limitato, ad esempio i gruppi, devono accettare "", " \\ " o un punto designato.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-123">Providers that support limited containment, such as groups, should accept "", '\\", or a designated point.</span></span> <span data-ttu-id="ba0f5-124">I contesti sono specifici dello spazio dei nomi.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-124">Contexts are namespace specific.</span></span> <span data-ttu-id="ba0f5-125">Se **dwNameSpace** è NS \_ All, solo "" o " \\ " devono essere passati come contesto perché sono riconosciuti da tutti gli spazi dei nomi.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-125">If **dwNameSpace** is NS\_ALL, then only "" or "\\" should be passed as the context because these are recognized by all namespaces.</span></span>

<span data-ttu-id="ba0f5-126">Il membro **lpszQueryString** viene utilizzato per fornire informazioni aggiuntive sulle query specifiche dello spazio dei nomi, ad esempio una stringa che descrive un nome di protocollo di trasporto e di servizio noto, come in "FTP/TCP".</span><span class="sxs-lookup"><span data-stu-id="ba0f5-126">The **lpszQueryString** member is used to supply additional, namespace-specific query information such as a string describing a well-known service and transport protocol name, as in "ftp/tcp".</span></span>

<span data-ttu-id="ba0f5-127">La struttura [**AFPROTOCOLS**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols) a cui fa riferimento **lpafpProtocols** viene utilizzata solo a scopo di query e fornisce un elenco di protocolli per vincolare la query.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-127">The [**AFPROTOCOLS**](/windows/desktop/api/Winsock2/ns-winsock2-afprotocols) structure referenced by **lpafpProtocols** is used for query purposes only, and supplies a list of protocols to constrain the query.</span></span> <span data-ttu-id="ba0f5-128">Questi protocolli sono rappresentati come coppie (famiglia di indirizzi, protocollo), perché i valori del protocollo hanno un significato solo nel contesto di una famiglia di indirizzi.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-128">These protocols are represented as (address family, protocol) pairs, because protocol values only have meaning within the context of an address family.</span></span>

<span data-ttu-id="ba0f5-129">La matrice della struttura di [**\_ informazioni CSADDR**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) a cui fa riferimento **lpcsaBuffer** contiene tutte le informazioni necessarie per un servizio da usare per stabilire un ascolto o un client da usare per stabilire una connessione al servizio.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-129">The array of [**CSADDR\_INFO**](/windows/win32/api/ws2def/ns-ws2def-csaddr_info) structure referenced by **lpcsaBuffer** contains all of the information required for either a service to use in establishing a listen, or a client to use in establishing a connection to the service.</span></span> <span data-ttu-id="ba0f5-130">I membri **LocalAddr** e **IndirizzoRemoto** contengono entrambi direttamente una struttura di [**\_ indirizzi del socket**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address) .</span><span class="sxs-lookup"><span data-stu-id="ba0f5-130">The **LocalAddr** and **RemoteAddr** members both directly contain a [**SOCKET\_ADDRESS**](/windows/desktop/api/Ws2def/ns-ws2def-socket_address) structure.</span></span> <span data-ttu-id="ba0f5-131">Un servizio creerebbe un socket usando la tupla (LocalAddr. lpSockaddr->\_ gruppo SA, iSocketType, iProtocol).</span><span class="sxs-lookup"><span data-stu-id="ba0f5-131">A service would create a socket using the tuple (LocalAddr.lpSockaddr->sa\_family, iSocketType, iProtocol).</span></span> <span data-ttu-id="ba0f5-132">Il socket viene associato a un indirizzo locale usando LocalAddr. lpSockaddr e LocalAddr. lpSockaddrLength.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-132">It would bind the socket to a local address using LocalAddr.lpSockaddr, and LocalAddr.lpSockaddrLength.</span></span> <span data-ttu-id="ba0f5-133">Il client crea il relativo socket con la tupla (IndirizzoRemoto. lpSockaddr->\_ gruppo SA, iSocketType, iProtocol) e usa la combinazione di IndirizzoRemoto. lpSockaddr e IndirizzoRemoto. lpSockaddrLength quando si effettua una connessione remota.</span><span class="sxs-lookup"><span data-stu-id="ba0f5-133">The client creates its socket with the tuple (RemoteAddr.lpSockaddr->sa\_family, iSocketType, iProtocol), and uses the combination of RemoteAddr.lpSockaddr, and RemoteAddr.lpSockaddrLength when making a remote connection.</span></span>

 

 
