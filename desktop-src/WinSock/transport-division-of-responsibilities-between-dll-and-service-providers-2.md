---
description: In questa sezione viene fornita una panoramica della divisione di responsabilità tra il \_32.dll WS2 e i provider di servizi di trasporto.
ms.assetid: e1ea1e99-a2bc-4e76-91f6-e388c39dfbbb
title: Divisione del trasporto delle responsabilità tra i provider di servizi e DLL
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 142ac98c95e95c310c2eefb7bfdaf1f70a03bf28
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106315764"
---
# <a name="transport-division-of-responsibilities-between-dll-and-service-providers"></a><span data-ttu-id="679ee-103">Divisione del trasporto delle responsabilità tra i provider di servizi e DLL</span><span class="sxs-lookup"><span data-stu-id="679ee-103">Transport Division of Responsibilities Between DLL and Service Providers</span></span>

<span data-ttu-id="679ee-104">In questa sezione viene fornita una panoramica della divisione di responsabilità tra il \_32.dll WS2 e i provider di servizi di trasporto.</span><span class="sxs-lookup"><span data-stu-id="679ee-104">This section provides an overview of the division of responsibility between the Ws2\_32.dll and transport service providers.</span></span>

## <a name="ws2_32dll-functionality-for-transport"></a><span data-ttu-id="679ee-105">WS2 \_32.dll funzionalità per il trasporto</span><span class="sxs-lookup"><span data-stu-id="679ee-105">Ws2\_32.dll Functionality for Transport</span></span>

<span data-ttu-id="679ee-106">L'attività principale della parte relativa al trasporto di dati del \_32.dll WS2 è quella di fungere da Gestione traffico tra i provider di servizi e le applicazioni.</span><span class="sxs-lookup"><span data-stu-id="679ee-106">The major task of the data transport portion of the Ws2\_32.dll is to serve as traffic manager between service providers and applications.</span></span> <span data-ttu-id="679ee-107">Con molti provider di servizi diversi che interagiscono con la stessa applicazione, ogni provider di servizi interagisce rigorosamente con la32.dll di WS2 \_ .</span><span class="sxs-lookup"><span data-stu-id="679ee-107">With several different service providers interacting with the same application, each service provider interacts strictly with the Ws2\_32.dll.</span></span> <span data-ttu-id="679ee-108">La DLL si occupa di:</span><span class="sxs-lookup"><span data-stu-id="679ee-108">The DLL takes care of:</span></span>

-   <span data-ttu-id="679ee-109">Selezione di un provider di servizi appropriato per la creazione di socket in base a una descrizione del protocollo.</span><span class="sxs-lookup"><span data-stu-id="679ee-109">Selecting an appropriate service provider for creating sockets based on a protocol description.</span></span>
-   <span data-ttu-id="679ee-110">L'invio di chiamate di procedure dell'applicazione che coinvolgono un socket al provider di servizi appropriato che ha creato o controlla tale socket.</span><span class="sxs-lookup"><span data-stu-id="679ee-110">Forwarding application procedure calls involving a socket to the appropriate service provider that created or controls that socket.</span></span> <span data-ttu-id="679ee-111">I provider di servizi non sono consapevoli di ciò che si sta verificando.</span><span class="sxs-lookup"><span data-stu-id="679ee-111">Service providers are unaware that any of this is happening.</span></span>

<span data-ttu-id="679ee-112">Non è necessario preoccuparsi dei dettagli della cooperabilità tra loro o anche dell'esistenza di altri provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="679ee-112">They do not need to be concerned about the details of cooperating with one another or even the existence of other service providers.</span></span> <span data-ttu-id="679ee-113">Astrarre i provider di servizi in un'interfaccia DLL coerente ed eseguendo questa funzione di routing automatico del traffico, il \_32.dll WS2 consente alle applicazioni di interagire con diversi provider senza richiedere che le applicazioni siano in grado di riconoscere le divisioni tra i provider, in cui sono installati provider diversi.</span><span class="sxs-lookup"><span data-stu-id="679ee-113">By abstracting the service providers into a consistent DLL interface and performing this automatic traffic routing function, the Ws2\_32.dll allows applications to interact with a variety of providers without requiring the applications to be aware of the divisions between providers, where different providers are installed.</span></span>

<span data-ttu-id="679ee-114">Il \_32.dll WS2 si basa sui parametri delle funzioni di creazione socket API ( [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) e [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa)) per determinare il provider di servizi da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="679ee-114">The Ws2\_32.dll relies on the parameters of the API socket creation functions ( [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) and [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa)) to determine which service provider to utilize.</span></span> <span data-ttu-id="679ee-115">Il provider del servizio di trasporto selezionato verrà richiamato tramite la funzione [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) .</span><span class="sxs-lookup"><span data-stu-id="679ee-115">The selected transport service provider will be invoked through the [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) function.</span></span> <span data-ttu-id="679ee-116">Nel caso della funzione **socket** , il WS2 \_32.dll trova la prima voce nel set di strutture di [**\_ informazioni WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) installate che corrisponde ai valori specificati nella tupla formata dai parametri (*famiglia di indirizzi*, *tipo di socket*, *protocollo*).</span><span class="sxs-lookup"><span data-stu-id="679ee-116">In the case of the **socket** function, the Ws2\_32.dll finds the first entry in the set of installed [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structures that matches the values supplied in the tuple formed by the (*address family*, *socket type*, *protocol*) parameters.</span></span> <span data-ttu-id="679ee-117">Per mantenere la compatibilità con le versioni precedenti, WS2 \_32.dll considera il valore zero per la *famiglia di indirizzi* o il *tipo di socket* come valore jolly.</span><span class="sxs-lookup"><span data-stu-id="679ee-117">To preserve backward compatibility, the Ws2\_32.dll treats the value of zero for either *address family* or *socket type* as a wildcard value.</span></span> <span data-ttu-id="679ee-118">Il valore zero per il protocollo non è considerato un valore con caratteri jolly da WS2 \_32.dll a meno che tale comportamento non sia indicato per un particolare protocollo, in quanto il valore PFL \_ corrisponde al \_ flag zero del protocollo \_ nella struttura delle **\_ informazioni di WSAPROTOCOL** .</span><span class="sxs-lookup"><span data-stu-id="679ee-118">The value of zero for protocol is not considered a wildcard value by the Ws2\_32.dll unless such behavior is indicated for a particular protocol by having the PFL\_MATCHES\_PROTOCOL\_ZERO flag set in the **WSAPROTOCOL\_INFO** structure.</span></span>

<span data-ttu-id="679ee-119">Per la funzione [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) , se viene specificato null per *lpProtocolInfo*, il comportamento è esattamente come descritto solo per [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket).</span><span class="sxs-lookup"><span data-stu-id="679ee-119">For the [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) function, if null is supplied for *lpProtocolInfo*, the behavior is exactly as just described for [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket).</span></span> <span data-ttu-id="679ee-120">Se si fa riferimento a una struttura di [**\_ informazioni di WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) , tuttavia, la32.dll WS2 non \_ esegue alcuna funzione corrispondente ma inoltra immediatamente la richiesta di creazione del socket al provider del servizio di trasporto associato alla struttura di **\_ informazioni WSAPROTOCOL** indicata.</span><span class="sxs-lookup"><span data-stu-id="679ee-120">If a [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure is referenced, however, the Ws2\_32.dll does not perform any matching function but immediately relays the socket creation request to the transport service provider associated with the indicated **WSAPROTOCOL\_INFO** structure.</span></span> <span data-ttu-id="679ee-121">I valori per la tupla (*famiglia di indirizzi,* *tipo di socket*) vengono forniti intatti al provider di servizi nella funzione [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) .</span><span class="sxs-lookup"><span data-stu-id="679ee-121">The values for the (*address family,* *socket type,*) tuple are supplied intact to the service provider in the [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) function.</span></span> <span data-ttu-id="679ee-122">I provider di servizi possono ignorare o prestare attenzione ai valori dei parametri (*famiglia di indirizzi,* *tipo di socket*), come appropriato, ma non devono indicare una condizione di errore quando il valore della famiglia di *indirizzi* o del *tipo di socket* è zero.</span><span class="sxs-lookup"><span data-stu-id="679ee-122">Service providers are free to ignore or pay attention to the values of the (*address family,* *socket type,*) parameters as is appropriate, but they must not indicate an error condition when the value of either *address family* or *socket type* is zero.</span></span> <span data-ttu-id="679ee-123">Inoltre, i provider di servizi non devono indicare una condizione di errore quando la costante del manifesto dalle \_ informazioni sul protocollo \_ è contenuta in qualsiasi parametro (*famiglia di indirizzi,* *tipo di socket*).</span><span class="sxs-lookup"><span data-stu-id="679ee-123">In addition, service providers must not indicate an error condition when the manifest constant FROM\_PROTOCOL\_INFO is contained in any of the (*address family,* *socket type,*) parameters.</span></span> <span data-ttu-id="679ee-124">Questo valore indica semplicemente che l'applicazione desidera usare i valori trovati nei parametri corrispondenti della struttura di **\_ informazioni di WSAPROTOCOL** : (**iAddressFamily**, **iSocketType**, **iProtocol**).</span><span class="sxs-lookup"><span data-stu-id="679ee-124">This value simply indicates that the application wishes to use the values found in the corresponding parameters of the **WSAPROTOCOL\_INFO** structure: (**iAddressFamily**, **iSocketType**, **iProtocol**).</span></span>

<span data-ttu-id="679ee-125">Come parte della creazione del socket, un provider di servizi informa WS2 \_32.dll sull'associazione tra se stesso e il nuovo socket mediante parametri passati a [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) o [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle).</span><span class="sxs-lookup"><span data-stu-id="679ee-125">As part of socket creation, a service provider informs the Ws2\_32.dll about the association between itself and the new socket by means of parameters passed to [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle) or [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle).</span></span> <span data-ttu-id="679ee-126">Il \_32.dll WS2 tiene traccia dell'associazione tra handle di socket e provider di servizi particolari.</span><span class="sxs-lookup"><span data-stu-id="679ee-126">The Ws2\_32.dll keeps track of this association between socket handles and particular service providers.</span></span> <span data-ttu-id="679ee-127">Ogni volta che viene chiamata una funzione dell'interfaccia dell'applicazione che fa riferimento a un handle di socket, WS2 \_32.dll cerca l'associazione e chiama la corrispondente funzione dell'interfaccia del provider di servizi del provider di servizi appropriato.</span><span class="sxs-lookup"><span data-stu-id="679ee-127">Whenever an application interface function that refers to a socket handle is called, the Ws2\_32.dll looks up the association and calls the corresponding service provider interface function of the appropriate service provider.</span></span>

<span data-ttu-id="679ee-128">Oltre al servizio di routing del traffico principale, WS2 \_32.dll offre diversi altri servizi, ad esempio l'enumerazione del protocollo, la gestione del descrittore di socket (allocazione, deallocazione e associazione di valori di contesto per provider di servizi non file System, gestione dell'hook di blocco in base ai singoli thread, utilità di scambio di byte, Accodamento di chiamate di procedure asincrone (APC) per facilitare la chiamata delle routine di completamento di I/O e la negoziazione della versione tra le applicazioni e il \_32.dll WS2, nonché tra i \_ provider di servizi e32.dll WS2.</span><span class="sxs-lookup"><span data-stu-id="679ee-128">In addition to its major traffic routing service, the Ws2\_32.dll provides a number of other services such as protocol enumeration, socket descriptor management (allocation, deallocation, and context value association) for nonfile-system service providers, blocking hook management on a per-thread basis, byte-swapping utilities, queuing of asynchronous procedure calls (APCs) to facilitate invocation of I/O completion routines, and version negotiation between applications and the Ws2\_32.dll, as well as between the Ws2\_32.dll and service providers.</span></span>

## <a name="transport-service-provider-functionality"></a><span data-ttu-id="679ee-129">Funzionalità del provider di servizi di trasporto</span><span class="sxs-lookup"><span data-stu-id="679ee-129">Transport Service Provider Functionality</span></span>

<span data-ttu-id="679ee-130">I provider di servizi implementano il protocollo di trasporto effettivo, che include funzioni come la configurazione di connessioni, il trasferimento di dati, l'esercizio del controllo di flusso e il controllo degli errori e così via. Il \_32.dll WS2 non ha alcuna conoscenza del modo in cui vengono realizzate le richieste ai provider di servizi; questo dipende dall'implementazione del provider di servizi.</span><span class="sxs-lookup"><span data-stu-id="679ee-130">Service providers implement the actual transport protocol which includes such functions as setting up connections, transferring data, exercising flow control and error control, etc. The Ws2\_32.dll has no knowledge about how requests to service providers are realized; this is up to the service provider implementation.</span></span> <span data-ttu-id="679ee-131">L'implementazione di tali funzioni può variare significativamente da un provider a un altro.</span><span class="sxs-lookup"><span data-stu-id="679ee-131">The implementation of such functions may differ greatly from one provider to another.</span></span> <span data-ttu-id="679ee-132">I provider di servizi nascondono i dettagli specifici dell'implementazione del modo in cui vengono eseguite le operazioni di rete.</span><span class="sxs-lookup"><span data-stu-id="679ee-132">Service providers hide the implementation-specific details of how network operations are accomplished.</span></span>

<span data-ttu-id="679ee-133">I provider di servizi di trasporto possono essere divisi in due categorie: quelli i cui descrittori di socket sono veri file system handle (e sono in seguito definiti provider del file system installabile (IFS). i restanti sono detti provider non IFS.</span><span class="sxs-lookup"><span data-stu-id="679ee-133">Transport service providers can be broadly divided into two categories: those whose socket descriptors are real file system handles (and are hereafter referred to as Installable File System (IFS) providers; the remainder are referred to as non-IFS providers.</span></span> <span data-ttu-id="679ee-134">Il \_32.dll WS2 passa sempre il descrittore di socket del provider di servizi di trasporto su un'applicazione Windows Sockets, in modo che le applicazioni siano libere di sfruttare i descrittori di socket file System handle.</span><span class="sxs-lookup"><span data-stu-id="679ee-134">The Ws2\_32.dll always passes the transport service provider's socket descriptor on up to the Windows Sockets application, so applications are free to take advantage of socket descriptors that are file system handles if they so choose.</span></span>

<span data-ttu-id="679ee-135">Per riepilogare: i provider di servizi implementano i protocolli specifici della rete di basso livello.</span><span class="sxs-lookup"><span data-stu-id="679ee-135">To summarize: service providers implement the low-level network-specific protocols.</span></span> <span data-ttu-id="679ee-136">Il \_32.dll WS2 fornisce la gestione del traffico di livello medio che interconnette questi protocolli di trasporto con le applicazioni.</span><span class="sxs-lookup"><span data-stu-id="679ee-136">The Ws2\_32.dll provides the medium-level traffic management that interconnects these transport protocols with applications.</span></span> <span data-ttu-id="679ee-137">Le applicazioni a loro volta forniscono i criteri di utilizzo di questi flussi di traffico e di operazioni specifiche della rete per eseguire le funzioni desiderate dall'utente.</span><span class="sxs-lookup"><span data-stu-id="679ee-137">Applications in turn provide the policy of how these traffic streams and network-specific operations are used to accomplish the functions desired by the user.</span></span>

 

 
