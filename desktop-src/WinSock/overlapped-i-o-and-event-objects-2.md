---
description: Windows Sockets 2 supporta l'I/O sovrapposto e tutti i provider di trasporto supportano questa funzionalità.
ms.assetid: b36ab606-df1a-4254-b048-6d47eb366275
title: Oggetti I/O sovrapposti e oggetti evento
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ed034f06243959d94a1ada7eaa71e33c84cd35ee
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106306914"
---
# <a name="overlapped-io-and-event-objects"></a><span data-ttu-id="e8680-103">Oggetti I/O sovrapposti e oggetti evento</span><span class="sxs-lookup"><span data-stu-id="e8680-103">Overlapped I/O and Event Objects</span></span>

<span data-ttu-id="e8680-104">Windows Sockets 2 supporta l'I/O sovrapposto e tutti i provider di trasporto supportano questa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="e8680-104">Windows Sockets 2 supports overlapped I/O and all transport providers support this capability.</span></span> <span data-ttu-id="e8680-105">L'I/O sovrapposto segue il modello stabilito in Windows e può essere eseguito su socket creati con la funzione [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) o i socket creati con la funzione [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) con il flag **WSA \_ \_ sovrapposto** impostato nel parametro *dwFlags* .</span><span class="sxs-lookup"><span data-stu-id="e8680-105">Overlapped I/O follows the model established in Windows and can be performed on sockets created with the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) function or sockets created with the [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) function with the **WSA\_FLAG\_OVERLAPPED** flag set in the *dwFlags* parameter.</span></span>

> [!Note]  
> <span data-ttu-id="e8680-106">La creazione di un socket con l'attributo Overlapped non ha alcun effetto sul fatto che un socket sia attualmente in modalità di blocco o non blocco.</span><span class="sxs-lookup"><span data-stu-id="e8680-106">Creating a socket with the overlapped attribute has no impact on whether a socket is currently in blocking or nonblocking mode.</span></span> <span data-ttu-id="e8680-107">I socket creati con l'attributo Overlapped possono essere utilizzati per eseguire operazioni di I/O sovrapposte, in modo da non modificare la modalità di blocco di un socket.</span><span class="sxs-lookup"><span data-stu-id="e8680-107">Sockets created with the overlapped attribute can be used to perform overlapped I/O—doing so does not change the blocking mode of a socket.</span></span> <span data-ttu-id="e8680-108">Poiché le operazioni di I/O sovrapposte non vengono bloccate, la modalità di blocco di un socket è irrilevante per queste operazioni.</span><span class="sxs-lookup"><span data-stu-id="e8680-108">Since overlapped I/O operations do not block, the blocking mode of a socket is irrelevant for these operations.</span></span>

 

<span data-ttu-id="e8680-109">Per la ricezione, le applicazioni usano le funzioni [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) o [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) per fornire i buffer in cui devono essere ricevuti i dati.</span><span class="sxs-lookup"><span data-stu-id="e8680-109">For receiving, applications use the [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv) or [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) functions to supply buffers into which data is to be received.</span></span> <span data-ttu-id="e8680-110">Se uno o più buffer vengono inviati prima del momento in cui i dati sono stati ricevuti dalla rete, i dati potrebbero essere inseriti nei buffer dell'utente immediatamente dopo l'arrivo.</span><span class="sxs-lookup"><span data-stu-id="e8680-110">If one or more buffers are posted prior to the time when data has been received by the network, that data could be placed in the user's buffers immediately as it arrives.</span></span> <span data-ttu-id="e8680-111">In questo modo, è possibile evitare l'operazione di copia che altrimenti si verificherebbe nel momento in cui viene richiamata la funzione [**ricezione**](/windows/desktop/api/winsock/nf-winsock-recv) o [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) .</span><span class="sxs-lookup"><span data-stu-id="e8680-111">Thus, it can avoid the copy operation that would otherwise occur at the time the [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) or [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) function is invoked.</span></span> <span data-ttu-id="e8680-112">Se i dati sono già presenti quando si inviano buffer di ricezione, vengono copiati immediatamente nei buffer dell'utente.</span><span class="sxs-lookup"><span data-stu-id="e8680-112">If data is already present when receive buffers are posted, it is copied immediately into the user's buffers.</span></span>

<span data-ttu-id="e8680-113">Se i dati arrivano quando l'applicazione non dispone di buffer di ricezione, la rete ricorre al consueto stile sincrono dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="e8680-113">If data arrives when no receive buffers have been posted by the application, the network resorts to the familiar synchronous style of operation.</span></span> <span data-ttu-id="e8680-114">Ovvero, i dati in ingresso vengono memorizzati nel buffer internamente fino a quando l'applicazione non emette una chiamata di ricezione e pertanto fornisce un buffer in cui i dati possono essere copiati.</span><span class="sxs-lookup"><span data-stu-id="e8680-114">That is, the incoming data is buffered internally until the application issues a receive call and thereby supplies a buffer into which the data can be copied.</span></span> <span data-ttu-id="e8680-115">Un'eccezione è rappresentata dal caso in cui l'applicazione utilizza [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) per impostare la dimensione del buffer di ricezione su zero.</span><span class="sxs-lookup"><span data-stu-id="e8680-115">An exception to this is when the application uses [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) to set the size of the receive buffer to zero.</span></span> <span data-ttu-id="e8680-116">In questo caso, i protocolli affidabili consentono di ricevere solo i dati quando i buffer dell'applicazione sono stati inviati e i dati su protocolli non affidabili andranno perduti.</span><span class="sxs-lookup"><span data-stu-id="e8680-116">In this instance, reliable protocols would only allow data to be received when application buffers had been posted and data on unreliable protocols would be lost.</span></span>

<span data-ttu-id="e8680-117">Sul lato di invio, le applicazioni usano [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend) o [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) per fornire i puntatori ai buffer pieni e quindi accettano di non disturbare i buffer in alcun modo finché la rete non ha utilizzato il contenuto del buffer.</span><span class="sxs-lookup"><span data-stu-id="e8680-117">On the sending side, applications use [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend) or [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) to supply pointers to filled buffers and then agree not to disturb the buffers in any way until the network has consumed the buffer's contents.</span></span>

<span data-ttu-id="e8680-118">Le chiamate di invio e ricezione sovrapposte vengono restituite immediatamente.</span><span class="sxs-lookup"><span data-stu-id="e8680-118">Overlapped send and receive calls return immediately.</span></span> <span data-ttu-id="e8680-119">Un valore restituito pari a zero indica che l'operazione di I/O è stata completata immediatamente e che l'indicazione di completamento corrispondente è già stata eseguita.</span><span class="sxs-lookup"><span data-stu-id="e8680-119">A return value of zero indicates that the I/O operation was completed immediately and that the corresponding completion indication already occurred.</span></span> <span data-ttu-id="e8680-120">Ovvero l'oggetto evento associato è stato segnalato oppure una routine di completamento è stata accodata e verrà eseguita quando il thread chiamante entra nello stato di attesa di avviso.</span><span class="sxs-lookup"><span data-stu-id="e8680-120">That is, the associated event object has been signaled, or a completion routine has been queued and will be executed when the calling thread gets into the alertable wait state.</span></span>

<span data-ttu-id="e8680-121">Un valore restituito dell'errore del SOCKET \_ associato a un codice di errore di i/o di [WSA \_ \_ in sospeso](windows-sockets-error-codes-2.md) indica che l'operazione sovrapposta è stata avviata correttamente e che verrà fornita un'indicazione successiva quando vengono utilizzati i buffer di invio o quando un'operazione di ricezione è stata completata.</span><span class="sxs-lookup"><span data-stu-id="e8680-121">A return value of SOCKET\_ERROR coupled with an error code of [WSA\_IO\_PENDING](windows-sockets-error-codes-2.md) indicates that the overlapped operation has been successfully initiated and that a subsequent indication will be provided when send buffers have been consumed or when a receive operation has been completed.</span></span> <span data-ttu-id="e8680-122">Tuttavia, per i socket con stile di flusso di byte, l'indicazione di completamento viene eseguita ogni volta che i dati in ingresso vengono esauriti, indipendentemente dal fatto che i buffer siano pieni.</span><span class="sxs-lookup"><span data-stu-id="e8680-122">However, for sockets that are byte-stream style, the completion indication occurs whenever the incoming data is exhausted, regardless of whether the buffers are full.</span></span> <span data-ttu-id="e8680-123">Qualsiasi altro codice di errore indica che l'operazione sovrapposta non è stata avviata correttamente e che l'indicazione di completamento non sarà imminente.</span><span class="sxs-lookup"><span data-stu-id="e8680-123">Any other error code indicates that the overlapped operation was not successfully initiated and that no completion indication will be forthcoming.</span></span>

<span data-ttu-id="e8680-124">È possibile sovrapporre le operazioni di invio e ricezione.</span><span class="sxs-lookup"><span data-stu-id="e8680-124">Both send and receive operations can be overlapped.</span></span> <span data-ttu-id="e8680-125">Le funzioni receive possono essere richiamate più volte per inserire i buffer di ricezione in preparazione ai dati in ingresso e le funzioni di invio possono essere richiamate più volte per accodare più buffer da inviare.</span><span class="sxs-lookup"><span data-stu-id="e8680-125">The receive functions can be invoked several times to post receive buffers in preparation for incoming data, and the send functions can be invoked several times to queue multiple buffers to send.</span></span> <span data-ttu-id="e8680-126">Mentre l'applicazione può basarsi su una serie di buffer di invio sovrapposti inviati nell'ordine specificato, le indicazioni di completamento corrispondenti possono verificarsi in un ordine diverso.</span><span class="sxs-lookup"><span data-stu-id="e8680-126">While the application can rely upon a series of overlapped send buffers being sent in the order supplied, the corresponding completion indications might occur in a different order.</span></span> <span data-ttu-id="e8680-127">Analogamente, sul lato ricevente, i buffer possono essere compilati nell'ordine in cui vengono forniti, ma le indicazioni di completamento possono verificarsi in un ordine diverso.</span><span class="sxs-lookup"><span data-stu-id="e8680-127">Likewise, on the receiving side, buffers can be filled in the order they are supplied, but the completion indications might occur in a different order.</span></span>

<span data-ttu-id="e8680-128">In molti casi, le operazioni Winsock sovrapposte che usano [**AcceptEx**](/windows/win32/api/mswsock/nf-mswsock-acceptex), [**ConnectEx**](/windows/desktop/api/Mswsock/nc-mswsock-lpfn_connectex), [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend), [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv), [**TransmitFile**](/windows/win32/api/mswsock/nf-mswsock-transmitfile)e funzioni simili sono annullabili.</span><span class="sxs-lookup"><span data-stu-id="e8680-128">In many cases, Winsock overlapped operations using [**AcceptEx**](/windows/win32/api/mswsock/nf-mswsock-acceptex), [**ConnectEx**](/windows/desktop/api/Mswsock/nc-mswsock-lpfn_connectex), [**WSASend**](/windows/desktop/api/Winsock2/nf-winsock2-wsasend), [**WSARecv**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecv), [**TransmitFile**](/windows/win32/api/mswsock/nf-mswsock-transmitfile), and similar functions are cancelable.</span></span> <span data-ttu-id="e8680-129">Tuttavia, il comportamento non è definito per l'uso continuativo di un socket che ha annullato le operazioni in sospeso.</span><span class="sxs-lookup"><span data-stu-id="e8680-129">However, behavior is undefined for the continued use of a socket that has canceled outstanding operations.</span></span> <span data-ttu-id="e8680-130">La funzione [**chiamata closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) deve essere chiamata dopo l'annullamento di un'operazione sovrapposta.</span><span class="sxs-lookup"><span data-stu-id="e8680-130">The [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) function should be called after canceling an overlapped operation.</span></span> <span data-ttu-id="e8680-131">Pertanto, per ottenere risultati ottimali, anziché annullare direttamente l'i/O, è necessario chiamare la funzione **chiamata closesocket** per chiudere il socket che interrompe infine tutte le operazioni in sospeso.</span><span class="sxs-lookup"><span data-stu-id="e8680-131">Therefore, for best results, instead of canceling the I/O directly, the **closesocket** function should be called to close the socket which will eventually discontinue all pending operations.</span></span>

<span data-ttu-id="e8680-132">La funzionalità di completamento posticipato dell'I/O sovrapposto è disponibile anche per [**WSAIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsaioctl), che è una versione migliorata di [**ioctlsocket**](/windows/desktop/api/winsock/nf-winsock-ioctlsocket).</span><span class="sxs-lookup"><span data-stu-id="e8680-132">The deferred completion feature of overlapped I/O is also available for [**WSAIoctl**](/windows/desktop/api/Winsock2/nf-winsock2-wsaioctl), which is an enhanced version of [**ioctlsocket**](/windows/desktop/api/winsock/nf-winsock-ioctlsocket).</span></span>

 

 
