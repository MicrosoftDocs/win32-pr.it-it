---
description: Un socket non elaborato è un tipo di socket che consente l'accesso al provider di trasporto sottostante.
ms.assetid: 4cbe5505-75e7-454f-9e6b-f38bdc60bf6d
title: Socket TCP/IP raw
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 25cc08d59d80089a4e655f363e4a899edac8d2b8
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106310417"
---
# <a name="tcpip-raw-sockets"></a><span data-ttu-id="ed802-103">Socket TCP/IP raw</span><span class="sxs-lookup"><span data-stu-id="ed802-103">TCP/IP Raw Sockets</span></span>

<span data-ttu-id="ed802-104">Un socket non elaborato è un tipo di socket che consente l'accesso al provider di trasporto sottostante.</span><span class="sxs-lookup"><span data-stu-id="ed802-104">A raw socket is a type of socket that allows access to the underlying transport provider.</span></span> <span data-ttu-id="ed802-105">Questo argomento è incentrato solo su socket non elaborati e protocolli IPv4 e IPv6.</span><span class="sxs-lookup"><span data-stu-id="ed802-105">This topic focuses only on raw sockets and the IPv4 and IPv6 protocols.</span></span> <span data-ttu-id="ed802-106">Poiché la maggior parte degli altri protocolli ad eccezione di ATM non supporta i socket non elaborati.</span><span class="sxs-lookup"><span data-stu-id="ed802-106">This is because most other protocols with the exception of ATM do not support raw sockets.</span></span> <span data-ttu-id="ed802-107">Per utilizzare i socket non elaborati, un'applicazione deve disporre di informazioni dettagliate sul protocollo sottostante utilizzato.</span><span class="sxs-lookup"><span data-stu-id="ed802-107">To use raw sockets, an application needs to have detailed information on the underlying protocol being used.</span></span>

<span data-ttu-id="ed802-108">I provider di servizi Winsock per il protocollo IP possono supportare un *tipo* di socket di **Sock \_ RAW**.</span><span class="sxs-lookup"><span data-stu-id="ed802-108">Winsock service providers for the IP protocol may support a socket *type* of **SOCK\_RAW**.</span></span> <span data-ttu-id="ed802-109">Il provider Windows Sockets 2 per TCP/IP incluso in Windows supporta questo tipo di socket **\_ RAW Sock** .</span><span class="sxs-lookup"><span data-stu-id="ed802-109">The Windows Sockets 2 provider for TCP/IP included on Windows supports this **SOCK\_RAW** socket type.</span></span>

<span data-ttu-id="ed802-110">Esistono due tipi di base di tali socket non elaborati:</span><span class="sxs-lookup"><span data-stu-id="ed802-110">There are two basic types of such raw sockets:</span></span>

-   <span data-ttu-id="ed802-111">Il primo tipo utilizza un tipo di protocollo noto scritto nell'intestazione IP riconosciuta da un provider di servizi Winsock.</span><span class="sxs-lookup"><span data-stu-id="ed802-111">The first type uses a known protocol type written in the IP header that is recognized by a Winsock service provider.</span></span> <span data-ttu-id="ed802-112">Un esempio del primo tipo di socket è un socket per il protocollo ICMP (IP Protocol Type = 1) o il protocollo ICMPv6 (IP procotol = 58).</span><span class="sxs-lookup"><span data-stu-id="ed802-112">An example of the first type of socket is a socket for the ICMP protocol (IP protocol type = 1) or the ICMPv6 protocol (IP procotol type = 58).</span></span>
-   <span data-ttu-id="ed802-113">Il secondo tipo consente di specificare qualsiasi tipo di protocollo.</span><span class="sxs-lookup"><span data-stu-id="ed802-113">The second type allows any protocol type to be specified.</span></span> <span data-ttu-id="ed802-114">Un esempio del secondo tipo è costituito da un protocollo sperimentale non direttamente supportato dal provider di servizi Winsock, ad esempio il protocollo SCTP (Stream Control Transmission Protocol).</span><span class="sxs-lookup"><span data-stu-id="ed802-114">An example of the second type would be an experimental protocol that is not directly supported by the Winsock service provider such as the Stream Control Transmission Protocol (SCTP).</span></span>

## <a name="determining-if-raw-sockets-are-supported"></a><span data-ttu-id="ed802-115">Determinare se i socket non elaborati sono supportati</span><span class="sxs-lookup"><span data-stu-id="ed802-115">Determining if Raw Sockets are Supported</span></span>

<span data-ttu-id="ed802-116">Se un provider di servizi Winsock supporta i socket **\_ RAW Sock** per le \_ famiglie di indirizzi AF inet o AF \_ INET6, il tipo di socket di **Sock \_ RAW** deve essere incluso nella struttura di [**\_ informazioni di WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) restituita dalla funzione [**WSAEnumProtocols**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) per uno o più provider di trasporto disponibili.</span><span class="sxs-lookup"><span data-stu-id="ed802-116">If a Winsock service provider supports **SOCK\_RAW** sockets for the AF\_INET or AF\_INET6 address families, the socket type of **SOCK\_RAW** should be included in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure returned by [**WSAEnumProtocols**](/windows/desktop/api/Winsock2/nf-winsock2-wsaenumprotocolsa) function for one or more of the available transport providers.</span></span>

<span data-ttu-id="ed802-117">Il membro **iAddressFamily** nella struttura [**di \_ informazioni di WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) deve specificare \_ AF inet o AF \_ INET6 e il membro **iSocketType** della struttura di **\_ informazioni WSAPROTOCOL** deve specificare un **Sock \_ RAW** per uno dei provider di trasporto.</span><span class="sxs-lookup"><span data-stu-id="ed802-117">The **iAddressFamily** member in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure should specify AF\_INET or AF\_INET6 and the **iSocketType** member of the **WSAPROTOCOL\_INFO** structure should specify **SOCK\_RAW** for one of the transport providers.</span></span>

<span data-ttu-id="ed802-118">Il membro **iProtocol** della struttura [**di \_ informazioni di WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) può essere impostato su **IPROTO \_ IP**.</span><span class="sxs-lookup"><span data-stu-id="ed802-118">The **iProtocol** member of the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure may be set to **IPROTO\_IP**.</span></span> <span data-ttu-id="ed802-119">Il membro **iProtocol** della struttura **di \_ informazioni di WSAPROTOCOL** può anche essere impostato su zero se il provider di servizi consente a un'applicazione di usare un tipo di socket **\_ RAW Sock** per altri protocolli di rete diversi dal protocollo Internet per la famiglia di indirizzi.</span><span class="sxs-lookup"><span data-stu-id="ed802-119">The **iProtocol** member of the **WSAPROTOCOL\_INFO** structure may also be set to zero if the service provider allows an application to use a **SOCK\_RAW** socket type for other network protocols other than the Internet Protocol for the address family.</span></span>

<span data-ttu-id="ed802-120">Gli altri membri della struttura [**di \_ informazioni WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) indicano le altre proprietà del supporto del protocollo per **Sock \_ RAW** e indicano come deve essere trattato un socket di **Sock \_ RAW** .</span><span class="sxs-lookup"><span data-stu-id="ed802-120">The other members in the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure indicate other properties of the protocol support for **SOCK\_RAW** and indicate how a socket of **SOCK\_RAW** should be treated.</span></span> <span data-ttu-id="ed802-121">Questi altri membri del **WSAPROTOCOL \_ info** per **Sock \_ RAW** normalmente specificano che il protocollo è senza connessione, orientato ai messaggi, supporta Broadcast/multicast (il XP1 senza \_ connessione, XP1 \_ messaggio \_ orientato, XP1 \_ support \_ broadcast e XP1 \_ supportano i \_ bit multipoint sono impostati nel membro dwServiceFlags1) e possono avere una dimensione massima di messaggi pari a 65.467 byte.</span><span class="sxs-lookup"><span data-stu-id="ed802-121">These other members of the **WSAPROTOCOL\_INFO** for **SOCK\_RAW** normally specify that the protocol is connectionless, message-oriented, supports broadcast/multicast (the XP1\_CONNECTIONLESS, XP1\_MESSAGE\_ORIENTED, XP1\_SUPPORT\_BROADCAST, and XP1\_SUPPORT\_MULTIPOINT bits are set in the dwServiceFlags1 member), and can have a maximum message size of 65,467 bytes.</span></span>

<span data-ttu-id="ed802-122">In Windows XP e versioni successive, è possibile usare il comando *NetSh.exe* per determinare se i socket non elaborati sono supportati.</span><span class="sxs-lookup"><span data-stu-id="ed802-122">On Windows XP and later, the *NetSh.exe* command can be used to determine if raw sockets are supported.</span></span> <span data-ttu-id="ed802-123">Il comando seguente viene eseguito da una finestra CMD per visualizzare i dati del catalogo Winsock nella console:</span><span class="sxs-lookup"><span data-stu-id="ed802-123">The following command run from a CMD window will display data from the Winsock catalog on the console:</span></span>

<span data-ttu-id="ed802-124">**netsh winsock Show Catalog**</span><span class="sxs-lookup"><span data-stu-id="ed802-124">**netsh winsock show catalog**</span></span>

<span data-ttu-id="ed802-125">L'output includerà un elenco che contiene alcuni dati dalle strutture di [**\_ informazioni di WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) supportate nel computer locale.</span><span class="sxs-lookup"><span data-stu-id="ed802-125">The output will include a list that contains some of the data from the [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structures supported on the local computer.</span></span> <span data-ttu-id="ed802-126">Cercare il termine RAW/IP o RAW/IPv6 nel campo Description per trovare i protocolli che supportano i socket non elaborati.</span><span class="sxs-lookup"><span data-stu-id="ed802-126">Search for the term RAW/IP or RAW/IPv6 in the Description field to find those protocols that support raw sockets.</span></span>

## <a name="creating-a-raw-socket"></a><span data-ttu-id="ed802-127">Creazione di un socket non elaborato</span><span class="sxs-lookup"><span data-stu-id="ed802-127">Creating a Raw Socket</span></span>

<span data-ttu-id="ed802-128">Per creare un socket di tipo **Sock \_ RAW**, chiamare la funzione [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) o [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) con il *parametro AF* (Family Address) impostato su AF \_ inet o AF \_ INET6, il parametro di *tipo* impostato su **Sock \_ RAW** e il parametro del *protocollo* impostato sul numero di protocollo obbligatorio.</span><span class="sxs-lookup"><span data-stu-id="ed802-128">To create a socket of type **SOCK\_RAW**, call the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket) or [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa) function with the *af* parameter (address family) set to AF\_INET or AF\_INET6, the *type* parameter set to **SOCK\_RAW**, and the *protocol* parameter set to the protocol number required.</span></span> <span data-ttu-id="ed802-129">Il parametro del *protocollo* diventa il valore del protocollo nell'intestazione IP (ad esempio, SCTP è 132).</span><span class="sxs-lookup"><span data-stu-id="ed802-129">The *protocol* parameter becomes the protocol value in the IP header (SCTP is 132, for example).</span></span>

> [!Note]  
> <span data-ttu-id="ed802-130">Un'applicazione non può specificare zero (0) come parametro del *protocollo* per le funzioni [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket), [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa)e [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) se il parametro di *tipo* è impostato su **Sock \_ RAW**.</span><span class="sxs-lookup"><span data-stu-id="ed802-130">An application may not specify zero (0) as the *protocol* parameter for the [**socket**](/windows/desktop/api/Winsock2/nf-winsock2-socket), [**WSASocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsasocketa), and [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) functions if the *type* parameter is set to **SOCK\_RAW**.</span></span>

 

<span data-ttu-id="ed802-131">I socket non elaborati offrono la possibilità di modificare il trasporto sottostante, in modo che possano essere usati per scopi dannosi che costituiscono una minaccia per la sicurezza.</span><span class="sxs-lookup"><span data-stu-id="ed802-131">Raw sockets offer the capability to manipulate the underlying transport, so they can be used for malicious purposes that pose a security threat.</span></span> <span data-ttu-id="ed802-132">Pertanto, solo i membri del gruppo Administrators possono creare socket di tipo SOCK \_ RAW in Windows 2000 e versioni successive.</span><span class="sxs-lookup"><span data-stu-id="ed802-132">Therefore, only members of the Administrators group can create sockets of type SOCK\_RAW on Windows 2000 and later.</span></span>

## <a name="send-and-receive-operations"></a><span data-ttu-id="ed802-133">Operazioni di invio e ricezione</span><span class="sxs-lookup"><span data-stu-id="ed802-133">Send and Receive Operations</span></span>

<span data-ttu-id="ed802-134">Quando un'applicazione crea un socket di tipo **Sock \_ RAW**, questo socket può essere usato per inviare e ricevere dati.</span><span class="sxs-lookup"><span data-stu-id="ed802-134">Once an application creates a socket of type **SOCK\_RAW**, this socket may be used to send and receive data.</span></span> <span data-ttu-id="ed802-135">Tutti i pacchetti inviati o ricevuti su un socket di tipo **Sock \_ RAW** vengono trattati come datagrammi su un socket non connesso.</span><span class="sxs-lookup"><span data-stu-id="ed802-135">All packets sent or received on a socket of type **SOCK\_RAW** are treated as datagrams on an unconnected socket.</span></span>

<span data-ttu-id="ed802-136">Le regole seguenti si applicano alle operazioni su socket **\_ RAW Sock** :</span><span class="sxs-lookup"><span data-stu-id="ed802-136">The following rules apply to the operations over **SOCK\_RAW** sockets:</span></span>

-   <span data-ttu-id="ed802-137">La funzione [**Send**](/windows/desktop/api/winsock/nf-winsock-sendto) o [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) viene in genere usata per inviare dati su un socket di tipo **Sock \_ RAW**.</span><span class="sxs-lookup"><span data-stu-id="ed802-137">The [**sendto**](/windows/desktop/api/winsock/nf-winsock-sendto) or [**WSASendTo**](/windows/desktop/api/Winsock2/nf-winsock2-wsasendto) function is normally used to send data on a socket of type **SOCK\_RAW**.</span></span> <span data-ttu-id="ed802-138">L'indirizzo di destinazione può essere qualsiasi indirizzo valido nella famiglia di indirizzi del socket, incluso un indirizzo broadcast o multicast.</span><span class="sxs-lookup"><span data-stu-id="ed802-138">The destination address can be any valid address in the socket's address family, including a broadcast or multicast address.</span></span> <span data-ttu-id="ed802-139">Per inviare a un indirizzo di trasmissione, un'applicazione deve avere usato [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) con la \_ trasmissione abilitata.</span><span class="sxs-lookup"><span data-stu-id="ed802-139">To send to a broadcast address, an application must have used [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) with SO\_BROADCAST enabled.</span></span> <span data-ttu-id="ed802-140">In caso contrario, **Send** o **WSASendTo** avrà esito negativo con il codice di errore [WSAEACCES](windows-sockets-error-codes-2.md).</span><span class="sxs-lookup"><span data-stu-id="ed802-140">Otherwise, **sendto** or **WSASendTo** will fail with the error code [WSAEACCES](windows-sockets-error-codes-2.md).</span></span> <span data-ttu-id="ed802-141">Per IP, un'applicazione può inviare a qualsiasi indirizzo multicast (senza diventare membro del gruppo).</span><span class="sxs-lookup"><span data-stu-id="ed802-141">For IP, an application can send to any multicast address (without becoming a group member).</span></span>
-   <span data-ttu-id="ed802-142">Quando si inviano dati IPv4, un'applicazione può scegliere se specificare l'intestazione IPv4 nella parte anteriore del datagramma in uscita per il pacchetto.</span><span class="sxs-lookup"><span data-stu-id="ed802-142">When sending IPv4 data, an application has a choice on whether to specify the IPv4 header at the front of the outgoing datagram for the packet.</span></span> <span data-ttu-id="ed802-143">Se l'opzione del socket **IP \_ HDRINCL** è impostata su true per un socket IPv4 (famiglia di indirizzi di AF \_ inet), l'applicazione deve fornire l'intestazione IPv4 nei dati in uscita per le operazioni di invio.</span><span class="sxs-lookup"><span data-stu-id="ed802-143">If the **IP\_HDRINCL** socket option is set to true for an IPv4 socket (address family of AF\_INET), the application must supply the IPv4 header in the outgoing data for send operations.</span></span> <span data-ttu-id="ed802-144">Se questa opzione socket è false (impostazione predefinita), l'intestazione IPv4 non dovrebbe essere inclusa nei dati in uscita per le operazioni di invio.</span><span class="sxs-lookup"><span data-stu-id="ed802-144">If this socket option is false (the default setting), then the IPv4 header should not be in included the outgoing data for send operations.</span></span>
-   <span data-ttu-id="ed802-145">Quando si inviano dati IPv6, un'applicazione può scegliere se specificare l'intestazione IPv6 nella parte anteriore del datagramma in uscita per il pacchetto.</span><span class="sxs-lookup"><span data-stu-id="ed802-145">When sending IPv6 data, an application has a choice on whether to specify the IPv6 header at the front of the outgoing datagram for the packet.</span></span> <span data-ttu-id="ed802-146">Se l' **opzione \_ HDRINCL socket IPv6** è impostata su true per un socket IPv6 (famiglia di indirizzi AF \_ INET6), l'applicazione deve fornire l'intestazione IPv6 nei dati in uscita per le operazioni di invio.</span><span class="sxs-lookup"><span data-stu-id="ed802-146">If the **IPV6\_HDRINCL** socket option is set to true for an IPv6 socket (address family of AF\_INET6), the application must supply the IPv6 header in the outgoing data for send operations.</span></span> <span data-ttu-id="ed802-147">L'impostazione predefinita per questa opzione è false.</span><span class="sxs-lookup"><span data-stu-id="ed802-147">The default setting for this option is false.</span></span> <span data-ttu-id="ed802-148">Se questa opzione socket è false (impostazione predefinita), l'intestazione IPv6 non deve essere inclusa nei dati in uscita per le operazioni di invio.</span><span class="sxs-lookup"><span data-stu-id="ed802-148">If this socket option is false (the default setting), then the IPv6 header should not be included in the outgoing data for send operations.</span></span> <span data-ttu-id="ed802-149">Per IPv6, non è necessario includere l'intestazione IPv6.</span><span class="sxs-lookup"><span data-stu-id="ed802-149">For IPv6, there should be no need to include the IPv6 header.</span></span> <span data-ttu-id="ed802-150">Se le informazioni sono disponibili tramite le funzioni socket, l'intestazione IPv6 non deve essere inclusa per evitare problemi di compatibilità in futuro.</span><span class="sxs-lookup"><span data-stu-id="ed802-150">If information is available using socket functions, then the IPv6 header should not be included to avoid compatibility problems in the future.</span></span> <span data-ttu-id="ed802-151">Questi problemi sono illustrati nella RFC 3542 pubblicata da IETF.</span><span class="sxs-lookup"><span data-stu-id="ed802-151">These issues are discussed in RFC 3542 published by the IETF.</span></span> <span data-ttu-id="ed802-152">L'utilizzo dell'opzione socket **\_ HDRINCL IPv6** non è consigliato e potrebbe essere deprecato in futuro.</span><span class="sxs-lookup"><span data-stu-id="ed802-152">Using the **IPV6\_HDRINCL** socket option is not recommended and may be deprecated in future.</span></span>
-   <span data-ttu-id="ed802-153">La funzione [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) o [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) viene in genere usata per ricevere dati su un socket di tipo **Sock \_ RAW**.</span><span class="sxs-lookup"><span data-stu-id="ed802-153">The [**recvfrom**](/windows/desktop/api/winsock/nf-winsock-recvfrom) or [**WSARecvFrom**](/windows/desktop/api/Winsock2/nf-winsock2-wsarecvfrom) function is normally used to receive data on a socket of type **SOCK\_RAW**.</span></span> <span data-ttu-id="ed802-154">Entrambe queste funzioni hanno un'opzione per restituire l'indirizzo IP di origine da cui è stato inviato il pacchetto.</span><span class="sxs-lookup"><span data-stu-id="ed802-154">Both of these functions have an option to return the source IP address where the packet was sent from.</span></span> <span data-ttu-id="ed802-155">I dati ricevuti sono un datagramma da un socket non connesso.</span><span class="sxs-lookup"><span data-stu-id="ed802-155">The received data is a datagram from an unconnected socket.</span></span>
-   <span data-ttu-id="ed802-156">Per IPv4 (indirizzo famiglia di AF \_ inet), un'applicazione riceve l'intestazione IP all'inizio di ogni datagramma ricevuto indipendentemente dall'opzione del socket **\_ HDRINCL IP** .</span><span class="sxs-lookup"><span data-stu-id="ed802-156">For IPv4 (address family of AF\_INET), an application receives the IP header at the front of each received datagram regardless of the **IP\_HDRINCL** socket option.</span></span>
-   <span data-ttu-id="ed802-157">Per IPv6 (indirizzo famiglia di AF \_ INET6), un'applicazione riceve tutti gli elementi dopo l'ultima intestazione IPv6 in ogni datagramma ricevuto indipendentemente dall'opzione socket **\_ HDRINCL di IPv6** .</span><span class="sxs-lookup"><span data-stu-id="ed802-157">For IPv6 (address family of AF\_INET6), an application receives everything after the last IPv6 header in each received datagram regardless of the **IPV6\_HDRINCL** socket option.</span></span> <span data-ttu-id="ed802-158">L'applicazione non riceve intestazioni IPv6 usando un socket non elaborato.</span><span class="sxs-lookup"><span data-stu-id="ed802-158">The application does not receive any IPv6 headers using a raw socket.</span></span>
-   <span data-ttu-id="ed802-159">I datagrammi ricevuti vengono copiati in tutti i socket **\_ RAW Sock** che soddisfano le condizioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="ed802-159">Received datagrams are copied into all **SOCK\_RAW** sockets that satisfy the following conditions:</span></span>

    -   <span data-ttu-id="ed802-160">Il numero di protocollo specificato nel parametro del *protocollo* quando il socket è stato creato deve corrispondere al numero di protocollo nell'intestazione IP del datagramma ricevuto.</span><span class="sxs-lookup"><span data-stu-id="ed802-160">The protocol number specified in the *protocol* parameter when the socket was created should match the protocol number in the IP header of the received datagram.</span></span>
    -   <span data-ttu-id="ed802-161">Se per il socket viene definito un indirizzo IP locale, deve corrispondere all'indirizzo di destinazione come specificato nell'intestazione IP del datagramma ricevuto.</span><span class="sxs-lookup"><span data-stu-id="ed802-161">If a local IP address is defined for the socket, it should correspond to the destination address as specified in the IP header of the received datagram.</span></span> <span data-ttu-id="ed802-162">Un'applicazione può specificare l'indirizzo IP locale chiamando la funzione di [**Binding**](/windows/desktop/api/winsock/nf-winsock-bind) .</span><span class="sxs-lookup"><span data-stu-id="ed802-162">An application may specify the local IP address by calling the [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function.</span></span> <span data-ttu-id="ed802-163">Se per il socket non è specificato alcun indirizzo IP locale, i datagrammi vengono copiati nel socket indipendentemente dall'indirizzo IP di destinazione nell'intestazione IP del datagramma ricevuto.</span><span class="sxs-lookup"><span data-stu-id="ed802-163">If no local IP address is specified for the socket, the datagrams are copied into the socket regardless of the destination IP address in the IP header of the received datagram.</span></span>
    -   <span data-ttu-id="ed802-164">Se per il socket viene definito un indirizzo esterno, deve corrispondere all'indirizzo di origine come specificato nell'intestazione IP del datagramma ricevuto.</span><span class="sxs-lookup"><span data-stu-id="ed802-164">If a foreign address is defined for the socket, it should correspond to the source address as specified in the IP header of the received datagram.</span></span> <span data-ttu-id="ed802-165">Un'applicazione può specificare l'indirizzo IP esterno chiamando la funzione [**Connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect) o [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) .</span><span class="sxs-lookup"><span data-stu-id="ed802-165">An application may specify the foreign IP address by calling the [**connect**](/windows/desktop/api/Winsock2/nf-winsock2-connect) or [**WSAConnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaconnect) function.</span></span> <span data-ttu-id="ed802-166">Se non viene specificato alcun indirizzo IP esterno per il socket, i datagrammi vengono copiati nel socket indipendentemente dall'indirizzo IP di origine nell'intestazione IP del datagramma ricevuto.</span><span class="sxs-lookup"><span data-stu-id="ed802-166">If no foreign IP address is specified for the socket, the datagrams are copied into the socket regardless of the source IP address in the IP header of the received datagram.</span></span>

<span data-ttu-id="ed802-167">È importante comprendere che alcuni socket di tipo **Sock \_ RAW** possono ricevere molti datagrammi imprevisti.</span><span class="sxs-lookup"><span data-stu-id="ed802-167">It is important to understand that some sockets of type **SOCK\_RAW** may receive many unexpected datagrams.</span></span> <span data-ttu-id="ed802-168">Ad esempio, un programma PING può creare un socket di tipo **Sock \_ RAW** per inviare richieste echo ICMP e ricevere risposte.</span><span class="sxs-lookup"><span data-stu-id="ed802-168">For example, a PING program may create a socket of type **SOCK\_RAW** to send ICMP echo requests and receive responses.</span></span> <span data-ttu-id="ed802-169">Anche se l'applicazione prevede risposte echo ICMP, è possibile che tutti gli altri messaggi ICMP, ad esempio HOST ICMP non \_ raggiungibili, vengano recapitati all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ed802-169">While the application is expecting ICMP echo responses, all other ICMP messages (such as ICMP HOST\_UNREACHABLE) may also be delivered to this application.</span></span> <span data-ttu-id="ed802-170">Inoltre, se in un computer sono aperti più socket **\_ RAW** , è possibile recapitare gli stessi datagrammi a tutti i socket aperti.</span><span class="sxs-lookup"><span data-stu-id="ed802-170">Moreover, if several **SOCK\_RAW** sockets are open on a computer at the same time, the same datagrams may be delivered to all the open sockets.</span></span> <span data-ttu-id="ed802-171">Un'applicazione deve disporre di un meccanismo per riconoscere i datagrammi di interesse e ignorare tutti gli altri.</span><span class="sxs-lookup"><span data-stu-id="ed802-171">An application must have a mechanism to recognize the datagrams of interest and to ignore all others.</span></span> <span data-ttu-id="ed802-172">Per un programma PING, un meccanismo di questo tipo potrebbe includere il controllo dell'intestazione IP ricevuta per gli identificatori univoci nell'intestazione ICMP, ad esempio l'ID del processo dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ed802-172">For a PING program, such a mechanism might include inspecting the received IP header for unique identifiers in the ICMP header (the application's process ID, for example).</span></span>

> [!Note]  
> <span data-ttu-id="ed802-173">Per usare un socket di tipo **Sock \_ RAW** sono necessari privilegi amministrativi.</span><span class="sxs-lookup"><span data-stu-id="ed802-173">To use a socket of type **SOCK\_RAW** requires administrative privileges.</span></span> <span data-ttu-id="ed802-174">Gli utenti che eseguono applicazioni Winsock che utilizzano socket non elaborati devono essere membri del gruppo Administrators nel computer locale. in caso contrario, le chiamate al socket non elaborato avranno esito negativo con codice di errore [WSAEACCES](windows-sockets-error-codes-2.md).</span><span class="sxs-lookup"><span data-stu-id="ed802-174">Users running Winsock applications that use raw sockets must be a member of the Administrators group on the local computer, otherwise raw socket calls will fail with an error code of [WSAEACCES](windows-sockets-error-codes-2.md).</span></span> <span data-ttu-id="ed802-175">In Windows Vista e versioni successive, l'accesso per i socket non elaborati viene applicato al momento della creazione del socket.</span><span class="sxs-lookup"><span data-stu-id="ed802-175">On Windows Vista and later, access for raw sockets is enforced at socket creation.</span></span> <span data-ttu-id="ed802-176">Nelle versioni precedenti di Windows, l'accesso per i socket non elaborati viene applicato durante le altre operazioni di socket.</span><span class="sxs-lookup"><span data-stu-id="ed802-176">In earlier versions of Windows, access for raw sockets is enforced during other socket operations.</span></span>

 

## <a name="common-uses-of-raw-sockets"></a><span data-ttu-id="ed802-177">Usi comuni dei socket non elaborati</span><span class="sxs-lookup"><span data-stu-id="ed802-177">Common Uses of Raw Sockets</span></span>

<span data-ttu-id="ed802-178">Un uso comune dei socket non elaborati è la risoluzione dei problemi relativi alle applicazioni che devono esaminare i pacchetti e le intestazioni IP in modo dettagliato.</span><span class="sxs-lookup"><span data-stu-id="ed802-178">One common use of raw sockets are troubleshooting applications that need to examine IP packets and headers in detail.</span></span> <span data-ttu-id="ed802-179">Ad esempio, un socket non elaborato può essere usato con l' \_ IOCTL RCVALL di sio per consentire a un socket di ricevere tutti i pacchetti IPv4 o IPv6 che passano attraverso un'interfaccia di rete.</span><span class="sxs-lookup"><span data-stu-id="ed802-179">For example, a raw socket can be used with the SIO\_RCVALL IOCTL to enable a socket to receive all IPv4 or IPv6 packets passing through a network interface.</span></span> <span data-ttu-id="ed802-180">Per ulteriori informazioni, vedere la Guida di riferimento a [**sio \_ RCVALL**](/previous-versions/windows/desktop/legacy/ee309610(v=vs.85)) .</span><span class="sxs-lookup"><span data-stu-id="ed802-180">For more information, see the [**SIO\_RCVALL**](/previous-versions/windows/desktop/legacy/ee309610(v=vs.85)) reference.</span></span>

## <a name="limitations-on-raw-sockets"></a><span data-ttu-id="ed802-181">Limitazioni per i socket non elaborati</span><span class="sxs-lookup"><span data-stu-id="ed802-181">Limitations on Raw Sockets</span></span>

<span data-ttu-id="ed802-182">In Windows 7, Windows Vista, Windows XP con Service Pack 2 (SP2) e Windows XP con Service Pack 3 (SP3), la possibilità di inviare traffico su socket non elaborati è stata limitata in diversi modi:</span><span class="sxs-lookup"><span data-stu-id="ed802-182">On Windows 7, Windows Vista, Windows XP with Service Pack 2 (SP2), and Windows XP with Service Pack 3 (SP3), the ability to send traffic over raw sockets has been restricted in several ways:</span></span>

-   <span data-ttu-id="ed802-183">Impossibile inviare i dati TCP su socket non elaborati.</span><span class="sxs-lookup"><span data-stu-id="ed802-183">TCP data cannot be sent over raw sockets.</span></span>
-   <span data-ttu-id="ed802-184">Non è possibile inviare datagrammi UDP con un indirizzo di origine non valido su socket non elaborati.</span><span class="sxs-lookup"><span data-stu-id="ed802-184">UDP datagrams with an invalid source address cannot be sent over raw sockets.</span></span> <span data-ttu-id="ed802-185">L'indirizzo di origine IP per qualsiasi datagramma UDP in uscita deve esistere in un'interfaccia di rete o il datagramma viene eliminato.</span><span class="sxs-lookup"><span data-stu-id="ed802-185">The IP source address for any outgoing UDP datagram must exist on a network interface or the datagram is dropped.</span></span> <span data-ttu-id="ed802-186">Questa modifica è stata apportata per limitare la capacità del codice dannoso di creare attacchi Denial of Service distribuiti e limita la possibilità di inviare pacchetti falsificati (pacchetti TCP/IP con un indirizzo IP di origine contraffatto).</span><span class="sxs-lookup"><span data-stu-id="ed802-186">This change was made to limit the ability of malicious code to create distributed denial-of-service attacks and limits the ability to send spoofed packets (TCP/IP packets with a forged source IP address).</span></span>
-   <span data-ttu-id="ed802-187">Una chiamata alla funzione [**Bind**](/windows/desktop/api/winsock/nf-winsock-bind) con un socket non elaborato per il \_ protocollo TCP IPPROTO non è consentita.</span><span class="sxs-lookup"><span data-stu-id="ed802-187">A call to the [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function with a raw socket for the IPPROTO\_TCP protocol is not allowed.</span></span>
    > [!Note]  
    > <span data-ttu-id="ed802-188">La funzione [**Bind**](/windows/desktop/api/winsock/nf-winsock-bind) con un socket non elaborato è consentita per altri protocolli ( \_ ad esempio, IPPROTO IP, IPPROTO \_ UDP o IPPROTO \_ SCTP).</span><span class="sxs-lookup"><span data-stu-id="ed802-188">The [**bind**](/windows/desktop/api/winsock/nf-winsock-bind) function with a raw socket is allowed for other protocols (IPPROTO\_IP, IPPROTO\_UDP, or IPPROTO\_SCTP, for example).</span></span>

     

<span data-ttu-id="ed802-189">Queste restrizioni non si applicano a Windows Server 2008 R2, Windows Server 2008, Windows Server 2003 o a versioni del sistema operativo precedenti a Windows XP con SP2.</span><span class="sxs-lookup"><span data-stu-id="ed802-189">These above restrictions do not apply to Windows Server 2008 R2, Windows Server 2008 , Windows Server 2003, or to versions of the operating system earlier than Windows XP with SP2.</span></span>

> [!Note]  
> <span data-ttu-id="ed802-190">L'implementazione Microsoft di TCP/IP in Windows è in grado di aprire un socket UDP o TCP non elaborato in base alle restrizioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="ed802-190">The Microsoft implementation of TCP/IP on Windows is capable of opening a raw UDP or TCP socket based on the above restrictions.</span></span> <span data-ttu-id="ed802-191">Altri provider Winsock potrebbero non supportare l'utilizzo di socket non elaborati.</span><span class="sxs-lookup"><span data-stu-id="ed802-191">Other Winsock providers may not support the use of raw sockets.</span></span>

 

<span data-ttu-id="ed802-192">Esistono altre limitazioni per le applicazioni che usano un socket di tipo **Sock \_ RAW**.</span><span class="sxs-lookup"><span data-stu-id="ed802-192">There are further limitations for applications that use a socket of type **SOCK\_RAW**.</span></span> <span data-ttu-id="ed802-193">Ad esempio, tutte le applicazioni in ascolto di un protocollo specifico riceveranno tutti i pacchetti ricevuti per questo protocollo.</span><span class="sxs-lookup"><span data-stu-id="ed802-193">For example, all applications listening for a specific protocol will receive all packets received for this protocol.</span></span> <span data-ttu-id="ed802-194">Questo potrebbe non essere quello che si desidera per più applicazioni che utilizzano un protocollo.</span><span class="sxs-lookup"><span data-stu-id="ed802-194">This may not be what is desired for multiple applications using a protocol.</span></span> <span data-ttu-id="ed802-195">Questo non è adatto anche per le applicazioni ad alte prestazioni.</span><span class="sxs-lookup"><span data-stu-id="ed802-195">This is also not suitable for high-performance applications.</span></span> <span data-ttu-id="ed802-196">Per aggirare questi problemi, potrebbe essere necessario scrivere un driver del protocollo di rete Windows (driver di dispositivo) per il protocollo di rete specifico.</span><span class="sxs-lookup"><span data-stu-id="ed802-196">To get around these issues, it may be required to write a Windows network protocol driver (device driver) for the specific network protocol.</span></span> <span data-ttu-id="ed802-197">In Windows Vista e versioni successive, il kernel Winsock (WSK), una nuova interfaccia di programmazione di rete in modalità kernel indipendente dal trasporto, può essere utilizzata per scrivere un driver del protocollo di rete.</span><span class="sxs-lookup"><span data-stu-id="ed802-197">On Windows Vista and later, Winsock Kernel (WSK), a new transport-independent kernel mode Network Programming Interface can be used to write a network protocol driver.</span></span> <span data-ttu-id="ed802-198">In Windows Server 2003 e versioni precedenti è possibile scrivere un provider Transport Driver Interface (TDI) e una DLL Helper Winsock per supportare il protocollo di rete.</span><span class="sxs-lookup"><span data-stu-id="ed802-198">On Windows Server 2003 and earlier, a Transport Driver Interface (TDI) provider and a Winsock helper DLL can be written to support the network protocol.</span></span> <span data-ttu-id="ed802-199">Il protocollo di rete viene quindi aggiunto al catalogo Winsock come protocollo supportato.</span><span class="sxs-lookup"><span data-stu-id="ed802-199">The network protocol would then be added to the Winsock catalog as a supported protocol.</span></span> <span data-ttu-id="ed802-200">Questo consente a più applicazioni di aprire socket per questo protocollo specifico e il driver di dispositivo può tenere traccia del socket che riceve pacchetti ed errori specifici.</span><span class="sxs-lookup"><span data-stu-id="ed802-200">This allows multiple applications to open sockets for this specific protocol and the device driver can keep track of which socket receives specific packets and errors.</span></span> <span data-ttu-id="ed802-201">Per informazioni sulla scrittura di un provider di protocollo di rete, vedere le sezioni relative a WSK e TDI in Windows Driver Kit (WDK).</span><span class="sxs-lookup"><span data-stu-id="ed802-201">For information on writing a network protocol provider, see the sections on WSK and TDI in the Windows Driver Kit (WDK).</span></span>

<span data-ttu-id="ed802-202">Inoltre, le applicazioni devono essere consapevoli dell'effetto che le impostazioni del firewall possono avere durante l'invio e la ricezione di pacchetti usando socket non elaborati.</span><span class="sxs-lookup"><span data-stu-id="ed802-202">Applications also need to be aware of the impact that firewall settings may have on sending and receiving packets using raw sockets.</span></span>

 

 
