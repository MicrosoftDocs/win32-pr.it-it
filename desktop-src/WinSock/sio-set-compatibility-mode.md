---
description: Richiede il modo in cui lo stack di rete deve gestire determinati comportamenti per i quali la modalità predefinita di gestione del comportamento può essere diversa nelle versioni di Windows.
ms.assetid: 9574e21f-5ac4-4210-8031-2f3b07416813
title: Codice di controllo SIO_SET_COMPATIBILITY_MODE
ms.topic: reference
ms.date: 05/20/2019
req.target-min-winverclnt: Windows Vista [desktop apps only]
req.target-min-winversvr: Windows Server 2008 [desktop apps only]
api_location:
- mstcpip.h
ms.openlocfilehash: 58972595adb71a30728cb4817a80814cd987a6de
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106306902"
---
# <a name="sio_set_compatibility_mode-control-code"></a><span data-ttu-id="e3487-103">Codice di controllo SIO_SET_COMPATIBILITY_MODE</span><span class="sxs-lookup"><span data-stu-id="e3487-103">SIO_SET_COMPATIBILITY_MODE Control Code</span></span>

## <a name="description"></a><span data-ttu-id="e3487-104">Descrizione</span><span class="sxs-lookup"><span data-stu-id="e3487-104">Description</span></span>

<span data-ttu-id="e3487-105">Il codice di controllo della **\_ \_ \_ modalità di compatibilità set sio** richiede il modo in cui lo stack di rete deve gestire determinati comportamenti per i quali la modalità predefinita di gestione del comportamento può essere diversa nelle versioni di Windows.</span><span class="sxs-lookup"><span data-stu-id="e3487-105">The **SIO\_SET\_COMPATIBILITY\_MODE** control code requests how the networking stack should handle certain behaviors for which the default way of handling the behavior may differ across Windows versions.</span></span>

<span data-ttu-id="e3487-106">Per eseguire questa operazione, chiamare la funzione [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) o **WSPIoctl** con i parametri seguenti.</span><span class="sxs-lookup"><span data-stu-id="e3487-106">To perform this operation, call the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function with the following parameters.</span></span>

```cpp
int WSAIoctl(
  (socket) s,             // descriptor identifying a socket
  SIO_SET_COMPATIBILITY_MODE, // dwIoControlCode
  (LPVOID) lpvInBuffer,    // pointer to WSA_COMPATIBILITY_MODE struct
  (DWORD) cbInBuffer,      // length of input buffer
  NULL,         // output buffer
  0,       // size of output buffer
  (LPDWORD) lpcbBytesReturned,    // number of bytes returned
  (LPWSAOVERLAPPED) lpOverlapped,   // OVERLAPPED structure
  (LPWSAOVERLAPPED_COMPLETION_ROUTINE) lpCompletionRoutine,  // completion routine
);
```

```cpp
int WSPIoctl(
  (socket) s,             // descriptor identifying a socket
  SIO_SET_COMPATIBILITY_MODE, // dwIoControlCode
  (LPVOID) lpvInBuffer,    // pointer to WSA_COMPATIBILITY_MODE struct
  (DWORD) cbInBuffer,      // length of input buffer
  NULL,         // output buffer
  0,       // size of output buffer
  (LPDWORD) lpcbBytesReturned,    // number of bytes returned
  (LPWSAOVERLAPPED) lpOverlapped,   // OVERLAPPED structure
  (LPWSAOVERLAPPED_COMPLETION_ROUTINE) lpCompletionRoutine,  // completion routine
  (LPWSATHREADID) lpThreadId,   // a WSATHREADID structure
  (LPINT) lpErrno   // a pointer to the error code.
);
```

## <a name="parameters"></a><span data-ttu-id="e3487-107">Parametri</span><span class="sxs-lookup"><span data-stu-id="e3487-107">Parameters</span></span>

### <a name="s"></a><span data-ttu-id="e3487-108">s</span><span class="sxs-lookup"><span data-stu-id="e3487-108">s</span></span>

<span data-ttu-id="e3487-109">Descrittore che identifica un socket.</span><span class="sxs-lookup"><span data-stu-id="e3487-109">A descriptor identifying a socket.</span></span>

### <a name="dwiocontrolcode"></a><span data-ttu-id="e3487-110">dwIoControlCode</span><span class="sxs-lookup"><span data-stu-id="e3487-110">dwIoControlCode</span></span>

<span data-ttu-id="e3487-111">Codice di controllo per l'operazione.</span><span class="sxs-lookup"><span data-stu-id="e3487-111">The control code for the operation.</span></span>
<span data-ttu-id="e3487-112">Usare **la \_ \_ \_ modalità di compatibilità set sio** per questa operazione.</span><span class="sxs-lookup"><span data-stu-id="e3487-112">Use **SIO\_SET\_COMPATIBILITY\_MODE** for this operation.</span></span>

### <a name="lpvinbuffer"></a><span data-ttu-id="e3487-113">lpvInBuffer</span><span class="sxs-lookup"><span data-stu-id="e3487-113">lpvInBuffer</span></span>

<span data-ttu-id="e3487-114">Puntatore al buffer di input.</span><span class="sxs-lookup"><span data-stu-id="e3487-114">A pointer to the input buffer.</span></span>
<span data-ttu-id="e3487-115">Questo parametro deve puntare a una struttura della **\_ \_ modalità di compatibilità WSA** .</span><span class="sxs-lookup"><span data-stu-id="e3487-115">This parameter should point to a **WSA\_COMPATIBILITY\_MODE** structure.</span></span>

### <a name="cbinbuffer"></a><span data-ttu-id="e3487-116">cbInBuffer</span><span class="sxs-lookup"><span data-stu-id="e3487-116">cbInBuffer</span></span>

<span data-ttu-id="e3487-117">Dimensione, in byte, del buffer di input.</span><span class="sxs-lookup"><span data-stu-id="e3487-117">The size, in bytes, of the input buffer.</span></span>
<span data-ttu-id="e3487-118">Questo parametro deve essere maggiore o uguale alla dimensione della struttura della **\_ \_ modalità di compatibilità WSA** a cui punta il parametro *lpvInBuffer* .</span><span class="sxs-lookup"><span data-stu-id="e3487-118">This parameter should equal to or greater than the size of the **WSA\_COMPATIBILITY\_MODE** structure pointed to by the *lpvInBuffer* parameter.</span></span>

### <a name="lpvoutbuffer"></a><span data-ttu-id="e3487-119">lpvOutBuffer</span><span class="sxs-lookup"><span data-stu-id="e3487-119">lpvOutBuffer</span></span>

<span data-ttu-id="e3487-120">Puntatore al buffer di output.</span><span class="sxs-lookup"><span data-stu-id="e3487-120">A pointer to the output buffer.</span></span>
<span data-ttu-id="e3487-121">Questo parametro non è utilizzato per questa operazione.</span><span class="sxs-lookup"><span data-stu-id="e3487-121">This parameter is unused for this operation.</span></span>

### <a name="cboutbuffer"></a><span data-ttu-id="e3487-122">cbOutBuffer</span><span class="sxs-lookup"><span data-stu-id="e3487-122">cbOutBuffer</span></span>

<span data-ttu-id="e3487-123">Dimensione, in byte, del buffer di output.</span><span class="sxs-lookup"><span data-stu-id="e3487-123">The size, in bytes, of the output buffer.</span></span>
<span data-ttu-id="e3487-124">Questo parametro deve essere impostato su zero.</span><span class="sxs-lookup"><span data-stu-id="e3487-124">This parameter must be set to zero.</span></span>

### <a name="lpcbbytesreturned"></a><span data-ttu-id="e3487-125">lpcbBytesReturned</span><span class="sxs-lookup"><span data-stu-id="e3487-125">lpcbBytesReturned</span></span>

<span data-ttu-id="e3487-126">Puntatore a una variabile che riceve le dimensioni, in byte, dei dati archiviati nel buffer di output.</span><span class="sxs-lookup"><span data-stu-id="e3487-126">A pointer to a variable that receives the size, in bytes, of the data stored in the output buffer.</span></span>
<span data-ttu-id="e3487-127">Il parametro restituito punta a un valore **DWORD** pari a zero per questa operazione, poiché non è presente alcun output.</span><span class="sxs-lookup"><span data-stu-id="e3487-127">This returned parameter points to a **DWORD** value of zero for this operation, since there is no output.</span></span>

### <a name="lpvoverlapped"></a><span data-ttu-id="e3487-128">lpvOverlapped</span><span class="sxs-lookup"><span data-stu-id="e3487-128">lpvOverlapped</span></span>

<span data-ttu-id="e3487-129">Puntatore a una struttura [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) .</span><span class="sxs-lookup"><span data-stu-id="e3487-129">A pointer to a [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) structure.</span></span>

<span data-ttu-id="e3487-130">Se il socket *s* è stato creato senza l'attributo Overlapped, il parametro *lpOverlapped* viene ignorato.</span><span class="sxs-lookup"><span data-stu-id="e3487-130">If socket *s* was created without the overlapped attribute, the *lpOverlapped* parameter is ignored.</span></span>

<span data-ttu-id="e3487-131">Se *s* è stato aperto con l'attributo Overlapped e il parametro *LpOverlapped* non è **null**, l'operazione viene eseguita come operazione sovrapposta (asincrona).</span><span class="sxs-lookup"><span data-stu-id="e3487-131">If *s* was opened with the overlapped attribute and the *lpOverlapped* parameter is not **NULL**, the operation is performed as an overlapped (asynchronous) operation.</span></span>
<span data-ttu-id="e3487-132">In questo caso, il parametro *lpOverlapped* deve puntare a una struttura [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) valida.</span><span class="sxs-lookup"><span data-stu-id="e3487-132">In this case, *lpOverlapped* parameter must point to a valid [**WSAOVERLAPPED**](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped) structure.</span></span>

<span data-ttu-id="e3487-133">Per le operazioni sovrapposte, la funzione [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) o **WSPIoctl** restituisce immediatamente un risultato e il metodo di completamento appropriato viene segnalato al completamento dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="e3487-133">For overlapped operations, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns immediately, and the appropriate completion method is signaled when the operation has been completed.</span></span>
<span data-ttu-id="e3487-134">In caso contrario, la funzione non restituisce alcun risultato fino a quando l'operazione non viene completata o si verifica un errore.</span><span class="sxs-lookup"><span data-stu-id="e3487-134">Otherwise, the function does not return until the operation has been completed or an error occurs.</span></span>

### <a name="lpcompletionroutine"></a><span data-ttu-id="e3487-135">Il lpCompletionRoutine</span><span class="sxs-lookup"><span data-stu-id="e3487-135">lpCompletionRoutine</span></span>

<span data-ttu-id="e3487-136">Tipo: \_ in_opt \_ [ **LPWSAOVERLAPPED_COMPLETION_ROUTINE**](/windows/win32/api/winsock2/nc-winsock2-lpwsaoverlapped_completion_routine)</span><span class="sxs-lookup"><span data-stu-id="e3487-136">Type: \_In_opt\_ [**LPWSAOVERLAPPED_COMPLETION_ROUTINE**](/windows/win32/api/winsock2/nc-winsock2-lpwsaoverlapped_completion_routine)</span></span>

<span data-ttu-id="e3487-137">Puntatore alla routine di completamento chiamata quando l'operazione è stata completata (ignorata per i socket non sovrapposti).</span><span class="sxs-lookup"><span data-stu-id="e3487-137">A pointer to the completion routine called when the operation has been completed (ignored for non-overlapped sockets).</span></span>

### <a name="lpthreadid"></a><span data-ttu-id="e3487-138">lpThreadId</span><span class="sxs-lookup"><span data-stu-id="e3487-138">lpThreadId</span></span>

<span data-ttu-id="e3487-139">Puntatore a una struttura [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) che deve essere usata dal provider in una chiamata successiva a [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span><span class="sxs-lookup"><span data-stu-id="e3487-139">A pointer to a [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) structure to be used by the provider in a subsequent call to [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc).</span></span>
<span data-ttu-id="e3487-140">Il provider deve archiviare la struttura [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) a cui si fa riferimento (non il puntatore alla stessa) finché non viene restituito il risultato della funzione [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) .</span><span class="sxs-lookup"><span data-stu-id="e3487-140">The provider should store the referenced [**WSATHREADID**](/windows/desktop/api/ws2spi/ns-ws2spi-wsathreadid) structure (not the pointer to same) until after the [**WPUQueueApc**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpuqueueapc) function returns.</span></span>

<span data-ttu-id="e3487-141">**Nota**  Questo parametro è valido solo per la funzione **WSPIoctl** .</span><span class="sxs-lookup"><span data-stu-id="e3487-141">**Note**  This parameter applies only to the **WSPIoctl** function.</span></span>

### <a name="lperrno"></a><span data-ttu-id="e3487-142">lpErrno</span><span class="sxs-lookup"><span data-stu-id="e3487-142">lpErrno</span></span>

<span data-ttu-id="e3487-143">Puntatore al codice di errore.</span><span class="sxs-lookup"><span data-stu-id="e3487-143">A pointer to the error code.</span></span>

<span data-ttu-id="e3487-144">**Nota**  Questo parametro è valido solo per la funzione **WSPIoctl** .</span><span class="sxs-lookup"><span data-stu-id="e3487-144">**Note**  This parameter applies only to the **WSPIoctl** function.</span></span>

## <a name="return-value"></a><span data-ttu-id="e3487-145">Valore restituito</span><span class="sxs-lookup"><span data-stu-id="e3487-145">Return value</span></span>

<span data-ttu-id="e3487-146">Se l'operazione viene completata correttamente, la funzione [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) o **WSPIoctl** restituisce zero.</span><span class="sxs-lookup"><span data-stu-id="e3487-146">If the operation completes successfully, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns zero.</span></span>

<span data-ttu-id="e3487-147">Se l'operazione ha esito negativo o è in sospeso, la funzione [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) o **WSPIoctl** restituisce un **\_ errore socket**.</span><span class="sxs-lookup"><span data-stu-id="e3487-147">If the operation fails or is pending, the [**WSAIoctl**](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl) or **WSPIoctl** function returns **SOCKET\_ERROR**.</span></span>
<span data-ttu-id="e3487-148">Per ottenere informazioni estese sull'errore, chiamare [**WSAGetLastError**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).</span><span class="sxs-lookup"><span data-stu-id="e3487-148">To get extended error information, call [**WSAGetLastError**](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror).</span></span>

| <span data-ttu-id="e3487-149">Codice di errore</span><span class="sxs-lookup"><span data-stu-id="e3487-149">Error code</span></span> | <span data-ttu-id="e3487-150">Significato</span><span class="sxs-lookup"><span data-stu-id="e3487-150">Meaning</span></span> |
|------------|---------|
| <span data-ttu-id="e3487-151">**\_io WSA \_ in sospeso**</span><span class="sxs-lookup"><span data-stu-id="e3487-151">**WSA\_IO\_PENDING**</span></span> | <span data-ttu-id="e3487-152">Un'operazione sovrapposta è stata avviata correttamente e il completamento verrà indicato in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="e3487-152">An overlapped operation was successfully initiated and completion will be indicated at a later time.</span></span> |
| <span data-ttu-id="e3487-153">**\_operazione WSA \_ interrotta**</span><span class="sxs-lookup"><span data-stu-id="e3487-153">**WSA\_OPERATION\_ABORTED**</span></span> | <span data-ttu-id="e3487-154">Un'operazione sovrapposta è stata annullata a causa della chiusura del socket o dell'esecuzione del comando IOCTL **\_ Flush sio** .</span><span class="sxs-lookup"><span data-stu-id="e3487-154">An overlapped operation was canceled due to the closure of the socket or the execution of the **SIO\_FLUSH** IOCTL command.</span></span> |
| <span data-ttu-id="e3487-155">**WSAEFAULT**</span><span class="sxs-lookup"><span data-stu-id="e3487-155">**WSAEFAULT**</span></span> | <span data-ttu-id="e3487-156">Il parametro *lpOverlapped* o *il lpCompletionRoutine* non è interamente contenuto in una parte valida dello spazio degli indirizzi utente.</span><span class="sxs-lookup"><span data-stu-id="e3487-156">The *lpOverlapped* or *lpCompletionRoutine* parameter is not totally contained in a valid part of the user address space.</span></span> |
| <span data-ttu-id="e3487-157">**WSAEINPROGRESS**</span><span class="sxs-lookup"><span data-stu-id="e3487-157">**WSAEINPROGRESS**</span></span> | <span data-ttu-id="e3487-158">La funzione viene richiamata quando è in corso un callback.</span><span class="sxs-lookup"><span data-stu-id="e3487-158">The function is invoked when a callback is in progress.</span></span> |
| <span data-ttu-id="e3487-159">**WSAEINTR**</span><span class="sxs-lookup"><span data-stu-id="e3487-159">**WSAEINTR**</span></span> | <span data-ttu-id="e3487-160">Un'operazione di blocco è stata interrotta.</span><span class="sxs-lookup"><span data-stu-id="e3487-160">A blocking operation was interrupted.</span></span> |
| <span data-ttu-id="e3487-161">**WSAEINVAL**</span><span class="sxs-lookup"><span data-stu-id="e3487-161">**WSAEINVAL**</span></span> | <span data-ttu-id="e3487-162">Il parametro *dwIoControlCode* non è un comando valido oppure un parametro di input specificato non è accettabile oppure il comando non è applicabile al tipo di socket specificato.</span><span class="sxs-lookup"><span data-stu-id="e3487-162">The *dwIoControlCode* parameter is not a valid command, or a specified input parameter is not acceptable, or the command is not applicable to the type of socket specified.</span></span> <span data-ttu-id="e3487-163">Questo errore viene restituito se il parametro *cbInBuffer* è minore di sizeof la struttura **della \_ \_ modalità di compatibilità WSA** .</span><span class="sxs-lookup"><span data-stu-id="e3487-163">This error is returned if the *cbInBuffer* parameter is less than the sizeof the **WSA\_COMPATIBILITY\_MODE** structure.</span></span>
| <span data-ttu-id="e3487-164">**WSAENETDOWN**</span><span class="sxs-lookup"><span data-stu-id="e3487-164">**WSAENETDOWN**</span></span> | <span data-ttu-id="e3487-165">Il sottosistema di rete non è riuscito.</span><span class="sxs-lookup"><span data-stu-id="e3487-165">The network subsystem has failed.</span></span> |
| <span data-ttu-id="e3487-166">**WSAENOPROTOOPT**</span><span class="sxs-lookup"><span data-stu-id="e3487-166">**WSAENOPROTOOPT**</span></span> | <span data-ttu-id="e3487-167">L'opzione socket non è supportata nel protocollo specificato.</span><span class="sxs-lookup"><span data-stu-id="e3487-167">The socket option is not supported on the specified protocol.</span></span> |
| <span data-ttu-id="e3487-168">**WSAENOTCONN**</span><span class="sxs-lookup"><span data-stu-id="e3487-168">**WSAENOTCONN**</span></span> | <span data-ttu-id="e3487-169">Il Socket s non è connesso.</span><span class="sxs-lookup"><span data-stu-id="e3487-169">The socket s is not connected.</span></span> |
| <span data-ttu-id="e3487-170">**WSAENOTSOCK**</span><span class="sxs-lookup"><span data-stu-id="e3487-170">**WSAENOTSOCK**</span></span> | <span data-ttu-id="e3487-171">Il descrittore *s* non è un socket.</span><span class="sxs-lookup"><span data-stu-id="e3487-171">The descriptor *s* is not a socket.</span></span> |
| <span data-ttu-id="e3487-172">**ILWSAEOPNOTSUPP**</span><span class="sxs-lookup"><span data-stu-id="e3487-172">**WSAEOPNOTSUPP**</span></span> | <span data-ttu-id="e3487-173">Il comando IOCTL specificato non è supportato.</span><span class="sxs-lookup"><span data-stu-id="e3487-173">The specified IOCTL command is not supported.</span></span> <span data-ttu-id="e3487-174">Questo errore viene restituito se la **\_ modalità di \_ compatibilità \_ del set sio** non è supportata dal provider di trasporto.</span><span class="sxs-lookup"><span data-stu-id="e3487-174">This error is returned if the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL is not supported by the transport provider.</span></span> <span data-ttu-id="e3487-175">Questo errore viene restituito anche quando un tentativo di usare la **\_ modalità di \_ compatibilità \_ set sio** viene eseguito su un socket di datagramma.</span><span class="sxs-lookup"><span data-stu-id="e3487-175">This error is also returned when an attempt to use the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL is made on a datagram socket.</span></span> |

## <a name="remarks"></a><span data-ttu-id="e3487-176">Commenti</span><span class="sxs-lookup"><span data-stu-id="e3487-176">Remarks</span></span>

<span data-ttu-id="e3487-177">la **\_ modalità di \_ compatibilità \_ set sio** richiede il modo in cui lo stack di rete deve gestire determinati comportamenti per i quali la modalità predefinita di gestione del comportamento può essere diversa nelle versioni di Windows.</span><span class="sxs-lookup"><span data-stu-id="e3487-177">the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL requests how the networking stack should handle certain behaviors for which the default way of handling the behavior may differ across Windows versions.</span></span>
<span data-ttu-id="e3487-178">La struttura degli argomenti di input per la **\_ \_ \_ modalità di compatibilità set sio** è specificata nella struttura della **\_ \_ modalità di compatibilità WSA** definita nel file di intestazione *Mswsockdef. h* .</span><span class="sxs-lookup"><span data-stu-id="e3487-178">The input argument structure for **SIO\_SET\_COMPATIBILITY\_MODE** is specified in the **WSA\_COMPATIBILITY\_MODE** structure defined in the *Mswsockdef.h* header file.</span></span>
<span data-ttu-id="e3487-179">Un puntatore alla struttura **della \_ \_ modalità di compatibilità WSA** viene passato nel parametro *cbInBuffer* .</span><span class="sxs-lookup"><span data-stu-id="e3487-179">A pointer to the **WSA\_COMPATIBILITY\_MODE** structure is passed in the *cbInBuffer* parameter.</span></span>
<span data-ttu-id="e3487-180">Questa struttura viene definita nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="e3487-180">This structure is defined as follows:</span></span>

```cpp
// Need to #include <mswsock.h>

/* Argument structure for SIO_SET_COMPATIBILITY_MODE */
typedef struct _WSA_COMPATIBILITY_MODE {
    WSA_COMPATIBILITY_BEHAVIOR_ID BehaviorId;
    ULONG TargetOsVersion;
} WSA_COMPATIBILITY_MODE, *PWSA_COMPATIBILITY_MODE;
```

<span data-ttu-id="e3487-181">Il valore specificato nel membro **BehaviorId** indica il comportamento richiesto.</span><span class="sxs-lookup"><span data-stu-id="e3487-181">The value specified in the **BehaviorId** member indicates the behavior requested.</span></span>
<span data-ttu-id="e3487-182">Il valore specificato nel membro **TargetOSVersion** indica la versione di Windows richiesta per il comportamento.</span><span class="sxs-lookup"><span data-stu-id="e3487-182">The value specified in the **TargetOsVersion** member indicates the Windows version that is being requested for the behavior.</span></span>

<span data-ttu-id="e3487-183">Il membro **BehaviorId** può essere uno dei valori del tipo di **enumerazione \_ \_ \_ ID del comportamento di compatibilità WSA** definito nel file di intestazione *Mswsockdef. h* .</span><span class="sxs-lookup"><span data-stu-id="e3487-183">The **BehaviorId** member can be one of the values from the **WSA\_COMPATIBILITY\_BEHAVIOR\_ID** enumeration type defined in the *Mswsockdef.h* header file.</span></span>
<span data-ttu-id="e3487-184">I valori possibili per il membro **BehaviorId** sono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="e3487-184">The possible values for the **BehaviorId** member are as follows:</span></span>

| <span data-ttu-id="e3487-185">Termine</span><span class="sxs-lookup"><span data-stu-id="e3487-185">Term</span></span> | <span data-ttu-id="e3487-186">Descrizione</span><span class="sxs-lookup"><span data-stu-id="e3487-186">Description</span></span> |
|------|-------------|
| <span data-ttu-id="e3487-187">WsaBehaviorAll</span><span class="sxs-lookup"><span data-stu-id="e3487-187">WsaBehaviorAll</span></span> | <span data-ttu-id="e3487-188">Questa operazione equivale a richiedere tutti i possibili comportamenti compatibili definiti per l'ID del **\_ comportamento di \_ \_ compatibilità WSA**.</span><span class="sxs-lookup"><span data-stu-id="e3487-188">This is equivalent to requesting all of the possible compatible behaviors defined for **WSA\_COMPATIBILITY\_BEHAVIOR\_ID**.</span></span> |
| <span data-ttu-id="e3487-189">WsaBehaviorReceiveBuffering</span><span class="sxs-lookup"><span data-stu-id="e3487-189">WsaBehaviorReceiveBuffering</span></span> | <span data-ttu-id="e3487-190">Quando il membro **TargetOSVersion** è impostato su un valore per Windows Vista o versione successiva, le riduzioni delle dimensioni del buffer di ricezione TCP in questo socket con l'opzione socket **\_ RCVBUF** sono consentite anche dopo la creazione di una connessione TCP.</span><span class="sxs-lookup"><span data-stu-id="e3487-190">When the **TargetOsVersion** member is set to a value for Windows Vista or later, reductions to the TCP receive buffer size on this socket using the **SO\_RCVBUF** socket option are allowed even after a TCP connection has been establishment.</span></span> <span data-ttu-id="e3487-191">Quando il membro **TargetOSVersion** è impostato su un valore precedente a Windows Vista, le riduzioni delle dimensioni del buffer di ricezione TCP in questo socket con l'opzione socket **\_ RCVBUF** non sono consentite dopo lo stabilimento della connessione.</span><span class="sxs-lookup"><span data-stu-id="e3487-191">When the **TargetOsVersion** member is set to a value earlier than Windows Vista, reductions to the TCP receive buffer size on this socket using the **SO\_RCVBUF** socket option are not allowed after connection establishment.</span></span> |
| <span data-ttu-id="e3487-192">WsaBehaviorAutoTuning</span><span class="sxs-lookup"><span data-stu-id="e3487-192">WsaBehaviorAutoTuning</span></span> | <span data-ttu-id="e3487-193">Quando il membro **TargetOSVersion** è impostato su un valore per Windows Vista o versione successiva, l'ottimizzazione automatica della finestra di ricezione è abilitata e il fattore di scala della finestra TCP viene ridotto a 2 rispetto al valore predefinito di 8.</span><span class="sxs-lookup"><span data-stu-id="e3487-193">When the **TargetOsVersion** member is set to a value for Windows Vista or later, receive window auto-tuning is enabled and the TCP window scale factor is reduced to 2 from the default value of 8.</span></span> <span data-ttu-id="e3487-194">Quando **TargetOSVersion** è impostato su un valore precedente a Windows Vista, l'ottimizzazione automatica della finestra di ricezione è disabilitata.</span><span class="sxs-lookup"><span data-stu-id="e3487-194">When the **TargetOsVersion** is set to a value earlier than Windows Vista, receive window auto-tuning is disabled.</span></span> <span data-ttu-id="e3487-195">Anche l'opzione di scalabilità della finestra TCP è disabilitata e le dimensioni massime della finestra di ricezione true sono limitate a 65.535 byte.</span><span class="sxs-lookup"><span data-stu-id="e3487-195">The TCP window scaling option is also disabled and the maximum true receive window size is limited to 65,535 bytes.</span></span> <span data-ttu-id="e3487-196">Non è possibile negoziare l'opzione di scalabilità della finestra TCP sulla connessione anche se per questo socket è stata chiamata l'opzione **\_ RCVBUF** socket, che specifica un valore maggiore di 65.535 byte prima che sia stata stabilita la connessione.</span><span class="sxs-lookup"><span data-stu-id="e3487-196">The TCP window scaling option can't be negotiated on the connection even if the **SO\_RCVBUF** socket option was called on this socket specifying a value greater than 65,535 bytes before the connection was established.</span></span> |

<span data-ttu-id="e3487-197">Il membro **TargetOSVersion** può essere una delle costanti di versione NTDDI definite nel file di intestazione *Sdkddkver. h* .</span><span class="sxs-lookup"><span data-stu-id="e3487-197">The **TargetOsVersion** member can be one of the NTDDI version constants defined in the *Sdkddkver.h* header file.</span></span>
<span data-ttu-id="e3487-198">Alcuni dei valori possibili per il membro **TargetOSVersion** sono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="e3487-198">Some of the possible values for the **TargetOsVersion** member are as follows:</span></span>

| <span data-ttu-id="e3487-199">Termine</span><span class="sxs-lookup"><span data-stu-id="e3487-199">Term</span></span> | <span data-ttu-id="e3487-200">Descrizione</span><span class="sxs-lookup"><span data-stu-id="e3487-200">Description</span></span> |
|------|-------------|
| <span data-ttu-id="e3487-201">NTDDI \_ Longhorn</span><span class="sxs-lookup"><span data-stu-id="e3487-201">NTDDI\_LONGHORN</span></span> | <span data-ttu-id="e3487-202">Il comportamento di destinazione è l'impostazione predefinita per Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="e3487-202">The target behavior is the default for Windows Vista.</span></span> |
| <span data-ttu-id="e3487-203">\_WS03 NTDDI</span><span class="sxs-lookup"><span data-stu-id="e3487-203">NTDDI\_WS03</span></span> | <span data-ttu-id="e3487-204">Il comportamento di destinazione è l'impostazione predefinita per Windows Server 2003.</span><span class="sxs-lookup"><span data-stu-id="e3487-204">The target behavior is the default for Windows Server 2003.</span></span> |
| <span data-ttu-id="e3487-205">NTDDI \_ WinXP</span><span class="sxs-lookup"><span data-stu-id="e3487-205">NTDDI\_WINXP</span></span> | <span data-ttu-id="e3487-206">Il comportamento di destinazione è l'impostazione predefinita per Windows XP.</span><span class="sxs-lookup"><span data-stu-id="e3487-206">The target behavior is the default for Windows XP.</span></span> |
| <span data-ttu-id="e3487-207">\_Win2k NTDDI</span><span class="sxs-lookup"><span data-stu-id="e3487-207">NTDDI\_WIN2K</span></span> | <span data-ttu-id="e3487-208">Il comportamento di destinazione è l'impostazione predefinita per Windows 2000.</span><span class="sxs-lookup"><span data-stu-id="e3487-208">The target behavior is the default for Windows 2000.</span></span> |

<span data-ttu-id="e3487-209">L'effetto principale del membro **TargetOSVersion** è se il membro è impostato su un valore uguale o maggiore di **NTDDI \_ Longhorn**.</span><span class="sxs-lookup"><span data-stu-id="e3487-209">The primary impact of the **TargetOsVersion** member is whether this member is set to a value equal or greater than **NTDDI\_LONGHORN**.</span></span>

<span data-ttu-id="e3487-210">Le prestazioni TCP dipendono non solo dalla velocità di trasferimento, bensì dal prodotto della velocità di trasferimento e dal tempo di ritardo del round trip.</span><span class="sxs-lookup"><span data-stu-id="e3487-210">TCP performance depends not only on the transfer rate itself, but rather on the product of the transfer rate and the round-trip delay time.</span></span>
<span data-ttu-id="e3487-211">Questo prodotto a ritardo della larghezza di banda misura la quantità di dati che "riempiono la pipe".</span><span class="sxs-lookup"><span data-stu-id="e3487-211">This bandwidth-delay product measures the amount of data that would "fill the pipe".</span></span>
<span data-ttu-id="e3487-212">Questo prodotto con ritardo della larghezza di banda è lo spazio del buffer necessario al mittente e al destinatario per ottenere la velocità effettiva massima sulla connessione TCP sul percorso.</span><span class="sxs-lookup"><span data-stu-id="e3487-212">This bandwidth-delay product is the buffer space required at sender and receiver to obtain maximum throughput on the TCP connection over the path.</span></span>
<span data-ttu-id="e3487-213">Questo spazio buffer rappresenta la quantità di dati non riconosciuti che TCP deve gestire per garantire la completa pipeline.</span><span class="sxs-lookup"><span data-stu-id="e3487-213">This buffer space represents the amount of unacknowledged data that TCP must handle in order to keep the pipeline full.</span></span>
<span data-ttu-id="e3487-214">Si verificano problemi di prestazioni TCP quando il prodotto con ritardo della larghezza di banda è elevato.</span><span class="sxs-lookup"><span data-stu-id="e3487-214">TCP performance problems arise when the bandwidth-delay product is large.</span></span>
<span data-ttu-id="e3487-215">Un percorso di rete che opera in queste condizioni è spesso definito "pipe lungo e FAT".</span><span class="sxs-lookup"><span data-stu-id="e3487-215">A network path operating under these conditions is often called a "long, fat pipe".</span></span>
<span data-ttu-id="e3487-216">Gli esempi includono collegamenti satellitari per pacchetti ad alta capacità, collegamenti wireless ad alta velocità e collegamenti fibre ottici terrestri su lunghe distanze.</span><span class="sxs-lookup"><span data-stu-id="e3487-216">Examples include high-capacity packet satellite links, high-speed wireless links, and terrestrial fiber-optical links over long distances.</span></span>

<span data-ttu-id="e3487-217">L'intestazione TCP utilizza un campo dati a 16 bit (il campo finestra nell'intestazione del pacchetto TCP) per segnalare le dimensioni della finestra di ricezione al mittente.</span><span class="sxs-lookup"><span data-stu-id="e3487-217">The TCP header uses a 16-bit data field (the Window field in the TCP packet header) to report the receive window size to the sender.</span></span>
<span data-ttu-id="e3487-218">Pertanto, la finestra più grande che può essere utilizzata è 65.535 byte.</span><span class="sxs-lookup"><span data-stu-id="e3487-218">Therefore, the largest window that can be used is 65,535 bytes.</span></span>
<span data-ttu-id="e3487-219">Per ovviare a questa limitazione, è stata aggiunta un'opzione di estensione TCP per il protocollo TCP a prestazioni elevate per consentire la distribuzione di Windows con dimensioni maggiori di 65.535 byte.</span><span class="sxs-lookup"><span data-stu-id="e3487-219">To circumvent this limitation a TCP extension option, TCP Window Scale, was added for high-performance TCP to allow windows larger than 65,535 bytes.</span></span>
<span data-ttu-id="e3487-220">L'opzione di scalabilità della finestra TCP (WSopt) è definita nella RFC 1323 disponibile sul [sito Web IETF](https://www.ietf.org/rfc/rfc1122.txt).</span><span class="sxs-lookup"><span data-stu-id="e3487-220">The TCP Window Scale option (WSopt) is defined in RFC 1323 available at the [IETF website](https://www.ietf.org/rfc/rfc1122.txt).</span></span>
<span data-ttu-id="e3487-221">L'estensione WSopt espande la definizione della finestra TCP a 32 bit usando un fattore di scala logaritmico a un byte per estendere il campo della finestra a 16 bit nell'intestazione TCP.</span><span class="sxs-lookup"><span data-stu-id="e3487-221">The WSopt extension expands the definition of the TCP window to 32 bits using a one-byte logarithmic scale factor to extend the 16-bit Window field in the TCP header.</span></span>
<span data-ttu-id="e3487-222">L'estensione WSopt definisce un fattore di scala implicito (2 a una potenza), che viene usato per moltiplicare il valore delle dimensioni della finestra trovato in un'intestazione TCP per ottenere le dimensioni della finestra vera e propria.</span><span class="sxs-lookup"><span data-stu-id="e3487-222">The WSopt extension defines an implicit scale factor (2 to some power), which is used to multiply the window size value found in a TCP header to obtain the true window size.</span></span>
<span data-ttu-id="e3487-223">Pertanto, un fattore di scala della finestra pari a 8 comporterebbe una vera dimensione della finestra uguale al valore nel campo della finestra nell'intestazione TCP moltiplicato per 2 ^ 8 o 256.</span><span class="sxs-lookup"><span data-stu-id="e3487-223">So a window scale factor of 8 would result in a true window size equal to the value in the Window field in the TCP header multiplied by 2^8 or 256.</span></span>
<span data-ttu-id="e3487-224">Quindi, se il campo finestra nell'intestazione TCP è stato impostato sul valore massimo di 65.535 byte e il fattore di scala WSopt è stato negoziato con un valore pari a 8, le dimensioni della finestra true sarebbero 16.776.960 byte.</span><span class="sxs-lookup"><span data-stu-id="e3487-224">So if the Window field in the TCP header was set to the maximum value of 65,535 bytes and the WSopt scale factor was negotiated to a value of 8, the true window size would be 16,776,960 bytes.</span></span>

<span data-ttu-id="e3487-225">La dimensione effettiva della finestra di ricezione e pertanto il fattore di scala è determinata dallo spazio massimo del buffer di ricezione.</span><span class="sxs-lookup"><span data-stu-id="e3487-225">The true receive window size and therefore the scale factor is determined by the maximum receive buffer space.</span></span>
<span data-ttu-id="e3487-226">Questo spazio di buffer massimo corrisponde alla quantità di dati che un ricevitore TCP consente a un mittente TCP di inviare prima di dover attendere il riconoscimento.</span><span class="sxs-lookup"><span data-stu-id="e3487-226">This maximum buffer space is the amount of data that a TCP receiver allows a TCP sender to send before having to wait for an acknowledgement.</span></span>
<span data-ttu-id="e3487-227">Una volta stabilita la connessione, la dimensione della finestra di ricezione viene annunciata in ogni segmento TCP, ovvero il campo della finestra nell'intestazione TCP.</span><span class="sxs-lookup"><span data-stu-id="e3487-227">After the connection is established, the receive window size is advertised in each TCP segment (the Window field in the TCP header).</span></span>
<span data-ttu-id="e3487-228">L'annuncio della quantità massima di dati che il mittente può inviare è un meccanismo di controllo del flusso lato ricevitore che impedisce al mittente di inviare i dati che il ricevitore non può archiviare.</span><span class="sxs-lookup"><span data-stu-id="e3487-228">Advertising the maximum amount of data that the sender can send is a receiver-side flow control mechanism that prevents the sender from sending data that the receiver cannot store.</span></span>
<span data-ttu-id="e3487-229">Un host di invio può inviare solo la quantità massima di dati annunciata dal ricevitore prima di attendere un riconoscimento e l'aggiornamento delle dimensioni della finestra di ricezione.</span><span class="sxs-lookup"><span data-stu-id="e3487-229">A sending host can only send the maximum amount of data advertised by the receiver before waiting for an acknowledgment and a receive window size update.</span></span>

<span data-ttu-id="e3487-230">In Windows Server 2003 e Windows XP, lo spazio massimo del buffer di ricezione che rappresenta le dimensioni della finestra di ricezione per lo stack TCP/IP ha un valore predefinito basato sulla velocità di collegamento dell'interfaccia di invio.</span><span class="sxs-lookup"><span data-stu-id="e3487-230">On Windows Server 2003 and Windows XP, the maximum receive buffer space which represents the receive window size for the TCP/IP stack has a default value based on the link speed of the sending interface.</span></span>
<span data-ttu-id="e3487-231">Il valore effettivo si adatta automaticamente a incrementi delle dimensioni massime del segmento (MSS) negoziate durante lo stabilimento di connessione TCP.</span><span class="sxs-lookup"><span data-stu-id="e3487-231">The actual value automatically adjusts to even increments of the maximum segment size (MSS) negotiated during TCP connection establishment.</span></span>
<span data-ttu-id="e3487-232">Quindi, per un collegamento di 10 Mbit/sec, le dimensioni predefinite della finestra di ricezione vengono normalmente impostate su 16K bytes, mentre in un collegamento 100 MBit/sec la dimensione della finestra di ricezione predefinita viene impostata su 65.535 byte.</span><span class="sxs-lookup"><span data-stu-id="e3487-232">So for a 10 Mbit/sec link, the default receive window size would normally be set to 16K bytes, while on a 100 MBit/sec link the default receive window size would be set to 65,535 bytes.</span></span>

<span data-ttu-id="e3487-233">In Windows Server 2003 e Windows XP, le dimensioni massime della finestra di ricezione per lo stack TCP/IP possono essere configurate manualmente utilizzando i seguenti valori del registro di sistema in un'interfaccia specifica o per l'intero sistema:</span><span class="sxs-lookup"><span data-stu-id="e3487-233">On Windows Server 2003 and Windows XP, the true maximum receive window size for the TCP/IP stack can be manually configured using the following registry values on a specific interface or for the entire system:</span></span>

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\TCPWindowSize`

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\Interface\TCPWindowSize`

<span data-ttu-id="e3487-234">Il valore del registro di sistema per **TcpWindowSize** può essere impostato su un massimo di 65.535 byte quando non si usa l'estensione wsopt o un massimo di 1.073.741.823 byte quando viene usata l'estensione wsopt (è supportato un fattore di scala massimo 4).</span><span class="sxs-lookup"><span data-stu-id="e3487-234">The registry value for **TCPWindowSize** can be set to a maximum of 65,535 bytes when not using the WSopt extension or a maximum of 1,073,741,823 bytes when the WSopt extension is used (a maximum scale factor of 4 is supported).</span></span>
<span data-ttu-id="e3487-235">Senza il ridimensionamento delle finestre, un'applicazione può ottenere solo una velocità effettiva di circa 5 megabit al secondo (Mbps) in un percorso con un tempo di round trip di 100 millisecondi (RTT), indipendentemente dalla larghezza di banda del percorso.</span><span class="sxs-lookup"><span data-stu-id="e3487-235">Without window scaling, an application can only achieve a throughput of approximately 5 megabits per second (Mbps) on a path with a 100 millisecond round-trip time (RTT), regardless of the path bandwidth.</span></span>
<span data-ttu-id="e3487-236">Questa velocità effettiva può essere ridotta a più di un gigabit al secondo (Gbps) con la scalabilità della finestra, che consente a TCP di negoziare il fattore di scala per le dimensioni della finestra durante lo stabilimento della connessione.</span><span class="sxs-lookup"><span data-stu-id="e3487-236">This throughput can be scaled to over a gigabit per second (Gbps) with window scaling, which allows TCP to negotiate the scaling factor for the window size during connection establishment.</span></span>

<span data-ttu-id="e3487-237">In Windows Server 2003 e Windows XP è possibile abilitare l'estensione WSopt impostando il valore del registro di sistema seguente.</span><span class="sxs-lookup"><span data-stu-id="e3487-237">On Windows Server 2003 and Windows XP, the WSopt extension can be enabled by setting the following registry value.</span></span>

`HKEY_LOCAL_MACHINE\SYSTEM\Current Control Set\Services\Tcpip\Parameters\Tcp1323Opts`

<span data-ttu-id="e3487-238">Il valore del registro di sistema **TCP1323Opts** è un **DWORD** codificato in modo che, quando è impostato il bit 0, è abilitata l'estensione TCP wsopt.</span><span class="sxs-lookup"><span data-stu-id="e3487-238">The **Tcp1323Opts** registry value is a **DWORD** encoded such that when bit 0 is set, TCP WSopt extension is enabled.</span></span>
<span data-ttu-id="e3487-239">Quando è impostato il bit 1, è abilitata l'opzione TCP timestamp (TSopt) definita in RFC 1323.</span><span class="sxs-lookup"><span data-stu-id="e3487-239">When bit 1 is set, the TCP Timestamp option (TSopt) defined in RFC 1323 is enabled.</span></span>
<span data-ttu-id="e3487-240">Quindi, un valore pari a 1 o 3 consentirà di abilitare l'estensione WSopt.</span><span class="sxs-lookup"><span data-stu-id="e3487-240">So a value of either 1 or 3 will enable the WSopt extension.</span></span>

<span data-ttu-id="e3487-241">In Windows Server 2003 e Windows XP, il valore predefinito è che i valori del registro di sistema TCPWindowSize e Tcp1323Opts non vengono creati.</span><span class="sxs-lookup"><span data-stu-id="e3487-241">On Windows Server 2003 and Windows XP, the default is that the TCPWindowSize and the Tcp1323Opts registry values are not created.</span></span>
<span data-ttu-id="e3487-242">Per impostazione predefinita, l'estensione WSopt è disabilitata e le dimensioni della finestra di ricezione TCP sono impostate dal sistema su un valore massimo di 65.535 byte in base alla velocità del collegamento.</span><span class="sxs-lookup"><span data-stu-id="e3487-242">So the default is that the WSopt extension is disabled and the TCP receive window size is set by the system to maximum value of up to 65,535 bytes based on the link speed.</span></span>
<span data-ttu-id="e3487-243">Quando il ridimensionamento delle finestre è abilitato in Windows Server 2003 e Windows XP impostando il valore del registro di sistema Tcp1323Opts, la scalabilità della finestra in una connessione TCP viene comunque usata solo quando il mittente e il destinatario includono un'opzione di scalabilità della finestra TCP nel segmento Synchronize (SYN) inviato tra loro per negoziare un fattore di scala della finestra.</span><span class="sxs-lookup"><span data-stu-id="e3487-243">When window scaling is enabled on Windows Server 2003 and Windows XP by setting the Tcp1323Opts registry value, window scaling on a TCP connection is still only used when both the sender and receiver include a TCP window scale option in the synchronize (SYN) segment sent to each other to negotiate a window scale factor.</span></span>
<span data-ttu-id="e3487-244">Quando si usa la scalabilità della finestra in una connessione, il campo della finestra nell'intestazione TCP viene impostato su 65.535 byte e il fattore di scala della finestra viene usato per regolare la dimensione della finestra di ricezione reale verso l'alto in base al fattore di scala della finestra negoziato quando viene stabilita la connessione.</span><span class="sxs-lookup"><span data-stu-id="e3487-244">When window scaling is used on a connection, the Window field in the TCP header is set to 65,535 bytes and the window scale factor is used to adjust the true receive window size upward by the window scale factor negotiated when the connection is established.</span></span>

<span data-ttu-id="e3487-245">Un'applicazione può specificare le dimensioni della finestra di ricezione TCP per una connessione utilizzando l'opzione **\_ RCVBUF** socket.</span><span class="sxs-lookup"><span data-stu-id="e3487-245">An application can specify the TCP receive window size for a connection by using the **SO\_RCVBUF** socket option.</span></span>
<span data-ttu-id="e3487-246">Le dimensioni della finestra di ricezione TCP per un socket possono essere aumentate in qualsiasi momento usando **\_ RCVBUF**, ma è possibile ridurle solo prima di stabilire una connessione.</span><span class="sxs-lookup"><span data-stu-id="e3487-246">The TCP receive window size for a socket can be increased at any time using **SO\_RCVBUF**, but it can only be decreased prior to establishing a connection.</span></span>
<span data-ttu-id="e3487-247">Per usare il ridimensionamento delle finestre, un'applicazione deve specificare una dimensione della finestra maggiore di 65.535 byte quando si usa l'opzione **\_ RCVBUF** socket, prima che venga stabilita la connessione.</span><span class="sxs-lookup"><span data-stu-id="e3487-247">In order to use window scaling, an application must specify a window size larger than 65,535 bytes when using the **SO\_RCVBUF** socket option before the connection is established.</span></span>

<span data-ttu-id="e3487-248">Il valore ideale per le dimensioni della finestra di ricezione TCP è spesso difficile da determinare.</span><span class="sxs-lookup"><span data-stu-id="e3487-248">The ideal value for the TCP receive window size is often difficult to determine.</span></span>
<span data-ttu-id="e3487-249">Per riempire la capacità della rete tra il mittente e il destinatario, le dimensioni della finestra di ricezione devono essere impostate sul prodotto con ritardo della larghezza di banda per la connessione, ovvero la larghezza di banda moltiplicata per il tempo di round trip.</span><span class="sxs-lookup"><span data-stu-id="e3487-249">In order to fill the capacity of the network between the sender and receiver, the receive window size should be set to the bandwidth-delay product for the connection, which is the bandwidth multiplied by the round-trip time.</span></span>
<span data-ttu-id="e3487-250">Anche se un'applicazione è in grado di determinare correttamente il prodotto con ritardo della larghezza di banda, non è ancora noto quanto velocemente l'applicazione ricevente recupererà i dati dal buffer dei dati in ingresso (la velocità di recupero dell'applicazione).</span><span class="sxs-lookup"><span data-stu-id="e3487-250">Even if an application can correctly determine the bandwidth-delay product, it is still not known how quickly the receiving application will retrieve data from the incoming data buffer (the application retrieve rate).</span></span>
<span data-ttu-id="e3487-251">Nonostante il supporto per il ridimensionamento delle finestre TCP, le dimensioni massime della finestra di ricezione in Windows Server 2003 e Windows XP possono comunque limitare la velocità effettiva perché si tratta di una dimensione massima fissa per tutte le connessioni TCP (a meno che non sia specificata per ogni applicazione che usa **\_ RCVBUF**), che può migliorare la velocità effettiva per alcune connessioni e ridurre la velocità effettiva per altri</span><span class="sxs-lookup"><span data-stu-id="e3487-251">Despite the support for TCP window scaling, the maximum receive window size in Windows Server 2003 and Windows XP can still limit throughput because it is a fixed maximum size for all TCP connections (unless specified per application using **SO\_RCVBUF**), which can enhance throughput for some connections and decrease throughput for others.</span></span>
<span data-ttu-id="e3487-252">Inoltre, le dimensioni massime della finestra di ricezione fisse per una connessione TCP non variano in base alle condizioni di rete mutevoli.</span><span class="sxs-lookup"><span data-stu-id="e3487-252">Additionally, the fixed maximum receive window size for a TCP connection does not vary with changing network conditions.</span></span>

<span data-ttu-id="e3487-253">Per risolvere il problema della corretta determinazione del valore delle dimensioni massime della finestra di ricezione per una connessione TCP in base alle condizioni correnti della rete, lo stack TCP/IP in Windows Vista supporta una funzionalità di ottimizzazione automatica della finestra di ricezione.</span><span class="sxs-lookup"><span data-stu-id="e3487-253">To solve the problem of correctly determining the value of the maximum receive window size for a TCP connection based on the current conditions of the network, the TCP/IP stack in Windows Vista supports a receive window auto-tuning feature.</span></span>
<span data-ttu-id="e3487-254">Quando questa funzionalità è abilitata, l'ottimizzazione automatica della finestra di ricezione determina continuamente le dimensioni ottimali della finestra di ricezione misurando il prodotto con ritardo della larghezza di banda e la velocità di recupero dell'applicazione e regola le dimensioni massime massime della finestra di ricezione in base alle mutevoli condizioni della rete.</span><span class="sxs-lookup"><span data-stu-id="e3487-254">When this feature is enabled, receive window auto-tuning continually determines the optimal true receive window size by measuring the bandwidth-delay product and the application retrieve rate, and adjusts the true maximum receive window size based on changing network conditions.</span></span>
<span data-ttu-id="e3487-255">L'ottimizzazione automatica della finestra di ricezione Abilita l'estensione TCP WSopt per impostazione predefinita, consentendo fino a 16.776.960 byte per le dimensioni della finestra vera e propria.</span><span class="sxs-lookup"><span data-stu-id="e3487-255">Receive window auto-tuning enables the TCP WSopt extension by default, allowing up to 16,776,960 bytes for the true window size.</span></span>
<span data-ttu-id="e3487-256">Quando i dati passano attraverso la connessione, lo stack TCP/IP monitora la connessione, misura il prodotto con ritardo della larghezza di banda corrente per la connessione e la velocità di ricezione dell'applicazione e regola le dimensioni effettive della finestra di ricezione per ottimizzare la velocità effettiva.</span><span class="sxs-lookup"><span data-stu-id="e3487-256">As the data flows over the connection, the TCP/IP stack monitors the connection, measures the current bandwidth-delay product for the connection and the application receive rate, and adjusts the actual receive window size to optimize throughput.</span></span>
<span data-ttu-id="e3487-257">Lo stack TCP/IP modifica il valore del campo finestra nell'intestazione TCP in base alle condizioni della rete, perché il fattore di scala WSopt viene corretto quando la connessione viene stabilita per la prima volta.</span><span class="sxs-lookup"><span data-stu-id="e3487-257">The TCP/IP stack changes the value of the Window field in the TCP header based on network conditions, since the WSopt scale factor is fixed when the connection is first established.</span></span>

<span data-ttu-id="e3487-258">Lo stack TCP/IP in Windows Vista non utilizza più i valori del registro di sistema **TcpWindowSize** .</span><span class="sxs-lookup"><span data-stu-id="e3487-258">The TCP/IP stack in Windows Vista no longer uses the **TCPWindowSize** registry values.</span></span>
<span data-ttu-id="e3487-259">Con una migliore velocità effettiva tra i peer TCP, l'utilizzo della larghezza di banda di rete aumenta durante il trasferimento dei dati.</span><span class="sxs-lookup"><span data-stu-id="e3487-259">With better throughput between TCP peers, the utilization of network bandwidth increases during data transfer.</span></span>
<span data-ttu-id="e3487-260">Se tutte le applicazioni sono ottimizzate per la ricezione di dati TCP, l'utilizzo complessivo della rete può aumentare in modo sostanziale, rendendo l'utilizzo di QoS (Quality of Service) più importante nelle reti che operano alla capacità o quasi in prossimità.</span><span class="sxs-lookup"><span data-stu-id="e3487-260">If all the applications are optimized to receive TCP data, then the overall utilization of the network can increase substantially, making the use of Quality of Service (QoS) more important on networks that are operating at or near capacity.</span></span>

<span data-ttu-id="e3487-261">Il comportamento predefinito in Windows Vista per il buffer di ricezione quando la **\_ \_ \_ modalità di compatibilità set sio** non viene specificato con **WsaBehaviorReceiveBuffering** è che non sono consentite riduzioni delle dimensioni della finestra di ricezione che utilizzano l'opzione di socket **\_ RCVBUF** , dopo che è stata stabilita una connessione.</span><span class="sxs-lookup"><span data-stu-id="e3487-261">The default behavior on Windows Vista for receive buffering when **SIO\_SET\_COMPATIBILITY\_MODE** is not specified using **WsaBehaviorReceiveBuffering** is that no receive window size reductions using **SO\_RCVBUF** socket option are allowed after a connection is established.</span></span>

<span data-ttu-id="e3487-262">Il comportamento predefinito in Windows Vista per l'ottimizzazione automatica quando **la \_ \_ \_ modalità di compatibilità set sio** non viene specificato con **WsaBehaviorAutoTuning** è che lo stack effettuerà l'ottimizzazione automatica della finestra di ricezione usando un fattore di scala della finestra pari a 8.</span><span class="sxs-lookup"><span data-stu-id="e3487-262">The default behavior on Windows Vista for auto-tuning when **SIO\_SET\_COMPATIBILITY\_MODE** is not specified using **WsaBehaviorAutoTuning** is that the stack will do receive window auto-tuning using a window scale factor of 8.</span></span>
<span data-ttu-id="e3487-263">Si noti che se un'applicazione imposta una dimensione della finestra di ricezione valida con l'opzione **\_ RCVBUF** socket, lo stack utilizzerà la dimensione specificata e l'ottimizzazione automatica della ricezione della finestra sarà disabilitata.</span><span class="sxs-lookup"><span data-stu-id="e3487-263">Note that if an application sets a valid receive window size with the **SO\_RCVBUF** socket option, the stack will use the size specified and window receive auto-tuning will disabled.</span></span>
<span data-ttu-id="e3487-264">L'ottimizzazione automatica di Windows può anche essere disabilitata completamente usando il comando seguente, `netsh interface tcp set global autotuninglevel=disabled` , nel qual caso la specifica di **WsaBehaviorAutoTuning** non avrà alcun effetto.</span><span class="sxs-lookup"><span data-stu-id="e3487-264">Windows autotuning may also be disabled completely using the following command, `netsh interface tcp set global autotuninglevel=disabled`, in which case specifying **WsaBehaviorAutoTuning** will have no affect.</span></span>
<span data-ttu-id="e3487-265">L'ottimizzazione automatica della ricezione della finestra può anche essere disabilitata in base a criteri di gruppo impostati in Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="e3487-265">Window receive autotuning can also be disabled based on group policy set on Windows Server 2008.</span></span>

<span data-ttu-id="e3487-266">L'opzione **WsaBehaviorAutoTuning** è necessaria in Windows Vista per alcuni dispositivi gateway Internet e firewall che non supportano correttamente i flussi di dati per le connessioni TCP che usano l'estensione wsopt e un fattore di scala Windows.</span><span class="sxs-lookup"><span data-stu-id="e3487-266">The **WsaBehaviorAutoTuning** option is needed on Windows Vista for some Internet gateway devices and firewalls that do not correctly support data flows for TCP connections that use the WSopt extension and a windows scale factor.</span></span>
<span data-ttu-id="e3487-267">In Windows Vista, per impostazione predefinita, un ricevitore negozia un fattore di scala della finestra pari a 8 per una dimensione massima effettiva della finestra di 16.776.960 byte.</span><span class="sxs-lookup"><span data-stu-id="e3487-267">On Windows Vista, a receiver by default negotiates a window scale factor of 8 for a maximum true window size of 16,776,960 bytes.</span></span>
<span data-ttu-id="e3487-268">Quando i dati iniziano a propagarsi su un collegamento rapido, Windows inizia inizialmente con una dimensione della finestra vera 64 kilobyte impostando il campo finestra dell'intestazione TCP su 256 e impostando il fattore di scala della finestra su 8 nelle opzioni TCP (256 \* 2 ^ 8 = 64KB).</span><span class="sxs-lookup"><span data-stu-id="e3487-268">When data begins to flow on a fast link, Windows initially starts with a 64 Kilobyte true window size by setting the Window field of the TCP header to 256 and setting the window scale factor to 8 in the TCP options (256\*2^8=64KB).</span></span>
<span data-ttu-id="e3487-269">Alcuni dispositivi e firewall del gateway Internet ignorano il fattore di scalabilità della finestra e esaminano solo il campo finestra annunciata nell'intestazione TCP specificata come 256 e rilasciano i pacchetti in ingresso per la connessione che contiene più di 256 byte di dati TCP.</span><span class="sxs-lookup"><span data-stu-id="e3487-269">Some Internet gateway devices and firewalls ignore the window scale factor and only look at the advertised Window field in the TCP header specified as 256, and drop incoming packets for the connection that contain more than 256 bytes of TCP data.</span></span>
<span data-ttu-id="e3487-270">Per supportare la scalabilità della finestra di ricezione TCP, un dispositivo o un firewall gateway deve monitorare l'handshake TCP e tenere traccia del fattore di scala della finestra negoziato come parte dei dati di connessione TCP.</span><span class="sxs-lookup"><span data-stu-id="e3487-270">To support TCP receive window scaling, a gateway device or firewall must monitor the TCP handshake and track the negotiated window scale factor as part of the TCP connection data.</span></span>
<span data-ttu-id="e3487-271">Inoltre, alcune applicazioni e implementazioni di stack TCP su altre piattaforme ignorano l'estensione TCP WSopt e il fattore di scala della finestra.</span><span class="sxs-lookup"><span data-stu-id="e3487-271">Also some applications and TCP stack implementations on other platforms ignore the TCP WSopt extension and the window scaling factor.</span></span>
<span data-ttu-id="e3487-272">Quindi, l'host remoto che invia i dati può inviare i dati alla tariffa annunciata nel campo finestra dell'intestazione TCP (256 byte).</span><span class="sxs-lookup"><span data-stu-id="e3487-272">So the remote host sending the data may send data at the rate advertised in the Window field of the TCP header (256 bytes).</span></span>
<span data-ttu-id="e3487-273">Ciò può comportare la ricezione di dati molto lentamente dal ricevitore.</span><span class="sxs-lookup"><span data-stu-id="e3487-273">This can result in data being received very slowly by the receiver.</span></span>

<span data-ttu-id="e3487-274">Impostando il membro **BehaviorId** su **WsaBehaviorAutoTuning** e **TargetOSVersion** su Windows Vista, il fattore di scala della finestra viene ridotto a 2, in modo che il campo finestra nell'intestazione TCP venga inizialmente impostato su 16.384 byte e il fattore di scala della finestra sia impostato su 2 per una dimensione di ricezione della finestra true iniziale di 64K byte.</span><span class="sxs-lookup"><span data-stu-id="e3487-274">Setting the **BehaviorId** member to **WsaBehaviorAutoTuning** and the **TargetOsVersion** to Windows Vista reduces the window scale factor to 2, so the Window field in the TCP header is initially set to 16,384 bytes and the window scale factor is set to 2 for an initial true window receive size of 64K bytes.</span></span>
<span data-ttu-id="e3487-275">La funzionalità di ottimizzazione automatica della finestra può quindi aumentare le dimensioni di ricezione della finestra true fino a 262.140 byte impostando il campo finestra nell'intestazione TCP su 65.535 byte.</span><span class="sxs-lookup"><span data-stu-id="e3487-275">The window auto-tuning feature can then increase the true window receive size up to 262,140 bytes by setting the Window field in the TCP header to 65,535 bytes.</span></span>
<span data-ttu-id="e3487-276">Un'applicazione deve impostare la **\_ modalità di \_ compatibilità \_ del set sio** non appena viene creato un socket, perché questa opzione non ha senso o si applica dopo l'invio di un SYN.</span><span class="sxs-lookup"><span data-stu-id="e3487-276">An application should set the **SIO\_SET\_COMPATIBILITY\_MODE** IOCTL as soon as a socket is created, since this option doesn't make sense or apply after a SYN is sent.</span></span>
<span data-ttu-id="e3487-277">L'impostazione di questa opzione ha lo stesso effetto del comando seguente: `netsh interface tcp set global autotuninglevel=highlyrestricted`</span><span class="sxs-lookup"><span data-stu-id="e3487-277">Setting this option has the same impact as the following command: `netsh interface tcp set global autotuninglevel=highlyrestricted`</span></span>

<span data-ttu-id="e3487-278">Si noti che il file di intestazione *Mswsockdef. h* viene incluso automaticamente in *mswsock. h* o *Netiodef. h* e non deve essere utilizzato direttamente.</span><span class="sxs-lookup"><span data-stu-id="e3487-278">Note that the *Mswsockdef.h* header file is automatically included in *Mswsock.h* or *Netiodef.h*, and should not be used directly.</span></span>

## <a name="see-also"></a><span data-ttu-id="e3487-279">Vedi anche</span><span class="sxs-lookup"><span data-stu-id="e3487-279">See also</span></span>

[<span data-ttu-id="e3487-280">**presa**</span><span class="sxs-lookup"><span data-stu-id="e3487-280">**socket**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-socket)

[<span data-ttu-id="e3487-281">**WSAGetLastError**</span><span class="sxs-lookup"><span data-stu-id="e3487-281">**WSAGetLastError**</span></span>](/windows/desktop/api/winsock/nf-winsock-wsagetlasterror)

[<span data-ttu-id="e3487-282">**WSAGetOverlappedResult**</span><span class="sxs-lookup"><span data-stu-id="e3487-282">**WSAGetOverlappedResult**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsagetoverlappedresult)

[<span data-ttu-id="e3487-283">**WSAIoctl**</span><span class="sxs-lookup"><span data-stu-id="e3487-283">**WSAIoctl**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsaioctl)

[<span data-ttu-id="e3487-284">**WSAOVERLAPPED**</span><span class="sxs-lookup"><span data-stu-id="e3487-284">**WSAOVERLAPPED**</span></span>](/windows/desktop/api/winsock2/ns-winsock2-wsaoverlapped)

[<span data-ttu-id="e3487-285">**WSASocketA**</span><span class="sxs-lookup"><span data-stu-id="e3487-285">**WSASocketA**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsasocketa)

[<span data-ttu-id="e3487-286">**WSASocketW**</span><span class="sxs-lookup"><span data-stu-id="e3487-286">**WSASocketW**</span></span>](/windows/desktop/api/winsock2/nf-winsock2-wsasocketw)
