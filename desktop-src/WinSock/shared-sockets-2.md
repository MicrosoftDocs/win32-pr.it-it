---
description: La funzione WSADuplicateSocket è stata introdotta per abilitare la condivisione dei socket tra i processi.
ms.assetid: f7cf40e9-f3a6-4b62-8a78-df25464e2365
title: Socket condivisi
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fb6753b01f6389254756254d2ebe196af8e2a8a3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103967085"
---
# <a name="shared-sockets"></a><span data-ttu-id="7efe1-103">Socket condivisi</span><span class="sxs-lookup"><span data-stu-id="7efe1-103">Shared Sockets</span></span>

<span data-ttu-id="7efe1-104">La funzione [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) è stata introdotta per abilitare la condivisione dei socket tra i processi.</span><span class="sxs-lookup"><span data-stu-id="7efe1-104">The [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) function is introduced to enable socket sharing across processes.</span></span> <span data-ttu-id="7efe1-105">Un processo di origine chiama **WSADuplicateSocket** per ottenere una speciale struttura di [**\_ informazioni WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) per un identificatore del processo di destinazione.</span><span class="sxs-lookup"><span data-stu-id="7efe1-105">A source process calls **WSADuplicateSocket** to obtain a special [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure for a target process identifier.</span></span> <span data-ttu-id="7efe1-106">Usa un meccanismo di comunicazione interprocesso (IPC) per passare il contenuto di questa struttura a un processo di destinazione.</span><span class="sxs-lookup"><span data-stu-id="7efe1-106">It uses some interprocess communications (IPC) mechanism to pass the contents of this structure to a target process.</span></span> <span data-ttu-id="7efe1-107">Il processo di destinazione USA quindi la struttura di **\_ informazioni WSAPROTOCOL** in una chiamata a [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket).</span><span class="sxs-lookup"><span data-stu-id="7efe1-107">The target process then uses the **WSAPROTOCOL\_INFO** structure in a call to [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket).</span></span> <span data-ttu-id="7efe1-108">Il descrittore di socket restituito da questa funzione sarà un descrittore di socket aggiuntivo a un socket sottostante che viene quindi condiviso.</span><span class="sxs-lookup"><span data-stu-id="7efe1-108">The socket descriptor returned by this function will be an additional socket descriptor to an underlying socket which thus becomes shared.</span></span> <span data-ttu-id="7efe1-109">I socket possono essere condivisi tra i thread di un determinato processo senza usare la funzione **WSADuplicateSocket** perché un descrittore di socket è valido in tutti i thread di un processo.</span><span class="sxs-lookup"><span data-stu-id="7efe1-109">Sockets can be shared among threads in a given process without using the **WSADuplicateSocket** function because a socket descriptor is valid in all threads of a process.</span></span>

<span data-ttu-id="7efe1-110">I due (o più) descrittori che fanno riferimento a un socket condiviso possono essere usati in modo indipendente per quanto riguarda l'I/O.</span><span class="sxs-lookup"><span data-stu-id="7efe1-110">The two (or more) descriptors that reference a shared socket can be used independently as far as I/O is concerned.</span></span> <span data-ttu-id="7efe1-111">Tuttavia, l'interfaccia Winsock non implementa alcun tipo di controllo di accesso, quindi i processi devono coordinare qualsiasi operazione su un socket condiviso.</span><span class="sxs-lookup"><span data-stu-id="7efe1-111">However, the Winsock interface does not implement any type of access control, so the processes must coordinate any operations on a shared socket.</span></span> <span data-ttu-id="7efe1-112">Un esempio tipico di socket di condivisione è quello di usare un processo per creare socket e stabilire connessioni.</span><span class="sxs-lookup"><span data-stu-id="7efe1-112">A typical example of sharing sockets is to use one process for creating sockets and establishing connections.</span></span> <span data-ttu-id="7efe1-113">Questo processo passa quindi i socket ad altri processi responsabili dello scambio di informazioni.</span><span class="sxs-lookup"><span data-stu-id="7efe1-113">This process then hands off sockets to other processes that are responsible for information exchange.</span></span>

<span data-ttu-id="7efe1-114">La funzione [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) crea descrittori di socket e non il socket sottostante.</span><span class="sxs-lookup"><span data-stu-id="7efe1-114">The [**WSADuplicateSocket**](/windows/desktop/api/Winsock2/nf-winsock2-wsaduplicatesocketa) function creates socket descriptors and not the underlying socket.</span></span> <span data-ttu-id="7efe1-115">Di conseguenza, tutti gli Stati associati a un socket vengono mantenuti in comune in tutti i descrittori.</span><span class="sxs-lookup"><span data-stu-id="7efe1-115">As a result, all the states associated with a socket are held in common across all the descriptors.</span></span> <span data-ttu-id="7efe1-116">Ad esempio, un'operazione [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) eseguita utilizzando un descrittore viene successivamente visualizzata utilizzando un [**getsockopt**](/windows/desktop/api/winsock/nf-winsock-getsockopt) da uno o tutti i descrittori.</span><span class="sxs-lookup"><span data-stu-id="7efe1-116">For example, a [**setsockopt**](/windows/desktop/api/winsock/nf-winsock-setsockopt) operation performed using one descriptor is subsequently visible using a [**getsockopt**](/windows/desktop/api/winsock/nf-winsock-getsockopt) from any or all descriptors.</span></span> <span data-ttu-id="7efe1-117">Un processo può chiamare [**chiamata closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) su un socket duplicato e il descrittore verrà deallocato.</span><span class="sxs-lookup"><span data-stu-id="7efe1-117">A process can call [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) on a duplicated socket and the descriptor will become deallocated.</span></span> <span data-ttu-id="7efe1-118">Il socket sottostante, tuttavia, rimane aperto fino a quando non viene chiamato **chiamata closesocket** con l'ultimo descrittore rimanente.</span><span class="sxs-lookup"><span data-stu-id="7efe1-118">The underlying socket, however, remains open until **closesocket** is called with the last remaining descriptor.</span></span>

<span data-ttu-id="7efe1-119">La notifica sui socket condivisi è soggetta ai vincoli usuali delle funzioni [**WSAAsyncSelect**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect) e [**WSAEventSelect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaeventselect) .</span><span class="sxs-lookup"><span data-stu-id="7efe1-119">Notification on shared sockets is subject to the usual constraints of the [**WSAAsyncSelect**](/windows/desktop/api/winsock/nf-winsock-wsaasyncselect) and [**WSAEventSelect**](/windows/desktop/api/Winsock2/nf-winsock2-wsaeventselect) functions.</span></span> <span data-ttu-id="7efe1-120">Quando si esegue una di queste chiamate utilizzando uno dei descrittori condivisi, viene annullata la registrazione di eventi precedente per il socket, indipendentemente dal descrittore utilizzato per effettuare la registrazione.</span><span class="sxs-lookup"><span data-stu-id="7efe1-120">Issuing either of these calls using any of the shared descriptors cancels any previous event registration for the socket, regardless of which descriptor was used to make that registration.</span></span> <span data-ttu-id="7efe1-121">Quindi, ad esempio, non sarebbe possibile avere un processo di ricezione di eventi di \_ lettura FD ed elaborare B ricevere \_ eventi di scrittura FD.</span><span class="sxs-lookup"><span data-stu-id="7efe1-121">Thus, for example, it would not be possible to have process A receive FD\_READ events and process B receive FD\_WRITE events.</span></span> <span data-ttu-id="7efe1-122">Per le situazioni in cui è necessario un coordinamento rigoroso, è consigliabile che gli sviluppatori usino i thread anziché processi distinti.</span><span class="sxs-lookup"><span data-stu-id="7efe1-122">For situations when such tight coordination is required, it is suggested that developers use threads instead of separate processes.</span></span>

 

 
