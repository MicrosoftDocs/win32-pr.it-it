---
description: Condivisione di socket in Windows Sockets (Winsock).
ms.assetid: dad31820-6f60-4c3b-9cdf-e301a5ffce48
title: Socket condivisi in SPI
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 21ff0d8f73d2bd9de942d17de7f9564158d1810c
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103880682"
---
# <a name="shared-sockets-in-the-spi"></a><span data-ttu-id="b5c79-103">Socket condivisi in SPI</span><span class="sxs-lookup"><span data-stu-id="b5c79-103">Shared Sockets in the SPI</span></span>

<span data-ttu-id="b5c79-104">La condivisione dei socket tra i processi in Windows Sockets viene implementata come indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="b5c79-104">Socket sharing between processes in Windows Sockets is implemented as follows.</span></span> <span data-ttu-id="b5c79-105">Un processo di origine chiama [**WSPDuplicateSocket**](/previous-versions/windows/hardware/network/ff566282(v=vs.85)) per ottenere una speciale struttura di [**\_ informazioni di WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) .</span><span class="sxs-lookup"><span data-stu-id="b5c79-105">A source process calls [**WSPDuplicateSocket**](/previous-versions/windows/hardware/network/ff566282(v=vs.85)) to obtain a special [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure.</span></span> <span data-ttu-id="b5c79-106">Usa un meccanismo di comunicazione interprocesso (IPC) per passare il contenuto di questa struttura a un processo di destinazione.</span><span class="sxs-lookup"><span data-stu-id="b5c79-106">It uses some interprocess communications (IPC) mechanism to pass the contents of this structure to a target process.</span></span> <span data-ttu-id="b5c79-107">Il processo di destinazione USA quindi la struttura di **\_ informazioni WSAPROTOCOL** in una chiamata a [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket).</span><span class="sxs-lookup"><span data-stu-id="b5c79-107">The target process then uses the **WSAPROTOCOL\_INFO** structure in a call to [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket).</span></span> <span data-ttu-id="b5c79-108">Il descrittore di socket restituito da questa funzione sarà un descrittore di socket aggiuntivo a un socket sottostante che viene quindi condiviso.</span><span class="sxs-lookup"><span data-stu-id="b5c79-108">The socket descriptor returned by this function will be an additional socket descriptor to an underlying socket which thus becomes shared.</span></span>

<span data-ttu-id="b5c79-109">È responsabilità del provider di servizi eseguire qualsiasi operazione necessaria nel contesto del processo di origine e creare una struttura di [**\_ informazioni WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) che verrà riconosciuta quando verrà visualizzata successivamente come parametro di [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) nel contesto dei processi di destinazione.</span><span class="sxs-lookup"><span data-stu-id="b5c79-109">It is the service provider's responsibility to perform whatever operations are needed in the source process context and to create a [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure that will be recognized when it subsequently appears as a parameter to [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) in the target processes' context.</span></span> <span data-ttu-id="b5c79-110">Il membro **dwProviderReserved** della struttura **di \_ informazioni WSAPROTOCOL** è disponibile per l'uso da parte del provider di servizi e può essere usato per archiviare informazioni utili sul contesto, incluso un handle duplicato.</span><span class="sxs-lookup"><span data-stu-id="b5c79-110">The **dwProviderReserved** member of the **WSAPROTOCOL\_INFO** structure is available for the service provider's use, and may be used to store any useful context information, including a duplicated handle.</span></span>

<span data-ttu-id="b5c79-111">Questo meccanismo è progettato per essere appropriato per le versioni di Windows a thread singolo e preemptive con multithreading.</span><span class="sxs-lookup"><span data-stu-id="b5c79-111">This mechanism is designed to be appropriate for both single-threaded and preemptive multithreaded versions of Windows.</span></span> <span data-ttu-id="b5c79-112">Si noti tuttavia che i socket possono essere condivisi tra i thread di un determinato processo senza usare la funzione [**WSPDuplicateSocket**](/previous-versions/windows/hardware/network/ff566282(v=vs.85)) , perché un descrittore di socket è valido in tutti i thread di un processo.</span><span class="sxs-lookup"><span data-stu-id="b5c79-112">Note however, that sockets may be shared among threads in a given process without using the [**WSPDuplicateSocket**](/previous-versions/windows/hardware/network/ff566282(v=vs.85)) function, since a socket descriptor is valid in all of a process' threads.</span></span>

<span data-ttu-id="b5c79-113">Come descritto nell' [allocazione di descrittori](descriptor-allocation-2.md)di sezione, quando vengono allocati nuovi descrittori di socket, i provider IFS devono chiamare [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle) e i provider non IFS devono chiamare [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle).</span><span class="sxs-lookup"><span data-stu-id="b5c79-113">As is described in section [Descriptor Allocation](descriptor-allocation-2.md), when new socket descriptors are allocated IFS providers must call [**WPUModifyIFSHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpumodifyifshandle) and non-IFS providers must call [**WPUCreateSocketHandle**](/windows/desktop/api/Ws2spi/nf-ws2spi-wpucreatesockethandle).</span></span>

<span data-ttu-id="b5c79-114">Nella tabella seguente è illustrato un possibile scenario per la definizione e l'utilizzo di un socket condiviso in una modalità di inserimento.</span><span class="sxs-lookup"><span data-stu-id="b5c79-114">One possible scenario for establishing and using a shared socket in a handoff mode is illustrated in the following table.</span></span>

| <span data-ttu-id="b5c79-115">Processo di origine</span><span class="sxs-lookup"><span data-stu-id="b5c79-115">Source process</span></span>                                                                                                                          | <span data-ttu-id="b5c79-116">IPC</span><span class="sxs-lookup"><span data-stu-id="b5c79-116">IPC</span></span>    | <span data-ttu-id="b5c79-117">Processo di destinazione</span><span class="sxs-lookup"><span data-stu-id="b5c79-117">Destination process</span></span>                                                           |
|-----------------------------------------------------------------------------------------------------------------------------------------|--------|-------------------------------------------------------------------------------|
| <span data-ttu-id="b5c79-118">1) [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket), [**WSPConnect**](/previous-versions/windows/hardware/network/ff566275(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="b5c79-118">1) [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket), [**WSPConnect**](/previous-versions/windows/hardware/network/ff566275(v=vs.85))</span></span>                                                                 |        |                                                                               |
| <span data-ttu-id="b5c79-119">2) richiede l'identificatore del processo di destinazione.</span><span class="sxs-lookup"><span data-stu-id="b5c79-119">2) Requests target process identifier.</span></span>                                                                                                  | ==> |                                                                               |
|                                                                                                                                         |        | <span data-ttu-id="b5c79-120">3) riceve la richiesta dell'identificatore del processo e risponde.</span><span class="sxs-lookup"><span data-stu-id="b5c79-120">3) Receives process identifier request and responds.</span></span>                          |
| <span data-ttu-id="b5c79-121">4) riceve l'identificatore del processo.</span><span class="sxs-lookup"><span data-stu-id="b5c79-121">4) Receives process identifier.</span></span>                                                                                                         | <== |                                                                               |
| <span data-ttu-id="b5c79-122">5) chiama [**WSPDuplicateSocket**](/previous-versions/windows/hardware/network/ff566282(v=vs.85)) per ottenere una struttura speciale per le [**\_ informazioni di WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) .</span><span class="sxs-lookup"><span data-stu-id="b5c79-122">5) Calls [**WSPDuplicateSocket**](/previous-versions/windows/hardware/network/ff566282(v=vs.85)) to get a special [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure.</span></span> |        |                                                                               |
| <span data-ttu-id="b5c79-123">6) Invia la struttura delle **\_ informazioni di WSAPROTOCOL** alla destinazione.</span><span class="sxs-lookup"><span data-stu-id="b5c79-123">6) Sends **WSAPROTOCOL\_INFO** structure to target.</span></span>                                                                                     |        |                                                                               |
|                                                                                                                                         | ==> | <span data-ttu-id="b5c79-124">7) riceve la struttura di [**\_ informazioni WSAPROTOCOL**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) .</span><span class="sxs-lookup"><span data-stu-id="b5c79-124">7) Receives [**WSAPROTOCOL\_INFO**](/windows/win32/api/winsock2/ns-winsock2-wsaprotocol_infoa) structure.</span></span>        |
|                                                                                                                                         |        | <span data-ttu-id="b5c79-125">8) chiama [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) per creare il descrittore di socket condiviso.</span><span class="sxs-lookup"><span data-stu-id="b5c79-125">8) Calls [**WSPSocket**](/windows/desktop/api/Ws2spi/nc-ws2spi-lpwspsocket) to create shared socket descriptor.</span></span> |
|                                                                                                                                         |        | <span data-ttu-id="b5c79-126">9) usa il socket condiviso per lo scambio di dati.</span><span class="sxs-lookup"><span data-stu-id="b5c79-126">9)Uses shared socket for data exchange.</span></span>                                       |
| <span data-ttu-id="b5c79-127">10) [ **WSPClosesocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="b5c79-127">10) [**WSPClosesocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span></span>                                                                                          | <== |                                                                               |



 

 

 
