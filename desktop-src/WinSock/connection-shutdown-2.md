---
description: Di seguito viene descritto l'evento imprevisto per l'arresto di una connessione socket stabilita.
ms.assetid: 052e04a4-5290-4dca-af7a-cd590ebfbe15
title: Arresto della connessione
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: bbde0cfe4c3a97435c2412d28970107f830308fd
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103879225"
---
# <a name="connection-shutdown"></a><span data-ttu-id="af6ee-103">Arresto della connessione</span><span class="sxs-lookup"><span data-stu-id="af6ee-103">Connection Shutdown</span></span>

<span data-ttu-id="af6ee-104">Di seguito viene descritto l'evento imprevisto per l'arresto di una connessione socket stabilita.</span><span class="sxs-lookup"><span data-stu-id="af6ee-104">The following describes operations incident to shutting down an established socket connection.</span></span>

## <a name="initiating-shutdown-sequence"></a><span data-ttu-id="af6ee-105">Avvio della sequenza di arresto</span><span class="sxs-lookup"><span data-stu-id="af6ee-105">Initiating Shutdown Sequence</span></span>

<span data-ttu-id="af6ee-106">Una connessione socket può essere disattivata in uno dei diversi modi.</span><span class="sxs-lookup"><span data-stu-id="af6ee-106">A socket connection can be taken down in one of several ways.</span></span> <span data-ttu-id="af6ee-107">[**WSPShutdown**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) *(con uguale* a SD \_ Send o SD \_ Both) e [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) possono essere usati per avviare un normale arresto della connessione.</span><span class="sxs-lookup"><span data-stu-id="af6ee-107">[**WSPShutdown**](/previous-versions/windows/desktop/legacy/ms742294(v=vs.85)) (with *how* equal to SD\_SEND or SD\_BOTH), and [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) may be used to initiate a graceful connection shutdown.</span></span> <span data-ttu-id="af6ee-108">[**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) può essere usato per avviare un arresto normale o abortivo, a seconda delle opzioni Linger richiamate dalla chiusura di un socket.</span><span class="sxs-lookup"><span data-stu-id="af6ee-108">[**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85)) can be used to initiate either a graceful or abortive shutdown, depending on the linger options invoked by the closing a socket.</span></span> <span data-ttu-id="af6ee-109">Vedere di seguito per altre informazioni sulle chiusure aggraziate e interrotte e sulle opzioni Linger.</span><span class="sxs-lookup"><span data-stu-id="af6ee-109">See below for more information about graceful and abortive shutdowns, and linger options.</span></span>

## <a name="indicating-remote-shutdown"></a><span data-ttu-id="af6ee-110">Indicazione dell'arresto remoto</span><span class="sxs-lookup"><span data-stu-id="af6ee-110">Indicating Remote Shutdown</span></span>

<span data-ttu-id="af6ee-111">I provider di servizi indicano la connessione teardown avviata dalla parte remota tramite l' \_ evento di chiusura della rete FD.</span><span class="sxs-lookup"><span data-stu-id="af6ee-111">Service providers indicate connection teardown that is initiated by the remote party through the FD\_CLOSE network event.</span></span> <span data-ttu-id="af6ee-112">L'arresto normale è indicato anche tramite [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) quando il numero di byte letti è 0 per i protocolli di flusso di byte oppure tramite un codice di errore restituito di WSAEDISCON nativo per i protocolli orientati ai messaggi.</span><span class="sxs-lookup"><span data-stu-id="af6ee-112">Graceful shutdown is also be indicated through [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) when the number of bytes read is 0 for byte-stream protocols, or through a return error code of WSAEDISCON for message-oriented protocols.</span></span> <span data-ttu-id="af6ee-113">In ogni caso, un codice di errore restituito da **WSPRecv** di WSAECONNRESET indica un arresto ininterrotto.</span><span class="sxs-lookup"><span data-stu-id="af6ee-113">In any case, a **WSPRecv** return error code of WSAECONNRESET indicates an abortive shutdown.</span></span>

## <a name="exchanging-user-data-at-shutdown-time"></a><span data-ttu-id="af6ee-114">Scambio di dati utente al momento dell'arresto</span><span class="sxs-lookup"><span data-stu-id="af6ee-114">Exchanging User Data at Shutdown Time</span></span>

<span data-ttu-id="af6ee-115">Al momento della connessione teardown, è anche possibile (per i protocolli che lo supportano) per scambiare dati utente tra gli endpoint.</span><span class="sxs-lookup"><span data-stu-id="af6ee-115">At connection teardown time, it is also possible (for protocols that support this) to exchange user data between the endpoints.</span></span> <span data-ttu-id="af6ee-116">La fine che avvia teardown può chiamare [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) per indicare che non è necessario inviare altri dati e causare l'avvio della sequenza di teardown di connessione.</span><span class="sxs-lookup"><span data-stu-id="af6ee-116">The end that initiates the teardown can call [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to indicate that no more data is to be sent and cause the connection teardown sequence to be initiated.</span></span> <span data-ttu-id="af6ee-117">Per alcuni protocolli, parte di questa sequenza di teardown è il recapito dei dati di disconnessione dall'iniziatore teardown.</span><span class="sxs-lookup"><span data-stu-id="af6ee-117">For certain protocols, part of this teardown sequence is the delivery of disconnect data from the teardown initiator.</span></span> <span data-ttu-id="af6ee-118">Dopo aver ricevuto l'avviso che l'estremità remota ha avviato la sequenza teardown (in genere tramite l' \_ indicazione di chiusura FD), è possibile chiamare la funzione [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) per ricevere i dati di disconnessione (se presenti).</span><span class="sxs-lookup"><span data-stu-id="af6ee-118">After receiving notice that the remote end has initiated the teardown sequence (typically through the FD\_CLOSE indication), the [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) function may be called to receive the disconnect data (if any).</span></span>

<span data-ttu-id="af6ee-119">Per illustrare il modo in cui possono essere usati i dati di disconnessione, considerare lo scenario seguente.</span><span class="sxs-lookup"><span data-stu-id="af6ee-119">To illustrate how disconnect data might be used, consider the following scenario.</span></span> <span data-ttu-id="af6ee-120">La metà client di un'applicazione client/server è responsabile della terminazione di una connessione socket.</span><span class="sxs-lookup"><span data-stu-id="af6ee-120">The client half of a client/server application is responsible for terminating a socket connection.</span></span> <span data-ttu-id="af6ee-121">Coincidere con la terminazione fornita (tramite dati di disconnessione) il numero totale di transazioni elaborate con il server.</span><span class="sxs-lookup"><span data-stu-id="af6ee-121">Coincident with the termination it provides (through disconnect data) the total number of transactions it processed with the server.</span></span> <span data-ttu-id="af6ee-122">Il server a sua volta risponde con il totale complessivo cumulativo di transazioni elaborate con tutti i client.</span><span class="sxs-lookup"><span data-stu-id="af6ee-122">The server in turn responds with the cumulative grand total of transactions that it has processed with all clients.</span></span> <span data-ttu-id="af6ee-123">La sequenza di chiamate e indicazioni potrebbe verificarsi come illustrato nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="af6ee-123">The sequence of calls and indications might occur as shown in the following table.</span></span>

| <span data-ttu-id="af6ee-124">Lato client</span><span class="sxs-lookup"><span data-stu-id="af6ee-124">Client side</span></span>                                                                                                               | <span data-ttu-id="af6ee-125">Sul lato server</span><span class="sxs-lookup"><span data-stu-id="af6ee-125">Server side</span></span>                                                                                                                             |
|---------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="af6ee-126">(1) richiama [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) per concludere la sessione e fornire il totale della transazione.</span><span class="sxs-lookup"><span data-stu-id="af6ee-126">(1) Invokes [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to conclude session and supply transaction total.</span></span>            |                                                                                                                                         |
|                                                                                                                           | <span data-ttu-id="af6ee-127">(2) Ottiene \_ la chiusura FD o [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) con un valore restituito pari a zero o WSAEDISCON nativo che indica l'arresto normale in corso.</span><span class="sxs-lookup"><span data-stu-id="af6ee-127">(2) Gets FD\_CLOSE, or [**WSPRecv**](/previous-versions/windows/hardware/network/ff566309(v=vs.85)) with a return value of zero or WSAEDISCON indicating graceful shutdown in progress.</span></span> |
|                                                                                                                           | <span data-ttu-id="af6ee-128">(3) richiama [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) per ottenere il totale della transazione del client.</span><span class="sxs-lookup"><span data-stu-id="af6ee-128">(3) Invokes [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) to get client's transaction total.</span></span>                                         |
|                                                                                                                           | <span data-ttu-id="af6ee-129">(4) calcola il totale complessivo cumulativo di tutte le transazioni.</span><span class="sxs-lookup"><span data-stu-id="af6ee-129">(4) Computes cumulative grand total of all transactions.</span></span>                                                                                |
|                                                                                                                           | <span data-ttu-id="af6ee-130">(5) richiama [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) per trasmettere il totale complessivo.</span><span class="sxs-lookup"><span data-stu-id="af6ee-130">(5) Invokes [**WSPSendDisconnect**](/previous-versions/windows/desktop/legacy/ms742290(v=vs.85)) to transmit grand total.</span></span>                                                   |
| <span data-ttu-id="af6ee-131">(6) riceve l' \_ indicazione di chiusura FD.</span><span class="sxs-lookup"><span data-stu-id="af6ee-131">(6) Receives FD\_CLOSE indication.</span></span>                                                                                        | <span data-ttu-id="af6ee-132">(5') richiama [ **WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="af6ee-132">(5') Invokes [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span></span>                                                                                 |
| <span data-ttu-id="af6ee-133">(7) richiama [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) per ricevere e archiviare il totale complessivo delle transazioni.</span><span class="sxs-lookup"><span data-stu-id="af6ee-133">(7) Invokes [**WSPRecvDisconnect**](/previous-versions/windows/desktop/legacy/ms742285(v=vs.85)) to receive and store cumulative grand total of transactions.</span></span> |                                                                                                                                         |
|                                                                                                                           | <span data-ttu-id="af6ee-134">(8) richiama [ **WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span><span class="sxs-lookup"><span data-stu-id="af6ee-134">(8) Invokes [**WSPCloseSocket**](/previous-versions/windows/hardware/network/ff566273(v=vs.85))</span></span>                                                                                  |



 

<span data-ttu-id="af6ee-135">Step (5') deve seguire step (5), ma non ha una relazione di intervallo con i passaggi (6), (7) o (8).</span><span class="sxs-lookup"><span data-stu-id="af6ee-135">Step (5') must follow step (5), but has no timing relationship with steps (6), (7), or (8).</span></span>

 

 
