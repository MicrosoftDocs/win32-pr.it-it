---
description: Il materiale seguente viene fornito come spiegazione per l'oggetto dell'arresto delle connessioni socket che chiudono i socket. È importante distinguere la differenza tra l'arresto di una connessione socket e la chiusura di un socket.
ms.assetid: 383747c3-dd3d-4a18-b4e8-2815d5e5c0c7
title: Arresto normale, opzioni Linger e chiusura del socket
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 59f6791eaa803da561fc9f3c175b5270950cbec3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104226090"
---
# <a name="graceful-shutdown-linger-options-and-socket-closure"></a><span data-ttu-id="30736-104">Arresto normale, opzioni Linger e chiusura del socket</span><span class="sxs-lookup"><span data-stu-id="30736-104">Graceful Shutdown, Linger Options, and Socket Closure</span></span>

<span data-ttu-id="30736-105">Il materiale seguente viene fornito come spiegazione per l'oggetto dell'arresto delle connessioni socket che chiudono i socket.</span><span class="sxs-lookup"><span data-stu-id="30736-105">The following material is provided as clarification for the subject of shutting down socket connections closing the sockets.</span></span> <span data-ttu-id="30736-106">È importante distinguere la differenza tra l'arresto di una connessione socket e la chiusura di un socket.</span><span class="sxs-lookup"><span data-stu-id="30736-106">It is important to distinguish the difference between shutting down a socket connection and closing a socket.</span></span>

<span data-ttu-id="30736-107">L'arresto di una connessione socket comporta uno scambio di messaggi di protocollo tra i due endpoint, in seguito definito sequenza di arresto.</span><span class="sxs-lookup"><span data-stu-id="30736-107">Shutting down a socket connection involves an exchange of protocol messages between the two endpoints, hereafter referred to as a shutdown sequence.</span></span> <span data-ttu-id="30736-108">Sono definite due classi generali di sequenze di arresto: aggraziate e interrotte (chiamate anche rigide).</span><span class="sxs-lookup"><span data-stu-id="30736-108">Two general classes of shutdown sequences are defined: graceful and abortive (also called hard).</span></span> <span data-ttu-id="30736-109">In una sequenza di arresto normale, tutti i dati che sono stati accodati ma non ancora trasmessi possono essere inviati prima della chiusura della connessione.</span><span class="sxs-lookup"><span data-stu-id="30736-109">In a graceful shutdown sequence, any data that has been queued, but not yet transmitted can be sent prior to the connection being closed.</span></span> <span data-ttu-id="30736-110">In caso di arresto anomalo, tutti i dati non inviati andranno perduti.</span><span class="sxs-lookup"><span data-stu-id="30736-110">In an abortive shutdown, any unsent data is lost.</span></span> <span data-ttu-id="30736-111">L'occorrenza di una sequenza di arresto (normale o abortica) può essere usata anche per fornire un' \_ indicazione di chiusura FD alle applicazioni associate, a indicare che è in corso un arresto.</span><span class="sxs-lookup"><span data-stu-id="30736-111">The occurrence of a shutdown sequence (graceful or abortive) can also be used to provide an FD\_CLOSE indication to the associated applications signifying that a shutdown is in progress.</span></span>

<span data-ttu-id="30736-112">La chiusura di un socket, d'altra parte, causa la deallocazione dell'handle del socket, in modo che l'applicazione non possa più fare riferimento o utilizzare il socket in alcun modo.</span><span class="sxs-lookup"><span data-stu-id="30736-112">Closing a socket, on the other hand, causes the socket handle to become deallocated so that the application can no longer reference or use the socket in any manner.</span></span>

<span data-ttu-id="30736-113">In Windows Sockets è possibile usare sia la funzione [**Shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) che la funzione [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) per avviare una sequenza di arresto, mentre la funzione [**chiamata closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) viene usata per deallocare gli handle di socket e liberare le risorse associate.</span><span class="sxs-lookup"><span data-stu-id="30736-113">In Windows Sockets, both the [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) function, and the [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect) function can be used to initiate a shutdown sequence, while the [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) function is used to deallocate socket handles and free up any associated resources.</span></span> <span data-ttu-id="30736-114">Tuttavia, si verifica una certa confusione dal fatto che la funzione **chiamata closesocket** causa implicitamente la generazione di una sequenza di arresto, se non è già avvenuta.</span><span class="sxs-lookup"><span data-stu-id="30736-114">Some amount of confusion arises, however, from the fact that the **closesocket** function implicitly causes a shutdown sequence to occur if it has not already happened.</span></span> <span data-ttu-id="30736-115">In realtà, si tratta di una pratica di programmazione piuttosto comune che si basa su questa funzionalità e per usare **chiamata closesocket** per avviare la sequenza di arresto e deallocare l'handle del socket.</span><span class="sxs-lookup"><span data-stu-id="30736-115">In fact, it has become a rather common programming practice to rely on this feature and to use **closesocket** to both initiate the shutdown sequence and deallocate the socket handle.</span></span>

<span data-ttu-id="30736-116">Per semplificare questo utilizzo, l'interfaccia Sockets fornisce i controlli tramite il meccanismo di opzione del socket che consente al programmatore di indicare se la sequenza di arresto implicita deve essere normale o interrotta e anche se la funzione [**chiamata closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) deve rimanere sospesa (non immediatamente completata) per consentire il completamento di una sequenza di arresto normale.</span><span class="sxs-lookup"><span data-stu-id="30736-116">To facilitate this usage, the sockets interface provides for controls by way of the socket option mechanism that allow the programmer to indicate whether the implicit shutdown sequence should be graceful or abortive, and also whether the [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) function should linger (that is not complete immediately) to allow time for a graceful shutdown sequence to complete.</span></span> <span data-ttu-id="30736-117">Queste distinzioni importanti e le ramificazioni dell'utilizzo di **chiamata closesocket** in questo modo non sono ancora ampiamente comprese.</span><span class="sxs-lookup"><span data-stu-id="30736-117">These important distinctions and the ramifications of using **closesocket** in this manner are still not widely understood.</span></span>

<span data-ttu-id="30736-118">Se si stabiliscono i valori appropriati per le opzioni del socket in modo \_ che vengano sospesi e quindi \_ DONTLINGER, è possibile ottenere i tipi di comportamento seguenti con la funzione [**chiamata closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) :</span><span class="sxs-lookup"><span data-stu-id="30736-118">By establishing appropriate values for the socket options SO\_LINGER and SO\_DONTLINGER, the following types of behavior can be obtained with the [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) function:</span></span>

-   <span data-ttu-id="30736-119">Sequenza di arresto interrotta, ritorno immediato da [**chiamata closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span><span class="sxs-lookup"><span data-stu-id="30736-119">Abortive shutdown sequence, immediate return from [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span>
-   <span data-ttu-id="30736-120">Arresto normale, ritardo della restituzione fino al completamento della sequenza di arresto o scadenza di un intervallo di tempo specificato.</span><span class="sxs-lookup"><span data-stu-id="30736-120">Graceful shutdown, delaying return until either shutdown sequence completes or a specified time interval elapses.</span></span> <span data-ttu-id="30736-121">Se l'intervallo di tempo scade prima del completamento della sequenza di arresto normale, si verifica una sequenza di arresto interrotta e [**chiamata closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) restituisce.</span><span class="sxs-lookup"><span data-stu-id="30736-121">If the time interval expires before the graceful shutdown sequence completes, an abortive shutdown sequence occurs, and [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) returns.</span></span>
-   <span data-ttu-id="30736-122">Arresto normale, restituzione immediata, che consente di completare la sequenza di arresto in background.</span><span class="sxs-lookup"><span data-stu-id="30736-122">Graceful shutdown, immediate return—allowing the shutdown sequence to complete in the background.</span></span> <span data-ttu-id="30736-123">Sebbene questo sia il comportamento predefinito, l'applicazione non ha modo di sapere quando (o se) la sequenza di arresto normale viene effettivamente completata.</span><span class="sxs-lookup"><span data-stu-id="30736-123">Although this is the default behavior, the application has no way of knowing when (or whether) the graceful shutdown sequence actually completes.</span></span>

<span data-ttu-id="30736-124">L'uso delle opzioni per il \_ socket DONTLINGER e così via e \_ la struttura [**Linger**](/windows/desktop/api/winsock/ns-winsock-linger) associata viene descritto più dettagliatamente nelle sezioni di riferimento sulle [**Opzioni del socket di \_ socket Sol**](sol-socket-socket-options.md) e sulla struttura **Linger** .</span><span class="sxs-lookup"><span data-stu-id="30736-124">The use of the SO\_LINGER and SO\_DONTLINGER socket options and the associated [**linger**](/windows/desktop/api/winsock/ns-winsock-linger) structure is discussed in more detail in the reference sections on [**SOL\_SOCKET Socket Options**](sol-socket-socket-options.md) and the **linger** structure.</span></span>

<span data-ttu-id="30736-125">Una tecnica che può essere usata per ridurre al minimo la possibilità di problemi che si verificano durante la connessione teardown consiste nell'evitare di basarsi su un arresto implicito avviato da [**chiamata closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span><span class="sxs-lookup"><span data-stu-id="30736-125">One technique that can be used to minimize the chance of problems occurring during connection teardown is to avoid relying on an implicit shutdown being initiated by [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span> <span data-ttu-id="30736-126">Usare invece una delle due funzioni di arresto esplicite, [**Shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) o [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect).</span><span class="sxs-lookup"><span data-stu-id="30736-126">Instead, use one of the two explicit shutdown functions, [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown) or [**WSASendDisconnect**](/windows/desktop/api/Winsock2/nf-winsock2-wsasenddisconnect).</span></span> <span data-ttu-id="30736-127">Questa operazione a sua volta causa \_ la ricezione di un'indicazione di chiusura FD da parte dell'applicazione peer, a indicare che tutti i dati in sospeso sono stati ricevuti.</span><span class="sxs-lookup"><span data-stu-id="30736-127">This in turn causes an FD\_CLOSE indication to be received by the peer application indicating that all pending data has been received.</span></span> <span data-ttu-id="30736-128">Per illustrare questo problema, nella tabella seguente vengono illustrate le funzioni che verrebbero richiamate dai componenti client e server di un'applicazione, in cui il client è responsabile dell'avvio di un arresto normale.</span><span class="sxs-lookup"><span data-stu-id="30736-128">To illustrate this, the following table shows the functions that would be invoked by the client and server components of an application, where the client is responsible for initiating a graceful shutdown.</span></span>

| <span data-ttu-id="30736-129">Lato client</span><span class="sxs-lookup"><span data-stu-id="30736-129">Client side</span></span>                                                                                                                | <span data-ttu-id="30736-130">Sul lato server</span><span class="sxs-lookup"><span data-stu-id="30736-130">Server side</span></span>                                                                                           |
|----------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="30736-131">(1) richiama [**Shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown)(s, SD \_ Send) per segnalare la fine della sessione e il client non ha più dati da inviare.</span><span class="sxs-lookup"><span data-stu-id="30736-131">(1) Invokes [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown)(s, SD\_SEND) to signal end of session and that client has no more data to send.</span></span> |                                                                                                       |
|                                                                                                                            | <span data-ttu-id="30736-132">(2) riceve \_ la chiusura FD, che indica l'arresto normale in corso e la ricezione di tutti i dati.</span><span class="sxs-lookup"><span data-stu-id="30736-132">(2) Receives FD\_CLOSE, indicating graceful shutdown in progress and that all data has been received.</span></span> |
|                                                                                                                            | <span data-ttu-id="30736-133">(3) Invia tutti i dati di risposta rimanenti.</span><span class="sxs-lookup"><span data-stu-id="30736-133">(3) Sends any remaining response data.</span></span>                                                                |
| <span data-ttu-id="30736-134">(solo per importanza temporale locale) Ottiene FD \_ Read e chiama [**ricezione**](/windows/desktop/api/winsock/nf-winsock-recv) per ottenere tutti i dati di risposta inviati dal server.</span><span class="sxs-lookup"><span data-stu-id="30736-134">(local timing significance only) Gets FD\_READ and calls [**recv**](/windows/desktop/api/winsock/nf-winsock-recv) to get any response data sent by server .</span></span>  | <span data-ttu-id="30736-135">(4) richiama [**Shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown)(s, SD \_ Send) per indicare che il server non ha più dati da inviare.</span><span class="sxs-lookup"><span data-stu-id="30736-135">(4) Invokes [**shutdown**](/windows/desktop/api/winsock/nf-winsock-shutdown)(s, SD\_SEND) to indicate server has no more data to send.</span></span>  |
| <span data-ttu-id="30736-136">(5) riceve l' \_ indicazione di chiusura FD.</span><span class="sxs-lookup"><span data-stu-id="30736-136">(5) Receives FD\_CLOSE indication.</span></span>                                                                                         | <span data-ttu-id="30736-137">(solo per importanza temporale locale) Richiama [**chiamata closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) .</span><span class="sxs-lookup"><span data-stu-id="30736-137">(local timing significance only) Invokes [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket) .</span></span>                       |
| <span data-ttu-id="30736-138">(6) richiama [**chiamata closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span><span class="sxs-lookup"><span data-stu-id="30736-138">(6) Invokes [**closesocket**](/windows/desktop/api/winsock/nf-winsock-closesocket).</span></span>                                                                          |                                                                                                       |



 

 

 



