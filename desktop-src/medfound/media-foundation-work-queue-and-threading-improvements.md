---
description: Questo argomento descrive i miglioramenti apportati a Windows 8 per le code di lavoro e il threading nella piattaforma Microsoft Media Foundation.
ms.assetid: 9E2A1D94-BF82-488E-8297-D524683ABE17
title: Miglioramenti della coda di lavoro e del threading
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 07b307cb00316696e075e9e9cc2a138e98e149be
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/03/2021
ms.locfileid: "104058466"
---
# <a name="work-queue-and-threading-improvements"></a><span data-ttu-id="4cfbc-103">Miglioramenti della coda di lavoro e del threading</span><span class="sxs-lookup"><span data-stu-id="4cfbc-103">Work Queue and Threading Improvements</span></span>

<span data-ttu-id="4cfbc-104">Questo argomento descrive i miglioramenti apportati a Windows 8 per le code di lavoro e il threading nella piattaforma Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-104">This topic describes improvements in Windows 8 for work queues and threading in the Microsoft Media Foundation platform.</span></span>

-   [<span data-ttu-id="4cfbc-105">Comportamento di Windows 7</span><span class="sxs-lookup"><span data-stu-id="4cfbc-105">Windows 7 Behavior</span></span>](#windows-7-behavior)
    -   [<span data-ttu-id="4cfbc-106">Code di lavoro</span><span class="sxs-lookup"><span data-stu-id="4cfbc-106">Work Queues</span></span>](#work-queues)
    -   [<span data-ttu-id="4cfbc-107">Supporto di MMCSS</span><span class="sxs-lookup"><span data-stu-id="4cfbc-107">MMCSS Support</span></span>](#mmcss-support)
    -   [<span data-ttu-id="4cfbc-108">IMFRealTimeClient</span><span class="sxs-lookup"><span data-stu-id="4cfbc-108">IMFRealTimeClient</span></span>](#imfrealtimeclientex)
-   [<span data-ttu-id="4cfbc-109">Miglioramenti di Windows 8</span><span class="sxs-lookup"><span data-stu-id="4cfbc-109">Windows 8 Improvements</span></span>](#windows-8-improvements)
    -   [<span data-ttu-id="4cfbc-110">Code di lavoro multithreading</span><span class="sxs-lookup"><span data-stu-id="4cfbc-110">Multithreaded Work Queues</span></span>](#multithreaded-work-queues)
    -   [<span data-ttu-id="4cfbc-111">Code di lavoro delle attività condivise</span><span class="sxs-lookup"><span data-stu-id="4cfbc-111">Shared Task Work Queues</span></span>](#shared-task-work-queues)
    -   [<span data-ttu-id="4cfbc-112">Coda di attesa</span><span class="sxs-lookup"><span data-stu-id="4cfbc-112">Wait Queue</span></span>](#wait-queue)
    -   [<span data-ttu-id="4cfbc-113">Miglioramenti al supporto di MMCSS</span><span class="sxs-lookup"><span data-stu-id="4cfbc-113">Enhancements to MMCSS Support</span></span>](#enhancements-to-mmcss-support)
    -   [<span data-ttu-id="4cfbc-114">IMFRealTimeClientEx</span><span class="sxs-lookup"><span data-stu-id="4cfbc-114">IMFRealTimeClientEx</span></span>](#imfrealtimeclientex)
    -   [<span data-ttu-id="4cfbc-115">Branch topologia</span><span class="sxs-lookup"><span data-stu-id="4cfbc-115">Topology Branches</span></span>](#topology-branches)
-   [<span data-ttu-id="4cfbc-116">Indicazioni</span><span class="sxs-lookup"><span data-stu-id="4cfbc-116">Recommendations</span></span>](#recommendations)
-   [<span data-ttu-id="4cfbc-117">Summary</span><span class="sxs-lookup"><span data-stu-id="4cfbc-117">Summary</span></span>](#summary)
-   [<span data-ttu-id="4cfbc-118">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="4cfbc-118">Related topics</span></span>](#related-topics)

## <a name="windows-7-behavior"></a><span data-ttu-id="4cfbc-119">Comportamento di Windows 7</span><span class="sxs-lookup"><span data-stu-id="4cfbc-119">Windows 7 Behavior</span></span>

<span data-ttu-id="4cfbc-120">In questa sezione viene riepilogato il comportamento di Media Foundation code di lavoro in Windows 7.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-120">This section summarizes the behavior of Media Foundation work queues in Windows 7.</span></span>

### <a name="work-queues"></a><span data-ttu-id="4cfbc-121">Code di lavoro</span><span class="sxs-lookup"><span data-stu-id="4cfbc-121">Work Queues</span></span>

<span data-ttu-id="4cfbc-122">La piattaforma Media Foundation crea diverse code di lavoro standard.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-122">The Media Foundation platform creates several standard work queues.</span></span> <span data-ttu-id="4cfbc-123">Solo due sono documentati come utilizzo generale dell'applicazione:</span><span class="sxs-lookup"><span data-stu-id="4cfbc-123">Only two are documented as being for general application use:</span></span>

-   <span data-ttu-id="4cfbc-124">**MFASYNC \_ coda di callback \_ \_ standard**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-124">**MFASYNC\_CALLBACK\_QUEUE\_STANDARD**</span></span>
-   <span data-ttu-id="4cfbc-125">**\_ \_ \_ funzione Long coda callback \_ MFASYNC**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-125">**MFASYNC\_CALLBACK\_QUEUE\_LONG\_FUNCTION**</span></span>

<span data-ttu-id="4cfbc-126">Un'applicazione o un componente può allocare nuove code di lavoro chiamando [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue) o [**MFAllocateWorkQueueEx**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueueex).</span><span class="sxs-lookup"><span data-stu-id="4cfbc-126">An application or component can allocate new work queues by calling [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue) or [**MFAllocateWorkQueueEx**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueueex).</span></span> <span data-ttu-id="4cfbc-127">La funzione **MFAllocateWorkQueueEx** definisce due tipi di coda di lavoro:</span><span class="sxs-lookup"><span data-stu-id="4cfbc-127">The **MFAllocateWorkQueueEx** function defines two types of work queue:</span></span>

-   <span data-ttu-id="4cfbc-128">**MF \_ \_WORKQUEUE standard** crea una coda di lavoro senza un ciclo di messaggi.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-128">**MF\_STANDARD\_WORKQUEUE** creates a work queue without a message loop.</span></span>
-   <span data-ttu-id="4cfbc-129">**MF \_ La finestra \_ WORKQUEUE** crea una coda di lavoro con un ciclo di messaggi.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-129">**MF\_WINDOW\_WORKQUEUE** creates a work queue with a message loop.</span></span>

<span data-ttu-id="4cfbc-130">Per accodare un elemento di lavoro, chiamare [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) o [**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex).</span><span class="sxs-lookup"><span data-stu-id="4cfbc-130">To queue a work item, call [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) or [**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex).</span></span> <span data-ttu-id="4cfbc-131">La piattaforma esegue l'elemento di lavoro richiamando l'implementazione fornita dal chiamante di [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback).</span><span class="sxs-lookup"><span data-stu-id="4cfbc-131">The platform executes the work item by invoking the caller-provided implementation of [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback).</span></span> <span data-ttu-id="4cfbc-132">In Windows 7 e versioni precedenti, la piattaforma crea un thread per ogni coda di lavoro.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-132">In Windows 7 and earlier, the platform creates one thread per work queue.</span></span>

### <a name="mmcss-support"></a><span data-ttu-id="4cfbc-133">Supporto di MMCSS</span><span class="sxs-lookup"><span data-stu-id="4cfbc-133">MMCSS Support</span></span>

<span data-ttu-id="4cfbc-134">Il [servizio Utilità di pianificazione classi multimediali](../procthread/multimedia-class-scheduler-service.md) (MMCSS) gestisce le priorità dei thread in modo che le applicazioni multimediali ottengano intervalli regolari di tempo della CPU, senza negare le risorse della CPU alle applicazioni con priorità più bassa.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-134">The [Multimedia Class Scheduler Service](../procthread/multimedia-class-scheduler-service.md) (MMCSS) manages thread priorities so that multimedia applications get regular slices of CPU time, without denying CPU resources to lower-priority applications.</span></span> <span data-ttu-id="4cfbc-135">MMCSS definisce un set di *attività* con profili di utilizzo della CPU diversi.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-135">MMCSS defines a set of *tasks* that have different CPU utilization profiles.</span></span> <span data-ttu-id="4cfbc-136">Quando un thread unisce un'attività MMCSS, MMCSS imposta la priorità del thread in base a diversi fattori:</span><span class="sxs-lookup"><span data-stu-id="4cfbc-136">When a thread joins an MMCSS task, MMCSS sets the priority of the thread based on several factors:</span></span>

-   <span data-ttu-id="4cfbc-137">Priorità di base dell'attività, impostata nel registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-137">The base priority of the task, which is set in the registry.</span></span>
-   <span data-ttu-id="4cfbc-138">Priorità del thread relativa, impostata in fase di esecuzione chiamando [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span><span class="sxs-lookup"><span data-stu-id="4cfbc-138">The relative thread priority, which is set at run time by calling [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span></span>
-   <span data-ttu-id="4cfbc-139">Diverse caratteristiche in fase di esecuzione, ad esempio se l'applicazione è in primo piano e quanto tempo CPU viene utilizzato dai thread in ogni classe MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-139">Various run-time characteristics, such as whether the application is in the foreground, and how much CPU time is being consumed by the threads in each MMCSS class.</span></span>

<span data-ttu-id="4cfbc-140">Un'applicazione può registrare una coda di lavoro con MMCSS chiamando [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss).</span><span class="sxs-lookup"><span data-stu-id="4cfbc-140">An application can register a work queue with MMCSS by calling [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss).</span></span> <span data-ttu-id="4cfbc-141">Questa funzione accetta un ID coda di lavoro, una classe MMCSS (nome attività) e l'identificatore attività MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-141">This function takes a work queue ID, an MMCSS class (task name), and the MMCSS task identifier.</span></span> <span data-ttu-id="4cfbc-142">Internamente, chiama [**AvSetMmThreadCharacteristics**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadcharacteristicsa) con il nome dell'attività e l'ID attività.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-142">Internally, it calls [**AvSetMmThreadCharacteristics**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadcharacteristicsa) with the task name and task ID.</span></span> <span data-ttu-id="4cfbc-143">Dopo la registrazione di una coda di lavoro con MMCSS, è possibile ottenere la classe e l'ID attività chiamando [**MFGetWorkQueueMMCSSClass**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcssclass) e [**MFGetWorkQueueMMCSSTaskId**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsstaskid).</span><span class="sxs-lookup"><span data-stu-id="4cfbc-143">After a work queue is registered with MMCSS, you can get the class and task ID by calling [**MFGetWorkQueueMMCSSClass**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcssclass) and [**MFGetWorkQueueMMCSSTaskId**](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsstaskid).</span></span>

<span data-ttu-id="4cfbc-144">La [sessione multimediale](media-session.md) fornisce un accesso di livello superiore a queste API tramite l'interfaccia [**IMFWorkQueueServices**](/windows/desktop/api/mfidl/nn-mfidl-imfworkqueueservices) .</span><span class="sxs-lookup"><span data-stu-id="4cfbc-144">The [Media Session](media-session.md) provides somewhat higher-level access to these APIs, through the [**IMFWorkQueueServices**](/windows/desktop/api/mfidl/nn-mfidl-imfworkqueueservices) interface.</span></span> <span data-ttu-id="4cfbc-145">Questa interfaccia fornisce due metodi principali:</span><span class="sxs-lookup"><span data-stu-id="4cfbc-145">This interface provides two primary methods:</span></span>

| <span data-ttu-id="4cfbc-146">Metodo</span><span class="sxs-lookup"><span data-stu-id="4cfbc-146">Method</span></span>                                                                                                            | <span data-ttu-id="4cfbc-147">Descrizione</span><span class="sxs-lookup"><span data-stu-id="4cfbc-147">Description</span></span>                                                                                                                                                                                                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="4cfbc-148">**BeginRegisterPlatformWorkQueueWithMMCSS**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-148">**BeginRegisterPlatformWorkQueueWithMMCSS**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregisterplatformworkqueuewithmmcss)   | <span data-ttu-id="4cfbc-149">Registra una coda di lavoro con un'attività MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-149">Registers a work queue with an MMCSS task.</span></span> <span data-ttu-id="4cfbc-150">Questo metodo è essenzialmente un thin wrapper per [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss), ma è possibile passare il valore **MFASYNC \_ coda di callback \_ \_ All** per registrare tutte le code di lavoro della piattaforma in una sola volta.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-150">This method is essentially a thin wrapper around [**MFBeginRegisterWorkQueueWithMMCSS**](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcss), but you can pass the value **MFASYNC\_CALLBACK\_QUEUE\_ALL** to register all of the platform work queues at once.</span></span> |
| [<span data-ttu-id="4cfbc-151">**BeginRegisterTopologyWorkQueuesWithMMCSS**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-151">**BeginRegisterTopologyWorkQueuesWithMMCSS**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) | <span data-ttu-id="4cfbc-152">Registra un ramo della topologia con una coda di lavoro.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-152">Registers a branch of the topology with a work queue.</span></span>                                                                                                                                                                                                                                         |



 

<span data-ttu-id="4cfbc-153">Per registrare un ramo della topologia, effettuare le operazioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-153">To register a topology branch, do the following.</span></span>

1.  <span data-ttu-id="4cfbc-154">Impostare l'attributo [MF \_ TOPONODE \_ WORKQUEUE \_ ID](mf-toponode-workqueue-id-attribute.md) nel nodo di origine per il ramo.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-154">Set the [MF\_TOPONODE\_WORKQUEUE\_ID](mf-toponode-workqueue-id-attribute.md) attribute on the source node for the branch.</span></span> <span data-ttu-id="4cfbc-155">Usare qualsiasi valore definito dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-155">Use any application-defined value.</span></span>
2.  <span data-ttu-id="4cfbc-156">Facoltativamente, impostare la **\_ classe MF \_ TOPONODE \_ WORKQUEUE \_ MMCSS** per aggiungere la coda di lavoro a un'attività MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-156">Optionally, set the **MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS** to join the work queue to an MMCSS task.</span></span>
3.  <span data-ttu-id="4cfbc-157">Chiamare [**BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) sulla topologia risolta.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-157">Call [**BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) on the resolved topology.</span></span>

<span data-ttu-id="4cfbc-158">La sessione multimediale alloca una nuova coda di lavoro per ogni valore univoco di [MF \_ TOPONODE \_ WORKQUEUE \_ ID](mf-toponode-workqueue-id-attribute.md).</span><span class="sxs-lookup"><span data-stu-id="4cfbc-158">The Media Session allocates a new work queue for each unique value of [MF\_TOPONODE\_WORKQUEUE\_ID](mf-toponode-workqueue-id-attribute.md).</span></span> <span data-ttu-id="4cfbc-159">Per ogni ramo della topologia, le operazioni asincrone della pipeline vengono eseguite nella coda di lavoro assegnata al ramo.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-159">For each topology branch, asynchronous pipeline operations are performed on the work queue that is assigned to the branch.</span></span>

### <a name="imfrealtimeclient"></a><span data-ttu-id="4cfbc-160">IMFRealTimeClient</span><span class="sxs-lookup"><span data-stu-id="4cfbc-160">IMFRealTimeClient</span></span>

<span data-ttu-id="4cfbc-161">L'interfaccia [**IMFRealTimeClient**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclient) è destinata ai componenti della pipeline che creano i propri thread o utilizzano le code di lavoro per le operazioni asincrone.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-161">The [**IMFRealTimeClient**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclient) interface is intended for pipeline components that either create their own threads or use work queues for asynchronous operations.</span></span> <span data-ttu-id="4cfbc-162">La sessione multimediale usa questa interfaccia per notificare al componente della pipeline il comportamento corretto, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="4cfbc-162">The Media Session uses this interface to notify the pipeline component of the correct behavior, as follows:</span></span>

-   <span data-ttu-id="4cfbc-163">Se il componente della pipeline crea un thread di lavoro, il metodo [**IMFRealTimeClient:: RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads) invia una notifica al componente a cui è stata aggiunta la classe MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-163">If the pipeline component creates a worker thread, the [**IMFRealTimeClient::RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads) method notifies the component which MMCSS class to join.</span></span>
-   <span data-ttu-id="4cfbc-164">Se il componente della pipeline usa una coda di lavoro, il metodo [**IMFRealTimeClient:: SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue) indica al componente la coda di lavoro da usare.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-164">If the pipeline component uses a work queue, the [**IMFRealTimeClient::SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue) method tells the component which work queue to use.</span></span>

<span data-ttu-id="4cfbc-165">In genere, un componente della pipeline utilizza un thread o una coda di lavoro per eseguire attività asincrone, ma non entrambe.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-165">Typically, a pipeline component uses either a thread or a work queue to perform asynchronous tasks, but not both.</span></span>

## <a name="windows-8-improvements"></a><span data-ttu-id="4cfbc-166">Miglioramenti di Windows 8</span><span class="sxs-lookup"><span data-stu-id="4cfbc-166">Windows 8 Improvements</span></span>

### <a name="multithreaded-work-queues"></a><span data-ttu-id="4cfbc-167">Code di lavoro multithreading</span><span class="sxs-lookup"><span data-stu-id="4cfbc-167">Multithreaded Work Queues</span></span>

<span data-ttu-id="4cfbc-168">In Windows 8, Media Foundation supporta un nuovo tipo di coda di lavoro denominata *coda multithread*.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-168">In Windows 8, Media Foundation supports a new type of work queue called the *multithreaded queue*.</span></span> <span data-ttu-id="4cfbc-169">Una coda multithread usa un pool di thread di sistema per la distribuzione degli elementi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-169">A multithreaded queue uses a system thread pool to dispatch work items.</span></span> <span data-ttu-id="4cfbc-170">La coda con multithreading si ridimensiona meglio rispetto alle code a thread singolo precedenti.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-170">The multithreaded queue scales better than the previous single-threaded queues.</span></span> <span data-ttu-id="4cfbc-171">Ad esempio,</span><span class="sxs-lookup"><span data-stu-id="4cfbc-171">For example,</span></span>

-   <span data-ttu-id="4cfbc-172">Diversi componenti possono condividere una coda multithread senza bloccarsi un altro, richiedendo la creazione di un numero inferiore di thread.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-172">Several components can share a multithreaded queue without blocking one another, requiring the creation of fewer threads.</span></span>

-   <span data-ttu-id="4cfbc-173">Gli elementi di lavoro sono ottimizzati per evitare cambi di contesto se è già impostato un evento.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-173">Work items are optimized to avoid context switches if an event is already set.</span></span> <span data-ttu-id="4cfbc-174">Questa operazione è più efficiente rispetto alla creazione di thread personalizzati per l'attesa degli eventi.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-174">This is more efficient than creating your own threads to wait on events.</span></span>

<span data-ttu-id="4cfbc-175">Quando si usa [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex), le applicazioni devono evitare la filatura dei thread, ma devono usare le code di lavoro.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-175">When using [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex), applications should avoid spinning up threads and instead should use the work queues.</span></span> <span data-ttu-id="4cfbc-176">A tale scopo, le applicazioni devono implementare [**SetWorkQueueEx**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-setworkqueueex) e non usare [**RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-registerthreadsex) e [**UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-unregisterthreads).</span><span class="sxs-lookup"><span data-stu-id="4cfbc-176">To accomplish this, applications should implement [**SetWorkQueueEx**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-setworkqueueex) and not use [**RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-registerthreadsex) and [**UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-unregisterthreads).</span></span>

<span data-ttu-id="4cfbc-177">Quando la piattaforma Media Foundation viene inizializzata, viene creata una coda con multithreading con l'identificatore **MFASYNC \_ coda di callback \_ \_ multithreading**.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-177">When the Media Foundation platform is initialized, it creates a multithreaded queue with the identifier **MFASYNC\_CALLBACK\_QUEUE\_MULTITHREADED**.</span></span>

<span data-ttu-id="4cfbc-178">Una coda multithread non serializza gli elementi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-178">A multithreaded queue does not serialize work items.</span></span> <span data-ttu-id="4cfbc-179">Ogni volta che un thread dal pool di thread diventa disponibile, viene inviato il successivo elemento di lavoro nella coda.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-179">Whenever a thread from the thread pool becomes available, the next work item on the queue is dispatched.</span></span> <span data-ttu-id="4cfbc-180">Il chiamante deve garantire che il lavoro venga serializzato correttamente.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-180">The caller must ensure that work is serialized correctly.</span></span> <span data-ttu-id="4cfbc-181">Per semplificare questa operazione, Media Foundation definisce una *coda di lavoro seriale*.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-181">To make this easier, Media Foundation defines a *serial work queue*.</span></span> <span data-ttu-id="4cfbc-182">Una coda seriale esegue il wrapping di un'altra coda di lavoro, ma garantisce l'esecuzione completamente serializzata.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-182">A serial queue wraps another work queue but guarantees fully serialized execution.</span></span> <span data-ttu-id="4cfbc-183">L'elemento successivo della coda non viene inviato finché non viene completato l'elemento precedente.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-183">The next item on the queue is not dispatched until the previous item completes.</span></span>

<span data-ttu-id="4cfbc-184">Il codice seguente crea una coda del serializzatore sulla coda multithreading della piattaforma.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-184">The following code creates a serializer queue over the platform multithreaded queue.</span></span>


```C++
DWORD workQueueID;
hr = MFAllocateSerialWorkQueue(MFASYNC_CALLBACK_QUEUE_MULTITHREADED, &workQueueID); 
```



<span data-ttu-id="4cfbc-185">Più di una coda seriale può eseguire il wrapping della stessa coda multithread.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-185">More than one serial queue can wrap the same multithreaded queue.</span></span> <span data-ttu-id="4cfbc-186">Le code seriali condividono lo stesso pool di thread e l'esecuzione serializzata viene applicata all'interno di ogni coda.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-186">The serial queues then share the same thread pool, and serialized execution is enforced within each queue.</span></span>

<span data-ttu-id="4cfbc-187">Le code di lavoro standard esistenti prima di Windows 8 sono ora implementate come code di lavoro seriali che eseguono il wrapping della coda multithreading della piattaforma.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-187">The standard work queues that existed prior to Windows 8 are now implemented as serial work queues that wrap the platform multithreaded queue.</span></span> <span data-ttu-id="4cfbc-188">Questa modifica conserva la compatibilità con le versioni precedenti.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-188">This change preserves backward compatibility.</span></span>

### <a name="shared-task-work-queues"></a><span data-ttu-id="4cfbc-189">Code di lavoro delle attività condivise</span><span class="sxs-lookup"><span data-stu-id="4cfbc-189">Shared Task Work Queues</span></span>

<span data-ttu-id="4cfbc-190">Per funzionare correttamente con l'utilità di pianificazione del kernel, è necessario disporre di una coda di lavoro a thread multipli per ogni attività MMCSS usata.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-190">To work correctly with the kernel scheduler, there should be one multithreaded work queue for each MMCSS task that you use.</span></span> <span data-ttu-id="4cfbc-191">La piattaforma Media Foundation alloca tali richieste, fino a una per ogni attività MMCSS, per processo.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-191">The Media Foundation platform allocates these as needed, up to one per MMCSS task, per process.</span></span> <span data-ttu-id="4cfbc-192">Per ottenere la coda di lavoro condivisa per una particolare attività MMCSS, chiamare [**MFLockSharedWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mflocksharedworkqueue) e specificare il nome dell'attività.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-192">To get the shared work queue for a particular MMCSS task, call [**MFLockSharedWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mflocksharedworkqueue) and specify the task name.</span></span> <span data-ttu-id="4cfbc-193">La funzione Cerca il nome dell'attività in una tabella.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-193">The function looks up the task name in a table.</span></span> <span data-ttu-id="4cfbc-194">Se per questa attività non esiste già una coda di lavoro, la funzione alloca una nuova coda di lavoro MT e la aggiunge immediatamente all'attività MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-194">If a work queue does not already exist for this task, the function allocates a new MT work queue and immediately joins it to the MMCSS task.</span></span> <span data-ttu-id="4cfbc-195">Se per l'attività esiste già una coda di lavoro, la funzione restituisce l'identificatore della coda di lavoro esistente.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-195">If a work queue already exists for that task, the function returns the identifier of the existing work queue.</span></span>

### <a name="wait-queue"></a><span data-ttu-id="4cfbc-196">Coda di attesa</span><span class="sxs-lookup"><span data-stu-id="4cfbc-196">Wait Queue</span></span>

<span data-ttu-id="4cfbc-197">La *coda di attesa* è una coda di lavoro della piattaforma speciale che attende la segnalazione degli eventi.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-197">The *wait queue* is a special platform work queue that waits on events to be signaled.</span></span> <span data-ttu-id="4cfbc-198">Se un componente deve attendere la segnalazione di un evento, può usare la coda di attesa anziché creare un thread di lavoro per attendere l'evento.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-198">If a component needs to wait for an event to be signaled, it can use the wait queue instead of creating a worker thread to wait on the event.</span></span>

<span data-ttu-id="4cfbc-199">Per utilizzare la coda di attesa, chiamare [**MFPutWaitingWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputwaitingworkitem).</span><span class="sxs-lookup"><span data-stu-id="4cfbc-199">To use the wait queue, call [**MFPutWaitingWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputwaitingworkitem).</span></span> <span data-ttu-id="4cfbc-200">I parametri includono l'handle di evento e un puntatore [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) .</span><span class="sxs-lookup"><span data-stu-id="4cfbc-200">The parameters include the event handle and an [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) pointer.</span></span> <span data-ttu-id="4cfbc-201">Quando l'evento viene segnalato, la coda di attesa richiama il callback.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-201">When the event is signaled, the wait queue invokes your callback.</span></span> <span data-ttu-id="4cfbc-202">È presente una singola coda di attesa della piattaforma; le applicazioni non possono creare le proprie code di attesa.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-202">There is a single platform wait queue; applications cannot create their own wait queues.</span></span>

### <a name="enhancements-to-mmcss-support"></a><span data-ttu-id="4cfbc-203">Miglioramenti al supporto di MMCSS</span><span class="sxs-lookup"><span data-stu-id="4cfbc-203">Enhancements to MMCSS Support</span></span>

<span data-ttu-id="4cfbc-204">Le nuove funzioni della piattaforma Media Foundation seguenti sono correlate a MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-204">The following new Media Foundation platform functions relate to MMCSS.</span></span>



| <span data-ttu-id="4cfbc-205">Funzione</span><span class="sxs-lookup"><span data-stu-id="4cfbc-205">Function</span></span>                                                                           | <span data-ttu-id="4cfbc-206">Descrizione</span><span class="sxs-lookup"><span data-stu-id="4cfbc-206">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="4cfbc-207">**MFBeginRegisterWorkQueueWithMMCSSEx**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-207">**MFBeginRegisterWorkQueueWithMMCSSEx**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcssex) | <span data-ttu-id="4cfbc-208">Registra una coda di lavoro con MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-208">Registers a work queue with MMCSS.</span></span> <span data-ttu-id="4cfbc-209">Questa funzione include un parametro per specificare la priorità relativa del thread.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-209">This function includes a parameter to specify relative thread priority.</span></span> <span data-ttu-id="4cfbc-210">Internamente, questo valore viene convertito in una chiamata a [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span><span class="sxs-lookup"><span data-stu-id="4cfbc-210">Internally, this value is translated into a call to [**AvSetMmThreadPriority**](/windows/win32/api/avrt/nf-avrt-avsetmmthreadpriority).</span></span>                                                                                                                                                                               |
| [<span data-ttu-id="4cfbc-211">**MFGetWorkQueueMMCSSPriority**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-211">**MFGetWorkQueueMMCSSPriority**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsspriority)                 | <span data-ttu-id="4cfbc-212">Esegue una query sulla priorità di una coda di lavoro.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-212">Queries the priority of a work queue.</span></span>                                                                                                                                                                                                                                                                                                                                                                 |
| [<span data-ttu-id="4cfbc-213">**MFRegisterPlatformWithMMCSS**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-213">**MFRegisterPlatformWithMMCSS**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfregisterplatformwithmmcss)                 | <span data-ttu-id="4cfbc-214">Registra tutte le code di lavoro della piattaforma con un'attività MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-214">Registers all of the platform work queues with an MMCSS task.</span></span> <span data-ttu-id="4cfbc-215">Questa funzione è simile al metodo [**IMFWorkQueueServices:: BeginRegisterPlatformWorkQueueWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregisterplatformworkqueuewithmmcss) , ma può essere usata senza creare un'istanza della sessione multimediale.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-215">This function is similar to the [**IMFWorkQueueServices::BeginRegisterPlatformWorkQueueWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregisterplatformworkqueuewithmmcss) method, but it can be used without creating an instance of the Media Session.</span></span> <span data-ttu-id="4cfbc-216">Inoltre, la funzione include un parametro per specificare la priorità del thread di base.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-216">In addition, the function includes a parameter to specify the base thread priority.</span></span> |



 

<span data-ttu-id="4cfbc-217">Per le applicazioni che usano la sessione multimediale è necessario impostare l'attributo della [ \_ classe MF TOPONODE \_ WORKQUEUE \_ MMCSS \_ ](mf-toponode-workqueue-mmcss-class-attribute.md) su "audio" per il ramo di rendering audio.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-217">Applications that use the Media Session should set the [MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS](mf-toponode-workqueue-mmcss-class-attribute.md) attribute to "Audio" for the audio rendering branch.</span></span> <span data-ttu-id="4cfbc-218">Impostare l'attributo su "Playback" per il ramo di rendering video.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-218">Set the attribute to "Playback" for the video rendering branch.</span></span>

### <a name="imfrealtimeclientex"></a><span data-ttu-id="4cfbc-219">IMFRealTimeClientEx</span><span class="sxs-lookup"><span data-stu-id="4cfbc-219">IMFRealTimeClientEx</span></span>

<span data-ttu-id="4cfbc-220">Interfaccia [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex) che sostituisce IMFRealTimeClient per i componenti della pipeline che eseguono operazioni asincrone.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-220">The [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex) interface to replaces IMFRealTimeClient, for pipeline components that perform asynchronous operations.</span></span>



| <span data-ttu-id="4cfbc-221">Metodo</span><span class="sxs-lookup"><span data-stu-id="4cfbc-221">Method</span></span>                                                             | <span data-ttu-id="4cfbc-222">Descrizione</span><span class="sxs-lookup"><span data-stu-id="4cfbc-222">Description</span></span>                                                                                                                                                                                                                    |
|--------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="4cfbc-223">**RegisterThreadsEx**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-223">**RegisterThreadsEx**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-registerthreadsex) | <span data-ttu-id="4cfbc-224">Notifica al componente di registrare i thread con MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-224">Notifies the component to register its threads with MMCSS.</span></span> <span data-ttu-id="4cfbc-225">Questo metodo è equivalente a [**IMFRealTimeClient:: RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads), ma aggiunge un parametro per la priorità del thread di base.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-225">This method is equivalent to [**IMFRealTimeClient::RegisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-registerthreads), but it adds a parameter for the base thread priority.</span></span> |
| [<span data-ttu-id="4cfbc-226">**SetWorkQueueEx**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-226">**SetWorkQueueEx**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-setworkqueueex)       | <span data-ttu-id="4cfbc-227">Notifica al componente di utilizzare una coda di lavoro specifica.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-227">Notifies the component to use a specific work queue.</span></span> <span data-ttu-id="4cfbc-228">Questo metodo è equivalente a [**IMFReadTimeClient:: SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue), ma aggiunge un parametro per la priorità dell'elemento di lavoro.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-228">This method is equivalent to [**IMFReadTimeClient::SetWorkQueue**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-setworkqueue), but it adds a parameter for the work item priority.</span></span>               |
| [<span data-ttu-id="4cfbc-229">**UnregisterThreads**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-229">**UnregisterThreads**</span></span>](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclientex-unregisterthreads) | <span data-ttu-id="4cfbc-230">Notifica al componente di annullare la registrazione dei thread da MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-230">Notifies the component to unregister its threads from MMCSS.</span></span> <span data-ttu-id="4cfbc-231">Questo metodo è identico al metodo [**IMFRealTimeClient:: UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-unregisterthreads) .</span><span class="sxs-lookup"><span data-stu-id="4cfbc-231">This method is identical to the [**IMFRealTimeClient::UnregisterThreads**](/windows/desktop/api/mfidl/nf-mfidl-imfrealtimeclient-unregisterthreads) method.</span></span>                                       |



 

<span data-ttu-id="4cfbc-232">I componenti della pipeline devono usare le code di lavoro e non devono creare thread di lavoro per i motivi seguenti:</span><span class="sxs-lookup"><span data-stu-id="4cfbc-232">Pipeline components should use work queues, and should not create worker threads, for the following reasons:</span></span>

-   <span data-ttu-id="4cfbc-233">Le code di lavoro si adattano meglio, perché usano i pool di thread del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-233">Work queues scale better, because they use the OS thread pools.</span></span>
-   <span data-ttu-id="4cfbc-234">La piattaforma gestisce i dettagli della registrazione delle code di lavoro con MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-234">The platform handles the details of registering work queues with MMCSS.</span></span>
-   <span data-ttu-id="4cfbc-235">Un thread di lavoro può facilmente causare un deadlock che è difficile eseguire il debug.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-235">A worker thread can easily cause a deadlock that is hard to debug.</span></span>

<span data-ttu-id="4cfbc-236">Si consiglia inoltre di utilizzare la coda di lavoro del serializzatore se è necessario serializzare le operazioni asincrone.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-236">Also, consider using the serializer work queue if you need to serialize your asynchronous operations.</span></span>

### <a name="topology-branches"></a><span data-ttu-id="4cfbc-237">Branch topologia</span><span class="sxs-lookup"><span data-stu-id="4cfbc-237">Topology Branches</span></span>

<span data-ttu-id="4cfbc-238">Se l'attributo della [ \_ classe MF TOPONODE \_ WORKQUEUE \_ MMCSS \_ ](mf-toponode-workqueue-mmcss-class-attribute.md) registra un ramo della topologia con MMCSS, in Windows 8 la sessione multimediale usa le code di lavoro mt condivise.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-238">If the [MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS](mf-toponode-workqueue-mmcss-class-attribute.md) attribute registers a topology branch with MMCSS, in Windows 8 the Media Session uses the shared MT work queues.</span></span> <span data-ttu-id="4cfbc-239">Nelle versioni precedenti di Windows, la sessione multimediale ha allocato una nuova coda di lavoro.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-239">In earlier versions of Windows, the Media Session allocated a new work queue.</span></span>

<span data-ttu-id="4cfbc-240">Vengono definiti due nuovi attributi per la registrazione di un ramo della topologia con MMCSS.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-240">Two new attributes are defined for registering a topology branch with MMCSS.</span></span>



| <span data-ttu-id="4cfbc-241">Attributo</span><span class="sxs-lookup"><span data-stu-id="4cfbc-241">Attribute</span></span>                                                                            | <span data-ttu-id="4cfbc-242">Descrizione</span><span class="sxs-lookup"><span data-stu-id="4cfbc-242">Description</span></span>                         |
|--------------------------------------------------------------------------------------|-------------------------------------|
| [<span data-ttu-id="4cfbc-243">MF \_ TOPONODE \_ WORKQUEUE \_ MMCSS \_ Priority</span><span class="sxs-lookup"><span data-stu-id="4cfbc-243">MF\_TOPONODE\_WORKQUEUE\_MMCSS\_PRIORITY</span></span>](mf-toponode-workqueue-mmcss-priority.md) | <span data-ttu-id="4cfbc-244">Specifica la priorità del thread di base.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-244">Specifies the base thread priority.</span></span> |
| [<span data-ttu-id="4cfbc-245">\_ \_ \_ priorità elemento WORKQUEUE MF \_ TOPONODE</span><span class="sxs-lookup"><span data-stu-id="4cfbc-245">MF\_TOPONODE\_WORKQUEUE\_ITEM\_PRIORITY</span></span>](mf-toponode-workqueue-item-priority.md)   | <span data-ttu-id="4cfbc-246">Specifica la priorità dell'elemento di lavoro.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-246">Specifies the work item priority.</span></span>   |



 

## <a name="recommendations"></a><span data-ttu-id="4cfbc-247">Consigli</span><span class="sxs-lookup"><span data-stu-id="4cfbc-247">Recommendations</span></span>

-   <span data-ttu-id="4cfbc-248">Le applicazioni che usano la sessione multimediale devono impostare la [ \_ classe MF TOPONODE \_ WORKQUEUE \_ MMCSS \_ ](mf-toponode-workqueue-mmcss-class-attribute.md) su "audio" per il ramo di rendering audio e la "riproduzione" per il ramo di rendering video.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-248">Applications that use the Media Session should set [MF\_TOPONODE\_WORKQUEUE\_MMCSS\_CLASS](mf-toponode-workqueue-mmcss-class-attribute.md) to "Audio" for the audio rendering branch and "Playback" for the video rendering branch.</span></span>
-   <span data-ttu-id="4cfbc-249">Per le applicazioni che usano la sessione multimediale è necessario chiamare [**IMFWorkQueueServices:: BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) nella topologia.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-249">Applications that use the Media Session should call [**IMFWorkQueueServices::BeginRegisterTopologyWorkQueuesWithMMCSS**](/windows/desktop/api/mfidl/nf-mfidl-imfworkqueueservices-beginregistertopologyworkqueueswithmmcss) on the topology.</span></span>
-   <span data-ttu-id="4cfbc-250">Per i componenti della pipeline, le code di lavoro sono consigliate al posto dei thread di lavoro.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-250">For pipeline components, work queues are recommended instead of worker threads.</span></span> <span data-ttu-id="4cfbc-251">Se il componente USA code di lavoro o thread di lavoro, implementare [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex).</span><span class="sxs-lookup"><span data-stu-id="4cfbc-251">If the component uses either work queues or worker threads, implement [**IMFRealTimeClientEx**](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex).</span></span>
-   <span data-ttu-id="4cfbc-252">Non creare code di lavoro private, in quanto in questo modo si vanifica lo scopo delle code di lavoro della piattaforma.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-252">Do not create private work queues, as this defeats the purpose of the platform work queues.</span></span> <span data-ttu-id="4cfbc-253">Usare la coda multithreading della piattaforma o una coda seriale che esegue il wrapping della coda multithreading della piattaforma.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-253">Use either the platform multithreaded queue or a serial queue that wraps the platform multithreaded queue.</span></span>
-   <span data-ttu-id="4cfbc-254">Se è necessario serializzare le operazioni asincrone, usare una coda seriale.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-254">If you need to serialize asynchronous operations, use a serial queue.</span></span>

## <a name="summary"></a><span data-ttu-id="4cfbc-255">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="4cfbc-255">Summary</span></span>

<span data-ttu-id="4cfbc-256">Le seguenti API della piattaforma Media Foundation correlate ai thread e alle code di lavoro sono nuove per Windows 8.</span><span class="sxs-lookup"><span data-stu-id="4cfbc-256">The following Media Foundation platform APIs that relate to threads and work queues are new for Windows 8.</span></span>

-   [<span data-ttu-id="4cfbc-257">\_ \_ \_ priorità elemento WORKQUEUE MF \_ TOPONODE</span><span class="sxs-lookup"><span data-stu-id="4cfbc-257">MF\_TOPONODE\_WORKQUEUE\_ITEM\_PRIORITY</span></span>](mf-toponode-workqueue-item-priority.md)
-   [<span data-ttu-id="4cfbc-258">MF \_ TOPONODE \_ WORKQUEUE \_ MMCSS \_ Priority</span><span class="sxs-lookup"><span data-stu-id="4cfbc-258">MF\_TOPONODE\_WORKQUEUE\_MMCSS\_PRIORITY</span></span>](mf-toponode-workqueue-mmcss-priority.md)
-   [<span data-ttu-id="4cfbc-259">**MFAllocateSerialWorkQueue**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-259">**MFAllocateSerialWorkQueue**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfallocateserialworkqueue)
-   [<span data-ttu-id="4cfbc-260">**MFBeginRegisterWorkQueueWithMMCSSEx**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-260">**MFBeginRegisterWorkQueueWithMMCSSEx**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfbeginregisterworkqueuewithmmcssex)
-   [<span data-ttu-id="4cfbc-261">**MFGetWorkQueueMMCSSPriority**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-261">**MFGetWorkQueueMMCSSPriority**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfgetworkqueuemmcsspriority)
-   [<span data-ttu-id="4cfbc-262">**MFPutWaitingWorkItem**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-262">**MFPutWaitingWorkItem**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfputwaitingworkitem)
-   [<span data-ttu-id="4cfbc-263">**MFPutWorkItem2**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-263">**MFPutWorkItem2**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem2)
-   [<span data-ttu-id="4cfbc-264">**MFPutWorkItemEx2**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-264">**MFPutWorkItemEx2**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex2)
-   [<span data-ttu-id="4cfbc-265">**MFRegisterPlatformWithMMCSS**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-265">**MFRegisterPlatformWithMMCSS**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfregisterplatformwithmmcss)
-   [<span data-ttu-id="4cfbc-266">**MFUnregisterPlatformFromMMCSS**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-266">**MFUnregisterPlatformFromMMCSS**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mfunregisterplatformfrommmcss)
-   [<span data-ttu-id="4cfbc-267">**MFLockSharedWorkQueue**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-267">**MFLockSharedWorkQueue**</span></span>](/windows/desktop/api/mfapi/nf-mfapi-mflocksharedworkqueue)
-   [<span data-ttu-id="4cfbc-268">**IMFRealTimeClientEx**</span><span class="sxs-lookup"><span data-stu-id="4cfbc-268">**IMFRealTimeClientEx**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfrealtimeclientex)

## <a name="related-topics"></a><span data-ttu-id="4cfbc-269">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="4cfbc-269">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4cfbc-270">Code di lavoro</span><span class="sxs-lookup"><span data-stu-id="4cfbc-270">Work Queues</span></span>](work-queues.md)
</dt> </dl>

 

 
