---
description: In questo argomento viene descritto in che modo gli oggetti pipeline personalizzati possono supportare frequenze di riproduzione variabili, inclusa la riproduzione inversa. Per informazioni sull'uso del controllo della velocità da un'applicazione, vedere controllo della frequenza.
ms.assetid: 077678db-ca5a-423b-9430-93497113d639
title: Implementazione del controllo della frequenza
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f5fd78cbbb95316a0d4ed12a50c9d3aa8954fe8a
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "104057918"
---
# <a name="implementing-rate-control"></a><span data-ttu-id="61bee-104">Implementazione del controllo della frequenza</span><span class="sxs-lookup"><span data-stu-id="61bee-104">Implementing Rate Control</span></span>

<span data-ttu-id="61bee-105">In questo argomento viene descritto in che modo gli oggetti pipeline personalizzati possono supportare frequenze di riproduzione variabili, inclusa la riproduzione inversa.</span><span class="sxs-lookup"><span data-stu-id="61bee-105">This topic describes how custom pipeline objects can support variable playback rates, including reverse playback.</span></span> <span data-ttu-id="61bee-106">Per informazioni sull'uso del controllo della velocità da un'applicazione, vedere [controllo della frequenza](rate-control.md).</span><span class="sxs-lookup"><span data-stu-id="61bee-106">For information about using rate control from an application, see [Rate Control](rate-control.md).</span></span>

<span data-ttu-id="61bee-107">In questo argomento sono incluse le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="61bee-107">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="61bee-108">Origini supporti</span><span class="sxs-lookup"><span data-stu-id="61bee-108">Media Sources</span></span>](#media-sources)
-   [<span data-ttu-id="61bee-109">Trasformazioni Media Foundation</span><span class="sxs-lookup"><span data-stu-id="61bee-109">Media Foundation Transforms</span></span>](#media-foundation-transforms)
    -   [<span data-ttu-id="61bee-110">Riproduzione inversa</span><span class="sxs-lookup"><span data-stu-id="61bee-110">Reverse Playback</span></span>](#reverse-playback)
-   [<span data-ttu-id="61bee-111">Sink di supporti</span><span class="sxs-lookup"><span data-stu-id="61bee-111">Media Sinks</span></span>](#media-sinks)
-   [<span data-ttu-id="61bee-112">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="61bee-112">Related topics</span></span>](#related-topics)

<span data-ttu-id="61bee-113">Se si scrive un oggetto Microsoft Media Foundation pipeline (un'origine multimediale, una trasformazione o un sink multimediale), potrebbe essere necessario supportare frequenze di riproduzione variabili.</span><span class="sxs-lookup"><span data-stu-id="61bee-113">If you are writing a Microsoft Media Foundation pipeline object (a media source, transform, or media sink), you might need to support variable playback rates.</span></span> <span data-ttu-id="61bee-114">A tale scopo, implementare le interfacce seguenti:</span><span class="sxs-lookup"><span data-stu-id="61bee-114">To do so, implement the following interfaces:</span></span>

1.  <span data-ttu-id="61bee-115">Implementare l'interfaccia [**IMFGetService**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice) .</span><span class="sxs-lookup"><span data-stu-id="61bee-115">Implement the [**IMFGetService**](/windows/desktop/api/mfidl/nn-mfidl-imfgetservice) interface.</span></span>
2.  <span data-ttu-id="61bee-116">Supportare il servizio di **\_ \_ controllo \_ della velocità di MF** .</span><span class="sxs-lookup"><span data-stu-id="61bee-116">Support the **MF\_RATE\_CONTROL\_SERVICE** service.</span></span> <span data-ttu-id="61bee-117">Vedere [interfacce del servizio](service-interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="61bee-117">(See [Service Interfaces](service-interfaces.md).)</span></span>
3.  <span data-ttu-id="61bee-118">Implementare l'interfaccia [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) , che ottiene le frequenze di riproduzione supportate dall'oggetto.</span><span class="sxs-lookup"><span data-stu-id="61bee-118">Implement the [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) interface, which gets the playback rates supported by the object.</span></span>
4.  <span data-ttu-id="61bee-119">Implementare l'interfaccia [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) , che ottiene o imposta la velocità di riproduzione.</span><span class="sxs-lookup"><span data-stu-id="61bee-119">Implement the [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) interface, which gets or sets the playback rate.</span></span>

## <a name="media-sources"></a><span data-ttu-id="61bee-120">Origini supporti</span><span class="sxs-lookup"><span data-stu-id="61bee-120">Media Sources</span></span>

<span data-ttu-id="61bee-121">Se un'origine supporto supporta il controllo della frequenza, deve implementare sia [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) che [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).</span><span class="sxs-lookup"><span data-stu-id="61bee-121">If a media source supports rate control, it should implement both [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) and [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).</span></span> <span data-ttu-id="61bee-122">In caso contrario, la sessione multimediale segnala che la frequenza di riproduzione minima e massima è 1,0, indipendentemente dagli altri componenti presenti nella pipeline.</span><span class="sxs-lookup"><span data-stu-id="61bee-122">Otherwise, the Media Session reports that the minimum and maximum playback rate is 1.0, regardless of what other components are in the pipeline.</span></span>

<span data-ttu-id="61bee-123">La velocità di riproduzione non influisce sui tempi di presentazione degli esempi, quindi l'origine multimediale non deve modificare i timestamp.</span><span class="sxs-lookup"><span data-stu-id="61bee-123">The playback rate does not affect the presentation times of the samples, so the media source should not adjust its time stamps.</span></span> <span data-ttu-id="61bee-124">Al contrario, il clock di presentazione viene eseguito a una velocità più veloce o più lenta.</span><span class="sxs-lookup"><span data-stu-id="61bee-124">Instead, the presentation clock runs at a faster or slower speed.</span></span> <span data-ttu-id="61bee-125">Per la riproduzione inversa, l'origine recapita gli esempi in ordine inverso, con indicatori temporali decrescenti.</span><span class="sxs-lookup"><span data-stu-id="61bee-125">For reverse playback, the source delivers samples in reverse order, with decreasing time stamps.</span></span>

<span data-ttu-id="61bee-126">Il parametro *fThin* del metodo [**IMFRateControl::**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate) SetValue indica se l'origine del supporto deve *assottigliare* il contenuto.</span><span class="sxs-lookup"><span data-stu-id="61bee-126">The *fThin* parameter of the [**IMFRateControl::SetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate) method indicates whether media source should *thin* the content.</span></span> <span data-ttu-id="61bee-127">Il diluente si applica principalmente ai flussi video.</span><span class="sxs-lookup"><span data-stu-id="61bee-127">Thinning applies primarily to video streams.</span></span> <span data-ttu-id="61bee-128">In modalità assottigliata, l'origine Elimina i frame Delta e recapita solo i fotogrammi chiave.</span><span class="sxs-lookup"><span data-stu-id="61bee-128">In thinned mode, the source drops delta frames and deliver only key frames.</span></span> <span data-ttu-id="61bee-129">A frequenze di riproduzione molto elevate, l'origine potrebbe ignorare alcuni fotogrammi chiave, ad esempio recapitare tutti gli altri fotogrammi chiave.</span><span class="sxs-lookup"><span data-stu-id="61bee-129">At very high playback rates, the source might skip some key frames (for example, deliver every other key frame).</span></span>

<span data-ttu-id="61bee-130">Non è necessario che l'origine elimini gli esempi audio in modalità diluita.</span><span class="sxs-lookup"><span data-stu-id="61bee-130">The source does not have to drop audio samples in thinned mode.</span></span> <span data-ttu-id="61bee-131">A frequenze di riproduzione molto elevate, tuttavia, l'origine potrebbe non essere in grado di leggere i dati nough rapidamente per completare le richieste di esempio della pipeline.</span><span class="sxs-lookup"><span data-stu-id="61bee-131">At very high playback rates, however, the source might not be able to read data fast nough to fill the pipeline's sample requests.</span></span> <span data-ttu-id="61bee-132">In tal caso, l'origine potrebbe dover eliminare alcuni dati audio.</span><span class="sxs-lookup"><span data-stu-id="61bee-132">In that case, the source might need to drop some audio data.</span></span> <span data-ttu-id="61bee-133">In tal caso, è consigliabile provare a recapitare gli esempi audio che sono vicini agli esempi video (presupponendo che l'origine abbia entrambi i tipi di flusso).</span><span class="sxs-lookup"><span data-stu-id="61bee-133">If so, it should attempt to deliver audio samples that are close in time to the video samples (assuming that the source has both types of stream).</span></span>

<span data-ttu-id="61bee-134">Quando un flusso esegue una transizione tra la modalità assottigliata e quella non diluita, invia un evento [MEStreamThinMode](mestreamthinmode.md) .</span><span class="sxs-lookup"><span data-stu-id="61bee-134">When a stream transitions between thinned and non-thinned mode, it sends an [MEStreamThinMode](mestreamthinmode.md) event.</span></span>

<span data-ttu-id="61bee-135">Quando l'origine del supporto completa una chiamata a [**bitrate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate), invia l'evento [MESourceRateChanged](mesourceratechanged.md) .</span><span class="sxs-lookup"><span data-stu-id="61bee-135">When the media source completes a call to [**SetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfratecontrol-setrate), it sends the [MESourceRateChanged](mesourceratechanged.md) event.</span></span>

<span data-ttu-id="61bee-136">Durante la riproduzione inversa:</span><span class="sxs-lookup"><span data-stu-id="61bee-136">During reverse playback:</span></span>

-   <span data-ttu-id="61bee-137">L'origine multimediale recapita gli esempi in ordine inverso, senza modificare i timestamp.</span><span class="sxs-lookup"><span data-stu-id="61bee-137">The media source delivers samples in reverse order, without adjusting the time stamps.</span></span>
-   <span data-ttu-id="61bee-138">I timestamp all'interno di un flusso devono diminuire in maniera progressiva.</span><span class="sxs-lookup"><span data-stu-id="61bee-138">Time stamps within a stream should monotonically decrease.</span></span>
-   <span data-ttu-id="61bee-139">L'inizio del contenuto è considerato la fine del flusso.</span><span class="sxs-lookup"><span data-stu-id="61bee-139">The beginning of the content is considered the end of the stream.</span></span> <span data-ttu-id="61bee-140">Quando ogni flusso multimediale recapita il primo campione nel flusso (ovvero il tempo di presentazione = 0), invia l'evento [MEEndOfStream](meendofstream.md) .</span><span class="sxs-lookup"><span data-stu-id="61bee-140">After each media stream delivers the first sample in the stream (that is, presentation time = 0), it sends the [MEEndOfStream](meendofstream.md) event.</span></span>

## <a name="media-foundation-transforms"></a><span data-ttu-id="61bee-141">Trasformazioni Media Foundation</span><span class="sxs-lookup"><span data-stu-id="61bee-141">Media Foundation Transforms</span></span>

<span data-ttu-id="61bee-142">In generale, una trasformazione Media Foundation (MFT) non necessita di un supporto esplicito per il controllo della frequenza, a meno che il MFT non implementi la riproduzione inversa non diluita.</span><span class="sxs-lookup"><span data-stu-id="61bee-142">In general, a Media Foundation transform (MFT) does not need explicit support for rate control, unless the MFT implements non-thinned reverse playback.</span></span>

<span data-ttu-id="61bee-143">Se un MFT non implementa l'interfaccia [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) , la sessione multimediale presuppone quanto segue:</span><span class="sxs-lookup"><span data-stu-id="61bee-143">If an MFT does not implement the [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) interface, the Media Session assumes the following:</span></span>

-   <span data-ttu-id="61bee-144">Il MFT supporta la velocità di riproduzione arbitrario per la riproduzione in diretta, sia assottigliata che non assottigliata.</span><span class="sxs-lookup"><span data-stu-id="61bee-144">The MFT supports arbitary playback rates for forward playback, both thinned and non-thinned.</span></span>
-   <span data-ttu-id="61bee-145">Il MFT supporta la riproduzione inversa assottigliata, ma non supporta la riproduzione inversa non diluita.</span><span class="sxs-lookup"><span data-stu-id="61bee-145">The MFT supports thinned reverse playback, but does not support non-thinned reverse playback.</span></span>

<span data-ttu-id="61bee-146">Se una di queste condizioni non è vera, il MFT deve implementare [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) e [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).</span><span class="sxs-lookup"><span data-stu-id="61bee-146">If either of these conditions is not true, the MFT should implement [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) and [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).</span></span>

### <a name="reverse-playback"></a><span data-ttu-id="61bee-147">Riproduzione inversa</span><span class="sxs-lookup"><span data-stu-id="61bee-147">Reverse Playback</span></span>

<span data-ttu-id="61bee-148">La sessione multimediale può essere riprodotta in ordine inverso anche se una o più trasformazioni nella pipeline non supportano in modo esplicito la riproduzione inversa.</span><span class="sxs-lookup"><span data-stu-id="61bee-148">The Media Session can play in reverse even if one or more transforms in the pipeline do not explicitly support reverse playback.</span></span>

<span data-ttu-id="61bee-149">Se un MFT non espone l'interfaccia [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) , la sessione multimediale usa il *assottigliamento* per la riproduzione inversa, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="61bee-149">If an MFT does not expose the [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) interface, the Media Session uses *thinning* for reverse playback, as follows:</span></span>

-   <span data-ttu-id="61bee-150">La sessione multimediale invia i fotogrammi chiave alla MFT nel modo consueto, chiamando [**IMFTransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="61bee-150">The Media Session sends key frames to the MFT in the usual way, by calling [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>

-   <span data-ttu-id="61bee-151">La sessione multimediale Elimina i frame Delta e li sostituisce con gli eventi [MEStreamTick](mestreamtick.md) .</span><span class="sxs-lookup"><span data-stu-id="61bee-151">The Media Session drops delta frames and replaces them with [MEStreamTick](mestreamtick.md) events.</span></span>

-   <span data-ttu-id="61bee-152">Tra ogni esempio, la sessione multimediale Scarica la tabella MFT per evitare gli errori causati dal fatto che i timestamp diminuiscono.</span><span class="sxs-lookup"><span data-stu-id="61bee-152">Between each sample, the Media Session flushes the MFT, to avoid any errors caused by the fact that the time stamps are decreasing.</span></span>

<span data-ttu-id="61bee-153">Un esempio è considerato un fotogramma chiave se l'attributo [ \_ CleanPoint di MFSampleExtension](mfsampleextension-cleanpoint-attribute.md) è impostato su **true** e viene considerato un frame Delta se questo attributo è **false** o non è impostato.</span><span class="sxs-lookup"><span data-stu-id="61bee-153">A sample is considered a key frame if it has the [MFSampleExtension\_CleanPoint](mfsampleextension-cleanpoint-attribute.md) attribute set to **TRUE**, and is considered a delta frame if this attribute is **FALSE** or not set.</span></span>

<span data-ttu-id="61bee-154">Se MFT implementa [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport), la sessione multimediale usa questa interfaccia per individuare se la MFT supporta la riproduzione inversa non assottigliata.</span><span class="sxs-lookup"><span data-stu-id="61bee-154">If the MFT implements [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport), the Media Session uses this interface to discover whether the MFT supports non-thinned reverse playback.</span></span> <span data-ttu-id="61bee-155">Se il file MFT supporta la riproduzione inversa non assottigliata, la sessione multimediale recapita tutti gli esempi, in ordine inverso, senza eliminare gli esempi o scaricare la MFT.</span><span class="sxs-lookup"><span data-stu-id="61bee-155">If the MFT supports non-thinned reverse playback, the Media Session delivers all of the samples, in reverse order, without dropping samples or flushing the MFT.</span></span>

<span data-ttu-id="61bee-156">Se una MFT supporta la riproduzione inversa non assottigliata, deve implementare l'interfaccia [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) .</span><span class="sxs-lookup"><span data-stu-id="61bee-156">If an MFT supports non-thinned reverse playback, it should implement the [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol) interface.</span></span> <span data-ttu-id="61bee-157">La sessione multimediale utilizzerà questa interfaccia per inviare una notifica alla MFT quando si verifica la riproduzione inversa.</span><span class="sxs-lookup"><span data-stu-id="61bee-157">The Media Session will use this interface to notify the MFT when reverse playback occurs.</span></span> <span data-ttu-id="61bee-158">A questo punto, è necessario preparare il MFT per la riduzione dei timestamp e per i frame Delta in ordine inverso.</span><span class="sxs-lookup"><span data-stu-id="61bee-158">At that point, the MFT must be prepared for the time stamps to decrease and for delta frames to arrive in reverse order.</span></span> <span data-ttu-id="61bee-159">In genere, un decodificatore deve memorizzare nel buffer gli esempi fino a quando non riceve un intero Group of Pictures (GOP), quindi decodifica l'intero GOP e Visualizza i frame decodificati nell'ordine corretto (inverso).</span><span class="sxs-lookup"><span data-stu-id="61bee-159">A decoder will typically need to buffer samples until it has received an entire group of pictures (GOP), then decode the entire GOP and output the decoded frames in the correct (reverse) order.</span></span>

## <a name="media-sinks"></a><span data-ttu-id="61bee-160">Sink di supporti</span><span class="sxs-lookup"><span data-stu-id="61bee-160">Media Sinks</span></span>

<span data-ttu-id="61bee-161">Se un sink multimediale è *senza frequenza*, la sessione multimediale presuppone che il sink multimediale sia in grado di gestire qualsiasi frequenza di riproduzione.</span><span class="sxs-lookup"><span data-stu-id="61bee-161">If a media sink is *rateless*, the Media Session assumes that media sink can handle any playback rate.</span></span> <span data-ttu-id="61bee-162">Il sink multimediale non deve implementare [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport).</span><span class="sxs-lookup"><span data-stu-id="61bee-162">The media sink does not need to implement [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport).</span></span> <span data-ttu-id="61bee-163">Un sink multimediale senza frequenza restituisce MEDIASINK \_ Flag senza frequenza dal metodo [**IMFMediaSink:: getcaratteristiche**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) .</span><span class="sxs-lookup"><span data-stu-id="61bee-163">(A rateless media sink returns the MEDIASINK\_RATELESS flag from the [**IMFMediaSink::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasink-getcharacteristics) method.)</span></span>

<span data-ttu-id="61bee-164">In caso contrario, un sink multimediale deve implementare [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) se può gestire frequenze di riproduzione diverse da 1,0.</span><span class="sxs-lookup"><span data-stu-id="61bee-164">Otherwise, a media sink should implement [**IMFRateSupport**](/windows/desktop/api/mfidl/nn-mfidl-imfratesupport) if it can handle playback rates other than 1.0.</span></span>

<span data-ttu-id="61bee-165">I sink di supporto non devono implementare [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).</span><span class="sxs-lookup"><span data-stu-id="61bee-165">Media sinks should not implement [**IMFRateControl**](/windows/desktop/api/mfidl/nn-mfidl-imfratecontrol).</span></span> <span data-ttu-id="61bee-166">Quando la velocità di riproduzione viene modificata, il clock di presentazione chiama il metodo [**IMFClockStateSink:: OnClockSetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfclockstatesink-onclocksetrate) del sink multimediale.</span><span class="sxs-lookup"><span data-stu-id="61bee-166">When the playback rate changes, the presentation clock calls the media sink's [**IMFClockStateSink::OnClockSetRate**](/windows/desktop/api/mfidl/nf-mfidl-imfclockstatesink-onclocksetrate) method.</span></span>

## <a name="related-topics"></a><span data-ttu-id="61bee-167">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="61bee-167">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="61bee-168">Controllo della frequenza</span><span class="sxs-lookup"><span data-stu-id="61bee-168">Rate Control</span></span>](rate-control.md)
</dt> <dt>

[<span data-ttu-id="61bee-169">Ricerca, avanzamento rapido e riproduzione inversa</span><span class="sxs-lookup"><span data-stu-id="61bee-169">Seeking, Fast Forward, and Reverse Play</span></span>](seeking--fast-forward--and-reverse-play.md)
</dt> </dl>

 

 



