---
description: Questo argomento descrive come supportare Microsoft Direct3D 11 in un decodificatore Microsoft Media Foundation.
ms.assetid: 656556AA-0266-4318-9D3C-AED75BD728F6
title: Supporto della decodifica video Direct3D 11 in Media Foundation
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 542f7244922dc7947f22e4d33027fdcac1962fe5
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/03/2021
ms.locfileid: "106320732"
---
# <a name="supporting-direct3d-11-video-decoding-in-media-foundation"></a><span data-ttu-id="4cb60-103">Supporto della decodifica video Direct3D 11 in Media Foundation</span><span class="sxs-lookup"><span data-stu-id="4cb60-103">Supporting Direct3D 11 Video Decoding in Media Foundation</span></span>

<span data-ttu-id="4cb60-104">Questo argomento descrive come supportare Microsoft Direct3D 11 in un decodificatore Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="4cb60-104">This topic describes how to support Microsoft Direct3D 11 in a Microsoft Media Foundation decoder.</span></span> <span data-ttu-id="4cb60-105">In particolare, descrive la comunicazione tra il decodificatore e il renderer video.</span><span class="sxs-lookup"><span data-stu-id="4cb60-105">Specifically, it describes the communication between the decoder and the video renderer.</span></span> <span data-ttu-id="4cb60-106">In questo argomento non viene descritto come implementare le operazioni di decodifica.</span><span class="sxs-lookup"><span data-stu-id="4cb60-106">This topic does not describe how to implement the decoding operations.</span></span>

-   [<span data-ttu-id="4cb60-107">Overview</span><span class="sxs-lookup"><span data-stu-id="4cb60-107">Overview</span></span>](#overview)
-   [<span data-ttu-id="4cb60-108">Aprire un handle di dispositivo</span><span class="sxs-lookup"><span data-stu-id="4cb60-108">Open a Device Handle</span></span>](#open-a-device-handle)
-   [<span data-ttu-id="4cb60-109">Trovare una configurazione del decodificatore</span><span class="sxs-lookup"><span data-stu-id="4cb60-109">Find a Decoder Configuration</span></span>](#find-a-decoder-configuration)
-   [<span data-ttu-id="4cb60-110">Fallback alla decodifica software</span><span class="sxs-lookup"><span data-stu-id="4cb60-110">Fallback to Software Decoding</span></span>](#fallback-to-software-decoding)
-   [<span data-ttu-id="4cb60-111">Allocazione di buffer non compressi</span><span class="sxs-lookup"><span data-stu-id="4cb60-111">Allocating Uncompressed Buffers</span></span>](#allocating-uncompressed-buffers)
-   [<span data-ttu-id="4cb60-112">Decodifica</span><span class="sxs-lookup"><span data-stu-id="4cb60-112">Decoding</span></span>](#supporting-direct3d-11-video-decoding-in-media-foundation)
-   [<span data-ttu-id="4cb60-113">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="4cb60-113">Related topics</span></span>](#related-topics)

## <a name="overview"></a><span data-ttu-id="4cb60-114">Panoramica</span><span class="sxs-lookup"><span data-stu-id="4cb60-114">Overview</span></span>

<span data-ttu-id="4cb60-115">Nella parte restante di questo argomento vengono usati i termini seguenti:</span><span class="sxs-lookup"><span data-stu-id="4cb60-115">In the remainder of this topic, the following terms are used:</span></span>

-   <span data-ttu-id="4cb60-116">**Decoder software**.</span><span class="sxs-lookup"><span data-stu-id="4cb60-116">**Software decoder**.</span></span> <span data-ttu-id="4cb60-117">Il decodificatore software è il Media Foundation Transform (MFT) che riceve gli esempi video compressi e restituisce i frame video non compressi.</span><span class="sxs-lookup"><span data-stu-id="4cb60-117">The software decoder is the Media Foundation transform (MFT) that receives compressed video samples and outputs uncompressed video frames.</span></span>
-   <span data-ttu-id="4cb60-118">**Dispositivo di decodificatore**.</span><span class="sxs-lookup"><span data-stu-id="4cb60-118">**Decoder device**.</span></span> <span data-ttu-id="4cb60-119">Il dispositivo decodificatore è il tasto di scelta rapida video e viene implementato dal driver di grafica.</span><span class="sxs-lookup"><span data-stu-id="4cb60-119">The decoder device is the video accelerator, and is implemented by the graphics driver.</span></span> <span data-ttu-id="4cb60-120">Il dispositivo di decodificatore esegue operazioni di decodifica accelerate.</span><span class="sxs-lookup"><span data-stu-id="4cb60-120">The decoder device performs accelerated decoding operations.</span></span>
-   <span data-ttu-id="4cb60-121">**Pipeline**.</span><span class="sxs-lookup"><span data-stu-id="4cb60-121">**Pipeline**.</span></span> <span data-ttu-id="4cb60-122">La pipeline ospita il decoder software e recapita i buffer da e verso il decoder software.</span><span class="sxs-lookup"><span data-stu-id="4cb60-122">The pipeline hosts the software decoder and delivers buffers to and from the software decoder.</span></span> <span data-ttu-id="4cb60-123">A seconda dell'applicazione, la pipeline potrebbe essere la [sessione multimediale](media-session.md), il [lettore di origine](source-reader.md)o il codice dell'applicazione che chiama direttamente nella MFT.</span><span class="sxs-lookup"><span data-stu-id="4cb60-123">Depending on the application, the pipeline might be the [Media Session](media-session.md), the [Source Reader](source-reader.md), or application code that directly calls into the MFT.</span></span>

<span data-ttu-id="4cb60-124">Per eseguire la decodifica con Direct3D 11, il decodificatore software deve avere un puntatore a un dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="4cb60-124">To perform decoding using Direct3D 11, the software decoder must have a pointer to a Direct3D 11 device.</span></span> <span data-ttu-id="4cb60-125">Il dispositivo Direct3D 11 viene creato esternamente al decoder software.</span><span class="sxs-lookup"><span data-stu-id="4cb60-125">The Direct3D 11 device is created externally to the software decoder.</span></span> <span data-ttu-id="4cb60-126">In uno scenario di [sessione multimediale](media-session.md) , il renderer video crea il dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="4cb60-126">In a [Media Session](media-session.md) scenario, the video renderer creates the Direct3D 11 device.</span></span> <span data-ttu-id="4cb60-127">In uno scenario di [lettore di origine](source-reader.md) , in genere l'applicazione crea il dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="4cb60-127">In a [Source Reader](source-reader.md) scenario, typically the application creates the Direct3D 11 device.</span></span>

<span data-ttu-id="4cb60-128">Il Gestione dispositivi DXGI viene usato per condividere il componente Direct3D 11 tra i componenti.</span><span class="sxs-lookup"><span data-stu-id="4cb60-128">The DXGI Device Manager is used to share the Direct3D 11 between components.</span></span> <span data-ttu-id="4cb60-129">Il Gestione dispositivi DXGI espone l'interfaccia [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-129">The DXGI Device Manager exposes the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span> <span data-ttu-id="4cb60-130">La pipeline imposta il puntatore **IMFDXGIDeviceManager** sul decodificatore software inviando il messaggio di [**\_ \_ \_ \_ gestione D3D del set di messaggi MFT**](mft-message-set-d3d-manager.md) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-130">The pipeline sets the **IMFDXGIDeviceManager** pointer on the software decoder by sending the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message.</span></span>

<span data-ttu-id="4cb60-131">Il diagramma seguente illustra la relazione tra il decodificatore software, Direct3D 11 e la pipeline.</span><span class="sxs-lookup"><span data-stu-id="4cb60-131">The following diagram shows the relation between the software decoder, the Direct3D 11, and the pipeline.</span></span>

![diagramma che mostra il decodificatore software e gestione dispositivi dxgi.](images/d3d11video01.png)

<span data-ttu-id="4cb60-133">Ecco i passaggi di base che devono essere eseguiti da un decodificatore software per supportare Direct3D 11 in Media Foundation:</span><span class="sxs-lookup"><span data-stu-id="4cb60-133">Here are the basic steps that a software decoder must perform to support Direct3D 11 in Media Foundation:</span></span>

1.  <span data-ttu-id="4cb60-134">Aprire un handle per il dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="4cb60-134">Open a handle to the Direct3D 11 device.</span></span>
2.  <span data-ttu-id="4cb60-135">Trovare una configurazione del decodificatore.</span><span class="sxs-lookup"><span data-stu-id="4cb60-135">Find a decoder configuration.</span></span>
3.  <span data-ttu-id="4cb60-136">Allocare buffer non compressi.</span><span class="sxs-lookup"><span data-stu-id="4cb60-136">Allocate uncompressed buffers.</span></span>
4.  <span data-ttu-id="4cb60-137">Decodificare i frame.</span><span class="sxs-lookup"><span data-stu-id="4cb60-137">Decode frames.</span></span>

<span data-ttu-id="4cb60-138">Questi passaggi sono descritti in modo più dettagliato nella parte restante di questo argomento.</span><span class="sxs-lookup"><span data-stu-id="4cb60-138">These steps are described in more detail in the remainder of this topic.</span></span>

## <a name="open-a-device-handle"></a><span data-ttu-id="4cb60-139">Aprire un handle di dispositivo</span><span class="sxs-lookup"><span data-stu-id="4cb60-139">Open a Device Handle</span></span>

<span data-ttu-id="4cb60-140">Il decodificatore MFT USA gestione dispositivi DXGI per ottenere un handle per il dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="4cb60-140">The decoder MFT uses the DXGI device manager to get a handle to the Direct3D 11 device.</span></span> <span data-ttu-id="4cb60-141">Per aprire l'handle del dispositivo, seguire questa procedura:</span><span class="sxs-lookup"><span data-stu-id="4cb60-141">To open the device handle, perform the following steps:</span></span>

1.  <span data-ttu-id="4cb60-142">Il decodificatore MFT deve esporre l'attributo in [ \_ grado di \_ \_ riconoscere MF SA d3d11](mf-sa-d3d11-aware.md) con il valore **true**.</span><span class="sxs-lookup"><span data-stu-id="4cb60-142">The decoder MFT must expose the [MF\_SA\_D3D11\_AWARE](mf-sa-d3d11-aware.md) attribute with the value **TRUE**.</span></span>
2.  <span data-ttu-id="4cb60-143">Il caricatore della topologia esegue una query su questo attributo chiamando [**IMFTransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes).</span><span class="sxs-lookup"><span data-stu-id="4cb60-143">The Topology Loader queries this attribute by calling [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes).</span></span> <span data-ttu-id="4cb60-144">Il valore **true** indica che la MFT supporta Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="4cb60-144">The value **TRUE** indicates that the MFT supports Direct3D 11.</span></span>
3.  <span data-ttu-id="4cb60-145">Il caricatore della topologia chiama [**IMFTransform::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con il messaggio [**MFT \_ manager message \_ set \_ D3D \_ Manager**](mft-message-set-d3d-manager.md) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-145">The Topology Loader calls [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message.</span></span> <span data-ttu-id="4cb60-146">Il parametro *ulParam* è un puntatore [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) a gestione dispositivi dxgi.</span><span class="sxs-lookup"><span data-stu-id="4cb60-146">The *ulParam* parameter is an [**IUnknown**](/windows/win32/api/unknwn/nn-unknwn-iunknown) pointer to the DXGI device manager.</span></span> <span data-ttu-id="4cb60-147">Eseguire una query su questo puntatore per l'interfaccia [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-147">Query this pointer for the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span>
4.  <span data-ttu-id="4cb60-148">Chiamare [**IMFDXGIDeviceManager:: OpenDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-opendevicehandle) per ottenere un handle per il dispositivo Direct3D 11.</span><span class="sxs-lookup"><span data-stu-id="4cb60-148">Call [**IMFDXGIDeviceManager::OpenDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-opendevicehandle) to get a handle to the Direct3D 11 device.</span></span>
5.  <span data-ttu-id="4cb60-149">Per ottenere un puntatore al dispositivo Direct3D 11, chiamare [**IMFDXGIDeviceManager:: GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice).</span><span class="sxs-lookup"><span data-stu-id="4cb60-149">To get a pointer to the Direct3D 11 device, call [**IMFDXGIDeviceManager::GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice).</span></span> <span data-ttu-id="4cb60-150">Passare l'handle del dispositivo e il valore **IID \_ ID3D11Device**.</span><span class="sxs-lookup"><span data-stu-id="4cb60-150">Pass in the device handle and the value **IID\_ID3D11Device**.</span></span> <span data-ttu-id="4cb60-151">Il metodo restituisce un puntatore all'interfaccia [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-151">The method returns a pointer to the [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) interface.</span></span>
6.  <span data-ttu-id="4cb60-152">Per ottenere un puntatore all'acceleratore video, chiamare di nuovo [**IMFDXGIDeviceManager:: GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-152">To get a pointer to the video accelerator, call [**IMFDXGIDeviceManager::GetVideoService**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-getvideoservice) again.</span></span> <span data-ttu-id="4cb60-153">Questa volta passare l'handle del dispositivo e il valore **IID \_ ID3D11VideoDevice**.</span><span class="sxs-lookup"><span data-stu-id="4cb60-153">This time, pass in the device handle and the value **IID\_ID3D11VideoDevice**.</span></span> <span data-ttu-id="4cb60-154">Il metodo restituisce un puntatore all'interfaccia [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-154">The method returns a pointer to the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface.</span></span>
7.  <span data-ttu-id="4cb60-155">Chiamare [**ID3D11Device:: GetImmediateContext**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-getimmediatecontext) per ottenere un puntatore [**sul ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-155">Call [**ID3D11Device::GetImmediateContext**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-getimmediatecontext) to get an [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) pointer.</span></span>
8.  <span data-ttu-id="4cb60-156">Chiamare [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) su [**sul ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) per ottenere un puntatore [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-156">Call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on the [**ID3D11DeviceContext**](/windows/win32/api/d3d11/nn-d3d11-id3d11devicecontext) to get an [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext) pointer.</span></span>
9.  <span data-ttu-id="4cb60-157">Si consiglia di usare la protezione multithreading nel contesto di dispositivo per evitare problemi di deadlock che possono verificarsi a volte quando si chiama [**ID3D11VideoContext:: GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) o [**ID3D11VideoContext:: ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span><span class="sxs-lookup"><span data-stu-id="4cb60-157">It is recommended that you use multi-thread protection on the device context to prevent deadlock issues that can sometimes happen when you call [**ID3D11VideoContext::GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) or [**ID3D11VideoContext::ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span></span> <span data-ttu-id="4cb60-158">Per impostare la protezione multithread, chiamare prima [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) su [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) per ottenere un puntatore [**ID3D10Multithread**](/windows/win32/api/d3d10/nn-d3d10-id3d10multithread) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-158">To set multi-thread protection, first call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) to get an [**ID3D10Multithread**](/windows/win32/api/d3d10/nn-d3d10-id3d10multithread) pointer.</span></span> <span data-ttu-id="4cb60-159">Chiamare quindi [**ID3D10Multithread:: SetMultithreadProtected**](/windows/win32/api/d3d10/nf-d3d10-id3d10multithread-setmultithreadprotected), passando **true** per *bMTProtect*.</span><span class="sxs-lookup"><span data-stu-id="4cb60-159">Then call [**ID3D10Multithread::SetMultithreadProtected**](/windows/win32/api/d3d10/nf-d3d10-id3d10multithread-setmultithreadprotected), passing in **true** for *bMTProtect*.</span></span>

## <a name="find-a-decoder-configuration"></a><span data-ttu-id="4cb60-160">Trovare una configurazione del decodificatore</span><span class="sxs-lookup"><span data-stu-id="4cb60-160">Find a Decoder Configuration</span></span>

<span data-ttu-id="4cb60-161">Per eseguire la decodifica, il decodificatore software deve trovare una configurazione compatibile supportata dal dispositivo di decodificatore, incluso un formato di destinazione di rendering.</span><span class="sxs-lookup"><span data-stu-id="4cb60-161">To perform decoding, the software decoder must find a compatible configuration that is supported by the decoder device, including a render-target format.</span></span> <span data-ttu-id="4cb60-162">Questo passaggio si verifica nel metodo [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) , come indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="4cb60-162">This step occurs inside the [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) method, as follows.</span></span>

1.  <span data-ttu-id="4cb60-163">Convalidare il tipo di supporto di input.</span><span class="sxs-lookup"><span data-stu-id="4cb60-163">Validate the input media type.</span></span> <span data-ttu-id="4cb60-164">Se il tipo è rifiutato, ignorare i passaggi rimanenti e restituire un codice di errore.</span><span class="sxs-lookup"><span data-stu-id="4cb60-164">If the type is rejected, skip the remaining steps and return an error code.</span></span>
2.  <span data-ttu-id="4cb60-165">Chiamare [**ID3D11VideoDevice:: GetVideoDecoderProfileCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofilecount) per ottenere il numero di profili supportati.</span><span class="sxs-lookup"><span data-stu-id="4cb60-165">Call [**ID3D11VideoDevice::GetVideoDecoderProfileCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofilecount) to get the number of supported profiles.</span></span>
3.  <span data-ttu-id="4cb60-166">Chiamare [**ID3D11VideoDevice:: GetVideoDecoderProfile**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofile) per enumerare i profili e ottenere i GUID del profilo.</span><span class="sxs-lookup"><span data-stu-id="4cb60-166">Call [**ID3D11VideoDevice::GetVideoDecoderProfile**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderprofile) to enumerate the profiles and get the profile GUIDs.</span></span>
4.  <span data-ttu-id="4cb60-167">Cercare un GUID del profilo che corrisponda al formato video e alle funzionalità del decodificatore software.</span><span class="sxs-lookup"><span data-stu-id="4cb60-167">Look for a profile GUID that matches the video format and the capabilities of the software decoder.</span></span> <span data-ttu-id="4cb60-168">Un decodificatore MPEG-2, ad esempio, Cerca **d3d11 \_ decoder \_ profile \_ MPEG2 \_ MOCOMP**,**d3d11 \_ decoder \_ profile \_ MPEG2 \_ IDCT** e **d3d11 \_ decoder \_ profile \_ MPEG2 \_ VLD**.</span><span class="sxs-lookup"><span data-stu-id="4cb60-168">For example, an MPEG-2 decoder would look for **D3D11\_DECODER\_PROFILE\_MPEG2\_MOCOMP**,**D3D11\_DECODER\_PROFILE\_MPEG2\_IDCT**, and **D3D11\_DECODER\_PROFILE\_MPEG2\_VLD**.</span></span>
5.  <span data-ttu-id="4cb60-169">Se viene trovato un GUID del decodificatore appropriato, controllare il formato di output chiamando il metodo [**ID3D11VideoDevice:: CheckVideoDecoderFormat**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkvideodecoderformat) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-169">If a suitable decoder GUID is found, check the output format by calling the [**ID3D11VideoDevice::CheckVideoDecoderFormat**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkvideodecoderformat) method.</span></span> <span data-ttu-id="4cb60-170">Passare il GUID del decodificatore e un valore di **\_ formato DXGI** che specifica il formato di destinazione di rendering.</span><span class="sxs-lookup"><span data-stu-id="4cb60-170">Pass in the decoder GUID and a **DXGI\_FORMAT** value that specifies the render-target format.</span></span>
6.  <span data-ttu-id="4cb60-171">Individuare quindi una configurazione appropriata per il decodificatore.</span><span class="sxs-lookup"><span data-stu-id="4cb60-171">Next, find a suitable configuration for the decoder.</span></span>
    1.  <span data-ttu-id="4cb60-172">Chiamare [**ID3D11VideoDevice:: GetVideoDecoderConfigCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfigcount) per ottenere il numero di configurazioni del decodificatore.</span><span class="sxs-lookup"><span data-stu-id="4cb60-172">Call [**ID3D11VideoDevice::GetVideoDecoderConfigCount**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfigcount) to get the number of decoder configurations.</span></span> <span data-ttu-id="4cb60-173">Passare lo stesso GUID del dispositivo di decodificatore, insieme a una struttura [**d3d11 \_ video \_ decoder \_ desc**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_desc) che descrive il formato di destinazione di rendering proposto.</span><span class="sxs-lookup"><span data-stu-id="4cb60-173">Pass in the same decoder device GUID, along with a [**D3D11\_VIDEO\_DECODER\_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_desc) structure that describes the proposed render-target format.</span></span>
    2.  <span data-ttu-id="4cb60-174">Chiamare [**ID3D11VideoDevice:: GetVideoDecoderConfig**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfig) per enumerare le configurazioni del decodificatore.</span><span class="sxs-lookup"><span data-stu-id="4cb60-174">Call [**ID3D11VideoDevice::GetVideoDecoderConfig**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getvideodecoderconfig) to enumerate the decoder configurations.</span></span>

<span data-ttu-id="4cb60-175">Nel metodo [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) restituire un formato video non compresso in base al formato di destinazione di rendering proposto.</span><span class="sxs-lookup"><span data-stu-id="4cb60-175">In the [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) method, return an uncompressed video format based on the proposed render-target format.</span></span>

<span data-ttu-id="4cb60-176">Nel metodo [**IMFTransform:: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) controllare il tipo di supporto in base al formato di destinazione di rendering.</span><span class="sxs-lookup"><span data-stu-id="4cb60-176">In the [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) method, check the media type against the render target format.</span></span>

## <a name="fallback-to-software-decoding"></a><span data-ttu-id="4cb60-177">Fallback alla decodifica software</span><span class="sxs-lookup"><span data-stu-id="4cb60-177">Fallback to Software Decoding</span></span>

<span data-ttu-id="4cb60-178">Il MFT potrebbe non essere in grado di trovare una configurazione.</span><span class="sxs-lookup"><span data-stu-id="4cb60-178">The MFT might be unable to find a configuration.</span></span> <span data-ttu-id="4cb60-179">Ad esempio, il driver di grafica potrebbe non supportare le funzionalità corrette.</span><span class="sxs-lookup"><span data-stu-id="4cb60-179">For example, the graphics driver might not support the right capabilities.</span></span> <span data-ttu-id="4cb60-180">In tal caso, il programma MFT deve eseguire il fallback alla decodifica software, come indicato di seguito.</span><span class="sxs-lookup"><span data-stu-id="4cb60-180">In that case, the MFT must fall back to software decoding, as follows.</span></span>

1.  <span data-ttu-id="4cb60-181">I metodi [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) e [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) devono entrambi restituire **il \_ \_ tipo di \_ D3D \_ non supportato MF e**.</span><span class="sxs-lookup"><span data-stu-id="4cb60-181">The [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) and [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) methods should both return **MF\_E\_UNSUPPORTED\_D3D\_TYPE**.</span></span>
2.  <span data-ttu-id="4cb60-182">In risposta, il caricatore della topologia invierà il messaggio [**MFT \_ message \_ set di \_ \_ gestione D3D**](mft-message-set-d3d-manager.md) con il valore **null** per il parametro *ulParam* .</span><span class="sxs-lookup"><span data-stu-id="4cb60-182">In response, the Topology Loader will send the [**MFT\_MESSAGE\_SET\_D3D\_MANAGER**](mft-message-set-d3d-manager.md) message with the value **NULL** for the *ulParam* parameter.</span></span>
3.  <span data-ttu-id="4cb60-183">Il MFT rilascia il puntatore all'interfaccia [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-183">The MFT releases its pointer to the [**IMFDXGIDeviceManager**](/windows/desktop/api/mfobjects/nn-mfobjects-imfdxgidevicemanager) interface.</span></span>
4.  <span data-ttu-id="4cb60-184">Il caricatore della topologia rinegozia il tipo di supporto.</span><span class="sxs-lookup"><span data-stu-id="4cb60-184">The Topology Loader renegotiates the media type.</span></span>

<span data-ttu-id="4cb60-185">A questo punto, la MFT può usare la decodifica software.</span><span class="sxs-lookup"><span data-stu-id="4cb60-185">At this point, the MFT can use software decoding.</span></span>

## <a name="allocating-uncompressed-buffers"></a><span data-ttu-id="4cb60-186">Allocazione di buffer non compressi</span><span class="sxs-lookup"><span data-stu-id="4cb60-186">Allocating Uncompressed Buffers</span></span>

<span data-ttu-id="4cb60-187">Il decodificatore è responsabile dell'allocazione di trame Direct3D 11 da usare come buffer video non compressi.</span><span class="sxs-lookup"><span data-stu-id="4cb60-187">The decoder is responsible for allocating Direct3D 11 textures to use as uncompressed video buffers.</span></span> <span data-ttu-id="4cb60-188">L'attributo di [ \_ esempio di \_ \_ \_ \_ conteggio minimo di output MF SA](mf-sa-minimum-output-sample-count.md) negli attributi del flusso di output (vedere [**IMFTransform:: GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes)) viene usato per determinare il numero di superfici che il decodificatore deve allocare per il renderer video da usare per la deinterlacciamento.</span><span class="sxs-lookup"><span data-stu-id="4cb60-188">The [MF\_SA\_MINIMUM\_OUTPUT\_SAMPLE\_COUNT](mf-sa-minimum-output-sample-count.md) attribute in the output stream attributes (see [**IMFTransform::GetOutputStreamAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreamattributes)) is used to determine how many surfaces the decoder should allocate for the video renderer to use for deinterlacing .</span></span> <span data-ttu-id="4cb60-189">Un decodificatore deve usare questo valore per un limite superiore e inferiore ragionevole, ad esempio 3-32.</span><span class="sxs-lookup"><span data-stu-id="4cb60-189">A decoder should use this value bounding it for some reasonable upper and lower limits, for example 3-32.</span></span> <span data-ttu-id="4cb60-190">Per contenuti progressivi, vedere il [ \_ \_ numero minimo di \_ \_ esempi \_ \_ di output di MF SA](mf-sa-minimum-output-sample-count-progressive.md).</span><span class="sxs-lookup"><span data-stu-id="4cb60-190">For progressive content see [MF\_SA\_MINIMUM\_OUTPUT\_SAMPLE\_COUNT\_PROGRESSIVE](mf-sa-minimum-output-sample-count-progressive.md).</span></span>

<span data-ttu-id="4cb60-191">Nel metodo [**IMFTransform:: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) impostare il flusso di **output di MFT fornisce il flag \_ \_ \_ \_ Samples** nella struttura di [**informazioni del flusso di output di MFT \_ \_ \_**](/windows/win32/api/mftransform/ne-mftransform-_mft_output_stream_info_flags) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-191">In the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method, set the **MFT\_OUTPUT\_STREAM\_PROVIDES\_SAMPLES** flag in the [**MFT\_OUTPUT\_STREAM\_INFO**](/windows/win32/api/mftransform/ne-mftransform-_mft_output_stream_info_flags) structure.</span></span> <span data-ttu-id="4cb60-192">Questo flag notifica alla sessione multimediale che la MFT alloca gli esempi di output.</span><span class="sxs-lookup"><span data-stu-id="4cb60-192">This flag notifies the Media Session that the MFT allocates its own output samples.</span></span> <span data-ttu-id="4cb60-193">Per allocare gli esempi di output, il MFT esegue i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="4cb60-193">To allocate the output samples, the MFT performs the following steps:</span></span>

1.  <span data-ttu-id="4cb60-194">Creare una matrice di trama 2D chiamando [**ID3D11Device:: CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d).</span><span class="sxs-lookup"><span data-stu-id="4cb60-194">Create a 2D texture array by calling [**ID3D11Device::CreateTexture2D**](/windows/win32/api/d3d11/nf-d3d11-id3d11device-createtexture2d).</span></span> <span data-ttu-id="4cb60-195">Nella struttura [**d3d11 \_ TEXTURE2D \_ desc**](/windows/win32/api/d3d11/ns-d3d11-d3d11_texture2d_desc) impostare **arraySize** uguale al numero di superfici necessarie per il decodificatore.</span><span class="sxs-lookup"><span data-stu-id="4cb60-195">In the [**D3D11\_TEXTURE2D\_DESC**](/windows/win32/api/d3d11/ns-d3d11-d3d11_texture2d_desc) structure, set **ArraySize** equal to the number of surfaces that the decoder needs.</span></span> <span data-ttu-id="4cb60-196">ad esempio:</span><span class="sxs-lookup"><span data-stu-id="4cb60-196">This includes:</span></span>
    -   <span data-ttu-id="4cb60-197">Superfici per i frame di riferimento.</span><span class="sxs-lookup"><span data-stu-id="4cb60-197">Surfaces for reference frames.</span></span>
    -   <span data-ttu-id="4cb60-198">Superfici per la deinterlacciamento (tre superfici).</span><span class="sxs-lookup"><span data-stu-id="4cb60-198">Surfaces for deinterlacing (three surfaces).</span></span>
    -   <span data-ttu-id="4cb60-199">Superfici necessarie al decodificatore per il buffering.</span><span class="sxs-lookup"><span data-stu-id="4cb60-199">Surfaces that the decoder needs for buffering.</span></span>

    <span data-ttu-id="4cb60-200">I flag di binding (**BindFlags**) devono includere il flag **\_ \_ decodificatore bind d3d11** ed eventuali flag di associazione impostati tramite l'attributo [MF \_ sa \_ d3d11 \_ BindFlags](mf-sa-d3d11-bindflags.md) negli attributi del flusso di output.</span><span class="sxs-lookup"><span data-stu-id="4cb60-200">The binding flags (**BindFlags**) should include the **D3D11\_BIND\_DECODER** flag and any bind flags set through the [MF\_SA\_D3D11\_BINDFLAGS](mf-sa-d3d11-bindflags.md) attribute in the output stream attributes.</span></span>
2.  <span data-ttu-id="4cb60-201">Per ogni superficie nella matrice di trame, chiamare [**ID3D11VideoDevice:: CreateVideoDecoderOutputView**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview) per creare una visualizzazione di output del decodificatore video.</span><span class="sxs-lookup"><span data-stu-id="4cb60-201">For each surface in the texture array, call [**ID3D11VideoDevice::CreateVideoDecoderOutputView**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview) to create a video decoder output view.</span></span> <span data-ttu-id="4cb60-202">Durante la decodifica, queste viste di output verranno passate al metodo [**ID3D11VideoContext::D ecoderbeginframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-202">During decoding, these output views will be passed to the [**ID3D11VideoContext::DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) method.</span></span>
3.  <span data-ttu-id="4cb60-203">Per ogni superficie nella matrice di trame, creare un esempio di supporto come segue:</span><span class="sxs-lookup"><span data-stu-id="4cb60-203">For each surface in the texture array, create a media sample as follows:</span></span>
    1.  <span data-ttu-id="4cb60-204">Creare un buffer multimediale DXGI chiamando la funzione [**MFCreateDXGISurfaceBuffer**](/windows/desktop/api/mfapi/nf-mfapi-mfcreatedxgisurfacebuffer) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-204">Create a DXGI media buffer by calling the [**MFCreateDXGISurfaceBuffer**](/windows/desktop/api/mfapi/nf-mfapi-mfcreatedxgisurfacebuffer) function.</span></span> <span data-ttu-id="4cb60-205">Passare il puntatore [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) e l'offset per ogni elemento nella matrice di trame.</span><span class="sxs-lookup"><span data-stu-id="4cb60-205">Pass in the [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d) pointer and the offset for each element in the texture array.</span></span> <span data-ttu-id="4cb60-206">La funzione restituisce un puntatore [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-206">The function returns an [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) pointer.</span></span>
    2.  <span data-ttu-id="4cb60-207">Creare un esempio di supporto vuoto chiamando la funzione [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-207">Create an empty media sample by calling the [**MFCreateVideoSampleFromSurface**](/windows/desktop/api/evr/nc-evr-mfcreatevideosamplefromsurface) function.</span></span> <span data-ttu-id="4cb60-208">Impostare il parametro *pUnkSurface* su **null**.</span><span class="sxs-lookup"><span data-stu-id="4cb60-208">Set the *pUnkSurface* parameter equal to **NULL**.</span></span> <span data-ttu-id="4cb60-209">La funzione restituisce un puntatore [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-209">The function returns an [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) pointer.</span></span>
    3.  <span data-ttu-id="4cb60-210">Chiamare [**IMFSample:: AddBuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-addbuffer) per aggiungere il buffer multimediale all'esempio.</span><span class="sxs-lookup"><span data-stu-id="4cb60-210">Call [**IMFSample::AddBuffer**](/windows/desktop/api/mfobjects/nf-mfobjects-imfsample-addbuffer) to add the media buffer to the sample.</span></span>

<span data-ttu-id="4cb60-211">È necessario eliminare tutte le trame create allo stesso tempo, anziché eliminare solo alcune e continuare a usare il promemoria.</span><span class="sxs-lookup"><span data-stu-id="4cb60-211">You should destroy all the textures you create at the same time, rather then destroying only some and continuing to use the reminder.</span></span>

## <a name="decoding"></a><span data-ttu-id="4cb60-212">Decodifica</span><span class="sxs-lookup"><span data-stu-id="4cb60-212">Decoding</span></span>

<span data-ttu-id="4cb60-213">Per creare il dispositivo di decodificatore, chiamare [**ID3D11VideoDevice:: CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoder).</span><span class="sxs-lookup"><span data-stu-id="4cb60-213">To create the decoder device, call [**ID3D11VideoDevice::CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoder).</span></span> <span data-ttu-id="4cb60-214">Il metodo restituisce un puntatore all'interfaccia [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-214">The method returns a pointer to the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) interface.</span></span> <span data-ttu-id="4cb60-215">La decodifica deve essere eseguita all'interno del metodo [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-215">Decoding should occur inside the [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="4cb60-216">In ogni frame, chiamare [**IMFDXGIDeviceManager:: TestDevice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-testdevice) per verificare la disponibilità del dxgi.</span><span class="sxs-lookup"><span data-stu-id="4cb60-216">On each frame, call [**IMFDXGIDeviceManager::TestDevice**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-testdevice) to test the availability of the DXGI.</span></span> <span data-ttu-id="4cb60-217">Se il dispositivo è stato modificato, il decodificatore software deve ricreare il dispositivo di decodificatore, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="4cb60-217">If the device has changed, the software decoder must recreate the decoder device, as follows:</span></span>

1.  <span data-ttu-id="4cb60-218">Chiudere l'handle del dispositivo chiamando [**IMFDXGIDeviceManager:: CloseDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-closedevicehandle).</span><span class="sxs-lookup"><span data-stu-id="4cb60-218">Close the device handle by calling [**IMFDXGIDeviceManager::CloseDeviceHandle**](/windows/desktop/api/mfobjects/nf-mfobjects-imfdxgidevicemanager-closedevicehandle).</span></span>
2.  <span data-ttu-id="4cb60-219">Rilasciare tutte le risorse associate al dispositivo Direct3D 11 precedente, incluse le interfacce [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder), [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext), [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d)e [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-219">Release all resources associated with the previous Direct3D 11 device, including the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder), [**ID3D11VideoContext**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videocontext), [**ID3D11Texture2D**](/windows/win32/api/d3d11/nn-d3d11-id3d11texture2d), and [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) interfaces.</span></span>
3.  <span data-ttu-id="4cb60-220">Aprire un nuovo handle di dispositivo.</span><span class="sxs-lookup"><span data-stu-id="4cb60-220">Open a new device handle.</span></span>
4.  <span data-ttu-id="4cb60-221">Negoziare una nuova configurazione del decodificatore, come descritto in precedenza in [trovare una configurazione del decodificatore](#find-a-decoder-configuration).</span><span class="sxs-lookup"><span data-stu-id="4cb60-221">Negotiate a new decoder configuration, as described previously in [Find a Decoder Configuration](#find-a-decoder-configuration).</span></span> <span data-ttu-id="4cb60-222">Questo passaggio è necessario perché le funzionalità del dispositivo potrebbero essere state modificate.</span><span class="sxs-lookup"><span data-stu-id="4cb60-222">This step is necessary because the device capabilities might have changed.</span></span>
5.  <span data-ttu-id="4cb60-223">Creare un nuovo dispositivo di decodificatore.</span><span class="sxs-lookup"><span data-stu-id="4cb60-223">Create a new decoder device.</span></span>

<span data-ttu-id="4cb60-224">Supponendo che l'handle del dispositivo sia valido, il processo di decodifica funziona nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="4cb60-224">Assuming that the device handle is valid, the decoding process works as follows:</span></span>

1.  <span data-ttu-id="4cb60-225">Ottenere una superficie disponibile che non è attualmente in uso.</span><span class="sxs-lookup"><span data-stu-id="4cb60-225">Get an available surface that is not currently in use.</span></span> <span data-ttu-id="4cb60-226">Inizialmente, tutte le superfici sono disponibili.</span><span class="sxs-lookup"><span data-stu-id="4cb60-226">Initially, all of the surfaces are available.</span></span>
2.  <span data-ttu-id="4cb60-227">Eseguire una query sull'esempio multimediale per l'interfaccia [**IMFTrackedSample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-227">Query the media sample for the [**IMFTrackedSample**](/windows/win32/api/mfidl/nn-mfidl-imftrackedsample) interface.</span></span>
3.  <span data-ttu-id="4cb60-228">Chiamare [**IMFTrackedSample:: Seallocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) e fornire un puntatore all'interfaccia [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) .</span><span class="sxs-lookup"><span data-stu-id="4cb60-228">Call [**IMFTrackedSample::SetAllocator**](/windows/win32/api/mfidl/nf-mfidl-imftrackedsample-setallocator) and provide a pointer to the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface.</span></span> <span data-ttu-id="4cb60-229">Il decodificatore software deve implementare questa interfaccia. Quando il renderer video rilascia l'esempio, verrà richiamato il callback.</span><span class="sxs-lookup"><span data-stu-id="4cb60-229">(The software decoder must implement this interface.) When the video renderer releases the sample, the callback will be invoked.</span></span> <span data-ttu-id="4cb60-230">Utilizzare questo callback per tenere traccia degli esempi attualmente disponibili e in uso.</span><span class="sxs-lookup"><span data-stu-id="4cb60-230">Use this callback to keep track of which samples are currently available and which are in use.</span></span>
4.  <span data-ttu-id="4cb60-231">Chiamare [**ID3D11VideoContext::D ecoderbeginframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe).</span><span class="sxs-lookup"><span data-stu-id="4cb60-231">Call [**ID3D11VideoContext::DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe).</span></span> <span data-ttu-id="4cb60-232">Passare i puntatori all'interfaccia [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) per il dispositivo di decodificatore e l'interfaccia [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) per la visualizzazione di output.</span><span class="sxs-lookup"><span data-stu-id="4cb60-232">Pass in the pointers to the [**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder) interface for the decoder device and the [**ID3D11VideoDecoderOutputView**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoderoutputview) interface for the output view.</span></span>
5.  <span data-ttu-id="4cb60-233">Eseguire le operazioni seguenti una o più volte:</span><span class="sxs-lookup"><span data-stu-id="4cb60-233">Do the following one or more times:</span></span>
    1.  <span data-ttu-id="4cb60-234">Chiamare [**ID3D11VideoContext:: GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) per ottenere un buffer.</span><span class="sxs-lookup"><span data-stu-id="4cb60-234">Call [**ID3D11VideoContext::GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) to get a buffer.</span></span>
    2.  <span data-ttu-id="4cb60-235">Riempire il buffer.</span><span class="sxs-lookup"><span data-stu-id="4cb60-235">Fill the buffer.</span></span>
    3.  <span data-ttu-id="4cb60-236">Chiamare [**ID3D11VideoContext:: ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span><span class="sxs-lookup"><span data-stu-id="4cb60-236">Call [**ID3D11VideoContext::ReleaseDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-releasedecoderbuffer).</span></span>
    4.  <span data-ttu-id="4cb60-237">Chiamare [**ID3D11VideoContext:: SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers).</span><span class="sxs-lookup"><span data-stu-id="4cb60-237">Call [**ID3D11VideoContext::SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers).</span></span> <span data-ttu-id="4cb60-238">Questo metodo indica al dispositivo di decodificatore di eseguire le operazioni di decodifica sul frame.</span><span class="sxs-lookup"><span data-stu-id="4cb60-238">This method instructs the decoder device to perform the decoding operations on the frame.</span></span>
6.  <span data-ttu-id="4cb60-239">Chiamare [**ID3D11VideoContext::D ecoderendframe**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderendframe) per segnalare la fine della decodifica per il frame corrente.</span><span class="sxs-lookup"><span data-stu-id="4cb60-239">Call [**ID3D11VideoContext::DecoderEndFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderendframe) to signal the end of decoding for the current frame.</span></span>

<span data-ttu-id="4cb60-240">Direct3D 11 usa le stesse strutture di dati di DXVA 2,0 per le operazioni di decodifica.</span><span class="sxs-lookup"><span data-stu-id="4cb60-240">Direct3D 11 uses the same data structures as DXVA 2.0 for decoding operations.</span></span> <span data-ttu-id="4cb60-241">Per il set originale di profili DXVA (per H. 261, H. 263 e MPEG-2), queste strutture di dati sono descritte nella [specifica DXVA 1,0](/windows-hardware/drivers/display/directx-video-acceleration).</span><span class="sxs-lookup"><span data-stu-id="4cb60-241">For the original set of DXVA profiles (for H.261, H.263, and MPEG-2), these data structures are described in the [DXVA 1.0 specification](/windows-hardware/drivers/display/directx-video-acceleration).</span></span>

<span data-ttu-id="4cb60-242">All'interno di ogni coppia di chiamate [**DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) e [**SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers) , è possibile chiamare [**GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) più volte, ma solo una volta per ogni tipo di buffer.</span><span class="sxs-lookup"><span data-stu-id="4cb60-242">Within each pair of [**DecoderBeginFrame**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-decoderbeginframe) and [**SubmitDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-submitdecoderbuffers) calls, you may call [**GetDecoderBuffer**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-getdecoderbuffer) multiple times, but only once for each type of buffer.</span></span> <span data-ttu-id="4cb60-243">Se si usa lo stesso tipo di buffer due volte senza chiamare **SubmitDecoderBuffer**, i dati nel buffer vengono sovrascritti.</span><span class="sxs-lookup"><span data-stu-id="4cb60-243">If you use the same buffer type twice without calling **SubmitDecoderBuffer**, you will overwrite the data in the buffer.</span></span>

## <a name="related-topics"></a><span data-ttu-id="4cb60-244">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="4cb60-244">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="4cb60-245">API video Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="4cb60-245">Direct3D 11 Video APIs</span></span>](direct3d-11-video-apis.md)
</dt> <dt>

[<span data-ttu-id="4cb60-246">Accelerazione video DirectX 2,0</span><span class="sxs-lookup"><span data-stu-id="4cb60-246">DirectX Video Acceleration 2.0</span></span>](directx-video-acceleration-2-0.md)
</dt> </dl>

 

 
