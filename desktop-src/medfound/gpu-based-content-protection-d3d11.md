---
description: In questo argomento viene descritto il contenuto video&\# 8211; funzionalità di protezione che possono essere fornite da un driver di grafica.
ms.assetid: 3FDB4908-C75D-4AE0-B32E-93F840E4F30A
title: GPU-Based protezione del contenuto con D3D11 video
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 78097492d375d50688f2472f5d2de99cc21f8594
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104049302"
---
# <a name="gpu-based-content-protection-with-d3d11-video"></a><span data-ttu-id="fb4e0-103">GPU-Based protezione del contenuto con D3D11 video</span><span class="sxs-lookup"><span data-stu-id="fb4e0-103">GPU-Based Content Protection with D3D11 Video</span></span>

<span data-ttu-id="fb4e0-104">Questo argomento descrive il contenuto video, ovvero le funzionalità di protezione che possono essere fornite da un driver di grafica.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-104">This topic describes video content–protection capabilities that a graphics driver can provide.</span></span>

-   [<span data-ttu-id="fb4e0-105">Introduzione</span><span class="sxs-lookup"><span data-stu-id="fb4e0-105">Introduction</span></span>](#introduction)
-   [<span data-ttu-id="fb4e0-106">Panoramica del processo di decodifica</span><span class="sxs-lookup"><span data-stu-id="fb4e0-106">Overview of the Decoding Process</span></span>](#overview-of-the-decoding-process)
-   [<span data-ttu-id="fb4e0-107">Crittografia dei buffer video compressi per il decodificatore</span><span class="sxs-lookup"><span data-stu-id="fb4e0-107">Encrypting Compressed Video Buffers for the Decoder</span></span>](#encrypting-compressed-video-buffers-for-the-decoder)
    -   [<span data-ttu-id="fb4e0-108">1. eseguire una query sulle funzionalità di protezione del contenuto del driver</span><span class="sxs-lookup"><span data-stu-id="fb4e0-108">1. Query the Content Protection Capabilities of the Driver</span></span>](#1-query-the-content-protection-capabilities-of-the-driver)
    -   [<span data-ttu-id="fb4e0-109">2. configurare il canale autenticato</span><span class="sxs-lookup"><span data-stu-id="fb4e0-109">2. Configure the Authenticated Channel</span></span>](#2-configure-the-authenticated-channel)
    -   [<span data-ttu-id="fb4e0-110">3. configurare la sessione di crittografia</span><span class="sxs-lookup"><span data-stu-id="fb4e0-110">3. Configure the Cryptographic Session</span></span>](#3-configure-the-cryptographic-session)
    -   [<span data-ttu-id="fb4e0-111">4. associare il decodificatore alla sessione di crittografia</span><span class="sxs-lookup"><span data-stu-id="fb4e0-111">4. Associate the decoder with the Cryptographic Session</span></span>](#4-associate-the-decoder-with-the-cryptographic-session)
-   [<span data-ttu-id="fb4e0-112">Invio di comandi del canale autenticato</span><span class="sxs-lookup"><span data-stu-id="fb4e0-112">Sending Authenticated Channel Commands</span></span>](#sending-authenticated-channel-commands)
-   [<span data-ttu-id="fb4e0-113">Invio di query sul canale autenticato</span><span class="sxs-lookup"><span data-stu-id="fb4e0-113">Sending Authenticated Channel Queries</span></span>](#sending-authenticated-channel-queries)
-   [<span data-ttu-id="fb4e0-114">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="fb4e0-114">Related topics</span></span>](#related-topics)

## <a name="introduction"></a><span data-ttu-id="fb4e0-115">Introduzione</span><span class="sxs-lookup"><span data-stu-id="fb4e0-115">Introduction</span></span>

<span data-ttu-id="fb4e0-116">Il diagramma seguente mostra una visualizzazione semplificata del modo in cui il contenuto video protetto passa attraverso la pipeline per il rendering.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-116">The following diagram shows a simplified view of how protected video content travels through the pipeline to be rendered.</span></span>

![diagramma che mostra il contenuto video protetto.](images/d3d9video01.png)

> [!Note]
>
> <span data-ttu-id="fb4e0-118">Il [percorso multimediale protetto](protected-media-path.md) (PMP) non è illustrato in questo diagramma.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-118">The [Protected Media Path](protected-media-path.md) (PMP) is not depicted in this diagram.</span></span> <span data-ttu-id="fb4e0-119">Il flusso di dati visualizzato qui potrebbe verificarsi in un processo PMP o all'interno di un processo dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-119">The data flow that is shown here might occur within a PMP process, or within an application process.</span></span>

 

<span data-ttu-id="fb4e0-120">Il decodificatore riceve dati video crittografati e compressi da un'origine esterna.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-120">The decoder receives encrypted, compressed video data from an external source.</span></span> <span data-ttu-id="fb4e0-121">Si presuppone inoltre che il decodificatore riceva anche una chiave crittografica per decrittografare i dati.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-121">It is assumed also the decoder also receives a cryptographic key to decrypt this data.</span></span> <span data-ttu-id="fb4e0-122">Questo argomento non descrive lo scambio di chiave tra l'origine video e il decodificatore, ma il PMP definisce un possibile meccanismo.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-122">This topic does not describe the key exchange between the video source and decoder, but the PMP defines one possible mechanism.</span></span> <span data-ttu-id="fb4e0-123">La GPU non è in questa fase.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-123">The GPU is not involved at this stage.</span></span>

<span data-ttu-id="fb4e0-124">Per la decodifica con accelerazione hardware, il decodificatore software passa il contenuto video compresso alla GPU.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-124">For hardware-accelerated decoding, the software decoder passes compressed video content to the GPU.</span></span> <span data-ttu-id="fb4e0-125">Per proteggere questo contenuto, il decodificatore esegue nuovamente la crittografia dei dati, in genere usando AES-CTR, prima di passarli all'acceleratore hardware.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-125">To protect this content, the decoder re-encrypts the data, typically using AES-CTR, before passing it to the hardware accelerator.</span></span> <span data-ttu-id="fb4e0-126">Viene definito un meccanismo di scambio delle chiavi tra il decodificatore e il driver di grafica.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-126">A key-exchange mechanism is defined between the decoder and the graphics driver.</span></span>

<span data-ttu-id="fb4e0-127">I fotogrammi video decodificati vengono archiviati nella memoria video, generalmente in chiaro.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-127">Decoded video frames are stored in video memory, generally in the clear.</span></span> <span data-ttu-id="fb4e0-128">A questo punto, i frame vengono elaborati e quindi presentati.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-128">At this point, the frames are processed and then presented.</span></span> <span data-ttu-id="fb4e0-129">Sono disponibili due opzioni principali per la presentazione.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-129">There are two main options for presentation.</span></span>

-   <span data-ttu-id="fb4e0-130">Quando si usa l'API D3D9, i frame possono essere presentati usando una sovrapposizione hardware.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-130">When using the D3D9 API, frames can be presented using a hardware overlay.</span></span> <span data-ttu-id="fb4e0-131">Hardware eccessivamente non è supportato in D3D11.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-131">Hardware overly is not supported in D3D11.</span></span> <span data-ttu-id="fb4e0-132">Per ulteriori informazioni, vedere [supporto della sovrimpressione hardware](hardware-overlay-support.md).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-132">For more information, see [Hardware Overlay Support](hardware-overlay-support.md).</span></span>
-   <span data-ttu-id="fb4e0-133">I frame possono essere presentati dalla finestra desktop Manage (DWM) utilizzando una superficie condivisa.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-133">Frames can be presented by the Desktop Window Manage (DWM) using a shared surface.</span></span>

<span data-ttu-id="fb4e0-134">L'ultimo passaggio consiste nel visualizzare il frame sul monitor, che può richiedere la protezione dei collegamenti tra la scheda grafica e il dispositivo di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-134">The last step is to display the frame on the monitor, which may require link protection between the graphics card and the display device.</span></span> <span data-ttu-id="fb4e0-135">Un esempio di protezione dei collegamenti è High-Bandwidth protezione del contenuto digitale (HDCP).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-135">An example of link protection is High-Bandwidth Digital Content Protection (HDCP).</span></span> <span data-ttu-id="fb4e0-136">La protezione del collegamento viene configurata tramite [Output Protection Manager](output-protection-manager.md) (OPM).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-136">Link protection is configured using [Output Protection Manager](output-protection-manager.md) (OPM).</span></span> <span data-ttu-id="fb4e0-137">Questo argomento non descrive l'OPM; Per ulteriori informazioni, vedere [utilizzo di output Protection Manager](using-output-protection-manager.md).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-137">This topic does not describe OPM; for more information, see [Using Output Protection Manager](using-output-protection-manager.md).</span></span>

## <a name="overview-of-the-decoding-process"></a><span data-ttu-id="fb4e0-138">Panoramica del processo di decodifica</span><span class="sxs-lookup"><span data-stu-id="fb4e0-138">Overview of the Decoding Process</span></span>

<span data-ttu-id="fb4e0-139">Durante la decodifica con accelerazione hardware, il decodificatore software deve passare dati video compressi alla scheda grafica.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-139">During hardware-accelerated decoding, the software decoder must pass compressed video data to the graphics card.</span></span> <span data-ttu-id="fb4e0-140">Per il contenuto premium, questi dati in genere devono essere crittografati, usando la crittografia a chiave simmetrica, prima che vengano inviati alla GPU.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-140">For premium content, this data typically must be encrypted, using symmetric-key encryption, before it is sent to the GPU.</span></span>

<span data-ttu-id="fb4e0-141">Per crittografare il video per la decodifica, il decodificatore software usa le interfacce seguenti:</span><span class="sxs-lookup"><span data-stu-id="fb4e0-141">To encrypt the video for decoding, the software decoder uses the following interfaces:</span></span>

-   <span data-ttu-id="fb4e0-142">[**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-142">[**ID3D11VideoDecoder**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder).</span></span> <span data-ttu-id="fb4e0-143">Rappresenta il dispositivo decodificatore, denominato anche acceleratore.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-143">Represents the decoder device, also called the accelerator.</span></span>
-   <span data-ttu-id="fb4e0-144">[**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-144">[**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession).</span></span> <span data-ttu-id="fb4e0-145">Rappresenta una sessione di crittografia che fornisce la chiave di crittografia.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-145">Represents a cryptographic session, which provides the encryption key.</span></span>
-   <span data-ttu-id="fb4e0-146">[**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-146">[**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel).</span></span> <span data-ttu-id="fb4e0-147">Rappresenta un canale autenticato, che consente al decodificatore software di associare la sessione di crittografia al decodificatore.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-147">Represents an authenticated channel, which enables the software decoder to associate the cryptographic session with the decoder.</span></span>

![diagramma che mostra le interfacce di decodifica Direct3D9.](images/d3d9video02.png)

<span data-ttu-id="fb4e0-149">Tutte queste interfacce vengono ottenute dal dispositivo Direct3D11, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="fb4e0-149">All of these interfaces are obtained from the Direct3D11 device, as follows:</span></span>



| <span data-ttu-id="fb4e0-150">Interfaccia</span><span class="sxs-lookup"><span data-stu-id="fb4e0-150">Interface</span></span>                                                        | <span data-ttu-id="fb4e0-151">Creazione</span><span class="sxs-lookup"><span data-stu-id="fb4e0-151">Creation</span></span>                                                                                                                                                |
|------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="fb4e0-152">**ID3D11VideoDecoder**</span><span class="sxs-lookup"><span data-stu-id="fb4e0-152">**ID3D11VideoDecoder**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodecoder)                 | <span data-ttu-id="fb4e0-153">Chiamare [**ID3D11VideoDevice:: CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-153">Call [**ID3D11VideoDevice::CreateVideoDecoder**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createvideodecoderoutputview).</span></span> <span data-ttu-id="fb4e0-154">Il tipo di decodificatore è identificato da un GUID del profilo.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-154">The decoder type is identified by a profile GUID.</span></span> |
| [<span data-ttu-id="fb4e0-155">**ID3D11CryptoSession**</span><span class="sxs-lookup"><span data-stu-id="fb4e0-155">**ID3D11CryptoSession**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession)               | <span data-ttu-id="fb4e0-156">Chiamare [**ID3D11VideoDevice:: CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-156">Call [**ID3D11VideoDevice::CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession).</span></span>                                                           |
| [<span data-ttu-id="fb4e0-157">**ID3D11AuthenticatedChannel**</span><span class="sxs-lookup"><span data-stu-id="fb4e0-157">**ID3D11AuthenticatedChannel**</span></span>](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) | <span data-ttu-id="fb4e0-158">Chiamare [**ID3D11VideoDevice:: CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-158">Call [**ID3D11VideoDevice::CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel).</span></span>                                             |



 

> [!Note]  
> <span data-ttu-id="fb4e0-159">Per ottenere un puntatore all'interfaccia [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) , chiamare [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) sull'interfaccia [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-159">To get a pointer to the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface, call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) on [**ID3D11Device**](/windows/win32/api/d3d11/nn-d3d11-id3d11device) interface.</span></span>

 

<span data-ttu-id="fb4e0-160">Il canale autenticato fornisce un canale di comunicazione attendibile tra il decodificatore software e il driver.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-160">The authenticated channel provides a trusted communication channel between the software decoder and the driver.</span></span> <span data-ttu-id="fb4e0-161">Il canale di comunicazione funziona nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="fb4e0-161">The communication channel works as follows:</span></span>

-   <span data-ttu-id="fb4e0-162">Il driver fornisce una catena di certificati X. 509 il cui certificato radice è firmato da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-162">The driver provides an X.509 certificate chain whose root certificate is signed by Microsoft.</span></span>
-   <span data-ttu-id="fb4e0-163">Il certificato contiene una chiave pubblica RSA per il driver.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-163">The certificate contains an RSA public key for the driver.</span></span>
-   <span data-ttu-id="fb4e0-164">Il decodificatore software usa la chiave pubblica per inviare al driver una chiave di sessione AES a 128 bit.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-164">The software decoder uses the public key to send the driver a 128-bit AES session key.</span></span>
-   <span data-ttu-id="fb4e0-165">Il decodificatore software invia le query e i comandi al canale autenticato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-165">The software decoder sends queries and commands to the authenticated channel.</span></span>
-   <span data-ttu-id="fb4e0-166">La chiave di sessione viene usata per calcolare i codici Mac (Message Authentication Code) per le query e i comandi.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-166">The session key is used to compute message authentication codes (MACs) for the queries and commands.</span></span> <span data-ttu-id="fb4e0-167">Il driver usa i computer Mac per verificare l'integrità dei dati di query/comando e il decodificatore software li usa per verificare l'integrità dei dati di risposta dal driver.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-167">The driver uses the MACs to verify the integrity of the query/command data, and the software decoder uses them to verify the integrity of the response data from the driver.</span></span>

## <a name="encrypting-compressed-video-buffers-for-the-decoder"></a><span data-ttu-id="fb4e0-168">Crittografia dei buffer video compressi per il decodificatore</span><span class="sxs-lookup"><span data-stu-id="fb4e0-168">Encrypting Compressed Video Buffers for the Decoder</span></span>

<span data-ttu-id="fb4e0-169">Ecco una panoramica di alto livello del processo di crittografia e decodifica:</span><span class="sxs-lookup"><span data-stu-id="fb4e0-169">Here is a high-level overview of the encryption and decoding process:</span></span>

1.  <span data-ttu-id="fb4e0-170">Il decodificatore software riceve un flusso di dati crittografati dall'origine video.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-170">The software decoder receives a stream of encrypted data from the video source.</span></span> <span data-ttu-id="fb4e0-171">Il decodificatore decrittografa il flusso.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-171">The decoder decrypts this stream.</span></span>
2.  <span data-ttu-id="fb4e0-172">Il decodificatore software negozia una chiave di sessione con la sessione di crittografia.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-172">The software decoder negotiates a session key with the cryptographic session.</span></span>
3.  <span data-ttu-id="fb4e0-173">Il decodificatore software usa il canale autenticato per associare la sessione di crittografia al dispositivo di decodificatore.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-173">The software decoder uses the authenticated channel to associate the cryptographic session with the decoder device.</span></span>
4.  <span data-ttu-id="fb4e0-174">Il decodificatore software inserisce i dati compressi nei buffer ottenuti dal dispositivo di decodificatore (Accelerator).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-174">The software decoder puts compressed data in buffers that it gets from the decoder device (accelerator).</span></span> <span data-ttu-id="fb4e0-175">Per il contenuto protetto, il codificatore software crittografa i dati inseriti nei buffer, usando la chiave di sessione per la crittografia.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-175">For protected content, the software encoder encrypts the data that is puts into the buffers, using the session key for the encryption.</span></span>
    > [!Note]  
    > <span data-ttu-id="fb4e0-176">Alcuni driver usano una chiave simmetrica invece della chiave della sessione per la crittografia.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-176">Some drivers use a content key, instead of the session key, for encryption.</span></span> <span data-ttu-id="fb4e0-177">La chiave simmetrica può variare da un fotogramma a quello successivo.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-177">The content key could change from one frame to the next.</span></span>

     

5.  <span data-ttu-id="fb4e0-178">Il decodificatore invia i buffer compressi crittografati al tasto di scelta rapida.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-178">The decoder submits the encrypted compressed buffers to the accelerator.</span></span> <span data-ttu-id="fb4e0-179">Per AES-CTR, il decodificatore passa anche il vettore di inizializzazione.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-179">For AES-CTR, the decoder also passes the initialization vector.</span></span> <span data-ttu-id="fb4e0-180">Se viene usata una chiave simmetrica, il decodificatore passa la chiave simmetrica, crittografata usando la chiave della sessione.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-180">If a content key is used, the decoder passes the content key, encrypted using the session key.</span></span>

<span data-ttu-id="fb4e0-181">Direct3D11 dispone del supporto standard per AES-CTR a 128 bit, ma è progettato per essere esteso ai tipi di crittografia aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-181">Direct3D11 has standard support for 128-bit AES-CTR, but is designed to extend to additional encryption types.</span></span>

<span data-ttu-id="fb4e0-182">Le cinque sezioni successive forniscono passaggi più dettagliati.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-182">The next five sections give more detailed steps.</span></span>

-   [<span data-ttu-id="fb4e0-183">1. eseguire una query sulle funzionalità di protezione del contenuto del driver</span><span class="sxs-lookup"><span data-stu-id="fb4e0-183">1. Query the Content Protection Capabilities of the Driver</span></span>](#1-query-the-content-protection-capabilities-of-the-driver)
-   [<span data-ttu-id="fb4e0-184">2. configurare il canale autenticato</span><span class="sxs-lookup"><span data-stu-id="fb4e0-184">2. Configure the Authenticated Channel</span></span>](#2-configure-the-authenticated-channel)
-   [<span data-ttu-id="fb4e0-185">3. configurare la sessione di crittografia</span><span class="sxs-lookup"><span data-stu-id="fb4e0-185">3. Configure the Cryptographic Session</span></span>](#3-configure-the-cryptographic-session)
-   [<span data-ttu-id="fb4e0-186">4. associare il decodificatore alla sessione di crittografia</span><span class="sxs-lookup"><span data-stu-id="fb4e0-186">4. Associate the decoder with the Cryptographic Session</span></span>](#4-associate-the-decoder-with-the-cryptographic-session)

### <a name="1-query-the-content-protection-capabilities-of-the-driver"></a><span data-ttu-id="fb4e0-187">1. eseguire una query sulle funzionalità di protezione del contenuto del driver</span><span class="sxs-lookup"><span data-stu-id="fb4e0-187">1. Query the Content Protection Capabilities of the Driver</span></span>

<span data-ttu-id="fb4e0-188">Prima di provare ad applicare la crittografia, ottenere le funzionalità di protezione del contenuto del driver.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-188">Before attempting to apply encryption, get the content protection capabilities of the driver.</span></span>

1.  <span data-ttu-id="fb4e0-189">Ottenere un puntatore all'interfaccia ID3D11Device.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-189">Get a pointer to the ID3D11Device interface.</span></span>
2.  <span data-ttu-id="fb4e0-190">Chiamare [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) per l'interfaccia [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-190">Call [**QueryInterface**](/windows/win32/api/unknwn/nf-unknwn-iunknown-queryinterface(q)) for the [**ID3D11VideoDevice**](/windows/desktop/api/d3d11/nn-d3d11-id3d11videodevice) interface.</span></span>
3.  <span data-ttu-id="fb4e0-191">Chiamare [**ID3D11VideoDevice:: GetContentProtectionCaps**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getcontentprotectioncaps).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-191">Call [**ID3D11VideoDevice::GetContentProtectionCaps**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-getcontentprotectioncaps).</span></span> <span data-ttu-id="fb4e0-192">Questo metodo compila una struttura di [**D3D11_VIDEO_CONTENT_PROTECTION_CAPS**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_content_protection_caps) con le funzionalità di protezione del contenuto del driver.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-192">This method fills in a [**D3D11_VIDEO_CONTENT_PROTECTION_CAPS**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_content_protection_caps) structure with the driver’s content protection capabilities.</span></span>

<span data-ttu-id="fb4e0-193">In particolare, cercare le funzionalità seguenti:</span><span class="sxs-lookup"><span data-stu-id="fb4e0-193">In particular, look for the following capabilities:</span></span>

-   <span data-ttu-id="fb4e0-194">Se il membro **Caps** contiene il flag **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE** o **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE** , il driver può eseguire la crittografia.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-194">If the **Caps** member contains the **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE** or **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE** flag, the driver can perform encryption.</span></span>
-   <span data-ttu-id="fb4e0-195">Se il membro **Caps** contiene il flag di **D3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY** , il driver utilizza una chiave simmetrica separata per la decrittografia.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-195">If the **Caps** member contains the **D3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY** flag, the driver uses a separate content key for decryption.</span></span>
-   <span data-ttu-id="fb4e0-196">Chiamare [**ID3D11VideoDevice:: CheckCryptoKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkcryptokeyexchange) per determinare i tipi di scambio di chiave supportati dal driver per la generazione della chiave di sessione.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-196">Call [**ID3D11VideoDevice::CheckCryptoKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-checkcryptokeyexchange) to determine which types of key exchanges the driver supports for generating the session key.</span></span>

<span data-ttu-id="fb4e0-197">Nel membro **Caps** sono indicate funzionalità aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-197">Additional capabilities are indicated in the **Caps** member.</span></span>

### <a name="2-configure-the-authenticated-channel"></a><span data-ttu-id="fb4e0-198">2. configurare il canale autenticato</span><span class="sxs-lookup"><span data-stu-id="fb4e0-198">2. Configure the Authenticated Channel</span></span>

<span data-ttu-id="fb4e0-199">Il passaggio successivo consiste nel configurare il canale autenticato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-199">The next step is to configure the authenticated channel.</span></span>

1.  <span data-ttu-id="fb4e0-200">Chiamare [**ID3D11VideoDevice:: CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel) per creare il canale autenticato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-200">Call [**ID3D11VideoDevice::CreateAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createauthenticatedchannel) to create the authenticated channel.</span></span> <span data-ttu-id="fb4e0-201">Per il parametro *ChannelType* , specificare un tipo di canale corrispondente alle funzionalità del driver.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-201">For the *ChannelType* parameter, specify a channel type that matches the capabilities of the driver.</span></span>
    -   <span data-ttu-id="fb4e0-202">Il tipo di canale **D3D11_AUTHENTICATED_CHANNEL_DRIVER_SOFTWARE** corrisponde a **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE**.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-202">The **D3D11_AUTHENTICATED_CHANNEL_DRIVER_SOFTWARE** channel type corresponds to **D3D11_CONTENT_PROTECTION_CAPS_SOFTWARE**.</span></span>
    -   <span data-ttu-id="fb4e0-203">Il tipo di canale **D3D11_AUTHENTICATED_CHANNEL_DRIVER_HARDWARE** corrisponde a **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE**.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-203">The **D3D11_AUTHENTICATED_CHANNEL_DRIVER_HARDWARE** channel type corresponds to **D3D11_CONTENT_PROTECTION_CAPS_HARDWARE**.</span></span>

    <span data-ttu-id="fb4e0-204">Il metodo **CreateAuthenticatedChannel** restituisce un puntatore all'interfaccia [**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-204">The **CreateAuthenticatedChannel** method returns a pointer to the [**ID3D11AuthenticatedChannel**](/windows/desktop/api/d3d11/nn-d3d11-id3d11authenticatedchannel) interface.</span></span>
2.  <span data-ttu-id="fb4e0-205">Chiamare [**ID3D11AuthenticatedChannel:: GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificatesize) per ottenere le dimensioni del certificato X. 509 del driver.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-205">Call [**ID3D11AuthenticatedChannel::GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificatesize) to get the size of the driver's X.509 certificate.</span></span> <span data-ttu-id="fb4e0-206">Allocare un buffer della dimensione richiesta.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-206">Allocate a buffer of the required size.</span></span>
3.  <span data-ttu-id="fb4e0-207">Chiamare [**ID3D11AuthenticatedChannel:: GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificate) per ottenere il certificato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-207">Call [**ID3D11AuthenticatedChannel::GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11authenticatedchannel-getcertificate) to get the certificate.</span></span> <span data-ttu-id="fb4e0-208">Il metodo copia il certificato nel buffer allocato nel passaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-208">The method copies the certificate into the buffer that was allocated in the previous step.</span></span>
4.  <span data-ttu-id="fb4e0-209">Verificare che il certificato del driver sia stato firmato da Microsoft e non sia stato revocato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-209">Verify that the driver’s certificate was signed by Microsoft and has not been revoked.</span></span>
5.  <span data-ttu-id="fb4e0-210">Ottenere la chiave pubblica dal certificato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-210">Get the public key from the certificate.</span></span>
6.  <span data-ttu-id="fb4e0-211">Genera una chiave di sessione RSA casuale.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-211">Generate a random RSA session key.</span></span> <span data-ttu-id="fb4e0-212">Questa chiave di sessione viene utilizzata per firmare i dati inviati al canale autenticato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-212">This session key is used to sign data that is sent to the authenticated channel.</span></span> <span data-ttu-id="fb4e0-213">Crittografare la chiave della sessione utilizzando la chiave pubblica del driver.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-213">Encrypt the session key using the driver's public key.</span></span>
7.  <span data-ttu-id="fb4e0-214">Chiamare [**ID3D11VideoContext:: NegotiateAuthenticatedChannelKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiateauthenticatedchannelkeyexchange) per inviare la chiave della sessione crittografata al driver.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-214">Call [**ID3D11VideoContext::NegotiateAuthenticatedChannelKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiateauthenticatedchannelkeyexchange) to send the encrypted session key to the driver.</span></span>
8.  <span data-ttu-id="fb4e0-215">Inizializzare il canale sicuro come segue:</span><span class="sxs-lookup"><span data-stu-id="fb4e0-215">Initialize the secure channel as follows:</span></span>
    1.  <span data-ttu-id="fb4e0-216">Compilare una struttura [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) come descritto nella documentazione.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-216">Fill in a [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) structure as described in the documentation.</span></span>
    2.  <span data-ttu-id="fb4e0-217">Inviare il comando [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) chiamando [**ID3D11VideoContext:: ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) come descritto nella sezione invio dei [comandi del canale autenticato](#sending-authenticated-channel-commands).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-217">Send the [**D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input) command by calling [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) as described in the section [Sending Authenticated Channel Commands](#sending-authenticated-channel-commands).</span></span> <span data-ttu-id="fb4e0-218">Questo comando contiene i numeri di sequenza iniziali per i comandi e le query inviati al canale autenticato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-218">This command contains the starting sequence numbers for the commands and queries that are sent to the authenticated channel.</span></span>
9.  <span data-ttu-id="fb4e0-219">Verificare il tipo di canale inviando una query [**D3D11_AUTHENTICATED_QUERY_CHANNEL_TYPE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_channel_type_output) al canale autenticato, come descritto nella sezione [invio di query sul canale autenticato](#sending-authenticated-channel-queries).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-219">Verify the channel type by sending a [**D3D11_AUTHENTICATED_QUERY_CHANNEL_TYPE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_channel_type_output) query to the authenticated channel, as described in the section [Sending Authenticated Channel Queries](#sending-authenticated-channel-queries).</span></span> <span data-ttu-id="fb4e0-220">Verificare che il tipo di canale corrisponda a quanto specificato nel metodo [**CreateAuthenticatedChannel**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9video-createauthenticatedchannel) .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-220">Check that the channel type matches what you specified in the [**CreateAuthenticatedChannel**](/windows/desktop/api/d3d9/nf-d3d9-idirect3ddevice9video-createauthenticatedchannel) method.</span></span>

### <a name="3-configure-the-cryptographic-session"></a><span data-ttu-id="fb4e0-221">3. configurare la sessione di crittografia</span><span class="sxs-lookup"><span data-stu-id="fb4e0-221">3. Configure the Cryptographic Session</span></span>

<span data-ttu-id="fb4e0-222">Configurare quindi la sessione di crittografia e stabilire la chiave della sessione.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-222">Next, configure the cryptographic session and establish the session key.</span></span>

1.  <span data-ttu-id="fb4e0-223">Chiamare [**ID3D11VideoDevice:: CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession) per creare la sessione di crittografia.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-223">Call [**ID3D11VideoDevice::CreateCryptoSession**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodevice-createcryptosession) to create the cryptographic session.</span></span> <span data-ttu-id="fb4e0-224">Questo metodo restituisce un puntatore all'interfaccia [**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession) .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-224">This method returns a pointer to the [**ID3D11CryptoSession**](/windows/desktop/api/d3d11/nn-d3d11-id3d11cryptosession) interface.</span></span>
2.  <span data-ttu-id="fb4e0-225">Chiamare [**ID3D11CryptoSession:: GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificatesize) per ottenere le dimensioni del certificato X. 509 del driver.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-225">Call [**ID3D11CryptoSession::GetCertificateSize**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificatesize) to get the size of the driver's X.509 certificate.</span></span> <span data-ttu-id="fb4e0-226">Allocare un buffer della dimensione richiesta.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-226">Allocate a buffer of the required size.</span></span>
3.  <span data-ttu-id="fb4e0-227">Chiamare [**ID3D11CryptoSession:: GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificate) per ottenere il certificato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-227">Call [**ID3D11CryptoSession::GetCertificate**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcertificate) to get the certificate.</span></span> <span data-ttu-id="fb4e0-228">Il metodo copia il certificato nel buffer allocato nel passaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-228">The method copies the certificate into the buffer that was allocated in the previous step.</span></span>
4.  <span data-ttu-id="fb4e0-229">Verificare che il certificato del driver sia stato firmato da Microsoft e non sia stato revocato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-229">Verify that the driver’s certificate was signed by Microsoft and has not been revoked.</span></span>
5.  <span data-ttu-id="fb4e0-230">Ottenere la chiave pubblica dal certificato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-230">Get the public key from the certificate.</span></span>
6.  <span data-ttu-id="fb4e0-231">Genera una chiave di sessione RSA casuale.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-231">Generate a random RSA session key.</span></span> <span data-ttu-id="fb4e0-232">Si tratta di una chiave di sessione separata dalla chiave di sessione del canale autenticato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-232">This is a separate session key from the authenticated channel session key.</span></span> <span data-ttu-id="fb4e0-233">Crittografare la chiave della sessione utilizzando la chiave pubblica del driver.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-233">Encrypt the session key using the driver's public key.</span></span>
7.  <span data-ttu-id="fb4e0-234">Chiamare [**ID3D11VideoContext:: NegotiateCryptoSessionKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiatecryptosessionkeyexchange) per inviare la chiave della sessione crittografata al driver.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-234">Call [**ID3D11VideoContext::NegotiateCryptoSessionKeyExchange**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-negotiatecryptosessionkeyexchange) to send the encrypted session key to the driver.</span></span>
8.  <span data-ttu-id="fb4e0-235">Se le funzionalità di protezione del contenuto includono **3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY**, creare una chiave simmetrica casuale di RSA.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-235">If the content protection capabilities include **3D11_CONTENT_PROTECTION_CAPS_CONTENT_KEY**, create a random RSA content key.</span></span> <span data-ttu-id="fb4e0-236">Questa operazione verrà utilizzata in un secondo momento nel processo di decodifica.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-236">This will be used later in the decoding process.</span></span>

### <a name="4-associate-the-decoder-with-the-cryptographic-session"></a><span data-ttu-id="fb4e0-237">4. associare il decodificatore alla sessione di crittografia</span><span class="sxs-lookup"><span data-stu-id="fb4e0-237">4. Associate the decoder with the Cryptographic Session</span></span>

<span data-ttu-id="fb4e0-238">Associare quindi il dispositivo decoder al dispositivo Direct3D11 e alla sessione di crittografia, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="fb4e0-238">Next, associate the decoder device with the Direct3D11 device and the cryptographic session, as follows:</span></span>

1.  <span data-ttu-id="fb4e0-239">Ottenere un handle per il dispositivo Direct3D11 inviando una query di [**D3D11_AUTHENTICATED_QUERY_DEVICE_HANDLE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_device_handle_output) al canale autenticato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-239">Get a handle to the Direct3D11 device, by sending a [**D3D11_AUTHENTICATED_QUERY_DEVICE_HANDLE**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_device_handle_output) query to the authenticated channel.</span></span>
2.  <span data-ttu-id="fb4e0-240">Compilare una struttura [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) con le seguenti informazioni:</span><span class="sxs-lookup"><span data-stu-id="fb4e0-240">Fill in a [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) structure with the following information:</span></span>
    -   <span data-ttu-id="fb4e0-241">Impostare il membro **DecodeHandle** sull'handle restituito da [**ID3D11VideoDecoder:: GetDriverHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodecoder-getdriverhandle).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-241">Set the **DecodeHandle** member to the handle returned from [**ID3D11VideoDecoder::GetDriverHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videodecoder-getdriverhandle).</span></span>
    -   <span data-ttu-id="fb4e0-242">Impostare il membro **CryptoSessionHandle** sull'handle restituito da [**ID3D11CryptoSession:: GetCryptoSessionHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcryptosessionhandle).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-242">Set the **CryptoSessionHandle** member to the handle returned from [**ID3D11CryptoSession::GetCryptoSessionHandle**](/windows/desktop/api/d3d11/nf-d3d11-id3d11cryptosession-getcryptosessionhandle).</span></span>
    -   <span data-ttu-id="fb4e0-243">Impostare il membro **DeviceHandle** sull'handle del dispositivo Direct3D11.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-243">Set the **DeviceHandle** member to the Direct3D11 device handle.</span></span>
3.  <span data-ttu-id="fb4e0-244">Chiamare [**ID3D11VideoContext:: ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) per inviare un comando [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) al canale autenticato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-244">Call [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel) to send a [**D3D11_AUTHENTICATED_CONFIGURE_CRYPTO_SESSION**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_crypto_session_input) command to the authenticated channel.</span></span>

<span data-ttu-id="fb4e0-245">Il diagramma seguente illustra lo scambio di handle:</span><span class="sxs-lookup"><span data-stu-id="fb4e0-245">The following diagram illustrates the exchange of handles:</span></span>

![diagramma che Mostra come il decodificatore DXVA è associato alla sessione di crittografia.](images/d3d9video03.png)

<span data-ttu-id="fb4e0-247">Il decodificatore software ora può usare la chiave della sessione di crittografia per crittografare i buffer video compressi.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-247">The software decoder can now use the cryptographic session key to encrypt the compressed video buffers.</span></span> <span data-ttu-id="fb4e0-248">Ogni buffer compresso avrà il proprio vettore di inizializzazione (IV) specificato nel membro **pIV** della struttura [**D3D11_VIDEO_DECODER_BUFFER_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_buffer_desc) .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-248">Each compressed buffer will have its own initialization vector (IV) specified in the **pIV** member of the [**D3D11_VIDEO_DECODER_BUFFER_DESC**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_video_decoder_buffer_desc) structure.</span></span>

## <a name="sending-authenticated-channel-commands"></a><span data-ttu-id="fb4e0-249">Invio di comandi del canale autenticato</span><span class="sxs-lookup"><span data-stu-id="fb4e0-249">Sending Authenticated Channel Commands</span></span>

<span data-ttu-id="fb4e0-250">Viene definito un set di comandi per configurare il canale autenticato e impostare varie protezioni del contenuto.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-250">A set of commands are defined for configuring the authenticated channel and setting various content protections.</span></span> <span data-ttu-id="fb4e0-251">Per un elenco di comandi, vedere [protezione del contenuto comandi](content-protection-commands.md).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-251">For a list of commands, see [Content Protection Commands](content-protection-commands.md).</span></span>

<span data-ttu-id="fb4e0-252">Per inviare un comando al canale autenticato, seguire questa procedura.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-252">To send a command to the authenticated channel, perform the following steps.</span></span>

1.  <span data-ttu-id="fb4e0-253">Compilare la struttura dei dati di input.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-253">Fill in the input data structure.</span></span> <span data-ttu-id="fb4e0-254">Questa struttura di dati è sempre una struttura di [**D3D11_AUTHENTICATED_CONFIGURE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_input) seguita da campi aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-254">This data structure is always a [**D3D11_AUTHENTICATED_CONFIGURE_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_input) structure followed by additional fields.</span></span> <span data-ttu-id="fb4e0-255">Compilare la struttura **D3D11_AUTHENTICATED_CONFIGURE_INPUT** come illustrato nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-255">Fill in the **D3D11_AUTHENTICATED_CONFIGURE_INPUT** structure as shown in the following table.</span></span>

    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th><span data-ttu-id="fb4e0-256">Membro</span><span class="sxs-lookup"><span data-stu-id="fb4e0-256">Member</span></span></th>
    <th><span data-ttu-id="fb4e0-257">Descrizione</span><span class="sxs-lookup"><span data-stu-id="fb4e0-257">Description</span></span></th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><span data-ttu-id="fb4e0-258"><strong>OMAC</strong></span><span class="sxs-lookup"><span data-stu-id="fb4e0-258"><strong>omac</strong></span></span></td>
    <td><span data-ttu-id="fb4e0-259">Ignorare questo campo per il momento.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-259">Skip this field for now.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="fb4e0-260"><strong>ConfigureType</strong></span><span class="sxs-lookup"><span data-stu-id="fb4e0-260"><strong>ConfigureType</strong></span></span></td>
    <td><span data-ttu-id="fb4e0-261">GUID che identifica il comando.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-261">GUID that identifies the command.</span></span> <span data-ttu-id="fb4e0-262">Per un elenco di comandi, vedere <a href="content-protection-commands.md">protezione del contenuto comandi</a>.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-262">For a list of commands, see <a href="content-protection-commands.md">Content Protection Commands</a>.</span></span></td>
    </tr>
    <tr class="odd">
    <td><span data-ttu-id="fb4e0-263"><strong>hChannel</strong></span><span class="sxs-lookup"><span data-stu-id="fb4e0-263"><strong>hChannel</strong></span></span></td>
    <td><span data-ttu-id="fb4e0-264">Handle per il canale autenticato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-264">The handle to the authenticated channel.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="fb4e0-265"><strong>SequenceNumber</strong></span><span class="sxs-lookup"><span data-stu-id="fb4e0-265"><strong>SequenceNumber</strong></span></span></td>
    <td><span data-ttu-id="fb4e0-266">Numero di sequenza.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-266">The sequence number.</span></span> <span data-ttu-id="fb4e0-267">Il primo numero di sequenza viene specificato inviando un comando <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-267">The first sequence number is specified by sending a <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> command.</span></span> <span data-ttu-id="fb4e0-268">Ogni volta che si invia un altro comando, incrementare il numero di 1.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-268">Each time you send another command, increment this number by 1.</span></span> <span data-ttu-id="fb4e0-269">Il numero di sequenza protegge da attacchi di riproduzione.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-269">The sequence number guards against replay attacks.</span></span>
    <blockquote>
    [!Note]<br />
<span data-ttu-id="fb4e0-270">Vengono utilizzati due numeri di sequenza distinti, uno per i comandi e uno per le query.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-270">Two separate sequence numbers are used, one for commands and one for queries.</span></span>
    </blockquote>
    <br/> <br/></td>
    </tr>
    </tbody>
    </table>

    

     

2.  <span data-ttu-id="fb4e0-271">Calcolare il tag OMAC per il blocco di dati visualizzato dopo il membro **OMAC** della struttura di input.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-271">Calculate the OMAC tag for the block of data that appears after the **omac** member of the input structure.</span></span> <span data-ttu-id="fb4e0-272">Copiare quindi il valore del tag nel membro **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-272">Then copy this tag value into the **omac** member.</span></span>
3.  <span data-ttu-id="fb4e0-273">Chiamare [**ID3D11VideoContext:: ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-273">Call [**ID3D11VideoContext::ConfigureAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-configureauthenticatedchannel).</span></span>
4.  <span data-ttu-id="fb4e0-274">Il driver inserisce l'output del comando nella struttura [**D3D11_AUTHENTICATED_CONFIGURE_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_output) .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-274">The driver places the output from the command in the [**D3D11_AUTHENTICATED_CONFIGURE_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_output) structure.</span></span>
5.  <span data-ttu-id="fb4e0-275">Calcolare il tag OMAC per il blocco di dati visualizzato dopo il membro **OMAC** della struttura di output.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-275">Calculate the OMAC tag for the block of data that appears after the **omac** member of the output structure.</span></span> <span data-ttu-id="fb4e0-276">Confrontare con il valore del membro **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-276">Compare this with the value of the **omac** member.</span></span> <span data-ttu-id="fb4e0-277">Esito negativo se non corrispondono.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-277">Fail if they do not match.</span></span>
6.  <span data-ttu-id="fb4e0-278">Confrontare i valori dei membri **ConfigureType**, **hChannel** e **SequenceNumber** nella struttura di output con i valori per tali membri.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-278">Compare the values of the **ConfigureType**, **hChannel**, and **SequenceNumber** members in the output structure against your values for those members.</span></span> <span data-ttu-id="fb4e0-279">Esito negativo se non corrispondono.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-279">Fail if they do not match.</span></span>
7.  <span data-ttu-id="fb4e0-280">Incrementare il numero di sequenza del comando successivo.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-280">Increment the sequence number for the next command.</span></span>

## <a name="sending-authenticated-channel-queries"></a><span data-ttu-id="fb4e0-281">Invio di query sul canale autenticato</span><span class="sxs-lookup"><span data-stu-id="fb4e0-281">Sending Authenticated Channel Queries</span></span>

<span data-ttu-id="fb4e0-282">Viene definito un set di query per il recupero di informazioni sul canale autenticato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-282">A set of queries are defined for retrieving information about the authenticated channel.</span></span> <span data-ttu-id="fb4e0-283">Per un elenco di query, vedere [protezione del contenuto query](content-protection-queries.md).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-283">For a list of queries, see [Content Protection Queries](content-protection-queries.md).</span></span>

<span data-ttu-id="fb4e0-284">Per inviare un comando al canale autenticato, seguire questa procedura.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-284">To send a command to the authenticated channel, perform the following steps.</span></span>

1.  <span data-ttu-id="fb4e0-285">Compilare la struttura dei dati di input.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-285">Fill in the input data structure.</span></span> <span data-ttu-id="fb4e0-286">Questa struttura di dati è sempre una struttura di [**D3D11_AUTHENTICATED_QUERY_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_input) , probabilmente seguita da campi aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-286">This data structure is always a [**D3D11_AUTHENTICATED_QUERY_INPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_input) structure, possibly followed by additional fields.</span></span> <span data-ttu-id="fb4e0-287">Compilare la struttura **D3D11_AUTHENTICATED_QUERY_INPUT** come illustrato nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-287">Fill in the **D3D11_AUTHENTICATED_QUERY_INPUT** structure as shown in the following table.</span></span>

    <table>
    <colgroup>
    <col style="width: 50%" />
    <col style="width: 50%" />
    </colgroup>
    <thead>
    <tr class="header">
    <th><span data-ttu-id="fb4e0-288">Membro</span><span class="sxs-lookup"><span data-stu-id="fb4e0-288">Member</span></span></th>
    <th><span data-ttu-id="fb4e0-289">Descrizione</span><span class="sxs-lookup"><span data-stu-id="fb4e0-289">Description</span></span></th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td><span data-ttu-id="fb4e0-290"><strong>QueryType</strong></span><span class="sxs-lookup"><span data-stu-id="fb4e0-290"><strong>QueryType</strong></span></span></td>
    <td><span data-ttu-id="fb4e0-291">GUID che identifica la query.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-291">GUID that identifies the query.</span></span> <span data-ttu-id="fb4e0-292">Per un elenco di query, vedere <a href="content-protection-queries.md">protezione del contenuto query</a>.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-292">For a list of queries, see <a href="content-protection-queries.md">Content Protection Queries</a>.</span></span></td>
    </tr>
    <tr class="even">
    <td><span data-ttu-id="fb4e0-293"><strong>hChannel</strong></span><span class="sxs-lookup"><span data-stu-id="fb4e0-293"><strong>hChannel</strong></span></span></td>
    <td><span data-ttu-id="fb4e0-294">Handle per il canale autenticato.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-294">The handle to the authenticated channel.</span></span></td>
    </tr>
    <tr class="odd">
    <td><span data-ttu-id="fb4e0-295"><strong>SequenceNumber</strong></span><span class="sxs-lookup"><span data-stu-id="fb4e0-295"><strong>SequenceNumber</strong></span></span></td>
    <td><span data-ttu-id="fb4e0-296">Numero di sequenza.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-296">The sequence number.</span></span> <span data-ttu-id="fb4e0-297">Il primo numero di sequenza viene specificato inviando un comando <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-297">The first sequence number is specified by sending a <a href="/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_configure_initialize_input"><strong>D3D11_AUTHENTICATED_CONFIGURE_INITIALIZE</strong></a> command.</span></span> <span data-ttu-id="fb4e0-298">Ogni volta che si invia un'altra query, il numero viene incrementato di 1.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-298">Each time you send another query, increment this number by 1.</span></span> <span data-ttu-id="fb4e0-299">Il numero di sequenza protegge da attacchi di riproduzione.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-299">The sequence number guards against replay attacks.</span></span>
    <blockquote>
    [!Note]<br />
<span data-ttu-id="fb4e0-300">Vengono utilizzati due numeri di sequenza distinti, uno per i comandi e uno per le query.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-300">Two separate sequence numbers are used, one for commands and one for queries.</span></span>
    </blockquote>
    <br/> <br/></td>
    </tr>
    </tbody>
    </table>

    

     

2.  <span data-ttu-id="fb4e0-301">Chiamare [**ID3D11VideoContext:: QueryAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-queryauthenticatedchannel).</span><span class="sxs-lookup"><span data-stu-id="fb4e0-301">Call [**ID3D11VideoContext::QueryAuthenticatedChannel**](/windows/desktop/api/d3d11/nf-d3d11-id3d11videocontext-queryauthenticatedchannel).</span></span>
3.  <span data-ttu-id="fb4e0-302">Il driver inserisce l'output dalla query in una struttura [**D3D11_AUTHENTICATED_QUERY_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_output) .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-302">The driver places the output from the query in a [**D3D11_AUTHENTICATED_QUERY_OUTPUT**](/windows/desktop/api/d3d11/ns-d3d11-d3d11_authenticated_query_output) structure.</span></span> <span data-ttu-id="fb4e0-303">Questa struttura è seguita da campi aggiuntivi, a seconda del tipo di query.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-303">This structure is followed by additional fields, depending on the query type.</span></span>
4.  <span data-ttu-id="fb4e0-304">Calcolare il tag OMAC per il blocco di dati visualizzato dopo il membro **OMAC** della struttura di output.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-304">Calculate the OMAC tag for the block of data that appears after the **omac** member of the output structure.</span></span> <span data-ttu-id="fb4e0-305">Confrontare con il valore del membro **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="fb4e0-305">Compare this with the value of the **omac** member.</span></span> <span data-ttu-id="fb4e0-306">Esito negativo se non corrispondono.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-306">Fail if they do not match.</span></span>
5.  <span data-ttu-id="fb4e0-307">Confrontare i valori dei membri **ConfigureType**, **hChannel** e **SequenceNumber** nella struttura di output con i valori per tali membri.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-307">Compare the values of the **ConfigureType**, **hChannel**, and **SequenceNumber** members in the output structure against your values for those members.</span></span> <span data-ttu-id="fb4e0-308">Esito negativo se non corrispondono.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-308">Fail if they do not match.</span></span>
6.  <span data-ttu-id="fb4e0-309">Incrementa il numero di sequenza per la query successiva.</span><span class="sxs-lookup"><span data-stu-id="fb4e0-309">Increment the sequence number for the next query.</span></span>

## <a name="related-topics"></a><span data-ttu-id="fb4e0-310">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="fb4e0-310">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="fb4e0-311">API video Direct3D 11</span><span class="sxs-lookup"><span data-stu-id="fb4e0-311">Direct3D 11 Video APIs</span></span>](direct3d-11-video-apis.md)
</dt> </dl>

 

 
