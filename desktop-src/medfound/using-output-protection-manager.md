---
description: 'Ulteriori informazioni su: utilizzo di output Protection Manager'
ms.assetid: 01edc17e-e71c-4772-a03c-09c9a2b8400f
title: Utilizzo di output Protection Manager
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57bf4def3b0575dd706ae5f0c62924b6f1375a05
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106310174"
---
# <a name="using-output-protection-manager"></a><span data-ttu-id="46ae1-103">Utilizzo di output Protection Manager</span><span class="sxs-lookup"><span data-stu-id="46ae1-103">Using Output Protection Manager</span></span>

<span data-ttu-id="46ae1-104">Questo argomento descrive come usare output Protection Manager (OPM) per proteggere il contenuto video mentre passa su un connettore fisico a un dispositivo di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="46ae1-104">This topic describes how to use Output Protection Manager (OPM) to protect video content as it travels over a physical connector to a display device.</span></span> <span data-ttu-id="46ae1-105">In questo argomento sono incluse le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="46ae1-105">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="46ae1-106">Output video</span><span class="sxs-lookup"><span data-stu-id="46ae1-106">Video Outputs</span></span>](#video-outputs)
-   [<span data-ttu-id="46ae1-107">Inizializzazione di una sessione di OPM</span><span class="sxs-lookup"><span data-stu-id="46ae1-107">Initializing an OPM Session</span></span>](#initializing-an-opm-session)
-   [<span data-ttu-id="46ae1-108">Invio di richieste di stato di OPM</span><span class="sxs-lookup"><span data-stu-id="46ae1-108">Sending OPM Status Requests</span></span>](#sending-opm-status-requests)
-   [<span data-ttu-id="46ae1-109">Invio di comandi OPM</span><span class="sxs-lookup"><span data-stu-id="46ae1-109">Sending OPM Commands</span></span>](#sending-opm-commands)
-   [<span data-ttu-id="46ae1-110">Gestione di un output video disabilitato</span><span class="sxs-lookup"><span data-stu-id="46ae1-110">Handling a Disabled Video Output</span></span>](#sending-opm-commands)
-   [<span data-ttu-id="46ae1-111">Uso di HDCP per proteggere il contenuto</span><span class="sxs-lookup"><span data-stu-id="46ae1-111">Using HDCP to Protect Content</span></span>](#using-hdcp-to-protect-content)

<span data-ttu-id="46ae1-112">Il contenuto video Premium viene in genere crittografato per proteggerlo da duplicati non autorizzati.</span><span class="sxs-lookup"><span data-stu-id="46ae1-112">Premium video content is usually encrypted to protect it from unauthorized duplication.</span></span> <span data-ttu-id="46ae1-113">Naturalmente, il video deve essere decrittografato prima di essere visualizzato.</span><span class="sxs-lookup"><span data-stu-id="46ae1-113">Of course, the video must be decrypted before it is displayed.</span></span> <span data-ttu-id="46ae1-114">I frame decrittografati e non compressi devono quindi passare attraverso un connettore fisico al dispositivo di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="46ae1-114">The decrypted, uncompressed frames must then travel across a physical connector to the display device.</span></span> <span data-ttu-id="46ae1-115">I provider di contenuti possono richiedere che i fotogrammi video siano protetti a questo punto, mentre si spostano sul connettore fisico.</span><span class="sxs-lookup"><span data-stu-id="46ae1-115">Content providers may require the video frames to be protected at this point, as they travel across the physical connector.</span></span>

<span data-ttu-id="46ae1-116">A questo scopo esistono diversi meccanismi di protezione, tra cui High-Bandwidth Digital protezione del contenuto (HDCP) e DisplayPort protezione del contenuto (DPCP) per gli output digitali; e Copy Generation Management System-Analog (CGMS-A) per gli output analoghi.</span><span class="sxs-lookup"><span data-stu-id="46ae1-116">Various protection mechanisms exist for this purpose, including High-Bandwidth Digital Content Protection (HDCP) and DisplayPort Content Protection (DPCP) for digital outputs; and Copy Generation Management System - Analog (CGMS-A) for analog outputs.</span></span> <span data-ttu-id="46ae1-117">In genere, questi meccanismi comportano la crittografia o la rimescolanza del segnale prima che venga visualizzato.</span><span class="sxs-lookup"><span data-stu-id="46ae1-117">Generally, these mechanisms involve encrypting or scrambling the signal befores it goes to the display.</span></span>

<span data-ttu-id="46ae1-118">OPM consente a un'applicazione di applicare meccanismi di protezione del contenuto nell'output del video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-118">OPM enables an application to enforce content protection mechanisms on the video output.</span></span> <span data-ttu-id="46ae1-119">Con l'uso di OPM, l'applicazione invia comandi e richieste di stato al driver di grafica tramite un canale sicuro attendibile.</span><span class="sxs-lookup"><span data-stu-id="46ae1-119">Using OPM, the application sends commands and status requests to the graphics driver through a trusted, secure channel.</span></span> <span data-ttu-id="46ae1-120">OPM consente a un'applicazione di:</span><span class="sxs-lookup"><span data-stu-id="46ae1-120">OPM enables an application to:</span></span>

-   <span data-ttu-id="46ae1-121">Verificare che un driver di grafica sia stato firmato da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="46ae1-121">Verify that a graphics driver has been signed by Microsoft.</span></span>
-   <span data-ttu-id="46ae1-122">Configurare un canale di comunicazione attendibile con il driver.</span><span class="sxs-lookup"><span data-stu-id="46ae1-122">Set up a trusted communication channel with the driver.</span></span>
-   <span data-ttu-id="46ae1-123">Applicare i meccanismi di protezione del contenuto nell'output fisico.</span><span class="sxs-lookup"><span data-stu-id="46ae1-123">Enforce content protection mechanisms on the physical output.</span></span>

<span data-ttu-id="46ae1-124">OPM sostituisce Certified Output Protection Protocol (COPP) e usa un'API simile.</span><span class="sxs-lookup"><span data-stu-id="46ae1-124">OPM replaces Certified Output Protection Protcol (COPP) and uses a similar API.</span></span> <span data-ttu-id="46ae1-125">Per compatibilità con le versioni precedenti, l'interfaccia OPM può emulare l'interfaccia COPP.</span><span class="sxs-lookup"><span data-stu-id="46ae1-125">For backward compatibility, the OPM interface can emulate the COPP interface.</span></span> <span data-ttu-id="46ae1-126">Di seguito sono riportate le differenze tra OPM e COPP:</span><span class="sxs-lookup"><span data-stu-id="46ae1-126">Differences between OPM and COPP include the following:</span></span>

-   <span data-ttu-id="46ae1-127">OPM USA certificati X. 509, mentre COPP usa un formato di certificato proprietario.</span><span class="sxs-lookup"><span data-stu-id="46ae1-127">OPM uses X.509 certificates, while COPP uses a proprietary certificate format.</span></span>
-   <span data-ttu-id="46ae1-128">OPM supporta i ripetitori HDCP.</span><span class="sxs-lookup"><span data-stu-id="46ae1-128">OPM supports HDCP repeaters.</span></span>
-   <span data-ttu-id="46ae1-129">Le applicazioni che usano OPM non devono analizzare i messaggi di rinnovabilità del sistema HDCP (SRM).</span><span class="sxs-lookup"><span data-stu-id="46ae1-129">Applications that use OPM do not have to parse HDCP system renewability messages (SRMs).</span></span>
-   <span data-ttu-id="46ae1-130">È possibile usare OPM quando la visualizzazione grafica usa la modalità di clonazione.</span><span class="sxs-lookup"><span data-stu-id="46ae1-130">OPM can be used when the graphics display is using clone mode.</span></span> <span data-ttu-id="46ae1-131">COPP non supporta la modalità di clonazione.</span><span class="sxs-lookup"><span data-stu-id="46ae1-131">COPP does not support clone mode.</span></span>

<span data-ttu-id="46ae1-132">Se l'applicazione usa il percorso multimediale protetto (PMP) per riprodurre contenuti video, non è necessario usare l'API di OPM, perché il PMP esegue tutte le chiamate OPM richieste.</span><span class="sxs-lookup"><span data-stu-id="46ae1-132">If your application uses the protected media path (PMP) to play video content, you do not have to use the OPM API, because the PMP makes all of the required OPM calls.</span></span> <span data-ttu-id="46ae1-133">L'API OPM è disponibile per le applicazioni che non usano il PMP.</span><span class="sxs-lookup"><span data-stu-id="46ae1-133">The OPM API is available for applications that do not use the PMP.</span></span>

<span data-ttu-id="46ae1-134">OPM è disponibile in Windows Vista e versioni successive, ma l'API non è stata resa pubblica fino a Windows 7.</span><span class="sxs-lookup"><span data-stu-id="46ae1-134">OPM is available in Windows Vista and later, but the API was not made public until Windows 7.</span></span> <span data-ttu-id="46ae1-135">Per usare OPM in un'applicazione, è necessario avere le intestazioni e i file di libreria di Windows 7 SDK.</span><span class="sxs-lookup"><span data-stu-id="46ae1-135">To use OPM in an application, you must have the headers and library files from the Windows 7 SDK.</span></span> <span data-ttu-id="46ae1-136">Non è necessario ridistribuire le dll per l'uso di OPM in Windows Vista o Windows Server 2008.</span><span class="sxs-lookup"><span data-stu-id="46ae1-136">You do not have to redistribute any DLLs to use OPM in Windows Vista or Windows Server 2008.</span></span>

## <a name="video-outputs"></a><span data-ttu-id="46ae1-137">Output video</span><span class="sxs-lookup"><span data-stu-id="46ae1-137">Video Outputs</span></span>

<span data-ttu-id="46ae1-138">Una scheda grafica può avere più di un output fisico, ognuno con le proprie funzionalità.</span><span class="sxs-lookup"><span data-stu-id="46ae1-138">A graphics adapter can have more than one physical output, each with its own capabilities.</span></span> <span data-ttu-id="46ae1-139">Prima che un'applicazione riproduca contenuto protetto, deve impostare i meccanismi di protezione appropriati in ogni output video associato alla scheda grafica che visualizzerà il video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-139">Before an application plays protected content, it must set the appropriate protection mechanisms on every video output associated with the graphics card that will display the video.</span></span> <span data-ttu-id="46ae1-140">I meccanismi di protezione da applicare dipenderanno dalle regole di utilizzo per il contenuto.</span><span class="sxs-lookup"><span data-stu-id="46ae1-140">Which protection mechanisms to apply will depend on the usage rules for the content.</span></span>

<span data-ttu-id="46ae1-141">Ogni output video è rappresentato da un'istanza dell'interfaccia [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-141">Each video output is represented by an instance of the [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) interface.</span></span> <span data-ttu-id="46ae1-142">Per ottenere gli output video, è possibile usare un dispositivo Direct3D o un handle di monitoraggio.</span><span class="sxs-lookup"><span data-stu-id="46ae1-142">You can use a Direct3D device or monitor handles to get the video outputs.</span></span>

<span data-ttu-id="46ae1-143">Uso di un dispositivo Direct3D:</span><span class="sxs-lookup"><span data-stu-id="46ae1-143">Using a Direct3D device:</span></span>

1.  <span data-ttu-id="46ae1-144">Ottenere il puntatore **IDirect3DDevice9** per il dispositivo Direct3D che l'applicazione userà per creare le superfici per i frame video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-144">Get the **IDirect3DDevice9** pointer for the Direct3D device that your application will use to create surfaces to hold the video frames.</span></span>
2.  <span data-ttu-id="46ae1-145">Chiamare la funzione [**OPMGetVideoOutputsFromIDirect3DDevice9Object**](/windows/desktop/api/opmapi/nf-opmapi-opmgetvideooutputsfromidirect3ddevice9object) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-145">Call the [**OPMGetVideoOutputsFromIDirect3DDevice9Object**](/windows/desktop/api/opmapi/nf-opmapi-opmgetvideooutputsfromidirect3ddevice9object) function.</span></span> <span data-ttu-id="46ae1-146">Questa funzione alloca una matrice di puntatori [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) , uno per ogni output.</span><span class="sxs-lookup"><span data-stu-id="46ae1-146">This function allocates an array of [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) pointers, one for each output.</span></span>

<span data-ttu-id="46ae1-147">Utilizzo di handle di monitoraggio:</span><span class="sxs-lookup"><span data-stu-id="46ae1-147">Using monitor handles:</span></span>

1.  <span data-ttu-id="46ae1-148">Chiamare **EnumDisplayMonitors** per ottenere gli handle **HMONITOR** che corrispondono alla finestra del video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-148">Call **EnumDisplayMonitors** to get the **HMONITOR** handles that correspond to the video window.</span></span> <span data-ttu-id="46ae1-149">È possibile associare diversi monitoraggi alla stessa finestra, in modo che si possano ottenere diversi handle **HMONITOR** .</span><span class="sxs-lookup"><span data-stu-id="46ae1-149">Several monitors can be associated with the same window, so you might get several **HMONITOR** handles.</span></span>
2.  <span data-ttu-id="46ae1-150">Per ogni handle di monitoraggio, chiamare [**OPMGetVideoOutputsFromHMONITOR**](/windows/desktop/api/opmapi/nf-opmapi-opmgetvideooutputsfromhmonitor).</span><span class="sxs-lookup"><span data-stu-id="46ae1-150">For each monitor handle, call [**OPMGetVideoOutputsFromHMONITOR**](/windows/desktop/api/opmapi/nf-opmapi-opmgetvideooutputsfromhmonitor).</span></span> <span data-ttu-id="46ae1-151">Questa funzione alloca una matrice di puntatori [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) , uno per ogni output.</span><span class="sxs-lookup"><span data-stu-id="46ae1-151">This function allocates an array of [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) pointers, one for each output.</span></span>

## <a name="initializing-an-opm-session"></a><span data-ttu-id="46ae1-152">Inizializzazione di una sessione di OPM</span><span class="sxs-lookup"><span data-stu-id="46ae1-152">Initializing an OPM Session</span></span>

<span data-ttu-id="46ae1-153">Prima che l'applicazione invii comandi o richieste di stato OPM, è necessario verificare che l'output del video sia attendibile e stabilire una chiave di sessione.</span><span class="sxs-lookup"><span data-stu-id="46ae1-153">Before the application sends OPM commands or status requests, it must verify that the video output is trusted and establish a session key.</span></span> <span data-ttu-id="46ae1-154">La chiave della sessione viene utilizzata per firmare i dati scambiati tra l'applicazione e il driver di grafica.</span><span class="sxs-lookup"><span data-stu-id="46ae1-154">The session key is used to sign the data that is exchanged between the application and the graphics driver.</span></span>

<span data-ttu-id="46ae1-155">L'API OPM definisce un handshake che stabilisce l'attendibilità e imposta la chiave della sessione.</span><span class="sxs-lookup"><span data-stu-id="46ae1-155">The OPM API defines a handshake that establishes trust and sets the session key.</span></span> <span data-ttu-id="46ae1-156">È necessario eseguire questo handshake per ogni istanza dell'interfaccia [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) , come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="46ae1-156">You must perform this handshake for each instance of the [**IOPMVideoOutput**](/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput) interface, as follows:</span></span>

1.  <span data-ttu-id="46ae1-157">Chiamare [**IOPMVideoOutput:: StartInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-startinitialization).</span><span class="sxs-lookup"><span data-stu-id="46ae1-157">Call [**IOPMVideoOutput::StartInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-startinitialization).</span></span> <span data-ttu-id="46ae1-158">Questo metodo recupera due tipi di dati:</span><span class="sxs-lookup"><span data-stu-id="46ae1-158">This method retrieves two pieces of data:</span></span>
    -   <span data-ttu-id="46ae1-159">Numero casuale generato dal driver.</span><span class="sxs-lookup"><span data-stu-id="46ae1-159">A random number, generated by the driver.</span></span> <span data-ttu-id="46ae1-160">Questo numero verrà usato per completare l'handshake.</span><span class="sxs-lookup"><span data-stu-id="46ae1-160">You will use this number to complete the handshake.</span></span>
    -   <span data-ttu-id="46ae1-161">Catena di certificati X. 509 del driver.</span><span class="sxs-lookup"><span data-stu-id="46ae1-161">The driver's X.509 certificate chain.</span></span>
2.  <span data-ttu-id="46ae1-162">Verificare che la catena di certificati sia stata firmata da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="46ae1-162">Verify that the certificate chain has been signed by Microsoft.</span></span>
    > [!Note]  
    > <span data-ttu-id="46ae1-163">La revoca dei certificati esula dall'ambito di OPM.</span><span class="sxs-lookup"><span data-stu-id="46ae1-163">Certificate revocation is outside the scope of OPM.</span></span>

     

3.  <span data-ttu-id="46ae1-164">Ottenere la chiave pubblica del driver dalla catena di certificati.</span><span class="sxs-lookup"><span data-stu-id="46ae1-164">Get the driver's public key from the certificate chain.</span></span>
4.  <span data-ttu-id="46ae1-165">Generare una chiave di sessione AES a 128 bit.</span><span class="sxs-lookup"><span data-stu-id="46ae1-165">Generate a 128-bit AES session key.</span></span>
5.  <span data-ttu-id="46ae1-166">Generare due numeri casuali a 32 bit:</span><span class="sxs-lookup"><span data-stu-id="46ae1-166">Generate two random 32-bit numbers:</span></span>

    -   <span data-ttu-id="46ae1-167">Numero di sequenza iniziale per le richieste di stato di OPM.</span><span class="sxs-lookup"><span data-stu-id="46ae1-167">The starting sequence number for OPM status requests.</span></span>
    -   <span data-ttu-id="46ae1-168">Numero di sequenza iniziale per i comandi di OPM.</span><span class="sxs-lookup"><span data-stu-id="46ae1-168">The starting sequence number for OPM commands.</span></span>

    <span data-ttu-id="46ae1-169">Questi numeri devono essere generati usando un generatore di numeri pseudo-casuali sicuri crittograficamente, ad esempio **CryptGenRandom**.</span><span class="sxs-lookup"><span data-stu-id="46ae1-169">These numbers must be generated using a cryptographically secure pseudo-random number generator, such as **CryptGenRandom**.</span></span>

6.  <span data-ttu-id="46ae1-170">Copiare il numero casuale del driver (ottenuto nel passaggio 1), la chiave della sessione e i due numeri di sequenza in una struttura di [**\_ \_ \_ parametri di inizializzazione crittografata di OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_encrypted_initialization_parameters) , come descritto in [**IOPMVideoOutput:: FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization).</span><span class="sxs-lookup"><span data-stu-id="46ae1-170">Copy the driver's random number (obtained in step 1), the session key, and the two sequence numbers into an [**OPM\_ENCRYPTED\_INITIALIZATION\_PARAMETERS**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_encrypted_initialization_parameters) structure, as described in [**IOPMVideoOutput::FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization).</span></span>
7.  <span data-ttu-id="46ae1-171">Crittografare la struttura dei [**\_ \_ \_ parametri di inizializzazione crittografata di OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_encrypted_initialization_parameters) con RSAES-OAEP, utilizzando la chiave pubblica del driver, disponibile nel certificato del driver.</span><span class="sxs-lookup"><span data-stu-id="46ae1-171">Encrypt the [**OPM\_ENCRYPTED\_INITIALIZATION\_PARAMETERS**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_encrypted_initialization_parameters) structure with RSAES-OAEP, using the driver's public key, which is found in the driver's certificate.</span></span>
8.  <span data-ttu-id="46ae1-172">Chiamare [**IOPMVideoOutput:: FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization).</span><span class="sxs-lookup"><span data-stu-id="46ae1-172">Call [**IOPMVideoOutput::FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization).</span></span>

## <a name="sending-opm-status-requests"></a><span data-ttu-id="46ae1-173">Invio di richieste di stato di OPM</span><span class="sxs-lookup"><span data-stu-id="46ae1-173">Sending OPM Status Requests</span></span>

<span data-ttu-id="46ae1-174">Le richieste di stato di OPM restituiscono informazioni sull'output video, ad esempio il tipo di connettore fisico e il livello di protezione corrente.</span><span class="sxs-lookup"><span data-stu-id="46ae1-174">OPM status requests return information about the video output, such as the type of physical connector and the current protection level.</span></span> <span data-ttu-id="46ae1-175">Per un elenco di tipi di richiesta, vedere [richieste di stato di OPM](opm-status-requests.md).</span><span class="sxs-lookup"><span data-stu-id="46ae1-175">For a list of request types, see [OPM Status Requests](opm-status-requests.md).</span></span>

<span data-ttu-id="46ae1-176">Per inviare una richiesta di stato, seguire questa procedura.</span><span class="sxs-lookup"><span data-stu-id="46ae1-176">To send a status request, perform the following steps.</span></span>

1.  <span data-ttu-id="46ae1-177">Inizializzare una struttura del [**\_ \_ \_ parametro OPM Get Info**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) come illustrato nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="46ae1-177">Initialize an [**OPM\_GET\_INFO\_PARAMETERS**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) structure as shown in the following table.</span></span>

    | <span data-ttu-id="46ae1-178">Membro</span><span class="sxs-lookup"><span data-stu-id="46ae1-178">Member</span></span>               | <span data-ttu-id="46ae1-179">Descrizione</span><span class="sxs-lookup"><span data-stu-id="46ae1-179">Description</span></span>                                                                                                                                                                                                                                                                                                                                                                 |
    |----------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | <span data-ttu-id="46ae1-180">**OMAC**</span><span class="sxs-lookup"><span data-stu-id="46ae1-180">**omac**</span></span>             | <span data-ttu-id="46ae1-181">Ignorare questo campo per il momento.</span><span class="sxs-lookup"><span data-stu-id="46ae1-181">Skip this field for now.</span></span>                                                                                                                                                                                                                                                                                                                                                    |
    | <span data-ttu-id="46ae1-182">**rnRandomNumber**</span><span class="sxs-lookup"><span data-stu-id="46ae1-182">**rnRandomNumber**</span></span>   | <span data-ttu-id="46ae1-183">Numero casuale a 128 bit a crittografia sicura.</span><span class="sxs-lookup"><span data-stu-id="46ae1-183">A cryptographically secure 128-bit random number.</span></span> <span data-ttu-id="46ae1-184">Quando si effettua una richiesta di stato, generare sempre un nuovo numero casuale, anche se si esegue la stessa richiesta.</span><span class="sxs-lookup"><span data-stu-id="46ae1-184">Whenever you make a status request, always generate a new random number, even if you are making the same request.</span></span> <span data-ttu-id="46ae1-185">Archiviare il numero in una variabile, perché sarà necessario farvi riferimento in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="46ae1-185">Store the number in a variable, because you will need to refer to it later.</span></span>                                                                                                                             |
    | <span data-ttu-id="46ae1-186">**guidInformation**</span><span class="sxs-lookup"><span data-stu-id="46ae1-186">**guidInformation**</span></span>  | <span data-ttu-id="46ae1-187">GUID che identifica la richiesta di stato.</span><span class="sxs-lookup"><span data-stu-id="46ae1-187">A GUID that identifies the status request.</span></span> <span data-ttu-id="46ae1-188">Per un elenco delle richieste di stato, vedere [richieste di stato di OPM](opm-status-requests.md).</span><span class="sxs-lookup"><span data-stu-id="46ae1-188">For a list of status requests, see [OPM Status Requests](opm-status-requests.md).</span></span>                                                                                                                                                                                                                                               |
    | <span data-ttu-id="46ae1-189">**ulSequenceNumber**</span><span class="sxs-lookup"><span data-stu-id="46ae1-189">**ulSequenceNumber**</span></span> | <span data-ttu-id="46ae1-190">Numero di sequenza.</span><span class="sxs-lookup"><span data-stu-id="46ae1-190">The sequence number.</span></span> <span data-ttu-id="46ae1-191">Per la prima richiesta di stato, usare il numero di sequenza iniziale specificato nel metodo [**IOPMVideoOutput:: FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization) (passaggio 5 dell' [inizializzazione di una sessione di OPM](#initializing-an-opm-session)). Ogni volta che si effettua un'altra richiesta di stato, incrementare il numero di 1.</span><span class="sxs-lookup"><span data-stu-id="46ae1-191">For the first status request, use the starting sequence number that you specified in the [**IOPMVideoOutput::FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization) method (step 5 of [Initializing an OPM Session](#initializing-an-opm-session).) Each time you make another status request, increment this number by 1.</span></span> |
    | <span data-ttu-id="46ae1-192">**abParameters**</span><span class="sxs-lookup"><span data-stu-id="46ae1-192">**abParameters**</span></span>     | <span data-ttu-id="46ae1-193">Matrice di byte che contiene dati di input aggiuntivi per la richiesta.</span><span class="sxs-lookup"><span data-stu-id="46ae1-193">A byte array that contains additional input data for the request.</span></span> <span data-ttu-id="46ae1-194">Il formato dei dati di input è elencato nell'argomento di riferimento per ogni richiesta di stato.</span><span class="sxs-lookup"><span data-stu-id="46ae1-194">The format of the input data is listed in the reference topic for each status request.</span></span>                                                                                                                                                                                                                    |
    | <span data-ttu-id="46ae1-195">**cbParametersSize**</span><span class="sxs-lookup"><span data-stu-id="46ae1-195">**cbParametersSize**</span></span> | <span data-ttu-id="46ae1-196">Dimensione dei dati validi nella matrice **abParameters** .</span><span class="sxs-lookup"><span data-stu-id="46ae1-196">The size of the valid data in the **abParameters** array.</span></span> <span data-ttu-id="46ae1-197">Il contenuto del resto della matrice non è definito.</span><span class="sxs-lookup"><span data-stu-id="46ae1-197">The contents of the rest of the array are undefined.</span></span>                                                                                                                                                                                                                                                              |

    

     

2.  <span data-ttu-id="46ae1-198">Calcolare l'elemento CBC MAC a una chiave (OMAC-1) per calcolare un hash per il blocco di dati visualizzato dopo il membro **OMAC** , quindi impostare il membro **OMAC** su questo valore.</span><span class="sxs-lookup"><span data-stu-id="46ae1-198">Calculate the one-key CBC MAC (OMAC-1) to calculate a hash for the block of data that appears after the **omac** member, and then set the **omac** member to this value.</span></span> <span data-ttu-id="46ae1-199">Vedere il [codice di esempio di OPM](opm-example-code.md).</span><span class="sxs-lookup"><span data-stu-id="46ae1-199">See [OPM Example Code](opm-example-code.md).</span></span>
3.  <span data-ttu-id="46ae1-200">Chiamare il metodo [**IOPMVideoOutput:: GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-200">Call the [**IOPMVideoOutput::GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) method.</span></span> <span data-ttu-id="46ae1-201">Passare un puntatore alla struttura del [**\_ \_ \_ parametro OPM Get Info**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) e un puntatore a una struttura [**di \_ \_ informazioni richiesta da OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-201">Pass in a pointer to the [**OPM\_GET\_INFO\_PARAMETERS**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) structure and a pointer to an [**OPM\_REQUESTED\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) structure.</span></span> <span data-ttu-id="46ae1-202">La risposta del driver viene scritta nella struttura **di \_ \_ informazioni richiesta da OPM** .</span><span class="sxs-lookup"><span data-stu-id="46ae1-202">The driver's response is written to the **OPM\_REQUESTED\_INFORMATION** structure.</span></span>
    -   <span data-ttu-id="46ae1-203">Il membro **OMAC** di questa struttura contiene un OMAC calcolato per i dati che seguono questo membro.</span><span class="sxs-lookup"><span data-stu-id="46ae1-203">The **omac** member of this structure contains an OMAC computed for the data that follows this member.</span></span>
    -   <span data-ttu-id="46ae1-204">Il membro **abRequestedInformation** è una matrice di byte che contiene i dati di output per la risposta.</span><span class="sxs-lookup"><span data-stu-id="46ae1-204">The **abRequestedInformation** member is a byte array that contains output data for the response.</span></span> <span data-ttu-id="46ae1-205">Il formato dei dati di output è elencato nell'argomento di riferimento per ogni richiesta di stato.</span><span class="sxs-lookup"><span data-stu-id="46ae1-205">The format of the output data is listed in the reference topic for each status request.</span></span>
4.  <span data-ttu-id="46ae1-206">Calcolare un OMAC per la struttura delle [**\_ \_ informazioni richiesta da OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) , escluso il membro **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="46ae1-206">Calculate an OMAC for the [**OPM\_REQUESTED\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) structure, not including the **omac** member.</span></span> <span data-ttu-id="46ae1-207">Verificare che OMAC corrisponda al valore nel membro **OMAC** .</span><span class="sxs-lookup"><span data-stu-id="46ae1-207">Verify that the OMAC matches the value in the **omac** member.</span></span>
5.  <span data-ttu-id="46ae1-208">Verificare che il membro **cbRequestedInformationSize** della struttura [**di \_ \_ informazioni richiesta da OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) fornisca la dimensione corretta per i dati di output.</span><span class="sxs-lookup"><span data-stu-id="46ae1-208">Make sure the **cbRequestedInformationSize** member of the [**OPM\_REQUESTED\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) structure gives the correct size for the output data.</span></span> <span data-ttu-id="46ae1-209">Ad esempio, i dati di output per la query del [**\_ \_ \_ tipo di connettore OPM Get**](opm-get-connector-type.md) sono una struttura di [**\_ \_ informazioni standard OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) , quindi il valore di **cbRequestedInformationSize** deve essere `sizeof(OPM_STANDARD_INFORMATION)` .</span><span class="sxs-lookup"><span data-stu-id="46ae1-209">For example, the output data for the [**OPM\_GET\_CONNECTOR\_TYPE**](opm-get-connector-type.md) query is an [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure, so the value of **cbRequestedInformationSize** should be `sizeof(OPM_STANDARD_INFORMATION)`.</span></span>
6.  <span data-ttu-id="46ae1-210">Eseguire il cast del membro **abRequestedInformation** della struttura di [**\_ \_ informazioni richiesta da OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) alla struttura dei dati di output corretta.</span><span class="sxs-lookup"><span data-stu-id="46ae1-210">Cast the **abRequestedInformation** member of the [**OPM\_REQUESTED\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) structure to the correct output data structure.</span></span> <span data-ttu-id="46ae1-211">Ad esempio, se la richiesta di stato è il [**\_ tipo di \_ connettore \_ OPM Get**](opm-get-connector-type.md), eseguire il cast di **abRequestedInformation** a una struttura di [**\_ \_ informazioni standard OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-211">For example, if the status request is [**OPM\_GET\_CONNECTOR\_TYPE**](opm-get-connector-type.md), cast **abRequestedInformation** to an [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure.</span></span>
7.  <span data-ttu-id="46ae1-212">Verificare che il membro **rnRandomNumber** della struttura dei dati di output corrisponda al valore di **rnRandomNumber** del passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="46ae1-212">Make sure the **rnRandomNumber** member of the output data structure matches the value of **rnRandomNumber** from step 1.</span></span>
8.  <span data-ttu-id="46ae1-213">Verificare il membro **ulStatusFlags** della struttura dei dati di output, come descritto in [gestione di un output video disabilitato](#handling-a-disabled-video-output).</span><span class="sxs-lookup"><span data-stu-id="46ae1-213">Check the **ulStatusFlags** member of the output data structure, as described in [Handling a Disabled Video Output](#handling-a-disabled-video-output).</span></span>

<span data-ttu-id="46ae1-214">Se uno dei controlli nei passaggi 5-8 ha esito negativo, l'applicazione deve interrompere la visualizzazione del contenuto protetto.</span><span class="sxs-lookup"><span data-stu-id="46ae1-214">If any of the checks in steps 5–8 fails, the application must stop showing protected content.</span></span>

## <a name="sending-opm-commands"></a><span data-ttu-id="46ae1-215">Invio di comandi OPM</span><span class="sxs-lookup"><span data-stu-id="46ae1-215">Sending OPM Commands</span></span>

<span data-ttu-id="46ae1-216">I comandi di OPM vengono usati per impostare il livello di protezione e altre impostazioni nell'output del video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-216">OPM commands are used to set the protection level and other settings on the video output.</span></span> <span data-ttu-id="46ae1-217">L'invio di un comando OPM è simile all'invio di una richiesta di stato, ad eccezione del fatto che non sono presenti dati di risposta dal driver.</span><span class="sxs-lookup"><span data-stu-id="46ae1-217">Sending an OPM command is similar to sending a status request, except there is no response data from the driver.</span></span> <span data-ttu-id="46ae1-218">Per un elenco di comandi, vedere [comandi di OPM](opm-commands.md).</span><span class="sxs-lookup"><span data-stu-id="46ae1-218">For a list of commands, see [OPM Commands](opm-commands.md).</span></span>

<span data-ttu-id="46ae1-219">Per inviare un comando OPM, seguire questa procedura.</span><span class="sxs-lookup"><span data-stu-id="46ae1-219">To send an OPM command, perform the following steps.</span></span>

1.  <span data-ttu-id="46ae1-220">Compilare una struttura [**di \_ \_ parametri di configurazione di OPM**](/windows/desktop/api/opmapi/ns-opmapi-opm_configure_parameters) , come illustrato nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="46ae1-220">Fill in an [**OPM\_CONFIGURE\_PARAMETERS**](/windows/desktop/api/opmapi/ns-opmapi-opm_configure_parameters) structure as shown in the following table.</span></span>

    | <span data-ttu-id="46ae1-221">Membro</span><span class="sxs-lookup"><span data-stu-id="46ae1-221">Member</span></span>                | <span data-ttu-id="46ae1-222">Descrizione</span><span class="sxs-lookup"><span data-stu-id="46ae1-222">Description</span></span>                                                                                                                                                                                                                                                                                                                                                   |
    |-----------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | <span data-ttu-id="46ae1-223">**OMAC**</span><span class="sxs-lookup"><span data-stu-id="46ae1-223">**omac**</span></span>              | <span data-ttu-id="46ae1-224">Ignorare questo campo per il momento.</span><span class="sxs-lookup"><span data-stu-id="46ae1-224">Skip this field for now.</span></span>                                                                                                                                                                                                                                                                                                                                      |
    | <span data-ttu-id="46ae1-225">**guidSetting**</span><span class="sxs-lookup"><span data-stu-id="46ae1-225">**guidSetting**</span></span>       | <span data-ttu-id="46ae1-226">GUID che identifica il comando.</span><span class="sxs-lookup"><span data-stu-id="46ae1-226">A GUID that identifies the command.</span></span> <span data-ttu-id="46ae1-227">Per un elenco di comandi, vedere [comandi di OPM](opm-commands.md).</span><span class="sxs-lookup"><span data-stu-id="46ae1-227">For a list of commands, see [OPM Commands](opm-commands.md).</span></span>                                                                                                                                                                                                                                                             |
    | <span data-ttu-id="46ae1-228">**ulSequenceNumber**</span><span class="sxs-lookup"><span data-stu-id="46ae1-228">**ulSequenceNumber**</span></span>  | <span data-ttu-id="46ae1-229">Numero di sequenza.</span><span class="sxs-lookup"><span data-stu-id="46ae1-229">The sequence number.</span></span> <span data-ttu-id="46ae1-230">Per il primo comando, usare il numero di sequenza iniziale specificato nel metodo [**IOPMVideoOutput:: FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization) (passaggio 5 dell' [inizializzazione di una sessione di OPM](#initializing-an-opm-session)). Ogni volta che si invia un altro comando, incrementare il numero di 1.</span><span class="sxs-lookup"><span data-stu-id="46ae1-230">For the first command, use the starting sequence number that you specified in the [**IOPMVideoOutput::FinishInitialization**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-finishinitialization) method (step 5 of [Initializing an OPM Session](#initializing-an-opm-session).) Each time you send another command, increment this number by 1.</span></span> |
    | <span data-ttu-id="46ae1-231">**abParameters**</span><span class="sxs-lookup"><span data-stu-id="46ae1-231">**abParameters**</span></span>      | <span data-ttu-id="46ae1-232">Matrice di byte che contiene dati di input aggiuntivi per il comando.</span><span class="sxs-lookup"><span data-stu-id="46ae1-232">A byte array that contains additional input data for the command.</span></span> <span data-ttu-id="46ae1-233">Il formato dei dati di input è elencato nell'argomento di riferimento per ogni comando.</span><span class="sxs-lookup"><span data-stu-id="46ae1-233">The format of the input data is listed in the reference topic for each command.</span></span>                                                                                                                                                                                                             |
    | <span data-ttu-id="46ae1-234">**cbSettingDataSize**</span><span class="sxs-lookup"><span data-stu-id="46ae1-234">**cbSettingDataSize**</span></span> | <span data-ttu-id="46ae1-235">Dimensione dei dati validi nella matrice **abParameters** .</span><span class="sxs-lookup"><span data-stu-id="46ae1-235">The size of the valid data in the **abParameters** array.</span></span> <span data-ttu-id="46ae1-236">Il contenuto del resto della matrice non è definito.</span><span class="sxs-lookup"><span data-stu-id="46ae1-236">The contents of the rest of the array are undefined.</span></span>                                                                                                                                                                                                                                                |

    

     

2.  <span data-ttu-id="46ae1-237">Calcolare un OMAC per il blocco di dati visualizzato dopo il membro **OMAC** , quindi impostare il membro **OMAC** su questo valore.</span><span class="sxs-lookup"><span data-stu-id="46ae1-237">Calculate an OMAC for the block of data that appears after the **omac** member, and then set the **omac** member to this value.</span></span>
3.  <span data-ttu-id="46ae1-238">Chiamare [**IOPMVideoOutput:: Configure**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-configure).</span><span class="sxs-lookup"><span data-stu-id="46ae1-238">Call [**IOPMVideoOutput::Configure**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-configure).</span></span>

<span data-ttu-id="46ae1-239">Per la maggior parte dei comandi, esiste una richiesta di stato corrispondente che restituisce lo stato del comando.</span><span class="sxs-lookup"><span data-stu-id="46ae1-239">For most commands, there is a corresponding status request that returns the status of the command.</span></span> <span data-ttu-id="46ae1-240">Ad esempio, il comando [**OPM \_ set \_ Protection \_ Level**](opm-set-protection-level.md) imposta il livello di protezione e il comando [**OPM \_ get \_ virtual \_ Protection \_ Level**](opm-get-virtual-protection-level.md) ottiene il livello di protezione corrente.</span><span class="sxs-lookup"><span data-stu-id="46ae1-240">For example, the [**OPM\_SET\_PROTECTION\_LEVEL**](opm-set-protection-level.md) command sets the protection level, and the [**OPM\_GET\_VIRTUAL\_PROTECTION\_LEVEL**](opm-get-virtual-protection-level.md) command gets the current protection level.</span></span>

## <a name="handling-a-disabled-video-output"></a><span data-ttu-id="46ae1-241">Gestione di un output video disabilitato</span><span class="sxs-lookup"><span data-stu-id="46ae1-241">Handling a Disabled Video Output</span></span>

<span data-ttu-id="46ae1-242">Un output video potrebbe disabilitare se stesso in qualsiasi momento per impedire l'uso non autorizzato del contenuto video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-242">A video output might disable itself at any time to prevent the unauthorized use of video content.</span></span> <span data-ttu-id="46ae1-243">Questo problema può verificarsi perché un meccanismo di protezione smette di funzionare, perché il driver rileva la manomissione o perché la visualizzazione è stata disconnessa dal connettore fisico.</span><span class="sxs-lookup"><span data-stu-id="46ae1-243">This might occur because a protection mechanism stops working, because the driver detects tampering, or because the display was disconnected from the physical connector.</span></span> <span data-ttu-id="46ae1-244">Mentre un output video è disabilitato, non viene visualizzato alcun fotogramma video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-244">While a video output is disabled, no video frames are displayed.</span></span>

<span data-ttu-id="46ae1-245">Quando la protezione del contenuto è abilitata, un'applicazione deve essere periodicamente (almeno una volta ogni 2 secondi) per eseguire i passaggi seguenti.</span><span class="sxs-lookup"><span data-stu-id="46ae1-245">While content protection is enabled, an application should periodically (at least once every 2 seconds) perform the following steps.</span></span>

1.  <span data-ttu-id="46ae1-246">Chiamare [**IOPMVideoOutput:: GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) per inviare la richiesta di stato del livello di [**\_ \_ protezione effettivo per il \_ \_ livello di protezione**](opm-get-actual-protection-level.md) o dell' [**OPM \_ get \_ virtual \_ Protection \_**](opm-get-virtual-protection-level.md) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-246">Call [**IOPMVideoOutput::GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) to send either the [**OPM\_GET\_ACTUAL\_PROTECTION\_LEVEL**](opm-get-actual-protection-level.md) or [**OPM\_GET\_VIRTUAL\_PROTECTION\_LEVEL**](opm-get-virtual-protection-level.md) status request.</span></span> <span data-ttu-id="46ae1-247">I dati restituiti per entrambi i comandi sono una struttura di [**\_ \_ informazioni standard di OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-247">The return data for both commands is an [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure.</span></span>
2.  <span data-ttu-id="46ae1-248">Verificare il membro **ulInformation** della struttura [**di \_ \_ informazioni standard di OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-248">Check the **ulInformation** member of the [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure.</span></span> <span data-ttu-id="46ae1-249">Questo membro contiene un flag che indica se la protezione del contenuto è ancora abilitata.</span><span class="sxs-lookup"><span data-stu-id="46ae1-249">This member contains a flag indicating whether content protection is still enabled.</span></span> <span data-ttu-id="46ae1-250">Se la protezione del contenuto è disattivata, interrompere immediatamente la riproduzione del video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-250">If content protection is off, stop playing the video immediately.</span></span>
3.  <span data-ttu-id="46ae1-251">Se la protezione del contenuto è attiva, controllare il membro **ulStatusFlags** della struttura di [**\_ \_ informazioni standard di OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-251">If content protection is on, check the **ulStatusFlags** member of the [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure.</span></span> <span data-ttu-id="46ae1-252">Se non è impostato alcun flag, l'output del video funziona correttamente.</span><span class="sxs-lookup"><span data-stu-id="46ae1-252">If no flags are set, the video output is working correctly.</span></span> <span data-ttu-id="46ae1-253">In caso contrario, l'output del video è disabilitato.</span><span class="sxs-lookup"><span data-stu-id="46ae1-253">Otherwise, the video output is disabled.</span></span>

<span data-ttu-id="46ae1-254">I flag seguenti sono definiti per **ulStatusFlags**.</span><span class="sxs-lookup"><span data-stu-id="46ae1-254">The following flags are defined for **ulStatusFlags**.</span></span>



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th><span data-ttu-id="46ae1-255">Flag</span><span class="sxs-lookup"><span data-stu-id="46ae1-255">Flag</span></span></th>
<th><span data-ttu-id="46ae1-256">Descrizione</span><span class="sxs-lookup"><span data-stu-id="46ae1-256">Description</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span data-ttu-id="46ae1-257"><strong>OPM_STATUS_LINK_LOST</strong></span><span class="sxs-lookup"><span data-stu-id="46ae1-257"><strong>OPM_STATUS_LINK_LOST</strong></span></span></td>
<td><span data-ttu-id="46ae1-258">La protezione dell'output ha smesso di funzionare per qualche motivo; ad esempio, il dispositivo di visualizzazione potrebbe essere scollegato da conntector.</span><span class="sxs-lookup"><span data-stu-id="46ae1-258">Output protection stopped working for some reason; for example, the display device might be unplugged from the conntector.</span></span> <span data-ttu-id="46ae1-259">Arrestare la riproduzione e disattivare tutti i meccanismi di protezione dell'output.</span><span class="sxs-lookup"><span data-stu-id="46ae1-259">Stop playback and turn off all output protection mechanisms.</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="46ae1-260"><strong>OPM_STATUS_RENEGOTIATION_REQUIRED</strong></span><span class="sxs-lookup"><span data-stu-id="46ae1-260"><strong>OPM_STATUS_RENEGOTIATION_REQUIRED</strong></span></span></td>
<td><span data-ttu-id="46ae1-261">L'applicazione deve ristabilire la sessione di OPM.</span><span class="sxs-lookup"><span data-stu-id="46ae1-261">The application must reestablish the OPM session.</span></span> <span data-ttu-id="46ae1-262">Rispondere come segue:</span><span class="sxs-lookup"><span data-stu-id="46ae1-262">Respond as follows:</span></span>
<ol>
<li><span data-ttu-id="46ae1-263">Arresta la riproduzione.</span><span class="sxs-lookup"><span data-stu-id="46ae1-263">Stop playback.</span></span></li>
<li><span data-ttu-id="46ae1-264">Disattivare tutti i meccanismi di protezione.</span><span class="sxs-lookup"><span data-stu-id="46ae1-264">Turn off all protection mechanisms.</span></span></li>
<li><span data-ttu-id="46ae1-265">Rilasciare l'interfaccia <a href="/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput"><strong>IOPMVideoOutput</strong></a> .</span><span class="sxs-lookup"><span data-stu-id="46ae1-265">Release the <a href="/windows/desktop/api/opmapi/nn-opmapi-iopmvideooutput"><strong>IOPMVideoOutput</strong></a> interface.</span></span></li>
<li><span data-ttu-id="46ae1-266">Ricreare tutte le superfici video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-266">Recreate all video surfaces.</span></span></li>
<li><span data-ttu-id="46ae1-267">Creare un nuovo oggetto OPM e tentare di ristabilire la protezione del contenuto.</span><span class="sxs-lookup"><span data-stu-id="46ae1-267">Create a new OPM object and attempt to reestablish content protection.</span></span> <span data-ttu-id="46ae1-268">Se l'operazione non riesce, visualizzare un messaggio di errore all'utente.</span><span class="sxs-lookup"><span data-stu-id="46ae1-268">If this fails, display an error message to the user.</span></span> <span data-ttu-id="46ae1-269">Non riprodurre altri contenuti video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-269">Do not play any more video content.</span></span></li>
</ol></td>
</tr>
<tr class="odd">
<td><span data-ttu-id="46ae1-270"><strong>OPM_STATUS_REVOKED_HDCP_DEVICE_ATTACHED</strong></span><span class="sxs-lookup"><span data-stu-id="46ae1-270"><strong>OPM_STATUS_REVOKED_HDCP_DEVICE_ATTACHED</strong></span></span></td>
<td><span data-ttu-id="46ae1-271">Questo flag si applica solo quando si usa HDCP e indica la presenza di un dispositivo HDCP revocato.</span><span class="sxs-lookup"><span data-stu-id="46ae1-271">This flag applies only when HDCP is used, and indicates the presence of a revoked HDCP device.</span></span> <span data-ttu-id="46ae1-272">Arrestare la riproduzione e disattivare tutti i meccanismi di protezione nell'output del video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-272">Stop playback and turn off all protection mechanisms on this video output.</span></span> <span data-ttu-id="46ae1-273">Quando questo flag è impostato, viene impostato anche il flag <strong>OPM_STATUS_LINK_LOST</strong> .</span><span class="sxs-lookup"><span data-stu-id="46ae1-273">When this flag is set, the <strong>OPM_STATUS_LINK_LOST</strong> flag is also set.</span></span></td>
</tr>
<tr class="even">
<td><span data-ttu-id="46ae1-274"><strong>OPM_STATUS_REVOKED_HDCP_DEVICE_ATTACHED</strong></span><span class="sxs-lookup"><span data-stu-id="46ae1-274"><strong>OPM_STATUS_REVOKED_HDCP_DEVICE_ATTACHED</strong></span></span></td>
<td><span data-ttu-id="46ae1-275">Il driver ha rilevato manomissioni.</span><span class="sxs-lookup"><span data-stu-id="46ae1-275">The driver has detected tampering.</span></span> <span data-ttu-id="46ae1-276">Arrestare la riproduzione e non riprodurre più video usando questo output video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-276">Stop playback, and do not play any more video using this video output.</span></span> <span data-ttu-id="46ae1-277">È anche consigliabile interrompere l'uso di altri output video, perché il sistema potrebbe essere compromesso.</span><span class="sxs-lookup"><span data-stu-id="46ae1-277">It is also a good idea to stop using any other video outputs, because the system might be compromised.</span></span></td>
</tr>
</tbody>
</table>



 

## <a name="using-hdcp-to-protect-content"></a><span data-ttu-id="46ae1-278">Uso di HDCP per proteggere il contenuto</span><span class="sxs-lookup"><span data-stu-id="46ae1-278">Using HDCP to Protect Content</span></span>

<span data-ttu-id="46ae1-279">Questa sezione descrive come abilitare la protezione dell'output HDCP con OPM.</span><span class="sxs-lookup"><span data-stu-id="46ae1-279">This section describes how to enable HDCP output protection using OPM.</span></span> <span data-ttu-id="46ae1-280">Ecco una descrizione generale dei passaggi che devono essere eseguiti dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="46ae1-280">Here is a general outline of the steps the application must take.</span></span> <span data-ttu-id="46ae1-281">I dettagli sono forniti più avanti in questa sezione.</span><span class="sxs-lookup"><span data-stu-id="46ae1-281">Details are given later in this section.</span></span>

1.  <span data-ttu-id="46ae1-282">L'applicazione potrebbe dover fornire un SRM all'output del video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-282">The application might have to provide an SRM to the video output.</span></span> <span data-ttu-id="46ae1-283">Il meccanismo per la ricezione di SRM non rientra nell'ambito dell'interfaccia OPM.</span><span class="sxs-lookup"><span data-stu-id="46ae1-283">The mechanism for receiving SRMs is outside the scope of the OPM interface.</span></span> <span data-ttu-id="46ae1-284">Ad esempio, SRM potrebbe essere recapitato come parte di un flusso di broadcast.</span><span class="sxs-lookup"><span data-stu-id="46ae1-284">For example, SRMs might be delivered as part of a broadcast stream.</span></span>
2.  <span data-ttu-id="46ae1-285">L'applicazione Abilita la protezione dell'output HDCP.</span><span class="sxs-lookup"><span data-stu-id="46ae1-285">The application enables HDCP output protection.</span></span>
3.  <span data-ttu-id="46ae1-286">L'applicazione riproduce il contenuto video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-286">The application plays the video content.</span></span> <span data-ttu-id="46ae1-287">Periodicamente, l'applicazione esegue il polling del driver per verificare che HDCP sia attiva.</span><span class="sxs-lookup"><span data-stu-id="46ae1-287">Periodically, the application polls the driver to make sure HDCP is on.</span></span>
4.  <span data-ttu-id="46ae1-288">Al termine della riproduzione, l'applicazione disattiva HDCP.</span><span class="sxs-lookup"><span data-stu-id="46ae1-288">When playback is complete, the application turns off HDCP.</span></span>

### <a name="setting-the-srm"></a><span data-ttu-id="46ae1-289">Impostazione di SRM</span><span class="sxs-lookup"><span data-stu-id="46ae1-289">Setting the SRM</span></span>

<span data-ttu-id="46ae1-290">Per impostare SRM, seguire questa procedura.</span><span class="sxs-lookup"><span data-stu-id="46ae1-290">To set the SRM, perform the following steps.</span></span>

1.  <span data-ttu-id="46ae1-291">Inizializzare una struttura di [**\_ parametri del set di configurazione \_ HDCP \_ SRM \_**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_hdcp_srm_parameters) con il numero di versione SRM.</span><span class="sxs-lookup"><span data-stu-id="46ae1-291">Initialize an [**OPM\_SET\_HDCP\_SRM\_PARAMETERS**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_hdcp_srm_parameters) structure with the SRM version number.</span></span>
2.  <span data-ttu-id="46ae1-292">Archiviare SRM in una variabile.</span><span class="sxs-lookup"><span data-stu-id="46ae1-292">Store the SRM in a variable.</span></span>
3.  <span data-ttu-id="46ae1-293">Inviare un comando [**OPM \_ set \_ HDCP \_ SRM**](opm-set-hdcp-srm.md) all'output del video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-293">Send an [**OPM\_SET\_HDCP\_SRM**](opm-set-hdcp-srm.md) command to the video output.</span></span> <span data-ttu-id="46ae1-294">Usare la procedura descritta in [invio dei comandi di OPM](#sending-opm-commands).</span><span class="sxs-lookup"><span data-stu-id="46ae1-294">Use the procedure described in [Sending OPM Commands](#sending-opm-commands).</span></span>
    -   <span data-ttu-id="46ae1-295">Il membro **abParameters** della struttura di [**configurazione dei \_ \_ parametri di OPM**](/windows/desktop/api/opmapi/ns-opmapi-opm_configure_parameters) contiene la struttura dei [**parametri di OPM \_ set \_ HDCP \_ MSR \_**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_hdcp_srm_parameters) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-295">The **abParameters** member of the [**OPM\_CONFIGURE\_PARAMETERS**](/windows/desktop/api/opmapi/ns-opmapi-opm_configure_parameters) structure contains the [**OPM\_SET\_HDCP\_SRM\_PARAMETERS**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_hdcp_srm_parameters) structure.</span></span>
    -   <span data-ttu-id="46ae1-296">Il parametro *pbAdditionalParameters* del metodo [**IOPMVideoOutput:: Configure**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-configure) punta alla variabile che contiene SRM.</span><span class="sxs-lookup"><span data-stu-id="46ae1-296">The *pbAdditionalParameters* parameter of the [**IOPMVideoOutput::Configure**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-configure) method points to the variable that contains the SRM.</span></span>
4.  <span data-ttu-id="46ae1-297">Inviare una richiesta di stato della versione di un OPM per la [**\_ \_ \_ \_ \_ versione SRM corrente**](opm-get-current-hdcp-srm-version.md) all'output del video.</span><span class="sxs-lookup"><span data-stu-id="46ae1-297">Send an [**OPM\_GET\_CURRENT\_HDCP\_SRM\_VERSION**](opm-get-current-hdcp-srm-version.md) status request to the video output.</span></span> <span data-ttu-id="46ae1-298">Usare la procedura descritta in [invio di richieste di stato di OPM](#sending-opm-status-requests).</span><span class="sxs-lookup"><span data-stu-id="46ae1-298">Use the procedure described in [Sending OPM Status Requests](#sending-opm-status-requests).</span></span> <span data-ttu-id="46ae1-299">Questa richiesta di stato non contiene dati di input, quindi il contenuto del membro **abParameters** della struttura del [**\_ parametro OPM Get \_ info \_**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) non è definito.</span><span class="sxs-lookup"><span data-stu-id="46ae1-299">This status request has no input data, so the contents of the **abParameters** member of the [**OPM\_GET\_INFO\_PARAMETERS**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) structure are undefined.</span></span>
5.  <span data-ttu-id="46ae1-300">Quando il metodo [**IOPMVideoOutput:: GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) restituisce, la matrice **abRequestedInformation** nella struttura [**di \_ \_ informazioni richiesta da OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) contiene una struttura di [**\_ \_ informazioni standard OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-300">When the [**IOPMVideoOutput::GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) method returns, the **abRequestedInformation** array in the [**OPM\_REQUESTED\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) structure contains an [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure.</span></span> <span data-ttu-id="46ae1-301">Il membro **ulInformation** della struttura contiene il numero di versione dell'SRM corrente.</span><span class="sxs-lookup"><span data-stu-id="46ae1-301">The **ulInformation** member of this structure contains the version number of the current SRM.</span></span> <span data-ttu-id="46ae1-302">Questo valore deve essere uguale al valore del passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="46ae1-302">This value must equal the value from step 2.</span></span>

### <a name="enabling-hdcp"></a><span data-ttu-id="46ae1-303">Abilitazione di HDCP</span><span class="sxs-lookup"><span data-stu-id="46ae1-303">Enabling HDCP</span></span>

<span data-ttu-id="46ae1-304">Per abilitare HDCP, seguire questa procedura.</span><span class="sxs-lookup"><span data-stu-id="46ae1-304">To enable HDCP, perform the following steps.</span></span>

1.  <span data-ttu-id="46ae1-305">Inizializzare una struttura di [**\_ parametri del \_ \_ livello \_ di protezione set di OPM**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_protection_level_parameters) con i valori seguenti:</span><span class="sxs-lookup"><span data-stu-id="46ae1-305">Initialize an [**OPM\_SET\_PROTECTION\_LEVEL\_PARAMETERS**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_protection_level_parameters) structure with the following values:</span></span>
    -   <span data-ttu-id="46ae1-306">**ulProtectionType**  =  **OPM \_ tipo di protezione \_ \_ HDCP**</span><span class="sxs-lookup"><span data-stu-id="46ae1-306">**ulProtectionType** = **OPM\_PROTECTION\_TYPE\_HDCP**</span></span>
    -   <span data-ttu-id="46ae1-307">**ulProtectionLevel**  =  **OPM \_ HDCP \_ su**</span><span class="sxs-lookup"><span data-stu-id="46ae1-307">**ulProtectionLevel** = **OPM\_HDCP\_ON**</span></span>
    -   <span data-ttu-id="46ae1-308">**Riservato** = 0</span><span class="sxs-lookup"><span data-stu-id="46ae1-308">**Reserved** = 0</span></span>
    -   <span data-ttu-id="46ae1-309">**Reserved2** = 0</span><span class="sxs-lookup"><span data-stu-id="46ae1-309">**Reserved2** = 0</span></span>
2.  <span data-ttu-id="46ae1-310">Inviare un comando per il [**\_ \_ \_ livello di protezione set di OPM**](opm-set-protection-level.md) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-310">Send an [**OPM\_SET\_PROTECTION\_LEVEL**](opm-set-protection-level.md) command.</span></span> <span data-ttu-id="46ae1-311">I dati di input nella matrice **abParameters** sono la struttura dei parametri del livello di protezione del set di [**OPM \_ \_ \_ \_**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_protection_level_parameters) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-311">The input data in the **abParameters** array is the [**OPM\_SET\_PROTECTION\_LEVEL\_PARAMETERS**](/windows/desktop/api/opmapi/ns-opmapi-opm_set_protection_level_parameters) structure.</span></span>
3.  <span data-ttu-id="46ae1-312">Inviare una richiesta di stato del [**\_ \_ \_ \_ livello di protezione virtuale OPM**](opm-get-virtual-protection-level.md) per verificare se la funzionalità HDCP è abilitata.</span><span class="sxs-lookup"><span data-stu-id="46ae1-312">Send an [**OPM\_GET\_VIRTUAL\_PROTECTION\_LEVEL**](opm-get-virtual-protection-level.md) status request to check whether HDCP is enabled.</span></span> <span data-ttu-id="46ae1-313">I primi 4 byte del membro **abParameters** della struttura del [**\_ \_ \_ parametro OPM Get Info**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) contengono il valore di **protezione OPM del \_ tipo di protezione \_ \_ HDCP**.</span><span class="sxs-lookup"><span data-stu-id="46ae1-313">The first 4 bytes of the **abParameters** member of the [**OPM\_GET\_INFO\_PARAMETERS**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_get_info_parameters) structure contain the value **OPM\_PROTECTION\_TYPE\_HDCP**.</span></span>

<span data-ttu-id="46ae1-314">Quando il metodo [**GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) restituisce, la matrice **abRequestedInformation** nella struttura [**di \_ \_ informazioni richiesta da OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) contiene una struttura di [**\_ \_ informazioni standard OPM**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-314">When the [**GetInformation**](/windows/desktop/api/opmapi/nf-opmapi-iopmvideooutput-getinformation) method returns, the **abRequestedInformation** array in the [**OPM\_REQUESTED\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_requested_information) structure contains an [**OPM\_STANDARD\_INFORMATION**](/windows/desktop/api/ksopmapi/ns-ksopmapi-opm_standard_information) structure.</span></span> <span data-ttu-id="46ae1-315">Il membro **ulInformation** di questa struttura contiene un valore dell'enumerazione [**del \_ \_ \_ livello di protezione di OPM HDCP**](/windows/desktop/api/opmapi/ne-opmapi-opm_hdcp_protection_level) .</span><span class="sxs-lookup"><span data-stu-id="46ae1-315">The **ulInformation** member of this structure contains a value from the [**OPM\_HDCP\_PROTECTION\_LEVEL**](/windows/desktop/api/opmapi/ne-opmapi-opm_hdcp_protection_level) enumeration.</span></span> <span data-ttu-id="46ae1-316">Se il valore è uguale **\_ a OPM HDCP \_ on**, significa che è abilitato HDCP.</span><span class="sxs-lookup"><span data-stu-id="46ae1-316">If the value equals **OPM\_HDCP\_ON**, it means HDCP is enabled.</span></span> <span data-ttu-id="46ae1-317">In caso contrario, ripetere i passaggi da 1 a 2 fino a quando non viene abilitato HDCP o si verifica un errore.</span><span class="sxs-lookup"><span data-stu-id="46ae1-317">Otherwise, repeat steps 1–2 until HDCP is enabled, or an error occurs.</span></span> <span data-ttu-id="46ae1-318">(Ricordare di incrementare il numero di sequenza e generare ogni volta un nuovo numero casuale).</span><span class="sxs-lookup"><span data-stu-id="46ae1-318">(Remember to increment the sequence number and generate a new random number each time.)</span></span>

<span data-ttu-id="46ae1-319">Per abilitare HDCP, in genere è necessario un numero di millisecondi compreso tra 100 e 200, ma l'esecuzione potrebbe richiedere più tempo.</span><span class="sxs-lookup"><span data-stu-id="46ae1-319">It usually takes between 100 and 200 milliseconds to enable HDCP, but it can take longer.</span></span> <span data-ttu-id="46ae1-320">Non presupporre che la funzionalità HDCP sia abilitata fino a quando non è stata verificata.</span><span class="sxs-lookup"><span data-stu-id="46ae1-320">Do not assume that HDCP is enabled until you have verified it.</span></span>

<span data-ttu-id="46ae1-321">Quando l'applicazione termina la riproduzione di contenuto protetto, disattivare HDCP.</span><span class="sxs-lookup"><span data-stu-id="46ae1-321">When the application finishes playing protected content, turn off HDCP.</span></span> <span data-ttu-id="46ae1-322">I passaggi sono identici a quelli per l'abilitazione di HDCP, ma nel passaggio 1, impostare **ulProtectionLevel** su **OPM \_ HDCP \_ disattivato**.</span><span class="sxs-lookup"><span data-stu-id="46ae1-322">The steps are the same as for enabling HDCP, but in step 1, set **ulProtectionLevel** to **OPM\_HDCP\_OFF**.</span></span>

> [!Note]  
> <span data-ttu-id="46ae1-323">Non abilitare HDCP se il tipo di connettore è **il \_ connettore OPM \_ tipo \_ DisplayPort \_ Embedded**.</span><span class="sxs-lookup"><span data-stu-id="46ae1-323">Do not enable HDCP if the connector type is **OPM\_CONNECTOR\_TYPE\_DISPLAYPORT\_EMBEDDED**.</span></span> <span data-ttu-id="46ae1-324">(Vedere i [**flag di tipo del connettore OPM**](opm-connector-type-flags.md).)</span><span class="sxs-lookup"><span data-stu-id="46ae1-324">(See [**OPM Connector Type Flags**](opm-connector-type-flags.md).)</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="46ae1-325">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="46ae1-325">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="46ae1-326">Gestione protezione output</span><span class="sxs-lookup"><span data-stu-id="46ae1-326">Output Protection Manager</span></span>](output-protection-manager.md)
</dt> </dl>

 

 



