---
description: In questo argomento viene descritto come utilizzare le code di lavoro in Microsoft Media Foundation.
ms.assetid: 6be05df7-e8ff-4110-8f73-a62eb31fd414
title: Uso delle code di lavoro
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2d7bb41b830742ca871d44cadac9bd26a9967aa1
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104226497"
---
# <a name="using-work-queues"></a><span data-ttu-id="7e7e2-103">Uso delle code di lavoro</span><span class="sxs-lookup"><span data-stu-id="7e7e2-103">Using Work Queues</span></span>

<span data-ttu-id="7e7e2-104">In questo argomento viene descritto come utilizzare le code di lavoro in Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-104">This topic describes how to use work queues in Microsoft Media Foundation.</span></span>

-   [<span data-ttu-id="7e7e2-105">Uso delle code di lavoro</span><span class="sxs-lookup"><span data-stu-id="7e7e2-105">Using Work Queues</span></span>](#using-work-queues)
-   [<span data-ttu-id="7e7e2-106">Chiusura di code di lavoro</span><span class="sxs-lookup"><span data-stu-id="7e7e2-106">Shutting Down Work Queues</span></span>](#shutting-down-work-queues)
-   [<span data-ttu-id="7e7e2-107">Uso degli elementi di lavoro pianificati</span><span class="sxs-lookup"><span data-stu-id="7e7e2-107">Using Scheduled Work Items</span></span>](#using-scheduled-work-items)
-   [<span data-ttu-id="7e7e2-108">Uso di callback periodici</span><span class="sxs-lookup"><span data-stu-id="7e7e2-108">Using Periodic Callbacks</span></span>](#using-periodic-callbacks)
-   [<span data-ttu-id="7e7e2-109">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="7e7e2-109">Related topics</span></span>](#related-topics)

## <a name="using-work-queues"></a><span data-ttu-id="7e7e2-110">Uso delle code di lavoro</span><span class="sxs-lookup"><span data-stu-id="7e7e2-110">Using Work Queues</span></span>

<span data-ttu-id="7e7e2-111">Una coda di lavoro è un modo efficiente per eseguire operazioni asincrone su un altro thread.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-111">A work queue is an efficient way to perform asynchronous operations on another thread.</span></span> <span data-ttu-id="7e7e2-112">Concettualmente, si inseriscono elementi di lavoro nella coda e la coda include un thread che estrae ogni elemento dalla coda e lo invia.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-112">Conceptually, you put work items in the queue, and the queue has a thread that pulls each item from the queue and dispatches it.</span></span> <span data-ttu-id="7e7e2-113">Gli elementi di lavoro vengono implementati come callback tramite l'interfaccia [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) .</span><span class="sxs-lookup"><span data-stu-id="7e7e2-113">Work items are implemented as callbacks by using the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface.</span></span>

<span data-ttu-id="7e7e2-114">Media Foundation crea diverse code di lavoro standard, denominate *code di lavoro della piattaforma*.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-114">Media Foundation creates several standard work queues, called *platform work queues*.</span></span> <span data-ttu-id="7e7e2-115">Le applicazioni possono inoltre creare le proprie code di lavoro, denominate *code di lavoro private*.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-115">Applications can also create their own work queues, called *private work queues*.</span></span> <span data-ttu-id="7e7e2-116">Per un elenco delle code di lavoro della piattaforma, vedere [identificatori della coda di lavoro](work-queue-identifiers.md).</span><span class="sxs-lookup"><span data-stu-id="7e7e2-116">For a list of the platform work queues, see [Work Queue Identifiers](work-queue-identifiers.md).</span></span> <span data-ttu-id="7e7e2-117">Per creare una coda di lavoro privata, chiamare [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue).</span><span class="sxs-lookup"><span data-stu-id="7e7e2-117">To create a private work queue, call [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue).</span></span> <span data-ttu-id="7e7e2-118">Questa funzione restituisce un identificatore per la nuova coda di lavoro.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-118">This function returns an identifier for the new work queue.</span></span> <span data-ttu-id="7e7e2-119">Per inserire un elemento nella coda, chiamare [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) o [**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex).</span><span class="sxs-lookup"><span data-stu-id="7e7e2-119">To put an item in the queue, call [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) or [**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex).</span></span> <span data-ttu-id="7e7e2-120">In entrambi i casi, è necessario specificare un'interfaccia di callback.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-120">In both cases, you must specify a callback interface.</span></span>

-   <span data-ttu-id="7e7e2-121">[**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) accetta un puntatore all'interfaccia [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) , oltre a un oggetto di stato facoltativo che implementa **IUnknown**.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-121">[**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) takes a pointer to the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface, plus an optional state object that implements **IUnknown**.</span></span> <span data-ttu-id="7e7e2-122">Si tratta degli stessi parametri usati nei metodi asincroni, come descritto nell'argomento [metodi di callback asincroni](asynchronous-callback-methods.md).</span><span class="sxs-lookup"><span data-stu-id="7e7e2-122">These are the same parameters used in asynchronous methods, as described in the topic [Asynchronous Callback Methods](asynchronous-callback-methods.md).</span></span> <span data-ttu-id="7e7e2-123">Internamente, questa funzione crea un oggetto risultato asincrono, che viene passato al metodo [**Invoke**](/windows/desktop/api/mfobjects/nf-mfobjects-imfasynccallback-invoke) del callback.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-123">Internally, this function creates an asynchronous result object, which is passed to the callback's [**Invoke**](/windows/desktop/api/mfobjects/nf-mfobjects-imfasynccallback-invoke) method.</span></span>
-   <span data-ttu-id="7e7e2-124">[**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex) accetta un puntatore all'interfaccia [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) .</span><span class="sxs-lookup"><span data-stu-id="7e7e2-124">[**MFPutWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitemex) takes a pointer to the [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) interface.</span></span> <span data-ttu-id="7e7e2-125">Questa interfaccia rappresenta un oggetto risultato asincrono.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-125">This interface represents an asynchronous result object.</span></span> <span data-ttu-id="7e7e2-126">Creare questo oggetto chiamando [**MFCreateAsyncResult**](/windows/desktop/api/mfapi/nf-mfapi-mfcreateasyncresult) e specificando l'interfaccia di callback e, facoltativamente, un oggetto di stato.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-126">Create this object by calling [**MFCreateAsyncResult**](/windows/desktop/api/mfapi/nf-mfapi-mfcreateasyncresult) and specifying your callback interface and, optionally, a state object.</span></span>

<span data-ttu-id="7e7e2-127">In entrambi i casi, il thread della coda di lavoro chiama il metodo [**IMFAsyncCallback:: Invoke**](/windows/desktop/api/mfobjects/nf-mfobjects-imfasynccallback-invoke) .</span><span class="sxs-lookup"><span data-stu-id="7e7e2-127">In both cases, the work queue thread calls your [**IMFAsyncCallback::Invoke**](/windows/desktop/api/mfobjects/nf-mfobjects-imfasynccallback-invoke) method.</span></span> <span data-ttu-id="7e7e2-128">Usare il metodo **Invoke** per eseguire l'elemento di lavoro.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-128">Use the **Invoke** method to perform the work item.</span></span>

<span data-ttu-id="7e7e2-129">Se più di un thread o un componente condivide la stessa coda di lavoro, è possibile chiamare [**MFLockWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mflockworkqueue) per bloccare la coda di lavoro, evitando così di rilasciare la piattaforma.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-129">If more than one thread or component shares the same work queue, you can call [**MFLockWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mflockworkqueue) to lock the work queue, which prevents the platform from releasing it.</span></span> <span data-ttu-id="7e7e2-130">Per ogni chiamata a [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue) o **MFLockWorkQueue**, è necessario chiamare [**MFUnlockWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockworkqueue) una volta per rilasciare la coda di lavoro.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-130">For each call to [**MFAllocateWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfallocateworkqueue) or **MFLockWorkQueue**, you must call [**MFUnlockWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockworkqueue) once to release the work queue.</span></span> <span data-ttu-id="7e7e2-131">Se, ad esempio, si crea una nuova coda di lavoro e la si blocca una sola volta, è necessario chiamare **MFUnlockWorkQueue** due volte, una per la chiamata a **MFAllocateWorkQueue** e una per la chiamata a **MFLockWorkQueue**.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-131">For example, if you create a new work queue and then lock it once, you must call **MFUnlockWorkQueue** twice, once for the call to **MFAllocateWorkQueue** and once for the call to **MFLockWorkQueue**.</span></span>

<span data-ttu-id="7e7e2-132">Il codice seguente illustra come creare una nuova coda di lavoro, inserire un elemento di lavoro nella coda e rilasciare la coda di lavoro.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-132">The following code shows how to create a new work queue, put a work item in the queue, and release the work queue.</span></span>

<span data-ttu-id="7e7e2-133">Per ulteriori informazioni sulle code di lavoro in Windows 8, vedere [miglioramenti della coda di lavoro e del threading](media-foundation-work-queue-and-threading-improvements.md) .</span><span class="sxs-lookup"><span data-stu-id="7e7e2-133">See [Work Queue and Threading Improvements](media-foundation-work-queue-and-threading-improvements.md) for additional information on work queues in Windows 8.</span></span>


```C++
DWORD idWorkQueue = 0;
HRESULT hr = S_OK;

// Create a new work queue.
hr = MFAllocateWorkQueue(&idWorkQueue);

// Put an item on the queue.
if (SUCCEEDED(hr))
{
    hr = MFPutWorkItem(idWorkQueue, pCallback, NULL);
}

// Wait for the callback to be invoked.
if (SUCCEEDED(hr))
{
    WaitForSingleObject(hEvent, INFINITE);
}

// Release the work queue.
if (SUCCEEDED(hr))
{
    hr = MFUnlockWorkQueue(idWorkQueue);
}
```



<span data-ttu-id="7e7e2-134">Questo esempio si basa sul presupposto che *pCallback* sia un puntatore all'interfaccia [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-134">This example assumes that *pCallback* is a pointer to the application's [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface.</span></span> <span data-ttu-id="7e7e2-135">Si presuppone inoltre che il callback imposti l'handle dell'evento *hEvent* .</span><span class="sxs-lookup"><span data-stu-id="7e7e2-135">It also assumes that the callback sets the *hEvent* event handle.</span></span> <span data-ttu-id="7e7e2-136">Il codice attende che questo evento venga impostato prima di chiamare [**MFUnlockWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockworkqueue).</span><span class="sxs-lookup"><span data-stu-id="7e7e2-136">The code waits for this event to be set before calling [**MFUnlockWorkQueue**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockworkqueue).</span></span>

<span data-ttu-id="7e7e2-137">I thread della coda di lavoro vengono sempre creati nel processo del chiamante.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-137">Work queue threads are always created in the caller's process.</span></span> <span data-ttu-id="7e7e2-138">All'interno di ogni coda di lavoro, vengono serializzati i callback.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-138">Within each work queue, the callbacks are serialized.</span></span> <span data-ttu-id="7e7e2-139">Se si chiama [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) due volte con la stessa coda di lavoro, il secondo callback non viene richiamato fino a quando non viene restituito il primo callback.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-139">If you call [**MFPutWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfputworkitem) twice with the same work queue, the second callback is not invoked until the first callback has returned.</span></span>

## <a name="shutting-down-work-queues"></a><span data-ttu-id="7e7e2-140">Chiusura di code di lavoro</span><span class="sxs-lookup"><span data-stu-id="7e7e2-140">Shutting Down Work Queues</span></span>

<span data-ttu-id="7e7e2-141">Prima di chiamare [**MFShutdown**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown), rilasciare tutte le risorse usate dai thread della coda di lavoro.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-141">Before calling [**MFShutdown**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown), release any resources that are being used by work queue threads.</span></span> <span data-ttu-id="7e7e2-142">Per sincronizzare questo processo, è possibile bloccare la piattaforma Media Foundation, che impedisce la chiusura di tutti i thread della coda di lavoro da parte della funzione **MFShutdown** .</span><span class="sxs-lookup"><span data-stu-id="7e7e2-142">To synchronize this process, you can lock the Media Foundation platform, which prevents the **MFShutdown** function from closing any work queue threads.</span></span> <span data-ttu-id="7e7e2-143">Se **MFShutdown** viene chiamato mentre la piattaforma è bloccata, **MFShutdown** attende alcune centinaia di millisecondi per sbloccare la piattaforma.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-143">If **MFShutdown** is called while the platform is locked, **MFShutdown** waits a few hundred milliseconds for the platform to be unlocked.</span></span> <span data-ttu-id="7e7e2-144">Se non viene sbloccato entro questo intervallo di tempo, **MFShutdown** chiude i thread della coda di lavoro.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-144">If it is not unlocked within that time, **MFShutdown** closes the work queue threads.</span></span>

<span data-ttu-id="7e7e2-145">L'implementazione predefinita di [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) blocca automaticamente la piattaforma Media Foundation quando viene creato l'oggetto risultato.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-145">The default implementation of [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) automatically locks the Media Foundation platform when the result object is created.</span></span> <span data-ttu-id="7e7e2-146">Il rilascio dell'interfaccia Sblocca la piattaforma.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-146">Releasing the interface unlocks the platform.</span></span> <span data-ttu-id="7e7e2-147">Pertanto, non sarà mai necessario bloccare direttamente la piattaforma.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-147">Therefore, you will almost never need to lock the platform directly.</span></span> <span data-ttu-id="7e7e2-148">Tuttavia, se si scrive un'implementazione personalizzata di **IMFAsyncResult**, è necessario bloccare e sbloccare manualmente la piattaforma.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-148">But if you write your own custom implementation of **IMFAsyncResult**, then you should manually lock and unlock the platform.</span></span> <span data-ttu-id="7e7e2-149">Per bloccare la piattaforma, chiamare [**MFLockPlatform**](/windows/desktop/api/mfapi/nf-mfapi-mflockplatform).</span><span class="sxs-lookup"><span data-stu-id="7e7e2-149">To lock the platform, call [**MFLockPlatform**](/windows/desktop/api/mfapi/nf-mfapi-mflockplatform).</span></span> <span data-ttu-id="7e7e2-150">Per sbloccare la piattaforma, chiamare [**MFUnlockPlatform**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockplatform).</span><span class="sxs-lookup"><span data-stu-id="7e7e2-150">To unlock the platform, call [**MFUnlockPlatform**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockplatform).</span></span> <span data-ttu-id="7e7e2-151">Per un esempio, vedere [oggetti risultato asincrono personalizzati](custom-asynchronous-result-objects.md).</span><span class="sxs-lookup"><span data-stu-id="7e7e2-151">For an example, see [Custom Asynchronous Result Objects](custom-asynchronous-result-objects.md).</span></span>

<span data-ttu-id="7e7e2-152">Dopo aver chiamato [**MFShutdown**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown), è necessario assicurarsi che la piattaforma venga sbloccata entro il periodo di timeout di 5 secondi.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-152">After you call [**MFShutdown**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown), you need to ensure that the platform is unlocked within the 5-second time-out period.</span></span> <span data-ttu-id="7e7e2-153">A tale scopo, rilasciare tutti i puntatori [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) e chiamare [**MFUnlockPlatform**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockplatform) se la piattaforma è stata bloccata manualmente.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-153">Do this by releasing all [**IMFAsyncResult**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasyncresult) pointers, and by calling [**MFUnlockPlatform**](/windows/desktop/api/mfapi/nf-mfapi-mfunlockplatform) if you locked the platform manually.</span></span> <span data-ttu-id="7e7e2-154">Assicurarsi di rilasciare tutte le risorse usate dai thread della coda di lavoro oppure se l'applicazione potrebbe perdere memoria.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-154">Make sure to release any resources that are being used by work queue threads, or your application might leak memory.</span></span>

<span data-ttu-id="7e7e2-155">In genere, se l'applicazione viene arrestata e rilascia ogni Media Foundation oggetto prima di chiamare [**MFShutdown**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown), non è necessario preoccuparsi del blocco.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-155">Typically, if your application shuts down and releases every Media Foundation object before calling [**MFShutdown**](/windows/desktop/api/mfapi/nf-mfapi-mfshutdown), you do not have to worry about locking.</span></span> <span data-ttu-id="7e7e2-156">Il meccanismo di blocco consente semplicemente la chiusura normale dei thread della coda di lavoro dopo la chiamata a **MFShutdown**.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-156">The locking mechanism simply allows work queue threads to exit gracefully after you call **MFShutdown**.</span></span>

## <a name="using-scheduled-work-items"></a><span data-ttu-id="7e7e2-157">Uso degli elementi di lavoro pianificati</span><span class="sxs-lookup"><span data-stu-id="7e7e2-157">Using Scheduled Work Items</span></span>

<span data-ttu-id="7e7e2-158">È possibile pianificare un callback in modo che venga eseguito dopo un periodo di tempo stabilito chiamando [**MFScheduleWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitem) o [**MFScheduleWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitemex).</span><span class="sxs-lookup"><span data-stu-id="7e7e2-158">You can schedule a callback to occur after a set period of time by calling [**MFScheduleWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitem) or [**MFScheduleWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitemex).</span></span>

-   <span data-ttu-id="7e7e2-159">[**MFScheduleWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitem) accetta un puntatore al callback, a un oggetto di stato facoltativo e a un intervallo di timeout.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-159">[**MFScheduleWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitem) takes a pointer to your callback, an optional state object, and a time-out interval.</span></span>
-   <span data-ttu-id="7e7e2-160">[**MFScheduleWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitemex) accetta un puntatore a un oggetto risultato asincrono e un valore di timeout.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-160">[**MFScheduleWorkItemEx**](/windows/desktop/api/mfapi/nf-mfapi-mfscheduleworkitemex) takes a pointer to an asynchronous result object and a time-out value.</span></span>

<span data-ttu-id="7e7e2-161">Specificare il timeout come valore negativo in millisecondi.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-161">Specify the time-out as a negative value in milliseconds.</span></span> <span data-ttu-id="7e7e2-162">Ad esempio, per pianificare una richiamata da richiamare in 5 secondi, utilizzare il valore − 5000.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-162">For example, to schedule a callback to be invoked in 5 seconds, use the value −5000.</span></span> <span data-ttu-id="7e7e2-163">Entrambe le funzioni restituiscono un valore di **\_ chiave MFWORKITEM** , che è possibile usare per annullare il callback passandolo alla funzione [**MFCancelWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfcancelworkitem) .</span><span class="sxs-lookup"><span data-stu-id="7e7e2-163">Both functions return an **MFWORKITEM\_KEY** value, which you can use to cancel the callback by passing it to the [**MFCancelWorkItem**](/windows/desktop/api/mfapi/nf-mfapi-mfcancelworkitem) function.</span></span>

<span data-ttu-id="7e7e2-164">Gli elementi di lavoro pianificati utilizzano sempre la \_ \_ coda di lavoro della piattaforma timer della coda di callback MFASYNC \_ .</span><span class="sxs-lookup"><span data-stu-id="7e7e2-164">Scheduled work items always use the MFASYNC\_CALLBACK\_QUEUE\_TIMER platform work queue.</span></span>

## <a name="using-periodic-callbacks"></a><span data-ttu-id="7e7e2-165">Uso di callback periodici</span><span class="sxs-lookup"><span data-stu-id="7e7e2-165">Using Periodic Callbacks</span></span>

<span data-ttu-id="7e7e2-166">La funzione [**MFAddPeriodicCallback**](/windows/desktop/api/mfapi/nf-mfapi-mfaddperiodiccallback) pianifica un callback da richiamare periodicamente finché non viene annullato.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-166">The [**MFAddPeriodicCallback**](/windows/desktop/api/mfapi/nf-mfapi-mfaddperiodiccallback) function schedules a callback to be invoked periodically until you cancel it.</span></span> <span data-ttu-id="7e7e2-167">L'intervallo di callback è fisso. le applicazioni non possono modificarlo.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-167">The callback interval is fixed; applications cannot change it.</span></span> <span data-ttu-id="7e7e2-168">Per individuare l'intervallo esatto, chiamare [**MFGetTimerPeriodicity**](/windows/desktop/api/mfapi/nf-mfapi-mfgettimerperiodicity).</span><span class="sxs-lookup"><span data-stu-id="7e7e2-168">To find out the exact interval, call [**MFGetTimerPeriodicity**](/windows/desktop/api/mfapi/nf-mfapi-mfgettimerperiodicity).</span></span> <span data-ttu-id="7e7e2-169">L'intervallo è nell'ordine di 10 millisecondi, quindi questa funzione è destinata alle situazioni in cui è necessario un "tick" frequente, ad esempio l'implementazione di un clock di presentazione.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-169">The interval is on the order of 10 milliseconds, so this function is meant for situations where you need a frequent "tick," such as implementing a presentation clock.</span></span> <span data-ttu-id="7e7e2-170">Se si desidera pianificare l'esecuzione di un'operazione con una frequenza minore, utilizzare un elemento di lavoro pianificato, come descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-170">If you want to schedule an operation to occur less frequently, use a scheduled work item, as described previously.</span></span>

<span data-ttu-id="7e7e2-171">Diversamente dagli altri callback descritti in questo argomento, il callback periodico non usa l'interfaccia [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) .</span><span class="sxs-lookup"><span data-stu-id="7e7e2-171">Unlike the other callbacks described in this topic, the periodic callback does not use the [**IMFAsyncCallback**](/windows/desktop/api/mfobjects/nn-mfobjects-imfasynccallback) interface.</span></span> <span data-ttu-id="7e7e2-172">USA invece un puntatore a funzione.</span><span class="sxs-lookup"><span data-stu-id="7e7e2-172">Instead, it uses a function pointer.</span></span> <span data-ttu-id="7e7e2-173">Per altre informazioni, vedere [**callback di MFPERIODICCALLBACK**](/windows/win32/api/mfapi/nc-mfapi-mfperiodiccallback).</span><span class="sxs-lookup"><span data-stu-id="7e7e2-173">For more information, see [**MFPERIODICCALLBACK Callback**](/windows/win32/api/mfapi/nc-mfapi-mfperiodiccallback).</span></span>

<span data-ttu-id="7e7e2-174">Per annullare il callback periodico, chiamare [**MFRemovePeriodicCallback**](/windows/desktop/api/mfapi/nf-mfapi-mfremoveperiodiccallback).</span><span class="sxs-lookup"><span data-stu-id="7e7e2-174">To cancel the periodic callback, call [**MFRemovePeriodicCallback**](/windows/desktop/api/mfapi/nf-mfapi-mfremoveperiodiccallback).</span></span>

<span data-ttu-id="7e7e2-175">I callback periodici usano la \_ coda di \_ lavoro della piattaforma timer della coda di callback MFASYNC \_ .</span><span class="sxs-lookup"><span data-stu-id="7e7e2-175">Periodic callbacks use the MFASYNC\_CALLBACK\_QUEUE\_TIMER platform work queue.</span></span>

## <a name="related-topics"></a><span data-ttu-id="7e7e2-176">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="7e7e2-176">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="7e7e2-177">Code di lavoro</span><span class="sxs-lookup"><span data-stu-id="7e7e2-177">Work Queues</span></span>](work-queues.md)
</dt> <dt>

[<span data-ttu-id="7e7e2-178">**MFASYNCRESULT**</span><span class="sxs-lookup"><span data-stu-id="7e7e2-178">**MFASYNCRESULT**</span></span>](/windows/win32/api/mfapi/ns-mfapi-mfasyncresult)
</dt> <dt>

[<span data-ttu-id="7e7e2-179">Miglioramenti della coda di lavoro e del threading</span><span class="sxs-lookup"><span data-stu-id="7e7e2-179">Work Queue and Threading Improvements</span></span>](media-foundation-work-queue-and-threading-improvements.md)
</dt> </dl>

 

 
