---
description: Questo argomento descrive come implementare un'origine multimediale personalizzata in Microsoft Media Foundation.
ms.assetid: 82db6f32-ad94-4563-b8bd-8a5072c5b221
title: Scrittura di un'origine multimediale personalizzata
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8769fa16d4dcbfd3438b66f9a9e78c34274735a5
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/03/2021
ms.locfileid: "106320699"
---
# <a name="writing-a-custom-media-source"></a><span data-ttu-id="03b8c-103">Scrittura di un'origine multimediale personalizzata</span><span class="sxs-lookup"><span data-stu-id="03b8c-103">Writing a Custom Media Source</span></span>

<span data-ttu-id="03b8c-104">Questo argomento descrive come implementare un'origine multimediale personalizzata in Microsoft Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="03b8c-104">This topic describes how to implement a custom media source in Microsoft Media Foundation.</span></span> <span data-ttu-id="03b8c-105">Contiene le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="03b8c-105">It contains the following sections:</span></span>

-   [<span data-ttu-id="03b8c-106">Creazione del descrittore della presentazione</span><span class="sxs-lookup"><span data-stu-id="03b8c-106">Creating the Presentation Descriptor</span></span>](#creating-the-presentation-descriptor)
-   [<span data-ttu-id="03b8c-107">Avvio dell'origine supporto</span><span class="sxs-lookup"><span data-stu-id="03b8c-107">Starting the Media Source</span></span>](#starting-the-media-source)
    -   [<span data-ttu-id="03b8c-108">La ricerca</span><span class="sxs-lookup"><span data-stu-id="03b8c-108">Seeking</span></span>](#seeking)
-   [<span data-ttu-id="03b8c-109">Sospensione dell'origine multimediale</span><span class="sxs-lookup"><span data-stu-id="03b8c-109">Pausing the Media Source</span></span>](#pausing-the-media-source)
-   [<span data-ttu-id="03b8c-110">Generazione dei dati di origine</span><span class="sxs-lookup"><span data-stu-id="03b8c-110">Generating Source Data</span></span>](#generating-source-data)
    -   [<span data-ttu-id="03b8c-111">Richieste di esempio</span><span class="sxs-lookup"><span data-stu-id="03b8c-111">Sample Requests</span></span>](#sample-requests)
    -   [<span data-ttu-id="03b8c-112">Esempi di allocazione</span><span class="sxs-lookup"><span data-stu-id="03b8c-112">Allocating Samples</span></span>](#allocating-samples)
    -   [<span data-ttu-id="03b8c-113">Gap nel flusso</span><span class="sxs-lookup"><span data-stu-id="03b8c-113">Gaps in the Stream</span></span>](#gaps-in-the-stream)
-   [<span data-ttu-id="03b8c-114">Arresto dell'origine supporto</span><span class="sxs-lookup"><span data-stu-id="03b8c-114">Shutting Down the Media Source</span></span>](#shutting-down-the-media-source)
-   [<span data-ttu-id="03b8c-115">Origini attive</span><span class="sxs-lookup"><span data-stu-id="03b8c-115">Live Sources</span></span>](#live-sources)
-   [<span data-ttu-id="03b8c-116">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="03b8c-116">Related topics</span></span>](#related-topics)

## <a name="creating-the-presentation-descriptor"></a><span data-ttu-id="03b8c-117">Creazione del descrittore della presentazione</span><span class="sxs-lookup"><span data-stu-id="03b8c-117">Creating the Presentation Descriptor</span></span>

<span data-ttu-id="03b8c-118">Il metodo [**IMFMediaSource:: CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) restituisce una copia del descrittore di presentazione dell'origine.</span><span class="sxs-lookup"><span data-stu-id="03b8c-118">The [**IMFMediaSource::CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method returns a copy of the source's presentation descriptor.</span></span> <span data-ttu-id="03b8c-119">Per creare il descrittore di presentazione, è necessario conoscerne il numero di flussi nel contenuto di origine e i formati possibili di ogni flusso.</span><span class="sxs-lookup"><span data-stu-id="03b8c-119">To create the presentation descriptor, you must know the number of streams in the source content, and the possible formats of each stream.</span></span> <span data-ttu-id="03b8c-120">Per ogni flusso, creare un descrittore di flusso come segue:</span><span class="sxs-lookup"><span data-stu-id="03b8c-120">For each stream, create a stream descriptor as follows:</span></span>

1.  <span data-ttu-id="03b8c-121">Creare una matrice di tipi di supporto.</span><span class="sxs-lookup"><span data-stu-id="03b8c-121">Create an array of media types.</span></span> <span data-ttu-id="03b8c-122">Ogni tipo di supporto nella matrice rappresenta un possibile formato per il flusso.</span><span class="sxs-lookup"><span data-stu-id="03b8c-122">Each media type in the array represents a possible format for the stream.</span></span> <span data-ttu-id="03b8c-123">Per ulteriori informazioni sulla creazione di tipi di supporto, vedere [tipi di supporti](media-types.md).</span><span class="sxs-lookup"><span data-stu-id="03b8c-123">For more information about creating media types, see [Media Types](media-types.md).</span></span>
2.  <span data-ttu-id="03b8c-124">Chiamare [**MFCreateStreamDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) per creare il descrittore del flusso.</span><span class="sxs-lookup"><span data-stu-id="03b8c-124">Call [**MFCreateStreamDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatestreamdescriptor) to create the stream descriptor.</span></span> <span data-ttu-id="03b8c-125">Passare la matrice dei tipi di supporto.</span><span class="sxs-lookup"><span data-stu-id="03b8c-125">Pass in the array of media types.</span></span> <span data-ttu-id="03b8c-126">La funzione restituisce un puntatore [**IMFStreamDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) .</span><span class="sxs-lookup"><span data-stu-id="03b8c-126">The function returns an [**IMFStreamDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfstreamdescriptor) pointer.</span></span>
3.  <span data-ttu-id="03b8c-127">Chiamare [**IMFStreamDescriptor:: GetMediaTypeHandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) per ottenere il gestore del tipo di supporto del descrittore del flusso.</span><span class="sxs-lookup"><span data-stu-id="03b8c-127">Call [**IMFStreamDescriptor::GetMediaTypeHandler**](/windows/desktop/api/mfidl/nf-mfidl-imfstreamdescriptor-getmediatypehandler) to get the stream descriptor's media type handler.</span></span>
4.  <span data-ttu-id="03b8c-128">Chiamare [**IMFMediaTypeHandler:: SetCurrentMediaType**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) per impostare il formato del flusso predefinito.</span><span class="sxs-lookup"><span data-stu-id="03b8c-128">Call [**IMFMediaTypeHandler::SetCurrentMediaType**](/windows/desktop/api/mfidl/nf-mfidl-imfmediatypehandler-setcurrentmediatype) to set the default stream format.</span></span> <span data-ttu-id="03b8c-129">Usare uno dei tipi di supporti creati nel passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="03b8c-129">Use one of the media types that you created in step 1.</span></span> <span data-ttu-id="03b8c-130">In genere, è consigliabile usare il formato con la qualità più elevata.</span><span class="sxs-lookup"><span data-stu-id="03b8c-130">Generally, you should use the format with the highest quality.</span></span>
5.  <span data-ttu-id="03b8c-131">Facoltativamente, impostare gli attributi sul descrittore del flusso.</span><span class="sxs-lookup"><span data-stu-id="03b8c-131">Optionally, set attributes on the stream descriptor.</span></span> <span data-ttu-id="03b8c-132">Per un elenco degli attributi che si applicano ai descrittori di flusso, vedere [attributi del descrittore di flusso](stream-descriptor-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="03b8c-132">For a list of attributes that apply to stream descriptors, see [Stream Descriptor Attributes](stream-descriptor-attributes.md).</span></span>

<span data-ttu-id="03b8c-133">A questo punto, creare il descrittore della presentazione:</span><span class="sxs-lookup"><span data-stu-id="03b8c-133">Now create the presentation descriptor:</span></span>

1.  <span data-ttu-id="03b8c-134">Chiamare [**MFCreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) e passare la matrice dei descrittori di flusso.</span><span class="sxs-lookup"><span data-stu-id="03b8c-134">Call [**MFCreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-mfcreatepresentationdescriptor) and pass in the array of stream descriptors.</span></span> <span data-ttu-id="03b8c-135">La funzione restituisce un puntatore [**IMFPresentationDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) .</span><span class="sxs-lookup"><span data-stu-id="03b8c-135">The function returns an [**IMFPresentationDescriptor**](/windows/desktop/api/mfidl/nn-mfidl-imfpresentationdescriptor) pointer.</span></span>
2.  <span data-ttu-id="03b8c-136">Scegliere la selezione del flusso predefinita chiamando [**IMFPresentationDescriptor:: SelectStream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) per selezionare uno o più flussi.</span><span class="sxs-lookup"><span data-stu-id="03b8c-136">Choose the default stream selection by calling [**IMFPresentationDescriptor::SelectStream**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-selectstream) to select one or more streams.</span></span> <span data-ttu-id="03b8c-137">È necessario selezionare almeno un flusso nella configurazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="03b8c-137">At least one stream must be selected in the default configuration.</span></span>
3.  <span data-ttu-id="03b8c-138">Facoltativamente, impostare gli attributi per il descrittore della presentazione.</span><span class="sxs-lookup"><span data-stu-id="03b8c-138">Optionally, set attributes on the presentation descriptor.</span></span> <span data-ttu-id="03b8c-139">Per un elenco di attributi validi per i descrittori di flusso, vedere la pagina relativa agli [attributi del descrittore di presentazione](presentation-descriptor-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="03b8c-139">For a list of attributes that apply to stream descriptors, see [Presentation Descriptor Attributes](presentation-descriptor-attributes.md).</span></span>

<span data-ttu-id="03b8c-140">È necessario creare il descrittore della presentazione una volta all'avvio o dopo che l'origine ha analizzato un numero sufficiente di dati di origine per determinare il contenuto.</span><span class="sxs-lookup"><span data-stu-id="03b8c-140">You should create the presentation descriptor once, either at startup or after the source has parsed enough of the source data to determine the contents.</span></span> <span data-ttu-id="03b8c-141">Il metodo [**CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) deve restituire una copia del descrittore della presentazione.</span><span class="sxs-lookup"><span data-stu-id="03b8c-141">The [**CreatePresentationDescriptor**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-createpresentationdescriptor) method should return a copy of presentation descriptor.</span></span> <span data-ttu-id="03b8c-142">Per creare la copia, chiamare [**IMFPresentationDescriptor:: Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone).</span><span class="sxs-lookup"><span data-stu-id="03b8c-142">To create the copy, call [**IMFPresentationDescriptor::Clone**](/windows/desktop/api/mfidl/nf-mfidl-imfpresentationdescriptor-clone).</span></span> <span data-ttu-id="03b8c-143">La restituzione di una copia impedisce al client di modificare lo stato del descrittore di presentazione originale, ad esempio gli attributi o la selezione del flusso.</span><span class="sxs-lookup"><span data-stu-id="03b8c-143">Returning a copy prevents the client from modifying the state of the original presentation descriptor, such as the attributes or the stream selection.</span></span> <span data-ttu-id="03b8c-144">Tuttavia, tenere presente che **Clone** crea una copia superficiale, in modo che il client possa potenzialmente modificare i descrittori di flusso sottostanti.</span><span class="sxs-lookup"><span data-stu-id="03b8c-144">However, be aware that **Clone** creates a shallow copy, so the client can potentially modify the underlying stream descriptors.</span></span>

## <a name="starting-the-media-source"></a><span data-ttu-id="03b8c-145">Avvio dell'origine supporto</span><span class="sxs-lookup"><span data-stu-id="03b8c-145">Starting the Media Source</span></span>

<span data-ttu-id="03b8c-146">Il metodo [**IMFMediaSource:: Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) avvia l'origine del supporto o cerca una nuova posizione.</span><span class="sxs-lookup"><span data-stu-id="03b8c-146">The [**IMFMediaSource::Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method starts the media source or seeks to a new position.</span></span> <span data-ttu-id="03b8c-147">Una chiamata a **Start** causa una *ricerca* quando lo stato precedente è stato sospeso o in esecuzione e viene specificata una nuova ora di inizio.</span><span class="sxs-lookup"><span data-stu-id="03b8c-147">A call to **Start** causes a *seek* when the previous state was either paused or running, and a new start time is specified.</span></span> <span data-ttu-id="03b8c-148">In caso contrario, il metodo **Start** genera un'operazione di *avvio*.</span><span class="sxs-lookup"><span data-stu-id="03b8c-148">Otherwise, the **Start** method causes a *start*.</span></span> <span data-ttu-id="03b8c-149">Al termine dell'operazione di **avvio** , inviare gli eventi seguenti.</span><span class="sxs-lookup"><span data-stu-id="03b8c-149">When the **Start** operation completes, send the following events.</span></span>

1.  <span data-ttu-id="03b8c-150">Inviare un evento [MENewStream](menewstream.md) per ogni nuovo flusso, ovvero ogni flusso precedentemente deselezionato ed è ora selezionato.</span><span class="sxs-lookup"><span data-stu-id="03b8c-150">Send an [MENewStream](menewstream.md) event for each new stream—that is, each stream that was previously deselected and is now selected.</span></span> <span data-ttu-id="03b8c-151">I dati dell'evento sono un puntatore al flusso.</span><span class="sxs-lookup"><span data-stu-id="03b8c-151">The event data is a pointer to the stream.</span></span>
2.  <span data-ttu-id="03b8c-152">Invia un evento [MEUpdatedStream](meupdatedstream.md) per ogni flusso selezionato in precedenza ed è ancora selezionato.</span><span class="sxs-lookup"><span data-stu-id="03b8c-152">Send an [MEUpdatedStream](meupdatedstream.md) event for each stream that was previously selected and is still selected.</span></span> <span data-ttu-id="03b8c-153">I dati dell'evento sono un puntatore al flusso.</span><span class="sxs-lookup"><span data-stu-id="03b8c-153">The event data is a pointer to the stream.</span></span> <span data-ttu-id="03b8c-154">Non inviare un evento per i flussi deselezionati.</span><span class="sxs-lookup"><span data-stu-id="03b8c-154">(Do not send an event for deselected streams.)</span></span>
3.  <span data-ttu-id="03b8c-155">Se l'origine sta cercando, inviare un evento [MESourceSeeked](mesourceseeked.md) .</span><span class="sxs-lookup"><span data-stu-id="03b8c-155">If the source is seeking, send an [MESourceSeeked](mesourceseeked.md) event.</span></span> <span data-ttu-id="03b8c-156">In caso contrario, inviare un evento [MESourceStarted](mesourcestarted.md) .</span><span class="sxs-lookup"><span data-stu-id="03b8c-156">Otherwise, send an [MESourceStarted](mesourcestarted.md) event.</span></span> <span data-ttu-id="03b8c-157">I dati dell'evento corrispondono all'ora di inizio specificata nel metodo [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) .</span><span class="sxs-lookup"><span data-stu-id="03b8c-157">The event data is the start time that was specified in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method.</span></span> <span data-ttu-id="03b8c-158">Per l'evento MESourceStarted, se l'ora di avvio è un VT \_ vuoto, impostare l'attributo di [**\_ \_ \_ \_ avvio effettivo dell'origine evento MF**](mf-event-source-actual-start-attribute.md) sull'evento.</span><span class="sxs-lookup"><span data-stu-id="03b8c-158">For the MESourceStarted event, if the start time is VT\_EMPTY, set the [**MF\_EVENT\_SOURCE\_ACTUAL\_START**](mf-event-source-actual-start-attribute.md) attribute on the event.</span></span> <span data-ttu-id="03b8c-159">Il valore dell'attributo è l'ora di inizio effettiva.</span><span class="sxs-lookup"><span data-stu-id="03b8c-159">The attribute value is the actual start time.</span></span>
4.  <span data-ttu-id="03b8c-160">Per ogni flusso, se l'origine sta cercando, inviare un evento [MEStreamSeeked](mestreamseeked.md) .</span><span class="sxs-lookup"><span data-stu-id="03b8c-160">For each stream, if the source is seeking, send an [MEStreamSeeked](mestreamseeked.md) event.</span></span> <span data-ttu-id="03b8c-161">In caso contrario, inviare un evento [MEStreamStarted](mestreamstarted.md) .</span><span class="sxs-lookup"><span data-stu-id="03b8c-161">Otherwise, send an [MEStreamStarted](mestreamstarted.md) event.</span></span> <span data-ttu-id="03b8c-162">I dati dell'evento sono l'ora di inizio.</span><span class="sxs-lookup"><span data-stu-id="03b8c-162">The event data is the start time.</span></span> <span data-ttu-id="03b8c-163">(L'origine multimediale può accodare un evento sul flusso chiamando il metodo [**IMFMediaEventGenerator:: QueueEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) del flusso).</span><span class="sxs-lookup"><span data-stu-id="03b8c-163">(The media source can queue an event on the stream by calling the stream's [**IMFMediaEventGenerator::QueueEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-queueevent) method.)</span></span>

<span data-ttu-id="03b8c-164">Quando un flusso viene deselezionato, arrestare il flusso.</span><span class="sxs-lookup"><span data-stu-id="03b8c-164">When a stream is deselected, shut down the stream.</span></span> <span data-ttu-id="03b8c-165">Il flusso non deve accodare altri eventi in quel momento.</span><span class="sxs-lookup"><span data-stu-id="03b8c-165">The stream should not queue any more events at that point.</span></span>

<span data-ttu-id="03b8c-166">Il formato dell'ora per il metodo [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) viene specificato nel parametro *pguidTimeFormat* .</span><span class="sxs-lookup"><span data-stu-id="03b8c-166">The time format for the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is given in the *pguidTimeFormat* parameter.</span></span> <span data-ttu-id="03b8c-167">Il formato dell'ora solare, indicato da **GUID \_ null**, è 100 unità di nanosecondi.</span><span class="sxs-lookup"><span data-stu-id="03b8c-167">The standard time format, indicated by **GUID\_NULL**, is 100-nanosecond units.</span></span> <span data-ttu-id="03b8c-168">Un'origine multimediale deve supportare questo formato di ora.</span><span class="sxs-lookup"><span data-stu-id="03b8c-168">A media source must support this time format.</span></span>

### <a name="seeking"></a><span data-ttu-id="03b8c-169">La ricerca</span><span class="sxs-lookup"><span data-stu-id="03b8c-169">Seeking</span></span>

<span data-ttu-id="03b8c-170">Quando si cerca, la posizione iniziale richiesta potrebbe non rientrare in un limite di campione esatto.</span><span class="sxs-lookup"><span data-stu-id="03b8c-170">When seeking, the requested start position might not fall on an exact sample boundary.</span></span> <span data-ttu-id="03b8c-171">Inoltre, per il contenuto compresso, la posizione iniziale potrebbe essere compresa tra fotogrammi chiave.</span><span class="sxs-lookup"><span data-stu-id="03b8c-171">Also, for compressed content, the start position might fall between key frames.</span></span> <span data-ttu-id="03b8c-172">Un flusso deve fornire campioni dal primo punto necessario per produrre un campione non compresso nella posizione iniziale richiesta.</span><span class="sxs-lookup"><span data-stu-id="03b8c-172">A stream should deliver samples from the earliest point needed to produce an uncompressed sample at the requested start position.</span></span> <span data-ttu-id="03b8c-173">Per video, significa partire dal fotogramma chiave precedente.</span><span class="sxs-lookup"><span data-stu-id="03b8c-173">For video, that means starting from the previous key frame.</span></span> <span data-ttu-id="03b8c-174">La pipeline è responsabile dell'eliminazione dei frame aggiuntivi dal decodificatore, in modo che la riproduzione venga avviata all'ora richiesta.</span><span class="sxs-lookup"><span data-stu-id="03b8c-174">The pipeline is responsible for dropping the extra frames from the decoder, so that playback starts at the requested time.</span></span>

<span data-ttu-id="03b8c-175">L'ora di inizio specificata negli eventi di origine ([MESourceStarted](mesourcestarted.md), [MESourceSeeked](mesourceseeked.md), [MEStreamStarted](mestreamstarted.md)e [MEStreamSeeked](mestreamseeked.md)) è l'ora di inizio richiesta (il valore specificato nel metodo [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) ), indipendentemente dall'effettiva posizione iniziale.</span><span class="sxs-lookup"><span data-stu-id="03b8c-175">The starting time given in the source events ([MESourceStarted](mesourcestarted.md), [MESourceSeeked](mesourceseeked.md), [MEStreamStarted](mestreamstarted.md), and [MEStreamSeeked](mestreamseeked.md)) is the requested starting time (the value given in the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method), regardless of the actual start position.</span></span>

<span data-ttu-id="03b8c-176">Si supponga, ad esempio, che i primi frame di un flusso video abbiano le seguenti caratteristiche:</span><span class="sxs-lookup"><span data-stu-id="03b8c-176">For example, suppose the first few frames of a video stream have the following characteristics:</span></span>



| <span data-ttu-id="03b8c-177">Esempio</span><span class="sxs-lookup"><span data-stu-id="03b8c-177">Sample</span></span>     | <span data-ttu-id="03b8c-178">1</span><span class="sxs-lookup"><span data-stu-id="03b8c-178">1</span></span>       | <span data-ttu-id="03b8c-179">2</span><span class="sxs-lookup"><span data-stu-id="03b8c-179">2</span></span>       | <span data-ttu-id="03b8c-180">3</span><span class="sxs-lookup"><span data-stu-id="03b8c-180">3</span></span>        | <span data-ttu-id="03b8c-181">4</span><span class="sxs-lookup"><span data-stu-id="03b8c-181">4</span></span>        |
|------------|---------|---------|----------|----------|
| <span data-ttu-id="03b8c-182">Tempo</span><span class="sxs-lookup"><span data-stu-id="03b8c-182">Time</span></span>       | <span data-ttu-id="03b8c-183">33 msec</span><span class="sxs-lookup"><span data-stu-id="03b8c-183">33 msec</span></span> | <span data-ttu-id="03b8c-184">66 msec</span><span class="sxs-lookup"><span data-stu-id="03b8c-184">66 msec</span></span> | <span data-ttu-id="03b8c-185">100 msec</span><span class="sxs-lookup"><span data-stu-id="03b8c-185">100 msec</span></span> | <span data-ttu-id="03b8c-186">133 msec</span><span class="sxs-lookup"><span data-stu-id="03b8c-186">133 msec</span></span> |
| <span data-ttu-id="03b8c-187">Fotogramma chiave?</span><span class="sxs-lookup"><span data-stu-id="03b8c-187">Key frame?</span></span> | <span data-ttu-id="03b8c-188">Sì</span><span class="sxs-lookup"><span data-stu-id="03b8c-188">Yes</span></span>     | <span data-ttu-id="03b8c-189">No</span><span class="sxs-lookup"><span data-stu-id="03b8c-189">No</span></span>      | <span data-ttu-id="03b8c-190">No</span><span class="sxs-lookup"><span data-stu-id="03b8c-190">No</span></span>       | <span data-ttu-id="03b8c-191">Sì</span><span class="sxs-lookup"><span data-stu-id="03b8c-191">Yes</span></span>      |



 

<span data-ttu-id="03b8c-192">Se il metodo [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) viene chiamato con un valore di 100 millisecondi, l'origine deve eseguire l'output del video a partire dal frame 1, il primo fotogramma chiave prima del momento.</span><span class="sxs-lookup"><span data-stu-id="03b8c-192">If the [**Start**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-start) method is called with a value of 100 milliseconds, the source needs to output video starting from frame 1, the first key frame prior to this time.</span></span> <span data-ttu-id="03b8c-193">L'evento di avvio indicherà comunque 100 millisecondi nei dati dell'evento.</span><span class="sxs-lookup"><span data-stu-id="03b8c-193">The start event will still indicate 100 milliseconds in the event data.</span></span>

## <a name="pausing-the-media-source"></a><span data-ttu-id="03b8c-194">Sospensione dell'origine multimediale</span><span class="sxs-lookup"><span data-stu-id="03b8c-194">Pausing the Media Source</span></span>

<span data-ttu-id="03b8c-195">Il metodo [**IMFMediaSource::P ause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) mette in pausa l'origine del supporto.</span><span class="sxs-lookup"><span data-stu-id="03b8c-195">The [**IMFMediaSource::Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) method pauses the media source.</span></span>

<span data-ttu-id="03b8c-196">Mentre l'origine viene sospesa, un flusso può creare nuovi esempi e archiviarli in una coda, ma il flusso non recapita gli esempi.</span><span class="sxs-lookup"><span data-stu-id="03b8c-196">While the source is paused, a stream can create new samples and store them on a queue, but the stream does not deliver the samples.</span></span> <span data-ttu-id="03b8c-197">Di seguito sono riportate alcune eccezioni a questa regola:</span><span class="sxs-lookup"><span data-stu-id="03b8c-197">Here are some exceptions to this rule:</span></span>

-   <span data-ttu-id="03b8c-198">Le origini attive dovrebbero eliminare i dati mentre sono sospesi.</span><span class="sxs-lookup"><span data-stu-id="03b8c-198">Live sources should drop data while paused.</span></span>
-   <span data-ttu-id="03b8c-199">Se l'origine recupera i dati da una rete, potrebbe sospendere il server.</span><span class="sxs-lookup"><span data-stu-id="03b8c-199">If the source gets data from a network, it might pause the server.</span></span>

<span data-ttu-id="03b8c-200">Se il client chiama [**IMFMediaStream:: RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) mentre l'origine è sospesa, la richiesta viene accodata anche fino a quando l'origine non viene riavviata.</span><span class="sxs-lookup"><span data-stu-id="03b8c-200">If the client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) while the source is paused, the request is also queued until the source is started again.</span></span> <span data-ttu-id="03b8c-201">Le richieste non devono essere eliminate.</span><span class="sxs-lookup"><span data-stu-id="03b8c-201">Requests should not be dropped.</span></span>

<span data-ttu-id="03b8c-202">La sospensione è consentita solo dallo stato started.</span><span class="sxs-lookup"><span data-stu-id="03b8c-202">Pausing is allowed only from the started state.</span></span> <span data-ttu-id="03b8c-203">In caso contrario, la [**sospensione**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) dovrebbe restituire una **\_ transizione di stato MF E \_ non valida \_ \_**.</span><span class="sxs-lookup"><span data-stu-id="03b8c-203">Otherwise, [**Pause**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-pause) should return **MF\_E\_INVALID\_STATE\_TRANSITION**.</span></span>

## <a name="generating-source-data"></a><span data-ttu-id="03b8c-204">Generazione dei dati di origine</span><span class="sxs-lookup"><span data-stu-id="03b8c-204">Generating Source Data</span></span>

<span data-ttu-id="03b8c-205">Media Foundation usa un *modello pull*, ovvero i flussi generano e recapitano gli esempi in risposta alle richieste dalla pipeline.</span><span class="sxs-lookup"><span data-stu-id="03b8c-205">Media Foundation uses a *pull model*, meaning that streams generate and deliver samples in response to requests from the pipeline.</span></span> <span data-ttu-id="03b8c-206">Un flusso può fornire esempi quando l'origine multimediale è in esecuzione e il flusso è selezionato.</span><span class="sxs-lookup"><span data-stu-id="03b8c-206">A stream can deliver samples when the media source is running and the stream is selected.</span></span> <span data-ttu-id="03b8c-207">Un flusso recapita i dati solo quando il client richiede un nuovo esempio.</span><span class="sxs-lookup"><span data-stu-id="03b8c-207">A stream delivers data only when the client requests a new sample.</span></span>

### <a name="sample-requests"></a><span data-ttu-id="03b8c-208">Richieste di esempio</span><span class="sxs-lookup"><span data-stu-id="03b8c-208">Sample Requests</span></span>

<span data-ttu-id="03b8c-209">Il client richiede un nuovo esempio chiamando [**IMFMediaStream:: RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="03b8c-209">The client requests a new sample by calling [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="03b8c-210">Di seguito è illustrata la sequenza di operazioni:</span><span class="sxs-lookup"><span data-stu-id="03b8c-210">Here is the sequence of operations:</span></span>

1.  <span data-ttu-id="03b8c-211">Il client chiama [**IMFMediaStream:: RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="03b8c-211">The client calls [**IMFMediaStream::RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span> <span data-ttu-id="03b8c-212">L'argomento è un puntatore a un oggetto *token* facoltativo utilizzato dal client per tenere traccia della richiesta.</span><span class="sxs-lookup"><span data-stu-id="03b8c-212">The argument is a pointer to an optional *token* object that the client uses to track the request.</span></span> <span data-ttu-id="03b8c-213">Il client implementa il token.</span><span class="sxs-lookup"><span data-stu-id="03b8c-213">The client implements the token.</span></span> <span data-ttu-id="03b8c-214">I token devono esporre l'interfaccia **IUnknown** .</span><span class="sxs-lookup"><span data-stu-id="03b8c-214">Tokens must expose the **IUnknown** interface.</span></span> <span data-ttu-id="03b8c-215">Il client può anche passare un puntatore NULL anziché un token.</span><span class="sxs-lookup"><span data-stu-id="03b8c-215">The client can also pass in a NULL pointer instead of a token.</span></span>
2.  <span data-ttu-id="03b8c-216">Se il client ha fornito un token, il flusso multimediale chiama **AddRef** sul token e inserisce il token in una coda First in, First-out.</span><span class="sxs-lookup"><span data-stu-id="03b8c-216">If the client provided a token, the media stream calls **AddRef** on the token and places the token in a first-in, first-out queue.</span></span> <span data-ttu-id="03b8c-217">Il metodo restituisce e i passaggi rimanenti si verificano in modo asincrono.</span><span class="sxs-lookup"><span data-stu-id="03b8c-217">The method returns, and the remaining steps occur asynchronously.</span></span>

3.  <span data-ttu-id="03b8c-218">Quando sono disponibili più dati, il flusso multimediale crea un nuovo esempio.</span><span class="sxs-lookup"><span data-stu-id="03b8c-218">When more data is available, the media stream creates a new sample.</span></span> <span data-ttu-id="03b8c-219">Questo passaggio viene descritto più dettagliatamente nella sezione successiva.</span><span class="sxs-lookup"><span data-stu-id="03b8c-219">(This step is described in more detail in the next section.)</span></span>
4.  <span data-ttu-id="03b8c-220">Il flusso multimediale estrae il primo token dalla coda.</span><span class="sxs-lookup"><span data-stu-id="03b8c-220">The media stream pulls the first token from the queue.</span></span>
5.  <span data-ttu-id="03b8c-221">Se il token non è **null**, il flusso multimediale imposta l'attributo del [**\_ token MFSampleExtension**](mfsampleextension-token-attribute.md) nell'esempio di supporto.</span><span class="sxs-lookup"><span data-stu-id="03b8c-221">If the token is not **NULL**, the media stream sets the [**MFSampleExtension\_Token**](mfsampleextension-token-attribute.md) attribute on the media sample.</span></span> <span data-ttu-id="03b8c-222">Il valore dell'attributo è un puntatore al token.</span><span class="sxs-lookup"><span data-stu-id="03b8c-222">The value of the attribute is a pointer to the token.</span></span>
6.  <span data-ttu-id="03b8c-223">Il flusso multimediale Invia un evento [MEMediaSample](memediasample.md) .</span><span class="sxs-lookup"><span data-stu-id="03b8c-223">The media stream sends an [MEMediaSample](memediasample.md) event.</span></span> <span data-ttu-id="03b8c-224">I dati dell'evento sono un puntatore all'interfaccia [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) dell'esempio.</span><span class="sxs-lookup"><span data-stu-id="03b8c-224">The event data is a pointer to the sample's [**IMFSample**](/windows/desktop/api/mfobjects/nn-mfobjects-imfsample) interface.</span></span>
7.  <span data-ttu-id="03b8c-225">Se il client ha fornito un token, il flusso multimediale chiama **Release** sull'oggetto token.</span><span class="sxs-lookup"><span data-stu-id="03b8c-225">If the client provided a token, the media stream calls **Release** on the token object.</span></span>

<span data-ttu-id="03b8c-226">Se il flusso multimediale non è in grado di soddisfare la richiesta [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) del client, estrae il token dalla coda e chiama **Release** sul token, ma non invia un evento [MEMediaSample](memediasample.md) .</span><span class="sxs-lookup"><span data-stu-id="03b8c-226">If the media stream cannot fulfill the client's [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) request, it pulls the token from the queue and calls **Release** on the token, but does not send an [MEMediaSample](memediasample.md) event.</span></span>

<span data-ttu-id="03b8c-227">Il client può usare il token per tenere traccia dello stato della richiesta.</span><span class="sxs-lookup"><span data-stu-id="03b8c-227">The client can use the token to track the status of the request.</span></span> <span data-ttu-id="03b8c-228">Quando il client riceve l'evento [MEMediaSample](memediasample.md) , può ottenere il token dall'esempio e confrontarlo con la richiesta originale.</span><span class="sxs-lookup"><span data-stu-id="03b8c-228">When the client receives the [MEMediaSample](memediasample.md) event, it can get the token from the sample and match it against the original request.</span></span> <span data-ttu-id="03b8c-229">Il client può anche usare il token per rilevare se l'origine multimediale ha eliminato la richiesta.</span><span class="sxs-lookup"><span data-stu-id="03b8c-229">The client can also use the token to detect if the media source dropped the request.</span></span> <span data-ttu-id="03b8c-230">Se il conteggio dei riferimenti del token scende a zero e il flusso multimediale non invia un evento MEMediaSample, significa che la richiesta è stata eliminata.</span><span class="sxs-lookup"><span data-stu-id="03b8c-230">If the token's reference count falls to zero and the media stream does not send an MEMediaSample event, it means that the request was dropped.</span></span>

<span data-ttu-id="03b8c-231">I passaggi elencati di seguito presuppongono che il metodo [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) venga implementato come operazione asincrona.</span><span class="sxs-lookup"><span data-stu-id="03b8c-231">The steps listed here assume that [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method is implemented as an asynchronous operation.</span></span> <span data-ttu-id="03b8c-232">Se il metodo è sincrono, non è necessario inserire il token della richiesta in una coda.</span><span class="sxs-lookup"><span data-stu-id="03b8c-232">If the method is synchronous, you do not need to put the request token on a queue.</span></span> <span data-ttu-id="03b8c-233">Tuttavia, se la generazione di dati richiede una quantità significativa di tempo, è consigliabile un approccio asincrono, ad esempio se l'origine legge i dati da un flusso di byte.</span><span class="sxs-lookup"><span data-stu-id="03b8c-233">However, if generating data takes any significant amount of time, an asynchronous approach is recommended—for example, if the source reads data from a byte stream.</span></span>

<span data-ttu-id="03b8c-234">Il flusso è responsabile del buffering di tutti i dati che si accumulano tra le chiamate a [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span><span class="sxs-lookup"><span data-stu-id="03b8c-234">The stream is responsible for buffering any data that accumulates between calls to [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample).</span></span>

<span data-ttu-id="03b8c-235">Quando il flusso multimediale raggiunge la fine del flusso, invia un evento [MEEndOfStream](meendofstream.md) dopo l'ultimo campione.</span><span class="sxs-lookup"><span data-stu-id="03b8c-235">When the media stream reaches the end of the stream, it sends an [MEEndOfStream](meendofstream.md) event after the last sample.</span></span> <span data-ttu-id="03b8c-236">Al termine di ogni flusso, l'origine multimediale Invia un evento [MEEndOfPresentation](meendofpresentation.md) .</span><span class="sxs-lookup"><span data-stu-id="03b8c-236">After every stream has ended, the media source sends an [MEEndOfPresentation](meendofpresentation.md) event.</span></span> <span data-ttu-id="03b8c-237">Quando un flusso multimediale invia l'evento MEEndOfStream, il metodo [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) restituisce **MF \_ E \_ End \_ of \_ Stream** fino a quando l'origine non viene riavviata.</span><span class="sxs-lookup"><span data-stu-id="03b8c-237">After a media stream sends the MEEndOfStream event, the [**RequestSample**](/windows/desktop/api/mfidl/nf-mfidl-imfmediastream-requestsample) method returns **MF\_E\_END\_OF\_STREAM** until the source is restarted.</span></span>

### <a name="allocating-samples"></a><span data-ttu-id="03b8c-238">Esempi di allocazione</span><span class="sxs-lookup"><span data-stu-id="03b8c-238">Allocating Samples</span></span>

<span data-ttu-id="03b8c-239">Quando il flusso è pronto a compilare una richiesta di esempio in sospeso, viene creato un nuovo esempio e vengono aggiunti uno o più buffer multimediali all'esempio.</span><span class="sxs-lookup"><span data-stu-id="03b8c-239">When the stream is ready to fill a pending sample request, it creates a new sample and adds one or more media buffers to the sample.</span></span> <span data-ttu-id="03b8c-240">Per ulteriori informazioni sulla creazione di buffer multimediali, vedere [buffer multimediali](media-buffers.md).</span><span class="sxs-lookup"><span data-stu-id="03b8c-240">For more information about creating media buffers, see [Media Buffers](media-buffers.md).</span></span>

<span data-ttu-id="03b8c-241">Il flusso deve impostare il timestamp e la durata, se noto.</span><span class="sxs-lookup"><span data-stu-id="03b8c-241">The stream must set the time stamp and the duration, if known.</span></span> <span data-ttu-id="03b8c-242">Il timestamp è relativo all'origine.</span><span class="sxs-lookup"><span data-stu-id="03b8c-242">The time stamp is relative to the source.</span></span> <span data-ttu-id="03b8c-243">Nella maggior parte dei casi, l'inizio del contenuto corrisponde a un timestamp di zero.</span><span class="sxs-lookup"><span data-stu-id="03b8c-243">In most cases, the start of the content corresponds to a time stamp of zero.</span></span> <span data-ttu-id="03b8c-244">Se, ad esempio, l'origine legge da un file multimediale, l'inizio del file avrà un timestamp pari a zero.</span><span class="sxs-lookup"><span data-stu-id="03b8c-244">For example, if the source reads from a media file, the start of the file would have a time stamp of zero.</span></span>

<span data-ttu-id="03b8c-245">Il timestamp dell'esempio non è necessariamente uguale all'ora di presentazione.</span><span class="sxs-lookup"><span data-stu-id="03b8c-245">The time stamp on the sample does not necessarily equal the presentation time.</span></span> <span data-ttu-id="03b8c-246">La sessione multimediale si traduce dall'ora di origine all'ora di presentazione.</span><span class="sxs-lookup"><span data-stu-id="03b8c-246">The Media Session translates from source time to presentation time.</span></span> <span data-ttu-id="03b8c-247">Per i dati compressi, il flusso deve generare dati a partire dal fotogramma chiave più vicino prima dell'ora di inizio.</span><span class="sxs-lookup"><span data-stu-id="03b8c-247">For compressed data, the stream should generate data starting from the nearest key frame before the start time.</span></span> <span data-ttu-id="03b8c-248">In questo modo, il decodificatore è in grado di recapitare il frame visualizzato all'ora di inizio richiesta.</span><span class="sxs-lookup"><span data-stu-id="03b8c-248">This enables the decoder to deliver the frame that appears at the requested start time.</span></span> <span data-ttu-id="03b8c-249">In caso contrario, il decodificatore deve attendere fino al fotogramma chiave seguente.</span><span class="sxs-lookup"><span data-stu-id="03b8c-249">(Otherwise, the decoder would need to wait until the following key frame.)</span></span>

<span data-ttu-id="03b8c-250">Se la velocità di riproduzione è più veloce o più lenta di 1,0, la pipeline regola la frequenza del clock di presentazione.</span><span class="sxs-lookup"><span data-stu-id="03b8c-250">If the playback rate is faster or slower than 1.0, the pipeline adjusts the rate of the presentation clock.</span></span> <span data-ttu-id="03b8c-251">L'origine non modifica i timestamp degli esempi.</span><span class="sxs-lookup"><span data-stu-id="03b8c-251">The source does not adjust the time stamps on samples.</span></span>

<span data-ttu-id="03b8c-252">L'origine può impostare informazioni aggiuntive sull'esempio impostando gli attributi.</span><span class="sxs-lookup"><span data-stu-id="03b8c-252">The source can set additional information on the sample by setting attributes.</span></span> <span data-ttu-id="03b8c-253">Per un elenco di attributi di esempio, vedere [esempi di attributi](sample-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="03b8c-253">For a list of sample attributes, see [Sample Attributes](sample-attributes.md).</span></span>

### <a name="gaps-in-the-stream"></a><span data-ttu-id="03b8c-254">Gap nel flusso</span><span class="sxs-lookup"><span data-stu-id="03b8c-254">Gaps in the Stream</span></span>

<span data-ttu-id="03b8c-255">Se un flusso contiene un gap di lunghezza significativa, è consigliabile che il flusso invii un evento [MEStreamTick](mestreamtick.md) .</span><span class="sxs-lookup"><span data-stu-id="03b8c-255">If a stream contains a gap of significant length, it is recommended that the stream send an [MEStreamTick](mestreamtick.md) event.</span></span> <span data-ttu-id="03b8c-256">Questo evento informa il client che manca un campione.</span><span class="sxs-lookup"><span data-stu-id="03b8c-256">This event notifies the client that a sample is missing.</span></span> <span data-ttu-id="03b8c-257">I dati dell'evento corrispondono al timestamp dell'esempio mancante, in unità di 100 nanosecondi (**VT \_ i8**).</span><span class="sxs-lookup"><span data-stu-id="03b8c-257">The event data is the time stamp of the missing sample, in 100-nanosecond units (**VT\_I8**).</span></span> <span data-ttu-id="03b8c-258">Questo evento consente di salvare i componenti downstream in attesa di esempi che non verranno ricevuti.</span><span class="sxs-lookup"><span data-stu-id="03b8c-258">This event can save downstream components from waiting for samples that will not arrive.</span></span> <span data-ttu-id="03b8c-259">Il flusso può inviare tutti gli eventi MEStreamTick necessari per estendere il gap nel flusso.</span><span class="sxs-lookup"><span data-stu-id="03b8c-259">The stream can send as many MEStreamTick events as needed to span the gap in the stream.</span></span>

## <a name="shutting-down-the-media-source"></a><span data-ttu-id="03b8c-260">Arresto dell'origine supporto</span><span class="sxs-lookup"><span data-stu-id="03b8c-260">Shutting Down the Media Source</span></span>

<span data-ttu-id="03b8c-261">Quando il client viene eseguito tramite l'origine del supporto, chiama [**IMFMediaSource:: Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown).</span><span class="sxs-lookup"><span data-stu-id="03b8c-261">When the client is done using the media source, it calls [**IMFMediaSource::Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-shutdown).</span></span> <span data-ttu-id="03b8c-262">All'interno di questo metodo, l'origine multimediale dovrebbe interrompere i conteggi circolari dei riferimenti.</span><span class="sxs-lookup"><span data-stu-id="03b8c-262">Inside this method, the media source should break any circular reference counts.</span></span> <span data-ttu-id="03b8c-263">In genere, vi saranno riferimenti circolari tra l'origine multimediale e i flussi multimediali.</span><span class="sxs-lookup"><span data-stu-id="03b8c-263">Typically, there will be circular references between the media source and the media streams.</span></span>

<span data-ttu-id="03b8c-264">Se si utilizza la coda degli eventi per implementare [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator), chiamare [**IMFMediaEventQueue:: Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) nella coda degli eventi.</span><span class="sxs-lookup"><span data-stu-id="03b8c-264">If you are using the event queue to implement [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator), call [**IMFMediaEventQueue::Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown) on the event queue.</span></span> <span data-ttu-id="03b8c-265">Questo metodo arresta la coda degli eventi e segnala a qualsiasi chiamante che è attualmente in attesa di un evento.</span><span class="sxs-lookup"><span data-stu-id="03b8c-265">This method shuts down the event queue and signals any caller that is currently waiting for an event.</span></span>

<span data-ttu-id="03b8c-266">Dopo l'arresto, tutti i metodi nell'origine restituiscono l' **\_ \_ arresto MF e**, ad eccezione dei metodi **IUnknown** .</span><span class="sxs-lookup"><span data-stu-id="03b8c-266">After shutdown, all methods on the source return **MF\_E\_SHUTDOWN**, with the exception of **IUnknown** methods.</span></span>

## <a name="live-sources"></a><span data-ttu-id="03b8c-267">Origini attive</span><span class="sxs-lookup"><span data-stu-id="03b8c-267">Live Sources</span></span>

<span data-ttu-id="03b8c-268">A partire da Windows 7, Media Foundation supporta automaticamente dispositivi di acquisizione audio e video.</span><span class="sxs-lookup"><span data-stu-id="03b8c-268">Starting in Windows 7, Media Foundation automatically supports audio and video capture devices.</span></span> <span data-ttu-id="03b8c-269">Per il video, il dispositivo deve fornire un minidriver di streaming kernel (KS) nella categoria acquisizione video.</span><span class="sxs-lookup"><span data-stu-id="03b8c-269">For video, the device must provide a kernel streaming (KS) minidriver in the video capture category.</span></span> <span data-ttu-id="03b8c-270">Media Foundation usa il percorso PnP per enumerare il dispositivo.</span><span class="sxs-lookup"><span data-stu-id="03b8c-270">Media Foundation uses the PnP path to enumerate the device.</span></span> <span data-ttu-id="03b8c-271">Per l'audio, Media Foundation usa l'API del dispositivo multimediale Windows (MMDevice) per enumerare i dispositivi dell'endpoint audio.</span><span class="sxs-lookup"><span data-stu-id="03b8c-271">For audio, Media Foundation uses the Windows Multimedia Device (MMDevice) API to enumerate audio endpoint devices.</span></span> <span data-ttu-id="03b8c-272">Se il dispositivo soddisfa questi criteri, non è necessario implementare un'origine multimediale personalizzata.</span><span class="sxs-lookup"><span data-stu-id="03b8c-272">If the device meets these criteria, there is no need to implement a custom media source.</span></span>

<span data-ttu-id="03b8c-273">Tuttavia, potrebbe essere necessario implementare un'origine multimediale personalizzata per un altro tipo di dispositivo o un'altra origine dati dinamica.</span><span class="sxs-lookup"><span data-stu-id="03b8c-273">However, you might want to implement a custom media source for some other type of device or other live data source.</span></span> <span data-ttu-id="03b8c-274">Esistono solo alcune differenze tra un'origine live e altre origini multimediali:</span><span class="sxs-lookup"><span data-stu-id="03b8c-274">There are only a few differences between a live source and other media sources:</span></span>

-   <span data-ttu-id="03b8c-275">Nel metodo [**IMFMediaSource:: getcaratteristiche**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) , restituire **MFMEDIASOURCE è il \_ flag \_ Live** .</span><span class="sxs-lookup"><span data-stu-id="03b8c-275">In the [**IMFMediaSource::GetCharacteristics**](/windows/desktop/api/mfidl/nf-mfidl-imfmediasource-getcharacteristics) method, return the **MFMEDIASOURCE\_IS\_LIVE** flag.</span></span>
-   <span data-ttu-id="03b8c-276">Il primo campione deve avere un timestamp pari a zero.</span><span class="sxs-lookup"><span data-stu-id="03b8c-276">The first sample should have a time stamp of zero.</span></span>
-   <span data-ttu-id="03b8c-277">Gli eventi e gli Stati di streaming vengono gestiti come le origini multimediali, ad eccezione dello stato di sospensione.</span><span class="sxs-lookup"><span data-stu-id="03b8c-277">Events and streaming states are handled the same as media sources, with the exception of the paused state.</span></span>
-   <span data-ttu-id="03b8c-278">In pausa, non accodare gli esempi.</span><span class="sxs-lookup"><span data-stu-id="03b8c-278">While paused, do not queue samples.</span></span> <span data-ttu-id="03b8c-279">Eliminare tutti i dati generati mentre sono sospesi.</span><span class="sxs-lookup"><span data-stu-id="03b8c-279">Drop any data that is generated while paused.</span></span>
-   <span data-ttu-id="03b8c-280">Le origini attive in genere non supportano la ricerca, la riproduzione inversa o il controllo della frequenza.</span><span class="sxs-lookup"><span data-stu-id="03b8c-280">Live sources typically do not support seeking, reverse play, or rate control.</span></span>

## <a name="related-topics"></a><span data-ttu-id="03b8c-281">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="03b8c-281">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="03b8c-282">Origini supporti</span><span class="sxs-lookup"><span data-stu-id="03b8c-282">Media Sources</span></span>](media-sources.md)
</dt> <dt>

[<span data-ttu-id="03b8c-283">Esercitazione: scrittura di un'origine multimediale personalizzata</span><span class="sxs-lookup"><span data-stu-id="03b8c-283">Tutorial: Writing a Custom Media Source</span></span>](tutorial--writing-a-custom-media-source.md)
</dt> </dl>

 

 



