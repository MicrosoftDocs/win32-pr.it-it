---
description: In questo argomento viene descritta l'elaborazione asincrona dei dati per le trasformazioni di Media Foundation (MFTs).
ms.assetid: d438ffae-fc50-454f-8ce4-2d6676500fff
title: MFTs asincrono
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 4a16950cf431eff16f2befb382a77910c49ccb2e
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106305518"
---
# <a name="asynchronous-mfts"></a><span data-ttu-id="166ae-103">MFTs asincrono</span><span class="sxs-lookup"><span data-stu-id="166ae-103">Asynchronous MFTs</span></span>

<span data-ttu-id="166ae-104">In questo argomento viene descritta l'elaborazione asincrona dei dati per le trasformazioni di Media Foundation (MFTs).</span><span class="sxs-lookup"><span data-stu-id="166ae-104">This topic describes asynchronous data processing for Media Foundation transforms (MFTs).</span></span>

> [!Note]  
> <span data-ttu-id="166ae-105">Questo argomento si applica a Windows 7 o versione successiva.</span><span class="sxs-lookup"><span data-stu-id="166ae-105">This topic applies to Windows 7 or later.</span></span>

 

-   [<span data-ttu-id="166ae-106">Informazioni su MFTs asincrono</span><span class="sxs-lookup"><span data-stu-id="166ae-106">About Asynchronous MFTs</span></span>](#about-asynchronous-mfts)
-   [<span data-ttu-id="166ae-107">Requisiti generali</span><span class="sxs-lookup"><span data-stu-id="166ae-107">General Requirements</span></span>](#general-requirements)
-   [<span data-ttu-id="166ae-108">Eventi</span><span class="sxs-lookup"><span data-stu-id="166ae-108">Events</span></span>](#events)
-   [<span data-ttu-id="166ae-109">ProcessInput</span><span class="sxs-lookup"><span data-stu-id="166ae-109">ProcessInput</span></span>](#processinput)
-   [<span data-ttu-id="166ae-110">ProcessOutput</span><span class="sxs-lookup"><span data-stu-id="166ae-110">ProcessOutput</span></span>](#processoutput)
-   [<span data-ttu-id="166ae-111">Svuotamento</span><span class="sxs-lookup"><span data-stu-id="166ae-111">Draining</span></span>](#draining)
-   [<span data-ttu-id="166ae-112">Flushing</span><span class="sxs-lookup"><span data-stu-id="166ae-112">Flushing</span></span>](#flushing)
-   [<span data-ttu-id="166ae-113">Indicatori</span><span class="sxs-lookup"><span data-stu-id="166ae-113">Markers</span></span>](#markers)
-   [<span data-ttu-id="166ae-114">Modifiche al formato</span><span class="sxs-lookup"><span data-stu-id="166ae-114">Format Changes</span></span>](#format-changes)
-   [<span data-ttu-id="166ae-115">Attributes (Attributi)</span><span class="sxs-lookup"><span data-stu-id="166ae-115">Attributes</span></span>](#attributes)
-   [<span data-ttu-id="166ae-116">Sblocco MFTs asincrono</span><span class="sxs-lookup"><span data-stu-id="166ae-116">Unlocking Asynchronous MFTs</span></span>](#unlocking-asynchronous-mfts)
-   [<span data-ttu-id="166ae-117">Arresto della MFT</span><span class="sxs-lookup"><span data-stu-id="166ae-117">Shutting Down the MFT</span></span>](#shutting-down-the-mft)
-   [<span data-ttu-id="166ae-118">Registrazione ed enumerazione</span><span class="sxs-lookup"><span data-stu-id="166ae-118">Registration and Enumeration</span></span>](#registration-and-enumeration)
-   [<span data-ttu-id="166ae-119">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="166ae-119">Related topics</span></span>](#related-topics)

## <a name="about-asynchronous-mfts"></a><span data-ttu-id="166ae-120">Informazioni su MFTs asincrono</span><span class="sxs-lookup"><span data-stu-id="166ae-120">About Asynchronous MFTs</span></span>

<span data-ttu-id="166ae-121">Quando MFTs è stato introdotto in Windows Vista, l'API è stata progettata per l'elaborazione *sincrona* dei dati.</span><span class="sxs-lookup"><span data-stu-id="166ae-121">When MFTs were introduced in Windows Vista, the API was designed for *synchronous* data processing.</span></span> <span data-ttu-id="166ae-122">In tale modello, il MFT è sempre in attesa di ottenere l'input o di generare l'output.</span><span class="sxs-lookup"><span data-stu-id="166ae-122">In that model, the MFT is always either waiting to get input, or waiting to produce output.</span></span>

<span data-ttu-id="166ae-123">Si consideri un decodificatore video tipico.</span><span class="sxs-lookup"><span data-stu-id="166ae-123">Consider a typical video decoder.</span></span> <span data-ttu-id="166ae-124">Per ottenere un frame decodificato, il client chiama [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="166ae-124">To get a decoded frame, the client calls [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="166ae-125">Se il decodificatore ha un numero sufficiente di dati per decodificare un frame, **ProcessOutput** si blocca mentre il MFT decodifica il frame.</span><span class="sxs-lookup"><span data-stu-id="166ae-125">If the decoder has enough data to decode a frame, **ProcessOutput** blocks while the MFT decodes the frame.</span></span> <span data-ttu-id="166ae-126">In caso contrario, **ProcessOutput** restituisce **MF_E_TRANSFORM_NEED_MORE_INPUT**, che indica che il client deve chiamare [**IMFTransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span><span class="sxs-lookup"><span data-stu-id="166ae-126">Otherwise, **ProcessOutput** returns **MF_E_TRANSFORM_NEED_MORE_INPUT**, indicating that the client should call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput).</span></span>

<span data-ttu-id="166ae-127">Questo modello funziona bene se il decodificatore esegue tutte le operazioni di decodifica su un solo thread.</span><span class="sxs-lookup"><span data-stu-id="166ae-127">This model works well if the decoder performs all of its decoding operations on one thread.</span></span> <span data-ttu-id="166ae-128">Si supponga, tuttavia, che il decodificatore usi diversi thread per decodificare i frame in parallelo.</span><span class="sxs-lookup"><span data-stu-id="166ae-128">But suppose the decoder uses several threads to decode frames in parallel.</span></span> <span data-ttu-id="166ae-129">Per prestazioni ottimali, il decodificatore deve ricevere nuovo input ogni volta che un thread di decodifica diventa inattivo.</span><span class="sxs-lookup"><span data-stu-id="166ae-129">For the best performance, the decoder should receive new input whenever a decoding thread becomes idle.</span></span> <span data-ttu-id="166ae-130">Ma la velocità con cui i thread completano le operazioni di decodifica non verranno allineati esattamente con le chiamate del client a [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) e [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput), ottenendo thread in attesa di lavoro.</span><span class="sxs-lookup"><span data-stu-id="166ae-130">But the rate at which threads complete decoding operations will not align exactly with the client's calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput), resulting in threads waiting for work.</span></span>

<span data-ttu-id="166ae-131">Windows 7 introduce l'elaborazione *asincrona* guidata dagli eventi per MFTS.</span><span class="sxs-lookup"><span data-stu-id="166ae-131">Windows 7 introduces event-driven, *asynchronous* processing for MFTs.</span></span> <span data-ttu-id="166ae-132">In questo modello, ogni volta che il MFT necessita di input o di output, invia un evento al client.</span><span class="sxs-lookup"><span data-stu-id="166ae-132">In this model, whenever the MFT needs input or has output, it sends an event to the client.</span></span>

## <a name="general-requirements"></a><span data-ttu-id="166ae-133">Requisiti generali</span><span class="sxs-lookup"><span data-stu-id="166ae-133">General Requirements</span></span>

<span data-ttu-id="166ae-134">In questo argomento viene descritto come MFTs asincrono differiscono da MFT sincrono.</span><span class="sxs-lookup"><span data-stu-id="166ae-134">This topic describes how asynchronous MFTs differ from synchronous MFT.</span></span> <span data-ttu-id="166ae-135">Eccetto laddove indicato in questo argomento, i due modelli di elaborazione sono gli stessi.</span><span class="sxs-lookup"><span data-stu-id="166ae-135">Except where noted in this topic, the two processing models are the same.</span></span> <span data-ttu-id="166ae-136">In particolare, la negoziazione del formato è la stessa.</span><span class="sxs-lookup"><span data-stu-id="166ae-136">(In particular, format negotiation is the same.)</span></span>

<span data-ttu-id="166ae-137">Un MFT asincrono deve implementare le interfacce seguenti:</span><span class="sxs-lookup"><span data-stu-id="166ae-137">An asynchronous MFT must implement the following interfaces:</span></span>

-   [<span data-ttu-id="166ae-138">**IMFTransform**</span><span class="sxs-lookup"><span data-stu-id="166ae-138">**IMFTransform**</span></span>](/windows/desktop/api/mftransform/nn-mftransform-imftransform)
-   [<span data-ttu-id="166ae-139">**IMFMediaEventGenerator**</span><span class="sxs-lookup"><span data-stu-id="166ae-139">**IMFMediaEventGenerator**</span></span>](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator)
-   [<span data-ttu-id="166ae-140">**IMFShutdown**</span><span class="sxs-lookup"><span data-stu-id="166ae-140">**IMFShutdown**</span></span>](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown)

## <a name="events"></a><span data-ttu-id="166ae-141">Eventi</span><span class="sxs-lookup"><span data-stu-id="166ae-141">Events</span></span>

<span data-ttu-id="166ae-142">Una MFT asincrona utilizza gli eventi seguenti per segnalare lo stato di elaborazione dei dati:</span><span class="sxs-lookup"><span data-stu-id="166ae-142">An asynchronous MFT uses the following events to signal its data-processing status:</span></span>



| <span data-ttu-id="166ae-143">Event</span><span class="sxs-lookup"><span data-stu-id="166ae-143">Event</span></span>                                                    | <span data-ttu-id="166ae-144">Descrizione</span><span class="sxs-lookup"><span data-stu-id="166ae-144">Description</span></span>                                                       |
|----------------------------------------------------------|-------------------------------------------------------------------|
| [<span data-ttu-id="166ae-145">METransformNeedInput</span><span class="sxs-lookup"><span data-stu-id="166ae-145">METransformNeedInput</span></span>](metransformneedinput.md)         | <span data-ttu-id="166ae-146">Inviato quando MFT può accettare più input.</span><span class="sxs-lookup"><span data-stu-id="166ae-146">Sent when the MFT can accept more input.</span></span>                          |
| [<span data-ttu-id="166ae-147">METransformHaveOutput</span><span class="sxs-lookup"><span data-stu-id="166ae-147">METransformHaveOutput</span></span>](metransformhaveoutput.md)       | <span data-ttu-id="166ae-148">Inviato quando il MFT ha output.</span><span class="sxs-lookup"><span data-stu-id="166ae-148">Sent when the MFT has output.</span></span>                                     |
| [<span data-ttu-id="166ae-149">METransformDrainComplete</span><span class="sxs-lookup"><span data-stu-id="166ae-149">METransformDrainComplete</span></span>](metransformdraincomplete.md) | <span data-ttu-id="166ae-150">Inviato quando viene completata un'operazione di svuotamento.</span><span class="sxs-lookup"><span data-stu-id="166ae-150">Sent when a drain operation completes.</span></span> <span data-ttu-id="166ae-151">Vedere [svuotamento](#draining).</span><span class="sxs-lookup"><span data-stu-id="166ae-151">See [Draining](#draining).</span></span> |
| [<span data-ttu-id="166ae-152">METransformMarker</span><span class="sxs-lookup"><span data-stu-id="166ae-152">METransformMarker</span></span>](metransformmarker.md)               | <span data-ttu-id="166ae-153">Inviato quando un marcatore viene elaborato.</span><span class="sxs-lookup"><span data-stu-id="166ae-153">Sent when a marker is process.</span></span> <span data-ttu-id="166ae-154">Vedere [marcatori](#markers).</span><span class="sxs-lookup"><span data-stu-id="166ae-154">See [Markers](#markers).</span></span>           |



 

<span data-ttu-id="166ae-155">Questi eventi vengono inviati fuori banda.</span><span class="sxs-lookup"><span data-stu-id="166ae-155">These events are sent out-of-band.</span></span> <span data-ttu-id="166ae-156">È importante comprendere la differenza tra gli eventi in banda e fuori banda nel contesto di un MFT.</span><span class="sxs-lookup"><span data-stu-id="166ae-156">It is important to understand the difference between in-band and out-of-band events in the context of an MFT.</span></span>

<span data-ttu-id="166ae-157">La progettazione MFT originale supporta gli eventi *in banda* .</span><span class="sxs-lookup"><span data-stu-id="166ae-157">The original MFT design supports *in-band* events.</span></span> <span data-ttu-id="166ae-158">Un evento in banda contiene informazioni sul flusso di dati, ad esempio informazioni su una modifica del formato.</span><span class="sxs-lookup"><span data-stu-id="166ae-158">An in-band event contains information about the data stream, such as information about a format change.</span></span> <span data-ttu-id="166ae-159">Il client invia eventi in banda alla MFT chiamando [**IMFTransform::P rocessevent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span><span class="sxs-lookup"><span data-stu-id="166ae-159">The client sends in-band events to the MFT by calling [**IMFTransform::ProcessEvent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span></span> <span data-ttu-id="166ae-160">Il MFT può inviare gli eventi in banda al client nel metodo [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="166ae-160">The MFT can send in-band events back to the client in the [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="166ae-161">In particolare, gli eventi vengono trasmessi nel membro **pEvents** della struttura [**MFT_OUTPUT_DATA_BUFFER**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) .)</span><span class="sxs-lookup"><span data-stu-id="166ae-161">(Specifically, events are conveyed in the **pEvents** member of the [**MFT_OUTPUT_DATA_BUFFER**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) structure.)</span></span>

<span data-ttu-id="166ae-162">Un MFT invia eventi fuori banda tramite l'interfaccia [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) , come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="166ae-162">An MFT sends out-of-band events through the [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) interface as follows:</span></span>

1.  <span data-ttu-id="166ae-163">MFT implementa l'interfaccia [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) , come descritto in [generatori di eventi multimediali](media-event-generators.md).</span><span class="sxs-lookup"><span data-stu-id="166ae-163">The MFT implements the [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) interface, as described in [Media Event Generators](media-event-generators.md).</span></span>
2.  <span data-ttu-id="166ae-164">Il client chiama **IUnknown:: QueryInterface** sulla MFT per l'interfaccia [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) .</span><span class="sxs-lookup"><span data-stu-id="166ae-164">The client calls **IUnknown::QueryInterface** on the MFT for the [**IMFMediaEventGenerator**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediaeventgenerator) interface.</span></span> <span data-ttu-id="166ae-165">Un MFT asincrono deve esporre questa interfaccia.</span><span class="sxs-lookup"><span data-stu-id="166ae-165">An asynchronous MFT must expose this interface.</span></span> <span data-ttu-id="166ae-166">MFTs sincroni non devono esporre questa interfaccia.</span><span class="sxs-lookup"><span data-stu-id="166ae-166">Synchronous MFTs should not expose this interface.</span></span>
3.  <span data-ttu-id="166ae-167">Il client chiama [**IMFMediaEventGenerator:: BeginGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-begingetevent) e [**IMFMediaEventGenerator:: EndGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-endgetevent) per ricevere eventi fuori banda dalla MFT.</span><span class="sxs-lookup"><span data-stu-id="166ae-167">The client calls [**IMFMediaEventGenerator::BeginGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-begingetevent) and [**IMFMediaEventGenerator::EndGetEvent**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventgenerator-endgetevent) to receive out-of-band events from the MFT.</span></span>

## <a name="processinput"></a><span data-ttu-id="166ae-168">ProcessInput</span><span class="sxs-lookup"><span data-stu-id="166ae-168">ProcessInput</span></span>

<span data-ttu-id="166ae-169">Il metodo [**IMFTransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) viene modificato nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="166ae-169">The [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) method is modified as follows:</span></span>

1.  <span data-ttu-id="166ae-170">All'avvio del flusso, il client invia il messaggio di [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-170">When streaming starts, the client sends the [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message.</span></span>
2.  <span data-ttu-id="166ae-171">Durante lo streaming, il MFT richiede i dati inviando un evento [METransformNeedInput](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-171">During streaming, the MFT requests data by sending an [METransformNeedInput](metransformneedinput.md) event.</span></span> <span data-ttu-id="166ae-172">I dati dell'evento sono l'identificatore del flusso.</span><span class="sxs-lookup"><span data-stu-id="166ae-172">The event data is the stream identifier.</span></span>
3.  <span data-ttu-id="166ae-173">Per ogni evento [METransformNeedInput](metransformneedinput.md) , il client chiama [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) per il flusso specificato.</span><span class="sxs-lookup"><span data-stu-id="166ae-173">For each [METransformNeedInput](metransformneedinput.md) event, the client calls [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) for the specified stream.</span></span>
4.  <span data-ttu-id="166ae-174">Al termine dello streaming, il client può chiamare [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con il messaggio [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-174">At the end of streaming, the client may call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>

<span data-ttu-id="166ae-175">Note sull'implementazione:</span><span class="sxs-lookup"><span data-stu-id="166ae-175">Implementation notes:</span></span>

-   <span data-ttu-id="166ae-176">Il MFT non deve inviare eventi [METransformNeedInput](metransformneedinput.md) fino a quando non riceve il messaggio di [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-176">The MFT must not send any [METransformNeedInput](metransformneedinput.md) events until it receives the [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message.</span></span>
-   <span data-ttu-id="166ae-177">Durante lo streaming, il MFT può inviare eventi [METransformNeedInput](metransformneedinput.md) in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="166ae-177">During streaming, the MFT may send [METransformNeedInput](metransformneedinput.md) events at any time.</span></span>
-   <span data-ttu-id="166ae-178">Il MFT deve mantenere un conteggio degli eventi [METransformNeedInput](metransformneedinput.md) in sospeso.</span><span class="sxs-lookup"><span data-stu-id="166ae-178">The MFT should maintain a count of pending [METransformNeedInput](metransformneedinput.md) events.</span></span> <span data-ttu-id="166ae-179">Qualsiasi chiamata a [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) che non corrisponde a un evento METransformNeedInput deve restituire **MF_E_NOTACCEPTING**.</span><span class="sxs-lookup"><span data-stu-id="166ae-179">Any call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) that does not correspond to an METransformNeedInput event must return **MF_E_NOTACCEPTING**.</span></span>
-   <span data-ttu-id="166ae-180">Quando il MFT riceve il messaggio di [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) , reimposta il numero di eventi [METransformNeedInput](metransformneedinput.md) in sospeso su zero.</span><span class="sxs-lookup"><span data-stu-id="166ae-180">When the MFT receives the [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) message, it resets the count of pending [METransformNeedInput](metransformneedinput.md) events to zero.</span></span>
-   <span data-ttu-id="166ae-181">Il MFT non deve inviare eventi [METransformNeedInput](metransformneedinput.md) dopo la ricezione del messaggio di [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-181">The MFT must not send any [METransformNeedInput](metransformneedinput.md) events after it receives the [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>
-   <span data-ttu-id="166ae-182">Se [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) viene chiamato prima [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) o dopo [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md), il metodo deve restituire **MF_E_NOTACCEPTING**.</span><span class="sxs-lookup"><span data-stu-id="166ae-182">If [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) is called before [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) or after [**MFT_MESSAGE_NOTIFY_END_OF_STREAM**](mft-message-notify-end-of-stream.md), the method must return **MF_E_NOTACCEPTING**.</span></span>

## <a name="processoutput"></a><span data-ttu-id="166ae-183">ProcessOutput</span><span class="sxs-lookup"><span data-stu-id="166ae-183">ProcessOutput</span></span>

<span data-ttu-id="166ae-184">Il metodo [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) viene modificato nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="166ae-184">The [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method is modified as follows:</span></span>

1.  <span data-ttu-id="166ae-185">Ogni volta che il MFT ha output, invia un evento [METransformHaveOutput](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-185">Whenever the MFT has output, it sends an [METransformHaveOutput](metransformhaveoutput.md) event.</span></span>
2.  <span data-ttu-id="166ae-186">Per ogni evento [METransformHaveOutput](metransformhaveoutput.md) , il client chiama [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="166ae-186">For each [METransformHaveOutput](metransformhaveoutput.md) event, the client calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

<span data-ttu-id="166ae-187">Note sull'implementazione:</span><span class="sxs-lookup"><span data-stu-id="166ae-187">Implementation notes:</span></span>

-   <span data-ttu-id="166ae-188">Se il client chiama [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) in qualsiasi altro momento, il metodo restituisce **E_UNEXPECTED**.</span><span class="sxs-lookup"><span data-stu-id="166ae-188">If the client calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) at any other time, the method returns **E_UNEXPECTED**.</span></span>
-   <span data-ttu-id="166ae-189">Un MFT asincrono non deve mai restituire **MF_E_TRANSFORM_NEED_MORE_INPUT** dal metodo [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) .</span><span class="sxs-lookup"><span data-stu-id="166ae-189">An asynchronous MFT should never return **MF_E_TRANSFORM_NEED_MORE_INPUT** from the [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method.</span></span> <span data-ttu-id="166ae-190">Se il MFT richiede un maggior numero di input, invia un evento [METransformNeedInput](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-190">If the MFT requires more input, it sends an [METransformNeedInput](metransformneedinput.md) event.</span></span>

## <a name="draining"></a><span data-ttu-id="166ae-191">Svuotamento</span><span class="sxs-lookup"><span data-stu-id="166ae-191">Draining</span></span>

<span data-ttu-id="166ae-192">Con lo svuotamento di un MFT, il MFT produce il maggior volume di output possibile da qualsiasi dato di input già inviato.</span><span class="sxs-lookup"><span data-stu-id="166ae-192">Draining an MFT causes the MFT to produce as much output as it can from whatever input data has already been sent.</span></span> <span data-ttu-id="166ae-193">Lo svuotamento di un MFT asincrono funziona nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="166ae-193">Draining an asynchronous MFT works as follows:</span></span>

1.  <span data-ttu-id="166ae-194">Il client invia il messaggio di [**MFT_MESSAGE_COMMAND_DRAIN**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-194">The client sends the [**MFT_MESSAGE_COMMAND_DRAIN**](mft-message-command-drain.md) message.</span></span>
2.  <span data-ttu-id="166ae-195">Il MFT continua a inviare gli eventi [METransformHaveOutput](metransformhaveoutput.md) fino a quando non sono disponibili altri dati da elaborare.</span><span class="sxs-lookup"><span data-stu-id="166ae-195">The MFT continues to send [METransformHaveOutput](metransformhaveoutput.md) events until it has no more data to process.</span></span> <span data-ttu-id="166ae-196">Non invia eventi [METransformNeedInput](metransformneedinput.md) durante questo periodo di tempo.</span><span class="sxs-lookup"><span data-stu-id="166ae-196">It does not send [METransformNeedInput](metransformneedinput.md) events during this time.</span></span>
3.  <span data-ttu-id="166ae-197">Dopo l'invio dell'ultimo evento [METransformHaveOutput](metransformhaveoutput.md) da parte di MFT, viene inviato un evento [METransformDrainComplete](metransformdraincomplete.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-197">After the MFT sends the last [METransformHaveOutput](metransformhaveoutput.md) event, it sends an [METransformDrainComplete](metransformdraincomplete.md) event.</span></span>

<span data-ttu-id="166ae-198">Al termine dello svuotamento, il MFT non invia un altro evento [METransformNeedInput](metransformneedinput.md) fino a quando non riceve un messaggio [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) dal client.</span><span class="sxs-lookup"><span data-stu-id="166ae-198">After draining is complete, the MFT does not send another [METransformNeedInput](metransformneedinput.md) event until it receives an [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message from the client.</span></span>

## <a name="flushing"></a><span data-ttu-id="166ae-199">Flushing</span><span class="sxs-lookup"><span data-stu-id="166ae-199">Flushing</span></span>

<span data-ttu-id="166ae-200">Il client può scaricare il MFT inviando il messaggio di [**MFT_MESSAGE_COMMAND_FLUSH**](mft-message-command-flush.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-200">The client can flush the MFT by sending the [**MFT_MESSAGE_COMMAND_FLUSH**](mft-message-command-flush.md) message.</span></span> <span data-ttu-id="166ae-201">Il MFT Elimina tutti gli esempi di input e di output che contiene.</span><span class="sxs-lookup"><span data-stu-id="166ae-201">The MFT drops all of the input and output samples it is holding.</span></span>

<span data-ttu-id="166ae-202">Il MFT non invia un altro evento [METransformNeedInput](metransformneedinput.md) fino a quando non riceve un messaggio [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) dal client.</span><span class="sxs-lookup"><span data-stu-id="166ae-202">The MFT does not send another [METransformNeedInput](metransformneedinput.md) event until it receives an [**MFT_MESSAGE_NOTIFY_START_OF_STREAM**](mft-message-notify-start-of-stream.md) message from the client.</span></span>

## <a name="markers"></a><span data-ttu-id="166ae-203">Indicatori</span><span class="sxs-lookup"><span data-stu-id="166ae-203">Markers</span></span>

<span data-ttu-id="166ae-204">Il client può contrassegnare un punto nel flusso inviando il messaggio di [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-204">The client can mark a point in the stream by sending the [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) message.</span></span> <span data-ttu-id="166ae-205">Il MFT risponde nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="166ae-205">The MFT responds as follows:</span></span>

1.  <span data-ttu-id="166ae-206">Il MFT genera il numero di campioni di output possibili dai dati di input esistenti, inviando un evento [METransformHaveOutput](metransformhaveoutput.md) per ogni esempio di output.</span><span class="sxs-lookup"><span data-stu-id="166ae-206">The MFT generates as many output samples as it can from the existing input data, sending an [METransformHaveOutput](metransformhaveoutput.md) event for each output sample.</span></span>
2.  <span data-ttu-id="166ae-207">Una volta generato tutto l'output, il MFT Invia un evento [METransformMarker](metransformmarker.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-207">After all of the output is generated, the MFT sends an [METransformMarker](metransformmarker.md) event.</span></span> <span data-ttu-id="166ae-208">Questo evento deve essere inviato dopo tutti gli eventi [METransformHaveOutput](metransformhaveoutput.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-208">This event must be sent after all of the [METransformHaveOutput](metransformhaveoutput.md) events.</span></span>

<span data-ttu-id="166ae-209">Si supponga, ad esempio, che un decodificatore disponga di dati di input sufficienti per produrre quattro esempi di output.</span><span class="sxs-lookup"><span data-stu-id="166ae-209">For example, suppose that a decoder has enough input data to produce four output samples.</span></span> <span data-ttu-id="166ae-210">Se il client invia il messaggio di [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) , la funzione MFT Accoda quattro eventi [METransformHaveOutput](metransformhaveoutput.md) (uno per esempio di output), seguiti da un evento [METransformMarker](metransformmarker.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-210">If the client sends the [**MFT_MESSAGE_COMMAND_MARKER**](mft-message-command-marker.md) message, the MFT will queue four [METransformHaveOutput](metransformhaveoutput.md) events (one per output sample), followed by an [METransformMarker](metransformmarker.md) event.</span></span>

<span data-ttu-id="166ae-211">Il messaggio del marcatore è simile al messaggio di svuotamento.</span><span class="sxs-lookup"><span data-stu-id="166ae-211">The marker message is similar to the drain message.</span></span> <span data-ttu-id="166ae-212">Uno svuotamento viene tuttavia considerato un'interruzioni nel flusso, mentre un marcatore non lo è.</span><span class="sxs-lookup"><span data-stu-id="166ae-212">However, a drain is considered a break in the stream, whereas a marker is not.</span></span> <span data-ttu-id="166ae-213">Lo svuotamento e i marcatori presentano le differenze seguenti.</span><span class="sxs-lookup"><span data-stu-id="166ae-213">Draining and markers have the following differences.</span></span>

<span data-ttu-id="166ae-214">Svuotamento</span><span class="sxs-lookup"><span data-stu-id="166ae-214">Draining:</span></span>

-   <span data-ttu-id="166ae-215">Durante lo svuotamento, il MFT non invia gli eventi [METransformNeedInput](metransformneedinput.md) .</span><span class="sxs-lookup"><span data-stu-id="166ae-215">While draining, the MFT does not send [METransformNeedInput](metransformneedinput.md) events.</span></span>
-   <span data-ttu-id="166ae-216">Il MFT Elimina tutti i dati di input che non possono essere usati per creare un esempio di output.</span><span class="sxs-lookup"><span data-stu-id="166ae-216">The MFT discards any input data that cannot be used to create an output sample.</span></span>
-   <span data-ttu-id="166ae-217">Alcuni MFTs producono una "coda" alla fine dei dati.</span><span class="sxs-lookup"><span data-stu-id="166ae-217">Some MFTs produce a "tail" at the end of the data.</span></span> <span data-ttu-id="166ae-218">Ad esempio, gli effetti audio come Reverb o echo producono dati aggiuntivi dopo l'arresto dei dati di input.</span><span class="sxs-lookup"><span data-stu-id="166ae-218">For example, audio effects such as reverb or echo produce extra data after the input data has stopped.</span></span> <span data-ttu-id="166ae-219">Un MFT che genera una coda dovrebbe farlo al termine di un'operazione di svuotamento.</span><span class="sxs-lookup"><span data-stu-id="166ae-219">An MFT that generates a tail should do so at the end of a drain operation.</span></span>
-   <span data-ttu-id="166ae-220">Al termine dello svuotamento del MFT, l'esempio di output successivo viene contrassegnato con l'attributo [**MFSampleExtension_Discontinuity**](mfsampleextension-discontinuity-attribute.md) per indicare una discontinuità nel flusso.</span><span class="sxs-lookup"><span data-stu-id="166ae-220">After the MFT has finished draining, it marks the next output sample with the [**MFSampleExtension_Discontinuity**](mfsampleextension-discontinuity-attribute.md) attribute, to indicate a discontinuity in the stream.</span></span>

<span data-ttu-id="166ae-221">Marcatore</span><span class="sxs-lookup"><span data-stu-id="166ae-221">Marker:</span></span>

-   <span data-ttu-id="166ae-222">Il MFT continua a inviare gli eventi [METransformNeedInput](metransformneedinput.md) prima di inviare l'evento del marcatore.</span><span class="sxs-lookup"><span data-stu-id="166ae-222">The MFT continues to send [METransformNeedInput](metransformneedinput.md) events before sending the marker event.</span></span>
-   <span data-ttu-id="166ae-223">Il MFT non rimuove i dati di input.</span><span class="sxs-lookup"><span data-stu-id="166ae-223">The MFT does not discard any input data.</span></span> <span data-ttu-id="166ae-224">Se sono presenti dati parziali, devono essere elaborati dopo il punto del marcatore.</span><span class="sxs-lookup"><span data-stu-id="166ae-224">If there is partial data, it should be processed after the marker point.</span></span>
-   <span data-ttu-id="166ae-225">Il MFT non produce una coda in corrispondenza del punto del marcatore.</span><span class="sxs-lookup"><span data-stu-id="166ae-225">The MFT does not produce a tail at the marker point.</span></span>
-   <span data-ttu-id="166ae-226">Il MFT non imposta il flag di discontinuità dopo il punto del marcatore.</span><span class="sxs-lookup"><span data-stu-id="166ae-226">The MFT does not set the discontinuity flag after the marker point.</span></span>

## <a name="format-changes"></a><span data-ttu-id="166ae-227">Modifiche al formato</span><span class="sxs-lookup"><span data-stu-id="166ae-227">Format Changes</span></span>

<span data-ttu-id="166ae-228">Un MFT asincrono deve supportare le modifiche del formato dinamico, come descritto in [gestione delle modifiche al flusso](handling-stream-changes.md).</span><span class="sxs-lookup"><span data-stu-id="166ae-228">An asynchronous MFT must support dynamic format changes, as described in [Handling Stream Changes](handling-stream-changes.md).</span></span>

## <a name="attributes"></a><span data-ttu-id="166ae-229">Attributi</span><span class="sxs-lookup"><span data-stu-id="166ae-229">Attributes</span></span>

<span data-ttu-id="166ae-230">Un MFT asincrono deve implementare il metodo [**IMFTransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) per restituire un archivio di attributi valido.</span><span class="sxs-lookup"><span data-stu-id="166ae-230">An asynchronous MFT must implement the [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) method to return a valid attribute store.</span></span> <span data-ttu-id="166ae-231">Gli attributi seguenti si applicano a MFTs asincrono:</span><span class="sxs-lookup"><span data-stu-id="166ae-231">The following attributes apply to asynchronous MFTs:</span></span>



| <span data-ttu-id="166ae-232">Attributo</span><span class="sxs-lookup"><span data-stu-id="166ae-232">Attribute</span></span>                                                                                    | <span data-ttu-id="166ae-233">Descrizione</span><span class="sxs-lookup"><span data-stu-id="166ae-233">Description</span></span>                                                                                                                       |
|----------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="166ae-234">MF_TRANSFORM_ASYNC</span><span class="sxs-lookup"><span data-stu-id="166ae-234">MF_TRANSFORM_ASYNC</span></span>](mf-transform-async.md)                                               | <span data-ttu-id="166ae-235">Il MFT deve impostare questo attributo su **true** (1).</span><span class="sxs-lookup"><span data-stu-id="166ae-235">The MFT must set this attribute to **TRUE** (1).</span></span> <span data-ttu-id="166ae-236">Il client può eseguire una query su questo attributo per individuare se il MFT è asincrono.</span><span class="sxs-lookup"><span data-stu-id="166ae-236">The client can query this attribute to discover whether the MFT is asynchronous.</span></span> |
| [<span data-ttu-id="166ae-237">MF_TRANSFORM_ASYNC_UNLOCK</span><span class="sxs-lookup"><span data-stu-id="166ae-237">MF_TRANSFORM_ASYNC_UNLOCK</span></span>](mf-transform-async-unlock.md)                                |                                                                                                                                   |
| [<span data-ttu-id="166ae-238">**MFT_SUPPORT_DYNAMIC_FORMAT_CHANGE**</span><span class="sxs-lookup"><span data-stu-id="166ae-238">**MFT_SUPPORT_DYNAMIC_FORMAT_CHANGE**</span></span>](mft-support-dynamic-format-change-attribute.md) | <span data-ttu-id="166ae-239">Il MFT deve impostare questo attributo su **true** (1).</span><span class="sxs-lookup"><span data-stu-id="166ae-239">The MFT must set this attribute to **TRUE** (1).</span></span> <span data-ttu-id="166ae-240">Il client può presumere che l'attributo sia impostato.</span><span class="sxs-lookup"><span data-stu-id="166ae-240">The client can assume that this attribute is set.</span></span>                                |



 

## <a name="unlocking-asynchronous-mfts"></a><span data-ttu-id="166ae-241">Sblocco MFTs asincrono</span><span class="sxs-lookup"><span data-stu-id="166ae-241">Unlocking Asynchronous MFTs</span></span>

<span data-ttu-id="166ae-242">MFTs asincroni non sono compatibili con il modello di elaborazione dati MFT originale.</span><span class="sxs-lookup"><span data-stu-id="166ae-242">Asynchronous MFTs are not compatible with the original MFT data processing model.</span></span> <span data-ttu-id="166ae-243">Per impedire che MFTs asincrono interferisca con le applicazioni esistenti, viene definito il meccanismo seguente:</span><span class="sxs-lookup"><span data-stu-id="166ae-243">To prevent asynchronous MFTs from breaking existing applications, the following mechanism is defined:</span></span>

<dl> <span data-ttu-id="166ae-244">Il client chiama <a href="/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes">IMFTransform:: GetAttributes</a> in MFT.</span><span class="sxs-lookup"><span data-stu-id="166ae-244">The client calls <a href="/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes">IMFTransform::GetAttributes</a> on the MFT.</span></span>  
<span data-ttu-id="166ae-245">Il client esegue una query per l'attributo <a href="mf-transform-async.md">MF_TRANSFORM_ASYNC</a> .</span><span class="sxs-lookup"><span data-stu-id="166ae-245">The client queries the for this <a href="mf-transform-async.md">MF_TRANSFORM_ASYNC</a> attribute.</span></span> <span data-ttu-id="166ae-246">Per un MFT asincrono, il valore di questo attributo è **true**.</span><span class="sxs-lookup"><span data-stu-id="166ae-246">For an asynchronous MFT, the value of this attribute is **TRUE**.</span></span>  
<span data-ttu-id="166ae-247">Per sbloccare il MFT, il client deve impostare l'attributo <a href="mf-transform-async-unlock.md">MF_TRANSFORM_ASYNC_UNLOCK</a> su **true**.</span><span class="sxs-lookup"><span data-stu-id="166ae-247">To unlock the MFT, the client must sets the <a href="mf-transform-async-unlock.md">MF_TRANSFORM_ASYNC_UNLOCK</a> attribute to **TRUE**.</span></span>  
</dl>

<span data-ttu-id="166ae-248">Fino a quando il client non sblocca il MFT, tutti i metodi [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) devono restituire **MF_E_TRANSFORM_ASYNC_LOCKED**, con le eccezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="166ae-248">Until the client unlocks the MFT, all [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform) methods should return **MF_E_TRANSFORM_ASYNC_LOCKED**, with the following exceptions:</span></span>

-   <span data-ttu-id="166ae-249">[**IMFTransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) (tutti MFTS asincroni)</span><span class="sxs-lookup"><span data-stu-id="166ae-249">[**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) (all asynchronous MFTs)</span></span>
-   <span data-ttu-id="166ae-250">[**IMFTransform:: GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) (tutti MFTS asincroni)</span><span class="sxs-lookup"><span data-stu-id="166ae-250">[**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) (all asynchronous MFTs)</span></span>
-   <span data-ttu-id="166ae-251">[**IMFTransform:: GetOutputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputcurrenttype) (solo codificatori)</span><span class="sxs-lookup"><span data-stu-id="166ae-251">[**IMFTransform::GetOutputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputcurrenttype) (encoders only)</span></span>
-   <span data-ttu-id="166ae-252">[**IMFTransform:: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) (solo codificatori)</span><span class="sxs-lookup"><span data-stu-id="166ae-252">[**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) (encoders only)</span></span>
-   <span data-ttu-id="166ae-253">[**IMFTransform:: GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) (tutti MFTS asincroni)</span><span class="sxs-lookup"><span data-stu-id="166ae-253">[**IMFTransform::GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) (all asynchronous MFTs)</span></span>
-   <span data-ttu-id="166ae-254">[**IMFTransform:: GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) (tutti MFTS asincroni)</span><span class="sxs-lookup"><span data-stu-id="166ae-254">[**IMFTransform::GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) (all asynchronous MFTs)</span></span>

<span data-ttu-id="166ae-255">Il codice seguente illustra come sbloccare un MFT asincrono:</span><span class="sxs-lookup"><span data-stu-id="166ae-255">The following code shows how to unlock an asynchronous MFT:</span></span>


```C++
HRESULT UnlockAsyncMFT(IMFTransform *pMFT)
{
    IMFAttributes *pAttributes = NULL;

    HRESULT hr = hr = pMFT->GetAttributes(&pAttributes);

    if (SUCCEEDED(hr))
    {
        hr = pAttributes->SetUINT32(MF_TRANSFORM_ASYNC_UNLOCK, TRUE);
        pAttributes->Release();
    }
    
    return hr;
}
```



## <a name="shutting-down-the-mft"></a><span data-ttu-id="166ae-256">Arresto della MFT</span><span class="sxs-lookup"><span data-stu-id="166ae-256">Shutting Down the MFT</span></span>

<span data-ttu-id="166ae-257">MFTs asincrono deve implementare l'interfaccia [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) .</span><span class="sxs-lookup"><span data-stu-id="166ae-257">Asynchronous MFTs must implement the [**IMFShutdown**](/windows/desktop/api/mfidl/nn-mfidl-imfshutdown) interface.</span></span>

-   <span data-ttu-id="166ae-258">[**Arresto**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown): il MFT deve arrestare la coda degli eventi.</span><span class="sxs-lookup"><span data-stu-id="166ae-258">[**Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown): The MFT must shut down its event queue.</span></span> <span data-ttu-id="166ae-259">Se si usa la coda degli eventi standard, chiamare [**IMFMediaEventQueue:: Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown).</span><span class="sxs-lookup"><span data-stu-id="166ae-259">If using the standard event queue, call [**IMFMediaEventQueue::Shutdown**](/windows/desktop/api/mfobjects/nf-mfobjects-imfmediaeventqueue-shutdown).</span></span> <span data-ttu-id="166ae-260">Facoltativamente, il MFT può rilasciare altre risorse.</span><span class="sxs-lookup"><span data-stu-id="166ae-260">Optionally, the MFT may release other resources.</span></span> <span data-ttu-id="166ae-261">Il client non deve usare il MFT dopo la chiamata di **Shutdown**.</span><span class="sxs-lookup"><span data-stu-id="166ae-261">The client must not use the MFT after calling **Shutdown**.</span></span>
-   <span data-ttu-id="166ae-262">[**GetShutdownStatus**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-getshutdownstatus): dopo la chiamata di [**Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown) , l'oggetto MFT deve restituire il valore **MFSHUTDOWN_COMPLETED** nel parametro *pStatus* .</span><span class="sxs-lookup"><span data-stu-id="166ae-262">[**GetShutdownStatus**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-getshutdownstatus): After [**Shutdown**](/windows/desktop/api/mfidl/nf-mfidl-imfshutdown-shutdown) has been called, the MFT should return the value **MFSHUTDOWN_COMPLETED** in the *pStatus* parameter.</span></span> <span data-ttu-id="166ae-263">Non deve restituire il valore **MFSHUTDOWN_INITIATED**.</span><span class="sxs-lookup"><span data-stu-id="166ae-263">It should not return the value **MFSHUTDOWN_INITIATED**.</span></span>

## <a name="registration-and-enumeration"></a><span data-ttu-id="166ae-264">Registrazione ed enumerazione</span><span class="sxs-lookup"><span data-stu-id="166ae-264">Registration and Enumeration</span></span>

<span data-ttu-id="166ae-265">Per registrare un MFT asincrono, chiamare la funzione [**MFTRegister**](/windows/desktop/api/mfapi/nf-mfapi-mftregister) e impostare il flag **MFT_ENUM_FLAG_ASYNCMFT** nel parametro *Flags* .</span><span class="sxs-lookup"><span data-stu-id="166ae-265">To register an asynchronous MFT, call the [**MFTRegister**](/windows/desktop/api/mfapi/nf-mfapi-mftregister) function and set the **MFT_ENUM_FLAG_ASYNCMFT** flag in the *Flags* parameter.</span></span> <span data-ttu-id="166ae-266">(In precedenza questo flag era riservato).</span><span class="sxs-lookup"><span data-stu-id="166ae-266">(Previously this flag was reserved.)</span></span>

<span data-ttu-id="166ae-267">Per enumerare MFTs asincrone, chiamare la funzione [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) e impostare il flag **MFT_ENUM_FLAG_ASYNCMFT** nel parametro *Flags* .</span><span class="sxs-lookup"><span data-stu-id="166ae-267">To enumerate asynchronous MFTs, call the [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) function and set the **MFT_ENUM_FLAG_ASYNCMFT** flag in the *Flags* parameter.</span></span> <span data-ttu-id="166ae-268">Per compatibilità con le versioni precedenti, la funzione [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) non enumera MFTS asincrono.</span><span class="sxs-lookup"><span data-stu-id="166ae-268">For backward compatibility, the [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) function does not enumerate asynchronous MFTs.</span></span> <span data-ttu-id="166ae-269">In caso contrario, l'installazione di un MFT asincrono sul computer dell'utente potrebbe interrompere le applicazioni esistenti.</span><span class="sxs-lookup"><span data-stu-id="166ae-269">Otherwise, installing an asynchronous MFT on the user's computer could break existing applications.</span></span>

## <a name="related-topics"></a><span data-ttu-id="166ae-270">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="166ae-270">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="166ae-271">Trasformazioni Media Foundation</span><span class="sxs-lookup"><span data-stu-id="166ae-271">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



