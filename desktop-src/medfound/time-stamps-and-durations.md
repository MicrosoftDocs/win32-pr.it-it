---
description: In questo argomento viene descritto il modo in cui Media Foundation le trasformazioni devono gestire i timestamp.
ms.assetid: 4ab576ce-becd-4736-921e-e463c0dff841
title: Timestamp e durate
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2323c11fa0e3ec2b2b2d5ba1cefe4f5d5fa80c5b
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104130466"
---
# <a name="time-stamps-and-durations"></a><span data-ttu-id="ec1d1-103">Timestamp e durate</span><span class="sxs-lookup"><span data-stu-id="ec1d1-103">Time Stamps and Durations</span></span>

<span data-ttu-id="ec1d1-104">In questo argomento viene descritto il modo in cui [Media Foundation le trasformazioni](media-foundation-transforms.md) devono gestire i timestamp.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-104">This topic describes how [Media Foundation Transforms](media-foundation-transforms.md) should handle time stamps.</span></span>

<span data-ttu-id="ec1d1-105">Per tutti gli esempi di output, una MFT deve impostare un timestamp accurato e una durata più lunga possibile.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-105">An MFT must set as accurate a time stamp and duration as possible on all output samples.</span></span> <span data-ttu-id="ec1d1-106">Per una semplice MFT che accetta un buffer di input e lo elabora completamente in un buffer di output, il MFT dovrebbe semplicemente copiare il timestamp e la durata direttamente dall'esempio di input all'esempio di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-106">For a simple MFT that takes one input buffer and completely processes it into an output buffer, the MFT should just copy the time stamp and duration directly from the input sample to the output sample.</span></span> <span data-ttu-id="ec1d1-107">Tuttavia, molte trasformazioni sono più complesse di questo e possono richiedere calcoli più complessi del tempo di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-107">However, many transforms are more complex than this and may require more complex calculations of output time.</span></span> <span data-ttu-id="ec1d1-108">Tutti MFTs devono rispettare le regole di base seguenti:</span><span class="sxs-lookup"><span data-stu-id="ec1d1-108">All MFTs should observe the following basic rules:</span></span>

-   <span data-ttu-id="ec1d1-109">Una MFT dovrebbe provare a inserire un timestamp e una durata su tutti i campioni di output video o audio non compressi se viene fornita una durata o un timestamp accurato per gli esempi di input oppure può essere calcolato.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-109">An MFT should try to put a time stamp and duration on all uncompressed video or audio output samples if an accurate time stamp or duration is given on the input samples or can be calculated.</span></span> <span data-ttu-id="ec1d1-110">L'interpolazione potrebbe essere necessaria per alcuni timestamp di output, specialmente per i decodificatori.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-110">Interpolation may be required for some output time stamps, especially for decoders.</span></span>
-   <span data-ttu-id="ec1d1-111">Gli indicatori temporali e le durate degli esempi di input devono essere conservati per quanto possibile negli esempi di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-111">The time stamps and durations of the input samples should be preserved on the output samples as much as possible.</span></span>
-   <span data-ttu-id="ec1d1-112">Gli indicatori temporali o le durate di output potrebbero non corrispondere all'input perché il MFT trattiene i dati o suddivide l'output in parti di dimensioni diverse rispetto all'input.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-112">The output time stamps or durations might not match the input because the MFT is holding back data or breaking the output into different-sized pieces than the input.</span></span> <span data-ttu-id="ec1d1-113">In tal caso, la MFT dovrebbe calcolare il timestamp di output del primo esempio di input che contiene i dati usati per creare l'esempio di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-113">In that case, the MFT should calculate the output time stamp from the earliest input sample that contains data used to create the output sample.</span></span> <span data-ttu-id="ec1d1-114">Per calcolare il timestamp di output, aggiungere il timestamp di input dell'esempio di input appropriato alla durata dei dati che sono già stati trasformati dall'esempio.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-114">To calculate the output time stamp, add the input time stamp of the appropriate input sample to the duration of data that has already been transformed from that sample.</span></span> <span data-ttu-id="ec1d1-115">Nel secondo esempio alla fine di questa sezione viene illustrato questo concetto.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-115">The second example at the end of this section illustrates this idea.</span></span>
-   <span data-ttu-id="ec1d1-116">Se gli esempi di input hanno una durata, tale durata deve essere mantenuta.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-116">If the input samples have duration, that duration should be preserved.</span></span> <span data-ttu-id="ec1d1-117">Se un esempio di input non ha durata, il file MFT deve calcolare una durata, se possibile, a partire dalla dimensione del buffer di output o dalla velocità dati fornita dal tipo di supporto.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-117">If an input sample does not have duration, the MFT should calculate a duration if possible from the size of the output buffer or the data rate given by the media type.</span></span>
-   <span data-ttu-id="ec1d1-118">Le durate calcolate devono essere troncate (arrotondate per difetto), non arrotondate all'incremento più vicino.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-118">Calculated durations should be truncated (rounded down), not rounded to the nearest increment.</span></span> <span data-ttu-id="ec1d1-119">La pipeline è sufficientemente lenta per gestire le durate leggermente inesatte, ma è più facile per la pipeline gestire una durata pari a 1% troppo breve rispetto a una durata pari all'1% troppo lunga.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-119">The pipeline has enough slack to handle durations that are slightly inaccurate, but it is easier for the pipeline to handle a duration that is 1% too short than a duration that is 1% too long.</span></span> <span data-ttu-id="ec1d1-120">Detto questo, non esiste alcun motivo per abbreviare deliberatamente le durate, a parte l'arrotondamento.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-120">That said, there is no reason to deliberately shorten the durations, other than by rounding.</span></span>

### <a name="decoders"></a><span data-ttu-id="ec1d1-121">Decodificatori</span><span class="sxs-lookup"><span data-stu-id="ec1d1-121">Decoders</span></span>

<span data-ttu-id="ec1d1-122">Un decodificatore converte i pacchetti compressi in dati non compressi.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-122">A decoder converts compressed packets into uncompressed data.</span></span> <span data-ttu-id="ec1d1-123">Poiché l'output non è compresso, i decodificatori hanno un obbligo speciale di ottenere i timestamp e le durate corrette.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-123">Because the output is uncompressed, decoders have a special obligation to get the time stamps and durations correct.</span></span> <span data-ttu-id="ec1d1-124">Alcuni formati compressi, in particolare MPEG-2, non hanno timestamp su tutti i pacchetti di input e spesso non hanno durata in alcun pacchetto.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-124">Some compressed formats, most notably MPEG-2, do not have time stamps on all input packets and often have no duration on any packet.</span></span> <span data-ttu-id="ec1d1-125">Per questi formati, il decodificatore è responsabile dell'inserimento di un timestamp e di una durata validi per ogni esempio di output, sommando le durate implicite di tutti gli output dall'ultimo campione di input con timestamp.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-125">For these formats, the decoder is responsible for putting a valid time stamp and duration on every output sample, by summing the implied durations of all the output since the last time-stamped input sample.</span></span>

<span data-ttu-id="ec1d1-126">Per video, se la durata non è disponibile nel formato compresso, il decodificatore deve calcolare la durata come inverso della frequenza dei fotogrammi, convertita in unità di 100 nanosecondi e arrotondata per difetto.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-126">For video, if the duration is not available in the compressed format, the decoder should calculate the duration as the inverse of the frame rate, converted to 100-nanosecond units and rounded down.</span></span>

<span data-ttu-id="ec1d1-127">Per audio, se la durata non è disponibile nel formato compresso, il decodificatore deve calcolare la durata come l'inverso della frequenza di campionamento audio moltiplicata per il numero di campioni nel buffer di output, convertita in unità di 100 nanosecondi e arrotondato per difetto.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-127">For audio, if the duration is not available in the compressed format, the decoder should calculate the duration as the inverse of the audio sample rate multiplied by the number of samples in the output buffer, converted to 100-nanosecond units and rounded down.</span></span>

<span data-ttu-id="ec1d1-128">L'unico momento in cui una trasformazione deve restituire un campione senza un timestamp è se il MFT non ha mai ricevuto un timestamp per un esempio di input o se non è possibile calcolare un timestamp di output accurato dal timestamp di input precedente.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-128">The only time a transform should output a sample without a time stamp is if the MFT has never received a time stamp on an input sample, or if there is no way to calculate an accurate output time stamp from the previous input time stamp.</span></span>

### <a name="audio-decoders"></a><span data-ttu-id="ec1d1-129">Decodificatori audio</span><span class="sxs-lookup"><span data-stu-id="ec1d1-129">Audio Decoders</span></span>

<span data-ttu-id="ec1d1-130">Per i decodificatori audio, la durata di ogni campione di output viene calcolata in base alla frequenza di campionamento audio e al numero di campioni PCM per canale nel buffer di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-130">For audio decoders, the duration of each output sample is calculated from the audio sampling rate and the number of PCM samples per channel in the output buffer.</span></span>

<span data-ttu-id="ec1d1-131">Il modo corretto per calcolare i timestamp di output varia a seconda che gli esempi di input contengano timestamp.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-131">The correct way to calculate output time stamps depends on whether the input samples contain time stamps.</span></span>

<span data-ttu-id="ec1d1-132">Se gli esempi di input contengono timestamp, il decodificatore calcola i timestamp di output dagli indicatori temporali di input, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="ec1d1-132">If the input samples contain time stamps, the decoder calculates the output time stamps from the input time stamps, as follows:</span></span>

-   <span data-ttu-id="ec1d1-133">Se ogni buffer di input contiene uno o più frame compressi completi, senza frame parziali, il timestamp di output è uguale al timestamp di input, meno la latenza nota del decodificatore.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-133">If each input buffer contains a one or more complete compressed frames, with no partial frames, the output time stamp equals the input time stamp, minus the known latency of the decoder.</span></span> <span data-ttu-id="ec1d1-134">Un decodificatore Dolby Digital (AC-3), ad esempio, ha una latenza di 256 campioni PCM.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-134">For example, a Dolby Digital (AC-3) decoder has a latency of 256 PCM samples.</span></span> <span data-ttu-id="ec1d1-135">Ad esempio, alla frequenza di campionamento 48-kHz, la latenza è 5,33 millisecondi (msec).</span><span class="sxs-lookup"><span data-stu-id="ec1d1-135">For example, at 48-kHz sampling rate, the latency is 5.33 milliseconds (msec).</span></span> <span data-ttu-id="ec1d1-136">Se pertanto il timestamp di input è 1000 msec, il timestamp di output è 1000 – 5,33 = 994,66 msec.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-136">Therefore, if the input time stamp is 1000 msec, the output time stamp is 1000 – 5.33 = 994.66 msec.</span></span> <span data-ttu-id="ec1d1-137">Se il buffer di input include più di un intero frame compresso, il decodificatore produrrà un esempio di output per ogni frame nell'esempio di input.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-137">If the input buffer includes more than one whole compressed frame, the decoder will produce one output sample for every frame in the input sample.</span></span> <span data-ttu-id="ec1d1-138">Tutti gli esempi di output avranno un timestamp corretto in modo che non vi siano Gap.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-138">All output samples will be time stamped correctly such that there are no gaps.</span></span>
-   <span data-ttu-id="ec1d1-139">A seconda del formato di trasporto, un buffer di input può contenere frame parziali.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-139">Depending on the transport format, an input buffer might contain partial frames.</span></span> <span data-ttu-id="ec1d1-140">Un buffer, ad esempio, può contenere parte di un frame dal buffer di input precedente, seguito da uno o più frame completi, seguiti dall'inizio del frame successivo.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-140">For example, a buffer might contain part of a frame from the previous input buffer, followed by one or more complete frames, followed by the start of the next frame.</span></span> <span data-ttu-id="ec1d1-141">In questo caso, in genere è corretto presumere che il timestamp di input corrisponda al primo frame che inizia all'interno del buffer.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-141">In this case, it is generally correct to assume that the input time stamp corresponds to the first frame that starts within the buffer.</span></span> <span data-ttu-id="ec1d1-142">Ovvero, un frame parziale avviato nel buffer precedente non è incluso nel timestamp per il buffer corrente. Calcolare di conseguenza il timestamp di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-142">(That is, a partial frame that started in the previous buffer is not included in the time stamp for the current buffer.) Calculate the output time stamp accordingly.</span></span>

<span data-ttu-id="ec1d1-143">Se gli esempi di input non contengono alcun timestamp:</span><span class="sxs-lookup"><span data-stu-id="ec1d1-143">If the input samples do not contain any time stamps:</span></span>

-   <span data-ttu-id="ec1d1-144">Il decodificatore deve generare i propri timestamp, impostando il primo timestamp di output su zero.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-144">The decoder should generate its own time stamps, setting the first output time stamp to zero.</span></span>
-   <span data-ttu-id="ec1d1-145">La durata del campione viene calcolata in base al numero di campioni di output nel buffer e alla frequenza di campionamento.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-145">The sample duration is calculated from the number of output samples in the buffer and the sample rate.</span></span>
-   <span data-ttu-id="ec1d1-146">I timestamp successivi vengono calcolati dal timestamp e dalla durata precedenti: timestamp corrente + durata corrente = timestamp successivo.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-146">Subsequent time stamps are calculated from the previous time stamp and duration: Current time stamp + current duration = next time stamp.</span></span> <span data-ttu-id="ec1d1-147">Non devono esserci Gap negli indicatori temporali di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-147">There should be no gaps in the output time stamps.</span></span>

<span data-ttu-id="ec1d1-148">Se il flusso di input contiene inizialmente timestamp, ma per qualche motivo passa a nessun timestamp, il decodificatore deve continuare a generare i propri timestamp di output, in modo che siano continui e che non si verifichino Gap.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-148">If the input stream initially contains time stamps, but for some reason switches to no time stamps, the decoder should continue to generate its own output time stamps, such that they are continuous and there is no gap.</span></span>

<span data-ttu-id="ec1d1-149">Se il flusso di input contiene timestamp, ma sono presenti gap negli orari, il decodificatore propagherà semplicemente tali gap.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-149">If the input stream contains time stamps, but there are gaps in the times, the decoder will simply propagate these gaps.</span></span> <span data-ttu-id="ec1d1-150">In altre parole, il decodificatore non deve tentare di correggere indicatori temporali incoerenti nel flusso di input.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-150">In other words, the decoder should not attempt to fix inconsistent time stamps in the input stream.</span></span>

### <a name="mixers"></a><span data-ttu-id="ec1d1-151">Miscelatori</span><span class="sxs-lookup"><span data-stu-id="ec1d1-151">Mixers</span></span>

> [!Note]  
> <span data-ttu-id="ec1d1-152">In Windows Vista, la pipeline Media Foundation non supporta MFTs con più di un input.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-152">In Windows Vista, the Media Foundation pipeline does not support MFTs with more than one input.</span></span> <span data-ttu-id="ec1d1-153">I MFTs con più input sono supportati in Windows 7.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-153">Multiple-input MFTs are supported in Windows 7.</span></span>

 

<span data-ttu-id="ec1d1-154">Un mixer accetta più input e li combina in un unico output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-154">A mixer takes multiple inputs and mixes them into one output.</span></span> <span data-ttu-id="ec1d1-155">Se i flussi di input non sono completamente bloccati o se sono leggermente sfalsati tra loro, è possibile che si verifichino ambiguità sul tempo da impostare nell'output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-155">If the input streams are not completely rate-locked, or are slightly offset in time from each other, there can be ambiguity about which time to set on the output.</span></span> <span data-ttu-id="ec1d1-156">Di seguito sono riportate alcune linee guida, a seconda del tipo di supporto:</span><span class="sxs-lookup"><span data-stu-id="ec1d1-156">Here are some guidelines, depending on the media type:</span></span>

-   <span data-ttu-id="ec1d1-157">Audio.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-157">Audio.</span></span> <span data-ttu-id="ec1d1-158">All'avvio o immediatamente dopo lo svuotamento o lo svuotamento, un mixer audio deve attendere la generazione di esempi di output fino a quando non riceve un esempio di input in tutti i flussi di input necessari.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-158">At startup or immediately after a drain or flush, an audio mixer should wait to produce output samples until it has received an input sample on all required input streams.</span></span> <span data-ttu-id="ec1d1-159">A questo punto, deve scegliere il timestamp meno recente degli esempi iniziali da usare come base per i timestamp di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-159">At that point, it should choose the earliest time stamp of the initial samples to use as a baseline for the output time stamps.</span></span> <span data-ttu-id="ec1d1-160">Gli altri flussi devono essere riempiti con il silenzio per comportare eventuali discrepanze temporali.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-160">The other streams should be padded with silence to make up any time discrepancy.</span></span> <span data-ttu-id="ec1d1-161">Se un campione viene ricevuto su un flusso di input facoltativo, è necessario fattorizzarlo anche nel calcolo.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-161">If a sample is received on an optional input stream, it should also be factored into the calculation.</span></span> <span data-ttu-id="ec1d1-162">Da quel punto in poi, il MFT dovrebbe sforzarsi di produrre una catena continua e non interruppe di timestamp di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-162">From that point on, the MFT should strive to produce a continuous and unbroken chain of output time stamps.</span></span> <span data-ttu-id="ec1d1-163">In generale, il MFT non deve tentare di tenere conto di un flusso in modo non conforme rispetto a un altro.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-163">In general, the MFT should not try to account for one stream drifting relative to another.</span></span> <span data-ttu-id="ec1d1-164">Al contrario, è necessario calcolare i timestamp di output dal timestamp di base, la velocità di output e le dimensioni del buffer.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-164">Instead, it should calculate the output time stamps from the baseline time stamp, the output rate, and the buffer sizes.</span></span> <span data-ttu-id="ec1d1-165">Quando si verifica un altro svuotamento o scaricamento, il MFT deve reimpostare i timestamp di base.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-165">When another drain or flush occurs, the MFT should reset its baseline time stamps.</span></span>

-   <span data-ttu-id="ec1d1-166">Video.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-166">Video.</span></span> <span data-ttu-id="ec1d1-167">All'avvio o immediatamente dopo uno svuotamento o uno scaricamento, un mixer video deve attendere per produrre esempi di output fino a quando non riceve un esempio di input in tutti i flussi di input necessari.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-167">At startup or immediately after a drain or flush, a video mixer should wait to produce output samples until it has received an input sample on all required input streams.</span></span> <span data-ttu-id="ec1d1-168">A questo punto, deve scegliere il timestamp meno recente degli esempi iniziali da usare come base per i timestamp di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-168">At that point, it should choose the earliest time stamp of the initial samples to use as a baseline for the output time stamps.</span></span> <span data-ttu-id="ec1d1-169">In generale, si consiglia di tenere traccia dei timestamp di output continui e regolari e di durate fisse, anche se l'input non è regolare, se necessario, ripetendo i frame di input.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-169">In general, it should strive to keep continuous and regular output time stamps and fixed durations, even if the input is not as regular, if necessary by repeating input frames.</span></span>

### <a name="encoders"></a><span data-ttu-id="ec1d1-170">Codificatori</span><span class="sxs-lookup"><span data-stu-id="ec1d1-170">Encoders</span></span>

<span data-ttu-id="ec1d1-171">Un codificatore converte audio o video non compressi in pacchetti compressi.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-171">An encoder converts uncompressed audio or video into compressed packets.</span></span> <span data-ttu-id="ec1d1-172">Un codificatore deve attenersi alle linee guida seguenti:</span><span class="sxs-lookup"><span data-stu-id="ec1d1-172">An encoder should follow these guidelines:</span></span>

-   <span data-ttu-id="ec1d1-173">Il codificatore deve seguire le convenzioni del formato di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-173">The encoder should follow the conventions of the output format.</span></span> <span data-ttu-id="ec1d1-174">Se il formato non è in genere il timestamp di ogni esempio, come in MPEG-2, non tutti i campioni di output devono avere un timestamp e una durata.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-174">If the format does not typically time stamp every sample, as in MPEG-2, not every output sample needs to have a time stamp and a duration.</span></span>

-   <span data-ttu-id="ec1d1-175">Gli indicatori temporali di input devono essere conservati nel formato di output, se il formato contiene campi per i timestamp, a meno che le informazioni sul tempo migliori siano disponibili da un'altra origine, ad esempio l'applicazione stessa.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-175">The input time stamps should be preserved in the output format, if the format has fields for time stamps, unless better time information is a available from another source, such as the application itself.</span></span>

### <a name="multiplexers"></a><span data-ttu-id="ec1d1-176">Multiplexer</span><span class="sxs-lookup"><span data-stu-id="ec1d1-176">Multiplexers</span></span>

> [!Note]  
> <span data-ttu-id="ec1d1-177">In Windows Vista, la pipeline Media Foundation non supporta MFTs con più di un input.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-177">In Windows Vista, the Media Foundation pipeline does not support MFTs with more than one input.</span></span> <span data-ttu-id="ec1d1-178">I MFTs con più input sono supportati in Windows 7.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-178">Multiple-input MFTs are supported in Windows 7.</span></span>

 

<span data-ttu-id="ec1d1-179">Un multiplexer combina due flussi audio o video diversi in un formato con interfoliazione, ad esempio il flusso di trasporto AVI o MPEG-2.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-179">A multiplexer combines two different audio or video streams into one interleaved format, such as AVI or MPEG-2 Transport Stream.</span></span> <span data-ttu-id="ec1d1-180">Un multiplexer deve attenersi alle linee guida seguenti:</span><span class="sxs-lookup"><span data-stu-id="ec1d1-180">A multiplexer should follow these guidelines:</span></span>

-   <span data-ttu-id="ec1d1-181">Il multiplexer deve seguire le convenzioni del formato di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-181">The multiplexer should follow the conventions of the output format.</span></span> <span data-ttu-id="ec1d1-182">Se il formato non è in genere il timestamp di ogni esempio, come in MPEG-2, non tutti i campioni di output devono avere un timestamp e una durata.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-182">If the format does not typically time stamp every sample, as in MPEG-2, not every output sample needs to have a time stamp and a duration.</span></span>

-   <span data-ttu-id="ec1d1-183">Il timestamp deve riflettere la prima ora che verrebbe posizionata in qualsiasi frame che inizia con tale pacchetto o l'ora del primo campione audio che verrebbe decodificato da tale pacchetto.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-183">The time stamp should reflect the earliest time that would be placed on any frame that begins in that packet, or the time of the first audio sample that would be decoded from that packet.</span></span> <span data-ttu-id="ec1d1-184">Ignorare questa linea guida se è in conflitto con le convenzioni del formato di output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-184">Ignore this guideline if it conflicts with the conventions of the output format.</span></span>

### <a name="demultiplexers"></a><span data-ttu-id="ec1d1-185">Demultiplexer</span><span class="sxs-lookup"><span data-stu-id="ec1d1-185">Demultiplexers</span></span>

<span data-ttu-id="ec1d1-186">Un Demultiplexer suddivide un formato con interfoliazione, ad esempio un flusso di trasporto AVI o MPEG-2, nei flussi audio e video sottostanti.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-186">A demultiplexer splits an interleaved format, such as AVI or MPEG-2 Transport Stream, into the underlying audio and video streams.</span></span>

<span data-ttu-id="ec1d1-187">Se il formato contiene informazioni specifiche sul timestamp che possono essere usate per calcolare indicatori temporali di output accurati in base ai timestamp di input, tali informazioni devono essere usate.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-187">If the format contains specific time stamp information that can be used to calculate accurate output time stamps based on the input time stamps, that information should be used.</span></span> <span data-ttu-id="ec1d1-188">Tuttavia, se il formato contiene tempi in una base completamente diversa che non presentano relazioni con i timestamp di input e non è possibile calcolare un offset accurato al timestamp di input, le ore del formato devono essere ignorate.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-188">However, if the format contains times in a completely different base that bear no relation to the input time stamps, and an accurate offset to the input time stamp cannot be calculated, the format's own times should be ignored.</span></span>

<span data-ttu-id="ec1d1-189">Se il formato non dispone di informazioni sul timestamp utilizzabili, il Demultiplexer deve attenersi alle regole seguenti:</span><span class="sxs-lookup"><span data-stu-id="ec1d1-189">If the format does not have usable time stamp information, the demultiplexer should follow these rules:</span></span>

-   <span data-ttu-id="ec1d1-190">I flussi di output non compressi devono avere timestamp e durate validi, se possibile, calcolati dal timestamp di input precedente più vicino.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-190">Uncompressed output streams should have valid time stamps and durations if possible, calculated from the closest previous input time stamp.</span></span>

-   <span data-ttu-id="ec1d1-191">I flussi di output compressi devono avere timestamp solo sul primo campione di output derivato da un campione di input con un timestamp.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-191">Compressed output streams should have time stamps on only the first output sample derived from an input sample with a time stamp.</span></span> <span data-ttu-id="ec1d1-192">Se l'esempio di input non dispone di un timestamp, nessun campione di output derivato dall'esempio di input deve avere un timestamp.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-192">If the input sample does not have a time stamp, no output samples derived from that input sample should have a time stamp.</span></span> <span data-ttu-id="ec1d1-193">Se l'esempio di input è suddiviso in più esempi di output, solo il primo campione di output deve avere un timestamp e il resto non deve avere timestamp.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-193">If the input sample is broken into multiple output samples, only the first output sample should have a time stamp, and the rest should have no time stamps.</span></span>

### <a name="examples"></a><span data-ttu-id="ec1d1-194">Esempi</span><span class="sxs-lookup"><span data-stu-id="ec1d1-194">Examples</span></span>

<span data-ttu-id="ec1d1-195">Esempio 1.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-195">Example 1.</span></span> <span data-ttu-id="ec1d1-196">Si supponga che un effetto video accetti sempre un frame di input non compresso, applica l'effetto e lo copia nell'output.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-196">Suppose that a video effect always takes an uncompressed input frame, applies the effect, and copies it to the output.</span></span> <span data-ttu-id="ec1d1-197">Non viene mai eseguito alcun frame o buffer di input.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-197">It never holds back any frames or buffers any input.</span></span> <span data-ttu-id="ec1d1-198">Questa MFT copia semplicemente il timestamp e la durata dall'esempio di input nell'esempio di output, se disponibili, e non esegue alcun calcolo temporale.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-198">This MFT simply copies the time stamp and duration from the input sample to the output sample, if they are available, and does no time calculations at all.</span></span>

<span data-ttu-id="ec1d1-199">Esempio 2.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-199">Example 2.</span></span> <span data-ttu-id="ec1d1-200">Si supponga che un effetto audio trasformi tutti i 10 millisecondi (MS) di ogni buffer di input, salvando i 10 ms aggiuntivi per combinarli con il buffer successivo.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-200">Suppose that an audio effect transforms all but 10 milliseconds (ms) of each input buffer, saving the extra 10 ms to combine with the next buffer.</span></span> <span data-ttu-id="ec1d1-201">Ottiene un flusso di campioni che hanno tutti una durata di 50 ms.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-201">It gets a stream of samples that all have a duration of 50 ms.</span></span> <span data-ttu-id="ec1d1-202">Gli orari di input sono riportati nella tabella seguente.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-202">The input times are shown in the following table.</span></span>



| <span data-ttu-id="ec1d1-203">Esempio</span><span class="sxs-lookup"><span data-stu-id="ec1d1-203">Sample</span></span> | <span data-ttu-id="ec1d1-204">Tempo di input</span><span class="sxs-lookup"><span data-stu-id="ec1d1-204">Input time</span></span> | <span data-ttu-id="ec1d1-205">Durata input</span><span class="sxs-lookup"><span data-stu-id="ec1d1-205">Input duration</span></span> | <span data-ttu-id="ec1d1-206">Ora output</span><span class="sxs-lookup"><span data-stu-id="ec1d1-206">Output time</span></span> | <span data-ttu-id="ec1d1-207">Durata dell'output</span><span class="sxs-lookup"><span data-stu-id="ec1d1-207">Output duration</span></span> |
|--------|------------|----------------|-------------|-----------------|
| <span data-ttu-id="ec1d1-208">1</span><span class="sxs-lookup"><span data-stu-id="ec1d1-208">1</span></span>      | <span data-ttu-id="ec1d1-209">20</span><span class="sxs-lookup"><span data-stu-id="ec1d1-209">20</span></span>         | <span data-ttu-id="ec1d1-210">50</span><span class="sxs-lookup"><span data-stu-id="ec1d1-210">50</span></span>             | <span data-ttu-id="ec1d1-211">20</span><span class="sxs-lookup"><span data-stu-id="ec1d1-211">20</span></span>          | <span data-ttu-id="ec1d1-212">40</span><span class="sxs-lookup"><span data-stu-id="ec1d1-212">40</span></span>              |
| <span data-ttu-id="ec1d1-213">2</span><span class="sxs-lookup"><span data-stu-id="ec1d1-213">2</span></span>      | <span data-ttu-id="ec1d1-214">70</span><span class="sxs-lookup"><span data-stu-id="ec1d1-214">70</span></span>         | <span data-ttu-id="ec1d1-215">50</span><span class="sxs-lookup"><span data-stu-id="ec1d1-215">50</span></span>             | <span data-ttu-id="ec1d1-216">60</span><span class="sxs-lookup"><span data-stu-id="ec1d1-216">60</span></span>          | <span data-ttu-id="ec1d1-217">50</span><span class="sxs-lookup"><span data-stu-id="ec1d1-217">50</span></span>              |
| <span data-ttu-id="ec1d1-218">3</span><span class="sxs-lookup"><span data-stu-id="ec1d1-218">3</span></span>      | <span data-ttu-id="ec1d1-219">121</span><span class="sxs-lookup"><span data-stu-id="ec1d1-219">121</span></span>        | <span data-ttu-id="ec1d1-220">50</span><span class="sxs-lookup"><span data-stu-id="ec1d1-220">50</span></span>             | <span data-ttu-id="ec1d1-221">110</span><span class="sxs-lookup"><span data-stu-id="ec1d1-221">110</span></span>         | <span data-ttu-id="ec1d1-222">50</span><span class="sxs-lookup"><span data-stu-id="ec1d1-222">50</span></span>              |
| <span data-ttu-id="ec1d1-223">4</span><span class="sxs-lookup"><span data-stu-id="ec1d1-223">4</span></span>      | <span data-ttu-id="ec1d1-224">171</span><span class="sxs-lookup"><span data-stu-id="ec1d1-224">171</span></span>        | <span data-ttu-id="ec1d1-225">50</span><span class="sxs-lookup"><span data-stu-id="ec1d1-225">50</span></span>             | <span data-ttu-id="ec1d1-226">161</span><span class="sxs-lookup"><span data-stu-id="ec1d1-226">161</span></span>         | <span data-ttu-id="ec1d1-227">50</span><span class="sxs-lookup"><span data-stu-id="ec1d1-227">50</span></span>              |



 

<span data-ttu-id="ec1d1-228">Si noti la discrepanza di 1 ms tra la durata effettiva del campione 2 e la durata implicita in base al timestamp successivo (121?</span><span class="sxs-lookup"><span data-stu-id="ec1d1-228">Note the 1-ms discrepancy between the actual duration of sample 2 and the implied duration based on the next time stamp (121 ?</span></span> <span data-ttu-id="ec1d1-229">70 = 51).</span><span class="sxs-lookup"><span data-stu-id="ec1d1-229">70 = 51).</span></span>

<span data-ttu-id="ec1d1-230">Poiché il MFT include 10 ms, viene restituito il primo 40 ms di input sample 1 come output sample 1, con un timestamp di 20 ms e una durata di 40 ms.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-230">Because the MFT holds back 10 ms, it outputs the first 40 ms of input sample 1 as output sample 1, with a time stamp of 20 ms and a duration of 40 ms.</span></span>

<span data-ttu-id="ec1d1-231">Output Sample 2 combina i 10 ms precedentemente mantenuti con 40 ms di input Sample 2.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-231">Output sample 2 combines the 10 ms previously held back with 40 ms of input sample 2.</span></span> <span data-ttu-id="ec1d1-232">A questo esempio viene assegnato un timestamp di 60 ms (il timestamp dell'esempio precedente di input, 20ms, oltre alla durata dei dati già elaborati dall'esempio, 40ms).</span><span class="sxs-lookup"><span data-stu-id="ec1d1-232">This sample is given a time stamp of 60 ms (the time stamp of the previous input sample, 20ms, plus the duration of the data already processed from that sample, 40ms).</span></span> <span data-ttu-id="ec1d1-233">Viene fornita una durata di 50 ms.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-233">It is given a duration of 50ms.</span></span>

<span data-ttu-id="ec1d1-234">Analogamente, l'esempio successivo ha un timestamp di 110ms (70ms + 40ms) con una durata di 50 ms.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-234">Similarly, the next sample has a time stamp of 110ms (70ms + 40ms) with a duration of 50 ms.</span></span>

<span data-ttu-id="ec1d1-235">Il calcolo successivo è più interessante.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-235">The next calculation is more interesting.</span></span> <span data-ttu-id="ec1d1-236">Il timestamp implicito del tempo di output e della durata precedenti è 160 ms (timestamp 110 ms + Duration 50 ms).</span><span class="sxs-lookup"><span data-stu-id="ec1d1-236">The implied time stamp from the previous output time and duration would be 160 ms (time stamp 110 ms + duration 50 ms).</span></span> <span data-ttu-id="ec1d1-237">Tuttavia, il timestamp di output dovrebbe essere calcolato dal timestamp di input dell'esempio di input più recente che si sovrappone all'esempio di output nel tempo, oltre alla lunghezza dei dati già elaborati dall'esempio.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-237">However, the output time stamp is supposed to be calculated from the input time stamp of the earliest input sample that overlaps the output sample in time, plus the length of any data already processed from that sample.</span></span> <span data-ttu-id="ec1d1-238">L'esempio di input sovrapposto più vicino è l'esempio 4 (timestamp = 171), ma questo non è il primo.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-238">The closest overlapping input sample is the sample 4 (time stamp = 171), but this is not the earliest one.</span></span> <span data-ttu-id="ec1d1-239">Il primo esempio sovrapposto è il campione 3 (timestamp = 121).</span><span class="sxs-lookup"><span data-stu-id="ec1d1-239">The earliest overlapping sample is sample 3 (time stamp = 121).</span></span> <span data-ttu-id="ec1d1-240">Aggiungendo il 40ms che è già stato elaborato dall'esempio, il risultato è 161.</span><span class="sxs-lookup"><span data-stu-id="ec1d1-240">Adding the 40ms that has already been processed from that sample, the result is 161.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ec1d1-241">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="ec1d1-241">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ec1d1-242">Scrittura di un MFT personalizzato</span><span class="sxs-lookup"><span data-stu-id="ec1d1-242">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> </dl>

 

 



