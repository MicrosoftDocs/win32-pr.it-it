---
description: Uso dei codec di Windows Media in DirectShow
ms.assetid: 5b930447-6bf2-4bb3-8dfb-05f4c1e7cd64
title: Uso dei codec di Windows Media in DirectShow
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: cb521c0e3897dc2415fbd613f97b755a146657d3
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "106308980"
---
# <a name="using-the-window-media-codecs-in-directshow"></a><span data-ttu-id="10734-103">Uso dei codec di Windows Media in DirectShow</span><span class="sxs-lookup"><span data-stu-id="10734-103">Using the Window Media Codecs in DirectShow</span></span>

<span data-ttu-id="10734-104">Il codificatore Windows Media Audio e video e gli oggetti decodificatore sono stati originariamente progettati e ottimizzati per funzionare con il formato del contenitore di file ASF e Windows Media Format SDK.</span><span class="sxs-lookup"><span data-stu-id="10734-104">The Windows Media Audio and Video encoder and decoder objects were originally designed and optimized to work with the ASF file container format and the Windows Media Format SDK.</span></span> <span data-ttu-id="10734-105">Gli oggetti codec funzionano in modo ottimale in DirectShow per determinati scenari, ovvero la codifica VBR e la qualità dei flussi video con una sola passata.</span><span class="sxs-lookup"><span data-stu-id="10734-105">The codec objects work well in DirectShow for certain scenarios, namely one-pass CBR and quality based VBR encoding of video streams.</span></span> <span data-ttu-id="10734-106">Tuttavia, se si sta valutando l'uso di oggetti codec direttamente in DirectShow usando contenitori di file diversi da ASF, esistono alcuni comportamenti e problemi che è necessario conoscere in anticipo.</span><span class="sxs-lookup"><span data-stu-id="10734-106">But if you are considering using the codec objects directly in DirectShow using file containers other than ASF, there are certain behaviors and issues that you should be aware of in advance.</span></span>

> [!Note]  
> <span data-ttu-id="10734-107">Se si prevede di usare codec autonomi con DirectShow, è consigliabile usarli solo come DMOs.</span><span class="sxs-lookup"><span data-stu-id="10734-107">If you are going to use standalone codecs with DirectShow, you will probably want to use them as DMOs only.</span></span> <span data-ttu-id="10734-108">In altre parole, si utilizzerà l'interfaccia [**IMediaObject**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobject) anziché [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform).</span><span class="sxs-lookup"><span data-stu-id="10734-108">In other words, you will be using the [**IMediaObject**](/previous-versions/windows/desktop/api/mediaobj/nn-mediaobj-imediaobject) interface instead of [**IMFTransform**](/windows/desktop/api/mftransform/nn-mftransform-imftransform).</span></span>

 

## <a name="wm-audio-in-avi-files"></a><span data-ttu-id="10734-109">Audio WM nei file AVI</span><span class="sxs-lookup"><span data-stu-id="10734-109">WM Audio in AVI Files</span></span>

<span data-ttu-id="10734-110">È possibile utilizzare DirectShow per codificare i flussi WMA in qualsiasi formato di contenitore di file per il quale si dispone di un filtro multiplexer.</span><span class="sxs-lookup"><span data-stu-id="10734-110">You can use DirectShow to encode WMA streams into any file container format for which you have a multiplexer filter.</span></span> <span data-ttu-id="10734-111">Tuttavia, le interfacce Windows Media Audio e codec video non supportano WMA nei file AVI perché è impossibile, usando i filtri di riproduzione DirectShow AVI predefiniti, per gestire la sincronizzazione audio-video in un file AVI con un flusso WMA.</span><span class="sxs-lookup"><span data-stu-id="10734-111">However, the Windows Media Audio and Video codec interfaces do not support WMA in AVI files because it is impossible, using the default DirectShow AVI playback filters, to maintain audio-video sync in an AVI file with a WMA stream.</span></span> <span data-ttu-id="10734-112">Per ulteriori informazioni, vedere [archiviazione di supporti compressi nei file AVI](storingcompressedmediainavifiles.md).</span><span class="sxs-lookup"><span data-stu-id="10734-112">For more information, see [Storing Compressed Media in AVI Files](storingcompressedmediainavifiles.md).</span></span>

<span data-ttu-id="10734-113">Il codificatore audio DMO restituisce esempi di durata variabile, anche in modalità "velocità in bit costante".</span><span class="sxs-lookup"><span data-stu-id="10734-113">The audio encoder DMO outputs samples of varying duration, even when in "constant bit rate" mode.</span></span> <span data-ttu-id="10734-114">Quindi, funziona meglio con i formati di contenitori di file che usano i timestamp.</span><span class="sxs-lookup"><span data-stu-id="10734-114">It therefore works best with file container formats that use time stamps.</span></span> <span data-ttu-id="10734-115">I file AVI non forniscono un timestamp per ogni campione audio o gruppo di campioni.</span><span class="sxs-lookup"><span data-stu-id="10734-115">AVI files do not provide a time stamp for each audio sample or group of samples.</span></span> <span data-ttu-id="10734-116">In DirectShow il filtro del separatore AVI produce timestamp per ogni gruppo di campioni (ogni frame audio) in base al valore **nAvgBytesPerSec** nella struttura [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) nell'intestazione del flusso AVI.</span><span class="sxs-lookup"><span data-stu-id="10734-116">In DirectShow, the AVI Splitter filter manufactures time stamps for each group of samples (each audio frame) based on the **nAvgBytesPerSec** value in the [**WAVEFORMATEX**](/previous-versions/dd757713(v=vs.85)) structure in the AVI stream header.</span></span>

<span data-ttu-id="10734-117">Il presupposto sottostante a questo calcolo è che tutti gli esempi audio nel flusso hanno una durata uguale. Tuttavia, gli esempi restituiti da DMO non sono di uguale durata, quindi i timestamp applicati dal separatore AVI non sono accurati.</span><span class="sxs-lookup"><span data-stu-id="10734-117">The assumption underlying this calculation is that all audio samples in the stream are of equal duration; however, the samples output by the DMO are not of equal duration, and so the time stamps applied by the AVI Splitter are not accurate.</span></span> <span data-ttu-id="10734-118">Pertanto, non è possibile, senza modificare il separatore AVI o il decodificatore audio DMO, per usare qualsiasi applicazione basata su DirectShow per riprodurre file AVI con flussi audio e video sincronizzati. Il codec Windows Media Audio 9 Voice funzionerà in alcuni casi, ma anche questa funzione perderà la sincronizzazione dopo qualsiasi operazione di ricerca, pertanto non può essere considerata una soluzione valida.</span><span class="sxs-lookup"><span data-stu-id="10734-118">Therefore, it is not possible, without modifying either the AVI Splitter or the audio decoder DMO, to use any DirectShow-based application to play back AVI files with audio and video streams in sync. The Windows Media Audio 9 Voice codec will work in some cases, but even this will lose sync after any seek operation, so it really cannot be considered a viable solution.</span></span>

<span data-ttu-id="10734-119">Se si ha un codificatore MP3, è possibile creare file AVI con WMV e MP3 per il flusso audio.</span><span class="sxs-lookup"><span data-stu-id="10734-119">If you have an MP3 encoder, you can create AVI files with WMV and MP3 for the audio stream.</span></span> <span data-ttu-id="10734-120">Tali file vengono riprodotti e cercati correttamente in Windows Media Player e in altre applicazioni basate su DirectShow, perché il separatore AVI contiene codice di gestione speciale per i flussi MP3.</span><span class="sxs-lookup"><span data-stu-id="10734-120">Such files will play back and seek correctly in Windows Media Player and other DirectShow-based applications, because the AVI Splitter contains special handling code for MP3 streams.</span></span> <span data-ttu-id="10734-121">Un'altra opzione consiste nell'usare audio PCM non compresso, sebbene ovviamente le dimensioni dei file risultanti saranno molto più grandi rispetto a un flusso audio compresso.</span><span class="sxs-lookup"><span data-stu-id="10734-121">Another option is to use uncompressed PCM audio, although obviously the resulting file size will be much larger than with a compressed audio stream.</span></span> <span data-ttu-id="10734-122">Poiché l'applicazione di esempio DirectShow crea file AVI, non illustra come usare il codificatore audio DMO.</span><span class="sxs-lookup"><span data-stu-id="10734-122">Because the DirectShow sample application creates AVI files, it does not demonstrate how to use the audio encoder DMO.</span></span>

## <a name="one-pass-encoding"></a><span data-ttu-id="10734-123">Codifica a passaggio singolo</span><span class="sxs-lookup"><span data-stu-id="10734-123">One-pass Encoding</span></span>

<span data-ttu-id="10734-124">Il codificatore video DMO funziona facilmente in DirectShow per due modalità di codifica, ovvero CBR e la VBR basata sulla qualità.</span><span class="sxs-lookup"><span data-stu-id="10734-124">The video encoder DMO works easily in DirectShow for two encoding modes: CBR and quality based VBR.</span></span> <span data-ttu-id="10734-125">Se si segue l'ordine corretto delle operazioni durante la creazione del grafico di filtro, come illustrato nell'applicazione di esempio, è relativamente semplice inserire il contenuto di WMV in un file AVI usando il multiplexer AVI e il writer di file.</span><span class="sxs-lookup"><span data-stu-id="10734-125">As long as you follow the correct order of operations when building the filter graph, as demonstrated in the sample application, it is relatively simple to place WMV content into an AVI file using the AVI Multiplexer and the File Writer.</span></span>

## <a name="two-pass-encoding"></a><span data-ttu-id="10734-126">Codifica a due passaggi</span><span class="sxs-lookup"><span data-stu-id="10734-126">Two-pass Encoding</span></span>

<span data-ttu-id="10734-127">Le modalità di codifica a due passaggi richiedono un approccio più complesso alla compilazione e al flusso di grafici per impedire a DMO di scaricare il contenuto dal primo passaggio prima di iniziare il secondo passaggio.</span><span class="sxs-lookup"><span data-stu-id="10734-127">The two-pass encoding modes require a more complex approach to graph building and streaming in order to prevent the DMO from flushing its contents from the first pass before beginning the second pass.</span></span> <span data-ttu-id="10734-128">Nella codifica a due passaggi è necessario eseguire il grafo una volta in modo che DMO possa eseguire l'analisi di pre-elaborazione dei dati del file, quindi riavvolgere il grafo ed eseguirlo di nuovo in modo che DMO possa eseguire la codifica effettiva.</span><span class="sxs-lookup"><span data-stu-id="10734-128">In two-pass encoding, it is necessary to run the graph once so the DMO can perform its preprocessing analysis of the file data, and then rewind the graph and run it again so that the DMO can do the actual encoding.</span></span>

<span data-ttu-id="10734-129">Quando il grafico entra in uno stato di esecuzione per il secondo passaggio, il wrapper DMO imposta il flag di discontinuità sul primo campione, perché il timestamp non è sequenziale con l'ultimo timestamp del primo passaggio.</span><span class="sxs-lookup"><span data-stu-id="10734-129">When the graph goes into a run state for the second pass, the DMO Wrapper sets the DISCONTINUITY flag on the first sample, because the time stamp is not sequential with the last time stamp on the first pass.</span></span> <span data-ttu-id="10734-130">Quando DMO, che non è stato progettato per funzionare in DirectShow in questo modo, riceve il flag di discontinuità, esegue uno scaricamento e perde i dati archiviati dal primo passaggio.</span><span class="sxs-lookup"><span data-stu-id="10734-130">When the DMO, which was not designed to work in DirectShow in this way, receives the DISCONTINUITY flag, it performs a flush and loses the data stored from the first pass.</span></span> <span data-ttu-id="10734-131">Per ovviare a questo problema, è probabile che la soluzione migliore scriva un filtro wrapper DMO personalizzato che non imposta il flag di discontinuità quando il grafico viene ricercato dopo il primo passaggio.</span><span class="sxs-lookup"><span data-stu-id="10734-131">To work around this issue, the best solution is probably to write a custom DMO Wrapper filter that does not set the DISCONTINUITY flag when the graph is seeked after the first pass.</span></span> <span data-ttu-id="10734-132">Nell'esempio video for Windows (VfW) in questo SDK viene illustrato come eseguire la codifica a due passaggi.</span><span class="sxs-lookup"><span data-stu-id="10734-132">The Video for Windows (VfW) sample in this SDK demonstrates how to perform two-pass encoding.</span></span>

## <a name="interlaced-content"></a><span data-ttu-id="10734-133">Contenuto interlacciato</span><span class="sxs-lookup"><span data-stu-id="10734-133">Interlaced Content</span></span>

<span data-ttu-id="10734-134">Il codificatore di WMV DMO è in grado di codificare il contenuto interlacciato conservando il interlacciamento, utile per il contenuto acquisito da un televisore e potrebbe essere riprodotto anche in un televisore.</span><span class="sxs-lookup"><span data-stu-id="10734-134">The WMV encoder DMO is able to encode interlaced content while preserving the interlacing, which is useful for content that is captured from a TV and might also be played back on a TV.</span></span> <span data-ttu-id="10734-135">Tuttavia, non è possibile mantenere l'interlacciamento utilizzando il wrapper DMO predefinito, perché tale filtro non supporta [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) nei relativi esempi di input.</span><span class="sxs-lookup"><span data-stu-id="10734-135">However, it is not possible to preserve interlacing using the default DMO Wrapper, because that filter does not support [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) on its input samples.</span></span>

<span data-ttu-id="10734-136">DMO utilizza tale interfaccia per ottenere le impostazioni interlacciate per ogni campione ricevuto.</span><span class="sxs-lookup"><span data-stu-id="10734-136">The DMO uses that interface to obtain the interlaced settings for each sample that it receives.</span></span> <span data-ttu-id="10734-137">Se l'interfaccia non viene trovata, come nel caso del wrapper DMO, DMO considera semplicemente gli esempi di input come non interlacciati.</span><span class="sxs-lookup"><span data-stu-id="10734-137">If the interface is not found, as is the case with the DMO Wrapper, the DMO simply treats the input samples as noninterlaced.</span></span> <span data-ttu-id="10734-138">Per eseguire la codifica interlacciata in DirectShow, esistono diverse alternative.</span><span class="sxs-lookup"><span data-stu-id="10734-138">To perform interlaced encoding in DirectShow, there are several alternatives.</span></span> <span data-ttu-id="10734-139">L'approccio più semplice è probabilmente usare Windows Media Format 9 Series SDK direttamente o usando il filtro DirectShow del writer WM ASF, per creare un file ASF interlacciato.</span><span class="sxs-lookup"><span data-stu-id="10734-139">The easiest approach is probably to use the Windows Media Format 9 Series SDK either directly or using the WM ASF Writer DirectShow filter, to create an interlaced ASF file.</span></span> <span data-ttu-id="10734-140">È quindi possibile transcodificare il file in un altro formato.</span><span class="sxs-lookup"><span data-stu-id="10734-140">You can then transcode that file into some other format.</span></span> <span data-ttu-id="10734-141">Se si esegue la transcodifica in AVI, sarà presente un file interlacciato, ma i filtri di riproduzione standard DirectShow AVI non lo riconoscono perché non supportano [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2).</span><span class="sxs-lookup"><span data-stu-id="10734-141">If you transcode into AVI, you will have an interlaced file, but the standard DirectShow AVI playback filters will not recognize it as such because they do not support [**VIDEOINFOHEADER2**](/previous-versions/windows/desktop/api/dvdmedia/ns-dvdmedia-videoinfoheader2).</span></span> <span data-ttu-id="10734-142">Un altro approccio consiste nel scrivere un filtro wrapper DMO che supporta l'interfaccia [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) .</span><span class="sxs-lookup"><span data-stu-id="10734-142">Another approach is to write your own DMO Wrapper filter that supports the [**INSSBuffer**](/previous-versions/windows/desktop/api/wmsbuffer/nn-wmsbuffer-inssbuffer) interface.</span></span>

## <a name="related-topics"></a><span data-ttu-id="10734-143">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="10734-143">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="10734-144">Uso di codec DMOs</span><span class="sxs-lookup"><span data-stu-id="10734-144">Working with Codec DMOs</span></span>](workingwithcodecdmos.md)
</dt> </dl>

 

 
