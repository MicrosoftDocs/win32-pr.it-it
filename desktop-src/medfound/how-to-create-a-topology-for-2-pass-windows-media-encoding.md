---
description: Le modalità di codifica a due passaggi sono supportate da determinati codificatori Windows Media e Media Foundation a livello di pipeline.
ms.assetid: 3fd5baff-142f-453e-bb97-b355ee6678fc
title: Come creare una topologia per la codifica Two-Pass Windows Media
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7c813b9a3c31fafaa3efbea83180c997bc46079d
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/03/2021
ms.locfileid: "103968887"
---
# <a name="how-to-create-a-topology-for-two-pass-windows-media-encoding"></a><span data-ttu-id="f57a3-103">Come creare una topologia per la codifica Two-Pass Windows Media</span><span class="sxs-lookup"><span data-stu-id="f57a3-103">How to Create a Topology for Two-Pass Windows Media Encoding</span></span>

<span data-ttu-id="f57a3-104">Le modalità di codifica a due passaggi sono supportate da determinati codificatori Windows Media e Media Foundation a livello di pipeline.</span><span class="sxs-lookup"><span data-stu-id="f57a3-104">Two-pass encoding modes are supported by certain Windows Media encoders and Media Foundation at the pipeline layer.</span></span> <span data-ttu-id="f57a3-105">Nell'applicazione deve essere configurata e configurata la topologia di codifica simile a quella della codifica a passaggio singolo, ma nella modalità di codifica a 2 passaggi, l'applicazione deve eseguire due volte la sessione di codifica.</span><span class="sxs-lookup"><span data-stu-id="f57a3-105">The application must configure and set up the encoding topology similar to that in single-pass encoding but in the 2-pass encoding mode, the application must run the encoding session twice.</span></span> <span data-ttu-id="f57a3-106">Al primo passaggio, il codificatore raccoglie informazioni sul contenuto del flusso.</span><span class="sxs-lookup"><span data-stu-id="f57a3-106">On the first pass, the encoder gathers information about the content of the stream.</span></span> <span data-ttu-id="f57a3-107">Al secondo passaggio, usando le informazioni raccolte al primo passaggio, viene generato il file di output finale.</span><span class="sxs-lookup"><span data-stu-id="f57a3-107">On the second pass, by using the information gathered on the first pass, the final output file is generated.</span></span> <span data-ttu-id="f57a3-108">Elaborando due volte gli esempi per il flusso, la codifica a due passaggi ottimizza il processo di codifica e produce file codificati di qualità superiore.</span><span class="sxs-lookup"><span data-stu-id="f57a3-108">By processing the samples for the stream twice, two-pass encoding optimizes the encoding process and produces higher quality encoded files.</span></span> <span data-ttu-id="f57a3-109">Non è possibile usare le modalità di codifica a due passaggi sui flussi live.</span><span class="sxs-lookup"><span data-stu-id="f57a3-109">Two-pass encoding modes cannot be used on live streams.</span></span>

<span data-ttu-id="f57a3-110">Media Foundation supporta le seguenti modalità di codifica a due passaggi:</span><span class="sxs-lookup"><span data-stu-id="f57a3-110">Media Foundation supports the following two-pass encoding modes:</span></span>

-   [<span data-ttu-id="f57a3-111">Codifica della velocità in bit variabile non vincolata</span><span class="sxs-lookup"><span data-stu-id="f57a3-111">Unconstrained Variable Bit Rate Encoding</span></span>](unconstrained-variable-bit-rate--vbr--encoding.md)
-   [<span data-ttu-id="f57a3-112">Codifica della velocità in bit a variabili con vincoli di picco</span><span class="sxs-lookup"><span data-stu-id="f57a3-112">Peak-Constrained Variable Bit Rate Encoding</span></span>](peak-constrained-variable-bit-rate--vbr--encoding.md)

<span data-ttu-id="f57a3-113">La creazione di una topologia di codifica per la codifica a due passaggi è simile a quella delle modalità single-pass.</span><span class="sxs-lookup"><span data-stu-id="f57a3-113">Building an encoding topology for two-pass encoding is similar to single pass modes.</span></span> <span data-ttu-id="f57a3-114">Nell'elenco seguente vengono illustrate le differenze principali.</span><span class="sxs-lookup"><span data-stu-id="f57a3-114">The following list shows the key differences.</span></span>

-   <span data-ttu-id="f57a3-115">La configurazione del codificatore deve includere la proprietà [**\_ PASSESUSED di MFPKEY**](mfpkey-passesusedproperty.md) impostata su 2 e la proprietà [**MFPKEY \_ VBRENABLED**](mfpkey-vbrenabledproperty.md) su Variant \_ true.</span><span class="sxs-lookup"><span data-stu-id="f57a3-115">Encoder configuration must include the [**MFPKEY\_PASSESUSED**](mfpkey-passesusedproperty.md) property that is set to 2 and the [**MFPKEY\_VBRENABLED**](mfpkey-vbrenabledproperty.md) property to VARIANT\_TRUE.</span></span> <span data-ttu-id="f57a3-116">Questa operazione consente di filtrare le funzionalità del codificatore in modalità a due passaggi.</span><span class="sxs-lookup"><span data-stu-id="f57a3-116">This filters the encoder’s capabilities to two-pass modes.</span></span> <span data-ttu-id="f57a3-117">Se si usano oggetti Activation, passare queste proprietà a [**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) o [**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).</span><span class="sxs-lookup"><span data-stu-id="f57a3-117">If you are using activation objects, pass these properties to [**MFCreateWMAEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmaencoderactivate) or [**MFCreateWMVEncoderActivate**](/windows/desktop/api/wmcontainer/nf-wmcontainer-mfcreatewmvencoderactivate).</span></span>
-   <span data-ttu-id="f57a3-118">Per il primo passaggio, usare un sink di supporti fittizio nel nodo di output perché gli esempi generati in questo passaggio non vengono aggiunti al file finale.</span><span class="sxs-lookup"><span data-stu-id="f57a3-118">For the first pass, use a dummy media sink in the output node because the samples that are generated in this pass are not added to the final file.</span></span>
-   <span data-ttu-id="f57a3-119">Per la seconda sessione, eseguire una query sul codificatore per le proprietà post-codifica richieste e sostituire il nodo del sink multimediale fittizio con il sink multimediale ASF con queste proprietà impostate.</span><span class="sxs-lookup"><span data-stu-id="f57a3-119">For the second pass, query the encoder for the required post-encoding properties and replace the dummy media sink node with the ASF media sink with these properties set.</span></span>

<span data-ttu-id="f57a3-120">Per ulteriori informazioni sulla configurazione di una topologia di codifica, vedere [esercitazione: codifica Windows Media single pass](tutorial--1-pass-windows-media-encoding.md).</span><span class="sxs-lookup"><span data-stu-id="f57a3-120">For more information about setting up an encoding topology see, [Tutorial: Single Pass Windows Media Encoding](tutorial--1-pass-windows-media-encoding.md).</span></span>

<span data-ttu-id="f57a3-121">Nella procedura riportata di seguito vengono riepilogati i passaggi per la codifica di contenuto Windows Media in un contenitore ASF utilizzando una modalità di codifica a due passaggi.</span><span class="sxs-lookup"><span data-stu-id="f57a3-121">The following procedure summarizes the steps for encoding Windows Media content in an ASF container by using a two-pass encoding mode.</span></span>

1.  <span data-ttu-id="f57a3-122">Creare un'origine multimediale per l'oggetto specificato utilizzando il resolver di origine.</span><span class="sxs-lookup"><span data-stu-id="f57a3-122">Create a media source for the specified by using the source resolver.</span></span>
2.  <span data-ttu-id="f57a3-123">Enumerare i flussi nell'origine multimediale.</span><span class="sxs-lookup"><span data-stu-id="f57a3-123">Enumerate the streams in the media source.</span></span>
3.  <span data-ttu-id="f57a3-124">Creare il sink multimediale ASF e aggiungere i sink di flusso a seconda dei flussi nell'origine multimediale che devono essere codificati.</span><span class="sxs-lookup"><span data-stu-id="f57a3-124">Create the ASF media sink and add stream sinks depending on the streams in the media source that need to be encoded.</span></span>
4.  <span data-ttu-id="f57a3-125">Creare il sink multimediale.</span><span class="sxs-lookup"><span data-stu-id="f57a3-125">Create the media sink.</span></span>
5.  <span data-ttu-id="f57a3-126">Creare i codificatori Windows Media per i flussi nel file di output.</span><span class="sxs-lookup"><span data-stu-id="f57a3-126">Create the Windows Media encoders for the streams in the output file.</span></span>
6.  <span data-ttu-id="f57a3-127">Configurare i codificatori con le proprietà di codifica a 2 passaggi.</span><span class="sxs-lookup"><span data-stu-id="f57a3-127">Configure the encoders with the 2-pass encoding properties.</span></span>
7.  <span data-ttu-id="f57a3-128">Creare una topologia di codifica parziale connettendo l'origine, i codificatori e il sink multimediale.</span><span class="sxs-lookup"><span data-stu-id="f57a3-128">Build a partial encoding topology by connecting the source, encoders, and the media sink.</span></span>
8.  <span data-ttu-id="f57a3-129">Creare un'istanza della sessione multimediale e impostare la topologia nella sessione multimediale.</span><span class="sxs-lookup"><span data-stu-id="f57a3-129">Instantiate the Media Session and set the topology on the Media Session.</span></span>
9.  <span data-ttu-id="f57a3-130">Eseguire il primo passaggio di codifica controllando la sessione multimediale e ottenendo tutti gli eventi rilevanti dalla sessione multimediale.</span><span class="sxs-lookup"><span data-stu-id="f57a3-130">Run the first encoding pass by controlling the Media Session and getting all the relevant events from the Media Session.</span></span>
10. <span data-ttu-id="f57a3-131">Chiudere e arrestare la sessione di codifica.</span><span class="sxs-lookup"><span data-stu-id="f57a3-131">Close and shutdown the encoding session.</span></span>
11. <span data-ttu-id="f57a3-132">Eseguire una query sul codificatore per le proprietà seguenti a seconda del tipo di codifica:</span><span class="sxs-lookup"><span data-stu-id="f57a3-132">Query the encoder for the following properties depending on the type of encoding:</span></span> 

    | <span data-ttu-id="f57a3-133">Tipo di codifica</span><span class="sxs-lookup"><span data-stu-id="f57a3-133">Encoding type</span></span>                                                                                        | <span data-ttu-id="f57a3-134">Nome proprietà</span><span class="sxs-lookup"><span data-stu-id="f57a3-134">Property name</span></span>                                                                                                                                                                                                                                                                                                                                                     |
    |------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
    | [<span data-ttu-id="f57a3-135">Codifica della velocità in bit variabile non vincolata</span><span class="sxs-lookup"><span data-stu-id="f57a3-135">Unconstrained Variable Bit Rate Encoding</span></span>](unconstrained-variable-bit-rate--vbr--encoding.md)       | [<span data-ttu-id="f57a3-136">**\_PASSESUSED MFPKEY**</span><span class="sxs-lookup"><span data-stu-id="f57a3-136">**MFPKEY\_PASSESUSED**</span></span>](mfpkey-passesusedproperty.md)<br/> [<span data-ttu-id="f57a3-137">**\_VBRENABLED MFPKEY**</span><span class="sxs-lookup"><span data-stu-id="f57a3-137">**MFPKEY\_VBRENABLED**</span></span>](mfpkey-vbrenabledproperty.md)<br/> [<span data-ttu-id="f57a3-138">**\_BAVG MFPKEY**</span><span class="sxs-lookup"><span data-stu-id="f57a3-138">**MFPKEY\_BAVG**</span></span>](mfpkey-bavgproperty.md)<br/> [<span data-ttu-id="f57a3-139">**\_RAVG MFPKEY**</span><span class="sxs-lookup"><span data-stu-id="f57a3-139">**MFPKEY\_RAVG**</span></span>](mfpkey-ravgproperty.md)<br/>                                                                                                               |
    | [<span data-ttu-id="f57a3-140">Codifica della velocità in bit a variabili con vincoli di picco</span><span class="sxs-lookup"><span data-stu-id="f57a3-140">Peak-Constrained Variable Bit Rate Encoding</span></span>](peak-constrained-variable-bit-rate--vbr--encoding.md) | [<span data-ttu-id="f57a3-141">**\_PASSESUSED MFPKEY**</span><span class="sxs-lookup"><span data-stu-id="f57a3-141">**MFPKEY\_PASSESUSED**</span></span>](mfpkey-passesusedproperty.md)<br/> [<span data-ttu-id="f57a3-142">**\_VBRENABLED MFPKEY**</span><span class="sxs-lookup"><span data-stu-id="f57a3-142">**MFPKEY\_VBRENABLED**</span></span>](mfpkey-vbrenabledproperty.md)<br/> [<span data-ttu-id="f57a3-143">**\_BAVG MFPKEY**</span><span class="sxs-lookup"><span data-stu-id="f57a3-143">**MFPKEY\_BAVG**</span></span>](mfpkey-bavgproperty.md)<br/> [<span data-ttu-id="f57a3-144">**\_RAVG MFPKEY**</span><span class="sxs-lookup"><span data-stu-id="f57a3-144">**MFPKEY\_RAVG**</span></span>](mfpkey-ravgproperty.md)<br/> [<span data-ttu-id="f57a3-145">**\_BMAX MFPKEY**</span><span class="sxs-lookup"><span data-stu-id="f57a3-145">**MFPKEY\_BMAX**</span></span>](mfpkey-bmaxproperty.md)<br/> [<span data-ttu-id="f57a3-146">**\_Rmax MFPKEY**</span><span class="sxs-lookup"><span data-stu-id="f57a3-146">**MFPKEY\_RMAX**</span></span>](mfpkey-rmaxproperty.md)<br/> |

    

     

12. <span data-ttu-id="f57a3-147">Creare il sink di file ASF e aggiungere i sink di flusso necessari a seconda dei flussi che si desidera includere nel file di output finale.</span><span class="sxs-lookup"><span data-stu-id="f57a3-147">Create the ASF file sink and add the required stream sinks depending on the streams you want to include in the final output file.</span></span>
13. <span data-ttu-id="f57a3-148">Impostare le proprietà del codificatore recuperate nel passaggio 11 sul sink di file.</span><span class="sxs-lookup"><span data-stu-id="f57a3-148">Set the encoder properties retrieved in step 11 on the file sink.</span></span>
14. <span data-ttu-id="f57a3-149">Sostituire il sink multimediale nel nodo di output con il sink di file appena creato.</span><span class="sxs-lookup"><span data-stu-id="f57a3-149">Replace the media sink in the output node with the newly created file sink.</span></span>
15. <span data-ttu-id="f57a3-150">Creare un'istanza della sessione multimediale e impostare la topologia aggiornata nella sessione multimediale.</span><span class="sxs-lookup"><span data-stu-id="f57a3-150">Instantiate the Media Session and set the updated topology on the Media Session.</span></span>
16. <span data-ttu-id="f57a3-151">Eseguire il secondo passaggio di codifica controllando la sessione multimediale e ricevendo tutti gli eventi rilevanti dalla sessione multimediale.</span><span class="sxs-lookup"><span data-stu-id="f57a3-151">Run second encoding pass by controlling the Media Session and getting all the relevant events from the Media Session.</span></span>
17. <span data-ttu-id="f57a3-152">Attendere l'evento [MEEndOfPresentation](meendofpresentation.md) dalla sessione multimediale e nel gestore dell'evento ottenere i valori delle proprietà di codifica dal codificatore e impostarli nel sink di file.</span><span class="sxs-lookup"><span data-stu-id="f57a3-152">Wait for the [MEEndOfPresentation](meendofpresentation.md) event from the Media Session and in the event handler get the encoding property values from the encoder and set them on the file sink.</span></span> <span data-ttu-id="f57a3-153">Per ulteriori informazioni, vedere l'argomento relativo all'aggiornamento delle proprietà di codifica nel sink di file in [esercitazione: codifica Windows Media single pass](tutorial--1-pass-windows-media-encoding.md).</span><span class="sxs-lookup"><span data-stu-id="f57a3-153">For more information, see "Update Encoding Properties in the File Sink" in [Tutorial: Single Pass Windows Media Encoding](tutorial--1-pass-windows-media-encoding.md).</span></span>
18. <span data-ttu-id="f57a3-154">Chiudere e arrestare la sessione di codifica.</span><span class="sxs-lookup"><span data-stu-id="f57a3-154">Close and shutdown the encoding session.</span></span>

## <a name="related-topics"></a><span data-ttu-id="f57a3-155">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="f57a3-155">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="f57a3-156">Componenti ASF a livello pipeline</span><span class="sxs-lookup"><span data-stu-id="f57a3-156">Pipeline Layer ASF Components</span></span>](pipeline-layer-asf-components.md)
</dt> </dl>

 

 




