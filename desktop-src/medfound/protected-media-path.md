---
description: 'Questo argomento illustra tre argomenti correlati: ambiente protetto, gateway di interoperabilità multimediale, revoca e rinnovo.'
ms.assetid: e88806ae-0041-4b4a-a8df-69718a651e82
title: Percorso supporto protetto
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 7304edadf1623d41bc2f1f5c6b2b4cda2dd5f598
ms.sourcegitcommit: c16214e53680dc71d1c07111b51f72b82a4512d8
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/03/2021
ms.locfileid: "104562673"
---
# <a name="protected-media-path"></a><span data-ttu-id="2fa4e-103">Percorso supporto protetto</span><span class="sxs-lookup"><span data-stu-id="2fa4e-103">Protected Media Path</span></span>

<span data-ttu-id="2fa4e-104">Questo argomento illustra tre argomenti correlati: ambiente protetto, gateway di interoperabilità multimediale, revoca e rinnovo.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-104">This topic discusses three interrelated topics: protected environment, media interoperability gateway, and revocation and renewal.</span></span>

-   <span data-ttu-id="2fa4e-105">Un ambiente protetto (PE) è un set di tecnologie che consente il flusso di contenuti protetti da e verso Windows Vista in modo protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-105">A protected environment (PE) is a set of technologies that enables protected content to flow from and through Windows Vista in a protected fashion.</span></span> <span data-ttu-id="2fa4e-106">Tutti i componenti all'interno di un ambiente protetto sono attendibili e il processo viene protetto da eventuali manomissioni.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-106">All components inside a protected environment are trusted and the process is protected against tampering.</span></span>
-   <span data-ttu-id="2fa4e-107">Il percorso multimediale protetto (PMP) è un eseguibile che viene eseguito in un ambiente protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-107">The protected media path (PMP) is an executable that runs in a protected environment.</span></span>
-   <span data-ttu-id="2fa4e-108">Se un componente attendibile nel PE viene compromesso, dopo la scadenza del processo verrà revocato.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-108">If a trusted component in the PE becomes compromised, after due process it will be revoked.</span></span> <span data-ttu-id="2fa4e-109">Tuttavia, Microsoft fornisce un meccanismo di rinnovo per l'installazione di una versione attendibile più recente del componente, quando ne diventa disponibile uno.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-109">However, Microsoft provides a renewal mechanism to install a newer trusted version of the component when one becomes available.</span></span>

<span data-ttu-id="2fa4e-110">Per informazioni sui componenti multimediali protetti per la firma del codice, vedere la white paper [firma del codice per i componenti multimediali protetti in Windows Vista](/windows-hardware/test/hlk/).</span><span class="sxs-lookup"><span data-stu-id="2fa4e-110">For information about code signing protected media components, see the white paper [Code Signing for Protected Media Components in Windows Vista](/windows-hardware/test/hlk/).</span></span>

<span data-ttu-id="2fa4e-111">In questo argomento sono incluse le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="2fa4e-111">This topic contains the following sections:</span></span>

-   [<span data-ttu-id="2fa4e-112">Ambiente protetto</span><span class="sxs-lookup"><span data-stu-id="2fa4e-112">Protected Environment</span></span>](#protected-environment)
-   [<span data-ttu-id="2fa4e-113">Progettazione dell'ambiente protetto</span><span class="sxs-lookup"><span data-stu-id="2fa4e-113">Design of the Protected Environment</span></span>](#design-of-the-protected-environment)
-   [<span data-ttu-id="2fa4e-114">Percorso supporto protetto</span><span class="sxs-lookup"><span data-stu-id="2fa4e-114">Protected Media Path</span></span>](#protected-media-path)
    -   [<span data-ttu-id="2fa4e-115">Autorità di attendibilità di input</span><span class="sxs-lookup"><span data-stu-id="2fa4e-115">Input Trust Authorities</span></span>](#input-trust-authorities)
    -   [<span data-ttu-id="2fa4e-116">Autorità di attendibilità di output</span><span class="sxs-lookup"><span data-stu-id="2fa4e-116">Output Trust Authorities</span></span>](#output-trust-authorities)
    -   [<span data-ttu-id="2fa4e-117">Oggetti Criteri</span><span class="sxs-lookup"><span data-stu-id="2fa4e-117">Policy Objects</span></span>](#policy-objects)
    -   [<span data-ttu-id="2fa4e-118">Creazione di oggetti in PMP</span><span class="sxs-lookup"><span data-stu-id="2fa4e-118">Creating Objects in the PMP</span></span>](#creating-objects-in-the-pmp)
-   [<span data-ttu-id="2fa4e-119">Panoramica della negoziazione dei criteri</span><span class="sxs-lookup"><span data-stu-id="2fa4e-119">Overview of Policy Negotiation</span></span>](#overview-of-policy-negotiation)
-   [<span data-ttu-id="2fa4e-120">Revoca e rinnovo</span><span class="sxs-lookup"><span data-stu-id="2fa4e-120">Revocation and Renewal</span></span>](#revocation-and-renewal)
-   [<span data-ttu-id="2fa4e-121">Protezione del collegamento di output</span><span class="sxs-lookup"><span data-stu-id="2fa4e-121">Output Link Protection</span></span>](#output-link-protection)
-   [<span data-ttu-id="2fa4e-122">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="2fa4e-122">Related topics</span></span>](#related-topics)

## <a name="protected-environment"></a><span data-ttu-id="2fa4e-123">Ambiente protetto</span><span class="sxs-lookup"><span data-stu-id="2fa4e-123">Protected Environment</span></span>

<span data-ttu-id="2fa4e-124">La protezione del contenuto include più tecnologie, ciascuna delle quali tenta di garantire che il contenuto non possa essere utilizzato in modo non coerente con lo scopo del proprietario o del provider del contenuto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-124">Content protection encompasses multiple technologies, each of which attempts to ensure that content cannot be used in a way that is inconsistent with the intent of the content owner or provider.</span></span> <span data-ttu-id="2fa4e-125">Queste tecnologie includono protezione da copia, protezione dei collegamenti, accesso condizionale e Digital Rights Management (DRM).</span><span class="sxs-lookup"><span data-stu-id="2fa4e-125">These technologies include copy protection, link protection, conditional access, and digital rights management (DRM).</span></span> <span data-ttu-id="2fa4e-126">La base di ogni è attendibilità: l'accesso al contenuto viene concesso solo ai componenti software che rispettano le condizioni per l'utilizzo assegnate a tale contenuto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-126">The foundation of each is trust: Access to the content is granted only to software components that adhere to the terms of use assigned to that content.</span></span>

<span data-ttu-id="2fa4e-127">Per ridurre al minimo le minacce dal contenuto protetto, Windows Vista e il software Media Foundation consentono l'esecuzione di codice attendibile in un ambiente protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-127">To minimize threats against protected content, Windows Vista and Media Foundation Software enable trusted code to run in a protected environment.</span></span> <span data-ttu-id="2fa4e-128">Un PE è un set di componenti, linee guida e strumenti progettati per migliorare la protezione contro la pirateria del contenuto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-128">A PE is a set of components, guidelines, and tools designed to increase protection against content piracy.</span></span>

<span data-ttu-id="2fa4e-129">Prima di esaminare il PE in modo più accurato, è importante comprendere le minacce che è stato progettato per ridurre al minimo.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-129">Before examining the PE more closely, it is important to understand the threats it is designed to minimize.</span></span> <span data-ttu-id="2fa4e-130">Si supponga di eseguire un'applicazione multimediale in un processo in modalità utente.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-130">Suppose you are running a media application in a user-mode process.</span></span> <span data-ttu-id="2fa4e-131">L'applicazione è collegata alle varie librerie di collegamento dinamico (dll) che contengono plug-in multimediali, ad esempio i decodificatori.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-131">The application is linked to the various dynamic link libraries (DLLs) that contain media plug-ins, such as decoders.</span></span> <span data-ttu-id="2fa4e-132">Anche altri processi vengono eseguiti in modalità utente e i vari driver vengono caricati nel kernel.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-132">Other processes are also running in user mode, and various drivers are loaded in the kernel.</span></span> <span data-ttu-id="2fa4e-133">Se non è presente alcun meccanismo di attendibilità, si verificano le minacce seguenti:</span><span class="sxs-lookup"><span data-stu-id="2fa4e-133">If no trust mechanism is in place, the following threats exist:</span></span>

-   <span data-ttu-id="2fa4e-134">L'applicazione può accedere direttamente ai supporti protetti o hackerare la memoria del processo.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-134">The application can access protected media directly or hack the process memory.</span></span>
-   <span data-ttu-id="2fa4e-135">I plug-in possono accedere direttamente al contenuto o hackerare la memoria del processo.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-135">Plug-ins can access the content directly or hack the process memory.</span></span>
-   <span data-ttu-id="2fa4e-136">Altri processi possono hackerare la memoria del processo multimediale direttamente o inserendo codice.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-136">Other processes can hack the media process memory either directly or by injecting code.</span></span>
-   <span data-ttu-id="2fa4e-137">I driver del kernel possono hackerare la memoria del processo multimediale.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-137">Kernel drivers can hack the media process memory.</span></span>
-   <span data-ttu-id="2fa4e-138">Il contenuto potrebbe essere inviato all'esterno del sistema su un supporto non protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-138">Content might be sent outside the system over an unprotected medium.</span></span> <span data-ttu-id="2fa4e-139">La protezione dei collegamenti è progettata per attenuare questa minaccia.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-139">(Link protection is designed to mitigate against this threat.)</span></span>

## <a name="design-of-the-protected-environment"></a><span data-ttu-id="2fa4e-140">Progettazione dell'ambiente protetto</span><span class="sxs-lookup"><span data-stu-id="2fa4e-140">Design of the Protected Environment</span></span>

<span data-ttu-id="2fa4e-141">Un ambiente protetto viene eseguito in un processo protetto separato dall'applicazione multimediale.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-141">A protected environment runs in a separate protected process from the media application.</span></span> <span data-ttu-id="2fa4e-142">La funzionalità processo protetto di Windows Vista impedisce ad altri processi di accedere al processo protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-142">The protected process feature of Windows Vista stops other processes from accessing the protected process.</span></span>

<span data-ttu-id="2fa4e-143">Quando viene creato un processo protetto, i componenti principali del kernel identificano i componenti e i plug-in non attendibili, in modo che l'ambiente protetto possa rifiutarne il caricamento.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-143">When a protected process is created, core kernel components identify untrusted components and plug-ins so that the protected environment can refuse to load them.</span></span> <span data-ttu-id="2fa4e-144">Un componente attendibile è uno firmato correttamente da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-144">A trusted component is one that has been appropriately signed by Microsoft.</span></span> <span data-ttu-id="2fa4e-145">Il kernel tiene traccia anche dei moduli che li caricano, consentendo all'ambiente protetto di arrestare la riproduzione del contenuto protetto se viene caricato un modulo non attendibile.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-145">The kernel also tracks modules that load into it, enabling the protected environment to stop playback of protected content if an untrusted module is loaded.</span></span> <span data-ttu-id="2fa4e-146">Prima del caricamento di un componente kernel, il kernel verifica se è attendibile.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-146">Before a kernel component is loaded, the kernel checks to determine whether it is trusted.</span></span> <span data-ttu-id="2fa4e-147">In caso contrario, i componenti attendibili già presenti nel file PE rifiutano di elaborare contenuto protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-147">If it is not, trusted components already in the PE refuse to process protected content.</span></span> <span data-ttu-id="2fa4e-148">Per abilitare questa operazione, i componenti PE eseguono periodicamente un handshake protetto da crittografia con il kernel.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-148">To enable this, PE components periodically perform a cryptographically-protected handshake with the kernel.</span></span> <span data-ttu-id="2fa4e-149">Se è presente un componente della modalità kernel non attendibile, l'handshake ha esito negativo e indica al PE che un componente non attendibile esiste.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-149">If an untrusted kernel mode component is present, the handshake fails and indicates to the PE that an untrusted component exists.</span></span>

<span data-ttu-id="2fa4e-150">Se un componente attendibile viene compromesso, dopo la scadenza del processo può essere revocato.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-150">If a trusted component becomes compromised, after due process it can be revoked.</span></span> <span data-ttu-id="2fa4e-151">Microsoft fornisce un meccanismo di rinnovo per installare una versione più recente attendibile, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-151">Microsoft provides a renewal mechanism to install a newer trusted version when available.</span></span>

## <a name="protected-media-path"></a><span data-ttu-id="2fa4e-152">Percorso supporto protetto</span><span class="sxs-lookup"><span data-stu-id="2fa4e-152">Protected Media Path</span></span>

<span data-ttu-id="2fa4e-153">Il percorso multimediale protetto (PMP) è il file eseguibile PE primario per Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-153">The protected media path (PMP) is the primary PE executable for Media Foundation.</span></span> <span data-ttu-id="2fa4e-154">Il PMP è estensibile, in modo che possano essere supportati i meccanismi di protezione del contenuto di terze parti.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-154">The PMP is extensible, so that third-party content protection mechanisms can be supported.</span></span>

<span data-ttu-id="2fa4e-155">Il PMP accetta il contenuto protetto e i criteri associati da qualsiasi origine Media Foundation usando qualsiasi sistema di protezione del contenuto, inclusi quelli forniti da terze parti.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-155">The PMP accepts protected content and associated policies from any Media Foundation source using any content protection system, including those provided by third parties.</span></span> <span data-ttu-id="2fa4e-156">Invia il contenuto a qualsiasi sink di Media Foundation, purché il sink sia conforme ai criteri specificati dall'origine.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-156">It sends content to any Media Foundation sink, as long as the sink complies with the policies specified by the source.</span></span> <span data-ttu-id="2fa4e-157">Supporta inoltre le trasformazioni tra l'origine e il sink, incluse le trasformazioni di terze parti, purché siano attendibili.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-157">It also supports transforms between the source and the sink, including third-party transforms, as long as they are trusted.</span></span>

<span data-ttu-id="2fa4e-158">Il PMP viene eseguito in un processo protetto isolato dall'applicazione multimediale.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-158">The PMP runs in a protected process isolated from the media application.</span></span> <span data-ttu-id="2fa4e-159">L'applicazione è in grado di scambiare i messaggi di comando e controllo con il PMP, ma non ha accesso al contenuto dopo che è stato passato a PMP.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-159">The application only has the ability to exchange command and control messages with the PMP, but does not have access to content after it is passed to the PMP.</span></span> <span data-ttu-id="2fa4e-160">La figura seguente illustra questo processo.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-160">The following diagram illustrates this process.</span></span>

![diagramma del percorso multimediale protetto](images/pmp04.png)

<span data-ttu-id="2fa4e-162">Le caselle ombreggiate rappresentano i componenti che possono essere forniti da terze parti.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-162">Shaded boxes represent components that might be provided by third parties.</span></span> <span data-ttu-id="2fa4e-163">Tutti i componenti creati nel processo protetto devono essere firmati e attendibili.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-163">All components created inside the protected process must be signed and trusted.</span></span>

<span data-ttu-id="2fa4e-164">L'applicazione crea un'istanza della sessione multimediale all'interno del processo protetto e riceve un puntatore a una sessione multimediale proxy, che effettua il marshalling dei puntatori di interfaccia attraverso il limite del processo.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-164">The application creates an instance of the Media Session inside the protected process and receives a pointer to a proxy Media Session, which marshals interface pointers across the process boundary.</span></span>

<span data-ttu-id="2fa4e-165">L'origine multimediale può essere creata all'interno del processo dell'applicazione, come illustrato di seguito, o all'interno del processo protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-165">The media source can be created either within the application process, as shown here, or inside the protected process.</span></span> <span data-ttu-id="2fa4e-166">Se l'origine multimediale viene creata all'interno del processo dell'applicazione, l'origine crea un proxy per se stesso nel processo protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-166">If the media source is created inside the application process, the source creates a proxy for itself in the protected process.</span></span>

<span data-ttu-id="2fa4e-167">Tutti gli altri componenti della pipeline, ad esempio i decodificatori e i sink multimediali, vengono creati nel processo protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-167">All other pipeline components, such as decoders and media sinks, are created in the protected process.</span></span> <span data-ttu-id="2fa4e-168">Se questi oggetti espongono interfacce personalizzate per le applicazioni, devono fornire un proxy/stub DCOM per effettuare il marshalling dell'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-168">If these objects expose any custom interfaces for applications, they must provide a DCOM proxy/stub to marshal the interface.</span></span>

<span data-ttu-id="2fa4e-169">Per applicare i criteri ai contenuti protetti mentre passano attraverso la pipeline, PMP usa tre tipi di componenti: autorità di attendibilità di input (ITAs), autorità di attendibilità di output (OTA) e oggetti criteri.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-169">To enforce policy on protected content as it flows through the pipeline, the PMP uses three types of components: input trust authorities (ITAs), output trust authorities (OTAs), and policy objects.</span></span> <span data-ttu-id="2fa4e-170">Questi componenti interagiscono per concedere o limitare i diritti di utilizzo del contenuto e per specificare le protezioni dei collegamenti che devono essere utilizzate per la riproduzione di contenuto, ad esempio High-bandwidth Digital protezione del contenuto (HDCP).</span><span class="sxs-lookup"><span data-stu-id="2fa4e-170">These components work together to grant or restrict rights to use content, and to specify the link protections that must be employed when playing content, such as High-bandwidth Digital Content Protection (HDCP).</span></span>

### <a name="input-trust-authorities"></a><span data-ttu-id="2fa4e-171">Autorità di attendibilità di input</span><span class="sxs-lookup"><span data-stu-id="2fa4e-171">Input Trust Authorities</span></span>

<span data-ttu-id="2fa4e-172">Un ITA viene creato da un'origine multimediale attendibile ed esegue diverse funzioni:</span><span class="sxs-lookup"><span data-stu-id="2fa4e-172">An ITA is created by a trusted media source, and performs several functions:</span></span>

-   <span data-ttu-id="2fa4e-173">Specifica i diritti per l'utilizzo del contenuto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-173">Specifies rights to use content.</span></span> <span data-ttu-id="2fa4e-174">I diritti possono includere il diritto di riprodurre il contenuto, trasferirlo a un dispositivo e così via.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-174">Rights can include the right to play content, transfer it to a device, and so on.</span></span> <span data-ttu-id="2fa4e-175">Definisce un elenco ordinato di sistemi di protezione dell'output approvati e i criteri di output corrispondenti per ogni sistema.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-175">It defines an ordered list of approved output protection systems and the corresponding output policies for each system.</span></span> <span data-ttu-id="2fa4e-176">In ITA le informazioni vengono archiviate in un oggetto criteri.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-176">The ITA stores this information in a policy object.</span></span>
-   <span data-ttu-id="2fa4e-177">Fornisce il decrittografia necessario per decrittografare il contenuto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-177">Provides the decryptor needed to decrypt the content.</span></span>
-   <span data-ttu-id="2fa4e-178">Stabilisce una relazione di trust con il modulo kernel nell'ambiente protetto per assicurarsi che ITA sia in esecuzione all'interno di un ambiente attendibile.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-178">Establishes trust with the kernel module in the protected environment, to ensure that the ITA is running inside a trusted environment.</span></span>

<span data-ttu-id="2fa4e-179">Un ITA è associato a un singolo flusso contenente contenuto protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-179">An ITA is associated with an individual stream containing protected content.</span></span> <span data-ttu-id="2fa4e-180">Un flusso può avere un solo ITA e un'istanza di ITA può essere associata a un solo flusso.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-180">A stream can have only one ITA, and an instance of an ITA can be associated with only one stream.</span></span>

### <a name="output-trust-authorities"></a><span data-ttu-id="2fa4e-181">Autorità di attendibilità di output</span><span class="sxs-lookup"><span data-stu-id="2fa4e-181">Output Trust Authorities</span></span>

<span data-ttu-id="2fa4e-182">Un OTA è associato a un output attendibile.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-182">An OTA is associated with a trusted output.</span></span> <span data-ttu-id="2fa4e-183">OTA espone un'azione che l'output attendibile può eseguire sul contenuto, ad esempio la riproduzione o la copia.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-183">The OTA exposes an action that the trusted output can perform on the content, such as playback or copying.</span></span> <span data-ttu-id="2fa4e-184">Il suo ruolo consiste nell'applicare uno o più sistemi di protezione dell'output necessari per ITA.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-184">Its role is to enforce one or more output protection systems that are required by the ITA.</span></span> <span data-ttu-id="2fa4e-185">OTA esegue una query sull'oggetto criteri fornito da ITA per determinare il sistema di protezione che deve applicare.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-185">The OTA queries the policy object provided by ITA to determine which protection system it must enforce.</span></span>

### <a name="policy-objects"></a><span data-ttu-id="2fa4e-186">Oggetti Criteri</span><span class="sxs-lookup"><span data-stu-id="2fa4e-186">Policy Objects</span></span>

<span data-ttu-id="2fa4e-187">Un oggetto Criteri incapsula i requisiti di protezione del contenuto di un ITA.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-187">A policy object encapsulates the content protection requirements of an ITA.</span></span> <span data-ttu-id="2fa4e-188">Viene usato dal motore dei criteri per negoziare il supporto della protezione del contenuto con un OTA.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-188">It is used by the policy engine to negotiate content protection support with an OTA.</span></span> <span data-ttu-id="2fa4e-189">OTA oggetti Criteri di query per determinare i sistemi di protezione che devono applicare a ogni output del contenuto corrente.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-189">OTAs query policy objects to determine what protection systems they must enforce on each output of the current content.</span></span>

### <a name="creating-objects-in-the-pmp"></a><span data-ttu-id="2fa4e-190">Creazione di oggetti in PMP</span><span class="sxs-lookup"><span data-stu-id="2fa4e-190">Creating Objects in the PMP</span></span>

<span data-ttu-id="2fa4e-191">Per creare un oggetto nel percorso multimediale protetto (PMP), [**IMFMediaSource**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasource) chiama [**IMFPMPHostApp:: ActivateClassById**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphostapp-activateclassbyid), con il formato **IStream** di input specificato nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="2fa4e-191">To create an object in the protected media path (PMP), the [**IMFMediaSource**](/windows/desktop/api/mfidl/nn-mfidl-imfmediasource) calls [**IMFPMPHostApp::ActivateClassById**](/windows/desktop/api/mfidl/nf-mfidl-imfpmphostapp-activateclassbyid), with the specified input **IStream** formatted in the following way:</span></span>

``` syntax
Format: (All DWORD values are serialized in little-endian order)
[GUID (content protection system guid, obtained from Windows.Media.Protection.MediaProtectionSystemId)]
[DWORD (track count, use the actual track count even if all tracks are encrypted using the same data, note that zero is invalid)]
[DWORD (next track ID, use -1 if all remaining tracks are encrypted using the same data)]
[DWORD (next track's binary data size)]
[BYTE* (next track's binary data)]
{ Repeat from "next track ID" above for each stream }
```

## <a name="overview-of-policy-negotiation"></a><span data-ttu-id="2fa4e-192">Panoramica della negoziazione dei criteri</span><span class="sxs-lookup"><span data-stu-id="2fa4e-192">Overview of Policy Negotiation</span></span>

<span data-ttu-id="2fa4e-193">Esistono tre requisiti fondamentali che devono essere soddisfatti prima che il contenuto protetto possa essere elaborato in PMP.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-193">There are three fundamental requirements that must be met before protected content can be processed in the PMP.</span></span> <span data-ttu-id="2fa4e-194">Per prima cosa, il contenuto protetto deve essere inviato solo a output attendibili.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-194">First, protected content must be sent only to trusted outputs.</span></span> <span data-ttu-id="2fa4e-195">In secondo luogo, è necessario applicare solo le azioni consentite a un flusso.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-195">Second, only permitted actions must be applied to a stream.</span></span> <span data-ttu-id="2fa4e-196">Terzo, per riprodurre un flusso è necessario usare solo i sistemi di protezione dell'output approvati.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-196">Third, only approved output protection systems must be used to play a stream.</span></span> <span data-ttu-id="2fa4e-197">Il motore dei criteri coordina tra ITAs e OTA per assicurarsi che questi requisiti siano soddisfatti.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-197">The policy engine coordinates between ITAs and OTAs to ensure that these requirements are met.</span></span>

<span data-ttu-id="2fa4e-198">Il modo più semplice per comprendere il processo consiste nell'esaminare un esempio semplificato che identifichi i passaggi necessari per riprodurre il contenuto di Advanced System Format (ASF) protetto da Windows Media Digital Rights Management (WMDRM).</span><span class="sxs-lookup"><span data-stu-id="2fa4e-198">The easiest way to understand process is to walk through a simplified example that identifies the steps necessary to play Advanced System Format (ASF) content protected by Windows Media Digital Rights Management (WMDRM).</span></span>

<span data-ttu-id="2fa4e-199">Quando un utente avvia un'applicazione Player e apre un file ASF con un flusso audio protetto e un flusso video protetto, è necessario eseguire i passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="2fa4e-199">When a user launches a player application and opens an ASF file that has a protected audio stream and a protected video stream, the following steps must be performed:</span></span>

1.  <span data-ttu-id="2fa4e-200">L'applicazione crea l'origine del supporto ASF e la sessione del percorso multimediale protetto (PMP).</span><span class="sxs-lookup"><span data-stu-id="2fa4e-200">The application creates the ASF media source and the protected media path (PMP) session.</span></span> <span data-ttu-id="2fa4e-201">Media Foundation crea un processo PMP.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-201">Media Foundation creates a PMP process.</span></span>
2.  <span data-ttu-id="2fa4e-202">L'applicazione crea una topologia parziale che contiene un nodo di origine audio connesso al renderer audio e un nodo di origine video connesso al renderer video avanzato (EVR).</span><span class="sxs-lookup"><span data-stu-id="2fa4e-202">The application creates a partial topology that contains an audio source node connected to the audio renderer, and a video source node connected to the enhanced video renderer (EVR).</span></span> <span data-ttu-id="2fa4e-203">Per i renderer, l'applicazione non crea direttamente il renderer.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-203">For the renderers, the application does not directly create the renderer.</span></span> <span data-ttu-id="2fa4e-204">Al contrario, l'applicazione crea nel processo non protetto un oggetto noto come oggetto di *attivazione*.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-204">Instead, the application creates in the unprotected process an object known as an *activation object*.</span></span> <span data-ttu-id="2fa4e-205">Il PMP usa l'oggetto Activation per creare i renderer nel processo protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-205">The PMP uses the activation object to create the renderers in the protected process.</span></span> <span data-ttu-id="2fa4e-206">Per ulteriori informazioni sugli oggetti attivazione, vedere [oggetti attivazione](activation-objects.md).</span><span class="sxs-lookup"><span data-stu-id="2fa4e-206">(For more information about activation objects, see [Activation Objects](activation-objects.md).)</span></span>
3.  <span data-ttu-id="2fa4e-207">L'applicazione imposta la topologia parziale nella sessione PMP.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-207">The application sets the partial topology on the PMP session.</span></span>
4.  <span data-ttu-id="2fa4e-208">La sessione PMP serializza la topologia e la passa all'host PMP nel processo protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-208">The PMP session serializes the topology and passes it to the PMP host in the protected process.</span></span> <span data-ttu-id="2fa4e-209">L'host PMP Invia la topologia al motore dei criteri.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-209">The PMP host sends the topology to the policy engine.</span></span>
5.  <span data-ttu-id="2fa4e-210">Il caricatore della topologia chiama [**IMFInputTrustAuthority:: Decryptor**](/windows/desktop/api/mfidl/nf-mfidl-imfinputtrustauthority-getdecrypter) in ITAs e inserisce i decrittografatori nella topologia immediatamente a valle dei nodi di origine corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-210">The topology loader calls [**IMFInputTrustAuthority::GetDecrypter**](/windows/desktop/api/mfidl/nf-mfidl-imfinputtrustauthority-getdecrypter) on the ITAs and inserts the decrypters into the topology immediately downstream of the corresponding source nodes.</span></span>
6.  <span data-ttu-id="2fa4e-211">Il caricatore della topologia inserisce i decodificatori audio e video a valle dei nodi Decrypter.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-211">The topology loader inserts the audio and video decoders downstream of the decrypter nodes.</span></span>
7.  <span data-ttu-id="2fa4e-212">Il motore dei criteri analizza i nodi inseriti per determinare se implementare l'interfaccia [**IMFTrustedOutput**](/windows/desktop/api/mfidl/nn-mfidl-imftrustedoutput) .</span><span class="sxs-lookup"><span data-stu-id="2fa4e-212">The policy engine scans the inserted nodes to determine whether any implement the [**IMFTrustedOutput**](/windows/desktop/api/mfidl/nn-mfidl-imftrustedoutput) interface.</span></span> <span data-ttu-id="2fa4e-213">I EVR e il renderer audio implementano entrambi **IMFTrustedOutput**, perché inviano dati all'esterno di PMP.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-213">The EVR and the audio renderer both implement **IMFTrustedOutput**, because they send data outside the PMP.</span></span>
8.  <span data-ttu-id="2fa4e-214">Ogni ITA conferma che l'esecuzione avviene all'interno di un processo protetto mediante l'esecuzione di un handshake crittografico con un modulo kernel dell'ambiente protetto.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-214">Each ITA confirms that it is running inside a protected process by performing a cryptographic handshake with a protected environment kernel module.</span></span>
9.  <span data-ttu-id="2fa4e-215">Per ogni flusso, il motore dei criteri negozia i criteri ottenendo un oggetto criteri da ITA e passandolo a OTA.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-215">For each stream, the policy engine negotiates policy by getting a policy object from the ITA and passing it to the OTA.</span></span> <span data-ttu-id="2fa4e-216">OTA fornisce un elenco dei sistemi di protezione supportati e l'oggetto criterio indica quali sistemi di protezione devono essere applicati, insieme alle impostazioni corrette.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-216">The OTA provides a list of the protection systems that it supports, and the policy object indicates which protection systems must be applied, along with the correct settings.</span></span> <span data-ttu-id="2fa4e-217">Il OTA applica quindi queste impostazioni.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-217">The OTA then applies these settings.</span></span> <span data-ttu-id="2fa4e-218">In caso contrario, il contenuto viene bloccato.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-218">If it cannot do so, the content is blocked.</span></span>

## <a name="revocation-and-renewal"></a><span data-ttu-id="2fa4e-219">Revoca e rinnovo</span><span class="sxs-lookup"><span data-stu-id="2fa4e-219">Revocation and Renewal</span></span>

<span data-ttu-id="2fa4e-220">Un componente attendibile può essere revocato se viene compromesso o viene individuato per violare i contratti di licenza in cui è stato inizialmente considerato attendibile.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-220">A trusted component can be revoked if it becomes compromised or is discovered to be violating the license agreements under which it was initially trusted.</span></span> <span data-ttu-id="2fa4e-221">Un meccanismo di rinnovo esiste per installare una versione più recente e più attendibile del componente.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-221">A renewal mechanism exists to install a newer, more trusted version of the component.</span></span>

<span data-ttu-id="2fa4e-222">I componenti attendibili vengono firmati utilizzando un certificato crittografico.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-222">Trusted components are signed using a cryptographic certificate.</span></span> <span data-ttu-id="2fa4e-223">Microsoft pubblica un elenco di revoche globali (GRL) che identifica i componenti che sono stati revocati.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-223">Microsoft publishes a global revocation list (GRL) which identifies components that have been revoked.</span></span> <span data-ttu-id="2fa4e-224">GRL è firmato digitalmente per garantirne l'autenticità.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-224">The GRL is digitally signed to ensure its authenticity.</span></span> <span data-ttu-id="2fa4e-225">I proprietari del contenuto possono garantire, tramite il meccanismo dei criteri, che la versione corrente di GRL sia presente nel computer dell'utente.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-225">Content owners can ensure, through the policy mechanism, that the current version of the GRL is present on the user's computer.</span></span>

## <a name="output-link-protection"></a><span data-ttu-id="2fa4e-226">Protezione del collegamento di output</span><span class="sxs-lookup"><span data-stu-id="2fa4e-226">Output Link Protection</span></span>

<span data-ttu-id="2fa4e-227">Quando viene visualizzato il contenuto video Premium, i frame decrittografati e non compressi passano attraverso un connettore fisico al dispositivo di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-227">When premium video content is viewed, the decrypted, uncompressed frames travel across a physical connector to the display device.</span></span> <span data-ttu-id="2fa4e-228">I provider di contenuti possono richiedere che i fotogrammi video siano protetti a questo punto, mentre si spostano sul connettore fisico.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-228">Content providers may require the video frames to be protected at this point, as they travel across the physical connector.</span></span> <span data-ttu-id="2fa4e-229">A questo scopo esistono diversi meccanismi di protezione, tra cui High-Bandwidth Digital protezione del contenuto (HDCP) e DisplayPort protezione del contenuto (DPCP).</span><span class="sxs-lookup"><span data-stu-id="2fa4e-229">Various protection mechanisms exist for this purpose, including High-Bandwidth Digital Content Protection (HDCP) and DisplayPort Content Protection (DPCP).</span></span> <span data-ttu-id="2fa4e-230">Il video OTA impone queste protezioni usando l' [Output Protection Manager](output-protection-manager.md) (OPM).</span><span class="sxs-lookup"><span data-stu-id="2fa4e-230">The video OTA enforces these protections by using the [Output Protection Manager](output-protection-manager.md) (OPM).</span></span> <span data-ttu-id="2fa4e-231">L'output Protection Manager invia comandi al driver di grafica e il driver di grafica impone tutti i meccanismi di protezione dei collegamenti richiesti dai criteri.</span><span class="sxs-lookup"><span data-stu-id="2fa4e-231">The Output Protection Manager sends commands to the graphics driver, and the graphics driver enforces whatever link protection mechanisms are required by the policy.</span></span>

![diagramma che mostra la relazione tra il video OTA e OPM.](images/pmp05.png)

## <a name="related-topics"></a><span data-ttu-id="2fa4e-233">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="2fa4e-233">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="2fa4e-234">Informazioni su Media Foundation</span><span class="sxs-lookup"><span data-stu-id="2fa4e-234">About Media Foundation</span></span>](about-the-media-foundation-sdk.md)
</dt> <dt>

[<span data-ttu-id="2fa4e-235">Architettura di Media Foundation</span><span class="sxs-lookup"><span data-stu-id="2fa4e-235">Media Foundation Architecture</span></span>](media-foundation-architecture.md)
</dt> <dt>

[<span data-ttu-id="2fa4e-236">protezione del contenuto basate su GPU</span><span class="sxs-lookup"><span data-stu-id="2fa4e-236">GPU-Based Content Protection</span></span>](gpu-based-content-protection.md)
</dt> <dt>

[<span data-ttu-id="2fa4e-237">Gestione protezione output</span><span class="sxs-lookup"><span data-stu-id="2fa4e-237">Output Protection Manager</span></span>](output-protection-manager.md)
</dt> <dt>

[<span data-ttu-id="2fa4e-238">Sessione multimediale PMP</span><span class="sxs-lookup"><span data-stu-id="2fa4e-238">PMP Media Session</span></span>](pmp-media-session.md)
</dt> </dl>

 

 
