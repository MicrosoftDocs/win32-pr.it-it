---
description: Questo argomento descrive il modo in cui un client usa una trasformazione Media Foundation (MFT) per elaborare i dati. Il client è qualsiasi elemento che chiama direttamente i metodi in MFT. Potrebbe trattarsi dell'applicazione o della pipeline Media Foundation.
ms.assetid: be977d75-999e-4e57-9672-00a89246a2c1
title: Modello di elaborazione MFT di base
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9ca54df6d9765aaf54456c3d9dc4461a82a93d41
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104049325"
---
# <a name="basic-mft-processing-model"></a><span data-ttu-id="5ee31-105">Modello di elaborazione MFT di base</span><span class="sxs-lookup"><span data-stu-id="5ee31-105">Basic MFT Processing Model</span></span>

<span data-ttu-id="5ee31-106">Questo argomento descrive il modo in cui un client usa una trasformazione Media Foundation (MFT) per elaborare i dati.</span><span class="sxs-lookup"><span data-stu-id="5ee31-106">This topic describes how a client uses a Media Foundation transform (MFT) to process data.</span></span> <span data-ttu-id="5ee31-107">Il *client* è qualsiasi elemento che chiama direttamente i metodi in MFT.</span><span class="sxs-lookup"><span data-stu-id="5ee31-107">The *client* is anything that directly calls methods on the MFT.</span></span> <span data-ttu-id="5ee31-108">Potrebbe trattarsi dell'applicazione o della pipeline Media Foundation.</span><span class="sxs-lookup"><span data-stu-id="5ee31-108">This might be the application or the Media Foundation pipeline.</span></span>

<span data-ttu-id="5ee31-109">Leggere questo argomento se:</span><span class="sxs-lookup"><span data-stu-id="5ee31-109">Read this topic if you are:</span></span>

-   <span data-ttu-id="5ee31-110">Scrittura di un'applicazione che effettua chiamate dirette a uno o più MFTs.</span><span class="sxs-lookup"><span data-stu-id="5ee31-110">Writing an application that makes direct calls to one or more MFTs.</span></span>
-   <span data-ttu-id="5ee31-111">Scrittura di un MFT personalizzato e desidera comprendere il comportamento previsto di un MFT.</span><span class="sxs-lookup"><span data-stu-id="5ee31-111">Writing a custom MFT and want to understand the expected behavior of an MFT.</span></span>

<span data-ttu-id="5ee31-112">In questo argomento viene descritto un modello di elaborazione *sincrona* .</span><span class="sxs-lookup"><span data-stu-id="5ee31-112">This topic describes a *synchronous* processing model.</span></span> <span data-ttu-id="5ee31-113">In questo modello tutti i metodi di elaborazione dati si bloccano fino a quando non vengono completati.</span><span class="sxs-lookup"><span data-stu-id="5ee31-113">In this model, all data-processing methods block until they complete.</span></span> <span data-ttu-id="5ee31-114">MFTs può inoltre supportare un modello *asincrono* , descritto nell'argomento [MFTS asincrono](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="5ee31-114">MFTs can also support an *asynchronous* model, which is described in the topic [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

-   [<span data-ttu-id="5ee31-115">Modello di elaborazione di base</span><span class="sxs-lookup"><span data-stu-id="5ee31-115">Basic Processing Model</span></span>](#basic-processing-model)
    -   [<span data-ttu-id="5ee31-116">Creare il MFT</span><span class="sxs-lookup"><span data-stu-id="5ee31-116">Create the MFT</span></span>](#create-the-mft)
    -   [<span data-ttu-id="5ee31-117">Ottenere gli identificatori di flusso</span><span class="sxs-lookup"><span data-stu-id="5ee31-117">Get Stream Identifiers</span></span>](#get-stream-identifiers)
    -   [<span data-ttu-id="5ee31-118">Imposta tipi di supporto</span><span class="sxs-lookup"><span data-stu-id="5ee31-118">Set Media Types</span></span>](#set-media-types)
    -   [<span data-ttu-id="5ee31-119">Ottenere i requisiti del buffer</span><span class="sxs-lookup"><span data-stu-id="5ee31-119">Get Buffer Requirements</span></span>](#get-buffer-requirements)
    -   [<span data-ttu-id="5ee31-120">Elaborare i dati</span><span class="sxs-lookup"><span data-stu-id="5ee31-120">Process Data</span></span>](#process-data)
-   [<span data-ttu-id="5ee31-121">Estensioni al modello di base</span><span class="sxs-lookup"><span data-stu-id="5ee31-121">Extensions to the Basic Model</span></span>](#extensions-to-the-basic-model)
-   [<span data-ttu-id="5ee31-122">IMF2DBuffer</span><span class="sxs-lookup"><span data-stu-id="5ee31-122">IMF2DBuffer</span></span>](#imf2dbuffer)
-   [<span data-ttu-id="5ee31-123">Scaricamento di un MFT</span><span class="sxs-lookup"><span data-stu-id="5ee31-123">Flushing an MFT</span></span>](#flushing-an-mft)
-   [<span data-ttu-id="5ee31-124">Svuotamento di un MFT</span><span class="sxs-lookup"><span data-stu-id="5ee31-124">Draining an MFT</span></span>](#draining-an-mft)
-   [<span data-ttu-id="5ee31-125">Attributi di esempio</span><span class="sxs-lookup"><span data-stu-id="5ee31-125">Sample Attributes</span></span>](#sample-attributes)
-   [<span data-ttu-id="5ee31-126">Discontinuità</span><span class="sxs-lookup"><span data-stu-id="5ee31-126">Discontinuities</span></span>](#discontinuities)
-   [<span data-ttu-id="5ee31-127">Modifiche al formato dinamico</span><span class="sxs-lookup"><span data-stu-id="5ee31-127">Dynamic Format Changes</span></span>](#dynamic-format-changes)
-   [<span data-ttu-id="5ee31-128">Eventi di flusso</span><span class="sxs-lookup"><span data-stu-id="5ee31-128">Stream Events</span></span>](#stream-events)
-   [<span data-ttu-id="5ee31-129">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="5ee31-129">Related topics</span></span>](#related-topics)

## <a name="basic-processing-model"></a><span data-ttu-id="5ee31-130">Modello di elaborazione di base</span><span class="sxs-lookup"><span data-stu-id="5ee31-130">Basic Processing Model</span></span>

### <a name="create-the-mft"></a><span data-ttu-id="5ee31-131">Creare il MFT</span><span class="sxs-lookup"><span data-stu-id="5ee31-131">Create the MFT</span></span>

<span data-ttu-id="5ee31-132">Esistono diversi modi per creare un MFT:</span><span class="sxs-lookup"><span data-stu-id="5ee31-132">There are several ways to create an MFT:</span></span>

-   <span data-ttu-id="5ee31-133">Chiamare la funzione [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) .</span><span class="sxs-lookup"><span data-stu-id="5ee31-133">Call the [**MFTEnum**](/windows/desktop/api/mfapi/nf-mfapi-mftenum) function.</span></span>
-   <span data-ttu-id="5ee31-134">Chiamare la funzione [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) .</span><span class="sxs-lookup"><span data-stu-id="5ee31-134">Call the [**MFTEnumEx**](/windows/desktop/api/mfapi/nf-mfapi-mftenumex) function.</span></span>
-   <span data-ttu-id="5ee31-135">Se si conosce già il CLSID della MFT, è sufficiente chiamare **CoCreateInstance**.</span><span class="sxs-lookup"><span data-stu-id="5ee31-135">If you already know the CLSID of the MFT, simply call **CoCreateInstance**.</span></span>

<span data-ttu-id="5ee31-136">Alcuni MFTs potrebbero fornire altre opzioni, ad esempio una funzione di creazione specializzata.</span><span class="sxs-lookup"><span data-stu-id="5ee31-136">Some MFTs might provide other options, such as a specialized creation function.</span></span>

### <a name="get-stream-identifiers"></a><span data-ttu-id="5ee31-137">Ottenere gli identificatori di flusso</span><span class="sxs-lookup"><span data-stu-id="5ee31-137">Get Stream Identifiers</span></span>

<span data-ttu-id="5ee31-138">Un MFT ha uno o più *flussi*.</span><span class="sxs-lookup"><span data-stu-id="5ee31-138">An MFT has one or more *streams*.</span></span> <span data-ttu-id="5ee31-139">I flussi di input ricevono i dati di input e i flussi di output generano dati di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-139">Input streams receive input data, and output streams generate output data.</span></span> <span data-ttu-id="5ee31-140">I flussi non sono rappresentati come oggetti distinti.</span><span class="sxs-lookup"><span data-stu-id="5ee31-140">Streams are not represented as distinct objects.</span></span> <span data-ttu-id="5ee31-141">Al contrario, diversi metodi MFT accettano gli identificatori di flusso come parametri.</span><span class="sxs-lookup"><span data-stu-id="5ee31-141">Instead, various MFT methods take stream identifiers as parameters.</span></span>

<span data-ttu-id="5ee31-142">Alcuni MFTs consentono al client di aggiungere o rimuovere flussi di input.</span><span class="sxs-lookup"><span data-stu-id="5ee31-142">Some MFTs allow the client to add or remove input streams.</span></span> <span data-ttu-id="5ee31-143">Durante lo streaming, un MFT può aggiungere o rimuovere flussi di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-143">During streaming, an MFT can add or remove output streams.</span></span> <span data-ttu-id="5ee31-144">Il client non è in grado di aggiungere o rimuovere flussi di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-144">(The client cannot add or remove output streams.)</span></span>

1.  <span data-ttu-id="5ee31-145">(Facoltativo). Chiamare [**IMFTransform:: GetStreamLimits**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamlimits) per ottenere il numero minimo e massimo di flussi che il MFT può supportare.</span><span class="sxs-lookup"><span data-stu-id="5ee31-145">(Optional.) Call [**IMFTransform::GetStreamLimits**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamlimits) to get the minimum and maximum number of streams that the MFT can support.</span></span> <span data-ttu-id="5ee31-146">Se il valore minimo e massimo sono gli stessi, la MFT dispone di un numero fisso di flussi.</span><span class="sxs-lookup"><span data-stu-id="5ee31-146">If the minimum and maximum are the same, the MFT has a fixed number of streams.</span></span>
2.  <span data-ttu-id="5ee31-147">Chiamare [**IMFTransform:: GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) per ottenere il numero iniziale di flussi.</span><span class="sxs-lookup"><span data-stu-id="5ee31-147">Call [**IMFTransform::GetStreamCount**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamcount) to get the initial number of streams.</span></span>
3.  <span data-ttu-id="5ee31-148">Chiamare [**IMFTransform:: GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) per ottenere gli identificatori del flusso.</span><span class="sxs-lookup"><span data-stu-id="5ee31-148">Call [**IMFTransform::GetStreamIDs**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getstreamids) to get the stream identifiers.</span></span> <span data-ttu-id="5ee31-149">Se questo metodo restituisce E \_ NOTIMPL, significa che la MFT ha un numero fisso di flussi e gli identificatori di flusso sono consecutivi a partire da zero.</span><span class="sxs-lookup"><span data-stu-id="5ee31-149">If this method returns E\_NOTIMPL, it means the MFT has a fixed number of streams, and the stream identifiers are consecutive starting from zero.</span></span>
4.  <span data-ttu-id="5ee31-150">(Facoltativo). Se MFT non dispone di un numero fisso di flussi, chiamare [**IMFTransform:: AddInputStreams**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-addinputstreams) per aggiungere altri flussi di input o [**IMFTransform::D eleteinputstream**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-deleteinputstream) per rimuovere i flussi di input.</span><span class="sxs-lookup"><span data-stu-id="5ee31-150">(Optional.) If the MFT does not have a fixed number of streams, call [**IMFTransform::AddInputStreams**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-addinputstreams) to add more input streams, or [**IMFTransform::DeleteInputStream**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-deleteinputstream) to remove input streams.</span></span> <span data-ttu-id="5ee31-151">Non è possibile aggiungere o rimuovere flussi di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-151">(You cannot add or remove output streams.)</span></span>

### <a name="set-media-types"></a><span data-ttu-id="5ee31-152">Imposta tipi di supporto</span><span class="sxs-lookup"><span data-stu-id="5ee31-152">Set Media Types</span></span>

<span data-ttu-id="5ee31-153">Prima che un MFT possa elaborare i dati, il client deve impostare un tipo di supporto per ognuno dei flussi della MFT.</span><span class="sxs-lookup"><span data-stu-id="5ee31-153">Before an MFT can process data, the client must set a media types for each of the streams of the MFT.</span></span> <span data-ttu-id="5ee31-154">Un MFT potrebbe richiedere che il client imposti i tipi di input prima di impostare i tipi di output o potrebbe richiedere l'ordine opposto (prima i tipi di output).</span><span class="sxs-lookup"><span data-stu-id="5ee31-154">An MFT might require that the client set the input types before setting the output types, or might require the opposite order (output types first).</span></span> <span data-ttu-id="5ee31-155">Alcuni MFTs non hanno un requisito per l'ordine.</span><span class="sxs-lookup"><span data-stu-id="5ee31-155">Some MFTs do not have a requirement on the order.</span></span>

<span data-ttu-id="5ee31-156">Una MFT può fornire un elenco di tipi di supporti preferiti per un flusso.</span><span class="sxs-lookup"><span data-stu-id="5ee31-156">An MFT can provide a list of preferred media types for a stream.</span></span> <span data-ttu-id="5ee31-157">Inoltre, MFTs può indicare i formati generali supportati aggiungendo queste informazioni al registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="5ee31-157">Also, MFTs can indicate the general formats that they support by adding this information to the registry.</span></span>

<span data-ttu-id="5ee31-158">Per impostare i tipi di supporto, effettuare le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="5ee31-158">To set the media types, do the following:</span></span>

1.  <span data-ttu-id="5ee31-159">(Facoltativo). Per ogni flusso di input, chiamare [**IMFTransform:: GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) per ottenere l'elenco di tipi preferiti per quel flusso.</span><span class="sxs-lookup"><span data-stu-id="5ee31-159">(Optional.) For each input stream, call [**IMFTransform::GetInputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputavailabletype) to get the list of preferred types for that stream.</span></span>
    -   <span data-ttu-id="5ee31-160">Se questo metodo restituisce \_ \_ il tipo di trasformazione MF E \_ \_ non \_ impostato, è necessario impostare prima i tipi di output; andare al passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="5ee31-160">If this method returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, you must set the output types first; skip to step 3.</span></span>
    -   <span data-ttu-id="5ee31-161">Se il metodo restituisce E \_ NOTIMPL, MFT non dispone di un elenco di tipi di input preferiti; andare al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="5ee31-161">If the method returns E\_NOTIMPL, the MFT does not have a list of preferred input types; skip to step 2.</span></span>
2.  <span data-ttu-id="5ee31-162">Per ogni flusso di input, chiamare [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) per impostare il tipo di input.</span><span class="sxs-lookup"><span data-stu-id="5ee31-162">For each input stream, call [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the input type.</span></span> <span data-ttu-id="5ee31-163">È possibile usare un tipo di supporto del passaggio 1 o un tipo che descrive i dati di input.</span><span class="sxs-lookup"><span data-stu-id="5ee31-163">You can use a media type from step 1, or a type that describes your input data.</span></span> <span data-ttu-id="5ee31-164">Se un flusso restituisce il \_ \_ tipo di trasformazione MF E \_ \_ non \_ impostato, andare al passaggio 3.</span><span class="sxs-lookup"><span data-stu-id="5ee31-164">If any stream returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, skip to step 3.</span></span>
3.  <span data-ttu-id="5ee31-165">(Facoltativo). Per ogni flusso di output, chiamare [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) per ottenere un elenco di tipi preferiti per quel flusso.</span><span class="sxs-lookup"><span data-stu-id="5ee31-165">(Optional.) For each output stream, call [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) to get a list of preferred types for that stream.</span></span>
    -   <span data-ttu-id="5ee31-166">Se questo metodo restituisce \_ \_ il tipo di trasformazione MF E \_ \_ non \_ impostato, è necessario impostare prima i tipi di input; tornare al passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="5ee31-166">If this method returns MF\_E\_TRANSFORM\_TYPE\_NOT\_SET, you must set the input types first; go back to step 1.</span></span>
    -   <span data-ttu-id="5ee31-167">Se un flusso restituisce E \_ NOTIMPL, MFT non dispone di un elenco di tipi di output preferiti; andare al passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="5ee31-167">If any stream returns E\_NOTIMPL, the MFT does not have a list of preferred output types; skip to step 4.</span></span>
4.  <span data-ttu-id="5ee31-168">Per ogni flusso di output, chiamare [**IMFTransform:: SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) per impostare il tipo di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-168">For each output stream, call [**IMFTransform::SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) to set the output type.</span></span> <span data-ttu-id="5ee31-169">È possibile usare un tipo di supporto del passaggio 3 o un tipo che descrive il formato di output necessario.</span><span class="sxs-lookup"><span data-stu-id="5ee31-169">You can use a media type from step 3, or a type that describes your required output format.</span></span>
5.  <span data-ttu-id="5ee31-170">Se i flussi di input non hanno un tipo di supporto, tornare al passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="5ee31-170">If any input streams do not have a media type, go back to step 1.</span></span>

### <a name="get-buffer-requirements"></a><span data-ttu-id="5ee31-171">Ottenere i requisiti del buffer</span><span class="sxs-lookup"><span data-stu-id="5ee31-171">Get Buffer Requirements</span></span>

<span data-ttu-id="5ee31-172">Dopo aver impostato i tipi di supporto, il client deve ottenere i requisiti del buffer per ogni flusso:</span><span class="sxs-lookup"><span data-stu-id="5ee31-172">After the client sets the media types, it should get the buffer requirements for each stream:</span></span>

-   <span data-ttu-id="5ee31-173">Per ogni flusso di input, chiamare [**IMFTransform:: GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo).</span><span class="sxs-lookup"><span data-stu-id="5ee31-173">For each input stream, call [**IMFTransform::GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo).</span></span>
-   <span data-ttu-id="5ee31-174">Per ogni flusso di output, chiamare [**IMFTransform:: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo).</span><span class="sxs-lookup"><span data-stu-id="5ee31-174">For each output stream, call [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo).</span></span>

### <a name="process-data"></a><span data-ttu-id="5ee31-175">Elaborare dati</span><span class="sxs-lookup"><span data-stu-id="5ee31-175">Process Data</span></span>

<span data-ttu-id="5ee31-176">Un MFT è progettato per essere una macchina a stati affidabile.</span><span class="sxs-lookup"><span data-stu-id="5ee31-176">An MFT is designed to be a reliable state machine.</span></span> <span data-ttu-id="5ee31-177">Non effettua alcuna chiamata al client.</span><span class="sxs-lookup"><span data-stu-id="5ee31-177">It does not make any calls back to the client.</span></span>

1.  <span data-ttu-id="5ee31-178">Call [**IMFTransform::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con il [**messaggio \_ MFT \_ Notify \_ Begin \_ streaming**](mft-message-notify-begin-streaming.md) Message.</span><span class="sxs-lookup"><span data-stu-id="5ee31-178">Call [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_NOTIFY\_BEGIN\_STREAMING**](mft-message-notify-begin-streaming.md) message.</span></span> <span data-ttu-id="5ee31-179">Questo messaggio richiede a MFT di allocare le risorse necessarie durante il flusso.</span><span class="sxs-lookup"><span data-stu-id="5ee31-179">This message requests the MFT to allocate any resources it needs during streaming.</span></span>
2.  <span data-ttu-id="5ee31-180">Chiamare [**IMFTransform::P rocessinput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) in almeno un flusso di input per recapitare un esempio di input alla MFT.</span><span class="sxs-lookup"><span data-stu-id="5ee31-180">Call [**IMFTransform::ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) on at least one input stream to deliver an input sample to the MFT.</span></span>
3.  <span data-ttu-id="5ee31-181">(Facoltativo). Chiamare [**IMFTransform:: GetOutputStatus**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstatus) per eseguire una query su se MFT è in grado di generare un esempio di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-181">(Optional.) Call [**IMFTransform::GetOutputStatus**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstatus) to query whether the MFT can generate an output sample.</span></span> <span data-ttu-id="5ee31-182">Se il metodo restituisce S \_ OK, controllare il parametro *pdwFlags* .</span><span class="sxs-lookup"><span data-stu-id="5ee31-182">If the method returns S\_OK, check the *pdwFlags* parameter.</span></span> <span data-ttu-id="5ee31-183">Se *pdwFlags* contiene il flag di **stato di output di MFT \_ \_ \_ campione \_ pronto** , andare al passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="5ee31-183">If *pdwFlags* contains the **MFT\_OUTPUT\_STATUS\_SAMPLE\_READY** flag, go to step 4.</span></span> <span data-ttu-id="5ee31-184">Se *pdwFlags* è zero, tornare al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="5ee31-184">If *pdwFlags* is zero, go back to step 2.</span></span> <span data-ttu-id="5ee31-185">Se il metodo restituisce E \_ NOTIMPL, andare al passaggio 4.</span><span class="sxs-lookup"><span data-stu-id="5ee31-185">If the method returns E\_NOTIMPL, go to step 4.</span></span>
4.  <span data-ttu-id="5ee31-186">Chiamare [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) per ottenere i dati di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-186">Call [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get output data.</span></span>
    -   <span data-ttu-id="5ee31-187">Se il metodo restituisce **MF \_ E \_ Transform \_ necessita di un \_ maggiore \_ input**, significa che il MFT richiede più dati di input; tornare al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="5ee31-187">If the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**, it means the MFT requires more input data; go back to step 2.</span></span>
    -   <span data-ttu-id="5ee31-188">Se il metodo restituisce **la \_ \_ modifica del \_ flusso \_ di trasformazione MF e**, significa che il numero di flussi di output è stato modificato o che il formato di output è stato modificato.</span><span class="sxs-lookup"><span data-stu-id="5ee31-188">If the method returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**, it means the number of output streams has changed, or the output format has changed.</span></span> <span data-ttu-id="5ee31-189">Il client potrebbe dover eseguire una query per i nuovi identificatori di flusso o impostare nuovi tipi di supporto.</span><span class="sxs-lookup"><span data-stu-id="5ee31-189">The client might need to query for new stream identifiers or set new media types.</span></span> <span data-ttu-id="5ee31-190">Per ulteriori informazioni, vedere la documentazione relativa a [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="5ee31-190">For more information, see the documentation for [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>
5.  <span data-ttu-id="5ee31-191">Se sono ancora presenti dati di input da elaborare, andare al passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="5ee31-191">If there is still input data to process, go to step 2.</span></span> <span data-ttu-id="5ee31-192">Se il MFT ha utilizzato tutti i dati di input disponibili, procedere con il passaggio 6.</span><span class="sxs-lookup"><span data-stu-id="5ee31-192">If the MFT has consumed all of the available input data, proceed to step 6.</span></span>
6.  <span data-ttu-id="5ee31-193">Chiamare [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con il messaggio relativo alla [**\_ \_ \_ fine \_ del \_ messaggio di notifica del messaggio MFT**](mft-message-notify-end-of-stream.md) .</span><span class="sxs-lookup"><span data-stu-id="5ee31-193">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_NOTIFY\_END\_OF\_STREAM**](mft-message-notify-end-of-stream.md) message.</span></span>
7.  <span data-ttu-id="5ee31-194">Chiamare [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con il messaggio di [**\_ svuotamento del \_ comando \_ del messaggio MFT**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="5ee31-194">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span>
8.  <span data-ttu-id="5ee31-195">Chiamare [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) per ottenere l'output rimanente.</span><span class="sxs-lookup"><span data-stu-id="5ee31-195">Call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get the remaining output.</span></span> <span data-ttu-id="5ee31-196">Ripetere questo passaggio fino a quando il metodo non restituisce **MF \_ E \_ Transform necessita di un \_ \_ maggiore \_ input**.</span><span class="sxs-lookup"><span data-stu-id="5ee31-196">Repeat this step until the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span> <span data-ttu-id="5ee31-197">Questo valore restituito segnala che tutto l'output è stato svuotato dalla MFT.</span><span class="sxs-lookup"><span data-stu-id="5ee31-197">This return value signals that all of the output has been drained from the MFT.</span></span> <span data-ttu-id="5ee31-198">(Non considerarlo come condizione di errore).</span><span class="sxs-lookup"><span data-stu-id="5ee31-198">(Do not treat this as an error condition.)</span></span>

<span data-ttu-id="5ee31-199">La sequenza descritta qui mantiene il minor consumo possibile di dati nella MFT.</span><span class="sxs-lookup"><span data-stu-id="5ee31-199">The sequence described here keeps as little data as possible in the MFT.</span></span> <span data-ttu-id="5ee31-200">Al termine di ogni chiamata a [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput), il client tenta di ottenere l'output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-200">After every call to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput), the client attempts to get output.</span></span> <span data-ttu-id="5ee31-201">Per produrre un esempio di output è possibile che siano necessari diversi esempi di input oppure un singolo esempio di input può generare diversi esempi di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-201">Several input samples might be needed to produce one output sample, or a single input sample might generate several output samples.</span></span> <span data-ttu-id="5ee31-202">Il comportamento ottimale per il client consiste nel pull degli esempi di output dalla MFT fino a quando il MFT richiede un maggior numero di input.</span><span class="sxs-lookup"><span data-stu-id="5ee31-202">The optimal behavior for the client is to pull output samples from the MFT until the MFT requires more input.</span></span>

<span data-ttu-id="5ee31-203">Tuttavia, il MFT dovrebbe essere in grado di gestire un ordine diverso di chiamate al metodo da parte del client.</span><span class="sxs-lookup"><span data-stu-id="5ee31-203">However, the MFT should be able to handle a different order of method calls by the client.</span></span> <span data-ttu-id="5ee31-204">Ad esempio, il client può semplicemente alternarsi tra le chiamate a [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) e [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="5ee31-204">For example, the client might simply alternate between calls to [**ProcessInput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processinput) and [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="5ee31-205">Il MFT deve limitare la quantità di input ottenuta restituendo **MF \_ E \_ NOTACCEPTING** da **ProcessInput** ogni volta che viene generato un output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-205">The MFT should restrict the amount of input that it gets by returning **MF\_E\_NOTACCEPTING** from **ProcessInput** whenever it has some output to produce.</span></span>

<span data-ttu-id="5ee31-206">L'ordine delle chiamate al metodo descritte in questo articolo non è l'unica sequenza valida di eventi.</span><span class="sxs-lookup"><span data-stu-id="5ee31-206">The order of method calls described here is not the only valid sequence of events.</span></span> <span data-ttu-id="5ee31-207">Ad esempio, i passaggi 3 e 4 presuppongono che il client inizi con i tipi di input e quindi tenti i tipi di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-207">For example, steps 3 and 4 assume that the client starts with the input types and then tries the output types.</span></span> <span data-ttu-id="5ee31-208">Il client può inoltre invertire questo ordine e iniziare con i tipi di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-208">The client can also reverse this order and start with the output types.</span></span> <span data-ttu-id="5ee31-209">In entrambi i casi, se il MFT richiede l'ordine opposto, deve restituire il codice di errore MF \_ E il \_ tipo di trasformazione \_ \_ non \_ impostato.</span><span class="sxs-lookup"><span data-stu-id="5ee31-209">In either case, if the MFT requires the opposite order, it should return the error code MF\_E\_TRANSFORM\_TYPE\_NOT\_SET.</span></span>

<span data-ttu-id="5ee31-210">Il client può chiamare metodi informativi, ad esempio [**GetInputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputcurrenttype) e [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo), in qualsiasi momento durante il flusso.</span><span class="sxs-lookup"><span data-stu-id="5ee31-210">The client can call informational methods, such as [**GetInputCurrentType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputcurrenttype) and [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo), at any time during streaming.</span></span> <span data-ttu-id="5ee31-211">Il client può anche tentare di modificare i tipi di supporto in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="5ee31-211">The client can also attempt to change the media types at any time.</span></span> <span data-ttu-id="5ee31-212">Se questa operazione non è valida, la tabella MFT deve restituire un codice di errore.</span><span class="sxs-lookup"><span data-stu-id="5ee31-212">The MFT should return an error code if this is not a valid operation.</span></span> <span data-ttu-id="5ee31-213">In breve, MFTs deve presupporre pochissimo l'ordine delle operazioni, oltre a quanto documentato nelle chiamate stesse.</span><span class="sxs-lookup"><span data-stu-id="5ee31-213">In short, MFTs should assume very little about the order of operations, other than what is documented in the calls themselves.</span></span>

<span data-ttu-id="5ee31-214">Il diagramma seguente illustra un diagramma di flusso delle procedure descritte in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="5ee31-214">The following diagram shows a flow chart of the procedures described in this topic.</span></span>

![diagramma di flusso che conduce da ottenere gli identificatori dei flussi tramite cicli che impostano i tipi di input, ottengono l'input e l'output del processo](images/mft-processing.gif)

## <a name="extensions-to-the-basic-model"></a><span data-ttu-id="5ee31-216">Estensioni al modello di base</span><span class="sxs-lookup"><span data-stu-id="5ee31-216">Extensions to the Basic Model</span></span>

<span data-ttu-id="5ee31-217">Facoltativamente, una MFT può supportare alcune estensioni per il modello di flusso di base.</span><span class="sxs-lookup"><span data-stu-id="5ee31-217">Optionally, an MFT can support some extensions to the basic streaming model.</span></span>

-   <span data-ttu-id="5ee31-218">Flussi letti Lazy.</span><span class="sxs-lookup"><span data-stu-id="5ee31-218">Lazy-read streams.</span></span> <span data-ttu-id="5ee31-219">Se il metodo [**IMFTransform:: GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) restituisce il flag di **\_ \_ \_ \_ lettura lenta del flusso di output MFT** per un flusso di output, il client non deve raccogliere i dati dal flusso di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-219">If the [**IMFTransform::GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_LAZY\_READ** flag for an output stream, the client does not have to collect data from that output stream.</span></span> <span data-ttu-id="5ee31-220">Il MFT continua ad accettare l'input e a un certo punto la MFT eliminerà i dati di output dal flusso.</span><span class="sxs-lookup"><span data-stu-id="5ee31-220">The MFT continues to accept input, and at some point the MFT will discard the output data from that stream.</span></span> <span data-ttu-id="5ee31-221">Se tutti i flussi di output presentano questo flag, l'opzione MFT non avrà mai esito positivo per accettare l'input.</span><span class="sxs-lookup"><span data-stu-id="5ee31-221">If all of the output streams have this flag, the MFT will never fail to accept input.</span></span> <span data-ttu-id="5ee31-222">Un esempio potrebbe essere una trasformazione di visualizzazione, in cui il client ottiene l'output solo quando dispone di cicli di CPU di riserva per tracciare la visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="5ee31-222">An example might be a visualization transform, where the client gets the output only when it has spare CPU cycles to draw the visualization.</span></span>
-   <span data-ttu-id="5ee31-223">Flussi scartabili.</span><span class="sxs-lookup"><span data-stu-id="5ee31-223">Discardable streams.</span></span> <span data-ttu-id="5ee31-224">Se il metodo [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) restituisce il flag rimuovibile del **\_ \_ flusso \_ di output MFT** per un flusso di output, il client può richiedere al MFT di scartare l'output, ma il MFT non eliminerà alcun output a meno che non sia richiesto.</span><span class="sxs-lookup"><span data-stu-id="5ee31-224">If the [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_DISCARDABLE** flag for an output stream, the client can request the MFT to discard output, but the MFT will not discard any output unless requested.</span></span> <span data-ttu-id="5ee31-225">Quando il MFT raggiunge il buffer di input massimo, il client deve raccogliere alcuni dati di output o richiedere a MFT di rimuovere l'output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-225">When the MFT reaches its maximum input buffer, the client must either collect some output data or request the MFT to discard the output.</span></span>
-   <span data-ttu-id="5ee31-226">Flussi facoltativi.</span><span class="sxs-lookup"><span data-stu-id="5ee31-226">Optional streams.</span></span> <span data-ttu-id="5ee31-227">Se il metodo [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) restituisce il **flag \_ \_ \_ facoltativo del flusso di output di MFT** per un flusso di output oppure il metodo [**IMFTransform:: GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo) restituisce il flag **\_ \_ \_ facoltativo del flusso di input MFT** per un flusso di input, tale flusso è facoltativo.</span><span class="sxs-lookup"><span data-stu-id="5ee31-227">If the [**GetOutputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputstreaminfo) method returns the **MFT\_OUTPUT\_STREAM\_OPTIONAL** flag for an output stream, or the [**IMFTransform::GetInputStreamInfo**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getinputstreaminfo) method returns the **MFT\_INPUT\_STREAM\_OPTIONAL** flag for an input stream, that stream is optional.</span></span> <span data-ttu-id="5ee31-228">Il client non deve impostare un tipo di supporto per il flusso.</span><span class="sxs-lookup"><span data-stu-id="5ee31-228">The client does not have to set a media type on the stream.</span></span> <span data-ttu-id="5ee31-229">Se il client non imposta il tipo, il flusso viene deselezionato.</span><span class="sxs-lookup"><span data-stu-id="5ee31-229">If the client does not set the type, the stream is deselected.</span></span> <span data-ttu-id="5ee31-230">Un flusso di output deselezionato non produce esempi e il client non fornisce un buffer per il flusso quando chiama [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="5ee31-230">A deselected output stream does not produce samples, and the client does not provide a buffer for the stream when it calls [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="5ee31-231">Un flusso di input deselezionato non accetta dati di input.</span><span class="sxs-lookup"><span data-stu-id="5ee31-231">A deselected input stream does not accept input data.</span></span> <span data-ttu-id="5ee31-232">Un MFT può contrassegnare tutti i flussi di input e di output come facoltativi.</span><span class="sxs-lookup"><span data-stu-id="5ee31-232">An MFT can mark all of its input and output streams as optional.</span></span> <span data-ttu-id="5ee31-233">È tuttavia previsto che sia necessario selezionare almeno un input e un output per il funzionamento della MFT.</span><span class="sxs-lookup"><span data-stu-id="5ee31-233">However, it is expected that at least one input and one output must be selected for the MFT to work.</span></span>
-   <span data-ttu-id="5ee31-234">Elaborazione asincrona.</span><span class="sxs-lookup"><span data-stu-id="5ee31-234">Asynchronous processing.</span></span> <span data-ttu-id="5ee31-235">Il modello di elaborazione asincrona è stato introdotto in Windows 7.</span><span class="sxs-lookup"><span data-stu-id="5ee31-235">The asynchronous processing model was introduced in Windows 7.</span></span> <span data-ttu-id="5ee31-236">Viene descritto nell'argomento [MFTS asincrono](asynchronous-mfts.md).</span><span class="sxs-lookup"><span data-stu-id="5ee31-236">It is described in the topic [Asynchronous MFTs](asynchronous-mfts.md).</span></span>

## <a name="imf2dbuffer"></a><span data-ttu-id="5ee31-237">IMF2DBuffer</span><span class="sxs-lookup"><span data-stu-id="5ee31-237">IMF2DBuffer</span></span>

<span data-ttu-id="5ee31-238">Se un MFT elabora dati video non compressi, deve usare l'interfaccia [**IMF2DBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imf2dbuffer) per modificare i buffer di esempio.</span><span class="sxs-lookup"><span data-stu-id="5ee31-238">If an MFT processes uncompressed video data, it should use the [**IMF2DBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imf2dbuffer) interface to manipulate the sample buffers.</span></span> <span data-ttu-id="5ee31-239">Per ottenere questa interfaccia, eseguire una query sull'interfaccia [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) su qualsiasi buffer di input o di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-239">To get this interface, query the [**IMFMediaBuffer**](/windows/desktop/api/mfobjects/nn-mfobjects-imfmediabuffer) interface on any input or output buffer.</span></span> <span data-ttu-id="5ee31-240">Se non si utilizza questa interfaccia se disponibile, è possibile che vengano generate ulteriori copie del buffer.</span><span class="sxs-lookup"><span data-stu-id="5ee31-240">Not using this interface when it is available may result in additional buffer copies.</span></span> <span data-ttu-id="5ee31-241">Per usare correttamente questa interfaccia, la trasformazione non deve bloccare il buffer usando l'interfaccia **IMFMediaBuffer** quando **IMF2DBuffer** è disponibile.</span><span class="sxs-lookup"><span data-stu-id="5ee31-241">To make proper use of this interface, the transform should not lock the buffer using the **IMFMediaBuffer** interface when **IMF2DBuffer** is available.</span></span>

<span data-ttu-id="5ee31-242">Per ulteriori informazioni sull'elaborazione dei dati video, vedere [buffer video non compressi](uncompressed-video-buffers.md).</span><span class="sxs-lookup"><span data-stu-id="5ee31-242">For more information about processing video data, see [Uncompressed Video Buffers](uncompressed-video-buffers.md).</span></span>

## <a name="flushing-an-mft"></a><span data-ttu-id="5ee31-243">Scaricamento di un MFT</span><span class="sxs-lookup"><span data-stu-id="5ee31-243">Flushing an MFT</span></span>

<span data-ttu-id="5ee31-244">*Scaricando* una MFT, il MFT Elimina tutti i dati di input.</span><span class="sxs-lookup"><span data-stu-id="5ee31-244">*Flushing* an MFT causes the MFT to discard all of its input data.</span></span> <span data-ttu-id="5ee31-245">Ciò può causare un'interruzioni nel flusso di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-245">This can cause a break in the output stream.</span></span> <span data-ttu-id="5ee31-246">Un client in genere Scarica un MFT prima di cercare un nuovo punto nel flusso di input o passa a un nuovo flusso di input, quando il client non è interessato alla perdita di dati.</span><span class="sxs-lookup"><span data-stu-id="5ee31-246">A client would typically flush an MFT before seeking to a new point in the input stream or switching to a new input stream, when the client does not care about losing data.</span></span>

<span data-ttu-id="5ee31-247">Per scaricare un MFT, chiamare [**IMFTransform::P rocessmessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con il messaggio di [**\_ \_ \_ scaricamento del comando del messaggio MFT**](mft-message-command-flush.md) .</span><span class="sxs-lookup"><span data-stu-id="5ee31-247">To flush an MFT, call [**IMFTransform::ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_FLUSH**](mft-message-command-flush.md) message.</span></span>

## <a name="draining-an-mft"></a><span data-ttu-id="5ee31-248">Svuotamento di un MFT</span><span class="sxs-lookup"><span data-stu-id="5ee31-248">Draining an MFT</span></span>

<span data-ttu-id="5ee31-249">Con lo *svuotamento* di un MFT, il MFT produce il maggior volume di output possibile da qualsiasi dato di input già inviato.</span><span class="sxs-lookup"><span data-stu-id="5ee31-249">*Draining* an MFT causes the MFT to produce as much output as it can from whatever input data has already been sent.</span></span> <span data-ttu-id="5ee31-250">Se MFT non è in grado di produrre un esempio di output completo dall'input disponibile, eliminerà i dati di input.</span><span class="sxs-lookup"><span data-stu-id="5ee31-250">If the MFT cannot produce a complete output sample from the available input, it will drop input data.</span></span> <span data-ttu-id="5ee31-251">Un client in genere svuota un MFT quando ha raggiunto la fine del flusso di origine o immediatamente prima di una modifica del formato nel flusso di origine.</span><span class="sxs-lookup"><span data-stu-id="5ee31-251">A client would typically drain an MFT when it reached the end of the source stream, or immediately before a format change in the source stream.</span></span> <span data-ttu-id="5ee31-252">Per svuotare un MFT, eseguire le operazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="5ee31-252">To drain an MFT, do the following:</span></span>

1.  <span data-ttu-id="5ee31-253">Chiamare [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) con il messaggio di [**\_ svuotamento del \_ comando \_ del messaggio MFT**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="5ee31-253">Call [**ProcessMessage**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processmessage) with the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span> <span data-ttu-id="5ee31-254">Questo messaggio notifica alla MFT che deve fornire il maggior quantità di dati di output possibili dai dati di input già inviati.</span><span class="sxs-lookup"><span data-stu-id="5ee31-254">This message notifies the MFT that it should deliver as much output data as it can from the input data that has already been sent.</span></span>
2.  <span data-ttu-id="5ee31-255">Chiamare [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) per ottenere i dati di output, fino a quando il metodo non restituisce **MF \_ E \_ Transform necessita di un \_ \_ maggiore \_ input**.</span><span class="sxs-lookup"><span data-stu-id="5ee31-255">Call [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) to get output data, until the method returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span>

<span data-ttu-id="5ee31-256">Mentre è in corso lo svuotamento della MFT, non verrà accettato alcun input.</span><span class="sxs-lookup"><span data-stu-id="5ee31-256">While the MFT is being drained, it will not accept any more input.</span></span>

## <a name="sample-attributes"></a><span data-ttu-id="5ee31-257">Attributi di esempio</span><span class="sxs-lookup"><span data-stu-id="5ee31-257">Sample Attributes</span></span>

<span data-ttu-id="5ee31-258">Gli esempi di input possono avere attributi che devono essere copiati negli esempi di output corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="5ee31-258">The input samples might have attributes that must be copied to the corresponding output samples.</span></span>

-   <span data-ttu-id="5ee31-259">Se MFT restituisce la **variante \_ true** per la [**proprietà \_ \_ supportata MFPKEY EXATTRIBUTE**](mfpkey-exattribute-supported-property.md) , è necessario che il MFT Copi gli attributi.</span><span class="sxs-lookup"><span data-stu-id="5ee31-259">If the MFT returns **VARIANT\_TRUE** for the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property, the MFT must copy the attributes.</span></span>
-   <span data-ttu-id="5ee31-260">Se la proprietà [**MFPKEY \_ EXATTRIBUTE \_ supportata**](mfpkey-exattribute-supported-property.md) è **Variant \_ false** o non è impostata, il client deve copiare gli attributi.</span><span class="sxs-lookup"><span data-stu-id="5ee31-260">If the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property is either **VARIANT\_FALSE** or is not set, the client must copy the attributes.</span></span>

<span data-ttu-id="5ee31-261">Per un MFT con un input e un output, è possibile usare la regola generale seguente:</span><span class="sxs-lookup"><span data-stu-id="5ee31-261">For an MFT with one input and one output, you can use the following general rule:</span></span>

-   <span data-ttu-id="5ee31-262">Se ogni esempio di input produce esattamente un esempio di output, è possibile consentire al client di copiare gli attributi.</span><span class="sxs-lookup"><span data-stu-id="5ee31-262">If each input sample produces exactly one output sample, you can let the client copy the attributes.</span></span> <span data-ttu-id="5ee31-263">Lasciare invariata la proprietà [**\_ \_ supportata da MFPKEY EXATTRIBUTE**](mfpkey-exattribute-supported-property.md) .</span><span class="sxs-lookup"><span data-stu-id="5ee31-263">Leave the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property unset.</span></span>
-   <span data-ttu-id="5ee31-264">Se non esiste una corrispondenza uno-a-uno tra gli esempi di input e di output, il MFT deve determinare gli attributi corretti per gli esempi di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-264">If there is not a one-to-one correspondence between input samples and output samples, the MFT must determine the correct attributes for output samples.</span></span> <span data-ttu-id="5ee31-265">Impostare la [**proprietà \_ \_ supportata MFPKEY EXATTRIBUTE**](mfpkey-exattribute-supported-property.md) su **Variant \_ true**.</span><span class="sxs-lookup"><span data-stu-id="5ee31-265">Set the [**MFPKEY\_EXATTRIBUTE\_SUPPORTED**](mfpkey-exattribute-supported-property.md) property to **VARIANT\_TRUE**.</span></span>

## <a name="discontinuities"></a><span data-ttu-id="5ee31-266">Discontinuità</span><span class="sxs-lookup"><span data-stu-id="5ee31-266">Discontinuities</span></span>

<span data-ttu-id="5ee31-267">Una discontinuità è un'interruzione in un flusso audio o video.</span><span class="sxs-lookup"><span data-stu-id="5ee31-267">A discontinuity is a break in an audio or video stream.</span></span> <span data-ttu-id="5ee31-268">Le discontinuità possono essere causate da pacchetti eliminati in una connessione di rete, dati di file danneggiati, un passaggio da un flusso di origine a un altro o un'ampia gamma di altre cause.</span><span class="sxs-lookup"><span data-stu-id="5ee31-268">Discontinuities can be caused by dropped packets on a network connection, corrupt file data, a switch from one source stream to another, or a wide range of other causes.</span></span> <span data-ttu-id="5ee31-269">Le discontinuità sono segnalate impostando l'attributo di [**\_ discontinuità MFSampleExtension**](mfsampleextension-discontinuity-attribute.md) sul primo campione dopo la discontinuità.</span><span class="sxs-lookup"><span data-stu-id="5ee31-269">Discontinuities are signaled by setting the [**MFSampleExtension\_Discontinuity**](mfsampleextension-discontinuity-attribute.md) attribute on the first sample after the discontinuity.</span></span> <span data-ttu-id="5ee31-270">Non è possibile segnalare una discontinuità al centro di un campione.</span><span class="sxs-lookup"><span data-stu-id="5ee31-270">It is not possible to signal a discontinuity in the middle of a sample.</span></span> <span data-ttu-id="5ee31-271">Pertanto, tutti i dati discontinui devono essere inviati in campioni distinti.</span><span class="sxs-lookup"><span data-stu-id="5ee31-271">Therefore, any discontinuous data should be sent in separate samples.</span></span>

<span data-ttu-id="5ee31-272">Alcune trasformazioni, in particolare quelle che gestiscono dati non compressi, ad esempio gli effetti audio e video, devono ignorare le discontinuità quando elaborano i dati di input.</span><span class="sxs-lookup"><span data-stu-id="5ee31-272">Some transforms, especially those that handle uncompressed data, such as audio and video effects, should ignore discontinuities when they process input data.</span></span> <span data-ttu-id="5ee31-273">Questi MFTs sono in genere progettati per gestire i dati continui e devono trattare tutti i dati ricevuti come continui, anche dopo una discontinuità.</span><span class="sxs-lookup"><span data-stu-id="5ee31-273">These MFTs are generally designed to handle continuous data, and should treat any data they receive as continuous, even after a discontinuity.</span></span>

<span data-ttu-id="5ee31-274">Se una MFT ignora una discontinuità sui dati di input, deve comunque impostare il flag di discontinuità nell'esempio di output, se l'esempio di output ha lo stesso timestamp dell'esempio di input.</span><span class="sxs-lookup"><span data-stu-id="5ee31-274">If an MFT ignores a discontinuity on input data, it should still set the discontinuity flag on the output sample, if the output sample has the same time stamp as the input sample.</span></span> <span data-ttu-id="5ee31-275">Se l'output di esempio ha un timestamp diverso, tuttavia, il MFT non deve propagare la discontinuità.</span><span class="sxs-lookup"><span data-stu-id="5ee31-275">If the output sample has a different time stamp, however, the MFT should not propagate the discontinuity.</span></span> <span data-ttu-id="5ee31-276">Questo è il caso di alcuni ricampionatori audio, ad esempio. Una discontinuità nella posizione errata nel flusso è peggiore della discontinuità.</span><span class="sxs-lookup"><span data-stu-id="5ee31-276">(This would be the case in some audio resamplers, for example.) A discontinuity at the wrong place in the stream is worse than no discontinuity.</span></span>

<span data-ttu-id="5ee31-277">La maggior parte dei decodificatori non può ignorare le discontinuità, perché una discontinuità influiscono sull'interpretazione dell'esempio successivo.</span><span class="sxs-lookup"><span data-stu-id="5ee31-277">Most decoders cannot ignore discontinuities, because a discontinuity affects the interpretation of the next sample.</span></span> <span data-ttu-id="5ee31-278">Qualsiasi tecnologia di codifica che usa la compressione tra frame, ad esempio MPEG-2, rientra in questa categoria.</span><span class="sxs-lookup"><span data-stu-id="5ee31-278">Any encoding technology that uses inter-frame compression, such as MPEG-2, falls into this category.</span></span> <span data-ttu-id="5ee31-279">Alcuni schemi di codifica usano solo la compressione intra-frame, ad esempio DV e MJPEG.</span><span class="sxs-lookup"><span data-stu-id="5ee31-279">Some encoding schemes use only intra-frame compression, such as DV and MJPEG.</span></span> <span data-ttu-id="5ee31-280">Questi decodificatori possono ignorare in modo sicuro le discontinuità.</span><span class="sxs-lookup"><span data-stu-id="5ee31-280">These decoders can safely ignore discontinuities.</span></span>

<span data-ttu-id="5ee31-281">Le trasformazioni che rispondono a discontinuità dovrebbero in genere restituire la maggior parte dei dati prima della discontinuità così come possono ed eliminare il resto.</span><span class="sxs-lookup"><span data-stu-id="5ee31-281">Transforms that respond to discontinuities should generally output as much of the data before the discontinuity as they can, and discard the rest.</span></span> <span data-ttu-id="5ee31-282">L'esempio di input con il flag di discontinuità deve essere elaborato come se fosse il primo campione nel flusso.</span><span class="sxs-lookup"><span data-stu-id="5ee31-282">The input sample with the discontinuity flag should be processed as though it were the first sample in the stream.</span></span> <span data-ttu-id="5ee31-283">Questo comportamento corrisponde a quanto specificato per il messaggio [**di \_ \_ \_ svuotamento del comando del messaggio MFT**](mft-message-command-drain.md) . Tuttavia, i dettagli esatti dipendono dal formato multimediale.</span><span class="sxs-lookup"><span data-stu-id="5ee31-283">(This behavior matches what is specified for the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.) However, the exact details will depend on the media format.</span></span>

<span data-ttu-id="5ee31-284">Se un decodificatore non esegue alcuna operazione per attenuare la discontinuità, deve copiare il flag di discontinuità nei dati di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-284">If a decoder does nothing to mitigate a discontinuity, it should copy the discontinuity flag to the output data.</span></span> <span data-ttu-id="5ee31-285">I Demultiplexer e altre MFTs che funzionano interamente con i dati compressi devono copiare eventuali discontinuità nei relativi flussi di output.</span><span class="sxs-lookup"><span data-stu-id="5ee31-285">Demultiplexers and other MFTs that work entirely with compressed data must copy any discontinuities to their output streams.</span></span> <span data-ttu-id="5ee31-286">In caso contrario, i componenti downstream potrebbero non essere in grado di decodificare correttamente i dati compressi.</span><span class="sxs-lookup"><span data-stu-id="5ee31-286">Otherwise, the downstream components may not be able to decode the compressed data correctly.</span></span> <span data-ttu-id="5ee31-287">In generale, è quasi sempre corretto passare le discontinuità a valle, a meno che il MFT non contenga codice esplicito per smussare le discontinuità.</span><span class="sxs-lookup"><span data-stu-id="5ee31-287">In general, it is almost always correct to pass discontinuities downstream, unless the MFT contains explicit code to smooth out discontinuities.</span></span>

## <a name="dynamic-format-changes"></a><span data-ttu-id="5ee31-288">Modifiche al formato dinamico</span><span class="sxs-lookup"><span data-stu-id="5ee31-288">Dynamic Format Changes</span></span>

<span data-ttu-id="5ee31-289">I formati possono cambiare durante il flusso.</span><span class="sxs-lookup"><span data-stu-id="5ee31-289">Formats can change during streaming.</span></span> <span data-ttu-id="5ee31-290">Ad esempio, le proporzioni possono variare al centro di un flusso video.</span><span class="sxs-lookup"><span data-stu-id="5ee31-290">For example, aspect ratio can change in the middle of a video stream.</span></span>

<span data-ttu-id="5ee31-291">Per informazioni dettagliate sul modo in cui le modifiche del flusso vengono gestite da un MFT, vedere [gestione delle modifiche al flusso](handling-stream-changes.md).</span><span class="sxs-lookup"><span data-stu-id="5ee31-291">For details about how stream changes are handled by an MFT, see [Handling Stream Changes](handling-stream-changes.md).</span></span>

## <a name="stream-events"></a><span data-ttu-id="5ee31-292">Eventi di flusso</span><span class="sxs-lookup"><span data-stu-id="5ee31-292">Stream Events</span></span>

<span data-ttu-id="5ee31-293">Per inviare un evento a un MFT, chiamare [**IMFTransform::P rocessevent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span><span class="sxs-lookup"><span data-stu-id="5ee31-293">To send an event to an MFT, call [**IMFTransform::ProcessEvent**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processevent).</span></span> <span data-ttu-id="5ee31-294">Se il metodo restituisce **la \_ trasformazione MF S non \_ propaga l' \_ \_ \_ \_ evento**, l'oggetto MFT restituirà l'evento al chiamante in una chiamata successiva a [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="5ee31-294">If the method returns **MF\_S\_TRANSFORM\_DO\_NOT\_PROPAGATE\_EVENT**, the MFT will return the event to the caller on a subsequent call to [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="5ee31-295">Se il metodo restituisce qualsiasi altro valore **HRESULT** , l'evento MFT non restituirà l'evento al client in **ProcessOutput**.</span><span class="sxs-lookup"><span data-stu-id="5ee31-295">If the method returns any other **HRESULT** value, the MFT will not return the event to the client in **ProcessOutput**.</span></span> <span data-ttu-id="5ee31-296">In tal caso, il client è responsabile della propagazione dell'evento a valle al componente successivo nella pipeline, se applicabile.</span><span class="sxs-lookup"><span data-stu-id="5ee31-296">In that case, the client is responsible for propagating the event downstream to the next component in the pipeline, if applicable.</span></span> <span data-ttu-id="5ee31-297">Per ulteriori informazioni, vedere [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="5ee31-297">For more information, see [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

## <a name="related-topics"></a><span data-ttu-id="5ee31-298">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="5ee31-298">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5ee31-299">Trasformazioni Media Foundation</span><span class="sxs-lookup"><span data-stu-id="5ee31-299">Media Foundation Transforms</span></span>](media-foundation-transforms.md)
</dt> </dl>

 

 



