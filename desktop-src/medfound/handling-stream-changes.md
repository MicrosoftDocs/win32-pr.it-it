---
description: Questo argomento descrive il modo in cui una trasformazione Media Foundation (MFT) deve gestire le modifiche di formato durante il flusso.
ms.assetid: b0a94760-b4dd-4e50-a5ce-a1f674dde156
title: Gestione delle modifiche dei flussi
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 2adf3cbc0504a37fe611b77047c73f85b9d1e742
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104226461"
---
# <a name="handling-stream-changes"></a><span data-ttu-id="ad0d5-103">Gestione delle modifiche dei flussi</span><span class="sxs-lookup"><span data-stu-id="ad0d5-103">Handling Stream Changes</span></span>

<span data-ttu-id="ad0d5-104">Questo argomento descrive il modo in cui una trasformazione Media Foundation (MFT) deve gestire le modifiche di formato durante il flusso.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-104">This topic describes how a Media Foundation transform (MFT) should handle format changes during streaming.</span></span>

> [!IMPORTANT]
>
> <span data-ttu-id="ad0d5-105">Questo argomento non si applica ai codificatori.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-105">This topic does not apply to encoders.</span></span> <span data-ttu-id="ad0d5-106">I codificatori non devono propagare le modifiche al formato, come descritto in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-106">Encoders should not propagate format changes as described in this topic.</span></span> <span data-ttu-id="ad0d5-107">I codificatori devono accettare solo un tipo di input corrispondente al tipo di output attualmente configurato.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-107">Encoders should only accept an input type that matches the currently configured output type.</span></span>

 

## <a name="overview-of-format-changes"></a><span data-ttu-id="ad0d5-108">Panoramica delle modifiche al formato</span><span class="sxs-lookup"><span data-stu-id="ad0d5-108">Overview of Format Changes</span></span>

<span data-ttu-id="ad0d5-109">In genere, esistono due motivi per cui un formato può cambiare durante il flusso.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-109">Generally, there are two reasons that a format can change during streaming.</span></span>

-   <span data-ttu-id="ad0d5-110">Il client può passare a un flusso con un nuovo formato.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-110">The client might switch to a stream with a new format.</span></span> <span data-ttu-id="ad0d5-111">Ad esempio, in Digital Television questa situazione può verificarsi a causa di una modifica del canale.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-111">For example, in digital television, this can occur due to a channel change.</span></span>
-   <span data-ttu-id="ad0d5-112">In alcuni formati video, ad esempio H. 264, il bitstream può segnalare una modifica del formato.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-112">In some video formats, such as H.264, the bitstream can signal a format change.</span></span> <span data-ttu-id="ad0d5-113">Tali modifiche possono includere modifiche al dominanza dei campi, alla risoluzione del video o alle proporzioni di pixel.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-113">Such changes might include changes in field dominance, video resolution, or pixel aspect ratio.</span></span>

<span data-ttu-id="ad0d5-114">Se il tipo di codifica viene modificato, il client potrebbe dover rimuovere la MFT dalla pipeline e sostituirla con un'altra MFT.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-114">If the encoding type changes, the client might need to remove the MFT from the pipeline and replace it with another MFT.</span></span> <span data-ttu-id="ad0d5-115">Ad esempio, potrebbe essere necessario scambiare il client in un nuovo decodificatore. Questo argomento non copre questa situazione.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-115">(For example, the client might need to swap in a new decoder.) This topic does not cover that situation.</span></span> <span data-ttu-id="ad0d5-116">In questo argomento vengono illustrati solo i casi in cui il MFT corrente è in grado di gestire il nuovo formato.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-116">This topic covers only the case where the current MFT can handle the new format.</span></span>

<span data-ttu-id="ad0d5-117">Se il formato viene modificato, la MFT potrebbe richiedere un nuovo tipo di input, un nuovo tipo di output o entrambi.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-117">If the format changes, the MFT might require a new input type, a new output type, or both.</span></span>

-   <span data-ttu-id="ad0d5-118">Le modifiche apportate al tipo di input vengono avviate dal client.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-118">Changes to input type are initiated by the client.</span></span> <span data-ttu-id="ad0d5-119">Un MFT non modifica mai il proprio tipo di input.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-119">An MFT never changes its own input type.</span></span>
-   <span data-ttu-id="ad0d5-120">Le modifiche al tipo di output vengono avviate da MFT.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-120">Changes to output type are initiated by the MFT.</span></span> <span data-ttu-id="ad0d5-121">Il MFT segnala che è necessario un nuovo tipo di output e il client negozia il nuovo tipo di output con MFT.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-121">The MFT signals that it requires a new output type, and the client negotiates the new output type with the MFT.</span></span>

<span data-ttu-id="ad0d5-122">Sono pertanto possibili tre casi distinti:</span><span class="sxs-lookup"><span data-stu-id="ad0d5-122">Thus, three distinct cases are possible:</span></span>

-   <span data-ttu-id="ad0d5-123">Il client imposta un nuovo tipo di input.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-123">The client sets a new input type.</span></span> <span data-ttu-id="ad0d5-124">Il MFT usa il nuovo formato, senza alcuna modifica al tipo di output.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-124">The MFT consumes the new format, with no change to its output type.</span></span>
-   <span data-ttu-id="ad0d5-125">Il client imposta un nuovo tipo di input e attiva una modifica nel tipo di output.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-125">The client sets a new input type, and this triggers a change in the output type.</span></span>
-   <span data-ttu-id="ad0d5-126">Il tipo di input non cambia, ma il MFT rileva una modifica del formato in Bitstream, che richiede un nuovo tipo di output.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-126">The input type does not change, but the MFT detects a format change in the bitstream, which requires a new output type.</span></span>

## <a name="implementing-format-changes"></a><span data-ttu-id="ad0d5-127">Implementazione delle modifiche al formato</span><span class="sxs-lookup"><span data-stu-id="ad0d5-127">Implementing Format Changes</span></span>

<span data-ttu-id="ad0d5-128">Nella parte restante di questo argomento viene descritto il modo in cui il client deve elaborare una modifica di formato e come implementare le modifiche al formato in un MFT.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-128">The remainder of this topic describes how the client should process a format change, and how to implement format changes in an MFT.</span></span>

### <a name="output-type"></a><span data-ttu-id="ad0d5-129">Tipo di output</span><span class="sxs-lookup"><span data-stu-id="ad0d5-129">Output Type</span></span>

<span data-ttu-id="ad0d5-130">Qualsiasi MFT può avviare una modifica al tipo di output, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="ad0d5-130">Any MFT can initiate a change to its output type, as follows:</span></span>

1.  <span data-ttu-id="ad0d5-131">Il client chiama [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="ad0d5-131">The client calls [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span> <span data-ttu-id="ad0d5-132">Il MFT risponde nel modo seguente:</span><span class="sxs-lookup"><span data-stu-id="ad0d5-132">The MFT responds as follows:</span></span>
    1.  <span data-ttu-id="ad0d5-133">MFT non produce un esempio di output in [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="ad0d5-133">The MFT does not produce an output sample in [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>
    2.  <span data-ttu-id="ad0d5-134">MFT imposta il flag **di \_ \_ modifica del \_ \_ formato del \_ buffer dei dati di output MFT** nel membro **dwStatus** della struttura del [**\_ \_ \_ buffer dei dati di output di MFT**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) .</span><span class="sxs-lookup"><span data-stu-id="ad0d5-134">The MFT sets the **MFT\_OUTPUT\_DATA\_BUFFER\_FORMAT\_CHANGE** flag in the **dwStatus** member of the [**MFT\_OUTPUT\_DATA\_BUFFER**](/windows/desktop/api/mftransform/ns-mftransform-mft_output_data_buffer) structure.</span></span>
    3.  <span data-ttu-id="ad0d5-135">Il metodo [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) restituisce il codice di errore **MF E la \_ \_ \_ \_ modifica del flusso di trasformazione**.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-135">The [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) method returns the error code **MF\_E\_TRANSFORM\_STREAM\_CHANGE**.</span></span>
2.  <span data-ttu-id="ad0d5-136">Il client chiama [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span><span class="sxs-lookup"><span data-stu-id="ad0d5-136">The client calls [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype).</span></span> <span data-ttu-id="ad0d5-137">Questo metodo restituisce un set aggiornato di tipi di output.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-137">This method returns an updated set of output types.</span></span>
3.  <span data-ttu-id="ad0d5-138">Il client chiama [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) per impostare un nuovo tipo di output.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-138">The client calls [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype) to set a new output type.</span></span>
4.  <span data-ttu-id="ad0d5-139">Il client riprende la chiamata a [**ProcessInput**](/windows/desktop/api/mfidl/nf-mfidl-imfqualitymanager-notifyprocessinput) / [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span><span class="sxs-lookup"><span data-stu-id="ad0d5-139">The client resumes calling [**ProcessInput**](/windows/desktop/api/mfidl/nf-mfidl-imfqualitymanager-notifyprocessinput)/[**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput).</span></span>

### <a name="input-type"></a><span data-ttu-id="ad0d5-140">Tipo di input</span><span class="sxs-lookup"><span data-stu-id="ad0d5-140">Input Type</span></span>

<span data-ttu-id="ad0d5-141">Le modifiche apportate al tipo di input vengono avviate dal client, mai dalla MFT.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-141">Changes to the input type are initiated by the client, never by the MFT.</span></span> <span data-ttu-id="ad0d5-142">Se il tipo di input viene modificato, è possibile che venga attivata una modifica al tipo di output.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-142">If the input type changes, it might trigger a change to the output type.</span></span>

<span data-ttu-id="ad0d5-143">La sequenza esatta di eventi dipende dal valore dell'attributo di [**modifica del \_ \_ \_ formato \_ dinamico del supporto MFT**](mft-support-dynamic-format-change-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="ad0d5-143">The exact sequence of events depends on the value of the [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) attribute.</span></span>



| <span data-ttu-id="ad0d5-144">Valore</span><span class="sxs-lookup"><span data-stu-id="ad0d5-144">Value</span></span>     | <span data-ttu-id="ad0d5-145">Descrizione</span><span class="sxs-lookup"><span data-stu-id="ad0d5-145">Description</span></span>                                                     |
|-----------|-----------------------------------------------------------------|
| <span data-ttu-id="ad0d5-146">**FALSE**</span><span class="sxs-lookup"><span data-stu-id="ad0d5-146">**FALSE**</span></span> | <span data-ttu-id="ad0d5-147">Prima di impostare un nuovo tipo di input, il client deve svuotare il MFT.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-147">Before the client sets a new input type, it must drain the MFT.</span></span> |
| <span data-ttu-id="ad0d5-148">**TRUE**</span><span class="sxs-lookup"><span data-stu-id="ad0d5-148">**TRUE**</span></span>  | <span data-ttu-id="ad0d5-149">Il client può impostare un nuovo tipo di input senza svuotare il MFT.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-149">The client can set a new input type without draining the MFT.</span></span>   |



 

<span data-ttu-id="ad0d5-150">Un MFT espone questo attributo tramite il metodo [**IMFTransform:: GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) .</span><span class="sxs-lookup"><span data-stu-id="ad0d5-150">An MFT exposes this attribute through its [**IMFTransform::GetAttributes**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getattributes) method.</span></span> <span data-ttu-id="ad0d5-151">Il valore predefinito di questo attributo è **false**; Se MFT non imposta l'attributo, considerare il valore come **false**.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-151">The default value of this attribute is **FALSE**; if the MFT does not set the attribute, treat the value as **FALSE**.</span></span>

<span data-ttu-id="ad0d5-152">**\_ \_ La modifica del formato dinamico del supporto MFT \_ \_ è false**</span><span class="sxs-lookup"><span data-stu-id="ad0d5-152">**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE is FALSE**</span></span>

1.  <span data-ttu-id="ad0d5-153">Il client invia il messaggio di [**\_ svuotamento del \_ comando \_ del messaggio MFT**](mft-message-command-drain.md) .</span><span class="sxs-lookup"><span data-stu-id="ad0d5-153">The client sends the [**MFT\_MESSAGE\_COMMAND\_DRAIN**](mft-message-command-drain.md) message.</span></span>
2.  <span data-ttu-id="ad0d5-154">Il client svuota il MFT chiamando [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) fino a quando **ProcessOutput** restituisce **MF \_ E \_ Transform \_ necessita di un \_ maggiore \_ input**.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-154">The client drains the MFT by calling [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) until **ProcessOutput** returns **MF\_E\_TRANSFORM\_NEED\_MORE\_INPUT**.</span></span>
3.  <span data-ttu-id="ad0d5-155">Il client chiama [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) per impostare il nuovo tipo di input.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-155">The client calls [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the new input type.</span></span>
4.  <span data-ttu-id="ad0d5-156">Il MFT convalida il tipo di input.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-156">The MFT validates the input type.</span></span> <span data-ttu-id="ad0d5-157">Se il tipo non è valido, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) restituisce **MF \_ E \_ INVALIDMEDIATYPE** o un altro codice di errore.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-157">If the type is invalid, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) returns **MF\_E\_INVALIDMEDIATYPE** or another error code.</span></span> <span data-ttu-id="ad0d5-158">In caso contrario, **SetInputType** restituisce S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-158">Otherwise, **SetInputType** returns S\_OK.</span></span>
5.  <span data-ttu-id="ad0d5-159">Supponendo che il tipo di input sia valido, la MFT valuta se il tipo di output cambia anche.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-159">Assuming the input type is valid, the MFT evaluates whether the output type also changes.</span></span> <span data-ttu-id="ad0d5-160">In caso contrario, il flusso continua e non è richiesta alcuna azione aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-160">If not, streaming continues, and no further action is required.</span></span>
6.  <span data-ttu-id="ad0d5-161">Se il tipo di output cambia:</span><span class="sxs-lookup"><span data-stu-id="ad0d5-161">If the output type changes:</span></span>
    1.  <span data-ttu-id="ad0d5-162">La MFT invalida il tipo di supporto di output corrente e aggiorna l'elenco dei tipi di supporti di output disponibili.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-162">The MFT invalidates its current output media type, and updates the list of available output media types.</span></span>
    2.  <span data-ttu-id="ad0d5-163">La chiamata successiva a [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) restituisce **la \_ \_ modifica del \_ flusso \_ di trasformazione MF e**, come descritto nella sezione precedente.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-163">The next call to [**ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**, as described in the previous section.</span></span>
    3.  <span data-ttu-id="ad0d5-164">Il client chiama [**IMFTransform:: GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) per ottenere l'elenco aggiornato dei tipi di output.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-164">The client calls [**IMFTransform::GetOutputAvailableType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-getoutputavailabletype) to get the updated list of output types.</span></span>
    4.  <span data-ttu-id="ad0d5-165">Il client chiama [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span><span class="sxs-lookup"><span data-stu-id="ad0d5-165">The client calls [**SetOutputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setoutputtype).</span></span>

<span data-ttu-id="ad0d5-166">**\_ \_ La modifica del formato dinamico del supporto MFT \_ \_ è true**</span><span class="sxs-lookup"><span data-stu-id="ad0d5-166">**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE is TRUE**</span></span>

1.  <span data-ttu-id="ad0d5-167">Il client chiama [**IMFTransform:: SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) per impostare il nuovo tipo di input.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-167">The client calls [**IMFTransform::SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) to set the new input type.</span></span>
2.  <span data-ttu-id="ad0d5-168">Il MFT convalida il tipo di input.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-168">The MFT validates the input type.</span></span> <span data-ttu-id="ad0d5-169">Se il tipo non è valido, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) restituisce **MF \_ E \_ INVALIDMEDIATYPE** o un altro codice di errore.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-169">If the type is invalid, [**SetInputType**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-setinputtype) returns **MF\_E\_INVALIDMEDIATYPE** or another error code.</span></span> <span data-ttu-id="ad0d5-170">In caso contrario, **SetInputType** restituisce S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-170">Otherwise, **SetInputType** returns S\_OK.</span></span>
3.  <span data-ttu-id="ad0d5-171">Supponendo che il tipo di input sia valido, la MFT valuta se il tipo di output cambia anche.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-171">Assuming the input type is valid, the MFT evaluates whether the output type also changes.</span></span> <span data-ttu-id="ad0d5-172">In caso contrario, il flusso continua e non è richiesta alcuna azione aggiuntiva.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-172">If not, streaming continues, and no further action is required.</span></span>
4.  <span data-ttu-id="ad0d5-173">Prima della modifica del tipo di output, il MFT deve elaborare tutti gli esempi di input memorizzati nella cache, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="ad0d5-173">Before the output type changes, the MFT must process any cached input samples, as follows:</span></span>
    1.  <span data-ttu-id="ad0d5-174">Il MFT non invalida il tipo di output corrente.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-174">The MFT does not invalidate its current output type.</span></span>
    2.  <span data-ttu-id="ad0d5-175">Il MFT produce il maggior volume di output possibile dagli esempi di input memorizzati nella cache.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-175">The MFT produces as much output as it can from the cached input samples.</span></span>
    3.  <span data-ttu-id="ad0d5-176">È facoltativo se MFT accetta nuovi esempi di input mentre elabora gli esempi memorizzati nella cache.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-176">It is optional whether the MFT accepts new input samples while it processes the cached samples.</span></span> <span data-ttu-id="ad0d5-177">In tal caso, i nuovi esempi di input utilizzeranno il nuovo formato di input, quindi il MFT deve tenere traccia del punto in cui il formato è stato modificato.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-177">If so, the new input samples will use the new input format, so the MFT must keep track of the point when the format changed.</span></span>
5.  <span data-ttu-id="ad0d5-178">Quando MFT elabora tutti gli esempi ricevuti prima della modifica del tipo di input, [**IMFTransform::P rocessoutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) restituisce la modifica del **\_ flusso di \_ trasformazione \_ \_ MF E**.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-178">After the MFT processes all of the samples that it received before the input type changed, the [**IMFTransform::ProcessOutput**](/windows/desktop/api/mftransform/nf-mftransform-imftransform-processoutput) returns **MF\_E\_TRANSFORM\_STREAM\_CHANGE**.</span></span>
6.  <span data-ttu-id="ad0d5-179">La MFT invalida il tipo di output corrente e aggiorna l'elenco dei tipi di supporti di output disponibili.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-179">The MFT invalidates its current output type, and updates the list of available output media types.</span></span>
7.  <span data-ttu-id="ad0d5-180">Il client negozia il nuovo tipo di output, come descritto in precedenza.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-180">The client negotiates the new output type, as described previously.</span></span>

<span data-ttu-id="ad0d5-181">[MFTS asincrono](asynchronous-mfts.md) deve restituire il valore **true** per l'attributo di [**\_ \_ \_ \_ modifica del formato dinamico del supporto MFT**](mft-support-dynamic-format-change-attribute.md) .</span><span class="sxs-lookup"><span data-stu-id="ad0d5-181">[Asynchronous MFTs](asynchronous-mfts.md) must return the value **TRUE** for the [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) attribute.</span></span> <span data-ttu-id="ad0d5-182">Quando si usa un MFT asincrono, il client può presumere che l'attributo di **\_ \_ \_ \_ modifica del formato dinamico del supporto MFT** sia impostato su **true**.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-182">When using an asynchronous MFT, the client can assume that the **MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE** attribute is set to **TRUE**.</span></span>

<span data-ttu-id="ad0d5-183">Quando [**MFT \_ supporta \_ la \_ \_ modifica del formato dinamico**](mft-support-dynamic-format-change-attribute.md) è **true**, la differenza principale consiste nel fatto che il client non deve svuotare MFT prima di impostare un nuovo tipo di input.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-183">When [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) is **TRUE**, the main difference is that the client is not required to drain the MFT before setting a new input type.</span></span> <span data-ttu-id="ad0d5-184">Di conseguenza, il tipo di input potrebbe cambiare mentre il MFT mantiene gli esempi di input.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-184">As a result, the input type might change while the MFT is holding onto input samples.</span></span> <span data-ttu-id="ad0d5-185">È importante che il MFT non elimini semplicemente questi esempi.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-185">It is important that the MFT does not simply drop these samples.</span></span> <span data-ttu-id="ad0d5-186">Inoltre, il tipo di output non può essere modificato finché il MFT non elabora tutti i dati memorizzati nella cache.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-186">Also, the output type cannot change until the MFT processes all of its cached data.</span></span>

<span data-ttu-id="ad0d5-187">Il paragrafo precedente si applica in particolare ai decodificatori video, che possono ricevere frame intercodificati fuori dall'ordine temporale e quindi devono memorizzarli nella cache.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-187">The previous paragraph applies especially to video decoders, which can receive inter-coded frames out of temporal order, and thus need to cache them.</span></span> <span data-ttu-id="ad0d5-188">Se un MFT non memorizza nella cache gli esempi di input, lo svuotamento è essenzialmente un no-op.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-188">If an MFT does not cache input samples, draining is essentially a no-op.</span></span> <span data-ttu-id="ad0d5-189">In tal caso, la MFT può impostare [**la \_ \_ modifica del \_ formato \_ dinamico del supporto MFT**](mft-support-dynamic-format-change-attribute.md) su **false** (o lasciare l'attributo non impostato).</span><span class="sxs-lookup"><span data-stu-id="ad0d5-189">In that case, the MFT can set [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) to **FALSE** (or leave the attribute unset).</span></span>

<span data-ttu-id="ad0d5-190">Si noti anche che ogni MFT dovrebbe gestire correttamente le modifiche del formato dopo essere state svuotate.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-190">Also, note that every MFT is expected to handle format changes correctly after being drained.</span></span> <span data-ttu-id="ad0d5-191">L'attributo di [**\_ \_ \_ \_ modifica del formato dinamico del supporto MFT**](mft-support-dynamic-format-change-attribute.md) indica se il MFT supporta le modifiche del formato senza svuotamento.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-191">The [**MFT\_SUPPORT\_DYNAMIC\_FORMAT\_CHANGE**](mft-support-dynamic-format-change-attribute.md) attribute indicates whether the MFT supports format changes without draining.</span></span>

## <a name="change-in-interlace-mode"></a><span data-ttu-id="ad0d5-192">Modifica in modalità interlacciata</span><span class="sxs-lookup"><span data-stu-id="ad0d5-192">Change in Interlace Mode</span></span>

<span data-ttu-id="ad0d5-193">Le modifiche alla modalità di interlacciamento video costituiscono un caso speciale, perché non invalidano il tipo di supporto corrente.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-193">Changes in the video interlacing mode are a special case, because they do not invalidate the current media type.</span></span> <span data-ttu-id="ad0d5-194">Viene invece specificata la modalità interlacciamento per ogni fotogramma video impostando gli attributi nell'esempio multimediale.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-194">Instead, the interlace mode is specified for each video frame by setting attributes on the media sample.</span></span> <span data-ttu-id="ad0d5-195">Un video MFT deve controllare ogni esempio di input per la presenza di questi flag.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-195">A video MFT should check each input sample for the presence of these flags.</span></span>

<span data-ttu-id="ad0d5-196">La modalità interlacciamento può variare quando la dominanza del campo passa dal campo superiore a quello inferiore o quando il video passa tra immagini progressive e interlacciate.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-196">The interlace mode can change when the field dominance switches from top-field to bottom-field, or when the video switches between progressive and interlaced pictures.</span></span>

<span data-ttu-id="ad0d5-197">Per altre informazioni, vedere [flag interlacciamento](video-interlacing.md)per gli esempi.</span><span class="sxs-lookup"><span data-stu-id="ad0d5-197">For more information, see [Interlace Flags on Samples](video-interlacing.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="ad0d5-198">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="ad0d5-198">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ad0d5-199">Scrittura di un MFT personalizzato</span><span class="sxs-lookup"><span data-stu-id="ad0d5-199">Writing a Custom MFT</span></span>](writing-a-custom-mft.md)
</dt> </dl>

 

 



