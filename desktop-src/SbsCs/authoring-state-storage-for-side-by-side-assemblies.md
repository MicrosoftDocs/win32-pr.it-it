---
description: Quando si creano assembly affiancati, attenersi alle linee guida per la creazione di assembly affiancati e creare eventuali DLL da includere nell'assembly in base alle linee guida per la creazione di una DLL per un assembly affiancato.
ms.assetid: 0e98bbcd-7e23-4a33-b0fa-1f936d0ef96b
title: Creazione dell'archiviazione dello stato per gli assembly affiancati
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: eee388cf680ee3a186a225ca7e3bde8b6eae625d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "103757310"
---
# <a name="authoring-state-storage-for-side-by-side-assemblies"></a><span data-ttu-id="ac796-103">Creazione dell'archiviazione dello stato per gli assembly affiancati</span><span class="sxs-lookup"><span data-stu-id="ac796-103">Authoring State Storage for Side-by-side Assemblies</span></span>

<span data-ttu-id="ac796-104">Quando si creano assembly affiancati, attenersi alle [linee guida per la creazione di assembly affiancati](guidelines-for-creating-side-by-side-assemblies.md) e creare eventuali dll da includere nell'assembly in base alle linee guida per la creazione di [una dll per un assembly affiancato](authoring-a-dll-for-a-side-by-side-assembly.md).</span><span class="sxs-lookup"><span data-stu-id="ac796-104">When creating your own side-by-side assemblies, follow the [Guidelines for Creating Side-by-side Assemblies](guidelines-for-creating-side-by-side-assemblies.md) and author any DLL to be included in the assembly according to the guidelines in [Authoring a DLL for a Side-by-Side Assembly](authoring-a-dll-for-a-side-by-side-assembly.md).</span></span>

<span data-ttu-id="ac796-105">Rispettare le linee guida seguenti per l'archiviazione dello stato:</span><span class="sxs-lookup"><span data-stu-id="ac796-105">Adhere to the following guidelines for the storage of the state:</span></span>

-   <span data-ttu-id="ac796-106">Progettare l'archiviazione dello stato in modo che sia compatibile con le versioni precedenti e successive.</span><span class="sxs-lookup"><span data-stu-id="ac796-106">Design state storage to be forward and backward compatible.</span></span> <span data-ttu-id="ac796-107">Si prevede che le versioni vengano utilizzate in qualsiasi ordine, ad esempio V1, V3, quindi V2.</span><span class="sxs-lookup"><span data-stu-id="ac796-107">Expect the versions to be used in any order: for example, v1, then v3, then v2.</span></span>
-   <span data-ttu-id="ac796-108">Inizializzare e impostare le impostazioni predefinite per l'assembly nel codice dell'assembly.</span><span class="sxs-lookup"><span data-stu-id="ac796-108">Initialize and set the default settings for the assembly in the assembly code.</span></span> <span data-ttu-id="ac796-109">Non salvare le impostazioni predefinite nel registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="ac796-109">Do not save the defaults settings in the registry.</span></span>
-   <span data-ttu-id="ac796-110">Le impostazioni del registro di sistema devono essere scritte in base a una singola versione per isolare più versioni di assembly che possono essere eseguite contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="ac796-110">Registry settings must be written on an individual-version basis to isolate multiple assembly versions that may be run at the same time.</span></span> <span data-ttu-id="ac796-111">Progettare un assembly side-by-side per archiviare e gestire correttamente lo stato dell'assembly durante gli scenari di condivisione side-by-side.</span><span class="sxs-lookup"><span data-stu-id="ac796-111">Design your side-by-side assembly to correctly store and handle the state of the assembly during side-by-side sharing scenarios.</span></span>
-   <span data-ttu-id="ac796-112">Gli assembly comunemente archiviano le informazioni sullo stato nelle chiavi del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="ac796-112">Assemblies commonly store state information in registry keys.</span></span> <span data-ttu-id="ac796-113">Creazione di un set di file di intestazione e funzioni helper per fornire un modo semplice per la versione delle chiavi del registro di sistema contenenti lo stato dell'assembly.</span><span class="sxs-lookup"><span data-stu-id="ac796-113">Author a set of header files and helper functions to provide an easy way to version registry keys containing the assembly state.</span></span>
-   <span data-ttu-id="ac796-114">Le informazioni sullo stato dell'assembly salvate nel registro di sistema devono essere isolate dalle altre versioni dell'assembly.</span><span class="sxs-lookup"><span data-stu-id="ac796-114">Any assembly state information saved in the registry must be isolated from other versions of the assembly.</span></span> <span data-ttu-id="ac796-115">Le impostazioni di stato archiviate nel registro di sistema devono essere salvate in singole sezioni del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="ac796-115">State settings stored in the registry must be saved in individual version sections of the registry.</span></span> <span data-ttu-id="ac796-116">Questa operazione è necessaria nelle parti HKLM e HKCU del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="ac796-116">This is required in both the HKLM and HKCU parts of the registry.</span></span> <span data-ttu-id="ac796-117">Ad esempio, archiviare le impostazioni dello stato HKCU per l'assembly versione XXXX sotto la chiave del registro di sistema seguente:</span><span class="sxs-lookup"><span data-stu-id="ac796-117">For example, store HKCU state settings for assembly version XXXX under the following registry key:</span></span>

    <span data-ttu-id="ac796-118">**HKCU** \\ **MyCompany** \\ **Componente** \\ di **VersionXXXX**</span><span class="sxs-lookup"><span data-stu-id="ac796-118">**HKCU**\\**MyCompany**\\**MyComponent**\\**VersionXXXX**</span></span>

-   <span data-ttu-id="ac796-119">Tutte le informazioni sullo stato archiviate nel registro di sistema da assembly condivisi devono essere salvate nelle singole sezioni della versione del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="ac796-119">Any state information stored in the registry by shared assemblies must be saved in individual version sections of the registry.</span></span> <span data-ttu-id="ac796-120">Ad esempio, un'impostazione di stato denominata EnableSuperCoolFeature potrebbe avere un valore **true** o **false**.</span><span class="sxs-lookup"><span data-stu-id="ac796-120">For example, a state setting called EnableSuperCoolFeature might have a value of **TRUE** or **FALSE**.</span></span> <span data-ttu-id="ac796-121">Archiviare il valore per un [*assembly side-by-side condiviso*](s-sbscs-gly.md) come segue:</span><span class="sxs-lookup"><span data-stu-id="ac796-121">Store the value for a [*shared side-by-side assembly*](s-sbscs-gly.md) as follows:</span></span>

    <span data-ttu-id="ac796-122">**HKEY \_ CurrentUser** \\ **software** \\ **MyCompany MyCompany** \\  \\ **versione 01.01** \\ **EnableSuperCoolFeature = true**</span><span class="sxs-lookup"><span data-stu-id="ac796-122">**HKEY\_CurrentUser**\\**Software**\\**MyCompany**\\**MyComponent**\\**Version01.01**\\**EnableSuperCoolFeature = TRUE**</span></span>

-   <span data-ttu-id="ac796-123">Tutte le informazioni sullo stato archiviate nel registro di sistema da assembly privati devono essere salvate nelle singole sezioni dell'applicazione del registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="ac796-123">Any state information stored in the registry by private assemblies must be saved in individual application sections of the registry.</span></span> <span data-ttu-id="ac796-124">Questo consente di isolare le impostazioni dello stato dell'assembly nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ac796-124">This isolates the assembly's state settings to the application.</span></span> <span data-ttu-id="ac796-125">Per configurare una radice virtuale, è possibile usare la funzione [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) .</span><span class="sxs-lookup"><span data-stu-id="ac796-125">You can use the [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function to set up a virtual root.</span></span> <span data-ttu-id="ac796-126">Se ad esempio la versione dell'assembly XXYY è un assembly privato di "SomeApplication", una chiamata a **GetModuleFileName** restituisce "SomeApplication" e le impostazioni di stato privato per l'assembly devono essere scritte con la chiave seguente:</span><span class="sxs-lookup"><span data-stu-id="ac796-126">For example, if assembly version XXYY is a private assembly of "SomeApplication," a call to **GetModuleFileName** returns "SomeApplication" and any private state settings for the assembly should be written under the following key:</span></span>

    <span data-ttu-id="ac796-127">**HKCU** \\ **MyCompany** \\ **Componente** \\ di **VersionXXYY** \\ **SomeApplication**</span><span class="sxs-lookup"><span data-stu-id="ac796-127">**HKCU**\\**MyCompany**\\**MyComponent**\\**VersionXXYY**\\**SomeApplication**</span></span>

-   <span data-ttu-id="ac796-128">Rendere le impostazioni dello stato condivise archiviate nel registro di sistema private al contesto dell'assembly eseguito da.</span><span class="sxs-lookup"><span data-stu-id="ac796-128">Make shared state settings stored in the registry private to the assembly context that runs.</span></span> <span data-ttu-id="ac796-129">Per configurare una radice virtuale, è possibile usare la funzione [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) .</span><span class="sxs-lookup"><span data-stu-id="ac796-129">You can use the [**GetModuleFileName**](/windows/desktop/api/libloaderapi/nf-libloaderapi-getmodulefilenamea) function to set up a virtual root.</span></span> <span data-ttu-id="ac796-130">Questa operazione deve essere eseguita per i rami HKLM e HKCU.</span><span class="sxs-lookup"><span data-stu-id="ac796-130">This should be done for HKLM and HKCU branches.</span></span>
-   <span data-ttu-id="ac796-131">Idealmente, è consigliabile adottare un modello di persistenza in cui l'applicazione rende persistente lo stato e non modifica il registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="ac796-131">Ideally, you should adopt a persistence model in which the application persists the state and does not alter the registry.</span></span> <span data-ttu-id="ac796-132">Non è necessario che un'applicazione tocchi direttamente le voci del registro di sistema del componente.</span><span class="sxs-lookup"><span data-stu-id="ac796-132">An application should not need to directly touch the component's registry entries.</span></span> <span data-ttu-id="ac796-133">L'assembly deve invece offrire funzioni API che salvano o ripristinano le impostazioni compatibili side-by-side.</span><span class="sxs-lookup"><span data-stu-id="ac796-133">Instead, the assembly should offer API functions that save or restore settings that are side-by-side compatible.</span></span>
-   <span data-ttu-id="ac796-134">Gli assembly possono salvare le impostazioni dello stato nei negozi esterni al registro di sistema per consentire all'assembly di interagire con lo stato globale.</span><span class="sxs-lookup"><span data-stu-id="ac796-134">Assemblies may save state settings in stores outside the registry to enable the assembly to interact with the global state.</span></span> <span data-ttu-id="ac796-135">Gli assembly affiancati possono usare i seguenti archivi compatibili side-by-Side:</span><span class="sxs-lookup"><span data-stu-id="ac796-135">Side-by-side assemblies may use the following side-by-side compatible stores:</span></span>
    -   <span data-ttu-id="ac796-136">Archivio protetto (*PStore*)</span><span class="sxs-lookup"><span data-stu-id="ac796-136">A protected store (*pstore*)</span></span>
    -   <span data-ttu-id="ac796-137">Una cache WinInet</span><span class="sxs-lookup"><span data-stu-id="ac796-137">A WinInet cache</span></span>
    -   <span data-ttu-id="ac796-138">Microsoft SQL Server</span><span class="sxs-lookup"><span data-stu-id="ac796-138">A Microsoft SQL Server</span></span>

 

 
