---
title: Implementazione e attivazione di un gestore senza dati server aggiuntivi
description: Implementazione e attivazione di un gestore senza dati server aggiuntivi
ms.assetid: 9d91260a-4cec-4a10-bb57-d02999efae47
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 6866b40e1257a865aa5068ffd46611c411498877
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/03/2021
ms.locfileid: "103968795"
---
# <a name="implementing-and-activating-a-handler-with-no-extra-server-data"></a><span data-ttu-id="ba53f-103">Implementazione e attivazione di un gestore senza dati server aggiuntivi</span><span class="sxs-lookup"><span data-stu-id="ba53f-103">Implementing and Activating a Handler with No Extra Server Data</span></span>

<span data-ttu-id="ba53f-104">Per creare un'istanza del gestore, se è uno che non ottiene dati server aggiuntivi, il server deve implementare [**IStdMarshalInfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) ma non [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span><span class="sxs-lookup"><span data-stu-id="ba53f-104">To create an instance of your handler, if it is one that gets no extra server data, the server must implement [**IStdMarshalInfo**](/windows/win32/api/objidlbase/nn-objidlbase-istdmarshalinfo) but not [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal).</span></span> <span data-ttu-id="ba53f-105">**IStdMarshalInfo** dispone di un metodo, [**GetClassForHandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler), che recupera il CLSID del gestore dell'oggetto da utilizzare nel processo di destinazione.</span><span class="sxs-lookup"><span data-stu-id="ba53f-105">**IStdMarshalInfo** has one method, [**GetClassForHandler**](/windows/win32/api/objidlbase/nf-objidlbase-istdmarshalinfo-getclassforhandler), which retrieves the CLSID of the object handler to be used in the destination process.</span></span> <span data-ttu-id="ba53f-106">COM chiama questo oggetto quando chiama [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) per l'utente e attiva il gestore sul lato client.</span><span class="sxs-lookup"><span data-stu-id="ba53f-106">COM calls this when it calls [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) for you and activates the handler on the client side.</span></span>

<span data-ttu-id="ba53f-107">Le implementazioni del server e del gestore devono quindi chiamare la funzione [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) .</span><span class="sxs-lookup"><span data-stu-id="ba53f-107">Next, both the server and handler implementations must call the [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex) function.</span></span> <span data-ttu-id="ba53f-108">Questa funzione crea un gestore di marshalling standard su ciascun lato (chiamato gestione proxy sul lato client e un gestore Stub sul lato server).</span><span class="sxs-lookup"><span data-stu-id="ba53f-108">This function creates a standard marshaler on each side (called a proxy manager on the client side and a stub manager on the server side).</span></span>

<span data-ttu-id="ba53f-109">Il server chiama [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passando il flag SMEXF \_ Server.</span><span class="sxs-lookup"><span data-stu-id="ba53f-109">The server calls [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the flag SMEXF\_SERVER.</span></span> <span data-ttu-id="ba53f-110">Viene creato un gestore di marshalling standard lato server (gestione Stub).</span><span class="sxs-lookup"><span data-stu-id="ba53f-110">This creates a server-side standard marshaler (stub manager).</span></span> <span data-ttu-id="ba53f-111">La struttura sul lato server è illustrata nella figura seguente:</span><span class="sxs-lookup"><span data-stu-id="ba53f-111">The server-side structure is shown in the following illustration:</span></span>

![Diagramma che mostra la struttura lato server.](images/b47b3bc0-3e7d-4be4-9767-7ae436bd1b21.png)

## <a name="server-side-structure"></a><span data-ttu-id="ba53f-113">Struttura Server-Side</span><span class="sxs-lookup"><span data-stu-id="ba53f-113">Server-Side Structure</span></span>

<span data-ttu-id="ba53f-114">Il gestore chiama [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passando il flag SMEXF \_ handler.</span><span class="sxs-lookup"><span data-stu-id="ba53f-114">The handler calls [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the flag SMEXF\_HANDLER.</span></span> <span data-ttu-id="ba53f-115">Viene creato un gestore di marshalling standard lato client (gestione proxy) che viene aggregato con il gestore sul lato client.</span><span class="sxs-lookup"><span data-stu-id="ba53f-115">This creates a client-side standard marshaler (proxy manager) and aggregates it with the handler on the client side.</span></span> <span data-ttu-id="ba53f-116">La durata di entrambi i valori viene gestita dall'oggetto identità di controllo (che implementa [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)) implementato dal sistema quando il gestore chiama **CoGetStdMarshalEx**.</span><span class="sxs-lookup"><span data-stu-id="ba53f-116">The lifetime of both are managed by the controlling identity object (implementing [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown)) that the system implements when the handler calls **CoGetStdMarshalEx**.</span></span> <span data-ttu-id="ba53f-117">La struttura sul lato client è illustrata nella figura seguente.</span><span class="sxs-lookup"><span data-stu-id="ba53f-117">The client-side structure is shown in the following illustration.</span></span>

![Diagramma che mostra la struttura lato client.](images/24ae70ef-dfa8-4784-90ac-dc6cfb043ee5.png)

## <a name="client-side-structure"></a><span data-ttu-id="ba53f-119">Struttura Client-Side</span><span class="sxs-lookup"><span data-stu-id="ba53f-119">Client-Side Structure</span></span>

<span data-ttu-id="ba53f-120">Come illustrato nella figura precedente, il gestore è effettivamente inserito tra il gestore del proxy e l'identità o il controllo sconosciuto.</span><span class="sxs-lookup"><span data-stu-id="ba53f-120">As shown in the preceding illustration, the handler is actually sandwiched between the proxy manager and the identity/controlling unknown.</span></span> <span data-ttu-id="ba53f-121">In questo modo il controllo del sistema viene assegnato alla durata dell'oggetto, fornendo al gestore il controllo sulle interfacce esposte.</span><span class="sxs-lookup"><span data-stu-id="ba53f-121">This gives the system control over the lifetime of the object while giving the handler control over the exposed interfaces.</span></span> <span data-ttu-id="ba53f-122">La linea tratteggiata tra Identity e gestione proxy indica che i due condividono una stretta integrazione tramite interfacce private interne.</span><span class="sxs-lookup"><span data-stu-id="ba53f-122">The dashed line between the Identity and Proxy Manager indicates that the two share tight integration through internal private interfaces.</span></span>

<span data-ttu-id="ba53f-123">Quando COM chiama [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) per il client, crea l'istanza del gestore e la aggrega con l'identità.</span><span class="sxs-lookup"><span data-stu-id="ba53f-123">When COM calls [**CoUnmarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-counmarshalinterface) for the client, it creates the handler instance, aggregating it with the Identity.</span></span> <span data-ttu-id="ba53f-124">Il gestore creerà il gestore di marshalling standard, tramite la chiamata a [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passando il controllo sconosciuto ricevuto al momento della creazione.</span><span class="sxs-lookup"><span data-stu-id="ba53f-124">The handler will create the standard marshaler (through the call to [**CoGetStdMarshalEx**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetstdmarshalex), passing in the controlling unknown it received when it was created).</span></span> <span data-ttu-id="ba53f-125">Il gestore non implementa [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) ma restituisce solo **IMarshal** dal gestore di marshalling standard.</span><span class="sxs-lookup"><span data-stu-id="ba53f-125">The handler does not implement [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) but just returns **IMarshal** from the standard marshaler.</span></span> <span data-ttu-id="ba53f-126">Anche se il gestore implementa **IMarshal**, non viene chiamato durante l'unmarshalling.</span><span class="sxs-lookup"><span data-stu-id="ba53f-126">Even if the handler does implement **IMarshal**, it will not get called during an unmarshal.</span></span>

<span data-ttu-id="ba53f-127">Se due thread eseguono contemporaneamente l'unmarshalling dello stesso oggetto per la prima volta, è possibile che due gestori vengano creati temporaneamente.</span><span class="sxs-lookup"><span data-stu-id="ba53f-127">If two threads simultaneously unmarshal the same object for the first time, it is possible for two handlers to get created temporarily.</span></span> <span data-ttu-id="ba53f-128">Una verrà rilasciata successivamente.</span><span class="sxs-lookup"><span data-stu-id="ba53f-128">One will subsequently be released.</span></span>

## <a name="related-topics"></a><span data-ttu-id="ba53f-129">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="ba53f-129">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="ba53f-130">Gestore di Client-Side Lightweight</span><span class="sxs-lookup"><span data-stu-id="ba53f-130">The Lightweight Client-Side Handler</span></span>](the-lightweight-client-side-handler.md)
</dt> </dl>

 

 