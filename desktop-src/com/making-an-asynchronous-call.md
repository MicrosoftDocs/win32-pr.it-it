---
title: Esecuzione di una chiamata asincrona
description: La procedura per eseguire una chiamata sincrona è semplice, il client ottiene un puntatore a interfaccia sull'oggetto server e chiama i metodi tramite tale puntatore. La chiamata asincrona comporta un oggetto chiamata, quindi comporta alcuni passaggi.
ms.assetid: ab65d38d-836a-48d4-87c1-8812cbc8ff92
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 22dcd7a6509cd07e12357a96222baa04f9e4c942
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/21/2020
ms.locfileid: "104399791"
---
# <a name="making-an-asynchronous-call"></a><span data-ttu-id="cc860-104">Esecuzione di una chiamata asincrona</span><span class="sxs-lookup"><span data-stu-id="cc860-104">Making an Asynchronous Call</span></span>

<span data-ttu-id="cc860-105">La procedura per eseguire una chiamata sincrona è semplice: il client ottiene un puntatore a interfaccia sull'oggetto server e chiama i metodi tramite tale puntatore.</span><span class="sxs-lookup"><span data-stu-id="cc860-105">The procedure for making a synchronous call is straightforward: The client obtains an interface pointer on the server object and calls methods through that pointer.</span></span> <span data-ttu-id="cc860-106">La chiamata asincrona comporta un oggetto chiamata, quindi comporta alcuni passaggi.</span><span class="sxs-lookup"><span data-stu-id="cc860-106">Asynchronous calling involves a call object, so it involves a few more steps.</span></span>

<span data-ttu-id="cc860-107">Per ogni metodo su un'interfaccia sincrona, l'interfaccia asincrona corrispondente implementa due metodi.</span><span class="sxs-lookup"><span data-stu-id="cc860-107">For each method on a synchronous interface, the corresponding asynchronous interface implements two methods.</span></span> <span data-ttu-id="cc860-108">Questi metodi alleghino i prefissi iniziano \_ e terminano \_ con il nome del metodo sincrono.</span><span class="sxs-lookup"><span data-stu-id="cc860-108">These methods attach the prefixes Begin\_ and Finish\_ to the name of the synchronous method.</span></span> <span data-ttu-id="cc860-109">Se, ad esempio, un'interfaccia denominata ISimpleStream dispone di un metodo Read, l'interfaccia AsyncISimpleStream disporrà di un \_ metodo Begin Read e Finish \_ Read.</span><span class="sxs-lookup"><span data-stu-id="cc860-109">For example, if an interface named ISimpleStream has a Read method, the AsyncISimpleStream interface will have a Begin\_Read and a Finish\_Read method.</span></span> <span data-ttu-id="cc860-110">Per iniziare una chiamata asincrona, il client chiama il \_ metodo Begin.</span><span class="sxs-lookup"><span data-stu-id="cc860-110">To begin an asynchronous call, the client calls the Begin\_ method.</span></span>

<span data-ttu-id="cc860-111">**Per iniziare una chiamata asincrona**</span><span class="sxs-lookup"><span data-stu-id="cc860-111">**To begin an asynchronous call**</span></span>

1.  <span data-ttu-id="cc860-112">Eseguire una query sull'oggetto server per l'interfaccia [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory) .</span><span class="sxs-lookup"><span data-stu-id="cc860-112">Query the server object for the [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory) interface.</span></span> <span data-ttu-id="cc860-113">Se [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) restituisce E \_ nointerface, l'oggetto server non supporta la chiamata asincrona.</span><span class="sxs-lookup"><span data-stu-id="cc860-113">If [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) returns E\_NOINTERFACE, the server object does not support asynchronous calling.</span></span>

2.  <span data-ttu-id="cc860-114">Chiamare [**ICallFactory:: CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) per creare un oggetto chiamata corrispondente all'interfaccia desiderata, quindi rilasciare il puntatore a [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory).</span><span class="sxs-lookup"><span data-stu-id="cc860-114">Call [**ICallFactory::CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) to create a call object corresponding to the interface you want, and then release the pointer to [**ICallFactory**](/windows/win32/api/objidlbase/nn-objidlbase-icallfactory).</span></span>

3.  <span data-ttu-id="cc860-115">Se non è stato richiesto un puntatore all'interfaccia asincrona dalla chiamata a [**CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall), eseguire una query sull'oggetto chiamata per l'interfaccia asincrona.</span><span class="sxs-lookup"><span data-stu-id="cc860-115">If you did not request a pointer to the asynchronous interface from the call to [**CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall), query the call object for the asynchronous interface.</span></span>

4.  <span data-ttu-id="cc860-116">Chiamare il metodo Begin appropriato \_ .</span><span class="sxs-lookup"><span data-stu-id="cc860-116">Call the appropriate Begin\_ method.</span></span>

<span data-ttu-id="cc860-117">L'oggetto server sta ora elaborando la chiamata asincrona e il client è libero di eseguire altre operazioni fino a quando non sono necessari i risultati della chiamata.</span><span class="sxs-lookup"><span data-stu-id="cc860-117">The server object is now processing the asynchronous call, and the client is free to do other work until it needs the results of the call.</span></span>

<span data-ttu-id="cc860-118">Un oggetto call può elaborare una sola chiamata asincrona alla volta.</span><span class="sxs-lookup"><span data-stu-id="cc860-118">A call object can process only one asynchronous call at a time.</span></span> <span data-ttu-id="cc860-119">Se lo stesso o un secondo client chiama un \_ metodo Begin prima del completamento di una chiamata asincrona in sospeso, il \_ metodo Begin restituirà la \_ chiamata RPC E \_ \_ in sospeso.</span><span class="sxs-lookup"><span data-stu-id="cc860-119">If the same or a second client calls a Begin\_ method before a pending asynchronous call is finished, the Begin\_ method will return RPC\_E\_CALL\_PENDING.</span></span>

<span data-ttu-id="cc860-120">Se il client non richiede i risultati del \_ metodo Begin, può rilasciare l'oggetto call alla fine di questa procedura.</span><span class="sxs-lookup"><span data-stu-id="cc860-120">If the client does not need the results of the Begin\_ method, it can release the call object at the end of this procedure.</span></span> <span data-ttu-id="cc860-121">COM rileva questa condizione e pulisce la chiamata.</span><span class="sxs-lookup"><span data-stu-id="cc860-121">COM detects this condition and cleans up the call.</span></span> <span data-ttu-id="cc860-122">Il \_ Metodo Finish non viene chiamato e il client non ottiene alcun parametro out o un valore restituito.</span><span class="sxs-lookup"><span data-stu-id="cc860-122">The Finish\_ method is not called, and the client does not get any out parameters or a return value.</span></span>

<span data-ttu-id="cc860-123">Quando l'oggetto server è pronto per essere restituito dal \_ metodo Begin, segnala l'oggetto chiamata che è stato eseguito.</span><span class="sxs-lookup"><span data-stu-id="cc860-123">When the server object is ready to return from the Begin\_ method, it signals the call object that it is done.</span></span> <span data-ttu-id="cc860-124">Quando il client è pronto, verifica se l'oggetto chiamata è stato segnalato.</span><span class="sxs-lookup"><span data-stu-id="cc860-124">When the client is ready, it checks to see whether the call object has been signaled.</span></span> <span data-ttu-id="cc860-125">In tal caso, il client può completare la chiamata asincrona.</span><span class="sxs-lookup"><span data-stu-id="cc860-125">If so, the client can complete the asynchronous call.</span></span>

<span data-ttu-id="cc860-126">Il meccanismo per la segnalazione e il controllo tra client e server è l'interfaccia [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) nell'oggetto call.</span><span class="sxs-lookup"><span data-stu-id="cc860-126">The mechanism for this signaling and checking between client and server is the [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) interface on the call object.</span></span> <span data-ttu-id="cc860-127">L'oggetto call normalmente implementa questa interfaccia aggregando un oggetto di sincronizzazione fornito dal sistema.</span><span class="sxs-lookup"><span data-stu-id="cc860-127">The call object normally implements this interface by aggregating a system-supplied synchronization object.</span></span> <span data-ttu-id="cc860-128">L'oggetto di sincronizzazione esegue il wrapping di un handle di evento, che il server segnala immediatamente prima \_ di restituire il metodo Begin chiamando [**ISynchronize:: Signal**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-signal).</span><span class="sxs-lookup"><span data-stu-id="cc860-128">The synchronization object wraps an event handle, which the server signals just before returning from the Begin\_ method by calling [**ISynchronize::Signal**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-signal).</span></span>

<span data-ttu-id="cc860-129">**Per completare una chiamata asincrona**</span><span class="sxs-lookup"><span data-stu-id="cc860-129">**To complete an asynchronous call**</span></span>

1.  <span data-ttu-id="cc860-130">Eseguire una query sull'oggetto chiamata per l'interfaccia [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) .</span><span class="sxs-lookup"><span data-stu-id="cc860-130">Query the call object for the [**ISynchronize**](/windows/win32/api/objidlbase/nn-objidlbase-isynchronize) interface.</span></span>

2.  <span data-ttu-id="cc860-131">Chiamare [**ISynchronize:: wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait).</span><span class="sxs-lookup"><span data-stu-id="cc860-131">Call [**ISynchronize::Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait).</span></span>

3.  <span data-ttu-id="cc860-132">Se [**wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) restituisce \_ \_ il timeout RPC e, l' \_ elaborazione del metodo Begin non è terminata.</span><span class="sxs-lookup"><span data-stu-id="cc860-132">If [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) returns RPC\_E\_TIMEOUT, the Begin\_ method is not finished processing.</span></span> <span data-ttu-id="cc860-133">Il client può continuare con altre attività e chiamare di nuovo **Attendi** in un secondo momento.</span><span class="sxs-lookup"><span data-stu-id="cc860-133">The client can continue with other work and call **Wait** again later.</span></span> <span data-ttu-id="cc860-134">Non può chiamare il \_ Metodo Finish finché **wait** restituisce S \_ OK.</span><span class="sxs-lookup"><span data-stu-id="cc860-134">It cannot call the Finish\_ method until **Wait** returns S\_OK.</span></span>

    <span data-ttu-id="cc860-135">Se [**wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) restituisce S \_ OK, \_ viene restituito il metodo Begin.</span><span class="sxs-lookup"><span data-stu-id="cc860-135">If [**Wait**](/windows/win32/api/objidlbase/nf-objidlbase-isynchronize-wait) returns S\_OK, the Begin\_ method has returned.</span></span> <span data-ttu-id="cc860-136">Chiamare il metodo Finish appropriato \_ .</span><span class="sxs-lookup"><span data-stu-id="cc860-136">Call the appropriate Finish\_ method.</span></span>

<span data-ttu-id="cc860-137">Il \_ Metodo Finish passa al client tutti i parametri out.</span><span class="sxs-lookup"><span data-stu-id="cc860-137">The Finish\_ method passes the client any out parameters.</span></span> <span data-ttu-id="cc860-138">Il comportamento dei metodi asincroni, incluso il valore restituito del \_ Metodo Finish, deve corrispondere esattamente a quello del metodo sincrono corrispondente.</span><span class="sxs-lookup"><span data-stu-id="cc860-138">The behavior of the asynchronous methods, including the return value of the Finish\_ method, should match exactly that of the corresponding synchronous method.</span></span>

<span data-ttu-id="cc860-139">Il client può rilasciare l'oggetto chiamata non appena il metodo Finish \_ restituisce oppure un puntatore all'oggetto call per effettuare chiamate aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="cc860-139">The client can release the call object as soon as the Finish\_ method returns, or it can hold a pointer to the call object to make additional calls.</span></span> <span data-ttu-id="cc860-140">In entrambi i casi, il client è responsabile del rilascio dell'oggetto chiamata quando l'oggetto non è più necessario.</span><span class="sxs-lookup"><span data-stu-id="cc860-140">In either case, the client is responsible for releasing the call object when the object is no longer needed.</span></span>

<span data-ttu-id="cc860-141">Se si chiama un \_ Metodo Finish quando non è in corso alcuna chiamata, il metodo restituirà la \_ chiamata RPC E \_ \_ complete.</span><span class="sxs-lookup"><span data-stu-id="cc860-141">If you call a Finish\_ method when no call is in progress, the method will return RPC\_E\_CALL\_COMPLETE.</span></span>

> [!Note]  
> <span data-ttu-id="cc860-142">Se gli oggetti client e server si trovano nello stesso Apartment, non è garantito che le chiamate a [**ICallFactory:: CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) abbiano esito positivo.</span><span class="sxs-lookup"><span data-stu-id="cc860-142">If the client and server objects are in the same apartment, calls to [**ICallFactory::CreateCall**](/windows/win32/api/objidlbase/nf-objidlbase-icallfactory-createcall) are not guaranteed to succeed.</span></span> <span data-ttu-id="cc860-143">Se l'oggetto server non supporta la chiamata asincrona su una particolare interfaccia, il tentativo di creare un oggetto chiamata avrà esito negativo e il client deve utilizzare l'interfaccia sincrona.</span><span class="sxs-lookup"><span data-stu-id="cc860-143">If the server object does not support asynchronous calling on a particular interface, the attempt to create a call object will fail and the client must use the synchronous interface.</span></span>

 

## <a name="related-topics"></a><span data-ttu-id="cc860-144">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="cc860-144">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="cc860-145">Annullamento di una chiamata asincrona</span><span class="sxs-lookup"><span data-stu-id="cc860-145">Canceling an Asynchronous Call</span></span>](canceling-an-asynchronous-call.md)
</dt> <dt>

[<span data-ttu-id="cc860-146">Sicurezza del client durante una chiamata asincrona</span><span class="sxs-lookup"><span data-stu-id="cc860-146">Client Security During an Asynchronous Call</span></span>](client-security-during-an-asynchronous-call.md)
</dt> <dt>

[<span data-ttu-id="cc860-147">Rappresentazione e chiamate asincrone</span><span class="sxs-lookup"><span data-stu-id="cc860-147">Impersonation and Asynchronous Calls</span></span>](impersonation-and-asynchronous-calls.md)
</dt> </dl>

 

 