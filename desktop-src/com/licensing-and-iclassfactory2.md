---
title: Licenze e IClassFactory2
description: Licenze e IClassFactory2
ms.assetid: 2bead555-8c62-4f48-a4c6-6f0942ec75f8
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 9376d5187588ba14da434161309409bf1d189a8f
ms.sourcegitcommit: 5f33645661bf8c825a7a2e73950b1f4ea0f1cd82
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/21/2020
ms.locfileid: "104399778"
---
# <a name="licensing-and-iclassfactory2"></a><span data-ttu-id="a93eb-103">Licenze e IClassFactory2</span><span class="sxs-lookup"><span data-stu-id="a93eb-103">Licensing and IClassFactory2</span></span>

<span data-ttu-id="a93eb-104">L'interfaccia [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) su un oggetto classe fornisce il meccanismo di creazione di oggetti di base di com.</span><span class="sxs-lookup"><span data-stu-id="a93eb-104">The [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) interface on a class object provides the basic object creation mechanism of COM.</span></span> <span data-ttu-id="a93eb-105">Utilizzando **IClassFactory**, un server può controllare la creazione di oggetti in base a un computer.</span><span class="sxs-lookup"><span data-stu-id="a93eb-105">Using **IClassFactory**, a server can control object creation on a machine basis.</span></span> <span data-ttu-id="a93eb-106">L'implementazione del metodo [**IClassFactory:: CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) può consentire o impedire la creazione di oggetti in base all'esistenza di una licenza computer.</span><span class="sxs-lookup"><span data-stu-id="a93eb-106">The implementation of the [**IClassFactory::CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) method can allow or disallow object creation based on the existence of a machine license.</span></span> <span data-ttu-id="a93eb-107">Una licenza per computer è una parte di informazioni separate dall'applicazione presente in un computer per indicare che il software è stato installato da un'origine valida, ad esempio i dischi di installazione del fornitore.</span><span class="sxs-lookup"><span data-stu-id="a93eb-107">A machine license is a piece of information separate from the application that exists on a machine to indicate that the software was installed from a valid source, such as the vendor's installation disks.</span></span> <span data-ttu-id="a93eb-108">Se la licenza del computer non esiste, il server può impedire la creazione di oggetti.</span><span class="sxs-lookup"><span data-stu-id="a93eb-108">If the machine license does not exist, the server can disallow object creation.</span></span> <span data-ttu-id="a93eb-109">Il servizio licenze Machine impedisce la pirateria nei casi in cui un utente tenta di copiare il software da un computer a un altro, perché le informazioni sulle licenze non vengono copiate con il software e il computer che riceve la copia non è concesso in licenza.</span><span class="sxs-lookup"><span data-stu-id="a93eb-109">Machine licensing prevents piracy in cases where a user attempts to copy the software from one machine to another, because the license information is not copied with the software and the machine that receives the copy is not licensed.</span></span>

<span data-ttu-id="a93eb-110">Tuttavia, in un settore software componente, i fornitori necessitano di un livello di controllo più preciso sulle licenze.</span><span class="sxs-lookup"><span data-stu-id="a93eb-110">However, in a component software industry, vendors need a finer level of control over licensing.</span></span> <span data-ttu-id="a93eb-111">Oltre al controllo delle licenze del computer, un fornitore deve consentire ad alcuni client di creare un oggetto componente negando agli altri client la stessa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="a93eb-111">In addition to machine license control, a vendor needs to allow some clients to create a component object while denying other clients the same capability.</span></span> <span data-ttu-id="a93eb-112">Questa operazione richiede che l'applicazione client ottenga un codice di licenza dal componente mentre l'applicazione client è ancora in fase di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="a93eb-112">This requires that the client application obtain a license key from the component while the client application is still under development.</span></span> <span data-ttu-id="a93eb-113">L'applicazione client usa il codice di licenza in fase di esecuzione per creare oggetti in una macchina senza licenza.</span><span class="sxs-lookup"><span data-stu-id="a93eb-113">The client application uses the license key at run time to create objects on an unlicensed machine.</span></span>

<span data-ttu-id="a93eb-114">Se, ad esempio, un fornitore fornisce una libreria di controlli per gli sviluppatori, lo sviluppatore che acquista la libreria disporrà di una licenza di computer completa, consentendo la creazione degli oggetti nel computer di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="a93eb-114">For example, if a vendor provides a library of controls to developers, the developer who purchases the library will have a full machine license, allowing the objects to be created on the development machine.</span></span> <span data-ttu-id="a93eb-115">Lo sviluppatore può quindi compilare un'applicazione client nel computer con licenza che include uno o più controlli.</span><span class="sxs-lookup"><span data-stu-id="a93eb-115">The developer can then build a client application on the licensed machine incorporating one or more of the controls.</span></span> <span data-ttu-id="a93eb-116">Quando l'applicazione client risultante viene eseguita in un altro computer, i controlli utilizzati nell'applicazione client devono essere creati nell'altro computer anche se tale computer non dispone di una licenza computer per i controlli del fornitore originale.</span><span class="sxs-lookup"><span data-stu-id="a93eb-116">When the resulting client application is run on another machine, the controls used in the client application must be created on the other machine even if that machine does not possess a machine license for the controls from the original vendor.</span></span>

<span data-ttu-id="a93eb-117">L'interfaccia [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2) fornisce questo livello di controllo.</span><span class="sxs-lookup"><span data-stu-id="a93eb-117">The [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2) interface provides this level of control.</span></span> <span data-ttu-id="a93eb-118">Per consentire la gestione delle licenze basate su chiavi per un determinato componente, implementare **IClassFactory2** nell'oggetto class factory per quel componente.</span><span class="sxs-lookup"><span data-stu-id="a93eb-118">To allow key-based licensing for any given component, you implement **IClassFactory2** on the class factory object for that component.</span></span> <span data-ttu-id="a93eb-119">**IClassFactory2** deriva da [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory), quindi implementando **IClassFactory2**, l'oggetto class factory soddisfa i requisiti com di base.</span><span class="sxs-lookup"><span data-stu-id="a93eb-119">**IClassFactory2** is derived from [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory), so by implementing **IClassFactory2**, the class factory object fulfills the basic COM requirements.</span></span>

<span data-ttu-id="a93eb-120">Per incorporare un componente concesso in licenza nell'applicazione client, usare i metodi seguenti in [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2):</span><span class="sxs-lookup"><span data-stu-id="a93eb-120">To incorporate a licensed component into your client application, use the following methods in [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2):</span></span>

-   <span data-ttu-id="a93eb-121">Il metodo [**GetLicInfo**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-getlicinfo) riempie una struttura [**LICINFO**](/windows/win32/api/ocidl/ns-ocidl-licinfo) con informazioni che descrivono il comportamento di gestione delle licenze del class factory.</span><span class="sxs-lookup"><span data-stu-id="a93eb-121">The [**GetLicInfo**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-getlicinfo) method fills a [**LICINFO**](/windows/win32/api/ocidl/ns-ocidl-licinfo) structure with information describing the licensing behavior of the class factory.</span></span> <span data-ttu-id="a93eb-122">Ad esempio, il class factory può fornire i codici di licenza per le licenze di run-time se il membro **fRunTimeKeyAvail** è **true**.</span><span class="sxs-lookup"><span data-stu-id="a93eb-122">For example, the class factory can provide license keys for run-time licensing if the **fRunTimeKeyAvail** member is **TRUE**.</span></span>
-   <span data-ttu-id="a93eb-123">Il metodo [**RequestLicKey**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-requestlickey) fornisce un codice di licenza per il componente.</span><span class="sxs-lookup"><span data-stu-id="a93eb-123">The [**RequestLicKey**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-requestlickey) method provides a license key for the component.</span></span> <span data-ttu-id="a93eb-124">Quando il client chiama questo metodo, deve essere disponibile una licenza computer.</span><span class="sxs-lookup"><span data-stu-id="a93eb-124">A machine license must be available when the client calls this method.</span></span>
-   <span data-ttu-id="a93eb-125">Il metodo [**CreateInstanceLic**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-createinstancelic) crea un'istanza del componente concesso in licenza se il parametro della chiave di licenza (BSTRÂ bstrKey) è valido.</span><span class="sxs-lookup"><span data-stu-id="a93eb-125">The [**CreateInstanceLic**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-createinstancelic) method creates an instance of the licensed component if the license key parameter (BSTRÂ bstrKey) is valid.</span></span>

> [!Note]  
> <span data-ttu-id="a93eb-126">Nelle informazioni sul tipo, un componente usa l'attributo concesso in licenza per contrassegnare la coclasse che supporta la gestione delle licenze tramite [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2).</span><span class="sxs-lookup"><span data-stu-id="a93eb-126">In its type information, a component uses the attribute licensed to mark the coclass that supports licensing through [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2).</span></span>

 

<span data-ttu-id="a93eb-127">Per prima cosa, è necessario uno strumento di sviluppo separato che sia anche un client del componente concesso in licenza.</span><span class="sxs-lookup"><span data-stu-id="a93eb-127">First, you need a separate development tool that is also a client of the licensed component.</span></span> <span data-ttu-id="a93eb-128">Lo scopo di questo strumento è ottenere il codice di licenza della fase di esecuzione e salvarlo nell'applicazione client.</span><span class="sxs-lookup"><span data-stu-id="a93eb-128">The purpose of this tool is to obtain the run-time license key and save it in your client application.</span></span> <span data-ttu-id="a93eb-129">Questo strumento viene eseguito solo in un computer che dispone di una licenza computer per il componente.</span><span class="sxs-lookup"><span data-stu-id="a93eb-129">This tool runs only on a machine that possesses a machine license for the component.</span></span> <span data-ttu-id="a93eb-130">Lo strumento chiama i metodi [**GetLicInfo**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-getlicinfo) e [**RequestLicKey**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-requestlickey) per ottenere il codice di licenza della fase di esecuzione e quindi Salva la chiave di licenza nell'applicazione client.</span><span class="sxs-lookup"><span data-stu-id="a93eb-130">The tool calls the [**GetLicInfo**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-getlicinfo) and [**RequestLicKey**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-requestlickey) methods to obtain the run-time license key and then saves the license key in your client application.</span></span> <span data-ttu-id="a93eb-131">Lo strumento di sviluppo, ad esempio, può creare un file di intestazione (con estensione h) contenente il codice di licenza BSTR e quindi includere il file con estensione h nell'applicazione client.</span><span class="sxs-lookup"><span data-stu-id="a93eb-131">For example, the development tool could create a header (.h) file containing the BSTR license key, and then you would include that .h file in your client application.</span></span>

<span data-ttu-id="a93eb-132">Per creare un'istanza del componente all'interno dell'applicazione client, provare innanzitutto a creare un'istanza dell'oggetto direttamente con [**IClassFactory:: CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance).</span><span class="sxs-lookup"><span data-stu-id="a93eb-132">To instantiate the component within your client application, first try to instantiate the object directly with [**IClassFactory::CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance).</span></span> <span data-ttu-id="a93eb-133">Se **CreateInstance** riesce, il secondo computer viene concesso in licenza per il componente e gli oggetti possono essere creati in.</span><span class="sxs-lookup"><span data-stu-id="a93eb-133">If **CreateInstance** succeeds, the second machine is licensed for the component and objects can be created at will.</span></span> <span data-ttu-id="a93eb-134">Se **CreateInstance** ha esito negativo con la classe di codice restituito \_ E \_ NOTLICENSED, l'unico modo per creare l'oggetto è passare la chiave della fase di esecuzione al metodo [**CreateInstanceLic**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-createinstancelic) .</span><span class="sxs-lookup"><span data-stu-id="a93eb-134">If **CreateInstance** fails with the return code CLASS\_E\_NOTLICENSED, the only way to create the object is to pass the run-time key to the [**CreateInstanceLic**](/windows/desktop/api/OCIdl/nf-ocidl-iclassfactory2-createinstancelic) method.</span></span> <span data-ttu-id="a93eb-135">**CreateInstanceLic** verifica la chiave e crea l'oggetto se la chiave è valida.</span><span class="sxs-lookup"><span data-stu-id="a93eb-135">**CreateInstanceLic** verifies the key and creates the object if the key is valid.</span></span>

<span data-ttu-id="a93eb-136">In questo modo, un'applicazione compilata con componenti, ad esempio i controlli, può essere eseguita in un computer che non dispone di altre licenze. solo l'applicazione client che contiene la licenza di runtime è autorizzata a creare gli oggetti componente in questione.</span><span class="sxs-lookup"><span data-stu-id="a93eb-136">In this way, an application built with components (such as controls) can run on a machine that has no other license—only the client application containing the run-time license is allowed to create the component objects in question.</span></span>

<span data-ttu-id="a93eb-137">L'interfaccia [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2) supporta la flessibilità negli schemi di gestione delle licenze.</span><span class="sxs-lookup"><span data-stu-id="a93eb-137">The [**IClassFactory2**](/windows/desktop/api/OCIdl/nn-ocidl-iclassfactory2) interface supports flexibility in licensing schemes.</span></span> <span data-ttu-id="a93eb-138">L'implementatore del server può ad esempio crittografare le chiavi di licenza nel componente per una maggiore sicurezza.</span><span class="sxs-lookup"><span data-stu-id="a93eb-138">For example, the server implementor can encrypt license keys in the component for added security.</span></span> <span data-ttu-id="a93eb-139">Gli implementatori di server possono anche abilitare o disabilitare i livelli di funzionalità nei rispettivi oggetti fornendo codici di licenza diversi per le diverse funzioni.</span><span class="sxs-lookup"><span data-stu-id="a93eb-139">Server implementers can also enable or disable levels of functionality in their objects by providing different license keys for different functions.</span></span> <span data-ttu-id="a93eb-140">Ad esempio, una chiave potrebbe consentire un livello di base di funzionalità, mentre un'altra consente funzionalità di base e avanzate e così via.</span><span class="sxs-lookup"><span data-stu-id="a93eb-140">For example, one key might allow a base level of functionality while another allows basic and advanced functionality, and so on.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a93eb-141">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="a93eb-141">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a93eb-142">Responsabilità server COM</span><span class="sxs-lookup"><span data-stu-id="a93eb-142">COM Server Responsibilities</span></span>](com-server-responsibilities.md)
</dt> </dl>

 

 