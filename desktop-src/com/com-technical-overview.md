---
title: Panoramica tecnica di COM
ms.assetid: 519c87cc-b442-4187-af2a-124a1e4e8b49
description: 'Ulteriori informazioni su: Panoramica tecnica di COM'
keywords:
- COM Panoramica tecnica com
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: be5dc95ffae5166d86cd8110cab1a6b90e6ffa5c
ms.sourcegitcommit: c7add10d695482e1ceb72d62b8a4ebd84ea050f7
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "104126606"
---
# <a name="com-technical-overview"></a><span data-ttu-id="8bd65-104">Panoramica tecnica di COM</span><span class="sxs-lookup"><span data-stu-id="8bd65-104">COM Technical Overview</span></span>

<span data-ttu-id="8bd65-105">In questo argomento viene fornita una panoramica di Microsoft Component Object Model (COM):</span><span class="sxs-lookup"><span data-stu-id="8bd65-105">This topic provides an overview of the Microsoft Component Object Model (COM):</span></span>

-   [<span data-ttu-id="8bd65-106">Introduzione a COM</span><span class="sxs-lookup"><span data-stu-id="8bd65-106">Introduction to COM</span></span>](#introduction-to-com)
-   [<span data-ttu-id="8bd65-107">Oggetti e interfacce</span><span class="sxs-lookup"><span data-stu-id="8bd65-107">Objects and Interfaces</span></span>](#objects-and-interfaces)
-   [<span data-ttu-id="8bd65-108">Implementazione dell'interfaccia</span><span class="sxs-lookup"><span data-stu-id="8bd65-108">Interface implementation</span></span>](#interface-implementation)
-   [<span data-ttu-id="8bd65-109">Interfaccia IUnknown</span><span class="sxs-lookup"><span data-stu-id="8bd65-109">The IUnknown Interface</span></span>](#the-iunknown-interface)
-   [<span data-ttu-id="8bd65-110">Modello client/server</span><span class="sxs-lookup"><span data-stu-id="8bd65-110">The Client/Server Model</span></span>](#the-clientserver-model)
-   [<span data-ttu-id="8bd65-111">Gestione controllo servizi</span><span class="sxs-lookup"><span data-stu-id="8bd65-111">Service Control Manager</span></span>](#service-control-manager)
-   [<span data-ttu-id="8bd65-112">Riusabilità</span><span class="sxs-lookup"><span data-stu-id="8bd65-112">Reusability</span></span>](#reusability)
-   [<span data-ttu-id="8bd65-113">Oggetti di archiviazione e di flusso</span><span class="sxs-lookup"><span data-stu-id="8bd65-113">Storage and Stream Objects</span></span>](#storage-and-stream-objects)
-   [<span data-ttu-id="8bd65-114">Trasferimento dati</span><span class="sxs-lookup"><span data-stu-id="8bd65-114">Data Transfer</span></span>](#data-transfer)
-   [<span data-ttu-id="8bd65-115">Comunicazione remota</span><span class="sxs-lookup"><span data-stu-id="8bd65-115">Remoting</span></span>](#remoting)
-   [<span data-ttu-id="8bd65-116">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="8bd65-116">Security</span></span>](#security)
-   [<span data-ttu-id="8bd65-117">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="8bd65-117">Related topics</span></span>](#related-topics)

## <a name="introduction-to-com"></a><span data-ttu-id="8bd65-118">Introduzione a COM</span><span class="sxs-lookup"><span data-stu-id="8bd65-118">Introduction to COM</span></span>

<span data-ttu-id="8bd65-119">Microsoft Component Object Model (COM) definisce uno standard di interoperabilità binaria per la creazione di librerie software riutilizzabili che interagiscono in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-119">The Microsoft Component Object Model (COM) defines a binary interoperability standard for creating reusable software libraries that interact at run time.</span></span> <span data-ttu-id="8bd65-120">È possibile usare le librerie COM senza la necessità di compilarle nell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-120">You can use COM libraries without the requirement of compiling them into your application.</span></span> <span data-ttu-id="8bd65-121">COM è la base per diversi prodotti e tecnologie Microsoft, ad esempio Windows Media Player e Windows Server.</span><span class="sxs-lookup"><span data-stu-id="8bd65-121">COM is the foundation for a number of Microsoft products and technologies, such as Windows Media Player and Windows Server.</span></span>

<span data-ttu-id="8bd65-122">COM definisce uno standard binario applicabile a molti sistemi operativi e piattaforme hardware.</span><span class="sxs-lookup"><span data-stu-id="8bd65-122">COM defines a binary standard that applies to many operating systems and hardware platforms.</span></span> <span data-ttu-id="8bd65-123">Per l'elaborazione di rete, COM definisce un formato wire standard e un protocollo per l'interazione tra gli oggetti eseguiti su piattaforme hardware diverse.</span><span class="sxs-lookup"><span data-stu-id="8bd65-123">For network computing, COM defines a standard wire format and protocol for interaction among objects that run on different hardware platforms.</span></span> <span data-ttu-id="8bd65-124">COM è indipendente dal linguaggio di implementazione, il che significa che è possibile creare librerie COM usando linguaggi di programmazione diversi, ad esempio C++ e quelli nella .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="8bd65-124">COM is independent of implementation language, which means that you can create COM libraries by using different programming languages, such as C++ and those in the .NET Framework.</span></span>

<span data-ttu-id="8bd65-125">La specifica COM fornisce tutti i concetti fondamentali che consentono il riutilizzo del software multipiattaforma:</span><span class="sxs-lookup"><span data-stu-id="8bd65-125">The COM specification provides all of the fundamental concepts that enable cross-platform software reuse:</span></span>

-   <span data-ttu-id="8bd65-126">Standard binario per le chiamate di funzione tra i componenti.</span><span class="sxs-lookup"><span data-stu-id="8bd65-126">A binary standard for function calls between components.</span></span>
-   <span data-ttu-id="8bd65-127">Un provisioning per raggruppamenti fortemente tipizzati di funzioni nelle interfacce.</span><span class="sxs-lookup"><span data-stu-id="8bd65-127">A provision for strongly-typed groupings of functions into interfaces.</span></span>
-   <span data-ttu-id="8bd65-128">Interfaccia di base che fornisce polimorfismo, individuazione delle funzionalità e rilevamento della durata degli oggetti.</span><span class="sxs-lookup"><span data-stu-id="8bd65-128">A base interface that provides polymorphism, feature discovery, and object lifetime tracking.</span></span>
-   <span data-ttu-id="8bd65-129">Meccanismo che identifica in modo univoco i componenti e le relative interfacce.</span><span class="sxs-lookup"><span data-stu-id="8bd65-129">A mechanism that uniquely identifies components and their interfaces.</span></span>
-   <span data-ttu-id="8bd65-130">Caricatore di componenti che crea istanze del componente da una distribuzione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-130">A component loader that creates component instances from a deployment.</span></span>

<span data-ttu-id="8bd65-131">COM dispone di diverse parti che interagiscono per consentire la creazione di applicazioni compilate da componenti riutilizzabili:</span><span class="sxs-lookup"><span data-stu-id="8bd65-131">COM has a number of parts that work together to enable the creation of applications that are built from reusable components:</span></span>

-   <span data-ttu-id="8bd65-132">*Sistema host* che fornisce un ambiente di runtime conforme alla specifica com.</span><span class="sxs-lookup"><span data-stu-id="8bd65-132">A *host system* that provides a run-time environment that conforms to the COM specification.</span></span>
-   <span data-ttu-id="8bd65-133">*Interfacce* che definiscono i contratti di funzionalità e i *componenti* che implementano le interfacce.</span><span class="sxs-lookup"><span data-stu-id="8bd65-133">*Interfaces* that define feature contracts, and *components* that implement interfaces.</span></span>
-   <span data-ttu-id="8bd65-134">*Server* che forniscono componenti al sistema e *client* che utilizzano le funzionalità fornite dai componenti di.</span><span class="sxs-lookup"><span data-stu-id="8bd65-134">*Servers* that provide components to the system, and *clients* that use the features provided by components.</span></span>
-   <span data-ttu-id="8bd65-135">*Registro di sistema* che tiene traccia dei componenti distribuiti in host locali e remoti.</span><span class="sxs-lookup"><span data-stu-id="8bd65-135">A *registry* that tracks where components are deployed on local and remote hosts.</span></span>
-   <span data-ttu-id="8bd65-136">*Gestore di controllo del servizio* che individua i componenti in host locali e remoti e connette i server ai client.</span><span class="sxs-lookup"><span data-stu-id="8bd65-136">A *Service Control Manager* that locates components on local and remote hosts and connects servers to clients.</span></span>
-   <span data-ttu-id="8bd65-137">Protocollo di *archiviazione strutturato* che definisce la modalità di esplorazione del contenuto dei file nel file System dell'host.</span><span class="sxs-lookup"><span data-stu-id="8bd65-137">A *structured storage* protocol that defines how to navigate the contents of files on the host's file system.</span></span>

<span data-ttu-id="8bd65-138">L'abilitazione del riutilizzo del codice tra gli host e le piattaforme è fondamentale per COM.</span><span class="sxs-lookup"><span data-stu-id="8bd65-138">Enabling code re-use across hosts and platforms is central to COM.</span></span> <span data-ttu-id="8bd65-139">Un'implementazione di interfaccia riutilizzabile è denominata *componente*, *oggetto componente* o *oggetto com*.</span><span class="sxs-lookup"><span data-stu-id="8bd65-139">A reusable interface implementation is named a *component*, a *component object*, or a *COM object*.</span></span> <span data-ttu-id="8bd65-140">Un componente implementa una o più interfacce COM.</span><span class="sxs-lookup"><span data-stu-id="8bd65-140">A component implements one or more COM interfaces.</span></span>

<span data-ttu-id="8bd65-141">Per definire una libreria COM personalizzata, è necessario progettare le interfacce implementate dalla libreria.</span><span class="sxs-lookup"><span data-stu-id="8bd65-141">You define a custom COM library by designing the interfaces that your library implements.</span></span> <span data-ttu-id="8bd65-142">Gli utenti della libreria possono individuare e usare le proprie funzionalità senza alcuna conoscenza della distribuzione e dei dettagli di implementazione della libreria.</span><span class="sxs-lookup"><span data-stu-id="8bd65-142">Consumers of your library can discover and use its features without any knowledge of your library's deployment and implementation details.</span></span>

## <a name="objects-and-interfaces"></a><span data-ttu-id="8bd65-143">Oggetti e interfacce</span><span class="sxs-lookup"><span data-stu-id="8bd65-143">Objects and Interfaces</span></span>

<span data-ttu-id="8bd65-144">Un oggetto COM espone le proprie funzionalità tramite un' *interfaccia*, ovvero una raccolta di funzioni membro.</span><span class="sxs-lookup"><span data-stu-id="8bd65-144">A COM object exposes its features through an *interface*, which is a collection of member functions.</span></span> <span data-ttu-id="8bd65-145">Un'interfaccia COM definisce il comportamento previsto e le responsabilità di un componente e specifica un contratto fortemente tipizzato che fornisce un piccolo set di operazioni correlate.</span><span class="sxs-lookup"><span data-stu-id="8bd65-145">A COM interface defines the expected behavior and responsibilities of a component, and it specifies a strongly-typed contract that provides a small set of related operations.</span></span> <span data-ttu-id="8bd65-146">Tutte le comunicazioni tra i componenti COM avvengono tramite le interfacce e tutti i servizi offerti da un componente vengono esposti tramite la relativa interfaccia.</span><span class="sxs-lookup"><span data-stu-id="8bd65-146">All communication among COM components occurs through interfaces, and all services offered by a component are exposed through its interface.</span></span> <span data-ttu-id="8bd65-147">Un chiamante può accedere solo alle funzioni membro di interfaccia.</span><span class="sxs-lookup"><span data-stu-id="8bd65-147">A caller can access only the interface member functions.</span></span> <span data-ttu-id="8bd65-148">Lo stato interno non è disponibile per un chiamante a meno che non sia esposto nell'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="8bd65-148">Internal state is unavailable to a caller unless it is exposed in the interface.</span></span>

<span data-ttu-id="8bd65-149">Le interfacce sono fortemente tipizzate.</span><span class="sxs-lookup"><span data-stu-id="8bd65-149">Interfaces are strongly typed.</span></span> <span data-ttu-id="8bd65-150">Ogni interfaccia ha un identificatore di interfaccia univoco, denominato IID, che elimina le collisioni che possono verificarsi con nomi leggibili.</span><span class="sxs-lookup"><span data-stu-id="8bd65-150">Every interface has its own unique interface identifier, named an IID, which eliminates collisions that could occur with human-readable names.</span></span> <span data-ttu-id="8bd65-151">L'IID è un identificatore univoco globale (GUID), che corrisponde all'ID univoco universale (UUID) definito da Open Software Foundation (OSF) Distributed Computing Environment (DCE).</span><span class="sxs-lookup"><span data-stu-id="8bd65-151">The IID is a globally unique identifier (GUID), which is the same as the Universally Unique ID (UUID) defined by the Open Software Foundation (OSF) Distributed Computing Environment (DCE).</span></span> <span data-ttu-id="8bd65-152">Quando si crea una nuova interfaccia, è necessario creare un nuovo identificatore per tale interfaccia.</span><span class="sxs-lookup"><span data-stu-id="8bd65-152">When you create a new interface, you must create a new identifier for that interface.</span></span> <span data-ttu-id="8bd65-153">Quando un chiamante usa un'interfaccia, deve usare l'identificatore univoco.</span><span class="sxs-lookup"><span data-stu-id="8bd65-153">When a caller uses an interface, it must use the unique identifier.</span></span> <span data-ttu-id="8bd65-154">Questa identificazione esplicita migliora l'affidabilità eliminando i conflitti di denominazione che comportano un errore in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-154">This explicit identification improves robustness by eliminating naming conflicts that would result in run-time failure.</span></span>

<span data-ttu-id="8bd65-155">Quando si definisce una nuova interfaccia, è possibile creare una definizione di interfaccia usando il linguaggio di definizione dell'interfaccia (IDL).</span><span class="sxs-lookup"><span data-stu-id="8bd65-155">When you define a new interface, you can create an interface definition by using the interface definition language (IDL).</span></span> <span data-ttu-id="8bd65-156">Da questa definizione di interfaccia, il compilatore Microsoft IDL genera file di intestazione per l'uso da parte delle applicazioni che usano l'interfaccia e il codice sorgente per gestire le chiamate di procedura remota.</span><span class="sxs-lookup"><span data-stu-id="8bd65-156">From this interface definition, the Microsoft IDL compiler generates header files for use by applications using the interface, and source code to handle remote procedure calls.</span></span> <span data-ttu-id="8bd65-157">L'IDL fornito da Microsoft si basa su semplici estensioni di DCE IDL, uno standard di settore per il calcolo distribuito basato su RPC (Remote Procedure Call).</span><span class="sxs-lookup"><span data-stu-id="8bd65-157">The IDL supplied by Microsoft is based on simple extensions to DCE IDL, an industry standard for Remote Procedure Call (RPC)-based distributed computing.</span></span> <span data-ttu-id="8bd65-158">IDL è uno strumento per la praticità di progettazione interfacce e non è fondamentale per l'interoperabilità COM.</span><span class="sxs-lookup"><span data-stu-id="8bd65-158">IDL is a tool for the convenience of the interface designer and is not central to COM interoperability.</span></span> <span data-ttu-id="8bd65-159">Con IDL non è necessario creare manualmente i file di intestazione per ogni ambiente di programmazione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-159">With IDL, you do not need to create header files manually for each programming environment.</span></span> <span data-ttu-id="8bd65-160">Per ulteriori informazioni, vedere [definizione di interfacce com](defining-com-interfaces.md).</span><span class="sxs-lookup"><span data-stu-id="8bd65-160">For more information, see [Defining COM Interfaces](defining-com-interfaces.md).</span></span>

<span data-ttu-id="8bd65-161">L'ereditarietà viene utilizzata sporadicamente nelle interfacce COM.</span><span class="sxs-lookup"><span data-stu-id="8bd65-161">Inheritance is used sparingly in COM interfaces.</span></span> <span data-ttu-id="8bd65-162">COM supporta solo l'ereditarietà dell'interfaccia per riutilizzare un contratto associato a un'interfaccia di base.</span><span class="sxs-lookup"><span data-stu-id="8bd65-162">COM supports interface inheritance only to reuse a contract associated with a base interface.</span></span> <span data-ttu-id="8bd65-163">COM non supporta l'ereditarietà selettiva; di conseguenza, se un'interfaccia eredita da un'altra, include tutte le funzioni definite dall'interfaccia di base.</span><span class="sxs-lookup"><span data-stu-id="8bd65-163">COM does not support selective inheritance; therefore, if one interface inherits from another, it includes all of the functions that the base interface defines.</span></span> <span data-ttu-id="8bd65-164">Inoltre, le interfacce utilizzano solo ereditarietà singola, anziché ereditarietà multipla, per ottenere funzioni da un'interfaccia di base.</span><span class="sxs-lookup"><span data-stu-id="8bd65-164">In addition, interfaces use only single inheritance, instead of multiple inheritance, to obtain functions from a base interface.</span></span>

## <a name="interface-implementation"></a><span data-ttu-id="8bd65-165">Implementazione dell'interfaccia</span><span class="sxs-lookup"><span data-stu-id="8bd65-165">Interface implementation</span></span>

<span data-ttu-id="8bd65-166">Non è possibile creare un'istanza di un'interfaccia COM autonomamente.</span><span class="sxs-lookup"><span data-stu-id="8bd65-166">You cannot create an instance of a COM interface by itself.</span></span> <span data-ttu-id="8bd65-167">Al contrario, si crea un'istanza di una classe che implementa l'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="8bd65-167">Instead, you create an instance of a class that implements the interface.</span></span> <span data-ttu-id="8bd65-168">In C++, un'interfaccia COM viene modellata come una *classe base astratta*, il che significa che l'interfaccia è una classe C++ che contiene solo funzioni membro virtuali pure.</span><span class="sxs-lookup"><span data-stu-id="8bd65-168">In C++, a COM interface is modeled as an *abstract base class*, which means that the interface is a C++ class that contains only pure virtual member functions.</span></span> <span data-ttu-id="8bd65-169">Una libreria C++ implementa oggetti COM ereditando le firme della funzione membro da una o più interfacce, eseguendo l'override di ogni funzione membro e fornendo un'implementazione per ogni funzione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-169">A C++ library implements COM objects by inheriting the member function signatures from one or more interfaces, overriding each member function, and providing an implementation for each function.</span></span>

<span data-ttu-id="8bd65-170">È possibile utilizzare qualsiasi linguaggio di programmazione che supporti il concetto di puntatori a funzione per implementare un'interfaccia COM.</span><span class="sxs-lookup"><span data-stu-id="8bd65-170">You can use any programming language that supports the concept of function pointers to implement a COM interface.</span></span> <span data-ttu-id="8bd65-171">In C, ad esempio, un'interfaccia è una struttura che contiene un puntatore a una tabella di puntatori a funzione, uno per ogni metodo nell'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="8bd65-171">For example, in C, an interface is a structure containing a pointer to a table of function pointers, one for each method in the interface.</span></span>

<span data-ttu-id="8bd65-172">Quando si implementa un'interfaccia, la classe deve fornire un'implementazione per ogni funzione nell'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="8bd65-172">When you implement an interface, your class must provide an implementation for every function in the interface.</span></span> <span data-ttu-id="8bd65-173">Se la classe non ha lavoro da eseguire in una funzione di interfaccia, l'implementazione può essere una singola istruzione return.</span><span class="sxs-lookup"><span data-stu-id="8bd65-173">If the class has no work to do in an interface function, the implementation may be a single return statement.</span></span>

<span data-ttu-id="8bd65-174">Una classe COM viene identificata usando un ID di classe a 128 bit univoco (CLSID) che associa una classe a una particolare distribuzione nel file system, che per Windows è un file DLL o EXE.</span><span class="sxs-lookup"><span data-stu-id="8bd65-174">A COM class is identified by using a unique 128-bit Class ID (CLSID) that associates a class with a particular deployment in the file system, which for Windows is a DLL or EXE.</span></span> <span data-ttu-id="8bd65-175">Un CLSID è un GUID, il che significa che nessun'altra classe ha lo stesso CLSID.</span><span class="sxs-lookup"><span data-stu-id="8bd65-175">A CLSID is a GUID, which means that no other class has the same CLSID.</span></span> <span data-ttu-id="8bd65-176">L'utilizzo di identificatori di classe univoci impedisce conflitti di nomi tra le classi.</span><span class="sxs-lookup"><span data-stu-id="8bd65-176">The use of unique class identifiers prevents name collisions among classes.</span></span> <span data-ttu-id="8bd65-177">Ad esempio, due fornitori diversi possono scrivere una classe denominata CStack, ma entrambe le classi hanno un CLSID univoco, pertanto si evitano eventuali possibili collisioni.</span><span class="sxs-lookup"><span data-stu-id="8bd65-177">For example, two different vendors can write a class named CStack, but both classes have a unique CLSID, so any possibility of a collision is avoided.</span></span>

<span data-ttu-id="8bd65-178">È possibile ottenere un nuovo CLSID usando la funzione [**CoCreateGuid**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateguid) o uno strumento di creazione com, ad esempio Visual Studio, che chiama questa funzione internamente.</span><span class="sxs-lookup"><span data-stu-id="8bd65-178">You obtain a new CLSID by using the [**CoCreateGuid**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateguid) function or by using a COM authoring tool, such as Visual Studio, that calls this function internally.</span></span>

## <a name="the-iunknown-interface"></a><span data-ttu-id="8bd65-179">Interfaccia IUnknown</span><span class="sxs-lookup"><span data-stu-id="8bd65-179">The IUnknown Interface</span></span>

<span data-ttu-id="8bd65-180">Tutte le interfacce COM ereditano dall'interfaccia [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) .</span><span class="sxs-lookup"><span data-stu-id="8bd65-180">All COM interfaces inherit from the [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) interface.</span></span> <span data-ttu-id="8bd65-181">L'interfaccia **IUnknown** contiene le operazioni com fondamentali per il polimorfismo e la gestione della durata dell'istanza.</span><span class="sxs-lookup"><span data-stu-id="8bd65-181">The **IUnknown** interface contains the fundamental COM operations for polymorphism and instance lifetime management.</span></span> <span data-ttu-id="8bd65-182">L'interfaccia **IUnknown** dispone di tre funzioni membro, denominate [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), [**AddRef**](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref)e [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span><span class="sxs-lookup"><span data-stu-id="8bd65-182">The **IUnknown** interface has three member functions, named [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)), [**AddRef**](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref), and [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release).</span></span> <span data-ttu-id="8bd65-183">Tutti gli oggetti COM sono necessari per implementare l'interfaccia **IUnknown** .</span><span class="sxs-lookup"><span data-stu-id="8bd65-183">All COM objects are required to implement the **IUnknown** interface.</span></span>

<span data-ttu-id="8bd65-184">La funzione membro [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) fornisce polimorfismo per com.</span><span class="sxs-lookup"><span data-stu-id="8bd65-184">The [**QueryInterface**](/windows/desktop/api/Unknwn/nf-unknwn-iunknown-queryinterface(q)) member function provides polymorphism for COM.</span></span> <span data-ttu-id="8bd65-185">Chiamare **QueryInterface** per determinare in fase di esecuzione se un oggetto com supporta una particolare interfaccia.</span><span class="sxs-lookup"><span data-stu-id="8bd65-185">Call **QueryInterface** to determine at run time whether a COM object supports a particular interface.</span></span> <span data-ttu-id="8bd65-186">L'oggetto COM restituisce un puntatore a interfaccia nel `ppvObject` parametro se implementa l'interfaccia richiesta; in caso contrario, restituisce `NULL` .</span><span class="sxs-lookup"><span data-stu-id="8bd65-186">The COM object returns an interface pointer in the `ppvObject` parameter if it implements the requested interface, otherwise it returns `NULL`.</span></span> <span data-ttu-id="8bd65-187">La funzione membro **QueryInterface** consente la navigazione tra tutte le interfacce supportate da un oggetto com.</span><span class="sxs-lookup"><span data-stu-id="8bd65-187">The **QueryInterface** member function enables navigation among all of the interfaces that a COM object supports.</span></span>

<span data-ttu-id="8bd65-188">La durata di un'istanza di un oggetto COM è controllata dal *conteggio dei riferimenti*.</span><span class="sxs-lookup"><span data-stu-id="8bd65-188">The lifetime of a COM object instance is controlled by its *reference count*.</span></span> <span data-ttu-id="8bd65-189">Le [](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) funzioni membro IUnknown [**AddRef**](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) e [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) controllano il conteggio.</span><span class="sxs-lookup"><span data-stu-id="8bd65-189">The [**IUnknown**](/windows/desktop/api/Unknwn/nn-unknwn-iunknown) member functions [**AddRef**](/windows/win32/api/unknwn/nf-unknwn-iunknown-addref) and [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) control the count.</span></span> <span data-ttu-id="8bd65-190">**AddRef** incrementa il conteggio e il **rilascio** decrementa il conteggio.</span><span class="sxs-lookup"><span data-stu-id="8bd65-190">**AddRef** increments the count and **Release** decrements the count.</span></span> <span data-ttu-id="8bd65-191">Quando il conteggio dei riferimenti raggiunge zero, la funzione membro di **versione** può liberare l'istanza, perché nessun chiamante lo utilizza.</span><span class="sxs-lookup"><span data-stu-id="8bd65-191">When the reference count reaches zero, the **Release** member function may free the instance, because no callers are using it.</span></span>

## <a name="the-clientserver-model"></a><span data-ttu-id="8bd65-192">Modello client/server</span><span class="sxs-lookup"><span data-stu-id="8bd65-192">The Client/Server Model</span></span>

<span data-ttu-id="8bd65-193">Una classe COM implementa un numero di interfacce COM.</span><span class="sxs-lookup"><span data-stu-id="8bd65-193">A COM class implements a number of COM interfaces.</span></span> <span data-ttu-id="8bd65-194">L'implementazione di è costituita da file binari che vengono eseguiti quando un chiamante interagisce con un'istanza della classe COM.</span><span class="sxs-lookup"><span data-stu-id="8bd65-194">The implementation consists of binaries that run when a caller interacts with an instance of the COM class.</span></span> <span data-ttu-id="8bd65-195">COM consente l'uso di una classe in diverse applicazioni, incluse le applicazioni scritte senza conoscere una classe specifica.</span><span class="sxs-lookup"><span data-stu-id="8bd65-195">COM enables using a class in different applications, including applications written without knowledge of a particular class.</span></span> <span data-ttu-id="8bd65-196">In una piattaforma Windows le classi sono presenti in una libreria a collegamento dinamico (DLL) o in un'altra applicazione (EXE).</span><span class="sxs-lookup"><span data-stu-id="8bd65-196">On a Windows platform, classes exist either in a dynamic-linked library (DLL) or in another application (EXE).</span></span>

<span data-ttu-id="8bd65-197">Nel sistema host, COM gestisce un database di registrazione di tutti i CLSID per gli oggetti COM installati nel sistema.</span><span class="sxs-lookup"><span data-stu-id="8bd65-197">On its host system, COM maintains a registration database of all the CLSIDs for the COM objects installed on the system.</span></span> <span data-ttu-id="8bd65-198">Il database di registrazione è un mapping tra ogni CLSID e il percorso della DLL o del file EXE che ospita la classe corrispondente.</span><span class="sxs-lookup"><span data-stu-id="8bd65-198">The registration database is a mapping between each CLSID and the location of the DLL or EXE that houses the corresponding class.</span></span> <span data-ttu-id="8bd65-199">COM esegue una query sul database ogni volta che un chiamante desidera creare un'istanza di una classe COM.</span><span class="sxs-lookup"><span data-stu-id="8bd65-199">COM queries this database whenever a caller wants to create an instance of a COM class.</span></span> <span data-ttu-id="8bd65-200">È necessario che il chiamante conosca solo il CLSID per richiedere una nuova istanza della classe.</span><span class="sxs-lookup"><span data-stu-id="8bd65-200">The caller needs to know only the CLSID to request a new instance of the class.</span></span>

<span data-ttu-id="8bd65-201">L'interazione tra un oggetto COM e i relativi chiamanti viene modellata come relazione client/server.</span><span class="sxs-lookup"><span data-stu-id="8bd65-201">The interaction between a COM object and its callers is modeled as a client/server relationship.</span></span> <span data-ttu-id="8bd65-202">Il client è il chiamante che richiede un oggetto COM dal sistema e il server è il modulo che ospita gli oggetti COM che forniscono servizi ai client.</span><span class="sxs-lookup"><span data-stu-id="8bd65-202">The client is the caller that requests a COM object from the system, and the server is the module that houses COM objects that provides services to clients.</span></span>

<span data-ttu-id="8bd65-203">Un client COM è qualsiasi chiamante che passa un CLSID al sistema per richiedere un'istanza di un oggetto COM.</span><span class="sxs-lookup"><span data-stu-id="8bd65-203">A COM client is any caller that passes a CLSID to the system to request an instance of a COM object.</span></span> <span data-ttu-id="8bd65-204">Il modo più semplice per creare un'istanza consiste nel chiamare la funzione COM, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance).</span><span class="sxs-lookup"><span data-stu-id="8bd65-204">The simplest way to create an instance is to call the COM function, [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance).</span></span>

<span data-ttu-id="8bd65-205">La funzione [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) crea un'istanza del CLSID specificato e restituisce un puntatore a interfaccia del tipo richiesto dal client.</span><span class="sxs-lookup"><span data-stu-id="8bd65-205">The [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) function creates one instance of the specified CLSID and returns an interface pointer of the type requested by the client.</span></span> <span data-ttu-id="8bd65-206">Il client è responsabile della gestione della durata dell'istanza chiamando la relativa funzione [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) quando il client ha terminato di usarlo.</span><span class="sxs-lookup"><span data-stu-id="8bd65-206">The client is responsible for managing the lifetime of the instance by calling its [**Release**](/windows/win32/api/unknwn/nf-unknwn-iunknown-release) function when the client has finished using it.</span></span> <span data-ttu-id="8bd65-207">Per creare più oggetti basati su un solo CLSID, chiamare la funzione [**CoGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) .</span><span class="sxs-lookup"><span data-stu-id="8bd65-207">To create multiple objects based on a single CLSID, call the [**CoGetClassObject**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetclassobject) function.</span></span> <span data-ttu-id="8bd65-208">Per connettersi a un oggetto già creato e in esecuzione, chiamare la funzione [**GetActiveObject**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-getactiveobject) .</span><span class="sxs-lookup"><span data-stu-id="8bd65-208">To connect to an object that is already created and running, call the [**GetActiveObject**](/previous-versions/windows/desktop/api/oleauto/nf-oleauto-getactiveobject) function.</span></span>

<span data-ttu-id="8bd65-209">Un server COM fornisce un'implementazione COM al sistema.</span><span class="sxs-lookup"><span data-stu-id="8bd65-209">A COM server provides a COM implementation to the system.</span></span> <span data-ttu-id="8bd65-210">Un server associa un CLSID a una classe COM, ospita l'implementazione della classe, implementa un class factory per la creazione di istanze della classe e fornisce per lo scaricamento del server.</span><span class="sxs-lookup"><span data-stu-id="8bd65-210">A server associates a CLSID with a COM class, houses the implementation of the class, implements a class factory for creating instances of the class, and provides for unloading the server.</span></span>

> [!Note]  
> <span data-ttu-id="8bd65-211">Un server COM non è uguale all'oggetto COM che fornisce al sistema.</span><span class="sxs-lookup"><span data-stu-id="8bd65-211">A COM server is not the same as the COM object that it provides to the system.</span></span>

 

<span data-ttu-id="8bd65-212">Per abilitare la creazione di un oggetto COM, un server COM deve fornire un'implementazione dell'interfaccia [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) .</span><span class="sxs-lookup"><span data-stu-id="8bd65-212">To enable creating a COM object, a COM server must provide an implementation of the [**IClassFactory**](/windows/win32/api/unknwn/nn-unknwn-iclassfactory) interface.</span></span> <span data-ttu-id="8bd65-213">I client possono chiamare il metodo [**CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) per richiedere una nuova istanza di un oggetto com, ma in genere tali richieste sono incapsulate nella funzione [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) .</span><span class="sxs-lookup"><span data-stu-id="8bd65-213">Clients can call the [**CreateInstance**](/windows/desktop/api/Unknwn/nf-unknwn-iclassfactory-createinstance) method to request a new instance of a COM object, but usually such requests are encapsulated in the [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) function.</span></span>

<span data-ttu-id="8bd65-214">È possibile distribuire un server COM come libreria condivisa caricata nel processo del client in fase di esecuzione (DLL sulle piattaforme Windows) o come modulo eseguibile (EXE su piattaforme Windows).</span><span class="sxs-lookup"><span data-stu-id="8bd65-214">You can deploy a COM server either as a shared library that is loaded into the client's process at run time (DLL on Windows platforms) or as an executable module (EXE on Windows platforms).</span></span> <span data-ttu-id="8bd65-215">Per ulteriori informazioni, vedere la pagina relativa alla [registrazione di applicazioni com](registering-com-applications.md).</span><span class="sxs-lookup"><span data-stu-id="8bd65-215">For more information, see [Registering COM Applications](registering-com-applications.md).</span></span>

## <a name="service-control-manager"></a><span data-ttu-id="8bd65-216">Gestione controllo servizi</span><span class="sxs-lookup"><span data-stu-id="8bd65-216">Service Control Manager</span></span>

<span data-ttu-id="8bd65-217">Gestione controllo servizi gestisce la richiesta client per un'istanza di un oggetto COM.</span><span class="sxs-lookup"><span data-stu-id="8bd65-217">The Service Control Manager (SCM) handles the client request for an instance of a COM object.</span></span> <span data-ttu-id="8bd65-218">Nell'elenco seguente viene illustrata la sequenza di eventi:</span><span class="sxs-lookup"><span data-stu-id="8bd65-218">The following list shows the sequence of events:</span></span>

-   <span data-ttu-id="8bd65-219">Un client richiede un puntatore a interfaccia a un oggetto COM dalla libreria COM chiamando una funzione come [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) con il CLSID dell'oggetto com.</span><span class="sxs-lookup"><span data-stu-id="8bd65-219">A client requests an interface pointer to a COM object from the COM Library by calling a function such as [**CoCreateInstance**](/windows/desktop/api/combaseapi/nf-combaseapi-cocreateinstance) with the CLSID of the COM object.</span></span>
-   <span data-ttu-id="8bd65-220">La libreria COM esegue una query su SCM per trovare il server corrispondente al CLSID richiesto.</span><span class="sxs-lookup"><span data-stu-id="8bd65-220">The COM Library queries the SCM to find the server that corresponds with the requested CLSID.</span></span>
-   <span data-ttu-id="8bd65-221">Il gestore SCM individua il server e richiede la creazione dell'oggetto COM dalla class factory fornita dal server.</span><span class="sxs-lookup"><span data-stu-id="8bd65-221">The SCM locates the server and requests the creation of the COM object from the class factory that is provided by the server.</span></span>
-   <span data-ttu-id="8bd65-222">In caso di esito positivo, la libreria COM restituisce un puntatore a interfaccia al client.</span><span class="sxs-lookup"><span data-stu-id="8bd65-222">If successful, the COM Library returns an interface pointer to the client.</span></span>

<span data-ttu-id="8bd65-223">Quando il sistema COM connette un oggetto server a un client, il client e l'oggetto comunicano direttamente.</span><span class="sxs-lookup"><span data-stu-id="8bd65-223">After the COM system connects a server object to a client, the client and object communicate directly.</span></span> <span data-ttu-id="8bd65-224">Non è previsto alcun sovraccarico aggiuntivo dalla chiamata tramite un tempo di esecuzione intermedio.</span><span class="sxs-lookup"><span data-stu-id="8bd65-224">There is no added overhead from calling through an intermediary run time.</span></span>

<span data-ttu-id="8bd65-225">Quando si registra un server COM con il sistema host, è possibile specificare diversi modi per attivare il server.</span><span class="sxs-lookup"><span data-stu-id="8bd65-225">When you register a COM server with the host system, you can specify different ways for the server to be activated.</span></span> <span data-ttu-id="8bd65-226">Nell'elenco seguente sono illustrati i tre modi in cui SCM può attivare un server COM:</span><span class="sxs-lookup"><span data-stu-id="8bd65-226">The following list shows the three ways that the SCM can activate a COM server:</span></span>

-   <span data-ttu-id="8bd65-227">In-process: SCM restituisce il percorso del file DLL che contiene l'implementazione del server oggetti.</span><span class="sxs-lookup"><span data-stu-id="8bd65-227">In-process: The SCM returns the file path of the DLL that contains the object server implementation.</span></span> <span data-ttu-id="8bd65-228">La libreria COM carica la DLL ed esegue una query per il puntatore di interfaccia class factory.</span><span class="sxs-lookup"><span data-stu-id="8bd65-228">The COM Library loads the DLL and queries it for its class factory interface pointer.</span></span>
-   <span data-ttu-id="8bd65-229">Locale: SCM avvia il file eseguibile locale che registra un class factory all'avvio e il puntatore di interfaccia è disponibile per il sistema e i client.</span><span class="sxs-lookup"><span data-stu-id="8bd65-229">Local: The SCM starts the local executable which registers a class factory on startup, and its interface pointer is available to the system and clients.</span></span>
-   <span data-ttu-id="8bd65-230">Remote: il gestore SCM locale acquisisce un puntatore a interfaccia class factory dal gestore SCM che è in esecuzione in un computer remoto.</span><span class="sxs-lookup"><span data-stu-id="8bd65-230">Remote: The local SCM acquires a class factory interface pointer from the SCM that is running on a remote computer.</span></span>

<span data-ttu-id="8bd65-231">Quando un client richiede un oggetto COM, la libreria COM Contatta SCM nell'host locale.</span><span class="sxs-lookup"><span data-stu-id="8bd65-231">When a client requests a COM object, the COM Library contacts the SCM on the local host.</span></span> <span data-ttu-id="8bd65-232">SCM individua il server COM appropriato, che può essere locale o remoto, e il server restituisce un puntatore a interfaccia per il class factory del server.</span><span class="sxs-lookup"><span data-stu-id="8bd65-232">The SCM locates the appropriate COM server, which may be local or remote, and the server returns an interface pointer to the server's class factory.</span></span> <span data-ttu-id="8bd65-233">Quando il class factory è disponibile, la libreria COM o il client può usare il class factory per creare l'oggetto richiesto.</span><span class="sxs-lookup"><span data-stu-id="8bd65-233">When the class factory is available, the COM Library or the client can use the class factory to create the requested object.</span></span> <span data-ttu-id="8bd65-234">Per ulteriori informazioni, vedere [implementazione di IClassFactory](implementing-iclassfactory.md).</span><span class="sxs-lookup"><span data-stu-id="8bd65-234">For more information, see [Implementing IClassFactory](implementing-iclassfactory.md).</span></span>

## <a name="reusability"></a><span data-ttu-id="8bd65-235">Riusabilità</span><span class="sxs-lookup"><span data-stu-id="8bd65-235">Reusability</span></span>

<span data-ttu-id="8bd65-236">COM supporta la *riusabilità nera*, il che significa che i dettagli di implementazione di un componente riutilizzabile non vengono esposti ai client.</span><span class="sxs-lookup"><span data-stu-id="8bd65-236">COM supports *black-box reusability*, which means that the implementation details of a reusable component are not exposed to clients.</span></span> <span data-ttu-id="8bd65-237">Per ottenere la riusabilità nera, COM supporta due meccanismi tramite cui un oggetto può riutilizzarne un altro.</span><span class="sxs-lookup"><span data-stu-id="8bd65-237">To achieve black-box reusability, COM supports two mechanisms through which one object may reuse another.</span></span> <span data-ttu-id="8bd65-238">Le due forme di riutilizzo sono denominate *contenimento* e *aggregazione*.</span><span class="sxs-lookup"><span data-stu-id="8bd65-238">The two forms of reuse are named *containment* and *aggregation*.</span></span> <span data-ttu-id="8bd65-239">Per convenzione, l'oggetto da riutilizzare viene denominato *oggetto interno* e l'oggetto che sta utilizzando l'oggetto interno è denominato *oggetto esterno*.</span><span class="sxs-lookup"><span data-stu-id="8bd65-239">By convention, the object being reused is named the *inner object*, and the object that is making use of the inner object is named the *outer object*.</span></span>

<span data-ttu-id="8bd65-240">In contenimento, l'oggetto esterno si comporta come un client dell'oggetto interno.</span><span class="sxs-lookup"><span data-stu-id="8bd65-240">In containment, the outer object behaves as a client of the inner object.</span></span> <span data-ttu-id="8bd65-241">L'oggetto esterno è un contenitore logico per l'oggetto interno e quando l'oggetto esterno usa i servizi dell'oggetto interno, l'oggetto esterno delega l'implementazione alle interfacce dell'oggetto interno.</span><span class="sxs-lookup"><span data-stu-id="8bd65-241">The outer object is a logical container for the inner object, and when the outer object uses the services of the inner object, the outer object delegates implementation to the inner object's interfaces.</span></span> <span data-ttu-id="8bd65-242">Ciò significa che l'oggetto esterno viene implementato in termini di servizi dell'oggetto interno.</span><span class="sxs-lookup"><span data-stu-id="8bd65-242">This means that the outer object is implemented in terms of the inner object's services.</span></span> <span data-ttu-id="8bd65-243">L'oggetto esterno potrebbe non supportare le stesse interfacce dell'oggetto interno e l'oggetto esterno può utilizzare l'interfaccia di un oggetto interno per consentire l'implementazione di parti di un'interfaccia diversa nell'oggetto esterno.</span><span class="sxs-lookup"><span data-stu-id="8bd65-243">The outer object may not support the same interfaces as the inner object, and the outer object may use an inner object's interface to help with implementing parts of a different interface on the outer object.</span></span>

<span data-ttu-id="8bd65-244">Nell'aggregazione, l'oggetto esterno espone le interfacce dall'oggetto interno come se fossero implementate sull'oggetto esterno.</span><span class="sxs-lookup"><span data-stu-id="8bd65-244">In aggregation, the outer object exposes interfaces from the inner object as if they were implemented on the outer object.</span></span> <span data-ttu-id="8bd65-245">Questa operazione è utile quando l'oggetto esterno delega sempre ogni chiamata su una delle relative interfacce alla stessa interfaccia dell'oggetto interno.</span><span class="sxs-lookup"><span data-stu-id="8bd65-245">This is useful when the outer object would always delegate every call on one of its interfaces to the same interface of the inner object.</span></span> <span data-ttu-id="8bd65-246">L'aggregazione è una praticità che consente all'oggetto esterno di evitare un sovraccarico di implementazione aggiuntivo.</span><span class="sxs-lookup"><span data-stu-id="8bd65-246">Aggregation is a convenience that enables the outer object to avoid extra implementation overhead.</span></span>

<span data-ttu-id="8bd65-247">Per ulteriori informazioni, vedere [riutilizzo di oggetti](reusing-objects.md).</span><span class="sxs-lookup"><span data-stu-id="8bd65-247">For more information, see [Reusing Objects](reusing-objects.md).</span></span>

## <a name="storage-and-stream-objects"></a><span data-ttu-id="8bd65-248">Oggetti di archiviazione e di flusso</span><span class="sxs-lookup"><span data-stu-id="8bd65-248">Storage and Stream Objects</span></span>

<span data-ttu-id="8bd65-249">Gli oggetti COM salvano lo stato in un file usando l' *archiviazione strutturata*, ovvero un tipo di archivio permanente che consente la navigazione del contenuto di un file usando la semantica file System.</span><span class="sxs-lookup"><span data-stu-id="8bd65-249">COM objects save state to a file by using *structured storage*, which is a form of persistent storage that enables navigation of a file's contents by using file system semantics.</span></span> <span data-ttu-id="8bd65-250">Il trattamento del contenuto di un file in questo modo Abilita funzionalità quali l'accesso incrementale, le transazioni e la condivisione tra i processi.</span><span class="sxs-lookup"><span data-stu-id="8bd65-250">Treating a file's contents in this manner enables features such as incremental access, transactions, and sharing among processes.</span></span>

<span data-ttu-id="8bd65-251">La specifica di archiviazione persistente COM fornisce due tipi di elementi di archiviazione: oggetti di archiviazione e oggetti flusso.</span><span class="sxs-lookup"><span data-stu-id="8bd65-251">The COM persistent storage specification provides for two types of storage elements: storage objects and stream objects.</span></span> <span data-ttu-id="8bd65-252">Questi oggetti sono implementati dalla libreria COM e le applicazioni utente implementano raramente questi elementi di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-252">These objects are implemented by the COM Library, and user applications rarely implement these storage elements.</span></span> <span data-ttu-id="8bd65-253">Gli oggetti di archiviazione implementano l'interfaccia [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) e gli oggetti flusso implementano l'interfaccia [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) .</span><span class="sxs-lookup"><span data-stu-id="8bd65-253">Storage objects implement the [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) interface, and stream objects implement the [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) interface.</span></span>

<span data-ttu-id="8bd65-254">Un oggetto flusso contiene dati ed è concettualmente simile a un singolo file in un file system.</span><span class="sxs-lookup"><span data-stu-id="8bd65-254">A stream object contains data and is conceptually similar to a single file in a file system.</span></span> <span data-ttu-id="8bd65-255">Ogni flusso dispone di diritti di accesso e di un singolo puntatore di ricerca.</span><span class="sxs-lookup"><span data-stu-id="8bd65-255">Each stream has access rights and a single seek pointer.</span></span> <span data-ttu-id="8bd65-256">Tramite l'interfaccia [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) è possibile leggere, scrivere, cercare ed eseguire altre operazioni sui dati sottostanti del flusso.</span><span class="sxs-lookup"><span data-stu-id="8bd65-256">Through the [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) interface, you can read, write, seek, and perform other operations on the stream's underlying data.</span></span> <span data-ttu-id="8bd65-257">Un flusso viene denominato usando una stringa di testo.</span><span class="sxs-lookup"><span data-stu-id="8bd65-257">A stream is named by using a text string.</span></span> <span data-ttu-id="8bd65-258">Può contenere qualsiasi struttura interna, perché si tratta di un flusso di byte flat.</span><span class="sxs-lookup"><span data-stu-id="8bd65-258">It can contain any internal structure, because it is a flat stream of bytes.</span></span> <span data-ttu-id="8bd65-259">Inoltre, le funzioni nell'interfaccia **IStream** sono simili alle funzioni standard basate su handle di file, ad esempio quelle nella libreria di runtime del linguaggio C ANSI.</span><span class="sxs-lookup"><span data-stu-id="8bd65-259">In addition, the functions in the **IStream** interface are similar to standard file-handle based functions, such as those in the ANSI C run-time library.</span></span>

<span data-ttu-id="8bd65-260">Un oggetto di archiviazione è concettualmente simile a una directory in una file system.</span><span class="sxs-lookup"><span data-stu-id="8bd65-260">A storage object is conceptually similar to a directory in a file system.</span></span> <span data-ttu-id="8bd65-261">Ogni archiviazione può contenere un numero qualsiasi di oggetti di archiviazione secondaria e un numero qualsiasi di flussi.</span><span class="sxs-lookup"><span data-stu-id="8bd65-261">Each storage can contain any number of sub-storage objects and any number of streams.</span></span> <span data-ttu-id="8bd65-262">Ogni risorsa di archiviazione ha i propri diritti di accesso.</span><span class="sxs-lookup"><span data-stu-id="8bd65-262">Each storage has its own access rights.</span></span> <span data-ttu-id="8bd65-263">Tramite l'interfaccia [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) , è possibile eseguire operazioni quali l'enumerazione, lo scorrimento, la copia, la ridenominazione, la creazione e l'eliminazione di elementi.</span><span class="sxs-lookup"><span data-stu-id="8bd65-263">Through the [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) interface, you can perform operations such as enumerating, moving, copying, renaming, creating, and deleting elements.</span></span> <span data-ttu-id="8bd65-264">Un oggetto di archiviazione non archivia i dati definiti dall'applicazione, ma archivia in modo implicito i nomi degli elementi (archiviazione e flussi) che contiene.</span><span class="sxs-lookup"><span data-stu-id="8bd65-264">A storage object does not store application-defined data, but it stores implicitly the names of the elements (storages and streams) that it contains.</span></span>

<span data-ttu-id="8bd65-265">Gli oggetti di archiviazione e di flusso sono condivisibili tra i processi quando vengono implementati in base alla specifica COM in una piattaforma host.</span><span class="sxs-lookup"><span data-stu-id="8bd65-265">Storage and stream objects are sharable among processes when they are implemented according to the COM specification on a host platform.</span></span> <span data-ttu-id="8bd65-266">In questo modo gli oggetti che sono in esecuzione in-process o out-of-process avranno un accesso incrementale uguale alla relativa archiviazione file.</span><span class="sxs-lookup"><span data-stu-id="8bd65-266">This enables objects that are running in-process or out-of-process to have equal incremental access to their file storage.</span></span> <span data-ttu-id="8bd65-267">Poiché COM viene caricato separatamente in ogni processo, USA i meccanismi di memoria condivisa supportati dal sistema operativo per comunicare lo stato degli elementi aperti e le relative modalità di accesso tra i processi.</span><span class="sxs-lookup"><span data-stu-id="8bd65-267">Because COM is loaded into each process separately, it uses operating-system supported shared memory mechanisms to communicate the state of opened elements and their access modes between processes.</span></span>

<span data-ttu-id="8bd65-268">Ogni oggetto di archiviazione e di flusso in un file strutturato ha un nome per identificarlo.</span><span class="sxs-lookup"><span data-stu-id="8bd65-268">Every storage and stream object in a structured file has a name to identify it.</span></span> <span data-ttu-id="8bd65-269">Il nome è una stringa che segue una determinata convenzione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-269">The name is a string that follows a particular convention.</span></span> <span data-ttu-id="8bd65-270">Per altre informazioni, vedere [convenzioni di denominazione degli oggetti di archiviazione](/windows/desktop/Stg/storage-object-naming-conventions).</span><span class="sxs-lookup"><span data-stu-id="8bd65-270">For more information, see [Storage Object Naming Conventions](/windows/desktop/Stg/storage-object-naming-conventions).</span></span> <span data-ttu-id="8bd65-271">Il nome viene passato alle funzioni [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) per specificare l'elemento nell'archivio su cui operare.</span><span class="sxs-lookup"><span data-stu-id="8bd65-271">The name is passed to [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) functions to specify which element in the storage to operate on.</span></span> <span data-ttu-id="8bd65-272">I nomi degli oggetti di archiviazione radice sono uguali ai nomi di file nel file system sottostante e questi nomi devono rispettare le convenzioni e le restrizioni del file system.</span><span class="sxs-lookup"><span data-stu-id="8bd65-272">Names of root storage objects are the same as file names in the underlying file system, and these names must follow the file system's conventions and restrictions.</span></span> <span data-ttu-id="8bd65-273">Stringhe passate alle funzioni correlate all'archiviazione i cui nomi vengono passati al file system senza l'interpretazione o le modifiche.</span><span class="sxs-lookup"><span data-stu-id="8bd65-273">Strings passed to storage-related functions which name files are passed through to the file system without interpretation or changes.</span></span>

<span data-ttu-id="8bd65-274">I nomi degli elementi contenuti negli oggetti di archiviazione vengono gestiti dall'implementazione dell'oggetto di archiviazione specifico in questione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-274">Names of elements that are contained within storage objects are managed by the implementation of the particular storage object in question.</span></span> <span data-ttu-id="8bd65-275">Tutte le implementazioni di oggetti di archiviazione devono supportare nomi di elementi di lunghezza 32 caratteri e alcune implementazioni possono supportare nomi più lunghi.</span><span class="sxs-lookup"><span data-stu-id="8bd65-275">All implementations of storage objects must support element names that are 32 characters in length, and some implementations may support longer names.</span></span> <span data-ttu-id="8bd65-276">I nomi vengono archiviati con case mantenuti, ma vengono confrontati senza distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="8bd65-276">Names are stored with case preserved, but they are compared as case-insensitive.</span></span> <span data-ttu-id="8bd65-277">Le applicazioni che definiscono i nomi degli elementi di archiviazione devono scegliere nomi che funzionano in entrambe le situazioni.</span><span class="sxs-lookup"><span data-stu-id="8bd65-277">Applications that define storage element names must choose names that work in either situation.</span></span>

<span data-ttu-id="8bd65-278">Per accedere a ogni elemento in un file di archiviazione strutturata è possibile usare funzioni e interfacce implementate da COM.</span><span class="sxs-lookup"><span data-stu-id="8bd65-278">You access every element in a structured storage file by using functions and interfaces that are implemented by COM.</span></span> <span data-ttu-id="8bd65-279">Ciò significa che altre applicazioni possono esplorare il file passando con le funzioni di interfaccia [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) che forniscono servizi di tipo directory.</span><span class="sxs-lookup"><span data-stu-id="8bd65-279">This means that other applications can browse the file by navigating with the [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) interface functions that provide directory-like services.</span></span> <span data-ttu-id="8bd65-280">Inoltre, altre applicazioni possono usare i dati del file, senza dover eseguire l'applicazione che ha scritto il file.</span><span class="sxs-lookup"><span data-stu-id="8bd65-280">Also, other applications can use the file's data, without having to run the application that wrote the file.</span></span> <span data-ttu-id="8bd65-281">Quando un'applicazione COM accede ai file di archiviazione strutturati di un'altra applicazione, si applicano i diritti di accesso standard di Windows e l'applicazione deve disporre di privilegi sufficienti.</span><span class="sxs-lookup"><span data-stu-id="8bd65-281">When a COM application accesses the structured storage files of another application, standard Windows access rights apply, and the application must have sufficient privileges.</span></span>

<span data-ttu-id="8bd65-282">Un oggetto COM può leggere e scrivere in un archivio permanente.</span><span class="sxs-lookup"><span data-stu-id="8bd65-282">A COM object can read and write itself to persistent storage.</span></span> <span data-ttu-id="8bd65-283">Un client esegue una query per una delle interfacce correlate alla persistenza nell'oggetto COM, a seconda del contesto dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-283">A client queries for one of the persistence-related interfaces on the COM object, depending on the context of the operation.</span></span> <span data-ttu-id="8bd65-284">Gli oggetti COM possono implementare qualsiasi combinazione delle interfacce seguenti:</span><span class="sxs-lookup"><span data-stu-id="8bd65-284">COM objects can implement any combination of the following interfaces:</span></span>

-   <span data-ttu-id="8bd65-285">[**IPersistStorage**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage): l'oggetto com legge e scrive lo stato persistente in un oggetto di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-285">[**IPersistStorage**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststorage): The COM object reads and writes its persistent state to a storage object.</span></span> <span data-ttu-id="8bd65-286">Il client fornisce all'oggetto un puntatore [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) tramite questa interfaccia.</span><span class="sxs-lookup"><span data-stu-id="8bd65-286">The client provides the object with an [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) pointer through this interface.</span></span> <span data-ttu-id="8bd65-287">Questa è l'unica interfaccia di persistenza che include la semantica per l'accesso incrementale.</span><span class="sxs-lookup"><span data-stu-id="8bd65-287">This is the only persistence interface that includes semantics for incremental access.</span></span>
-   <span data-ttu-id="8bd65-288">[**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream): l'oggetto com legge e scrive lo stato persistente in un oggetto flusso.</span><span class="sxs-lookup"><span data-stu-id="8bd65-288">[**IPersistStream**](/windows/desktop/api/ObjIdl/nn-objidl-ipersiststream): The COM object reads and writes its persistent state to a stream object.</span></span> <span data-ttu-id="8bd65-289">Il client fornisce all'oggetto un puntatore [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) tramite questa interfaccia.</span><span class="sxs-lookup"><span data-stu-id="8bd65-289">The client provides the object with an [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) pointer through this interface.</span></span>
-   <span data-ttu-id="8bd65-290">[**IPersistFile**](/windows/desktop/api/ObjIdl/nn-objidl-ipersistfile): l'oggetto com legge e scrive lo stato persistente direttamente in un file nel sistema sottostante.</span><span class="sxs-lookup"><span data-stu-id="8bd65-290">[**IPersistFile**](/windows/desktop/api/ObjIdl/nn-objidl-ipersistfile): The COM object reads and writes its persistent state directly to a file on the underlying system.</span></span> <span data-ttu-id="8bd65-291">Questa interfaccia non prevede [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) o [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) a meno che non si acceda al file sottostante tramite queste interfacce, ma l'interfaccia **IPersistFile** non ha semantica per archiviazione e flussi.</span><span class="sxs-lookup"><span data-stu-id="8bd65-291">This interface does not involve [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) or [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream) unless the underlying file is accessed through these interfaces, but the **IPersistFile** interface has no semantics for storages and streams.</span></span> <span data-ttu-id="8bd65-292">Il client fornisce all'oggetto un nome file e chiama le funzioni [**Save**](/windows/desktop/api/ObjIdl/nf-objidl-ipersistfile-save) o [**Load**](/windows/desktop/api/ObjIdl/nf-objidl-ipersistfile-load) .</span><span class="sxs-lookup"><span data-stu-id="8bd65-292">The client provides the object with a file name and calls the [**Save**](/windows/desktop/api/ObjIdl/nf-objidl-ipersistfile-save) or [**Load**](/windows/desktop/api/ObjIdl/nf-objidl-ipersistfile-load) functions.</span></span>

## <a name="data-transfer"></a><span data-ttu-id="8bd65-293">Trasferimento dati</span><span class="sxs-lookup"><span data-stu-id="8bd65-293">Data Transfer</span></span>

<span data-ttu-id="8bd65-294">L'archiviazione strutturata rappresenta la base per lo scambio di dati tra oggetti COM e processi, denominato *trasferimento dati uniformi*.</span><span class="sxs-lookup"><span data-stu-id="8bd65-294">Structured storage provides the basis for data exchange between COM objects and processes, which is named *uniform data transfer*.</span></span> <span data-ttu-id="8bd65-295">Prima dell'implementazione di COM in OLE 2, il trasferimento dei dati in Windows è stato specificato dai *protocolli di trasferimento*, ad esempio gli appunti e i protocolli di trascinamento della selezione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-295">Before COM was implemented in OLE 2, data transfer on Windows was specified by *transfer protocols*, such as the clipboard and drag-drop protocols.</span></span> <span data-ttu-id="8bd65-296">Ogni protocollo di trasferimento disponeva di un proprio set di funzioni che delegavano il protocollo alla query e il codice specifico era necessario per gestire ogni protocollo e procedura di scambio differenti.</span><span class="sxs-lookup"><span data-stu-id="8bd65-296">Each transfer protocol had its own set of functions that bound the protocol to the query, and specific code was required to handle each different protocol and exchange procedure.</span></span> <span data-ttu-id="8bd65-297">Il trasferimento di dati uniformi rappresenta tutti i trasferimenti di dati tramite l'interfaccia [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) , che separa le operazioni comuni di scambio dei dati dal protocollo di trasferimento.</span><span class="sxs-lookup"><span data-stu-id="8bd65-297">Uniform data transfer represents all data transfers by using the [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) interface, which separates common data exchange operations from the transfer protocol.</span></span>

<span data-ttu-id="8bd65-298">L'interfaccia [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) incapsula le operazioni get e set standard su dati, query ed enumerazioni e notifiche che rilevano quando i dati vengono modificati in un oggetto.</span><span class="sxs-lookup"><span data-stu-id="8bd65-298">The [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) interface encapsulates the standard get and set operations on data, queries and enumerations, and notifications that detect when data changes in an object.</span></span> <span data-ttu-id="8bd65-299">Il trasferimento di dati uniformi consente descrizioni complete dei formati di dati, nonché l'uso di supporti di archiviazione diversi per il trasferimento dei dati.</span><span class="sxs-lookup"><span data-stu-id="8bd65-299">Uniform data transfer enables rich descriptions of data formats, as well as the use of different storage media for the data transfer.</span></span>

<span data-ttu-id="8bd65-300">Durante il trasferimento di dati uniformi, tutti i protocolli scambiano un puntatore a un'interfaccia [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) .</span><span class="sxs-lookup"><span data-stu-id="8bd65-300">During uniform data transfer, all protocols exchange a pointer to an [**IDataObject**](/windows/desktop/api/ObjIdl/nn-objidl-idataobject) interface.</span></span> <span data-ttu-id="8bd65-301">Il server è l'origine dei dati e implementa un oggetto dati, che può essere utilizzato in qualsiasi protocollo di scambio di dati.</span><span class="sxs-lookup"><span data-stu-id="8bd65-301">The server is the source of the data and implements one data object, which is usable in any data exchange protocol.</span></span> <span data-ttu-id="8bd65-302">Il client utilizza i dati e richiede i dati di un oggetto dati quando riceve un puntatore **IDataObject** da qualsiasi protocollo.</span><span class="sxs-lookup"><span data-stu-id="8bd65-302">The client consumes the data and requests data from a data object when it receives an **IDataObject** pointer from any protocol.</span></span> <span data-ttu-id="8bd65-303">Dopo che si è verificato lo scambio di puntatori, entrambi i lati gestiscono lo scambio di dati in modo uniforme, tramite l'interfaccia **IDataObject** .</span><span class="sxs-lookup"><span data-stu-id="8bd65-303">After the pointer exchange has occurred, both sides handle data exchange in a uniform fashion, through the **IDataObject** interface.</span></span>

<span data-ttu-id="8bd65-304">COM definisce due strutture di dati che consentono il trasferimento di dati uniformi.</span><span class="sxs-lookup"><span data-stu-id="8bd65-304">COM defines two data structures that enable uniform data transfer.</span></span> <span data-ttu-id="8bd65-305">La struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) rappresenta un formato degli Appunti generalizzato e la struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) rappresenta il supporto di trasferimento come un handle di memoria.</span><span class="sxs-lookup"><span data-stu-id="8bd65-305">The [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure represents a generalized clipboard format, and the [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure represents the transfer medium as a memory handle.</span></span>

<span data-ttu-id="8bd65-306">Il client crea una struttura [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) per indicare il tipo di dati che richiede da un'origine dati e viene utilizzata dall'origine dati per descrivere i formati disponibili.</span><span class="sxs-lookup"><span data-stu-id="8bd65-306">The client creates a [**FORMATETC**](/windows/win32/api/objidl/ns-objidl-formatetc) structure to indicate the type of data that it requests from a data source, and it is used by the data source to describe what formats it provides.</span></span> <span data-ttu-id="8bd65-307">Il client esegue una query su un'origine dati per i formati disponibili richiedendo l'interfaccia [**IEnumFORMATETC**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) .</span><span class="sxs-lookup"><span data-stu-id="8bd65-307">The client queries a data source for its available formats by requesting its [**IEnumFORMATETC**](/windows/desktop/api/ObjIdl/nn-objidl-ienumformatetc) interface.</span></span> <span data-ttu-id="8bd65-308">Per ulteriori informazioni, vedere [la struttura FORMATETC](the-formatetc-structure.md).</span><span class="sxs-lookup"><span data-stu-id="8bd65-308">For more information, see [The FORMATETC Structure](the-formatetc-structure.md).</span></span>

<span data-ttu-id="8bd65-309">Il client crea una struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) e la passa al metodo [**GetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-getdata) e l'oggetto dati restituisce i dati nella struttura **STGMEDIUM** fornita.</span><span class="sxs-lookup"><span data-stu-id="8bd65-309">The client creates a [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure and passes it to the [**GetData**](/windows/desktop/api/ObjIdl/nf-objidl-idataobject-getdata) method, and the data object returns the data in the provided **STGMEDIUM** structure.</span></span>

<span data-ttu-id="8bd65-310">La struttura [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) consente a client e origini dati di scegliere il supporto di scambio più efficiente.</span><span class="sxs-lookup"><span data-stu-id="8bd65-310">The [**STGMEDIUM**](/windows/win32/api/objidl/ns-objidl-ustgmedium-r1) structure enables both clients and data sources to choose the most efficient exchange medium.</span></span> <span data-ttu-id="8bd65-311">Se, ad esempio, i dati da scambiare sono molto grandi, l'origine dati può indicare un supporto basato su disco come formato preferito, anziché la memoria principale.</span><span class="sxs-lookup"><span data-stu-id="8bd65-311">For example, if the data to be exchanged is very large, the data source can indicate a disk-based medium as its preferred format, instead of main memory.</span></span> <span data-ttu-id="8bd65-312">Questa flessibilità consente scambi di dati efficienti che possono essere veloci come il passaggio di un puntatore a un [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) o a un [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream).</span><span class="sxs-lookup"><span data-stu-id="8bd65-312">This flexibility enables efficient data exchanges that can be as fast as passing a pointer to an [**IStorage**](/windows/desktop/api/objidl/nn-objidl-istorage) or an [**IStream**](/windows/desktop/api/objidl/nn-objidl-istream).</span></span> <span data-ttu-id="8bd65-313">Per ulteriori informazioni, vedere [la struttura STGMEDIUM](the-stgmedium-structure.md).</span><span class="sxs-lookup"><span data-stu-id="8bd65-313">For more information, see [The STGMEDIUM Structure](the-stgmedium-structure.md).</span></span>

<span data-ttu-id="8bd65-314">Un client di un'origine dati può richiedere una notifica quando i dati vengono modificati.</span><span class="sxs-lookup"><span data-stu-id="8bd65-314">A client of a data source may require notification when the data changes.</span></span> <span data-ttu-id="8bd65-315">COM gestisce le notifiche di modifica dei dati tramite un oggetto *sink di notifica* , che implementa l'interfaccia [**IAdviseSink**](/windows/desktop/api/ObjIdl/nn-objidl-iadvisesink) .</span><span class="sxs-lookup"><span data-stu-id="8bd65-315">COM handles data-change notifications by using an *advise sink* object, which implements the [**IAdviseSink**](/windows/desktop/api/ObjIdl/nn-objidl-iadvisesink) interface.</span></span> <span data-ttu-id="8bd65-316">L'oggetto sink Advise e l'interfaccia **IAdviseSink** vengono implementati dal client, che passa un puntatore **IAdviseSink** all'origine dati.</span><span class="sxs-lookup"><span data-stu-id="8bd65-316">The advise sink object and the **IAdviseSink** interface are implemented by the client, which passes an **IAdviseSink** pointer to the data source.</span></span> <span data-ttu-id="8bd65-317">Quando l'origine dati rileva una modifica nei dati sottostanti, viene chiamato un metodo **IAdviseSink** per notificare al client.</span><span class="sxs-lookup"><span data-stu-id="8bd65-317">When the data source detects a change in the underlying data, it calls an **IAdviseSink** method to notify the client.</span></span> <span data-ttu-id="8bd65-318">Per ulteriori informazioni, vedere [notifica dati](data-notification.md).</span><span class="sxs-lookup"><span data-stu-id="8bd65-318">For more information, see [Data Notification](data-notification.md).</span></span>

## <a name="remoting"></a><span data-ttu-id="8bd65-319">Comunicazione remota</span><span class="sxs-lookup"><span data-stu-id="8bd65-319">Remoting</span></span>

<span data-ttu-id="8bd65-320">COM consente il calcolo remoto e distribuito.</span><span class="sxs-lookup"><span data-stu-id="8bd65-320">COM enables remote and distributed computation.</span></span> <span data-ttu-id="8bd65-321">La *comunicazione remota dell'interfaccia* consente a una funzione membro di restituire un puntatore di interfaccia a un oggetto com che si trova in un processo diverso o in un computer host diverso.</span><span class="sxs-lookup"><span data-stu-id="8bd65-321">*Interface remoting* enables a member function to return an interface pointer to a COM object that is in a different process or on a different host computer.</span></span> <span data-ttu-id="8bd65-322">L'infrastruttura che esegue la comunicazione remota dell'interfaccia è trasparente sia per il client che per il server oggetti.</span><span class="sxs-lookup"><span data-stu-id="8bd65-322">The infrastructure that performs the interface remoting is transparent to both the client and the object server.</span></span> <span data-ttu-id="8bd65-323">Il client o il server non necessitano dei dettagli della distribuzione di un altro per comunicare tramite un'interfaccia remota.</span><span class="sxs-lookup"><span data-stu-id="8bd65-323">Neither the client nor the server need one another's deployment details to communicate through a remoted interface.</span></span> <span data-ttu-id="8bd65-324">Un client chiama funzioni membro sulla stessa interfaccia per comunicare con un oggetto COM in-process, out-of-process nell'host locale o in un computer remoto.</span><span class="sxs-lookup"><span data-stu-id="8bd65-324">A client calls member functions on the same interface to communicate with a COM object that is in-process, out-of-process on the local host, or on a remote computer.</span></span> <span data-ttu-id="8bd65-325">Le chiamate locali e remote sulla stessa interfaccia non sono distinguibili per il client.</span><span class="sxs-lookup"><span data-stu-id="8bd65-325">Local and remote calls on the same interface are indistinguishable to the client.</span></span>

<span data-ttu-id="8bd65-326">Per comunicare con un oggetto COM, un client chiama sempre un'implementazione in-process.</span><span class="sxs-lookup"><span data-stu-id="8bd65-326">To communicate with a COM object, a client always calls an in-process implementation.</span></span> <span data-ttu-id="8bd65-327">Se l'oggetto COM è in-process, la chiamata è diretta.</span><span class="sxs-lookup"><span data-stu-id="8bd65-327">If the COM object is in-process, the call is direct.</span></span> <span data-ttu-id="8bd65-328">Se l'oggetto COM è out-of-process o remote, COM fornisce un'implementazione del *proxy* che invia la chiamata all'oggetto tramite il protocollo RPC (Remote Procedure Call).</span><span class="sxs-lookup"><span data-stu-id="8bd65-328">If the COM object is out-of-process or remote, COM provides a *proxy* implementation that forwards the call to the object by using the Remote Procedure Call (RPC) protocol.</span></span>

<span data-ttu-id="8bd65-329">Un oggetto COM riceve sempre le chiamate da un client tramite un'implementazione in-process.</span><span class="sxs-lookup"><span data-stu-id="8bd65-329">A COM object always receives calls from a client through an in-process implementation.</span></span> <span data-ttu-id="8bd65-330">Se il chiamante è in-process, la chiamata è diretta.</span><span class="sxs-lookup"><span data-stu-id="8bd65-330">If the caller is in-process, the call is direct.</span></span> <span data-ttu-id="8bd65-331">Se il chiamante è out-of-process o remote, COM fornisce un'implementazione *Stub* che riceve la chiamata di procedura remota dal proxy nel processo client.</span><span class="sxs-lookup"><span data-stu-id="8bd65-331">If the caller is out-of-process or remote, COM provides a *stub* implementation that receives the remote procedure call from the proxy in the client process.</span></span>

<span data-ttu-id="8bd65-332">Il *marshalling* è la procedura per la creazione del pacchetto dello stack di chiamate per la trasmissione dal proxy allo stub.</span><span class="sxs-lookup"><span data-stu-id="8bd65-332">*Marshaling* is the procedure for packaging the call stack for transmission from proxy to stub.</span></span> <span data-ttu-id="8bd65-333">L'annullamento del *marshalling* è l'annullamento del packaging che si verifica all'estremità ricevente.</span><span class="sxs-lookup"><span data-stu-id="8bd65-333">*Unmarshaling* is the unpackaging that occurs at the receiving end.</span></span> <span data-ttu-id="8bd65-334">I valori restituiti vengono sottoposti a marshalling e viene effettuato l'unmarshalling dallo stub al proxy.</span><span class="sxs-lookup"><span data-stu-id="8bd65-334">Return values are marshaled and unmarshaled from the stub to the proxy.</span></span> <span data-ttu-id="8bd65-335">Questo tipo di comunicazione viene chiamato anche invio di una chiamata *sulla rete*.</span><span class="sxs-lookup"><span data-stu-id="8bd65-335">This kind of communication is also referred to as sending a call *over the wire*.</span></span>

<span data-ttu-id="8bd65-336">Per ogni tipo di dati diverso sono presenti regole per il marshalling.</span><span class="sxs-lookup"><span data-stu-id="8bd65-336">Each different data type has rules for marshaling.</span></span> <span data-ttu-id="8bd65-337">I puntatori di interfaccia hanno anche un protocollo di marshalling, incapsulato nella funzione [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) .</span><span class="sxs-lookup"><span data-stu-id="8bd65-337">Interface pointers also have a marshaling protocol, which is encapsulated in the [**CoMarshalInterface**](/windows/desktop/api/combaseapi/nf-combaseapi-comarshalinterface) function.</span></span> <span data-ttu-id="8bd65-338">Nella maggior parte dei casi, il *marshalling dell'interfaccia standard*, fornito dal sistema, è sufficiente, ma un oggetto com può implementare facoltativamente il *marshalling dell'interfaccia personalizzato* per controllare la creazione di proxy di oggetti remoti.</span><span class="sxs-lookup"><span data-stu-id="8bd65-338">In most cases, *standard interface marshaling*, which is provided by the system, is sufficient, but a COM object optionally may implement *custom interface marshaling* to control the creation of remote object proxies to itself.</span></span> <span data-ttu-id="8bd65-339">Per ulteriori informazioni, vedere [comunicazione tra oggetti](inter-object-communication.md).</span><span class="sxs-lookup"><span data-stu-id="8bd65-339">For more information, see [Inter-Object Communication](inter-object-communication.md).</span></span>

## <a name="security"></a><span data-ttu-id="8bd65-340">Sicurezza</span><span class="sxs-lookup"><span data-stu-id="8bd65-340">Security</span></span>

<span data-ttu-id="8bd65-341">COM offre due forme di sicurezza dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-341">COM provides two forms of application security.</span></span> <span data-ttu-id="8bd65-342">Uno è la *sicurezza dell'attivazione*, che specifica come vengono creati nuovi oggetti, il modo in cui i client si connettono a oggetti nuovi ed esistenti e il modo in cui vengono protetti determinati servizi pubblici, ad esempio la tabella delle classi e la tabella degli oggetti in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-342">One is *activation security*, which specifies how new objects are created, how clients connect to new and existing objects, and how certain public services, such as the Class Table and the Running Object Table are secured.</span></span> <span data-ttu-id="8bd65-343">L'altro è la *sicurezza delle chiamate*, che specifica il modo in cui la sicurezza opera in una connessione stabilita tra un client e un oggetto com.</span><span class="sxs-lookup"><span data-stu-id="8bd65-343">The other is *call security*, which specifies how security operates in an established connection between a client to a COM object.</span></span>

<span data-ttu-id="8bd65-344">La sicurezza dell'attivazione viene applicata automaticamente da Gestione controllo servizi (SCM).</span><span class="sxs-lookup"><span data-stu-id="8bd65-344">Activation security is applied automatically by the Service Control Manager (SCM).</span></span> <span data-ttu-id="8bd65-345">Quando Gestione controllo servizi riceve una richiesta di recupero di un oggetto COM, verifica la richiesta rispetto alle informazioni di sicurezza archiviate nel registro di sistema.</span><span class="sxs-lookup"><span data-stu-id="8bd65-345">When the SCM receives a request to retrieve a COM object, it checks the request against security information that is stored in the registry.</span></span>

<span data-ttu-id="8bd65-346">Le implementazioni SCM in genere offrono la configurazione guidata dal registro di sistema per l'amministrazione delle classi distribuite e per account utente specifici nell'host.</span><span class="sxs-lookup"><span data-stu-id="8bd65-346">SCM implementations usually offer registry-driven configuration for administering deployed classes and for specific user accounts on the host.</span></span> <span data-ttu-id="8bd65-347">Per ulteriori informazioni, vedere [sicurezza dell'attivazione](activation-security.md).</span><span class="sxs-lookup"><span data-stu-id="8bd65-347">For more information, see [Activation Security](activation-security.md).</span></span>

<span data-ttu-id="8bd65-348">La sicurezza delle chiamate viene applicata automaticamente o viene applicata dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-348">Call security is applied automatically or is enforced by the application.</span></span> <span data-ttu-id="8bd65-349">Se l'applicazione fornisce informazioni di installazione, COM esegue i controlli necessari per proteggere l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="8bd65-349">If the application provides setup information, COM performs the necessary checks to secure the application.</span></span>

<span data-ttu-id="8bd65-350">Il meccanismo automatico controlla la sicurezza del processo, ma non per i singoli oggetti o metodi.</span><span class="sxs-lookup"><span data-stu-id="8bd65-350">The automatic mechanism checks security for the process, but not for individual objects or methods.</span></span> <span data-ttu-id="8bd65-351">Se un'applicazione richiede una sicurezza più granulare, COM fornisce funzioni che possono essere utilizzate dalle applicazioni per il controllo di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="8bd65-351">If an application requires more fine-grained security, COM provides functions that applications may use do their own security checking.</span></span>

<span data-ttu-id="8bd65-352">I meccanismi automatici e personalizzati possono essere usati insieme, quindi un'applicazione potrebbe richiedere a COM di eseguire un controllo di sicurezza automatico e quindi di eseguire le proprie operazioni.</span><span class="sxs-lookup"><span data-stu-id="8bd65-352">The automatic and custom mechanisms can be used together, so an application may ask COM to perform automatic security checking and then perform its own.</span></span>

<span data-ttu-id="8bd65-353">I servizi di sicurezza delle chiamate COM sono divisi nelle categorie seguenti:</span><span class="sxs-lookup"><span data-stu-id="8bd65-353">COM call security services are divided into the following categories:</span></span>

-   <span data-ttu-id="8bd65-354">Funzioni generali chiamate da client e server che consentono l'inizializzazione del meccanismo di sicurezza automatico e la registrazione dei servizi di autenticazione automatica.</span><span class="sxs-lookup"><span data-stu-id="8bd65-354">General functions that are called by both clients and servers, which enable the automatic security mechanism to be initialized and automatic authentication services to be registered.</span></span> <span data-ttu-id="8bd65-355">Le API di sicurezza delle chiamate generali sono le funzioni [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) e [**CoQueryAuthenticationServices**](/windows/desktop/api/combaseapi/nf-combaseapi-coqueryauthenticationservices) .</span><span class="sxs-lookup"><span data-stu-id="8bd65-355">The general call security APIs are the [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) and [**CoQueryAuthenticationServices**](/windows/desktop/api/combaseapi/nf-combaseapi-coqueryauthenticationservices) functions.</span></span>
-   <span data-ttu-id="8bd65-356">Interfacce nei proxy client, che consentono al client di controllare la sicurezza sulle chiamate a singole interfacce.</span><span class="sxs-lookup"><span data-stu-id="8bd65-356">Interfaces on client proxies, which enable the client to control the security on calls to individual interfaces.</span></span> <span data-ttu-id="8bd65-357">L'interfaccia [**IClientSecurity**](/windows/desktop/api/ObjIdl/nn-objidl-iclientsecurity) e le funzioni [**CoQueryProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-coqueryproxyblanket), [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)e [**CoCopyProxy**](/windows/desktop/api/combaseapi/nf-combaseapi-cocopyproxy) forniscono la sicurezza delle chiamate su un oggetto remoto.</span><span class="sxs-lookup"><span data-stu-id="8bd65-357">The [**IClientSecurity**](/windows/desktop/api/ObjIdl/nn-objidl-iclientsecurity) interface and the [**CoQueryProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-coqueryproxyblanket), [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket), and [**CoCopyProxy**](/windows/desktop/api/combaseapi/nf-combaseapi-cocopyproxy) functions provide call security on a remote object.</span></span>
-   <span data-ttu-id="8bd65-358">Funzioni lato server e interfacce del contesto di chiamata che consentono al server di recuperare informazioni di sicurezza su una chiamata e di rappresentare il chiamante.</span><span class="sxs-lookup"><span data-stu-id="8bd65-358">Server-side functions and call-context interfaces, which enable the server to retrieve security information about a call and to impersonate the caller.</span></span> <span data-ttu-id="8bd65-359">L'interfaccia [**IServerSecurity**](/windows/win32/api/objidlbase/nn-objidlbase-iserversecurity) e le funzioni [**CoGetCallContext**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetcallcontext), [**CoImpersonateClient**](/windows/desktop/api/combaseapi/nf-combaseapi-coimpersonateclient)e [**CoRevertToSelf**](/windows/desktop/api/combaseapi/nf-combaseapi-coreverttoself) forniscono la sicurezza delle chiamate sul lato server.</span><span class="sxs-lookup"><span data-stu-id="8bd65-359">The [**IServerSecurity**](/windows/win32/api/objidlbase/nn-objidlbase-iserversecurity) interface and the [**CoGetCallContext**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetcallcontext), [**CoImpersonateClient**](/windows/desktop/api/combaseapi/nf-combaseapi-coimpersonateclient), and [**CoRevertToSelf**](/windows/desktop/api/combaseapi/nf-combaseapi-coreverttoself) functions provide server-side call security.</span></span>

<span data-ttu-id="8bd65-360">Spesso il client esegue una query sull'oggetto COM per l'interfaccia [**IClientSecurity**](/windows/desktop/api/ObjIdl/nn-objidl-iclientsecurity) , implementata localmente dal livello di comunicazione remota.</span><span class="sxs-lookup"><span data-stu-id="8bd65-360">Often, the client queries the COM object for the [**IClientSecurity**](/windows/desktop/api/ObjIdl/nn-objidl-iclientsecurity) interface, which is implemented locally by the remoting layer.</span></span> <span data-ttu-id="8bd65-361">Il client usa questa interfaccia per controllare la sicurezza dei singoli proxy di interfaccia sull'oggetto COM prima di effettuare una chiamata su una delle interfacce.</span><span class="sxs-lookup"><span data-stu-id="8bd65-361">The client uses this interface to control the security of individual interface proxies on the COM object before making a call on one of the interfaces.</span></span>

<span data-ttu-id="8bd65-362">Quando arriva una chiamata al server, il server può chiamare la funzione [**CoGetCallContext**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetcallcontext) per recuperare un'interfaccia [**IServerSecurity**](/windows/win32/api/objidlbase/nn-objidlbase-iserversecurity) , che consente al server di controllare l'autenticazione del client e di rappresentare il client, se necessario.</span><span class="sxs-lookup"><span data-stu-id="8bd65-362">When a call arrives at the server, the server may call the [**CoGetCallContext**](/windows/desktop/api/combaseapi/nf-combaseapi-cogetcallcontext) function to retrieve an [**IServerSecurity**](/windows/win32/api/objidlbase/nn-objidlbase-iserversecurity) interface, which allows the server to check the client's authentication and to impersonate the client, if necessary.</span></span> <span data-ttu-id="8bd65-363">L'oggetto **IServerSecurity** è valido per la durata della chiamata.</span><span class="sxs-lookup"><span data-stu-id="8bd65-363">The **IServerSecurity** object is valid for the duration of the call.</span></span>

<span data-ttu-id="8bd65-364">Chiamare la funzione [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) per inizializzare il livello di sicurezza e impostare i valori specificati come valore predefinito di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="8bd65-364">Call the [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) function to initialize the security layer and set the specified values as the security default.</span></span> <span data-ttu-id="8bd65-365">Se un processo non chiama **CoInitializeSecurity**, com lo chiama automaticamente alla prima esecuzione del marshalling o dell'annullamento del marshalling di un'interfaccia, registrando la sicurezza predefinita del sistema.</span><span class="sxs-lookup"><span data-stu-id="8bd65-365">If a process does not call **CoInitializeSecurity**, COM calls it automatically the first time an interface is marshaled or unmarshaled, registering the system default security.</span></span> <span data-ttu-id="8bd65-366">La funzione **CoInitializeSecurity** consente al client di stabilire la sicurezza delle chiamate predefinita per il processo, evitando così l'uso di [**IClientSecurity**](/windows/desktop/api/ObjIdl/nn-objidl-iclientsecurity) nei singoli proxy.</span><span class="sxs-lookup"><span data-stu-id="8bd65-366">The **CoInitializeSecurity** function allows the client to establish default call security for the process, which avoids the use of [**IClientSecurity**](/windows/desktop/api/ObjIdl/nn-objidl-iclientsecurity) on individual proxies.</span></span> <span data-ttu-id="8bd65-367">La funzione **CoInitializeSecurity** consente a un server di registrare i servizi di autenticazione automatici per il processo.</span><span class="sxs-lookup"><span data-stu-id="8bd65-367">The **CoInitializeSecurity** function enables a server to register automatic authentication services for the process.</span></span> <span data-ttu-id="8bd65-368">Per ulteriori informazioni, vedere [impostazione Process-Wide sicurezza con CoInitializeSecurity](setting-processwide-security-with-coinitializesecurity.md).</span><span class="sxs-lookup"><span data-stu-id="8bd65-368">For more information, see [Setting Process-Wide Security with CoInitializeSecurity](setting-processwide-security-with-coinitializesecurity.md).</span></span>

## <a name="related-topics"></a><span data-ttu-id="8bd65-369">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="8bd65-369">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="8bd65-370">Client e server COM</span><span class="sxs-lookup"><span data-stu-id="8bd65-370">COM Clients and Servers</span></span>](com-clients-and-servers.md)
</dt> <dt>

[<span data-ttu-id="8bd65-371">Definizione di interfacce COM</span><span class="sxs-lookup"><span data-stu-id="8bd65-371">Defining COM Interfaces</span></span>](defining-com-interfaces.md)
</dt> <dt>

[<span data-ttu-id="8bd65-372">Registrazione di applicazioni COM</span><span class="sxs-lookup"><span data-stu-id="8bd65-372">Registering COM Applications</span></span>](registering-com-applications.md)
</dt> <dt>

[<span data-ttu-id="8bd65-373">Sicurezza in COM</span><span class="sxs-lookup"><span data-stu-id="8bd65-373">Security in COM</span></span>](security-in-com.md)
</dt> <dt>

[<span data-ttu-id="8bd65-374">Processi, thread e Apartment</span><span class="sxs-lookup"><span data-stu-id="8bd65-374">Processes, Threads, and Apartments</span></span>](processes--threads--and-apartments.md)
</dt> </dl>

 

 
