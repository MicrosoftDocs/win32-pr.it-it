---
title: Mascheramento (COM)
description: Il cloaking è una funzionalità di sicurezza COM che determina l'identità proiettata dal client verso il server durante la rappresentazione.
ms.assetid: 5b97d9d6-8fa9-4da2-8351-64772227d9a2
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 588651cfa37def4e174ef0f2fdba9b79b0c60ca8
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/03/2021
ms.locfileid: "103885886"
---
# <a name="cloaking-com"></a><span data-ttu-id="c3822-103">Mascheramento (COM)</span><span class="sxs-lookup"><span data-stu-id="c3822-103">Cloaking (COM)</span></span>

<span data-ttu-id="c3822-104">Il cloaking è una funzionalità di sicurezza COM che determina l'identità proiettata dal client verso il server durante la rappresentazione.</span><span class="sxs-lookup"><span data-stu-id="c3822-104">Cloaking is a COM security capability that determines what identity the client projects toward the server during impersonation.</span></span> <span data-ttu-id="c3822-105">Quando è impostato il mascheramento, il server intermedio maschera la propria identità e presenta l'identità del client al server che chiama per conto del client.</span><span class="sxs-lookup"><span data-stu-id="c3822-105">When cloaking is set, the intermediate server masks its own identity and presents the client's identity to the server that it calls on the client's behalf.</span></span> <span data-ttu-id="c3822-106">Fondamentalmente l'identità client visualizzata dal server è l'identità associata al proxy.</span><span class="sxs-lookup"><span data-stu-id="c3822-106">Basically; the client identity that is seen by the server is the identity associated with the proxy.</span></span> <span data-ttu-id="c3822-107">L'identità del proxy è determinata da diversi fattori, uno dei quali è il tipo di mascheramento impostato (se presente).</span><span class="sxs-lookup"><span data-stu-id="c3822-107">The proxy's identity is determined by several factors, one of which is the type of cloaking that is set (if any).</span></span> <span data-ttu-id="c3822-108">Il cloaking non è supportato dal provider di sicurezza Schannel.</span><span class="sxs-lookup"><span data-stu-id="c3822-108">Cloaking is not supported by the Schannel security provider.</span></span>

<span data-ttu-id="c3822-109">Negli argomenti seguenti vengono fornite ulteriori informazioni sul mascheramento:</span><span class="sxs-lookup"><span data-stu-id="c3822-109">The following topics provide more information about cloaking:</span></span>

-   [<span data-ttu-id="c3822-110">Tipi di mascheramento</span><span class="sxs-lookup"><span data-stu-id="c3822-110">Types of Cloaking</span></span>](#types-of-cloaking)
-   [<span data-ttu-id="c3822-111">Effetti della mascheramento sull'identità client</span><span class="sxs-lookup"><span data-stu-id="c3822-111">How Cloaking Affects Client Identity</span></span>](#how-cloaking-affects-client-identity)
-   [<span data-ttu-id="c3822-112">Impostazione mascheramento</span><span class="sxs-lookup"><span data-stu-id="c3822-112">Setting Cloaking</span></span>](#setting-cloaking)
-   [<span data-ttu-id="c3822-113">Mascheramento e livelli di rappresentazione</span><span class="sxs-lookup"><span data-stu-id="c3822-113">Cloaking and Impersonation Levels</span></span>](#cloaking-and-impersonation-levels)
-   [<span data-ttu-id="c3822-114">Scenari di mascheramento</span><span class="sxs-lookup"><span data-stu-id="c3822-114">Cloaking Scenarios</span></span>](#cloaking-scenarios)
-   [<span data-ttu-id="c3822-115">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="c3822-115">Related topics</span></span>](#related-topics)

## <a name="types-of-cloaking"></a><span data-ttu-id="c3822-116">Tipi di mascheramento</span><span class="sxs-lookup"><span data-stu-id="c3822-116">Types of Cloaking</span></span>

<span data-ttu-id="c3822-117">Esistono due tipi di mascheramento: mascheramento *statico* e mascheramento *dinamico* :</span><span class="sxs-lookup"><span data-stu-id="c3822-117">There are two types of cloaking: *static* cloaking and *dynamic* cloaking:</span></span>

-   <span data-ttu-id="c3822-118">Con il cloaking statico ( \_ \_ mascheramento statico EOAC), il server Visualizza il token del thread dalla prima chiamata da un client al server.</span><span class="sxs-lookup"><span data-stu-id="c3822-118">With static cloaking (EOAC\_STATIC\_CLOAKING), the server sees the thread token from the first call from a client to the server.</span></span> <span data-ttu-id="c3822-119">Per la prima chiamata, se l'identità del proxy è stata impostata in precedenza durante una chiamata a [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket), viene utilizzata l'identità del proxy.</span><span class="sxs-lookup"><span data-stu-id="c3822-119">For the first call, if the proxy identity was previously set during a call to [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket), that proxy identity is used.</span></span> <span data-ttu-id="c3822-120">Tuttavia, se l'identità del proxy non è stata impostata in precedenza, viene utilizzato il token del thread.</span><span class="sxs-lookup"><span data-stu-id="c3822-120">However, if the proxy identity was not previously set, the thread token is used.</span></span> <span data-ttu-id="c3822-121">Se non è presente alcun token del thread, viene utilizzato il token di processo.</span><span class="sxs-lookup"><span data-stu-id="c3822-121">If no thread token is present, the process token is used.</span></span> <span data-ttu-id="c3822-122">Per tutte le chiamate future, viene utilizzata l'identità impostata nella prima chiamata.</span><span class="sxs-lookup"><span data-stu-id="c3822-122">For all future calls, the identity set on the first call is used.</span></span>
-   <span data-ttu-id="c3822-123">Con il mascheramento dinamico (EOAC \_ Dynamic \_ cloaking), a ogni chiamata il token del thread corrente (se è presente un token del thread) viene usato per determinare l'identità del client.</span><span class="sxs-lookup"><span data-stu-id="c3822-123">With dynamic cloaking (EOAC\_DYNAMIC\_CLOAKING), on each call the current thread token (if there is a thread token) is used to determine the client's identity.</span></span> <span data-ttu-id="c3822-124">Se non è presente alcun token del thread, viene utilizzato il token di processo.</span><span class="sxs-lookup"><span data-stu-id="c3822-124">If there is no thread token, the process token is used.</span></span> <span data-ttu-id="c3822-125">Ciò significa che i server chiamati per conto del client durante la rappresentazione visualizzano l'identità del client COM che ha originato la chiamata, che corrisponde in genere al comportamento desiderato.</span><span class="sxs-lookup"><span data-stu-id="c3822-125">This means that servers called on the client's behalf during impersonation see the identity of the COM client that originated the call, which is generally the desired behavior.</span></span> <span data-ttu-id="c3822-126">Naturalmente, affinché la rappresentazione abbia esito positivo, il client deve avere dato all'autorità del server la rappresentazione impostando un livello di rappresentazione appropriato.</span><span class="sxs-lookup"><span data-stu-id="c3822-126">(Of course, for impersonation to succeed, the client must have given the server authority to impersonate by setting an appropriate impersonation level.</span></span> <span data-ttu-id="c3822-127">Per ulteriori informazioni, vedere [livelli di rappresentazione](impersonation-levels.md). Questo tipo di mascheramento è costoso.</span><span class="sxs-lookup"><span data-stu-id="c3822-127">For more information, see [Impersonation Levels](impersonation-levels.md).) This type of cloaking is expensive.</span></span>

## <a name="how-cloaking-affects-client-identity"></a><span data-ttu-id="c3822-128">Effetti della mascheramento sull'identità client</span><span class="sxs-lookup"><span data-stu-id="c3822-128">How Cloaking Affects Client Identity</span></span>

<span data-ttu-id="c3822-129">Quando viene eseguita una chiamata crittografata e il server richiede al client la relativa identità, in genere ottiene l'identità associata al proxy.</span><span class="sxs-lookup"><span data-stu-id="c3822-129">When an encrypted call is made and the server asks the client for its identity, it usually gets the identity tied to the proxy.</span></span> <span data-ttu-id="c3822-130">(A volte il servizio di autenticazione esegue una traduzione dall'identità reale, ma in genere l'identità del proxy è l'identità visualizzata dal server). Il proxy presenta un'identità al server che dipende dal tipo di mascheramento impostato e da altri fattori.</span><span class="sxs-lookup"><span data-stu-id="c3822-130">(Sometimes the authentication service performs a translation from the real identity, but generally the proxy identity is the identity the server sees.) The proxy presents an identity to the server that depends on the type of cloaking that is set and other factors.</span></span>

<span data-ttu-id="c3822-131">Per riepilogare, l'identità del client è una funzione del flag di mascheramento impostato, il token di processo, la presenza o l'assenza di un token del thread e se l'identità del proxy è stata impostata in precedenza.</span><span class="sxs-lookup"><span data-stu-id="c3822-131">To summarize, the identity of the client is a function of the cloaking flag set, the process token, the presence or absence of a thread token, and whether the proxy identity has been previously set.</span></span> <span data-ttu-id="c3822-132">La tabella seguente illustra l'identità del proxy risultante (identità client) quando questi fattori variano.</span><span class="sxs-lookup"><span data-stu-id="c3822-132">The following table shows the resulting proxy identity (client identity) when these factors vary.</span></span>



| <span data-ttu-id="c3822-133">Flag di mascheramento</span><span class="sxs-lookup"><span data-stu-id="c3822-133">Cloaking Flags</span></span>                     | <span data-ttu-id="c3822-134">Presenza token di thread</span><span class="sxs-lookup"><span data-stu-id="c3822-134">Thread Token Presence</span></span>  | <span data-ttu-id="c3822-135">Identità del proxy impostata in precedenza</span><span class="sxs-lookup"><span data-stu-id="c3822-135">Proxy Identity Previously Set</span></span> | <span data-ttu-id="c3822-136">Identità proxy (identità client)</span><span class="sxs-lookup"><span data-stu-id="c3822-136">Proxy Identity (Client Identity)</span></span>                    |
|------------------------------------|------------------------|-------------------------------|-----------------------------------------------------|
| <span data-ttu-id="c3822-137">Mascheramento non impostato</span><span class="sxs-lookup"><span data-stu-id="c3822-137">Cloaking not set</span></span><br/>        | <span data-ttu-id="c3822-138">Non importa</span><span class="sxs-lookup"><span data-stu-id="c3822-138">Don't care</span></span><br/>  | <span data-ttu-id="c3822-139">Non importa</span><span class="sxs-lookup"><span data-stu-id="c3822-139">Don't care</span></span><br/>         | <span data-ttu-id="c3822-140">Token di processo o identità di autenticazione</span><span class="sxs-lookup"><span data-stu-id="c3822-140">Process token or authentication identity</span></span><br/> |
| <span data-ttu-id="c3822-141">\_ \_ mascheramento statico EOAC</span><span class="sxs-lookup"><span data-stu-id="c3822-141">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="c3822-142">Presente</span><span class="sxs-lookup"><span data-stu-id="c3822-142">Present</span></span><br/>     | <span data-ttu-id="c3822-143">No</span><span class="sxs-lookup"><span data-stu-id="c3822-143">No</span></span><br/>                 | <span data-ttu-id="c3822-144">Token del thread</span><span class="sxs-lookup"><span data-stu-id="c3822-144">Thread token</span></span><br/>                             |
| <span data-ttu-id="c3822-145">\_ \_ mascheramento statico EOAC</span><span class="sxs-lookup"><span data-stu-id="c3822-145">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="c3822-146">Presente</span><span class="sxs-lookup"><span data-stu-id="c3822-146">Present</span></span><br/>     | <span data-ttu-id="c3822-147">Sì</span><span class="sxs-lookup"><span data-stu-id="c3822-147">Yes</span></span><br/>                | <span data-ttu-id="c3822-148">Identità del proxy corrente</span><span class="sxs-lookup"><span data-stu-id="c3822-148">Current proxy identity</span></span><br/>                   |
| <span data-ttu-id="c3822-149">\_ \_ mascheramento statico EOAC</span><span class="sxs-lookup"><span data-stu-id="c3822-149">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="c3822-150">Non presente</span><span class="sxs-lookup"><span data-stu-id="c3822-150">Not present</span></span><br/> | <span data-ttu-id="c3822-151">No</span><span class="sxs-lookup"><span data-stu-id="c3822-151">No</span></span><br/>                 | <span data-ttu-id="c3822-152">Token di processo</span><span class="sxs-lookup"><span data-stu-id="c3822-152">Process token</span></span><br/>                            |
| <span data-ttu-id="c3822-153">\_ \_ mascheramento statico EOAC</span><span class="sxs-lookup"><span data-stu-id="c3822-153">EOAC\_STATIC\_CLOAKING</span></span><br/>  | <span data-ttu-id="c3822-154">Non presente</span><span class="sxs-lookup"><span data-stu-id="c3822-154">Not present</span></span><br/> | <span data-ttu-id="c3822-155">Sì</span><span class="sxs-lookup"><span data-stu-id="c3822-155">Yes</span></span><br/>                | <span data-ttu-id="c3822-156">Identità del proxy corrente</span><span class="sxs-lookup"><span data-stu-id="c3822-156">Current proxy identity</span></span><br/>                   |
| <span data-ttu-id="c3822-157">\_ \_ mascheramento dinamico EOAC</span><span class="sxs-lookup"><span data-stu-id="c3822-157">EOAC\_DYNAMIC\_CLOAKING</span></span><br/> | <span data-ttu-id="c3822-158">Presente</span><span class="sxs-lookup"><span data-stu-id="c3822-158">Present</span></span><br/>     | <span data-ttu-id="c3822-159">Non importa</span><span class="sxs-lookup"><span data-stu-id="c3822-159">Don't care</span></span><br/>         | <span data-ttu-id="c3822-160">Token del thread</span><span class="sxs-lookup"><span data-stu-id="c3822-160">Thread token</span></span><br/>                             |
| <span data-ttu-id="c3822-161">\_ \_ mascheramento dinamico EOAC</span><span class="sxs-lookup"><span data-stu-id="c3822-161">EOAC\_DYNAMIC\_CLOAKING</span></span><br/> | <span data-ttu-id="c3822-162">Non presente</span><span class="sxs-lookup"><span data-stu-id="c3822-162">Not present</span></span><br/> | <span data-ttu-id="c3822-163">Non importa</span><span class="sxs-lookup"><span data-stu-id="c3822-163">Don't care</span></span> <br/>        | <span data-ttu-id="c3822-164">Token di processo</span><span class="sxs-lookup"><span data-stu-id="c3822-164">Process token</span></span><br/>                            |



 

<span data-ttu-id="c3822-165">Il diagramma di flusso seguente illustra come viene determinata l'identità del proxy in situazioni diverse.</span><span class="sxs-lookup"><span data-stu-id="c3822-165">The following flowchart illustrates how the proxy identity is determined in different situations.</span></span>

![Diagramma che mostra il flusso per determinare l'identità del proxy.](images/9e8409b7-8475-4824-bdff-cf6b09c139c5.png)

## <a name="setting-cloaking"></a><span data-ttu-id="c3822-167">Impostazione mascheramento</span><span class="sxs-lookup"><span data-stu-id="c3822-167">Setting Cloaking</span></span>

<span data-ttu-id="c3822-168">Il cloaking viene impostato come flag di funzionalità in una chiamata a [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), che imposta il mascheramento per l'intero processo.</span><span class="sxs-lookup"><span data-stu-id="c3822-168">Cloaking is set as a capability flag in a call to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), which sets cloaking for the entire process.</span></span> <span data-ttu-id="c3822-169">La funzionalità di mascheramento viene quindi impostata fino a quando il client non la modifica tramite una chiamata a IClientSecurity::[**Seblankt**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) (o a [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)), che imposta il mascheramento per il proxy.</span><span class="sxs-lookup"><span data-stu-id="c3822-169">The cloaking capability is then set until the client changes it through a call to IClientSecurity::[**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket) (or to [**CoSetProxyBlanket**](/windows/desktop/api/combaseapi/nf-combaseapi-cosetproxyblanket)), which sets cloaking for the proxy.</span></span>

<span data-ttu-id="c3822-170">Per impostazione predefinita, il mascheramento non è impostato.</span><span class="sxs-lookup"><span data-stu-id="c3822-170">By default, cloaking is not set.</span></span> <span data-ttu-id="c3822-171">Per impostarlo, passare il cloaking \_ statico EOAC \_ o \_ \_ il mascheramento dinamico EOAC al parametro *pCapabilities* in [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) o in un set di elementi. [](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket)</span><span class="sxs-lookup"><span data-stu-id="c3822-171">To set it, pass EOAC\_STATIC\_CLOAKING or EOAC\_DYNAMIC\_CLOAKING to the *pCapabilities* parameter in [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) or [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span></span>

<span data-ttu-id="c3822-172">Quando il mascheramento statico viene abilitato con [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), ogni proxy preleva un token (thread o processo) la prima volta che si effettua una chiamata sul proxy.</span><span class="sxs-lookup"><span data-stu-id="c3822-172">When static cloaking is enabled using [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity), each proxy picks up a token (thread or process) the first time you make a call on the proxy.</span></span> <span data-ttu-id="c3822-173">Quando il mascheramento statico viene abilitato con il [**Seblankt**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket), il proxy preleva il token nel thread in quel momento.</span><span class="sxs-lookup"><span data-stu-id="c3822-173">When static cloaking is enabled using [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket), the proxy picks up the token on the thread at that time.</span></span> <span data-ttu-id="c3822-174">Se non è disponibile alcun token di thread quando viene chiamato il metodo **Seblankt** , il token di processo viene usato per l'identità del proxy.</span><span class="sxs-lookup"><span data-stu-id="c3822-174">If no thread token is available when **SetBlanket** is called, the process token is used for the proxy's identity.</span></span> <span data-ttu-id="c3822-175">In sostanza, il **Seblankt** corregge l'identità del proxy.</span><span class="sxs-lookup"><span data-stu-id="c3822-175">Basically, **SetBlanket** fixes the identity of the proxy.</span></span>

<span data-ttu-id="c3822-176">Con il mascheramento dinamico, l'identità del proxy viene determinata allo stesso modo, indipendentemente dal fatto che il mascheramento dinamico venga impostato utilizzando [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) o con il set di [**celle**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span><span class="sxs-lookup"><span data-stu-id="c3822-176">With dynamic cloaking, the proxy's identity is determined the same way regardless of whether dynamic cloaking is set using [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) or with [**SetBlanket**](/windows/win32/api/objidl/nf-objidl-iclientsecurity-setblanket).</span></span> <span data-ttu-id="c3822-177">Il token del thread corrente viene usato se ne esiste uno; in caso contrario, viene utilizzato il token di processo.</span><span class="sxs-lookup"><span data-stu-id="c3822-177">The current thread token is used if there is one; otherwise, the process token is used.</span></span>

<span data-ttu-id="c3822-178">Se il mascheramento viene impostato per l'intero processo tramite una chiamata a [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) e si desidera effettuare chiamate con il token di processo, non rappresentare durante l'esecuzione delle chiamate.</span><span class="sxs-lookup"><span data-stu-id="c3822-178">If cloaking is set for the entire process through a call to [**CoInitializeSecurity**](/windows/desktop/api/combaseapi/nf-combaseapi-coinitializesecurity) and you want to make calls with the process token, do not impersonate while making calls.</span></span>

## <a name="cloaking-and-impersonation-levels"></a><span data-ttu-id="c3822-179">Mascheramento e livelli di rappresentazione</span><span class="sxs-lookup"><span data-stu-id="c3822-179">Cloaking and Impersonation Levels</span></span>

<span data-ttu-id="c3822-180">Come indicato in precedenza, la funzionalità di mascheramento determina quale identità viene presentata a un server durante la rappresentazione.</span><span class="sxs-lookup"><span data-stu-id="c3822-180">As mentioned previously, the cloaking capability determines what identity is presented to a server during impersonation.</span></span> <span data-ttu-id="c3822-181">Il mascheramento consente a un server di proiettare un'identità diversa da quella relativa a un altro server che chiama per conto del client.</span><span class="sxs-lookup"><span data-stu-id="c3822-181">Cloaking provides a way for a server to project an identity other than its own to another server it is calling on behalf of the client.</span></span> <span data-ttu-id="c3822-182">Il livello di rappresentazione indica la quantità di autorità che il client ha assegnato al server.</span><span class="sxs-lookup"><span data-stu-id="c3822-182">The impersonation level indicates how much authority the client has given the server.</span></span>

<span data-ttu-id="c3822-183">La rappresentazione senza mascheramento funziona, ma potrebbe non essere la scelta migliore perché, in alcuni casi, è necessario che il server finale conosca l'identità del chiamante iniziale.</span><span class="sxs-lookup"><span data-stu-id="c3822-183">Impersonation without cloaking works, but it may not be the best choice because, in some cases, the final server needs to know the identity of the initial caller.</span></span> <span data-ttu-id="c3822-184">Questa operazione non può essere eseguita senza usare il cloaking perché è difficile assicurarsi che solo i client autorizzati possano accedere a un computer remoto.</span><span class="sxs-lookup"><span data-stu-id="c3822-184">This cannot be achieved without using cloaking because it is difficult to ensure that only authorized clients can access a remote computer.</span></span> <span data-ttu-id="c3822-185">Quando si utilizza la rappresentazione senza mascheramento, l'identità presentata a un server downstream è quella del processo chiamante immediato.</span><span class="sxs-lookup"><span data-stu-id="c3822-185">When impersonation is used without cloaking, the identity presented to a downstream server is that of the immediate calling process.</span></span>

<span data-ttu-id="c3822-186">Tuttavia, il cloaking non è utile senza rappresentazione.</span><span class="sxs-lookup"><span data-stu-id="c3822-186">However, cloaking is not useful without impersonation.</span></span> <span data-ttu-id="c3822-187">Il cloaking è opportuno solo quando il client ha impostato un livello di rappresentazione di rappresenta o delegato.</span><span class="sxs-lookup"><span data-stu-id="c3822-187">Cloaking makes sense only when the client has set an impersonation level of impersonate or delegate.</span></span> <span data-ttu-id="c3822-188">(Con livelli di rappresentazione più bassi, il server non può effettuare chiamate mascherate). Il fatto che il cloaking abbia esito positivo dipende dal numero di limiti del computer incrociato e dal livello di rappresentazione, che indica la quantità di autorità che il server deve agire per conto del client.</span><span class="sxs-lookup"><span data-stu-id="c3822-188">(With lower impersonation levels, the server cannot make cloaked calls.) Whether cloaking is successful depends on the number of computer boundaries crossed and on the impersonation level, which indicates how much authority the server has to act on behalf of the client.</span></span>

<span data-ttu-id="c3822-189">In alcune situazioni, è opportuno che il server imposti il mascheramento quando il client imposta il livello di rappresentazione sul livello di rappresentazione del livello di rappresentazione C di RPC \_ \_ \_ \_ .</span><span class="sxs-lookup"><span data-stu-id="c3822-189">In some situations, it makes sense for the server to set cloaking when the client sets the impersonation level to RPC\_C\_IMP\_LEVEL\_IMPERSONATE.</span></span> <span data-ttu-id="c3822-190">Tuttavia, sono valide alcune limitazioni.</span><span class="sxs-lookup"><span data-stu-id="c3822-190">However, certain limitations are in effect.</span></span> <span data-ttu-id="c3822-191">Se il client originale imposta il livello di rappresentazione su rappresentazione a \_ livello di RPC C \_ Imp \_ \_ , il server intermedio (che funge da client nello stesso computer) può mascherare in un solo limite di computer.</span><span class="sxs-lookup"><span data-stu-id="c3822-191">If the original client sets the impersonation level to RPC\_C\_IMP\_LEVEL\_IMPERSONATE, the intermediate server (acting as a client on the same computer) can cloak across only one computer boundary.</span></span> <span data-ttu-id="c3822-192">Ciò è dovuto al fatto che un token di rappresentazione a livello di rappresentazione può essere passato attraverso un solo limite del computer.</span><span class="sxs-lookup"><span data-stu-id="c3822-192">This is because an impersonate-level impersonation token can be passed across only one computer boundary.</span></span> <span data-ttu-id="c3822-193">Una volta superato il limite del computer, è possibile accedere solo alle risorse locali.</span><span class="sxs-lookup"><span data-stu-id="c3822-193">After the computer boundary has been crossed, only local resources can be accessed.</span></span> <span data-ttu-id="c3822-194">L'identità presentata al server dipende dal tipo di mascheramento impostato.</span><span class="sxs-lookup"><span data-stu-id="c3822-194">The identity presented to the server depends on the type of cloaking that is set.</span></span> <span data-ttu-id="c3822-195">Se non è impostato alcun mascheramento, l'identità presentata a un server sarà quella del processo che effettua la chiamata immediata.</span><span class="sxs-lookup"><span data-stu-id="c3822-195">If no cloaking is set, the identity presented to a server will be that of the process making the immediate call.</span></span>

<span data-ttu-id="c3822-196">Per mascherare i limiti di più computer, è necessario specificare sia un flag di funzionalità di mascheramento appropriato che una rappresentazione a livello di delegato.</span><span class="sxs-lookup"><span data-stu-id="c3822-196">To cloak over multiple computer boundaries, you must specify both an appropriate cloaking capability flag and delegate-level impersonation.</span></span> <span data-ttu-id="c3822-197">Con questo tipo di rappresentazione, le credenziali locali e di rete del client vengono assegnate al server, pertanto il token di rappresentazione può superare un numero qualsiasi di limiti del computer.</span><span class="sxs-lookup"><span data-stu-id="c3822-197">With this type of impersonation, both the local and network credentials of the client are given to the server, so the impersonation token can cross any number of computer boundaries.</span></span> <span data-ttu-id="c3822-198">Anche in questo caso, l'identità presentata al server dipende dal tipo di mascheramento impostato.</span><span class="sxs-lookup"><span data-stu-id="c3822-198">Again, the identity presented to the server depends on the type of cloaking that is set.</span></span> <span data-ttu-id="c3822-199">Se non è impostato alcun mascheramento con rappresentazione a livello di delegato, l'identità presentata a un server è quella del processo che effettua la chiamata.</span><span class="sxs-lookup"><span data-stu-id="c3822-199">If no cloaking is set with delegate-level impersonation, the identity presented to a server is that of the process making the call.</span></span>

<span data-ttu-id="c3822-200">Si supponga, ad esempio, che l'elaborazione di una chiamata a B e che B chiami C. B abbia impostato il mascheramento e che il livello di rappresentazione sia impostato su Impersonate.</span><span class="sxs-lookup"><span data-stu-id="c3822-200">For example, suppose Process A calls B, and B calls C. B has set cloaking and A has set the impersonation level to impersonate.</span></span> <span data-ttu-id="c3822-201">Se A, B e C si trovano nello stesso computer, passando il token di rappresentazione da a a B e quindi a C funzionerà.</span><span class="sxs-lookup"><span data-stu-id="c3822-201">If A, B, and C are on the same computer, passing the impersonation token from A to B and then to C will work.</span></span> <span data-ttu-id="c3822-202">Tuttavia, se A e C si trovano nello stesso computer e B non lo è, il passaggio del token funzionerà tra A e B, ma non da B a C. La chiamata da B a C avrà esito negativo perché B non è in grado di chiamare C durante il mascheramento.</span><span class="sxs-lookup"><span data-stu-id="c3822-202">But if A and C are on the same computer, and B is not, passing the token will work between A and B, but not from B to C. The call from B to C will fail because B cannot call C while cloaking.</span></span> <span data-ttu-id="c3822-203">Tuttavia, se un oggetto imposta il livello di rappresentazione su Delegate, il token può essere passato da B a C e la chiamata potrebbe avere esito positivo.</span><span class="sxs-lookup"><span data-stu-id="c3822-203">However, if A sets the impersonation level to delegate, the token can be passed from B to C and the call may succeed.</span></span>

## <a name="cloaking-scenarios"></a><span data-ttu-id="c3822-204">Scenari di mascheramento</span><span class="sxs-lookup"><span data-stu-id="c3822-204">Cloaking Scenarios</span></span>

<span data-ttu-id="c3822-205">Nella figura seguente, Process A calls B, chiama C, chiama D quando il mascheramento non è impostato.</span><span class="sxs-lookup"><span data-stu-id="c3822-205">In the following illustration, Process A calls B, calls C, calls D when cloaking is not set.</span></span> <span data-ttu-id="c3822-206">Di conseguenza, ogni processo intermedio rileva l'identità del processo che lo ha chiamato.</span><span class="sxs-lookup"><span data-stu-id="c3822-206">As a result, each intermediate process sees the identity of the process that called it.</span></span>

![Diagramma che mostra il processo quando il mascheramento non è impostato.](images/0d2eb6cf-97d6-4c4e-b97e-abad854b1120.png)

<span data-ttu-id="c3822-208">Con il mascheramento statico, il server Visualizza l'identità del proxy impostata durante la prima chiamata dal client al server.</span><span class="sxs-lookup"><span data-stu-id="c3822-208">With static cloaking, the server sees the proxy identity that was set during the first call from the client to the server.</span></span> <span data-ttu-id="c3822-209">Nella figura seguente viene illustrato un esempio dell'identità del proxy da impostare durante una chiamata da B a C. In una chiamata successiva il processo D rileva l'identità di B quando il mascheramento statico viene impostato da B e C.</span><span class="sxs-lookup"><span data-stu-id="c3822-209">The following figure shows an example of the proxy identity being set during a call from B to C. On a subsequent call, Process D sees B's identity when static cloaking is set by B and C.</span></span>

![Diagramma che illustra il processo di mascheramento statico.](images/520938e0-c4a6-4ac1-937d-02baf2007a27.png)

<span data-ttu-id="c3822-211">Con il mascheramento dinamico, l'identità del chiamante durante la rappresentazione è basata sul token del thread corrente, se presente.</span><span class="sxs-lookup"><span data-stu-id="c3822-211">With dynamic cloaking, the identity of the caller during impersonation is based on the current thread token, if there is one.</span></span> <span data-ttu-id="c3822-212">Nella figura seguente viene illustrata la situazione in cui B e C impostano il mascheramento dinamico e D Visualizza l'identità di un, nonostante una chiamata precedente da B a C.</span><span class="sxs-lookup"><span data-stu-id="c3822-212">The following illustration shows the situation where B and C set dynamic cloaking and D sees the identity of A, despite an earlier call from B to C.</span></span>

![Diagramma che illustra il processo di mascheramento dinamico.](images/d0848465-82f3-4d5a-851e-566d7800ada0.png)

## <a name="related-topics"></a><span data-ttu-id="c3822-214">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="c3822-214">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="c3822-215">Delega e rappresentazione</span><span class="sxs-lookup"><span data-stu-id="c3822-215">Delegation and Impersonation</span></span>](delegation-and-impersonation.md)
</dt> </dl>

 

