---
title: Dettagli del marshalling
description: Se si usa il marshalling standard, COM gestisce tutti i dettagli descritti qui.
ms.assetid: bf3fe212-648e-4d00-ad1d-43d2e5e6a7ae
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: f4d0fd46ee29c712c6f2b5b286df76a30f1047e6
ms.sourcegitcommit: d39e82e232f6510f843fdb8d55d25b4e9e02e880
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/03/2021
ms.locfileid: "106320191"
---
# <a name="marshaling-details"></a><span data-ttu-id="b0206-103">Dettagli del marshalling</span><span class="sxs-lookup"><span data-stu-id="b0206-103">Marshaling Details</span></span>

<span data-ttu-id="b0206-104">Se si usa il marshalling standard, COM gestisce tutti i dettagli descritti qui.</span><span class="sxs-lookup"><span data-stu-id="b0206-104">If you use standard marshaling, COM handles all of the details described here for you.</span></span> <span data-ttu-id="b0206-105">Tuttavia, esistono pochi programmatori che necessitano di questi dettagli e per coloro che interessano le informazioni sottostanti.</span><span class="sxs-lookup"><span data-stu-id="b0206-105">However, there are those few programmers who need these details and for those interested in the underlying information.</span></span> <span data-ttu-id="b0206-106">Il marshalling è il processo di creazione di pacchetti e di annullamento del packaging dei parametri, in modo che possa essere eseguita una chiamata di procedura remota.</span><span class="sxs-lookup"><span data-stu-id="b0206-106">Marshaling is the process of packaging and unpackaging parameters so a remote procedure call can take place.</span></span>

<span data-ttu-id="b0206-107">Viene eseguito il marshalling di tipi di parametro diversi in modi diversi.</span><span class="sxs-lookup"><span data-stu-id="b0206-107">Different parameter types are marshaled in different ways.</span></span> <span data-ttu-id="b0206-108">Ad esempio, il marshalling di un parametro integer comporta semplicemente la copia del valore nel buffer dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="b0206-108">For example, marshaling an integer parameter involves simply copying the value into the message buffer.</span></span> <span data-ttu-id="b0206-109">Sebbene anche in questo caso semplice, si verificano problemi, ad esempio l'ordine dei byte, per gestire le chiamate tra computer. Il marshalling di una matrice, tuttavia, è un processo più complesso.</span><span class="sxs-lookup"><span data-stu-id="b0206-109">(Although even in this simple case, there are issues such as byte ordering to deal with in cross-computer calls.) Marshaling an array, however, is a more complex process.</span></span> <span data-ttu-id="b0206-110">I membri della matrice vengono copiati in un ordine specifico, in modo che l'altro possa ricostruire esattamente la matrice.</span><span class="sxs-lookup"><span data-stu-id="b0206-110">Array members are copied in a specific order so that the other side can reconstruct the array exactly.</span></span> <span data-ttu-id="b0206-111">Quando viene effettuato il marshalling di un puntatore, i dati a cui punta il puntatore vengono copiati seguendo le regole e le convenzioni per gestire i puntatori annidati nelle strutture.</span><span class="sxs-lookup"><span data-stu-id="b0206-111">When a pointer is marshaled, the data that the pointer is pointing to is copied following rules and conventions for dealing with nested pointers in structures.</span></span> <span data-ttu-id="b0206-112">Sono disponibili funzioni univoche per gestire il marshalling di ogni tipo di parametro.</span><span class="sxs-lookup"><span data-stu-id="b0206-112">Unique functions exist to handle the marshaling of each parameter type.</span></span>

<span data-ttu-id="b0206-113">Con il marshalling standard, i proxy e gli stub sono risorse a livello per l'interfaccia e interagiscono con il canale tramite un protocollo standard.</span><span class="sxs-lookup"><span data-stu-id="b0206-113">With standard marshaling, the proxies and stubs are systemwide resources for the interface and they interact with the channel through a standard protocol.</span></span> <span data-ttu-id="b0206-114">Il marshalling standard può essere usato sia dalle interfacce standard definite da COM che dalle interfacce personalizzate, come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="b0206-114">Standard marshaling can be used both by standard COM-defined interfaces and by custom interfaces, as follows:</span></span>

-   <span data-ttu-id="b0206-115">Nel caso della maggior parte delle interfacce COM, i proxy e gli stub per il marshalling standard sono oggetti componente in-process che vengono caricati da una DLL a livello fornita da COM in Ole32.dll.</span><span class="sxs-lookup"><span data-stu-id="b0206-115">In the case of most COM interfaces, the proxies and stubs for standard marshaling are in-process component objects which are loaded from a systemwide DLL provided by COM in Ole32.dll.</span></span>
-   <span data-ttu-id="b0206-116">Nel caso di interfacce personalizzate, i proxy e gli stub per il marshalling standard vengono generati da Interface Designer, in genere con MIDL.</span><span class="sxs-lookup"><span data-stu-id="b0206-116">In the case of custom interfaces, the proxies and stubs for standard marshaling are generated by the interface designer, typically with MIDL.</span></span> <span data-ttu-id="b0206-117">Questi proxy e stub sono configurati in modo statico nel registro di sistema, pertanto tutti i potenziali client possono usare l'interfaccia personalizzata tra i limiti dei processi.</span><span class="sxs-lookup"><span data-stu-id="b0206-117">These proxies and stubs are statically configured in the registry, so any potential client can use the custom interface across process boundaries.</span></span> <span data-ttu-id="b0206-118">Questi proxy e stub vengono caricati da una DLL che si trova tramite il registro di sistema, usando l'ID di interfaccia (IID) per l'interfaccia personalizzata di cui eseguono il marshalling.</span><span class="sxs-lookup"><span data-stu-id="b0206-118">These proxies and stubs are loaded from a DLL that is located via the system registry, using the interface ID (IID) for the custom interface they marshal.</span></span>
-   <span data-ttu-id="b0206-119">Alternativa all'uso di MIDL per generare proxy e stub per le interfacce personalizzate, è possibile generare una libreria dei tipi e il sistema fornito, Type-libraryâ € "il motore di marshalling guidato effettuerà il marshalling dell'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="b0206-119">An alternative to using MIDL to generate proxies and stubs for custom interfaces, a type library can be generated instead and the system provided, type-libraryâ€“driven marshaling engine will marshal the interface.</span></span>

<span data-ttu-id="b0206-120">In alternativa al marshalling standard, un'interfaccia (standard o personalizzata) può usare il marshalling personalizzato.</span><span class="sxs-lookup"><span data-stu-id="b0206-120">As an alternative to standard marshaling, an interface (standard or custom) can use custom marshaling.</span></span> <span data-ttu-id="b0206-121">Con il marshalling personalizzato, un oggetto implementa dinamicamente i proxy in fase di esecuzione per ogni interfaccia supportata.</span><span class="sxs-lookup"><span data-stu-id="b0206-121">With custom marshaling, an object dynamically implements the proxies at run time for each interface that it supports.</span></span> <span data-ttu-id="b0206-122">Per una determinata interfaccia, l'oggetto può selezionare il marshalling standard fornito da COM o il marshalling personalizzato.</span><span class="sxs-lookup"><span data-stu-id="b0206-122">For any given interface, the object can select COM-provided standard marshaling or custom marshaling.</span></span> <span data-ttu-id="b0206-123">Questa scelta viene effettuata dall'oggetto in base all'interfaccia.</span><span class="sxs-lookup"><span data-stu-id="b0206-123">This choice is made by the object on an interface-by-interface basis.</span></span> <span data-ttu-id="b0206-124">Una volta effettuata la scelta per una determinata interfaccia, rimane attivo durante la durata dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="b0206-124">Once the choice is made for a given interface, it remains in effect during the object's lifetime.</span></span> <span data-ttu-id="b0206-125">Tuttavia, un'interfaccia su un oggetto può usare il marshalling personalizzato mentre un altro usa il marshalling standard.</span><span class="sxs-lookup"><span data-stu-id="b0206-125">However, one interface on an object can use custom marshaling while another uses standard marshaling.</span></span>

<span data-ttu-id="b0206-126">Il marshalling personalizzato è intrinsecamente univoco all'oggetto che lo implementa.</span><span class="sxs-lookup"><span data-stu-id="b0206-126">Custom marshaling is inherently unique to the object that implements it.</span></span> <span data-ttu-id="b0206-127">USA i proxy implementati dall'oggetto e forniti al sistema su richiesta in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="b0206-127">It uses proxies implemented by the object and provided to the system on request at run time.</span></span> <span data-ttu-id="b0206-128">Gli oggetti che implementano il marshalling personalizzato devono implementare l'interfaccia [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) , mentre gli oggetti che supportano il marshalling standard non lo supportano.</span><span class="sxs-lookup"><span data-stu-id="b0206-128">Objects that implement custom marshaling must implement the [**IMarshal**](/windows/win32/api/objidlbase/nn-objidlbase-imarshal) interface, whereas objects that support standard marshaling do not.</span></span>

<span data-ttu-id="b0206-129">Se si decide di scrivere un'interfaccia personalizzata, è necessario fornire supporto per il marshalling.</span><span class="sxs-lookup"><span data-stu-id="b0206-129">If you decide to write a custom interface, you must provide marshaling support for it.</span></span> <span data-ttu-id="b0206-130">In genere, si fornirà una DLL di marshalling standard per l'interfaccia progettata.</span><span class="sxs-lookup"><span data-stu-id="b0206-130">Typically, you will provide a standard marshaling DLL for the interface you design.</span></span> <span data-ttu-id="b0206-131">È possibile creare il codice proxy/stub e la DLL proxy/stub oppure creare una libreria dei tipi che COM userà per eseguire il marshalling basato sui dati (usando i dati nella libreria dei tipi).</span><span class="sxs-lookup"><span data-stu-id="b0206-131">You can create the proxy/stub code and the proxy/stub DLL, or you can create a type library that COM will use to do data-driven marshaling (using the data in the type library).</span></span>

<span data-ttu-id="b0206-132">Affinché un client effettui una chiamata a un metodo di interfaccia in un oggetto in un altro processo, comporta la collaborazione di diversi componenti.</span><span class="sxs-lookup"><span data-stu-id="b0206-132">For a client to make a call to an interface method in an object in another process involves the cooperation of several components.</span></span> <span data-ttu-id="b0206-133">Il proxy standard è un frammento di codice specifico dell'interfaccia che risiede nello spazio di elaborazione del client e prepara i parametri dell'interfaccia per la trasmissione.</span><span class="sxs-lookup"><span data-stu-id="b0206-133">The standard proxy is a piece of interface-specific code that resides in the client's process space and prepares the interface parameters for transmittal.</span></span> <span data-ttu-id="b0206-134">I pacchetti o i marshalling, in modo che possano essere ricreati e interpretati nel processo di ricezione.</span><span class="sxs-lookup"><span data-stu-id="b0206-134">It packages, or marshals, them in such a way that they can be re-created and understood in the receiving process.</span></span> <span data-ttu-id="b0206-135">Lo stub standard, anche un componente di codice specifico dell'interfaccia, risiede nello spazio di elaborazione del server e inverte il lavoro del proxy.</span><span class="sxs-lookup"><span data-stu-id="b0206-135">The standard stub, also a piece of interface-specific code, resides in the server's process space and reverses the work of the proxy.</span></span> <span data-ttu-id="b0206-136">Lo stub esegue il decollo o l'unmarshalling dei parametri inviati e li inoltra all'applicazione dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="b0206-136">The stub unpackages, or unmarshals, the sent parameters and forwards them to the object application.</span></span> <span data-ttu-id="b0206-137">Consente inoltre di inserire le informazioni di risposta per inviare nuovamente al client.</span><span class="sxs-lookup"><span data-stu-id="b0206-137">It also packages reply information to send back to the client.</span></span>

> [!Note]  
> <span data-ttu-id="b0206-138">I lettori che hanno familiarità con RPC rispetto a COM possono essere usati per visualizzare i termini stub client e stub server.</span><span class="sxs-lookup"><span data-stu-id="b0206-138">Readers more familiar with RPC than COM may be used to seeing the terms client stub and server stub.</span></span> <span data-ttu-id="b0206-139">Questi termini sono analoghi a proxy e stub.</span><span class="sxs-lookup"><span data-stu-id="b0206-139">These terms are analogous to proxy and stub.</span></span>

 

## <a name="components-of-interprocess-communications"></a><span data-ttu-id="b0206-140">Componenti delle comunicazioni interprocesso</span><span class="sxs-lookup"><span data-stu-id="b0206-140">Components of Interprocess Communications</span></span>

<span data-ttu-id="b0206-141">Il diagramma seguente illustra il flusso di comunicazione tra i componenti necessari.</span><span class="sxs-lookup"><span data-stu-id="b0206-141">The following diagram shows the flow of communication between the components involved.</span></span> <span data-ttu-id="b0206-142">Sul lato client del limite del processo, la chiamata al metodo del client passa attraverso il proxy e quindi sul canale, che fa parte della libreria COM.</span><span class="sxs-lookup"><span data-stu-id="b0206-142">On the client side of the process boundary, the client's method call goes through the proxy and then onto the channel, which is part of the COM library.</span></span> <span data-ttu-id="b0206-143">Il canale invia il buffer contenente i parametri di cui è stato effettuato il marshalling alla libreria di runtime RPC, che lo trasmette attraverso il limite del processo.</span><span class="sxs-lookup"><span data-stu-id="b0206-143">The channel sends the buffer containing the marshaled parameters to the RPC run-time library, which transmits it across the process boundary.</span></span> <span data-ttu-id="b0206-144">Il runtime RPC e le librerie COM sono disponibili su entrambi i lati del processo.</span><span class="sxs-lookup"><span data-stu-id="b0206-144">The RPC run time and the COM libraries exist on both sides of the process.</span></span> <span data-ttu-id="b0206-145">La distinzione tra il canale e il tempo di esecuzione RPC è una caratteristica di questa implementazione e non fa parte del modello di programmazione o del modello concettuale per gli oggetti client/server COM.</span><span class="sxs-lookup"><span data-stu-id="b0206-145">The distinction between the channel and the RPC run time is a characteristic of this implementation and is not part of the programming model or the conceptual model for COM client/server objects.</span></span> <span data-ttu-id="b0206-146">I server COM visualizzano solo il proxy o lo stub e, indirettamente, il canale.</span><span class="sxs-lookup"><span data-stu-id="b0206-146">COM servers see only the proxy or stub and, indirectly, the channel.</span></span> <span data-ttu-id="b0206-147">Le implementazioni future possono usare livelli diversi sotto il canale o nessun livello.</span><span class="sxs-lookup"><span data-stu-id="b0206-147">Future implementations may use different layers below the channel or no layers.</span></span>

![Diagramma che mostra i flussi di Client.exe e Server.exe su ogni lato per il limite del processo.](images/457036c1-98b8-4f35-aebe-70de38112b83.png)

## <a name="related-topics"></a><span data-ttu-id="b0206-149">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="b0206-149">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="b0206-150">Channel</span><span class="sxs-lookup"><span data-stu-id="b0206-150">Channel</span></span>](channel.md)
</dt> <dt>

[<span data-ttu-id="b0206-151">Comunicazione tra oggetti</span><span class="sxs-lookup"><span data-stu-id="b0206-151">Inter-Object Communication</span></span>](inter-object-communication.md)
</dt> <dt>

[<span data-ttu-id="b0206-152">RPC Microsoft</span><span class="sxs-lookup"><span data-stu-id="b0206-152">Microsoft RPC</span></span>](microsoft-rpc.md)
</dt> <dt>

[<span data-ttu-id="b0206-153">Proxy</span><span class="sxs-lookup"><span data-stu-id="b0206-153">Proxy</span></span>](proxy.md)
</dt> <dt>

[<span data-ttu-id="b0206-154">Stub</span><span class="sxs-lookup"><span data-stu-id="b0206-154">Stub</span></span>](stub.md)
</dt> </dl>

 

 