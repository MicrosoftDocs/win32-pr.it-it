---
title: Gestione degli oggetti
description: Questa sezione illustra l'uso corretto dei tipi di oggetto API della piattaforma filtro Windows (WFP).
ms.assetid: 2625ef9a-0e62-4e21-ba93-047965d0d782
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: dc41560bb85a7e79c0262d77c0b34fe6c1d9bfd6
ms.sourcegitcommit: ebd3ce6908ff865f1ef66f2fc96769be0aad82e1
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 08/19/2020
ms.locfileid: "104472907"
---
# <a name="object-management"></a><span data-ttu-id="4c92d-103">Gestione degli oggetti</span><span class="sxs-lookup"><span data-stu-id="4c92d-103">Object Management</span></span>

<span data-ttu-id="4c92d-104">Questa sezione illustra l'uso corretto dei tipi di oggetto API della piattaforma filtro Windows (WFP).</span><span class="sxs-lookup"><span data-stu-id="4c92d-104">This section covers the correct use of Windows Filtering Platform (WFP) API object types.</span></span>

## <a name="sessions"></a><span data-ttu-id="4c92d-105">Sessioni</span><span class="sxs-lookup"><span data-stu-id="4c92d-105">Sessions</span></span>

<span data-ttu-id="4c92d-106">L'API PAM è orientata alla sessione e la maggior parte delle chiamate di funzione viene eseguita nel contesto di una sessione.</span><span class="sxs-lookup"><span data-stu-id="4c92d-106">The WFP API is session-oriented, and most function calls are made within the context of a session.</span></span> <span data-ttu-id="4c92d-107">Viene creata una nuova sessione client chiamando [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span><span class="sxs-lookup"><span data-stu-id="4c92d-107">A new client session is created by calling [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span></span> <span data-ttu-id="4c92d-108">La sessione termina quando il client chiama [**FwpmEngineClose0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineclose0) o termina il processo client.</span><span class="sxs-lookup"><span data-stu-id="4c92d-108">The session ends either when the client calls [**FwpmEngineClose0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineclose0) or the client process terminates.</span></span> <span data-ttu-id="4c92d-109">Quando una sessione viene distrutta, sia a scopo che tramite il rundown RPC, il motore di filtro di base (BFE) interrompe prima di tutto qualsiasi transazione esistente.</span><span class="sxs-lookup"><span data-stu-id="4c92d-109">When a session is destroyed, either on purpose or by the RPC rundown, the Base Filtering Engine (BFE) first aborts any existing transaction.</span></span>

<span data-ttu-id="4c92d-110">Quando si crea una nuova sessione, il chiamante può creare una sessione dinamica passando il [**flag \_ \_ \_ dinamico del flag di sessione FWPM**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) a [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span><span class="sxs-lookup"><span data-stu-id="4c92d-110">When creating a new session, the caller can create a dynamic session by passing the [**FWPM\_SESSION\_FLAG\_DYNAMIC**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) flag to [**FwpmEngineOpen0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmengineopen0).</span></span> <span data-ttu-id="4c92d-111">Tutti gli oggetti aggiunti durante una sessione dinamica vengono eliminati automaticamente al termine della sessione.</span><span class="sxs-lookup"><span data-stu-id="4c92d-111">Any objects added during a dynamic session are automatically deleted when the session ends.</span></span>

## <a name="transactions"></a><span data-ttu-id="4c92d-112">Transazioni</span><span class="sxs-lookup"><span data-stu-id="4c92d-112">Transactions</span></span>

<span data-ttu-id="4c92d-113">L'API PAM è transazionale e la maggior parte delle chiamate di funzione viene eseguita nel contesto di una transazione.</span><span class="sxs-lookup"><span data-stu-id="4c92d-113">The WFP API is transactional, and most function calls are made within the context of a transaction.</span></span> <span data-ttu-id="4c92d-114">I chiamanti possono usare [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0), [**FwpmTransactionCommit0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactioncommit0)e [**FwpmTransactionAbort0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionabort0) per controllare in modo esplicito le transazioni.</span><span class="sxs-lookup"><span data-stu-id="4c92d-114">Callers can use [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0), [**FwpmTransactionCommit0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactioncommit0), and [**FwpmTransactionAbort0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionabort0) to explicitly control transactions.</span></span> <span data-ttu-id="4c92d-115">Tuttavia, se una chiamata di funzione viene eseguita all'esterno di una transazione esplicita, verrà eseguita all'interno di una transazione implicita.</span><span class="sxs-lookup"><span data-stu-id="4c92d-115">However, if a function call is made outside of an explicit transaction, it will be executed within an implicit transaction.</span></span> <span data-ttu-id="4c92d-116">Se è in corso una transazione, quando una sessione viene terminata, viene automaticamente interrotta.</span><span class="sxs-lookup"><span data-stu-id="4c92d-116">If a transaction is in progress, when a session terminates, it is automatically aborted.</span></span> <span data-ttu-id="4c92d-117">Le transazioni implicite non vengono mai interrotte forzatamente.</span><span class="sxs-lookup"><span data-stu-id="4c92d-117">Implicit transactions are never forcibly aborted.</span></span>

<span data-ttu-id="4c92d-118">Le transazioni sono di sola lettura o di lettura/scrittura e impongono una semantica[acid](../cossdk/acid-properties.md)(isolable Durable) rigorosa e coerente.</span><span class="sxs-lookup"><span data-stu-id="4c92d-118">Transactions are either read-only or read/write and enforce rigorous Atomic Consistent Isolated Durable ([ACID](../cossdk/acid-properties.md)) semantics.</span></span>

<span data-ttu-id="4c92d-119">In ogni sessione client può essere in corso una sola transazione alla volta.</span><span class="sxs-lookup"><span data-stu-id="4c92d-119">Each client session can have only one transaction in progress at a time.</span></span> <span data-ttu-id="4c92d-120">Se il chiamante tenta di avviare una seconda transazione prima di eseguire il commit o l'interruzione del primo, BFE restituisce un errore.</span><span class="sxs-lookup"><span data-stu-id="4c92d-120">If the caller attempts to begin a second transaction before committing or aborting the first, BFE returns an error.</span></span>

<span data-ttu-id="4c92d-121">Se un'operazione ha esito negativo nel corso di una transazione, non influisce sullo stato complessivo della transazione.</span><span class="sxs-lookup"><span data-stu-id="4c92d-121">If an operation fails during the course of a transaction, it does not affect the overall state of the transaction.</span></span> <span data-ttu-id="4c92d-122">Si supponga, ad esempio, che il client avvii una transazione e chiami [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0) tre volte prima che una quarta chiamata abbia esito negativo.</span><span class="sxs-lookup"><span data-stu-id="4c92d-122">For example, suppose the client begins a transaction and successfully calls [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0) three times before a fourth call fails.</span></span> <span data-ttu-id="4c92d-123">Il client ha ora la possibilità di:</span><span class="sxs-lookup"><span data-stu-id="4c92d-123">The client now has the option of:</span></span>

-   <span data-ttu-id="4c92d-124">L'interruzione della transazione, nel qual caso non verrà aggiunto alcun filtro.</span><span class="sxs-lookup"><span data-stu-id="4c92d-124">Aborting the transaction, in which case none of the filters will be added.</span></span>
-   <span data-ttu-id="4c92d-125">Viene eseguito il commit della transazione, nel qual caso verranno aggiunti i primi tre filtri.</span><span class="sxs-lookup"><span data-stu-id="4c92d-125">Committing the transaction, in which case the first three filters will be added.</span></span>
-   <span data-ttu-id="4c92d-126">Continuando con più operazioni, tra cui potenzialmente ritentare il [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0)non riuscito.</span><span class="sxs-lookup"><span data-stu-id="4c92d-126">Continuing with more operations including potentially retrying the failed [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span></span>

<span data-ttu-id="4c92d-127">Quando si inizia una transazione, BFE attende finché il [**txnWaitTimeoutInMSec**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) della sessione non scade per acquisire il blocco.</span><span class="sxs-lookup"><span data-stu-id="4c92d-127">When beginning a transaction, BFE will wait until the session's [**txnWaitTimeoutInMSec**](/windows/desktop/api/Fwpmtypes/ns-fwpmtypes-fwpm_session0) expires to acquire the lock.</span></span> <span data-ttu-id="4c92d-128">Se il blocco non viene acquisito entro questo intervallo di tempo, l'acquisizione del blocco (e la chiamata [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0) ) avranno esito negativo.</span><span class="sxs-lookup"><span data-stu-id="4c92d-128">If the lock is not acquired within this time, the lock acquisition (and the [**FwpmTransactionBegin0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmtransactionbegin0) call) will fail.</span></span> <span data-ttu-id="4c92d-129">Ciò impedisce ai client di rispondere in modo indefinito.</span><span class="sxs-lookup"><span data-stu-id="4c92d-129">This prevents clients from indefinitely failing to respond.</span></span> <span data-ttu-id="4c92d-130">Se il client non ha specificato un timeout di blocco, il valore predefinito è 15 secondi.</span><span class="sxs-lookup"><span data-stu-id="4c92d-130">If the client did not specify a lock timeout, it defaults to 15 seconds.</span></span>

<span data-ttu-id="4c92d-131">Ogni transazione dispone anche di un timeout di blocco.</span><span class="sxs-lookup"><span data-stu-id="4c92d-131">Each transaction also has a lock timeout.</span></span> <span data-ttu-id="4c92d-132">Si tratta dell'intervallo di tempo massimo che può essere proprietario del blocco.</span><span class="sxs-lookup"><span data-stu-id="4c92d-132">This is the maximum amount of time that it can own the lock.</span></span> <span data-ttu-id="4c92d-133">Se il proprietario non rilascia il blocco entro questo intervallo di tempo, la transazione viene interrotta forzatamente, causando il rilascio del blocco.</span><span class="sxs-lookup"><span data-stu-id="4c92d-133">If the owner does not release the lock within this time, the transaction is forcibly aborted, causing the lock to be released.</span></span> <span data-ttu-id="4c92d-134">Il timeout del blocco non è configurabile.</span><span class="sxs-lookup"><span data-stu-id="4c92d-134">The lock timeout is not configurable.</span></span> <span data-ttu-id="4c92d-135">È infinito per i chiamanti in modalità kernel e un'ora per i chiamanti in modalità utente.</span><span class="sxs-lookup"><span data-stu-id="4c92d-135">It is infinite for kernel-mode callers and one hour for user-mode callers.</span></span> <span data-ttu-id="4c92d-136">Se una transazione viene interrotta forzatamente, la chiamata successiva effettuata all'interno di tale transazione avrà esito negativo con **FWP \_ E \_ transazione \_ interrotti**.</span><span class="sxs-lookup"><span data-stu-id="4c92d-136">If a transaction is forcibly aborted, the next call made within that transaction will fail with **FWP\_E\_TXN\_ABORTED**.</span></span>

## <a name="object-lifetimes"></a><span data-ttu-id="4c92d-137">Durata degli oggetti</span><span class="sxs-lookup"><span data-stu-id="4c92d-137">Object Lifetimes</span></span>

<span data-ttu-id="4c92d-138">Gli oggetti possono avere una delle quattro durate possibili:</span><span class="sxs-lookup"><span data-stu-id="4c92d-138">Objects can have one of four possible lifetimes:</span></span>

-   <span data-ttu-id="4c92d-139">Dinamico: un oggetto è dinamico solo se viene aggiunto usando un handle di sessione dinamico.</span><span class="sxs-lookup"><span data-stu-id="4c92d-139">Dynamic — An object is dynamic only if it is added using a dynamic session handle.</span></span> <span data-ttu-id="4c92d-140">Gli oggetti dinamici sono attivi fino a quando non vengono eliminati o la sessione di appartenenza non viene terminata.</span><span class="sxs-lookup"><span data-stu-id="4c92d-140">Dynamic objects live until they are deleted or the owning session terminates.</span></span>
-   <span data-ttu-id="4c92d-141">Static: gli oggetti sono statici per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="4c92d-141">Static — Objects are static by default.</span></span> <span data-ttu-id="4c92d-142">Gli oggetti statici rimangono attivi fino a quando non vengono eliminati, BFE si interrompe o il sistema viene arrestato.</span><span class="sxs-lookup"><span data-stu-id="4c92d-142">Static objects live until they are deleted, BFE stops, or the system is shutdown.</span></span>
-   <span data-ttu-id="4c92d-143">Persistente: gli oggetti permanenti vengono creati passando il flag **\_ \* \_ \_ permanente del flag FWPM** appropriato a una funzione **\* Add0 FWPM** .</span><span class="sxs-lookup"><span data-stu-id="4c92d-143">Persistent — Persistent objects are created by passing the appropriate **FWPM\_\*\_FLAG\_PERSISTENT** flag to an **Fwpm\*Add0** function.</span></span> <span data-ttu-id="4c92d-144">Gli oggetti permanenti rimangono attivi fino a quando non vengono eliminati.</span><span class="sxs-lookup"><span data-stu-id="4c92d-144">Persistent objects live until they are deleted.</span></span>
-   <span data-ttu-id="4c92d-145">Incorporati: gli oggetti predefiniti sono predefiniti da BFE e non possono essere aggiunti o eliminati.</span><span class="sxs-lookup"><span data-stu-id="4c92d-145">Built-in — Built-in objects are predefined by BFE and cannot be added or deleted.</span></span> <span data-ttu-id="4c92d-146">Si trovano per sempre.</span><span class="sxs-lookup"><span data-stu-id="4c92d-146">They live forever.</span></span>

<span data-ttu-id="4c92d-147">I filtri nei livelli in modalità kernel possono essere contrassegnati come filtri della fase di avvio passando il flag appropriato a [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span><span class="sxs-lookup"><span data-stu-id="4c92d-147">Filters in kernel-mode layers can be marked as boot-time filters by passing the appropriate flag to [**FwpmFilterAdd0**](/windows/desktop/api/Fwpmu/nf-fwpmu-fwpmfilteradd0).</span></span> <span data-ttu-id="4c92d-148">I filtri dell'ora di avvio vengono aggiunti al sistema all'avvio del driver TCP/IP e vengono rimossi al termine dell'inizializzazione di BFE.</span><span class="sxs-lookup"><span data-stu-id="4c92d-148">Boot-time filters are added to the system when the TCP/IP driver starts, and removed when BFE finishes initialization.</span></span> <span data-ttu-id="4c92d-149">Quando BFE viene avviato, vengono aggiunti oggetti permanenti.</span><span class="sxs-lookup"><span data-stu-id="4c92d-149">Persistent objects are added when BFE starts.</span></span>

<span data-ttu-id="4c92d-150">In molti casi, è possibile che un provider di criteri non desideri applicare i criteri permanenti se il provider è stato disabilitato.</span><span class="sxs-lookup"><span data-stu-id="4c92d-150">In many cases, a policy provider may not want its persistent policy enforced if the provider has been disabled.</span></span> <span data-ttu-id="4c92d-151">Quando si aggiunge un provider, il chiamante può specificare un nome di servizio Windows facoltativo.</span><span class="sxs-lookup"><span data-stu-id="4c92d-151">When adding a provider, the caller can specify an optional Windows service name.</span></span> <span data-ttu-id="4c92d-152">Quando si aggiungono oggetti permanenti, il chiamante può facoltativamente specificare il provider di cui è proprietario tale oggetto.</span><span class="sxs-lookup"><span data-stu-id="4c92d-152">When adding persistent objects, the caller can optionally specify the provider that "owns" that object.</span></span> <span data-ttu-id="4c92d-153">All'avvio del servizio, BFE aggiunge solo oggetti permanenti al sistema se non sono associati a un provider oppure il provider associato non dispone di un nome di servizio Windows o se il servizio Windows associato è impostato su avvio automatico.</span><span class="sxs-lookup"><span data-stu-id="4c92d-153">At service start, BFE only adds persistent objects to the system if they are not associated with a provider, or the associated provider has no Windows service name, or the associated Windows service is set to auto-start.</span></span>

## <a name="object-associations"></a><span data-ttu-id="4c92d-154">Associazioni di oggetti</span><span class="sxs-lookup"><span data-stu-id="4c92d-154">Object Associations</span></span>

<span data-ttu-id="4c92d-155">Alcuni oggetti contengono riferimenti ad altri oggetti.</span><span class="sxs-lookup"><span data-stu-id="4c92d-155">Some objects have references to other objects.</span></span> <span data-ttu-id="4c92d-156">Un filtro, ad esempio, fa sempre riferimento a un livello e può fare riferimento a un callout e a un contesto del provider.</span><span class="sxs-lookup"><span data-stu-id="4c92d-156">For example, a filter always references a layer and may reference a callout and a provider context.</span></span> <span data-ttu-id="4c92d-157">Gli oggetti non possono fare riferimento a oggetti che possono avere una durata più breve.</span><span class="sxs-lookup"><span data-stu-id="4c92d-157">Objects cannot refer to objects that may have a shorter lifetime.</span></span> <span data-ttu-id="4c92d-158">Un oggetto dinamico, quindi, non può fare riferimento a un oggetto dinamico da un'altra sessione.</span><span class="sxs-lookup"><span data-stu-id="4c92d-158">Thus, a dynamic object cannot refer to a dynamic object from a different session.</span></span> <span data-ttu-id="4c92d-159">Un oggetto statico non può fare riferimento a un oggetto dinamico.</span><span class="sxs-lookup"><span data-stu-id="4c92d-159">A static object cannot refer to a dynamic object.</span></span> <span data-ttu-id="4c92d-160">Un oggetto persistente non può fare riferimento a un oggetto dinamico, a un oggetto statico o a un oggetto persistente di proprietà di un provider diverso.</span><span class="sxs-lookup"><span data-stu-id="4c92d-160">A persistent object cannot refer to a dynamic object, a static object, or a persistent object owned by a different provider.</span></span>

<span data-ttu-id="4c92d-161">Non è possibile eliminare un oggetto finché non vengono eliminati prima tutti gli oggetti che vi fanno riferimento.</span><span class="sxs-lookup"><span data-stu-id="4c92d-161">An object cannot be deleted until all objects that reference it have first been deleted.</span></span>

## <a name="luids-and-guids"></a><span data-ttu-id="4c92d-162">Gli LUID e GUID</span><span class="sxs-lookup"><span data-stu-id="4c92d-162">LUIDs and GUIDs</span></span>

<span data-ttu-id="4c92d-163">Tutti gli oggetti API PAM in modalità utente (FWPM) sono identificati da un identificatore univoco globale (**GUID**) e fanno riferimento ad altri oggetti in base ai relativi **GUID**.</span><span class="sxs-lookup"><span data-stu-id="4c92d-163">All user mode WFP API objects (FWPM) are identified by a globally unique identifier (**GUID**) and reference other objects by their **GUID** s.</span></span> <span data-ttu-id="4c92d-164">Il **GUID** deve essere univoco solo all'interno del tipo di oggetto.</span><span class="sxs-lookup"><span data-stu-id="4c92d-164">The **GUID** need only be unique within the object type.</span></span> <span data-ttu-id="4c92d-165">Ad esempio, un filtro e un contesto del provider possono avere lo stesso **GUID**, ma due filtri non possono.</span><span class="sxs-lookup"><span data-stu-id="4c92d-165">For example, a filter and a provider context can have the same **GUID**, but two filters cannot.</span></span> <span data-ttu-id="4c92d-166">Quando si aggiunge un nuovo oggetto, i chiamanti possono assegnare il **GUID** dell'oggetto o lasciarlo inizializzato a zero e consentire a BFE di assegnare il **GUID**.</span><span class="sxs-lookup"><span data-stu-id="4c92d-166">When adding a new object, callers can assign the object's **GUID** or leave it zero-initialized and let BFE assign the **GUID**.</span></span>

<span data-ttu-id="4c92d-167">Tutti gli oggetti API PAM in modalità kernel (FWPS) sono identificati da un identificatore univoco locale (**LUID**) e fanno riferimento ad altri oggetti in base al relativo LUID.</span><span class="sxs-lookup"><span data-stu-id="4c92d-167">All kernel mode WFP API objects (FWPS) are identified by a locally unique identifier (**LUID**) and reference other objects by their LUID.</span></span> <span data-ttu-id="4c92d-168">Il passaggio da **GUID** a **LUID** consente a WFP di conservare il pool non di paging e di ottimizzare l'elaborazione in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="4c92d-168">The switch from **GUID** to **LUID** enables WFP to conserve non-paged pool and optimize run-time processing.</span></span> <span data-ttu-id="4c92d-169">La larghezza di **LUID** dipende dal tipo di oggetto e dagli intervalli da un **UInt16** a un **UInt64**.</span><span class="sxs-lookup"><span data-stu-id="4c92d-169">The width of the **LUID** depends on the object type and ranges from a **UINT16** to a **UINT64**.</span></span> <span data-ttu-id="4c92d-170">**LUID** s sono sempre assegnati da BFE.</span><span class="sxs-lookup"><span data-stu-id="4c92d-170">**LUID** s are always assigned by BFE.</span></span>

 

 