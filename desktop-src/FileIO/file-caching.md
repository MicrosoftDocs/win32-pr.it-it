---
description: Windows memorizza nella cache i dati del file letti dai dischi e scritti nei dischi.
ms.assetid: 0865c741-63e3-4246-ba69-801b02153e4a
title: Memorizzazione nella cache dei file
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 1a14fb668af16cfb8a4e42b59b25b73ecefbb7cb
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "103884893"
---
# <a name="file-caching"></a><span data-ttu-id="28b52-103">Memorizzazione nella cache dei file</span><span class="sxs-lookup"><span data-stu-id="28b52-103">File Caching</span></span>

<span data-ttu-id="28b52-104">Per impostazione predefinita, Windows memorizza nella cache i dati di file che vengono letti dai dischi e scritti sui dischi.</span><span class="sxs-lookup"><span data-stu-id="28b52-104">By default, Windows caches file data that is read from disks and written to disks.</span></span> <span data-ttu-id="28b52-105">Ciò implica che le operazioni di lettura leggono i dati dei file da un'area della memoria di sistema nota come cache dei file di sistema, invece che dal disco fisico.</span><span class="sxs-lookup"><span data-stu-id="28b52-105">This implies that read operations read file data from an area in system memory known as the system file cache, rather than from the physical disk.</span></span> <span data-ttu-id="28b52-106">Analogamente, le operazioni di scrittura scrivono i dati dei file nella cache dei file di sistema anziché sul disco e questo tipo di cache è noto come cache write-back.</span><span class="sxs-lookup"><span data-stu-id="28b52-106">Correspondingly, write operations write file data to the system file cache rather than to the disk, and this type of cache is referred to as a write-back cache.</span></span> <span data-ttu-id="28b52-107">La memorizzazione nella cache viene gestita per ogni oggetto file.</span><span class="sxs-lookup"><span data-stu-id="28b52-107">Caching is managed per file object.</span></span>

<span data-ttu-id="28b52-108">La memorizzazione nella cache si verifica in base alla direzione del *gestore della cache*, che funziona continuamente mentre è in esecuzione Windows.</span><span class="sxs-lookup"><span data-stu-id="28b52-108">Caching occurs under the direction of the *cache manager*, which operates continuously while Windows is running.</span></span> <span data-ttu-id="28b52-109">I dati dei file nella cache dei file di sistema vengono scritti sul disco a intervalli determinati dal sistema operativo e la memoria utilizzata in precedenza da tali dati viene liberata. questa operazione viene definita *scaricamento* della cache.</span><span class="sxs-lookup"><span data-stu-id="28b52-109">File data in the system file cache is written to the disk at intervals determined by the operating system, and the memory previously used by that file data is freed—this is referred to as *flushing* the cache.</span></span> <span data-ttu-id="28b52-110">Il criterio di ritardare la scrittura dei dati nel file e di mantenerlo nella cache finché la cache non viene scaricata è chiamato Lazy writing e viene attivato dal gestore della cache a un intervallo di tempo determinato.</span><span class="sxs-lookup"><span data-stu-id="28b52-110">The policy of delaying the writing of the data to the file and holding it in the cache until the cache is flushed is called lazy writing, and it is triggered by the cache manager at a determinate time interval.</span></span> <span data-ttu-id="28b52-111">Il momento in cui un blocco di dati del file viene scaricato dipende in parte da quanto tempo è rimasto memorizzato nella cache e da quanto tempo è trascorso dall'ultima volta in cui si è avuto accesso ai dati in un'operazione di lettura.</span><span class="sxs-lookup"><span data-stu-id="28b52-111">The time at which a block of file data is flushed is partially based on the amount of time it has been stored in the cache and the amount of time since the data was last accessed in a read operation.</span></span> <span data-ttu-id="28b52-112">Questo garantisce che i dati del file letti frequentemente restino accessibili nella cache dei file di sistema per il massimo intervallo di tempo previsto.</span><span class="sxs-lookup"><span data-stu-id="28b52-112">This ensures that file data that is frequently read will stay accessible in the system file cache for the maximum amount of time.</span></span>

<span data-ttu-id="28b52-113">Questo processo di memorizzazione nella cache dei dati del file è illustrato nella figura seguente.</span><span class="sxs-lookup"><span data-stu-id="28b52-113">This file data caching process is illustrated in the following figure.</span></span>

![processo di memorizzazione nella cache dei dati di file](images/fig3.png)

<span data-ttu-id="28b52-115">Come illustrato dalle frecce solide nella figura precedente, un'area di dati di 256 KB viene letta in uno slot della cache da 256 KB nello spazio degli indirizzi del sistema quando viene richiesta per la prima volta dal gestore della cache durante un'operazione di lettura del file.</span><span class="sxs-lookup"><span data-stu-id="28b52-115">As depicted by the solid arrows in the previous figure, a 256 KB region of data is read into a 256 KB cache "slot" in system address space when it is first requested by the cache manager during a file read operation.</span></span> <span data-ttu-id="28b52-116">Un processo in modalità utente quindi copia i dati di questo slot nel proprio spazio indirizzi.</span><span class="sxs-lookup"><span data-stu-id="28b52-116">A user-mode process then copies the data in this slot to its own address space.</span></span> <span data-ttu-id="28b52-117">Quando il processo ha completato l'accesso ai dati, riscrive i dati modificati nello stesso slot nella cache di sistema, come indicato dalla freccia tratteggiata tra lo spazio indirizzi del processo e la cache di sistema.</span><span class="sxs-lookup"><span data-stu-id="28b52-117">When the process has completed its data access, it writes the altered data back to the same slot in the system cache, as shown by the dotted arrow between the process address space and the system cache.</span></span> <span data-ttu-id="28b52-118">Quando il gestore della cache ha determinato che i dati non saranno più necessari per un determinato periodo di tempo, i dati modificati vengono scritti nuovamente nel file su disco, come illustrato dalla freccia tratteggiata tra la cache di sistema e il disco.</span><span class="sxs-lookup"><span data-stu-id="28b52-118">When the cache manager has determined that the data will no longer be needed for a certain amount of time, it writes the altered data back to the file on the disk, as shown by the dotted arrow between the system cache and the disk.</span></span>

<span data-ttu-id="28b52-119">La quantità di miglioramento delle prestazioni di I/O che la memorizzazione nella cache dei dati del file dipende dalla dimensione del blocco di dati file letto o scritto.</span><span class="sxs-lookup"><span data-stu-id="28b52-119">The amount of I/O performance improvement that file data caching offers depends on the size of the file data block being read or written.</span></span> <span data-ttu-id="28b52-120">Quando si leggono e scrivono blocchi di dati di file di grandi dimensioni, è più probabile che le letture e le Scritture del disco siano necessarie per completare l'operazione di I/O.</span><span class="sxs-lookup"><span data-stu-id="28b52-120">When large blocks of file data are read and written, it is more likely that disk reads and writes will be necessary to finish the I/O operation.</span></span> <span data-ttu-id="28b52-121">Le prestazioni di i/O saranno sempre più disaccoppiate, perché si verifica un maggior numero di questo tipo di operazione di I/O.</span><span class="sxs-lookup"><span data-stu-id="28b52-121">I/O performance will be increasingly impaired as more of this kind of I/O operation occurs.</span></span>

<span data-ttu-id="28b52-122">In queste situazioni, la memorizzazione nella cache può essere disattivata.</span><span class="sxs-lookup"><span data-stu-id="28b52-122">In these situations, caching can be turned off.</span></span> <span data-ttu-id="28b52-123">Questa operazione viene eseguita al momento dell'apertura del file passando il **flag di file \_ \_ nessun \_ buffering** come valore per il parametro *dwFlagsAndAttributes* di [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="28b52-123">This is done at the time the file is opened by passing **FILE\_FLAG\_NO\_BUFFERING** as a value for the *dwFlagsAndAttributes* parameter of [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span> <span data-ttu-id="28b52-124">Quando la memorizzazione nella cache è disabilitata, tutte le operazioni di lettura e scrittura accedono direttamente al disco fisico.</span><span class="sxs-lookup"><span data-stu-id="28b52-124">When caching is disabled, all read and write operations directly access the physical disk.</span></span> <span data-ttu-id="28b52-125">Tuttavia, i metadati del file possono essere ancora memorizzati nella cache.</span><span class="sxs-lookup"><span data-stu-id="28b52-125">However, the file metadata may still be cached.</span></span> <span data-ttu-id="28b52-126">Per svuotare i metadati su disco, usare la funzione [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) .</span><span class="sxs-lookup"><span data-stu-id="28b52-126">To flush the metadata to disk, use the [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) function.</span></span>

<span data-ttu-id="28b52-127">La frequenza con cui si verifica lo svuotamento è una considerazione importante che bilancia le prestazioni del sistema con l'affidabilità del sistema.</span><span class="sxs-lookup"><span data-stu-id="28b52-127">The frequency at which flushing occurs is an important consideration that balances system performance with system reliability.</span></span> <span data-ttu-id="28b52-128">Se la cache viene scaricata troppo spesso dal sistema, il numero di operazioni di scrittura di grandi dimensioni che lo scaricamento comporta un calo significativo delle prestazioni del sistema.</span><span class="sxs-lookup"><span data-stu-id="28b52-128">If the system flushes the cache too often, the number of large write operations flushing incurs will degrade system performance significantly.</span></span> <span data-ttu-id="28b52-129">Se il sistema non viene svuotato abbastanza spesso, la probabilità è maggiore che la memoria di sistema verrà esaurita dalla cache o un errore di sistema improvviso, ad esempio una perdita di energia al computer, avverrà prima dello scaricamento.</span><span class="sxs-lookup"><span data-stu-id="28b52-129">If the system is not flushed often enough, then the likelihood is greater that either system memory will be depleted by the cache, or a sudden system failure (such as a loss of power to the computer) will happen before the flush.</span></span> <span data-ttu-id="28b52-130">Nel secondo caso, i dati memorizzati nella cache andranno persi.</span><span class="sxs-lookup"><span data-stu-id="28b52-130">In the latter instance, the cached data will be lost.</span></span>

<span data-ttu-id="28b52-131">Per assicurarsi che venga eseguita la quantità corretta di scaricamento, il gestore della cache genera un processo ogni secondo chiamato Lazy Writer.</span><span class="sxs-lookup"><span data-stu-id="28b52-131">To ensure that the right amount of flushing occurs, the cache manager spawns a process every second called a lazy writer.</span></span> <span data-ttu-id="28b52-132">Il processo Lazy Writer Accoda un ottavo di pagine che non sono state scaricate di recente per essere scritte su disco.</span><span class="sxs-lookup"><span data-stu-id="28b52-132">The lazy writer process queues one-eighth of the pages that have not been flushed recently to be written to disk.</span></span> <span data-ttu-id="28b52-133">Rivaluta costantemente la quantità di dati scaricati per ottimizzare le prestazioni del sistema e, se è necessario scrivere più dati, Accoda più dati.</span><span class="sxs-lookup"><span data-stu-id="28b52-133">It constantly reevaluates the amount of data being flushed for optimal system performance, and if more data needs to be written it queues more data.</span></span> <span data-ttu-id="28b52-134">I writer lazy non scaricano i file temporanei, perché il presupposto è che vengano eliminati dall'applicazione o dal sistema.</span><span class="sxs-lookup"><span data-stu-id="28b52-134">Lazy writers do not flush temporary files, because the assumption is that they will be deleted by the application or system.</span></span>

<span data-ttu-id="28b52-135">Per alcune applicazioni, ad esempio il software di controllo dei virus, è necessario che le operazioni di scrittura vengano scaricate immediatamente su disco; Windows offre questa possibilità attraverso la memorizzazione nella cache write-through.</span><span class="sxs-lookup"><span data-stu-id="28b52-135">Some applications, such as virus-checking software, require that their write operations be flushed to disk immediately; Windows provides this ability through write-through caching.</span></span> <span data-ttu-id="28b52-136">Un processo consente la memorizzazione nella cache write-through per un'operazione di I/O specifica passando il flag **\_ \_ Write \_ through del flag file** alla chiamata a [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span><span class="sxs-lookup"><span data-stu-id="28b52-136">A process enables write-through caching for a specific I/O operation by passing the **FILE\_FLAG\_WRITE\_THROUGH** flag into its call to [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea).</span></span> <span data-ttu-id="28b52-137">Con la memorizzazione nella cache write-through abilitata, i dati vengono ancora scritti nella cache, ma il gestore della cache scrive immediatamente i dati su disco anziché incorrere in un ritardo utilizzando il writer Lazy.</span><span class="sxs-lookup"><span data-stu-id="28b52-137">With write-through caching enabled, data is still written into the cache, but the cache manager writes the data immediately to disk rather than incurring a delay by using the lazy writer.</span></span> <span data-ttu-id="28b52-138">Un processo può anche forzare lo scaricamento di un file aperto chiamando la funzione [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) .</span><span class="sxs-lookup"><span data-stu-id="28b52-138">A process can also force a flush of a file it has opened by calling the [**FlushFileBuffers**](/windows/desktop/api/FileAPI/nf-fileapi-flushfilebuffers) function.</span></span>

<span data-ttu-id="28b52-139">I metadati del file System vengono sempre memorizzati nella cache.</span><span class="sxs-lookup"><span data-stu-id="28b52-139">File system metadata is always cached.</span></span> <span data-ttu-id="28b52-140">Pertanto, per archiviare le modifiche dei metadati sul disco, è necessario scaricare il file o aprirlo con il **\_ flag file \_ Write \_ through**.</span><span class="sxs-lookup"><span data-stu-id="28b52-140">Therefore, to store any metadata changes to disk, the file must either be flushed or be opened with **FILE\_FLAG\_WRITE\_THROUGH**.</span></span>

 

 



