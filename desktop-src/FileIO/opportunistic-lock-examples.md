---
description: Diagrammi delle visualizzazioni di traffico di rete per un blocco opportunistico di livello 1, un blocco opportunistico batch e un blocco opportunistico di filtro.
ms.assetid: 78830113-b18e-40c7-8ec4-8896dbc58030
title: Esempi di blocco opportunistico
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: ae8b8a0c5b04897ddc2fc8f2e3bdec20f2fdb02d
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "104529263"
---
# <a name="opportunistic-lock-examples"></a><span data-ttu-id="8bb12-103">Esempi di blocco opportunistico</span><span class="sxs-lookup"><span data-stu-id="8bb12-103">Opportunistic Lock Examples</span></span>

<span data-ttu-id="8bb12-104">Negli esempi seguenti vengono illustrati i dati e i movimenti dei messaggi SMB come blocchi opportunistici e interrotti.</span><span class="sxs-lookup"><span data-stu-id="8bb12-104">The following examples show data and SMB message movements as opportunistic locks are made and broken.</span></span> <span data-ttu-id="8bb12-105">Si noti che i client possono memorizzare nella cache i dati degli attributi del file e i dati del file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-105">Note that clients can cache file attribute data as well as file data.</span></span>

<span data-ttu-id="8bb12-106">Si noti inoltre che questi esempi sono basati su situazioni in cui le applicazioni client richiedono blocchi opportunistici da server remoti.</span><span class="sxs-lookup"><span data-stu-id="8bb12-106">Also note that these examples are based on situations where client applications are requesting opportunistic locks from remote servers.</span></span> <span data-ttu-id="8bb12-107">Questi processi vengono avviati automaticamente dal redirector di rete e dal server remoto: non esiste alcun coinvolgimento diretto da parte dell'applicazione client o delle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="8bb12-107">These processes are automatically initiated by the network redirector and the remote server—there is no direct involvement by the client application or applications.</span></span> <span data-ttu-id="8bb12-108">I processi descritti in questi esempi possono essere generalizzati in situazioni in cui le applicazioni client locali richiedono direttamente i blocchi opportunistici dal file system locale, con l'eccezione che non è previsto alcun scambio di dati sulla rete.</span><span class="sxs-lookup"><span data-stu-id="8bb12-108">The processes described by these examples can be generalized into situations where local client applications are directly requesting opportunistic locks from the local file system, with the exception that no exchange of data over the network is involved.</span></span>

## <a name="level-1-opportunistic-lock"></a><span data-ttu-id="8bb12-109">Blocco opportunistico di livello 1</span><span class="sxs-lookup"><span data-stu-id="8bb12-109">Level 1 Opportunistic Lock</span></span>

<span data-ttu-id="8bb12-110">Il diagramma seguente mostra una visualizzazione del traffico di rete di un blocco opportunistico di livello 1 su un file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-110">The following diagram shows a network-traffic view of a level 1 opportunistic lock on a file.</span></span> <span data-ttu-id="8bb12-111">Le frecce indicano la direzione dello spostamento dei dati, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="8bb12-111">The arrows indicate the direction of data movement, if any.</span></span>



| <span data-ttu-id="8bb12-112">Evento</span><span class="sxs-lookup"><span data-stu-id="8bb12-112">Event</span></span> | <span data-ttu-id="8bb12-113">Client X</span><span class="sxs-lookup"><span data-stu-id="8bb12-113">Client X</span></span>                                          | <span data-ttu-id="8bb12-114">Server</span><span class="sxs-lookup"><span data-stu-id="8bb12-114">Server</span></span>                                   | <span data-ttu-id="8bb12-115">Y client</span><span class="sxs-lookup"><span data-stu-id="8bb12-115">Client Y</span></span>                                          |
|-------|---------------------------------------------------|------------------------------------------|---------------------------------------------------|
| <span data-ttu-id="8bb12-116">1</span><span class="sxs-lookup"><span data-stu-id="8bb12-116">1</span></span>     | <span data-ttu-id="8bb12-117">Apre il file, le richieste di livello 1 blocco = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-117">Opens file, requests level 1 lock ==></span></span>          |                                          |                                                   |
| <span data-ttu-id="8bb12-118">2</span><span class="sxs-lookup"><span data-stu-id="8bb12-118">2</span></span>     |                                                   | <span data-ttu-id="8bb12-119"><= = il blocco opportunistico di livello 1 viene concesso</span><span class="sxs-lookup"><span data-stu-id="8bb12-119"><== Grants level 1 opportunistic lock</span></span> |                                                   |
| <span data-ttu-id="8bb12-120">3</span><span class="sxs-lookup"><span data-stu-id="8bb12-120">3</span></span>     | <span data-ttu-id="8bb12-121">Esegue operazioni di lettura, scrittura e altro = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-121">Performs read, write, and other operations ==></span></span> |                                          |                                                   |
| <span data-ttu-id="8bb12-122">4</span><span class="sxs-lookup"><span data-stu-id="8bb12-122">4</span></span>     |                                                   |                                          | <span data-ttu-id="8bb12-123"><= = richieste di apertura file</span><span class="sxs-lookup"><span data-stu-id="8bb12-123"><== Requests to open file</span></span>                      |
| <span data-ttu-id="8bb12-124">5</span><span class="sxs-lookup"><span data-stu-id="8bb12-124">5</span></span>     |                                                   | <span data-ttu-id="8bb12-125"><= = interrompe il blocco opportunistico</span><span class="sxs-lookup"><span data-stu-id="8bb12-125"><== Breaks opportunistic lock</span></span>         |                                                   |
| <span data-ttu-id="8bb12-126">6</span><span class="sxs-lookup"><span data-stu-id="8bb12-126">6</span></span>     | <span data-ttu-id="8bb12-127">Elimina i dati read-ahead</span><span class="sxs-lookup"><span data-stu-id="8bb12-127">Discards read-ahead data</span></span>                          |                                          |                                                   |
| <span data-ttu-id="8bb12-128">7</span><span class="sxs-lookup"><span data-stu-id="8bb12-128">7</span></span>     | <span data-ttu-id="8bb12-129">Scrive i dati = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-129">Writes data ==></span></span>                                |                                          |                                                   |
| <span data-ttu-id="8bb12-130">8</span><span class="sxs-lookup"><span data-stu-id="8bb12-130">8</span></span>     | <span data-ttu-id="8bb12-131">Invia il messaggio "close" o "Done" = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-131">Sends "close" or "done" message ==></span></span>            |                                          |                                                   |
| <span data-ttu-id="8bb12-132">9</span><span class="sxs-lookup"><span data-stu-id="8bb12-132">9</span></span>     |                                                   | <span data-ttu-id="8bb12-133">Operazione di apertura OK = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-133">Okays open operation ==></span></span>              |                                                   |
| <span data-ttu-id="8bb12-134">10</span><span class="sxs-lookup"><span data-stu-id="8bb12-134">10</span></span>    | <span data-ttu-id="8bb12-135">Esegue operazioni di lettura, scrittura e altro = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-135">Performs read, write, and other operations ==></span></span> |                                          | <span data-ttu-id="8bb12-136"><= = esegue operazioni di lettura, scrittura e altre operazioni</span><span class="sxs-lookup"><span data-stu-id="8bb12-136"><== Performs read, write, and other operations</span></span> |



 

<span data-ttu-id="8bb12-137">Nell'evento 1, il client X apre un file e come parte dell'operazione di apertura richiede un blocco opportunistico di livello 1 sul file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-137">In event 1, client X opens a file and as part of the open operation requests a level 1 opportunistic lock on the file.</span></span> <span data-ttu-id="8bb12-138">Nell'evento 2, il server concede il blocco di livello 1 perché nessun altro client ha aperto il file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-138">In event 2, the server grants the level 1 lock because no other client has the file open.</span></span> <span data-ttu-id="8bb12-139">Il client continua ad accedere al file nel modo consueto nell'evento 3.</span><span class="sxs-lookup"><span data-stu-id="8bb12-139">The client proceeds to access the file in the usual manner in event 3.</span></span>

<span data-ttu-id="8bb12-140">Nell'evento 4, il client Y tenta di aprire il file e richiede un blocco opportunistico.</span><span class="sxs-lookup"><span data-stu-id="8bb12-140">In event 4, client Y attempts to open the file and requests an opportunistic lock.</span></span> <span data-ttu-id="8bb12-141">Il server rileva che il client X ha aperto il file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-141">The server sees that client X has the file open.</span></span> <span data-ttu-id="8bb12-142">Il server ignora la richiesta Y mentre client X Scarica tutti i dati di scrittura e abbandona la cache di lettura per il file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-142">The server ignores Y's request while client X flushes any write data and abandons its read cache for the file.</span></span>

<span data-ttu-id="8bb12-143">Il server impone la pulizia di X inviando a X un messaggio SMB che interrompe il blocco opportunistico, evento 5.</span><span class="sxs-lookup"><span data-stu-id="8bb12-143">The server forces X to clean up by sending to X an SMB message breaking the opportunistic lock, event 5.</span></span> <span data-ttu-id="8bb12-144">Il client X "invisibile all'utente" Elimina tutti i dati read-ahead; in altre parole, questo processo non genera alcun traffico di rete.</span><span class="sxs-lookup"><span data-stu-id="8bb12-144">Client X "silently" discards any read-ahead data; in other words, this process generates no network traffic.</span></span> <span data-ttu-id="8bb12-145">Nell'evento 7, client X scrive tutti i dati di scrittura memorizzati nella cache nel server.</span><span class="sxs-lookup"><span data-stu-id="8bb12-145">In event 7, client X writes any cached write data to the server.</span></span> <span data-ttu-id="8bb12-146">Quando il client X ha completato la scrittura dei dati memorizzati nella cache nel server, il client X invia un messaggio "Chiudi" o "completato" al server, evento 8.</span><span class="sxs-lookup"><span data-stu-id="8bb12-146">When client X is done writing cached data to the server, client X sends either a "close" or a "done" message to the server, event 8.</span></span>

<span data-ttu-id="8bb12-147">Dopo che il server è stato informato che il client X ha completato lo scaricamento della cache di scrittura nel server o ha chiuso il file, il server può aprire il file per il client Y, nell'evento 9.</span><span class="sxs-lookup"><span data-stu-id="8bb12-147">After the server has been notified that client X is done flushing its write cache to the server or has closed the file, then the server can open the file for client Y, in event 9.</span></span> <span data-ttu-id="8bb12-148">Poiché il server dispone ora di due client con lo stesso file aperto, concede un blocco opportunistico a nessuno dei due.</span><span class="sxs-lookup"><span data-stu-id="8bb12-148">Because the server now has two clients with the same file open, it grants an opportunistic lock to neither.</span></span> <span data-ttu-id="8bb12-149">Entrambi i client procedono alla lettura dal file e una o nessuna delle scritture nel file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-149">Both clients proceed to read from the file, and one or neither writes to the file.</span></span>

## <a name="batch-opportunistic-lock"></a><span data-ttu-id="8bb12-150">Blocco opportunistico batch</span><span class="sxs-lookup"><span data-stu-id="8bb12-150">Batch Opportunistic Lock</span></span>

<span data-ttu-id="8bb12-151">Il diagramma seguente mostra una visualizzazione del traffico di rete di un blocco opportunistico batch.</span><span class="sxs-lookup"><span data-stu-id="8bb12-151">The following diagram shows a network-traffic view of a batch opportunistic lock.</span></span> <span data-ttu-id="8bb12-152">Le frecce indicano la direzione dello spostamento dei dati, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="8bb12-152">The arrows indicate the direction of data movement, if any.</span></span>



| <span data-ttu-id="8bb12-153">Evento</span><span class="sxs-lookup"><span data-stu-id="8bb12-153">Event</span></span> | <span data-ttu-id="8bb12-154">Client X</span><span class="sxs-lookup"><span data-stu-id="8bb12-154">Client X</span></span>                               | <span data-ttu-id="8bb12-155">Server</span><span class="sxs-lookup"><span data-stu-id="8bb12-155">Server</span></span>                                 | <span data-ttu-id="8bb12-156">Y client</span><span class="sxs-lookup"><span data-stu-id="8bb12-156">Client Y</span></span>                                          |
|-------|----------------------------------------|----------------------------------------|---------------------------------------------------|
| <span data-ttu-id="8bb12-157">1</span><span class="sxs-lookup"><span data-stu-id="8bb12-157">1</span></span>     | <span data-ttu-id="8bb12-158">Apre il file, richiede il blocco batch = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-158">Opens file, requests batch lock ==></span></span> |                                        |                                                   |
| <span data-ttu-id="8bb12-159">2</span><span class="sxs-lookup"><span data-stu-id="8bb12-159">2</span></span>     |                                        | <span data-ttu-id="8bb12-160"><= = concede un blocco opportunistico batch</span><span class="sxs-lookup"><span data-stu-id="8bb12-160"><== Grants batch opportunistic lock</span></span> |                                                   |
| <span data-ttu-id="8bb12-161">3</span><span class="sxs-lookup"><span data-stu-id="8bb12-161">3</span></span>     | <span data-ttu-id="8bb12-162">Letture file = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-162">Reads file ==></span></span>                      |                                        |                                                   |
| <span data-ttu-id="8bb12-163">4</span><span class="sxs-lookup"><span data-stu-id="8bb12-163">4</span></span>     |                                        | <span data-ttu-id="8bb12-164"><= = invia dati</span><span class="sxs-lookup"><span data-stu-id="8bb12-164"><== Sends data</span></span>                      |                                                   |
| <span data-ttu-id="8bb12-165">5</span><span class="sxs-lookup"><span data-stu-id="8bb12-165">5</span></span>     | <span data-ttu-id="8bb12-166">Chiude il file</span><span class="sxs-lookup"><span data-stu-id="8bb12-166">Closes file</span></span>                            |                                        |                                                   |
| <span data-ttu-id="8bb12-167">6</span><span class="sxs-lookup"><span data-stu-id="8bb12-167">6</span></span>     | <span data-ttu-id="8bb12-168">Apre il file</span><span class="sxs-lookup"><span data-stu-id="8bb12-168">Opens file</span></span>                             |                                        |                                                   |
| <span data-ttu-id="8bb12-169">7</span><span class="sxs-lookup"><span data-stu-id="8bb12-169">7</span></span>     | <span data-ttu-id="8bb12-170">Cerca dati</span><span class="sxs-lookup"><span data-stu-id="8bb12-170">Searches for data</span></span>                      |                                        |                                                   |
| <span data-ttu-id="8bb12-171">8</span><span class="sxs-lookup"><span data-stu-id="8bb12-171">8</span></span>     | <span data-ttu-id="8bb12-172">Legge i dati = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-172">Reads data ==></span></span>                      |                                        |                                                   |
| <span data-ttu-id="8bb12-173">9</span><span class="sxs-lookup"><span data-stu-id="8bb12-173">9</span></span>     |                                        | <span data-ttu-id="8bb12-174"><= = invia dati</span><span class="sxs-lookup"><span data-stu-id="8bb12-174"><== Sends data</span></span>                      |                                                   |
| <span data-ttu-id="8bb12-175">10</span><span class="sxs-lookup"><span data-stu-id="8bb12-175">10</span></span>    | <span data-ttu-id="8bb12-176">Chiude il file</span><span class="sxs-lookup"><span data-stu-id="8bb12-176">Closes file</span></span>                            |                                        |                                                   |
| <span data-ttu-id="8bb12-177">11</span><span class="sxs-lookup"><span data-stu-id="8bb12-177">11</span></span>    |                                        |                                        | <span data-ttu-id="8bb12-178"><= = apre il file</span><span class="sxs-lookup"><span data-stu-id="8bb12-178"><== Opens file</span></span>                                 |
| <span data-ttu-id="8bb12-179">12</span><span class="sxs-lookup"><span data-stu-id="8bb12-179">12</span></span>    |                                        | <span data-ttu-id="8bb12-180"><= = interrompe il blocco opportunistico</span><span class="sxs-lookup"><span data-stu-id="8bb12-180"><== Breaks opportunistic lock</span></span>       |                                                   |
| <span data-ttu-id="8bb12-181">13</span><span class="sxs-lookup"><span data-stu-id="8bb12-181">13</span></span>    | <span data-ttu-id="8bb12-182">Chiude il file = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-182">Closes file ==></span></span>                     |                                        |                                                   |
| <span data-ttu-id="8bb12-183">14</span><span class="sxs-lookup"><span data-stu-id="8bb12-183">14</span></span>    |                                        | <span data-ttu-id="8bb12-184">Operazione di apertura OK = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-184">Okays open operation ==></span></span>            |                                                   |
| <span data-ttu-id="8bb12-185">15</span><span class="sxs-lookup"><span data-stu-id="8bb12-185">15</span></span>    |                                        |                                        | <span data-ttu-id="8bb12-186"><= = esegue operazioni di lettura, scrittura e altre operazioni</span><span class="sxs-lookup"><span data-stu-id="8bb12-186"><== Performs read, write, and other operations</span></span> |



 

<span data-ttu-id="8bb12-187">Nel blocco opportunistico batch, client X apre un file, evento 1, e il server concede al client X un blocco batch nell'evento 2.</span><span class="sxs-lookup"><span data-stu-id="8bb12-187">In the batch opportunistic lock, client X opens a file, event 1, and the server grants client X a batch lock in event 2.</span></span> <span data-ttu-id="8bb12-188">Il client X tenta di leggere i dati, evento 3, a cui il server risponde con i dati, evento 4.</span><span class="sxs-lookup"><span data-stu-id="8bb12-188">Client X attempts to read data, event 3, to which the server responds with data, event 4.</span></span>

<span data-ttu-id="8bb12-189">L'evento 5 Mostra il blocco opportunistico batch al lavoro.</span><span class="sxs-lookup"><span data-stu-id="8bb12-189">Event 5 shows the batch opportunistic lock at work.</span></span> <span data-ttu-id="8bb12-190">L'applicazione sul client X chiude il file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-190">The application on Client X closes the file.</span></span> <span data-ttu-id="8bb12-191">Tuttavia, il redirector di rete filtra l'operazione di chiusura e non trasmette un messaggio di chiusura, eseguendo così una chiusura invisibile.</span><span class="sxs-lookup"><span data-stu-id="8bb12-191">However, the network redirector filters out the close operation and does not transmit a close message, thus performing a "silent" close.</span></span> <span data-ttu-id="8bb12-192">Il redirector di rete può eseguire questa operazione perché il client X ha solo la proprietà del file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-192">The network redirector can do this because client X has sole ownership of the file.</span></span> <span data-ttu-id="8bb12-193">Successivamente, nell'evento 6, l'applicazione riapre il file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-193">Later on, in event 6, the application reopens the file.</span></span> <span data-ttu-id="8bb12-194">Anche in questo caso, nessun flusso di dati attraverso la rete.</span><span class="sxs-lookup"><span data-stu-id="8bb12-194">Again, no data flows across the network.</span></span> <span data-ttu-id="8bb12-195">Per quanto riguarda il server, il client ha aperto il file dall'evento 2.</span><span class="sxs-lookup"><span data-stu-id="8bb12-195">As far as the server is concerned, this client has had the file open since event 2.</span></span>

<span data-ttu-id="8bb12-196">Gli eventi 7, 8 e 9 mostrano il normale corso di traffico di rete.</span><span class="sxs-lookup"><span data-stu-id="8bb12-196">Events 7, 8, and 9 show the usual course of network traffic.</span></span> <span data-ttu-id="8bb12-197">Nell'evento 10 si verifica un'altra chiusura invisibile all'utente.</span><span class="sxs-lookup"><span data-stu-id="8bb12-197">In event 10, another silent close occurs.</span></span>

<span data-ttu-id="8bb12-198">Nell'evento 11, il client Y tenta di aprire il file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-198">In event 11, client Y attempts to open the file.</span></span> <span data-ttu-id="8bb12-199">La visualizzazione del file del server è che il client X è aperto, anche se l'applicazione è stata chiusa dal client X.</span><span class="sxs-lookup"><span data-stu-id="8bb12-199">The server's view of the file is that client X has it open, even though the application on client X has closed it.</span></span> <span data-ttu-id="8bb12-200">Pertanto, il server invia un messaggio che suddivide il blocco opportunistico sul client X. il client X ora invia il messaggio di chiusura attraverso la rete, evento 13.</span><span class="sxs-lookup"><span data-stu-id="8bb12-200">Therefore, the server sends an a message breaking the opportunistic lock to client X. Client X now sends the close message across the network, event 13.</span></span> <span data-ttu-id="8bb12-201">L'evento 14 segue quando il server apre il file per il client Y. L'applicazione sul client X ha chiuso il file, pertanto non viene più trasferito da o verso il server per tale file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-201">Event 14 follows as the server opens the file for client Y. The application on client X has closed the file, so it does no more transfers to or from the server for that file.</span></span> <span data-ttu-id="8bb12-202">Il client Y avvia i trasferimenti di dati come di consueto nell'evento 15.</span><span class="sxs-lookup"><span data-stu-id="8bb12-202">Client Y begins data transfers as usual in event 15.</span></span>

<span data-ttu-id="8bb12-203">Tra il momento in cui il client X viene concesso il blocco sul file nell'evento 2 e la chiusura finale dell'evento 13, i dati dei file che il client ha memorizzato nella cache sono validi, nonostante le operazioni di apertura e chiusura dell'applicazione coinvolte.</span><span class="sxs-lookup"><span data-stu-id="8bb12-203">Between the time client X is granted the lock on the file in event 2 and the final close at event 13, any file data that the client has cached is valid, in spite of the intervening application open and close operations.</span></span> <span data-ttu-id="8bb12-204">Tuttavia, dopo che il blocco opportunistico è stato danneggiato, i dati memorizzati nella cache non possono essere considerati validi.</span><span class="sxs-lookup"><span data-stu-id="8bb12-204">However, after the opportunistic lock is broken, cached data cannot be considered valid.</span></span>

## <a name="filter-opportunistic-lock"></a><span data-ttu-id="8bb12-205">Filtra blocco opportunistico</span><span class="sxs-lookup"><span data-stu-id="8bb12-205">Filter Opportunistic Lock</span></span>

<span data-ttu-id="8bb12-206">Il diagramma seguente mostra una visualizzazione del traffico di rete di un blocco opportunistico di filtro.</span><span class="sxs-lookup"><span data-stu-id="8bb12-206">The following diagram shows a network-traffic view of a filter opportunistic lock.</span></span> <span data-ttu-id="8bb12-207">Le frecce indicano la direzione dello spostamento dei dati, se disponibile.</span><span class="sxs-lookup"><span data-stu-id="8bb12-207">The arrows indicate the direction of data movement, if any.</span></span>



| <span data-ttu-id="8bb12-208">Evento</span><span class="sxs-lookup"><span data-stu-id="8bb12-208">Event</span></span> | <span data-ttu-id="8bb12-209">Client X</span><span class="sxs-lookup"><span data-stu-id="8bb12-209">Client X</span></span>                                | <span data-ttu-id="8bb12-210">Server</span><span class="sxs-lookup"><span data-stu-id="8bb12-210">Server</span></span>                   | <span data-ttu-id="8bb12-211">Y client</span><span class="sxs-lookup"><span data-stu-id="8bb12-211">Client Y</span></span>                    |
|-------|-----------------------------------------|--------------------------|-----------------------------|
| <span data-ttu-id="8bb12-212">1</span><span class="sxs-lookup"><span data-stu-id="8bb12-212">1</span></span>     | <span data-ttu-id="8bb12-213">Apre il file senza diritti di accesso = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-213">Opens file with no access rights ==></span></span> |                          |                             |
| <span data-ttu-id="8bb12-214">2</span><span class="sxs-lookup"><span data-stu-id="8bb12-214">2</span></span>     |                                         | <span data-ttu-id="8bb12-215"><= = apre il file</span><span class="sxs-lookup"><span data-stu-id="8bb12-215"><== Opens the file</span></span>    |                             |
| <span data-ttu-id="8bb12-216">3</span><span class="sxs-lookup"><span data-stu-id="8bb12-216">3</span></span>     | <span data-ttu-id="8bb12-217">Richieste di blocco filtro = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-217">Requests filter lock==></span></span>              |                          |                             |
| <span data-ttu-id="8bb12-218">4</span><span class="sxs-lookup"><span data-stu-id="8bb12-218">4</span></span>     |                                         | <span data-ttu-id="8bb12-219"><= = il blocco viene concesso</span><span class="sxs-lookup"><span data-stu-id="8bb12-219"><== Grants lock</span></span>       |                             |
| <span data-ttu-id="8bb12-220">5</span><span class="sxs-lookup"><span data-stu-id="8bb12-220">5</span></span>     | <span data-ttu-id="8bb12-221">Apre il file per la lettura = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-221">Opens file for reading ==></span></span>           |                          |                             |
| <span data-ttu-id="8bb12-222">6</span><span class="sxs-lookup"><span data-stu-id="8bb12-222">6</span></span>     |                                         | <span data-ttu-id="8bb12-223"><= = riapre il file</span><span class="sxs-lookup"><span data-stu-id="8bb12-223"><== Reopens the file</span></span>  |                             |
| <span data-ttu-id="8bb12-224">7</span><span class="sxs-lookup"><span data-stu-id="8bb12-224">7</span></span>     | <span data-ttu-id="8bb12-225">Legge i dati usando l'handle di lettura = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-225">Reads data using the read handle ==></span></span> |                          |                             |
| <span data-ttu-id="8bb12-226">8</span><span class="sxs-lookup"><span data-stu-id="8bb12-226">8</span></span>     |                                         | <span data-ttu-id="8bb12-227"><= = invia dati</span><span class="sxs-lookup"><span data-stu-id="8bb12-227"><== Sends data</span></span>        |                             |
| <span data-ttu-id="8bb12-228">9</span><span class="sxs-lookup"><span data-stu-id="8bb12-228">9</span></span>     |                                         | <span data-ttu-id="8bb12-229"><= = invia dati</span><span class="sxs-lookup"><span data-stu-id="8bb12-229"><== Sends data</span></span>        |                             |
| <span data-ttu-id="8bb12-230">10</span><span class="sxs-lookup"><span data-stu-id="8bb12-230">10</span></span>    |                                         | <span data-ttu-id="8bb12-231"><= = invia dati</span><span class="sxs-lookup"><span data-stu-id="8bb12-231"><== Sends data</span></span>        |                             |
| <span data-ttu-id="8bb12-232">11</span><span class="sxs-lookup"><span data-stu-id="8bb12-232">11</span></span>    |                                         |                          | <span data-ttu-id="8bb12-233"><= = apre il file</span><span class="sxs-lookup"><span data-stu-id="8bb12-233"><== Opens the file</span></span>       |
| <span data-ttu-id="8bb12-234">12</span><span class="sxs-lookup"><span data-stu-id="8bb12-234">12</span></span>    |                                         | <span data-ttu-id="8bb12-235">Apre il file = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-235">Opens the file ==></span></span>    |                             |
| <span data-ttu-id="8bb12-236">13</span><span class="sxs-lookup"><span data-stu-id="8bb12-236">13</span></span>    |                                         |                          | <span data-ttu-id="8bb12-237"><= = blocco filtro richieste</span><span class="sxs-lookup"><span data-stu-id="8bb12-237"><== Requests filter lock</span></span> |
| <span data-ttu-id="8bb12-238">14</span><span class="sxs-lookup"><span data-stu-id="8bb12-238">14</span></span>    |                                         | <span data-ttu-id="8bb12-239">Nega il blocco del filtro = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-239">Denies filter lock==></span></span> |                             |
| <span data-ttu-id="8bb12-240">15</span><span class="sxs-lookup"><span data-stu-id="8bb12-240">15</span></span>    |                                         |                          | <span data-ttu-id="8bb12-241"><= = legge i dati</span><span class="sxs-lookup"><span data-stu-id="8bb12-241"><== Reads data</span></span>           |
| <span data-ttu-id="8bb12-242">16</span><span class="sxs-lookup"><span data-stu-id="8bb12-242">16</span></span>    |                                         | <span data-ttu-id="8bb12-243">Invia dati = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-243">Sends data ==></span></span>        |                             |
| <span data-ttu-id="8bb12-244">17</span><span class="sxs-lookup"><span data-stu-id="8bb12-244">17</span></span>    | <span data-ttu-id="8bb12-245">Lettura dati (memorizzati nella cache)</span><span class="sxs-lookup"><span data-stu-id="8bb12-245">Reads (cached) data</span></span>                     |                          |                             |
| <span data-ttu-id="8bb12-246">18</span><span class="sxs-lookup"><span data-stu-id="8bb12-246">18</span></span>    | <span data-ttu-id="8bb12-247">Chiude il file = =></span><span class="sxs-lookup"><span data-stu-id="8bb12-247">Closes file ==></span></span>                      |                          |                             |
| <span data-ttu-id="8bb12-248">19</span><span class="sxs-lookup"><span data-stu-id="8bb12-248">19</span></span>    |                                         |                          | <span data-ttu-id="8bb12-249"><= = chiude il file</span><span class="sxs-lookup"><span data-stu-id="8bb12-249"><== Closes file</span></span>          |



 

<span data-ttu-id="8bb12-250">Nel filtro di blocco opportunistico, client X apre un file, evento 1, e il server risponde nell'evento 2.</span><span class="sxs-lookup"><span data-stu-id="8bb12-250">In the filter opportunistic lock, client X opens a file, event 1, and the server responds in event 2.</span></span> <span data-ttu-id="8bb12-251">Il client richiede quindi un blocco opportunistico di filtro nell'evento 3, seguito dal server che concede il blocco opportunistico nell'evento 4.</span><span class="sxs-lookup"><span data-stu-id="8bb12-251">The client then requests a filter opportunistic lock in event 3, followed by the server granting the opportunistic lock in event 4.</span></span> <span data-ttu-id="8bb12-252">Il client X riapre quindi il file per la lettura nell'evento 5, a cui il server risponde nell'evento 6.</span><span class="sxs-lookup"><span data-stu-id="8bb12-252">Client X then opens the file again for reading in event 5, to which the server responds in event 6.</span></span> <span data-ttu-id="8bb12-253">Il client tenta quindi di leggere i dati, a cui il server risponde con i dati, evento 8.</span><span class="sxs-lookup"><span data-stu-id="8bb12-253">The client then attempts to read data, to which the server responds with data, event 8.</span></span>

<span data-ttu-id="8bb12-254">L'evento 9 Mostra il filtro di blocco opportunistico al lavoro.</span><span class="sxs-lookup"><span data-stu-id="8bb12-254">Event 9 shows the filter opportunistic lock at work.</span></span> <span data-ttu-id="8bb12-255">Il server legge il client e invia i dati attraverso la rete anche se il client non lo ha richiesto.</span><span class="sxs-lookup"><span data-stu-id="8bb12-255">The server reads ahead of the client and sends the data over the network even though the client has not requested it.</span></span> <span data-ttu-id="8bb12-256">Il client memorizza nella cache i dati.</span><span class="sxs-lookup"><span data-stu-id="8bb12-256">The client caches the data.</span></span> <span data-ttu-id="8bb12-257">Nell'evento 10, il server prevede anche una richiesta futura di dati e invia un'altra parte del file per la cache del client.</span><span class="sxs-lookup"><span data-stu-id="8bb12-257">In event 10, the server also anticipates a future request for data and sends another portion of the file for the client to cache.</span></span>

<span data-ttu-id="8bb12-258">Negli eventi 11 e 12, un altro client, Y, apre il file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-258">In event 11 and 12, another client, Y, opens the file.</span></span> <span data-ttu-id="8bb12-259">Il client Y richiede anche un blocco opportunistico di filtro.</span><span class="sxs-lookup"><span data-stu-id="8bb12-259">Client Y also requests a filter opportunistic lock.</span></span> <span data-ttu-id="8bb12-260">Nell'evento 14 il server lo nega.</span><span class="sxs-lookup"><span data-stu-id="8bb12-260">In event 14, the server denies it.</span></span> <span data-ttu-id="8bb12-261">Nell'evento 15, il client Y richiede i dati, inviati dal server nell'evento 16.</span><span class="sxs-lookup"><span data-stu-id="8bb12-261">In event 15, client Y requests data, which the server sends in event 16.</span></span> <span data-ttu-id="8bb12-262">Nessuno di questi influisca sul client X. In qualsiasi momento, un altro client può aprire questo file per l'accesso in lettura.</span><span class="sxs-lookup"><span data-stu-id="8bb12-262">None of this affects client X. At any time, another client can open this file for read access.</span></span> <span data-ttu-id="8bb12-263">Nessun altro client influisca sul blocco del filtro del client X.</span><span class="sxs-lookup"><span data-stu-id="8bb12-263">No other client affects client X's filter lock.</span></span>

<span data-ttu-id="8bb12-264">L'evento 17 Mostra la lettura dei dati da client X.</span><span class="sxs-lookup"><span data-stu-id="8bb12-264">Event 17 shows client X reading data.</span></span> <span data-ttu-id="8bb12-265">Tuttavia, poiché il server ha già inviato i dati e il client lo ha memorizzato nella cache, nessun traffico attraversa la rete.</span><span class="sxs-lookup"><span data-stu-id="8bb12-265">However, because the server has already sent the data and the client has cached it, no traffic crosses the network.</span></span>

<span data-ttu-id="8bb12-266">In questo esempio, client X non tenta mai di leggere tutti i dati nel file, quindi il read-ahead indicato dagli eventi 9 e 10 è "Wasted"; ovvero i dati non vengono mai usati effettivamente.</span><span class="sxs-lookup"><span data-stu-id="8bb12-266">In this example, client X never tries to read all the data in the file, so the read-ahead indicated by events 9 and 10 is "wasted"; that is, the data is never actually used.</span></span> <span data-ttu-id="8bb12-267">Si tratta di una perdita accettabile perché il read-ahead ha accelerato l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="8bb12-267">This is an acceptable loss because the read-ahead has sped up the application.</span></span>

<span data-ttu-id="8bb12-268">Nell'evento 18, client X chiude il file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-268">In event 18, client X closes the file.</span></span> <span data-ttu-id="8bb12-269">Il redirector di rete del client abbandona i dati memorizzati nella cache.</span><span class="sxs-lookup"><span data-stu-id="8bb12-269">The client's network redirector abandons the cached data.</span></span> <span data-ttu-id="8bb12-270">Il server chiude il file.</span><span class="sxs-lookup"><span data-stu-id="8bb12-270">The server closes the file.</span></span>

 

 



