---
description: Un blocco opportunistico (detto anche blocco opportunistico) è un blocco inserito da un client in un file che risiede in un server.
ms.assetid: b4c2f5f0-a29b-4598-a49b-da99e93d2991
title: Blocchi opportunistici
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: faec833caae05bff247a7a3655885b1a967f3435
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103752399"
---
# <a name="opportunistic-locks"></a><span data-ttu-id="b5b79-103">Blocchi opportunistici</span><span class="sxs-lookup"><span data-stu-id="b5b79-103">Opportunistic Locks</span></span>

<span data-ttu-id="b5b79-104">Un blocco opportunistico (detto anche blocco opportunistico) è un blocco inserito da un client in un file che risiede in un server.</span><span class="sxs-lookup"><span data-stu-id="b5b79-104">An opportunistic lock (also called an oplock) is a lock placed by a client on a file residing on a server.</span></span> <span data-ttu-id="b5b79-105">Nella maggior parte dei casi, un client richiede un blocco opportunistico per poter memorizzare i dati nella cache localmente, riducendo così il traffico di rete e migliorando il tempo di risposta apparente.</span><span class="sxs-lookup"><span data-stu-id="b5b79-105">In most cases, a client requests an opportunistic lock so it can cache data locally, thus reducing network traffic and improving apparent response time.</span></span> <span data-ttu-id="b5b79-106">I blocchi opportunistici vengono usati dai redirector di rete nei client con server remoti, nonché dalle applicazioni client nei server locali.</span><span class="sxs-lookup"><span data-stu-id="b5b79-106">Opportunistic locks are used by network redirectors on clients with remote servers, as well as by client applications on local servers.</span></span>

<span data-ttu-id="b5b79-107">I blocchi opportunistici coordinano la memorizzazione dei dati nella cache e coerenza tra client e server e tra più client.</span><span class="sxs-lookup"><span data-stu-id="b5b79-107">Opportunistic locks coordinate data caching and coherency between clients and servers and among multiple clients.</span></span> <span data-ttu-id="b5b79-108">I dati coerenti sono dati identici in tutta la rete.</span><span class="sxs-lookup"><span data-stu-id="b5b79-108">Data that is coherent is data that is the same across the network.</span></span> <span data-ttu-id="b5b79-109">In altre parole, se i dati sono coerenti, i dati nel server e in tutti i client vengono sincronizzati.</span><span class="sxs-lookup"><span data-stu-id="b5b79-109">In other words, if data is coherent, data on the server and all the clients is synchronized.</span></span>

<span data-ttu-id="b5b79-110">I blocchi opportunistici non sono comandi da parte del client al server.</span><span class="sxs-lookup"><span data-stu-id="b5b79-110">Opportunistic locks are not commands by the client to the server.</span></span> <span data-ttu-id="b5b79-111">Si tratta di richieste inviate dal client al server.</span><span class="sxs-lookup"><span data-stu-id="b5b79-111">They are requests from the client to the server.</span></span> <span data-ttu-id="b5b79-112">Dal punto di vista del client, sono opportunistiche.</span><span class="sxs-lookup"><span data-stu-id="b5b79-112">From the point of view of the client, they are opportunistic.</span></span> <span data-ttu-id="b5b79-113">In altre parole, il server concede tali blocchi ogni volta che gli altri fattori rendono possibili i blocchi.</span><span class="sxs-lookup"><span data-stu-id="b5b79-113">In other words, the server grants such locks whenever other factors make the locks possible.</span></span>

<span data-ttu-id="b5b79-114">Quando un'applicazione locale richiede l'accesso a un file remoto, l'implementazione dei blocchi opportunistici è trasparente per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b5b79-114">When a local application requests access to a remote file, the implementation of opportunistic locks is transparent to the application.</span></span> <span data-ttu-id="b5b79-115">Il redirector di rete e il server hanno richiesto di aprire e chiudere automaticamente i blocchi opportunistici.</span><span class="sxs-lookup"><span data-stu-id="b5b79-115">The network redirector and the server involved open and close the opportunistic locks automatically.</span></span> <span data-ttu-id="b5b79-116">Tuttavia, i blocchi opportunistici possono essere usati anche quando un'applicazione locale richiede l'accesso a un file locale e l'accesso da parte di altre applicazioni e processi deve essere delegato per impedire il danneggiamento del file.</span><span class="sxs-lookup"><span data-stu-id="b5b79-116">However, opportunistic locks can also be used when a local application requests access to a local file, and access by other applications and processes must be delegated to prevent corruption of the file.</span></span> <span data-ttu-id="b5b79-117">In questo caso, l'applicazione locale richiede direttamente un blocco opportunistico dalla file system locale e memorizza nella cache il file localmente.</span><span class="sxs-lookup"><span data-stu-id="b5b79-117">In this case, the local application directly requests an opportunistic lock from the local file system and caches the file locally.</span></span> <span data-ttu-id="b5b79-118">Quando viene usato in questo modo, il blocco opportunistico è effettivamente un semaforo gestito dal server locale e viene usato principalmente per i dati coerenza nella notifica di accesso ai file e ai file.</span><span class="sxs-lookup"><span data-stu-id="b5b79-118">When used in this way, the opportunistic lock is effectively a semaphore managed by the local server, and is mainly used for the purposes of data coherency in the file and file access notification.</span></span>

<span data-ttu-id="b5b79-119">Prima di usare i blocchi opportunistici nell'applicazione, è necessario avere familiarità con le modalità di accesso e condivisione dei file descritte in [creazione e apertura di file](creating-and-opening-files.md).</span><span class="sxs-lookup"><span data-stu-id="b5b79-119">Before using opportunistic locks in your application, you should be familiar with the file access and sharing modes described in [Creating and Opening Files](creating-and-opening-files.md).</span></span>

<span data-ttu-id="b5b79-120">Il numero massimo di blocchi opportunistici simultanei che è possibile creare è limitato solo dalla quantità di memoria disponibile.</span><span class="sxs-lookup"><span data-stu-id="b5b79-120">The maximum number of concurrent opportunistic locks that you can create is limited only by the amount of available memory.</span></span>

<span data-ttu-id="b5b79-121">Le applicazioni locali non devono tentare di richiedere blocchi opportunistici da server remoti.</span><span class="sxs-lookup"><span data-stu-id="b5b79-121">Local applications should not attempt to request opportunistic locks from remote servers.</span></span> <span data-ttu-id="b5b79-122">Se viene effettuato un tentativo di eseguire questa operazione, verrà restituito un errore da [**DeviceIoControl**](/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol) .</span><span class="sxs-lookup"><span data-stu-id="b5b79-122">An error will be returned by [**DeviceIoControl**](/windows/desktop/api/ioapiset/nf-ioapiset-deviceiocontrol) if an attempt is made to do this.</span></span>

<span data-ttu-id="b5b79-123">I blocchi opportunistici sono di uso molto limitato per le applicazioni.</span><span class="sxs-lookup"><span data-stu-id="b5b79-123">Opportunistic locks are of very limited use for applications.</span></span> <span data-ttu-id="b5b79-124">L'unico utilizzo pratico consiste nel testare un redirector di rete o un gestore di blocco opportunistico del server.</span><span class="sxs-lookup"><span data-stu-id="b5b79-124">The only practical use is to test a network redirector or a server opportunistic lock handler.</span></span> <span data-ttu-id="b5b79-125">In genere, i file System implementano il supporto per i blocchi opportunistici.</span><span class="sxs-lookup"><span data-stu-id="b5b79-125">Typically, file systems implement support for opportunistic locks.</span></span> <span data-ttu-id="b5b79-126">Le applicazioni in genere lasciano la gestione dei blocchi opportunistici ai driver file system.</span><span class="sxs-lookup"><span data-stu-id="b5b79-126">Applications generally leave opportunistic lock management to the file system drivers.</span></span> <span data-ttu-id="b5b79-127">Chiunque implementi un file system deve usare il [kit del file system installabile (IFS)](https://www.microsoft.com/whdc/devtools/ifskit/default.mspx).</span><span class="sxs-lookup"><span data-stu-id="b5b79-127">Anyone implementing a file system should use the [Installable File System (IFS) Kit](https://www.microsoft.com/whdc/devtools/ifskit/default.mspx).</span></span> <span data-ttu-id="b5b79-128">Chiunque sviluppi un driver di dispositivo diverso da un file system installabile deve utilizzare [Windows Driver Kit (WDK)](https://www.microsoft.com/?ref=go).</span><span class="sxs-lookup"><span data-stu-id="b5b79-128">Anyone developing a device driver other than an installable file system should use the [Windows Driver Kit (WDK)](https://www.microsoft.com/?ref=go).</span></span>

<span data-ttu-id="b5b79-129">I blocchi opportunistici e le operazioni associate sono un superset della parte di blocco opportunistica del protocollo CIFS (Common Internet file System), una bozza Internet.</span><span class="sxs-lookup"><span data-stu-id="b5b79-129">Opportunistic locks and the associated operations are a superset of the opportunistic lock portion of the Common Internet File System (CIFS) protocol, an Internet Draft.</span></span> <span data-ttu-id="b5b79-130">Il protocollo CIFS è una versione migliorata del protocollo SMB (Server Message Block).</span><span class="sxs-lookup"><span data-stu-id="b5b79-130">The CIFS protocol is an enhanced version of the Server Message Block (SMB) protocol.</span></span> <span data-ttu-id="b5b79-131">Per altre informazioni, vedere [Cenni preliminari sul protocollo Microsoft SMB e sul protocollo CIFS](microsoft-smb-protocol-and-cifs-protocol-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b5b79-131">For more information, see [Microsoft SMB Protocol and CIFS Protocol Overview](microsoft-smb-protocol-and-cifs-protocol-overview.md).</span></span> <span data-ttu-id="b5b79-132">La bozza Internet CIFS indica in modo esplicito che un'implementazione di CIFS può implementare blocchi opportunistici rifiutando di concederli.</span><span class="sxs-lookup"><span data-stu-id="b5b79-132">The CIFS Internet Draft explicitly identifies that a CIFS implementation may implement opportunistic locks by refusing to grant them.</span></span>

<span data-ttu-id="b5b79-133">Gli argomenti seguenti identificano i blocchi opportunistici.</span><span class="sxs-lookup"><span data-stu-id="b5b79-133">The following topics identify opportunistic locks.</span></span>

## <a name="in-this-section"></a><span data-ttu-id="b5b79-134">Contenuto della sezione</span><span class="sxs-lookup"><span data-stu-id="b5b79-134">In this section</span></span>



| <span data-ttu-id="b5b79-135">Argomento</span><span class="sxs-lookup"><span data-stu-id="b5b79-135">Topic</span></span>                                                                                                               | <span data-ttu-id="b5b79-136">Descrizione</span><span class="sxs-lookup"><span data-stu-id="b5b79-136">Description</span></span>                                                                                                                                                                                                                                                                                       |
|---------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [<span data-ttu-id="b5b79-137">Caching locale</span><span class="sxs-lookup"><span data-stu-id="b5b79-137">Local Caching</span></span>](local-caching.md)<br/>                                                                       | <span data-ttu-id="b5b79-138">La *memorizzazione nella cache locale* dei dati è una tecnica che consente di velocizzare l'accesso alla rete ai file di dati.</span><span class="sxs-lookup"><span data-stu-id="b5b79-138">*Local caching* of data is a technique used to speed network access to data files.</span></span> <span data-ttu-id="b5b79-139">Comporta la memorizzazione nella cache dei dati nei client anziché nei server, quando possibile.</span><span class="sxs-lookup"><span data-stu-id="b5b79-139">It involves caching data on clients rather than on servers when possible.</span></span><br/>                                                                                                                           |
| [<span data-ttu-id="b5b79-140">Coerenza dati</span><span class="sxs-lookup"><span data-stu-id="b5b79-140">Data Coherency</span></span>](data-coherency.md)<br/>                                                                     | <span data-ttu-id="b5b79-141">Se i dati sono coerenti, i dati nel server e in tutti i client vengono sincronizzati.</span><span class="sxs-lookup"><span data-stu-id="b5b79-141">If data is coherent, data on the server and all the clients is synchronized.</span></span> <span data-ttu-id="b5b79-142">Un tipo di sistema software che fornisce dati coerenza è un sistema di controllo delle revisioni (RCS).</span><span class="sxs-lookup"><span data-stu-id="b5b79-142">One type of software system that provides data coherency is a revision control system (RCS).</span></span><br/>                                                                                                              |
| [<span data-ttu-id="b5b79-143">Come richiedere un blocco opportunistico</span><span class="sxs-lookup"><span data-stu-id="b5b79-143">How to Request an Opportunistic Lock</span></span>](how-to-request-an-opportunistic-lock.md)<br/>                         | <span data-ttu-id="b5b79-144">I blocchi opportunistici vengono richiesti aprendo prima un file con le autorizzazioni e i flag appropriati all'applicazione per l'apertura del file.</span><span class="sxs-lookup"><span data-stu-id="b5b79-144">Opportunistic locks are requested by first opening a file with permissions and flags appropriate to the application opening the file.</span></span> <span data-ttu-id="b5b79-145">Tutti i file per i quali verranno richiesti blocchi opportunistici devono essere aperti per operazioni sovrapposte (asincrone).</span><span class="sxs-lookup"><span data-stu-id="b5b79-145">All files for which opportunistic locks will be requested must be opened for overlapped (asynchronous) operation.</span></span><br/>                                |
| [<span data-ttu-id="b5b79-146">Risposta server per l'apertura di richieste su file bloccati</span><span class="sxs-lookup"><span data-stu-id="b5b79-146">Server Response to Open Requests on Locked Files</span></span>](server-response-to-open-requests-on-locked-files.md)<br/> | <span data-ttu-id="b5b79-147">È possibile ridurre al minimo l'impatto dell'applicazione su altri client e l'impatto che hanno sull'applicazione concedendo il maggior numero possibile di condivisione, richiedendo il livello di accesso minimo necessario e usando il blocco opportunistico meno intrusivo adatto all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b5b79-147">You can minimize the impact your application has on other clients and the impact they have on your application by granting as much sharing as possible, requesting the minimum access level necessary, and using the least intrusive opportunistic lock suitable for your application.</span></span><br/> |
| [<span data-ttu-id="b5b79-148">Tipi di blocchi opportunistici</span><span class="sxs-lookup"><span data-stu-id="b5b79-148">Types of Opportunistic Locks</span></span>](types-of-opportunistic-locks.md)<br/>                                         | <span data-ttu-id="b5b79-149">Descrive i blocchi opportunistici di livello 1, livello 2, batch e filtro.</span><span class="sxs-lookup"><span data-stu-id="b5b79-149">Describes level 1, level 2, batch, and filter opportunistic locks.</span></span><br/>                                                                                                                                                                                                                     |
| [<span data-ttu-id="b5b79-150">Interruzioni di blocchi opportunistici</span><span class="sxs-lookup"><span data-stu-id="b5b79-150">Breaking Opportunistic Locks</span></span>](breaking-opportunistic-locks.md)<br/>                                         | <span data-ttu-id="b5b79-151">Suddividere un blocco opportunistico è il processo di riduzione del blocco di un client in un file in modo che un altro client possa aprire il file, con o senza un blocco opportunistico.</span><span class="sxs-lookup"><span data-stu-id="b5b79-151">Breaking an opportunistic lock is the process of degrading the lock that one client has on a file so that another client can open the file, with or without an opportunistic lock.</span></span><br/>                                                                                                     |
| [<span data-ttu-id="b5b79-152">Esempi di blocco opportunistico</span><span class="sxs-lookup"><span data-stu-id="b5b79-152">Opportunistic Lock Examples</span></span>](opportunistic-lock-examples.md)<br/>                                           | <span data-ttu-id="b5b79-153">Diagrammi delle visualizzazioni di traffico di rete per un blocco opportunistico di livello 1, un blocco opportunistico batch e un blocco opportunistico di filtro.</span><span class="sxs-lookup"><span data-stu-id="b5b79-153">Diagrams of network-traffic views for a level 1 opportunistic lock, a batch opportunistic lock, and a filter opportunistic lock.</span></span><br/>                                                                                                                                                       |
| [<span data-ttu-id="b5b79-154">Operazioni di blocco opportunistiche</span><span class="sxs-lookup"><span data-stu-id="b5b79-154">Opportunistic Lock Operations</span></span>](opportunistic-lock-operations.md)<br/>                                       | <span data-ttu-id="b5b79-155">Se un'applicazione richiede blocchi opportunistici, è necessario aprire tutti i file per cui richiede blocchi per l'input e l'output sovrapposti usando la funzione [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) con il flag **file \_ \_ sovrapposto** .</span><span class="sxs-lookup"><span data-stu-id="b5b79-155">If an application requests opportunistic locks, all files for which it requests locks must be opened for overlapped (asynchronous) input and output by using the [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea) function with the **FILE\_FLAG\_OVERLAPPED** flag.</span></span><br/>                                   |



 

<span data-ttu-id="b5b79-156">Per ulteriori informazioni sui blocchi opportunistici, vedere il documento CIFS Internet bozza.</span><span class="sxs-lookup"><span data-stu-id="b5b79-156">For additional information about opportunistic locks, see the CIFS Internet Draft document.</span></span> <span data-ttu-id="b5b79-157">Eventuali discrepanze tra questo argomento e la bozza Internet CIFS corrente devono essere risolte a favore della bozza Internet CIFS.</span><span class="sxs-lookup"><span data-stu-id="b5b79-157">Any discrepancies between this topic and the current CIFS Internet Draft should be resolved in favor of the CIFS Internet Draft.</span></span>

 

