---
description: Gestione degli handle di file transazionali in NTFS transazionale.
ms.assetid: 29879a3f-14b4-462c-a001-46c3c3eb74d1
title: Come utilizzare Transactional NTFS
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 43681f0d5b27f0db03d8b6c44564b792fce4b467
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106317786"
---
# <a name="how-to-use-transactional-ntfs"></a><span data-ttu-id="e4a68-103">Come utilizzare Transactional NTFS</span><span class="sxs-lookup"><span data-stu-id="e4a68-103">How to Use Transactional NTFS</span></span>

## <a name="transacted-file-handles"></a><span data-ttu-id="e4a68-104">Handle di file transazionali</span><span class="sxs-lookup"><span data-stu-id="e4a68-104">Transacted File Handles</span></span>

<span data-ttu-id="e4a68-105">Transactional NTFS (TxF) associa un handle di file a una transazione.</span><span class="sxs-lookup"><span data-stu-id="e4a68-105">Transactional NTFS (TxF) binds a file handle to a transaction.</span></span> <span data-ttu-id="e4a68-106">Per le operazioni che funzionano su un handle (ad esempio, le funzioni [**ReadFile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile) e [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) ), la chiamata di funzione API effettiva non cambia.</span><span class="sxs-lookup"><span data-stu-id="e4a68-106">For operations that work on a handle (for example, the [**ReadFile**](/windows/desktop/api/FileAPI/nf-fileapi-readfile) and [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) functions), the actual API function call does not change.</span></span> <span data-ttu-id="e4a68-107">Per le operazioni sui file che accettano un nome, sono disponibili funzioni transazionali esplicite per queste operazioni.</span><span class="sxs-lookup"><span data-stu-id="e4a68-107">For file operations that take a name, there are explicit transacted functions for these operations.</span></span> <span data-ttu-id="e4a68-108">Ad esempio, invece di chiamare [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), chiamare [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span><span class="sxs-lookup"><span data-stu-id="e4a68-108">For example, instead of calling [**CreateFile**](/windows/desktop/api/FileAPI/nf-fileapi-createfilea), call [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span></span> <span data-ttu-id="e4a68-109">Viene creato un handle di file transazionale, che può quindi essere usato per tutte le operazioni sui file che richiedono un handle.</span><span class="sxs-lookup"><span data-stu-id="e4a68-109">This creates a transacted file handle, which can then be used for all file operations requiring a handle.</span></span> <span data-ttu-id="e4a68-110">Tutte le operazioni successive che usano questo handle sono operazioni transazionali.</span><span class="sxs-lookup"><span data-stu-id="e4a68-110">All subsequent operations using this handle are transacted operations.</span></span>

## <a name="basic-txf-usage"></a><span data-ttu-id="e4a68-111">Utilizzo TxF di base</span><span class="sxs-lookup"><span data-stu-id="e4a68-111">Basic TxF Usage</span></span>

<span data-ttu-id="e4a68-112">La serie di passaggi seguente rappresenta l'utilizzo più semplice per TxF.</span><span class="sxs-lookup"><span data-stu-id="e4a68-112">The following series of steps represents the most basic usage for TxF.</span></span> <span data-ttu-id="e4a68-113">Sono supportati anche scenari più complessi, a discrezione di progettazione applicazioni.</span><span class="sxs-lookup"><span data-stu-id="e4a68-113">More complex scenarios are also supported, at the discretion of the application designer.</span></span>

1.  <span data-ttu-id="e4a68-114">Creare una transazione chiamando la funzione KTM [**CreateTransaction**](/windows/desktop/api/ktmw32/nf-ktmw32-createtransaction) o usando l'interfaccia **IKernelTransaction** del [Distributed Transaction Coordinator](/previous-versions/windows/desktop/mscs/distributed-transaction-coordinator) (DTC).</span><span class="sxs-lookup"><span data-stu-id="e4a68-114">Create a transaction by calling the KTM function [**CreateTransaction**](/windows/desktop/api/ktmw32/nf-ktmw32-createtransaction) or by using the **IKernelTransaction** interface of the [Distributed Transaction Coordinator](/previous-versions/windows/desktop/mscs/distributed-transaction-coordinator) (DTC).</span></span>
2.  <span data-ttu-id="e4a68-115">Ottenere handle di file transazionali chiamando [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span><span class="sxs-lookup"><span data-stu-id="e4a68-115">Get transacted file handle(s) by calling [**CreateFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-createfiletransacteda).</span></span>
3.  <span data-ttu-id="e4a68-116">Modificare i file in base alle esigenze usando gli handle di file transazionali.</span><span class="sxs-lookup"><span data-stu-id="e4a68-116">Modify the file(s) as necessary using the transacted file handle(s).</span></span>
4.  <span data-ttu-id="e4a68-117">Chiudere tutti gli handle di file transazionali associati alla transazione creata nel passaggio 1.</span><span class="sxs-lookup"><span data-stu-id="e4a68-117">Close all transacted file handles associated with the transaction created in step 1.</span></span>
5.  <span data-ttu-id="e4a68-118">Eseguire il commit o interrompere la transazione chiamando la funzione KTM o DTC corrispondente.</span><span class="sxs-lookup"><span data-stu-id="e4a68-118">Commit or abort the transaction by calling the corresponding KTM or DTC function.</span></span>

## <a name="key-points-of-the-txf-programming-model"></a><span data-ttu-id="e4a68-119">Punti chiave del modello di programmazione TxF</span><span class="sxs-lookup"><span data-stu-id="e4a68-119">Key Points of the TxF Programming Model</span></span>

<span data-ttu-id="e4a68-120">Il modello di programmazione TxF presenta i punti chiave seguenti da considerare quando si sviluppa un'applicazione TxF:</span><span class="sxs-lookup"><span data-stu-id="e4a68-120">The TxF programming model has the following key points for you to consider when you develop a TxF application:</span></span>

-   <span data-ttu-id="e4a68-121">Si consiglia vivamente che un'applicazione chiuda tutti gli handle di file transazionali prima di eseguire il commit o il rollback di una transazione.</span><span class="sxs-lookup"><span data-stu-id="e4a68-121">It is highly recommended that an application close all transacted file handles before committing or rolling back a transaction.</span></span> <span data-ttu-id="e4a68-122">Il sistema invalida tutti gli handle transazionali al termine di una transazione.</span><span class="sxs-lookup"><span data-stu-id="e4a68-122">The system invalidates all transacted handles when a transaction ends.</span></span> <span data-ttu-id="e4a68-123">Qualsiasi operazione, eccetto Close, eseguita su un handle transazionale dopo la fine della transazione restituisce il seguente errore: l' **handle di errore \_ non è \_ \_ più \_ valido**.</span><span class="sxs-lookup"><span data-stu-id="e4a68-123">Any operation, except close, performed on a transacted handle after the transaction ends returns the following error: **ERROR\_HANDLE\_NO\_LONGER\_VALID**.</span></span>
-   <span data-ttu-id="e4a68-124">Un file viene visualizzato come unità di archiviazione.</span><span class="sxs-lookup"><span data-stu-id="e4a68-124">A file is viewed as a unit of storage.</span></span> <span data-ttu-id="e4a68-125">Sono supportati gli aggiornamenti parziali e le sovrascritture di file completi.</span><span class="sxs-lookup"><span data-stu-id="e4a68-125">Partial updates and complete file overwrites are supported.</span></span> <span data-ttu-id="e4a68-126">Più transazioni non possono modificare contemporaneamente lo stesso file.</span><span class="sxs-lookup"><span data-stu-id="e4a68-126">Multiple transactions cannot concurrently modify the same file.</span></span>
-   <span data-ttu-id="e4a68-127">L'I/O mappato alla memoria è trasparente e coerente con l'i/O dei file normali.</span><span class="sxs-lookup"><span data-stu-id="e4a68-127">Memory mapped I/O is transparent and consistent with the regular file I/O.</span></span> <span data-ttu-id="e4a68-128">Un'applicazione deve scaricare e chiudere una sezione aperta prima di eseguire il commit di una transazione.</span><span class="sxs-lookup"><span data-stu-id="e4a68-128">An application must flush and close an opened section before committing a transaction.</span></span> <span data-ttu-id="e4a68-129">In caso contrario, è possibile che vengano apportate modifiche parziali al file mappato all'interno della transazione.</span><span class="sxs-lookup"><span data-stu-id="e4a68-129">Failure to do this can result in partial changes to the mapped file within the transaction.</span></span> <span data-ttu-id="e4a68-130">Se questa operazione non viene eseguita, il rollback non riesce.</span><span class="sxs-lookup"><span data-stu-id="e4a68-130">A rollback fails if this is not done.</span></span>

## <a name="common-programming-errors"></a><span data-ttu-id="e4a68-131">Errori comuni di programmazione</span><span class="sxs-lookup"><span data-stu-id="e4a68-131">Common Programming Errors</span></span>

<span data-ttu-id="e4a68-132">Durante lo sviluppo di applicazioni transazionali possono verificarsi gli errori comuni seguenti:</span><span class="sxs-lookup"><span data-stu-id="e4a68-132">The following common errors can occur when developing transacted applications:</span></span>

-   <span data-ttu-id="e4a68-133">Utilizzando un handle di file dopo il completamento di una transazione.</span><span class="sxs-lookup"><span data-stu-id="e4a68-133">Using a file handle after a transaction is completed.</span></span>
-   <span data-ttu-id="e4a68-134">Impossibile chiudere gli handle per i file e le directory eliminati prima di eseguire il commit di una transazione, in modo da impedire che si verifichino le operazioni di eliminazione.</span><span class="sxs-lookup"><span data-stu-id="e4a68-134">Failing to close handles to deleted files and directories before committing a transaction, which will prevent the delete operations from occurring.</span></span> <span data-ttu-id="e4a68-135">Questo evento deve verificarsi prima di eseguire il commit affinché l'operazione di eliminazione venga considerata parte della transazione.</span><span class="sxs-lookup"><span data-stu-id="e4a68-135">This event must occur before performing the commit for the delete operation to be considered part of the transaction.</span></span> <span data-ttu-id="e4a68-136">Questo perché il sistema non elimina effettivamente un file fino a quando non viene chiuso l'ultimo handle, anche quando l'operazione non è transazionale, come parte del sottosistema di I/O dei file di Windows.</span><span class="sxs-lookup"><span data-stu-id="e4a68-136">This is because the system does not actually delete a file until the last handle to it is closed, even when the operation is not transacted, as part of the Windows file I/O subsystem.</span></span>
-   <span data-ttu-id="e4a68-137">Impossibile tenere conto dei rollback delle transazioni avviati dal sistema, che possono verificarsi in qualsiasi momento; Se, ad esempio, le risorse di sistema sono esaurite, viene eseguito il rollback di una transazione.</span><span class="sxs-lookup"><span data-stu-id="e4a68-137">Failing to account for system-initiated transaction rollbacks, which may happen at any time; for example, a transaction is rolled back if the system resources are exhausted.</span></span>

 

 
