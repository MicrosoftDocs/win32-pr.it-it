---
description: Suggerimenti per le transazioni file system ottimali.
ms.assetid: 847939ff-5322-4023-8ef7-9d845e80d65c
title: Considerazioni sulle prestazioni per la funzionalità NTFS transazionale
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 3a71f7e100e1ddd8524932a4a259a12092bddcb6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "103968146"
---
# <a name="performance-considerations-for-transactional-ntfs"></a><span data-ttu-id="a66b6-103">Considerazioni sulle prestazioni per la funzionalità NTFS transazionale</span><span class="sxs-lookup"><span data-stu-id="a66b6-103">Performance Considerations for Transactional NTFS</span></span>

<span data-ttu-id="a66b6-104">Transactional NTFS (TxF) è stato progettato in modo accurato per le prestazioni e offre in genere prestazioni migliori rispetto alle alternative transazionali per utilizzo generico in scenari analoghi.</span><span class="sxs-lookup"><span data-stu-id="a66b6-104">Transactional NTFS (TxF) has been carefully designed for performance and will typically perform better than general-purpose transactional alternatives under similar scenarios.</span></span> <span data-ttu-id="a66b6-105">Tuttavia, le transazioni file system hanno un sovraccarico maggiore rispetto alle operazioni non transazionali e una riduzione delle prestazioni di I/O rispetto all'I/O non transazionale è prevista.</span><span class="sxs-lookup"><span data-stu-id="a66b6-105">However, file system transactions have more overhead than non-transacted operations, and some reduction in I/O performance compared to non-transacted I/O is to be expected.</span></span> <span data-ttu-id="a66b6-106">Le applicazioni critiche per le prestazioni devono eseguire un ciclo di qualificazione di adozione della tecnologia, valutando l'effetto sulle prestazioni delle operazioni transazionali file system.</span><span class="sxs-lookup"><span data-stu-id="a66b6-106">Performance-critical applications should perform a technology adoption qualification cycle, evaluating the performance impact of transacted file system operations.</span></span>

## <a name="overview-of-txf-operations"></a><span data-ttu-id="a66b6-107">Panoramica delle operazioni di TxF</span><span class="sxs-lookup"><span data-stu-id="a66b6-107">Overview of TxF Operations</span></span>

<span data-ttu-id="a66b6-108">TxF utilizza la funzionalità di *annullamento* della registrazione per registrare le modifiche necessarie per riportare il file System in uno stato coerente, detto anche rollback, qualora si verifichi un'interruzione della transazione.</span><span class="sxs-lookup"><span data-stu-id="a66b6-108">TxF uses *undo* logging to record the changes necessary to put the file system back into a consistent state, also referred to as a rollback, should a transaction abort occur.</span></span> <span data-ttu-id="a66b6-109">Questa registrazione di annullamento genera ulteriori operazioni di I/O e rappresenta l'origine del sovraccarico delle prestazioni di TxF rispetto alle operazioni file system non transazionali.</span><span class="sxs-lookup"><span data-stu-id="a66b6-109">This undo logging generates additional I/O and is the source of TxF performance overhead compared to non-transactional file system operations.</span></span>

<span data-ttu-id="a66b6-110">Di seguito è riportato un riepilogo di alto livello del funzionamento di TxF:</span><span class="sxs-lookup"><span data-stu-id="a66b6-110">A high-level summary of how TxF operates is as follows:</span></span>

-   <span data-ttu-id="a66b6-111">Con l'avanzamento di una transazione, TxF scrive i record di *annullamento* nel relativo file di log per ogni modifica apportata al file System.</span><span class="sxs-lookup"><span data-stu-id="a66b6-111">As a transaction progresses, TxF writes *undo* records into its log file for each modification it makes to the file system.</span></span> <span data-ttu-id="a66b6-112">Se si verifica un'interruzione, i record di annullamento vengono analizzati per riportare il file system nello stato in cui si trovava prima dell'inizio della transazione.</span><span class="sxs-lookup"><span data-stu-id="a66b6-112">If an abort occurs, these undo records are parsed to put the file system back in the state it was before the transaction began.</span></span>
-   <span data-ttu-id="a66b6-113">Un record di annullamento delle *modifiche dei metadati* descrive una modifica solo ai metadati del file System.</span><span class="sxs-lookup"><span data-stu-id="a66b6-113">A *metadata change* undo record describes a change only to the file system's metadata.</span></span> <span data-ttu-id="a66b6-114">Alcuni esempi sono gli spostamenti, i rinomi, le aggiunte e le modifiche di attributo.</span><span class="sxs-lookup"><span data-stu-id="a66b6-114">Some examples of this are moves, renames, appends, and attribute changes.</span></span> <span data-ttu-id="a66b6-115">Per la modifica dei metadati annullare i record, tutte le informazioni necessarie per annullare la modifica si trovano nel record e vengono archiviate nel file di log.</span><span class="sxs-lookup"><span data-stu-id="a66b6-115">For metadata change undo records, all of the information necessary to undo the change is in the record and stored in the log file.</span></span>
-   <span data-ttu-id="a66b6-116">Un record Annulla *sovrascrittura* descrive la sovrascrittura di una parte di un file.</span><span class="sxs-lookup"><span data-stu-id="a66b6-116">An *overwrite* undo record describes an overwrite of a portion of a file.</span></span> <span data-ttu-id="a66b6-117">Quando si verifica una sovrascrittura di un file, il contenuto originale del file viene archiviato in un file di annullamento speciale in una directory nascosta e il record Annulla Sovrascrivi punta a questo file.</span><span class="sxs-lookup"><span data-stu-id="a66b6-117">When a file overwrite occurs, the file's original contents are stored in a special undo file in a hidden directory and the overwrite undo record points to this file.</span></span> <span data-ttu-id="a66b6-118">Quando gli aggiornamenti dei file vengono scaricati dalla cache al disco, anche il contenuto del file di annullamento deve essere scaricato, quindi una sovrascrittura del file transazionale potrebbe generare fino a due operazioni di I/O casuali aggiuntive: una per la lettura dei dati precedenti e una per la scrittura nel file di rollback.</span><span class="sxs-lookup"><span data-stu-id="a66b6-118">When file updates are eventually flushed from cache to disk, the contents of the undo file must also be flushed, so a transacted file overwrite could generate up to two extra random I/O operations: one to read the old data and one to write it to the undo file.</span></span> <span data-ttu-id="a66b6-119">Queste operazioni di I/O aggiuntive rappresentano un costo per le prestazioni di TxF.</span><span class="sxs-lookup"><span data-stu-id="a66b6-119">These extra I/O operations are a performance cost of TxF.</span></span>
-   <span data-ttu-id="a66b6-120">Quando si verifica un commit, TxF Scarica innanzitutto tutte le informazioni di annullamento, quindi Scarica le modifiche effettive del file e quindi scrive e Scarica un record di commit.</span><span class="sxs-lookup"><span data-stu-id="a66b6-120">When a commit occurs, TxF first flushes all undo information, then flushes the actual file changes, and then writes and flushes a commit record.</span></span> <span data-ttu-id="a66b6-121">Se non sono presenti file di annullamento da scaricare, l'unico overhead TxF aggiuntivo relativo all'I/O non transazionale è lo svuotamento del log.</span><span class="sxs-lookup"><span data-stu-id="a66b6-121">If there are no undo files to flush, the only additional TxF overhead relative to non-transacted I/O is the log flushes themselves.</span></span> <span data-ttu-id="a66b6-122">Tuttavia, i cancellamenti dei log comportano Scritture sequenziali di grandi dimensioni, quindi il costo delle prestazioni è minimo.</span><span class="sxs-lookup"><span data-stu-id="a66b6-122">However, log flushes result in efficient large sequential writes so the performance cost is minimal.</span></span>
-   <span data-ttu-id="a66b6-123">TxF è ottimizzato per il commit.</span><span class="sxs-lookup"><span data-stu-id="a66b6-123">TxF is optimized for commit.</span></span> <span data-ttu-id="a66b6-124">Si prevede che la maggior parte delle transazioni avrà esito positivo e non sarà necessario eseguire il rollback, pertanto tutti i record di annullamento per una transazione non verranno utilizzati.</span><span class="sxs-lookup"><span data-stu-id="a66b6-124">It is expected that most transactions will succeed and not need to rollback, therefore all undo records for a transaction are expected to go unused.</span></span> <span data-ttu-id="a66b6-125">Dal punto di vista delle prestazioni, le operazioni di commit TxF sono veloci e i rollback sono a elevato utilizzo di risorse.</span><span class="sxs-lookup"><span data-stu-id="a66b6-125">From a performance perspective, TxF commit operations are fast and rollbacks are resource-intensive.</span></span>
-   <span data-ttu-id="a66b6-126">Il rollback comporta un uso più intensivo delle risorse rispetto al commit.</span><span class="sxs-lookup"><span data-stu-id="a66b6-126">Rollback is more resource-intensive than commit.</span></span> <span data-ttu-id="a66b6-127">Durante il rollback, è necessario annullare tutte le modifiche apportate nella transazione.</span><span class="sxs-lookup"><span data-stu-id="a66b6-127">During rollback, all the changes that were made in the transaction have to be un-done.</span></span> <span data-ttu-id="a66b6-128">In generale, la durata del rollback può essere approssimativamente la stessa che ha richiesto per apportare le modifiche in origine.</span><span class="sxs-lookup"><span data-stu-id="a66b6-128">In general, rollback duration can be approximately the same it took to originally make the changes.</span></span> <span data-ttu-id="a66b6-129">Se, ad esempio, l'operazione ha richiesto 1 secondo per apportare tutte le modifiche, l'operazione potrebbe richiedere circa 1 secondo.</span><span class="sxs-lookup"><span data-stu-id="a66b6-129">For example, if it took 1 second to make all the changes then it could take about 1 second to undo them.</span></span> <span data-ttu-id="a66b6-130">Per transazioni molto lunghe, il rollback può creare ulteriori conseguenze sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="a66b6-130">For very long transactions, rollback can create additional performance impacts.</span></span> <span data-ttu-id="a66b6-131">Ad esempio, l'ora di avvio del sistema può essere posticipata se il sistema deve eseguire automaticamente il rollback di una transazione nel caso in cui il sistema non risponda e debba eseguire un riavvio non pianificato.</span><span class="sxs-lookup"><span data-stu-id="a66b6-131">For example, system boot time can be delayed if the system must automatically rollback a transaction in the event that the system stops responding and must perform an unscheduled restart.</span></span>

<span data-ttu-id="a66b6-132">Le conclusioni di riepilogo sulle prestazioni che è possibile trarre dall'elenco precedente sono le seguenti:</span><span class="sxs-lookup"><span data-stu-id="a66b6-132">The summary conclusions about performance that can be drawn from the previous list are as follows:</span></span>

-   <span data-ttu-id="a66b6-133">Il costo delle prestazioni di TxF per le transazioni che interessano sovrascritture di file può essere significativo.</span><span class="sxs-lookup"><span data-stu-id="a66b6-133">The performance cost of TxF for transactions involving file overwrites can be significant.</span></span>
-   <span data-ttu-id="a66b6-134">Il costo delle prestazioni di TxF per le transazioni che coinvolgono solo le operazioni sui metadati può essere relativamente basso, purché vengano utilizzate transazioni di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="a66b6-134">The performance cost of TxF for transactions involving only metadata operations can be relatively low, provided large transactions be used.</span></span> <span data-ttu-id="a66b6-135">Una transazione di grandi dimensioni si verifica quando sono presenti molti record di annullamento per ogni record di commit.</span><span class="sxs-lookup"><span data-stu-id="a66b6-135">A large transaction is when there are many undo records for every commit record.</span></span>

## <a name="recommendations-for-best-performance"></a><span data-ttu-id="a66b6-136">Suggerimenti per prestazioni ottimali</span><span class="sxs-lookup"><span data-stu-id="a66b6-136">Recommendations For Best Performance</span></span>

<span data-ttu-id="a66b6-137">Ammortizzare il sovraccarico TxF per transazioni più grandi.</span><span class="sxs-lookup"><span data-stu-id="a66b6-137">Amortize TxF overhead over larger transactions.</span></span> <span data-ttu-id="a66b6-138">Se, ad esempio, sono presenti *n* set di modifiche da apportare in cui ogni modifica presenta *m* e si ha la possibilità di eseguire questa operazione come *n* transazioni di *m* passaggi ciascuno o come una singola transazione con *m* \* *N* passaggi, quest'ultima opzione risulta più efficiente.</span><span class="sxs-lookup"><span data-stu-id="a66b6-138">For example, if you have *N* sets of changes to make where each change has *M* steps and you have the option to either do this as *N* transactions of *M* steps each or do it all as a single transaction with *M*\**N* steps, the latter option would be more efficient.</span></span>

<span data-ttu-id="a66b6-139">Prendere in considerazione il possibile effetto sull'avvio di transazioni di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="a66b6-139">Consider the possible impact on boot of very large transactions.</span></span> <span data-ttu-id="a66b6-140">Come indicato in precedenza, il rollback può essere lento e ritardare il tempo di avvio se il sistema deve eseguire rollback automatici come ora di avvio.</span><span class="sxs-lookup"><span data-stu-id="a66b6-140">As previously stated, rollback can be slow and will delay boot time if the system needs to perform automatic rollbacks as boot time.</span></span> <span data-ttu-id="a66b6-141">Maggiore è la transazione, maggiore è il ritardo.</span><span class="sxs-lookup"><span data-stu-id="a66b6-141">The larger the transaction, the longer the delay.</span></span>

<span data-ttu-id="a66b6-142">Mantieni le transazioni per la maggior parte delle operazioni sui metadati.</span><span class="sxs-lookup"><span data-stu-id="a66b6-142">Keep transactions to mostly metadata operations.</span></span> <span data-ttu-id="a66b6-143">Questo è ciò che TxF è ottimizzato per e, in generale, le prestazioni sono le stesse delle operazioni di i/O dei file non transazionali per transazioni di metadati di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="a66b6-143">This is what TxF is optimized for and, in general, the performance is about the same as non-transacted file I/O for large metadata transactions.</span></span> <span data-ttu-id="a66b6-144">Esempi di funzioni di TxF di metadati efficienti sono [**MoveFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-movefiletransacteda), [**SetFileAttributesTransacted**](/windows/desktop/api/WinBase/nf-winbase-setfileattributestransacteda), [**CopyFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-copyfiletransacteda), [**DeleteFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-deletefiletransacteda), [**CreateHardLinkTransacted**](/windows/desktop/api/WinBase/nf-winbase-createhardlinktransacteda)e scritture accodate (chiamate alla funzione [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) quando il puntatore del file è alla fine del file o *EOF*).</span><span class="sxs-lookup"><span data-stu-id="a66b6-144">Examples of efficient metadata TxF functions are [**MoveFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-movefiletransacteda), [**SetFileAttributesTransacted**](/windows/desktop/api/WinBase/nf-winbase-setfileattributestransacteda), [**CopyFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-copyfiletransacteda), [**DeleteFileTransacted**](/windows/desktop/api/WinBase/nf-winbase-deletefiletransacteda), [**CreateHardLinkTransacted**](/windows/desktop/api/WinBase/nf-winbase-createhardlinktransacteda), and appended writes (calls to the [**WriteFile**](/windows/desktop/api/FileAPI/nf-fileapi-writefile) function when the file pointer as at the end the file, or *EOF*).</span></span> <span data-ttu-id="a66b6-145">Un esempio di operazioni non di metadati con utilizzo intensivo di risorse è costituito dalle chiamate alla funzione **WriteFile** quando il puntatore del file non si trova nella posizione EOF.</span><span class="sxs-lookup"><span data-stu-id="a66b6-145">An example of resource-intensive non-metadata operations are calls to the **WriteFile** function when the file pointer is not at the EOF.</span></span>

## <a name="summary-of-txf-performance-expectations"></a><span data-ttu-id="a66b6-146">Riepilogo delle aspettative sulle prestazioni di TxF</span><span class="sxs-lookup"><span data-stu-id="a66b6-146">Summary of TxF Performance Expectations</span></span>

<span data-ttu-id="a66b6-147">Per gli aggiornamenti sul posto, le sovrascritture in una sezione di un file saranno molto più lente rispetto all'I/O di file non transazionale, mentre le prestazioni TxF per le operazioni di file system metadati (ad esempio, create, Move e Append) sono paragonabili all'I/O di file non transazionale per le transazioni di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="a66b6-147">For in-place updates, overwrites to a section of a file will be much slower than non-transacted file I/O, while TxF performance for file system metadata operations (for example, create, move, and append) is comparable to non-transacted file I/O for large transactions.</span></span>

 

 



