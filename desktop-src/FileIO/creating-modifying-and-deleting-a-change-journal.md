---
description: Gli amministratori possono creare, eliminare e ricreare i journal delle modifiche.
ms.assetid: 26cbacc2-d26b-434b-91b5-31aedc96da13
title: Creazione, modifica ed eliminazione di un journal delle modifiche
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 50c8cf7296f93549e7d9ec05f5d614131cc342ce
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106316788"
---
# <a name="creating-modifying-and-deleting-a-change-journal"></a><span data-ttu-id="0fd5d-103">Creazione, modifica ed eliminazione di un journal delle modifiche</span><span class="sxs-lookup"><span data-stu-id="0fd5d-103">Creating, Modifying, and Deleting a Change Journal</span></span>

<span data-ttu-id="0fd5d-104">Gli amministratori possono creare, eliminare e ricreare i journal delle modifiche in modo.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-104">Administrators can create, delete, and re-create change journals at will.</span></span> <span data-ttu-id="0fd5d-105">Un amministratore deve eliminare un journal quando il valore del numero di sequenza di aggiornamento (USN) corrente si avvicina al valore di USN massimo possibile, come indicato dal membro **MaxUsn** della struttura dei [**\_ \_ dati del journal USN**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_journal_data_v0) .</span><span class="sxs-lookup"><span data-stu-id="0fd5d-105">An administrator should delete a journal when the current update sequence number (USN) value approaches the maximum possible USN value, as indicated by the **MaxUsn** member of the [**USN\_JOURNAL\_DATA**](/windows/desktop/api/WinIoCtl/ns-winioctl-usn_journal_data_v0) structure.</span></span> <span data-ttu-id="0fd5d-106">Un amministratore potrebbe inoltre eliminare e ricreare un journal delle modifiche per recuperare spazio su disco.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-106">An administrator might also delete and re-create a change journal to reclaim disk space.</span></span> <span data-ttu-id="0fd5d-107">Per eseguire questa e tutte le altre operazioni del journal delle modifiche non a livello di codice, è necessario disporre dei privilegi di amministratore di sistema.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-107">To perform this and all other non-programmatic change journal operations, you must have system administrator privileges.</span></span> <span data-ttu-id="0fd5d-108">Ovvero, è necessario essere un membro del gruppo Administrators.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-108">That is, you must be a member of the Administrators group.</span></span>

<span data-ttu-id="0fd5d-109">Per creare o modificare un journal delle modifiche in un volume specificato a livello di codice, usare il codice di controllo [**FSCTL \_ Create \_ USN \_ Journal**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) .</span><span class="sxs-lookup"><span data-stu-id="0fd5d-109">To create or modify a change journal on a specified volume programmatically, use the [**FSCTL\_CREATE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) control code.</span></span>

<span data-ttu-id="0fd5d-110">Quando si crea un nuovo Journal delle modifiche o se ne modifica uno esistente, il file system NTFS imposta le informazioni per il Journal delle modifiche dalle informazioni della struttura di [**\_ \_ \_ dati create USN Journal**](/windows/desktop/api/WinIoCtl/ns-winioctl-create_usn_journal_data) , che [**FSCTL \_ Create \_ USN \_ Journal**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) accetta come input.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-110">When you create a new change journal or modify an existing one, the NTFS file system sets information for that change journal from information in the [**CREATE\_USN\_JOURNAL\_DATA**](/windows/desktop/api/WinIoCtl/ns-winioctl-create_usn_journal_data) structure, which [**FSCTL\_CREATE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_create_usn_journal) takes as input.</span></span> <span data-ttu-id="0fd5d-111">**Crea \_ I \_ \_ dati del journal USN** sono i membri **MaximumSize** e **DeltaAllocazione**.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-111">**CREATE\_USN\_JOURNAL\_DATA** has the members **MaximumSize** and **AllocationDelta**.</span></span>

<span data-ttu-id="0fd5d-112">**MaximumSize** è la dimensione massima di destinazione per il Journal delle modifiche in byte.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-112">**MaximumSize** is the target maximum size for the change journal in bytes.</span></span> <span data-ttu-id="0fd5d-113">Il Journal delle modifiche può aumentare di dimensioni superiori rispetto a questo valore, ma in NTFS file system Checkpoint il file system NTFS esamina il Journal e lo taglia quando la dimensione supera il valore di **MaximumSize** e il valore di **DeltaAllocazione**.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-113">The change journal can grow larger than this value, but at NTFS file system checkpoints the NTFS file system examines the journal and trims it when its size exceeds the value of **MaximumSize** plus the value of **AllocationDelta**.</span></span> <span data-ttu-id="0fd5d-114">Ai checkpoint file system NTFS, il sistema operativo scrive i record nel file di log file system NTFS che consentono al file system NTFS di determinare quale elaborazione è necessaria per il ripristino in caso di errore.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-114">(At NTFS file system checkpoints, the operating system writes records to the NTFS file system log file that allow the NTFS file system to determine what processing is required to recover from a failure.)</span></span>

<span data-ttu-id="0fd5d-115">**DeltaAllocazione** è il numero di byte aggiunti alla fine e rimossi dall'inizio del journal delle modifiche ogni volta che la memoria viene allocata o deallocata.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-115">**AllocationDelta** is the number of bytes added to the end and removed from the beginning of the change journal each time memory is allocated or deallocated.</span></span> <span data-ttu-id="0fd5d-116">In altre parole, l'allocazione e la deallocazione avvengono in unità di queste dimensioni.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-116">In other words, allocation and deallocation take place in units of this size.</span></span> <span data-ttu-id="0fd5d-117">Un multiplo Integer di dimensioni del cluster è un valore ragionevole per questo membro.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-117">An integer multiple of a cluster size is a reasonable value for this member.</span></span>

<span data-ttu-id="0fd5d-118">Se un amministratore modifica un journal delle modifiche esistente per avere un valore **MaximumSize** più grande, ad esempio se un volume viene reindicizzato troppo spesso, il Journal delle modifiche riceve semplicemente le nuove voci fino a quando non supera le nuove dimensioni massime.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-118">If an administrator modifies an existing change journal to have a larger **MaximumSize** value, for example if a volume is being re-indexed too often, the change journal simply receives new entries until it exceeds the new maximum size.</span></span>

<span data-ttu-id="0fd5d-119">Per eliminare un journal delle modifiche, usare il codice di controllo [**\_ \_ \_ journal USN FSCTL Delete**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) .</span><span class="sxs-lookup"><span data-stu-id="0fd5d-119">To delete a change journal, use the [**FSCTL\_DELETE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) control code.</span></span> <span data-ttu-id="0fd5d-120">Quando si usa questa operazione, vengono esaminati tutti i file nel volume e viene reimpostato l'USN per ogni file su zero.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-120">When you use this operation, it walks through all of the files on the volume and resets the USN for each file to zero.</span></span> <span data-ttu-id="0fd5d-121">L'operazione Elimina quindi il Journal delle modifiche esistente.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-121">The operation then deletes the existing change journal.</span></span> <span data-ttu-id="0fd5d-122">Questa operazione viene mantenute tra i riavvii del sistema finché non viene completata.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-122">This operation persists across system restarts until it completes.</span></span> <span data-ttu-id="0fd5d-123">Eventuali tentativi di lettura, creazione o modifica del journal delle modifiche durante questo processo hanno esito negativo e il codice **\_ di errore eliminazione del journal è \_ \_ in \_ corso**.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-123">Any attempt to read, create, or modify the change journal during this process fails with the error code **ERROR\_JOURNAL\_DELETE\_IN\_PROGRESS**.</span></span>

<span data-ttu-id="0fd5d-124">È anche possibile usare il codice di controllo del [**\_ \_ \_ journal USN FSCTL Delete**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) per determinare se un'eliminazione avviata da un altro processo è in corso.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-124">You can also use the [**FSCTL\_DELETE\_USN\_JOURNAL**](/windows/win32/api/winioctl/ni-winioctl-fsctl_delete_usn_journal) control code to determine if a deletion started by some other process is in progress.</span></span> <span data-ttu-id="0fd5d-125">Ad esempio, l'applicazione, quando viene avviata, può determinare se è in corso un'operazione di eliminazione.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-125">For example, your application, when it is started, can determine if a deletion is in progress.</span></span> <span data-ttu-id="0fd5d-126">Poiché le eliminazioni del journal vengono mantenute tra i riavvii del sistema, le applicazioni e i servizi avviati al riavvio del sistema devono verificare la presenza di un'eliminazione continua.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-126">Because journal deletions persist across system restarts, services and applications started at system restart should check for an ongoing deletion.</span></span>

<span data-ttu-id="0fd5d-127">I journal delle modifiche non vengono necessariamente creati all'avvio.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-127">Change journals are not necessarily created at startup.</span></span> <span data-ttu-id="0fd5d-128">Per creare un journal delle modifiche, un amministratore può eseguire questa operazione in modo esplicito o avviare un altro servizio che richiede un journal delle modifiche.</span><span class="sxs-lookup"><span data-stu-id="0fd5d-128">To create a change journal, an administrator may do so explicitly or start another service that requires a change journal.</span></span>

 

 
