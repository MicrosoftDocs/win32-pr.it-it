---
description: Un servizio può registrarsi per l'avvio o l'arresto quando si verifica un evento trigger.
ms.assetid: ca02a3ae-b16a-4427-b6db-b935c9cf23b3
title: Eventi trigger del servizio
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: fdefd94b7896936f7ab4fc014647b08470611573
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106317674"
---
# <a name="service-trigger-events"></a><span data-ttu-id="b4773-103">Eventi trigger del servizio</span><span class="sxs-lookup"><span data-stu-id="b4773-103">Service Trigger Events</span></span>

<span data-ttu-id="b4773-104">Un servizio può registrarsi per l'avvio o l'arresto quando si verifica un evento trigger.</span><span class="sxs-lookup"><span data-stu-id="b4773-104">A service can register to be started or stopped when a trigger event occurs.</span></span> <span data-ttu-id="b4773-105">In questo modo si elimina la necessità di avviare i servizi all'avvio del sistema o per i servizi per eseguire il polling o attendere attivamente un evento. un servizio può essere avviato quando necessario, anziché iniziare automaticamente indipendentemente dal fatto che esista o meno lavoro da eseguire.</span><span class="sxs-lookup"><span data-stu-id="b4773-105">This eliminates the need for services to start when the system starts, or for services to poll or actively wait for an event; a service can start when it is needed, instead of starting automatically whether or not there is work to do.</span></span> <span data-ttu-id="b4773-106">Esempi di eventi trigger predefiniti includono l'arrivo di un dispositivo di una classe di interfaccia del dispositivo specificata o la disponibilità di una determinata porta del firewall.</span><span class="sxs-lookup"><span data-stu-id="b4773-106">Examples of predefined trigger events include arrival of a device of a specified device interface class or availability of a particular firewall port.</span></span> <span data-ttu-id="b4773-107">Un servizio può inoltre registrarsi per un evento trigger personalizzato generato da un provider [Event Tracing for Windows](../etw/event-tracing-portal.md) (ETW).</span><span class="sxs-lookup"><span data-stu-id="b4773-107">A service can also register for a custom trigger event generated by an [Event Tracing for Windows](../etw/event-tracing-portal.md) (ETW) provider.</span></span>

<span data-ttu-id="b4773-108">**Windows server 2008, Windows Vista, Windows server 2003 e Windows XP:** Gli eventi di attivazione del servizio non sono supportati fino a Windows Server 2008 R2 e Windows 7.</span><span class="sxs-lookup"><span data-stu-id="b4773-108">**Windows Server 2008, Windows Vista, Windows Server 2003 and Windows XP:** Service trigger events are not supported until Windows Server 2008 R2 and Windows 7.</span></span>

<span data-ttu-id="b4773-109">Un trigger è costituito da un tipo di evento trigger, da un sottotipo di evento trigger, dall'azione da intraprendere in risposta all'evento trigger e (per determinati tipi di eventi trigger) uno o più elementi di dati specifici del trigger.</span><span class="sxs-lookup"><span data-stu-id="b4773-109">A trigger consists of a trigger event type, a trigger event subtype, the action to be taken in response to the trigger event, and (for certain trigger event types) one or more trigger-specific data items.</span></span> <span data-ttu-id="b4773-110">Il sottotipo e gli elementi di dati specifici del trigger specificano insieme le condizioni per la notifica al servizio dell'evento.</span><span class="sxs-lookup"><span data-stu-id="b4773-110">The subtype and the trigger-specific data items together specify the conditions for notifying the service of the event.</span></span> <span data-ttu-id="b4773-111">Il formato di un elemento dati dipende dal tipo di evento trigger. un elemento dati può essere costituito da dati binari, una stringa o una multistringa.</span><span class="sxs-lookup"><span data-stu-id="b4773-111">The format of a data item depends on the trigger event type; a data item can be binary data, a string, or a multistring.</span></span> <span data-ttu-id="b4773-112">Le stringhe devono essere Unicode; Le stringhe ANSI non sono supportate.</span><span class="sxs-lookup"><span data-stu-id="b4773-112">Strings must be Unicode; ANSI strings are not supported.</span></span>

<span data-ttu-id="b4773-113">Per eseguire la registrazione per gli eventi trigger, il servizio chiama [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) con le **informazioni sul trigger di configurazione del servizio \_ \_ \_** e fornisce una struttura di [**\_ \_ informazioni sul trigger del servizio**](/windows/desktop/api/winsvc/ns-winsvc-service_trigger_info) .</span><span class="sxs-lookup"><span data-stu-id="b4773-113">To register for trigger events, the service calls [**ChangeServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-changeserviceconfig2a) with **SERVICE\_CONFIG\_TRIGGER\_INFO** and supplies a [**SERVICE\_TRIGGER\_INFO**](/windows/desktop/api/winsvc/ns-winsvc-service_trigger_info) structure.</span></span> <span data-ttu-id="b4773-114">La struttura di **\_ \_ informazioni del trigger del servizio** punta a una matrice di strutture di [**\_ trigger del servizio**](/windows/desktop/api/winsvc/ns-winsvc-service_trigger) , ognuna delle quali specifica un trigger.</span><span class="sxs-lookup"><span data-stu-id="b4773-114">The **SERVICE\_TRIGGER\_INFO** structure points to an array of [**SERVICE\_TRIGGER**](/windows/desktop/api/winsvc/ns-winsvc-service_trigger) structures, each specifying one trigger.</span></span>

<span data-ttu-id="b4773-115">L'azione del trigger specificata viene eseguita se la condizione del trigger è true all'avvio del sistema o se la condizione del trigger diventa true mentre il sistema è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="b4773-115">The specified trigger action is taken if the trigger condition is true when the system starts, or if the trigger condition becomes true while the system is running.</span></span> <span data-ttu-id="b4773-116">Se, ad esempio, un servizio viene registrato per l'avvio quando è disponibile un determinato dispositivo, il servizio viene avviato all'avvio del sistema se il dispositivo è già collegato al computer; il servizio viene avviato all'arrivo del dispositivo se l'utente si connette al dispositivo mentre il sistema è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="b4773-116">For example, if a service registers to be started when a particular device is available, the service is started when the system starts if the device is already plugged in to the computer; the service is started when the device arrives if the user plugs in the device while the system is running.</span></span>

<span data-ttu-id="b4773-117">Se un trigger include elementi di dati specifici del trigger, l'azione trigger viene eseguita solo se l'elemento di dati che accompagna l'evento trigger corrisponde a uno degli elementi di dati specificati dal servizio con il trigger.</span><span class="sxs-lookup"><span data-stu-id="b4773-117">If a trigger has trigger-specific data items, the trigger action is taken only if the data item that accompanies the trigger event matches one of the data items that the service specified with the trigger.</span></span> <span data-ttu-id="b4773-118">La corrispondenza dei dati binari viene eseguita tramite il confronto bit per bit.</span><span class="sxs-lookup"><span data-stu-id="b4773-118">Binary data matching is done by bitwise comparison.</span></span> <span data-ttu-id="b4773-119">La corrispondenza di stringa non fa distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="b4773-119">String matching is case-insensitive.</span></span> <span data-ttu-id="b4773-120">Se l'elemento dati è una multistringa, tutte le stringhe nella multistringa devono corrispondere.</span><span class="sxs-lookup"><span data-stu-id="b4773-120">If the data item is a multistring, all strings in the multistring must match.</span></span>

<span data-ttu-id="b4773-121">Quando un servizio viene avviato in risposta a un evento trigger, il servizio riceve **l' \_ \_ \_ argomento avviato del trigger di servizio** come *argv* \[ 1 \] nella funzione di callback [*ServiceMain*](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) .</span><span class="sxs-lookup"><span data-stu-id="b4773-121">When a service is started in response to a trigger event, the service receives **SERVICE\_TRIGGER\_STARTED\_ARGUMENT** as *argv*\[1\] in its [*ServiceMain*](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) callback function.</span></span> <span data-ttu-id="b4773-122">*Argv* \[ 0 \] è sempre il nome breve del servizio.</span><span class="sxs-lookup"><span data-stu-id="b4773-122">*Argv*\[0\] is always the short name of the service.</span></span>

<span data-ttu-id="b4773-123">Un servizio che registra per essere avviato in risposta a un evento trigger potrebbe arrestarsi dopo un timeout di inattività quando il servizio non è in grado di eseguire operazioni.</span><span class="sxs-lookup"><span data-stu-id="b4773-123">A service that registers to be started in response to a trigger event might stop itself after an idle time-out when the service has no work to do.</span></span> <span data-ttu-id="b4773-124">Un servizio che si arresta autonomamente deve essere preparato a gestire le richieste di controllo **\_ \_ TRIGGEREVENT di controllo del servizio** che arrivano mentre il servizio si arresta automaticamente.</span><span class="sxs-lookup"><span data-stu-id="b4773-124">A service that stops itself must be prepared to handle **SERVICE\_CONTROL\_TRIGGEREVENT** control requests that arrive while the service is stopping itself.</span></span> <span data-ttu-id="b4773-125">Gestione controllo servizi invia una richiesta di controllo del controllo del **\_ \_ TRIGGEREVENT** ogni volta che si verifica un nuovo evento trigger quando il servizio si trova nello stato in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="b4773-125">The SCM sends a **SERVICE\_CONTROL\_TRIGGEREVENT** control request whenever a new trigger event occurs while the service is in the running state.</span></span> <span data-ttu-id="b4773-126">Per evitare la perdita di eventi trigger, il servizio deve restituire l' **errore di \_ arresto \_ in \_ corso** per qualsiasi richiesta di controllo **TRIGGEREVENT del \_ controllo \_ del servizio** che arriva durante la transizione del servizio dall'esecuzione a arrestata.</span><span class="sxs-lookup"><span data-stu-id="b4773-126">To avoid losing trigger events, the service should return **ERROR\_SHUTDOWN\_IN\_PROGRESS** for any **SERVICE\_CONTROL\_TRIGGEREVENT** control request that arrives while the service is transitioning from running to stopped.</span></span> <span data-ttu-id="b4773-127">In questo modo si indica a SCM di accodare gli eventi trigger e attendere che il servizio entri nello stato interrotto.</span><span class="sxs-lookup"><span data-stu-id="b4773-127">This instructs the SCM to queue trigger events and wait for the service to enter the stopped state.</span></span> <span data-ttu-id="b4773-128">SCM esegue quindi l'azione associata all'evento trigger in coda, ad esempio l'avvio del servizio.</span><span class="sxs-lookup"><span data-stu-id="b4773-128">The SCM then takes the action associated with the queued trigger event, such as starting the service.</span></span>

<span data-ttu-id="b4773-129">Quando il servizio è pronto per gestire di nuovo gli eventi trigger, imposta il **servizio \_ Accept \_ TRIGGEREVENT** nella relativa maschera accettata dai controlli in una chiamata a [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus).</span><span class="sxs-lookup"><span data-stu-id="b4773-129">When the service is ready to handle trigger events again, it sets **SERVICE\_ACCEPT\_TRIGGEREVENT** in its controls-accepted mask in a call to [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus).</span></span> <span data-ttu-id="b4773-130">Questa operazione viene in genere eseguita quando il servizio chiama **SetServiceStatus** con il **servizio \_ in esecuzione**.</span><span class="sxs-lookup"><span data-stu-id="b4773-130">This is usually done when the service calls **SetServiceStatus** with **SERVICE\_RUNNING**.</span></span> <span data-ttu-id="b4773-131">SCM rilascia quindi una richiesta **di \_ controllo \_ del servizio TRIGGEREVENT** per ogni evento trigger in coda finché la coda non è vuota.</span><span class="sxs-lookup"><span data-stu-id="b4773-131">The SCM then issues a **SERVICE\_CONTROL\_TRIGGEREVENT** request for each queued trigger event until the queue is empty.</span></span>

<span data-ttu-id="b4773-132">Un servizio che dispone di servizi dipendenti in esecuzione non può essere arrestato in risposta a un evento trigger.</span><span class="sxs-lookup"><span data-stu-id="b4773-132">A service that has dependent services running cannot be stopped in response to a trigger event.</span></span>

<span data-ttu-id="b4773-133">Le richieste trigger-Start e trigger-stop non sono garantite in condizioni di memoria insufficiente.</span><span class="sxs-lookup"><span data-stu-id="b4773-133">Trigger-start and trigger-stop requests are not guaranteed under low memory conditions.</span></span>

<span data-ttu-id="b4773-134">Utilizzare la funzione [**QueryServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-queryserviceconfig2a) per recuperare la configurazione dell'evento trigger di un servizio.</span><span class="sxs-lookup"><span data-stu-id="b4773-134">Use the [**QueryServiceConfig2**](/windows/desktop/api/Winsvc/nf-winsvc-queryserviceconfig2a) function to retrieve a service’s trigger event configuration.</span></span>

<span data-ttu-id="b4773-135">Lo strumento SC (sc.exe) può essere utilizzato per configurare o eseguire query sugli eventi trigger di un servizio al prompt dei comandi.</span><span class="sxs-lookup"><span data-stu-id="b4773-135">The SC tool (sc.exe) can be used to configure or query a service’s trigger events at the command prompt.</span></span> <span data-ttu-id="b4773-136">Usare l'opzione **Triggerinfo** per configurare un servizio per l'avvio o l'arresto in risposta a un evento trigger.</span><span class="sxs-lookup"><span data-stu-id="b4773-136">Use the **triggerinfo** option to configure a service to start or stop in response to a trigger event.</span></span> <span data-ttu-id="b4773-137">Usare l'opzione **qtriggerinfo** per eseguire una query sulla configurazione del trigger di un servizio.</span><span class="sxs-lookup"><span data-stu-id="b4773-137">Use the **qtriggerinfo** option to query the trigger configuration of a service.</span></span>

<span data-ttu-id="b4773-138">Nell'esempio seguente viene eseguita una query sulla configurazione del trigger del servizio W32Time, che viene configurata per l'avvio quando il computer viene aggiunto a un dominio e si arresta quando il computer esce dal dominio.</span><span class="sxs-lookup"><span data-stu-id="b4773-138">The following example queries the trigger configuration of the W32time service, which is configured to start when the computer is joined to a domain and stop when the computer leaves the domain.</span></span>

``` syntax
C:\>sc qtriggerinfo w32time
[SC] QueryServiceConfig2 SUCCESS

SERVICE_NAME: w32time

        START SERVICE
          DOMAIN JOINED STATUS         : 1ce20aba-9851-4421-9430-1ddeb766e809 [DOMAIN JOINED]
        STOP SERVICE
          DOMAIN JOINED STATUS         : ddaf516e-58c2-4866-9574-c3b615d42ea1 [NOT DOMAIN JOINED]
```

<span data-ttu-id="b4773-139">Nell'esempio seguente viene eseguita una query sulla configurazione del trigger del servizio di input del tablet, configurato per l'avvio quando un dispositivo HID con il **GUID** {4d1e55b2-f16f-11CF-88cb-001111000030} e uno degli ID dispositivo HID specificati arriva.</span><span class="sxs-lookup"><span data-stu-id="b4773-139">The following example queries the trigger configuration of the tablet input service, which is configured to start when a HID device with the **GUID** {4d1e55b2-f16f-11cf-88cb-001111000030} and any of the specified HID device IDs arrives.</span></span>

``` syntax
C:\>sc qtriggerinfo tabletinputservice
[SC] QueryServiceConfig2 SUCCESS

SERVICE_NAME: tabletinputservice

        START SERVICE
          DEVICE INTERFACE ARRIVAL     : 4d1e55b2-f16f-11cf-88cb-001111000030 [INTERFACE CLASS GUID]
            DATA                       : HID_DEVICE_UP:000D_U:0001
            DATA                       : HID_DEVICE_UP:000D_U:0002
            DATA                       : HID_DEVICE_UP:000D_U:0003
            DATA                       : HID_DEVICE_UP:000D_U:0004
```

 

 
