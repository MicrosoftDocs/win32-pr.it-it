---
description: In genere, i servizi sono applicazioni console progettate per l'esecuzione automatica senza un'interfaccia utente grafica (GUI).
ms.assetid: 3d6e090a-00b1-47d8-a4fb-620f3db8ba9c
title: Servizi interattivi
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 57dda3018b4b37e8c5ee56d67cd1db2c56da9b67
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "103884254"
---
# <a name="interactive-services"></a><span data-ttu-id="839d7-103">Servizi interattivi</span><span class="sxs-lookup"><span data-stu-id="839d7-103">Interactive Services</span></span>

<span data-ttu-id="839d7-104">In genere, i servizi sono applicazioni console progettate per l'esecuzione automatica senza un'interfaccia utente grafica (GUI).</span><span class="sxs-lookup"><span data-stu-id="839d7-104">Typically, services are console applications that are designed to run unattended without a graphical user interface (GUI).</span></span> <span data-ttu-id="839d7-105">Tuttavia, alcuni servizi possono richiedere occasionali interazioni con un utente.</span><span class="sxs-lookup"><span data-stu-id="839d7-105">However, some services may require occasional interaction with a user.</span></span> <span data-ttu-id="839d7-106">In questa pagina vengono illustrati i modi migliori per interagire con l'utente da un servizio.</span><span class="sxs-lookup"><span data-stu-id="839d7-106">This page discusses the best ways to interact with the user from a service.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="839d7-107">I servizi non possono interagire direttamente con un utente a partire da Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="839d7-107">Services cannot directly interact with a user as of Windows Vista.</span></span> <span data-ttu-id="839d7-108">Pertanto, le tecniche descritte nella sezione intitolata utilizzo di un servizio interattivo non devono essere utilizzate in un nuovo codice.</span><span class="sxs-lookup"><span data-stu-id="839d7-108">Therefore, the techniques mentioned in the section titled Using an Interactive Service should not be used in new code.</span></span>

 

## <a name="interacting-with-a-user-from-a-service-indirectly"></a><span data-ttu-id="839d7-109">Interazione diretta con un utente da un servizio</span><span class="sxs-lookup"><span data-stu-id="839d7-109">Interacting with a User from a Service Indirectly</span></span>

<span data-ttu-id="839d7-110">Per interagire con l'utente da un servizio in tutte le versioni supportate di Windows, è possibile usare le tecniche seguenti:</span><span class="sxs-lookup"><span data-stu-id="839d7-110">You can use the following techniques to interact with the user from a service on all supported versions of Windows:</span></span>

-   <span data-ttu-id="839d7-111">Visualizza una finestra di dialogo nella sessione dell'utente tramite la funzione [**WTSSendMessage**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) .</span><span class="sxs-lookup"><span data-stu-id="839d7-111">Display a dialog box in the user's session using the [**WTSSendMessage**](/windows/desktop/api/wtsapi32/nf-wtsapi32-wtssendmessagea) function.</span></span>
-   <span data-ttu-id="839d7-112">Creare un'applicazione GUI nascosta separata e usare la funzione [**CreateProcessAsUser ha**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) per eseguire l'applicazione nel contesto dell'utente interattivo.</span><span class="sxs-lookup"><span data-stu-id="839d7-112">Create a separate hidden GUI application and use the [**CreateProcessAsUser**](/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createprocessasusera) function to run the application within the context of the interactive user.</span></span> <span data-ttu-id="839d7-113">Progettare l'applicazione GUI per comunicare con il servizio tramite un metodo di comunicazione interprocesso (IPC), ad esempio Named Pipes.</span><span class="sxs-lookup"><span data-stu-id="839d7-113">Design the GUI application to communicate with the service through some method of interprocess communication (IPC), for example, named pipes.</span></span> <span data-ttu-id="839d7-114">Il servizio comunica con l'applicazione GUI per indicare quando visualizzare l'interfaccia utente grafica.</span><span class="sxs-lookup"><span data-stu-id="839d7-114">The service communicates with the GUI application to tell it when to display the GUI.</span></span> <span data-ttu-id="839d7-115">L'applicazione comunica nuovamente i risultati dell'interazione dell'utente con il servizio in modo che il servizio possa intraprendere l'azione appropriata.</span><span class="sxs-lookup"><span data-stu-id="839d7-115">The application communicates the results of the user interaction back to the service so that the service can take the appropriate action.</span></span> <span data-ttu-id="839d7-116">Si noti che IPC può esporre le interfacce del servizio in rete, a meno che non si usi un elenco di controllo di accesso (ACL) appropriato.</span><span class="sxs-lookup"><span data-stu-id="839d7-116">Note that IPC can expose your service interfaces over the network unless you use an appropriate access control list (ACL).</span></span>

    <span data-ttu-id="839d7-117">Se il servizio viene eseguito in un sistema multiutente, aggiungere l'applicazione alla chiave seguente in modo che venga eseguita in ogni sessione: **HKEY \_ Local \_ Machine \\ software \\ Microsoft \\ Windows \\ CurrentVersion \\ Run**.</span><span class="sxs-lookup"><span data-stu-id="839d7-117">If this service runs on a multiuser system, add the application to the following key so that it is run in each session: **HKEY\_LOCAL\_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run**.</span></span> <span data-ttu-id="839d7-118">Se l'applicazione usa named pipe per IPC, il server può distinguere tra più processi utente assegnando a ogni pipe un nome univoco basato sull'ID di sessione.</span><span class="sxs-lookup"><span data-stu-id="839d7-118">If the application uses named pipes for IPC, the server can distinguish between multiple user processes by giving each pipe a unique name based on the session ID.</span></span>

<span data-ttu-id="839d7-119">La tecnica seguente è disponibile anche per Windows Server 2003 e Windows XP:</span><span class="sxs-lookup"><span data-stu-id="839d7-119">The following technique is also available for Windows Server 2003 and Windows XP:</span></span>

-   <span data-ttu-id="839d7-120">Consente di visualizzare una finestra di messaggio chiamando la funzione [**MessageBox**](/windows/win32/api/winuser/nf-winuser-messagebox) con la **\_ \_ notifica del servizio MB**.</span><span class="sxs-lookup"><span data-stu-id="839d7-120">Display a message box by calling the [**MessageBox**](/windows/win32/api/winuser/nf-winuser-messagebox) function with **MB\_SERVICE\_NOTIFICATION**.</span></span> <span data-ttu-id="839d7-121">Questa operazione è consigliata per la visualizzazione di messaggi di stato semplici.</span><span class="sxs-lookup"><span data-stu-id="839d7-121">This is recommended for displaying simple status messages.</span></span> <span data-ttu-id="839d7-122">Non chiamare **MessageBox** durante l'inizializzazione del servizio o dalla routine [**HandlerEx**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex) , a meno che non lo si chiami da un thread separato, in modo da tornare al gestore SCM in modo tempestivo.</span><span class="sxs-lookup"><span data-stu-id="839d7-122">Do not call **MessageBox** during service initialization or from the [**HandlerEx**](/windows/desktop/api/WinSvc/nc-winsvc-lphandler_function_ex) routine, unless you call it from a separate thread, so that you return to the SCM in a timely manner.</span></span>

## <a name="using-an-interactive-service"></a><span data-ttu-id="839d7-123">Uso di un servizio interattivo</span><span class="sxs-lookup"><span data-stu-id="839d7-123">Using an Interactive Service</span></span>

<span data-ttu-id="839d7-124">Per impostazione predefinita, i servizi usano una [stazione di finestra](/windows/desktop/winstation/window-stations) non interattiva e non possono interagire con l'utente.</span><span class="sxs-lookup"><span data-stu-id="839d7-124">By default, services use a noninteractive [window station](/windows/desktop/winstation/window-stations) and cannot interact with the user.</span></span> <span data-ttu-id="839d7-125">Tuttavia, un *servizio interattivo* può visualizzare un'interfaccia utente e ricevere l'input dell'utente.</span><span class="sxs-lookup"><span data-stu-id="839d7-125">However, an *interactive service* can display a user interface and receive user input.</span></span>

> [!Caution]  
> <span data-ttu-id="839d7-126">I servizi in esecuzione in un contesto di sicurezza con privilegi elevati, ad esempio l'account LocalSystem, non devono creare una finestra sul desktop interattivo perché qualsiasi altra applicazione in esecuzione sul desktop interattivo può interagire con questa finestra.</span><span class="sxs-lookup"><span data-stu-id="839d7-126">Services running in an elevated security context, such as the LocalSystem account, should not create a window on the interactive desktop because any other application that is running on the interactive desktop can interact with this window.</span></span> <span data-ttu-id="839d7-127">In questo modo viene esposto il servizio a qualsiasi applicazione eseguita da un utente che ha eseguito l'accesso.</span><span class="sxs-lookup"><span data-stu-id="839d7-127">This exposes the service to any application that a logged-on user executes.</span></span> <span data-ttu-id="839d7-128">Inoltre, i servizi in esecuzione come LocalSystem non devono accedere al desktop interattivo chiamando la funzione [**OpenWindowStation**](/windows/desktop/api/winuser/nf-winuser-openwindowstationa) o [**GetThreadDesktop**](/windows/desktop/api/winuser/nf-winuser-getthreaddesktop) .</span><span class="sxs-lookup"><span data-stu-id="839d7-128">Also, services that are running as LocalSystem should not access the interactive desktop by calling the [**OpenWindowStation**](/windows/desktop/api/winuser/nf-winuser-openwindowstationa) or [**GetThreadDesktop**](/windows/desktop/api/winuser/nf-winuser-getthreaddesktop) function.</span></span>

 

<span data-ttu-id="839d7-129">Per creare un servizio interattivo, eseguire le operazioni seguenti quando si chiama la funzione [**CreateService**](/windows/desktop/api/Winsvc/nf-winsvc-createservicea) :</span><span class="sxs-lookup"><span data-stu-id="839d7-129">To create an interactive service, do the following when calling the [**CreateService**](/windows/desktop/api/Winsvc/nf-winsvc-createservicea) function:</span></span>

1.  <span data-ttu-id="839d7-130">Specificare NULL per il parametro *lpServiceStartName* per eseguire il servizio nel contesto dell' [account LocalSystem](localsystem-account.md).</span><span class="sxs-lookup"><span data-stu-id="839d7-130">Specify NULL for the *lpServiceStartName* parameter to run the service in the context of the [LocalSystem account](localsystem-account.md).</span></span>
2.  <span data-ttu-id="839d7-131">Specificare il flag del **\_ \_ processo interattivo del servizio** .</span><span class="sxs-lookup"><span data-stu-id="839d7-131">Specify the **SERVICE\_INTERACTIVE\_PROCESS** flag.</span></span>

<span data-ttu-id="839d7-132">Per determinare se un servizio è in esecuzione come servizio interattivo, chiamare la funzione [**GetProcessWindowStation**](/windows/desktop/api/winuser/nf-winuser-getprocesswindowstation) per recuperare un handle per la stazione della finestra e la funzione [**GetUserObjectInformation**](/windows/desktop/api/winuser/nf-winuser-getuserobjectinformationa) per verificare se la stazione della finestra ha l'attributo **\_ visibile wsf** .</span><span class="sxs-lookup"><span data-stu-id="839d7-132">To determine whether a service is running as an interactive service, call the [**GetProcessWindowStation**](/windows/desktop/api/winuser/nf-winuser-getprocesswindowstation) function to retrieve a handle to the window station, and the [**GetUserObjectInformation**](/windows/desktop/api/winuser/nf-winuser-getuserobjectinformationa) function to test whether the window station has the **WSF\_VISIBLE** attribute.</span></span>

<span data-ttu-id="839d7-133">Si noti tuttavia che la chiave del registro di sistema seguente contiene un valore, **NoInteractiveServices**, che controlla l'effetto del \_ processo interattivo del servizio \_ :</span><span class="sxs-lookup"><span data-stu-id="839d7-133">However, note that the following registry key contains a value, **NoInteractiveServices**, that controls the effect of SERVICE\_INTERACTIVE\_PROCESS:</span></span>

<span data-ttu-id="839d7-134">**\_Finestre di \_ \\ \\ controllo CurrentControlSet di sistema del \\ computer \\ locale HKEY**</span><span class="sxs-lookup"><span data-stu-id="839d7-134">**HKEY\_LOCAL\_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Windows**</span></span>

<span data-ttu-id="839d7-135">Il valore predefinito di **NoInteractiveServices** è 1, il che significa che nessun servizio può essere eseguito in modo interattivo, indipendentemente dal fatto che disponga di un **\_ \_ processo interattivo di servizio**.</span><span class="sxs-lookup"><span data-stu-id="839d7-135">The **NoInteractiveServices** value defaults to 1, which means that no service is allowed to run interactively, regardless of whether it has **SERVICE\_INTERACTIVE\_PROCESS**.</span></span> <span data-ttu-id="839d7-136">Quando **NoInteractiveServices** è impostato su 0, i servizi con **\_ \_ processo interattivo di servizio** possono essere eseguiti in modo interattivo.</span><span class="sxs-lookup"><span data-stu-id="839d7-136">When **NoInteractiveServices** is set to a 0, services with **SERVICE\_INTERACTIVE\_PROCESS** are allowed to run interactively.</span></span>

<span data-ttu-id="839d7-137">**Windows 7, Windows server 2008 R2, Windows XP e Windows server 2003:** Il valore predefinito di **NoInteractiveServices** è 0, il che significa che i servizi con **\_ \_ processo interattivo di servizio** possono essere eseguiti in modo interattivo.</span><span class="sxs-lookup"><span data-stu-id="839d7-137">**Windows 7, Windows Server 2008 R2, Windows XP and Windows Server 2003:** The **NoInteractiveServices** value defaults to 0, which means that services with **SERVICE\_INTERACTIVE\_PROCESS** are allowed to run interactively.</span></span> <span data-ttu-id="839d7-138">Quando **NoInteractiveServices** è impostato su un valore diverso da zero, non è consentito eseguire il servizio in seguito in modo interattivo, indipendentemente dal fatto che disponga di un **\_ \_ processo interattivo di servizio**.</span><span class="sxs-lookup"><span data-stu-id="839d7-138">When **NoInteractiveServices** is set to a nonzero value, no service started thereafter is allowed to run interactively, regardless of whether it has **SERVICE\_INTERACTIVE\_PROCESS**.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="839d7-139">Tutti i servizi vengono eseguiti nella sessione Servizi Terminal 0.</span><span class="sxs-lookup"><span data-stu-id="839d7-139">All services run in Terminal Services session 0.</span></span> <span data-ttu-id="839d7-140">Se pertanto un servizio interattivo Visualizza un'interfaccia utente, è visibile solo all'utente che si è connesso alla sessione 0.</span><span class="sxs-lookup"><span data-stu-id="839d7-140">Therefore, if an interactive service displays a user interface, it is visible only to the user who connected to session 0.</span></span> <span data-ttu-id="839d7-141">Poiché non esiste alcun modo per garantire che l'utente interattivo sia connesso alla sessione 0, non configurare un servizio per l'esecuzione come servizio interattivo in Servizi terminal o in un sistema che supporta il cambio rapido utente (il cambio rapido utente viene implementato tramite Servizi terminal).</span><span class="sxs-lookup"><span data-stu-id="839d7-141">Because there is no way to guarantee that the interactive user is connected to session 0, do not configure a service to run as an interactive service under Terminal Services or on a system that supports fast user switching (fast user switching is implemented using Terminal Services).</span></span>

 

 

 
