---
description: I servizi vengono in genere scritti come applicazioni console.
ms.assetid: ed6945fc-ac08-4776-8d75-d33e8df3882a
title: Punto di ingresso del servizio
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: de9e2683c4a69949b6f51c7d000c0ee3571fe118
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/07/2021
ms.locfileid: "103966616"
---
# <a name="service-entry-point"></a><span data-ttu-id="a59cf-103">Punto di ingresso del servizio</span><span class="sxs-lookup"><span data-stu-id="a59cf-103">Service Entry Point</span></span>

<span data-ttu-id="a59cf-104">I servizi vengono in genere scritti come applicazioni console.</span><span class="sxs-lookup"><span data-stu-id="a59cf-104">Services are generally written as console applications.</span></span> <span data-ttu-id="a59cf-105">Il punto di ingresso di un'applicazione console è la funzione **principale** .</span><span class="sxs-lookup"><span data-stu-id="a59cf-105">The entry point of a console application is its **main** function.</span></span> <span data-ttu-id="a59cf-106">La funzione **Main** riceve gli argomenti dal valore **ImagePath** dalla chiave del registro di sistema per il servizio.</span><span class="sxs-lookup"><span data-stu-id="a59cf-106">The **main** function receives arguments from the **ImagePath** value from the registry key for the service.</span></span> <span data-ttu-id="a59cf-107">Per ulteriori informazioni, vedere la sezione Osservazioni della funzione [**CreateService**](/windows/desktop/api/Winsvc/nf-winsvc-createservicea) .</span><span class="sxs-lookup"><span data-stu-id="a59cf-107">For more information, see the Remarks section of the [**CreateService**](/windows/desktop/api/Winsvc/nf-winsvc-createservicea) function.</span></span>

<span data-ttu-id="a59cf-108">Quando SCM avvia un programma di servizio, attende che chiami la funzione [**Impossibile eseguire StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) .</span><span class="sxs-lookup"><span data-stu-id="a59cf-108">When the SCM starts a service program, it waits for it to call the [**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) function.</span></span> <span data-ttu-id="a59cf-109">Usare le linee guida seguenti.</span><span class="sxs-lookup"><span data-stu-id="a59cf-109">Use the following guidelines.</span></span>

-   <span data-ttu-id="a59cf-110">Un servizio di tipo servizio \_ Win32 \_ proprietario \_ processo deve chiamare [**immediatamente Impossibile eseguire StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) dal thread principale.</span><span class="sxs-lookup"><span data-stu-id="a59cf-110">A service of type SERVICE\_WIN32\_OWN\_PROCESS should call [**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) immediately, from its main thread.</span></span> <span data-ttu-id="a59cf-111">È possibile eseguire qualsiasi inizializzazione dopo l'avvio del servizio, come descritto in [servizio ServiceMain funzione](service-servicemain-function.md).</span><span class="sxs-lookup"><span data-stu-id="a59cf-111">You can perform any initialization after the service starts, as described in [Service ServiceMain Function](service-servicemain-function.md).</span></span>
-   <span data-ttu-id="a59cf-112">Se il tipo di servizio è il \_ processo di condivisione Win32 del servizio \_ \_ ed è presente un'inizializzazione comune per tutti i servizi nel programma, è possibile eseguire l'inizializzazione nel thread principale prima di chiamare [**Impossibile eseguire StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera), purché sia necessario meno di 30 secondi.</span><span class="sxs-lookup"><span data-stu-id="a59cf-112">If the service type is SERVICE\_WIN32\_SHARE\_PROCESS and there is common initialization for all services in the program, you can perform the initialization in the main thread before calling [**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera), as long as it takes less than 30 seconds.</span></span> <span data-ttu-id="a59cf-113">In caso contrario, è necessario creare un altro thread per eseguire l'inizializzazione comune, mentre il thread principale chiama **Impossibile eseguire StartServiceCtrlDispatcher**.</span><span class="sxs-lookup"><span data-stu-id="a59cf-113">Otherwise, you must create another thread to do the common initialization, while the main thread calls **StartServiceCtrlDispatcher**.</span></span> <span data-ttu-id="a59cf-114">È comunque necessario eseguire qualsiasi inizializzazione specifica del servizio dopo l'avvio del servizio.</span><span class="sxs-lookup"><span data-stu-id="a59cf-114">You should still perform any service-specific initialization after the service starts.</span></span>

<span data-ttu-id="a59cf-115">La funzione [**Impossibile eseguire StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) accetta una struttura di [**\_ \_ voci della tabella del servizio**](/windows/desktop/api/Winsvc/ns-winsvc-service_table_entrya) per ogni servizio contenuto nel processo.</span><span class="sxs-lookup"><span data-stu-id="a59cf-115">The [**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) function takes a [**SERVICE\_TABLE\_ENTRY**](/windows/desktop/api/Winsvc/ns-winsvc-service_table_entrya) structure for each service contained in the process.</span></span> <span data-ttu-id="a59cf-116">Ogni struttura specifica il nome del servizio e il punto di ingresso per il servizio.</span><span class="sxs-lookup"><span data-stu-id="a59cf-116">Each structure specifies the service name and the entry point for the service.</span></span> <span data-ttu-id="a59cf-117">Per un esempio, vedere [scrittura della funzione principale di un programma di servizio](writing-a-service-program-s-main-function.md).</span><span class="sxs-lookup"><span data-stu-id="a59cf-117">For an example, see [Writing a Service Program's main Function](writing-a-service-program-s-main-function.md).</span></span>

<span data-ttu-id="a59cf-118">Se [**Impossibile eseguire StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) ha esito positivo, il thread chiamante non viene restituito finché tutti i servizi in esecuzione nel processo non sono \_ passati allo stato interrotto del servizio.</span><span class="sxs-lookup"><span data-stu-id="a59cf-118">If [**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) succeeds, the calling thread does not return until all running services in the process have entered the SERVICE\_STOPPED state.</span></span> <span data-ttu-id="a59cf-119">SCM Invia le richieste di controllo al thread tramite un named pipe.</span><span class="sxs-lookup"><span data-stu-id="a59cf-119">The SCM sends control requests to this thread through a named pipe.</span></span> <span data-ttu-id="a59cf-120">Il thread funge da dispatcher di controllo, eseguendo le attività seguenti:</span><span class="sxs-lookup"><span data-stu-id="a59cf-120">The thread acts as a control dispatcher, performing the following tasks:</span></span>

-   <span data-ttu-id="a59cf-121">Consente di creare un nuovo thread per chiamare il punto di ingresso appropriato quando viene avviato un nuovo servizio.</span><span class="sxs-lookup"><span data-stu-id="a59cf-121">Create a new thread to call the appropriate entry point when a new service is started.</span></span>
-   <span data-ttu-id="a59cf-122">Chiamare la [funzione del gestore](service-control-handler-function.md) appropriata per gestire le richieste di controllo del servizio.</span><span class="sxs-lookup"><span data-stu-id="a59cf-122">Call the appropriate [handler function](service-control-handler-function.md) to handle service control requests.</span></span>

## <a name="related-topics"></a><span data-ttu-id="a59cf-123">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="a59cf-123">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="a59cf-124">Scrittura della funzione principale di un programma del servizio</span><span class="sxs-lookup"><span data-stu-id="a59cf-124">Writing a Service Program's main Function</span></span>](writing-a-service-program-s-main-function.md)
</dt> </dl>

 

 



