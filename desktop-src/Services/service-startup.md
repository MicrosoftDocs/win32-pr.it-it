---
description: Per avviare un servizio o un servizio driver, il programma di controllo del servizio utilizza la funzione StartService.
ms.assetid: 7d2ee779-1554-436a-a65c-f0322745f46a
title: Avvio del servizio
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 0f5fcd9ee820357e75bf07649da8e6c5445d3f42
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "106317677"
---
# <a name="service-startup"></a><span data-ttu-id="324b2-103">Avvio del servizio</span><span class="sxs-lookup"><span data-stu-id="324b2-103">Service Startup</span></span>

<span data-ttu-id="324b2-104">Per avviare un servizio o un servizio driver, il programma di controllo del servizio utilizza la funzione [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) .</span><span class="sxs-lookup"><span data-stu-id="324b2-104">To start a service or driver service, the service control program uses the [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) function.</span></span> <span data-ttu-id="324b2-105">La funzione **StartService** ha esito negativo se il database è bloccato.</span><span class="sxs-lookup"><span data-stu-id="324b2-105">The **StartService** function fails if the database is locked.</span></span> <span data-ttu-id="324b2-106">In tal caso, il programma di controllo del servizio deve attendere alcuni secondi e chiamare nuovamente **StartService** .</span><span class="sxs-lookup"><span data-stu-id="324b2-106">If this occurs, the service control program should wait a few seconds and call **StartService** again.</span></span> <span data-ttu-id="324b2-107">Può verificare lo stato di blocco corrente del database chiamando la funzione [**QueryServiceLockStatus**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicelockstatusa) .</span><span class="sxs-lookup"><span data-stu-id="324b2-107">It can check the current lock status of the database by calling the [**QueryServiceLockStatus**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicelockstatusa) function.</span></span>

<span data-ttu-id="324b2-108">Se il programma di controllo del servizio avvia un servizio, può usare la funzione [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) per specificare una matrice di argomenti da passare alla funzione [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) del servizio.</span><span class="sxs-lookup"><span data-stu-id="324b2-108">If the service control program is starting a service, it can use the [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) function to specify an array of arguments to be passed to the service's [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) function.</span></span> <span data-ttu-id="324b2-109">La funzione **StartService** viene restituita dopo la creazione di un nuovo thread per l'esecuzione della funzione **ServiceMain** .</span><span class="sxs-lookup"><span data-stu-id="324b2-109">The **StartService** function returns after a new thread is created to execute the **ServiceMain** function.</span></span> <span data-ttu-id="324b2-110">Il programma di controllo del servizio può recuperare lo stato del servizio appena avviato in una struttura di [**\_ stato del servizio**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) chiamando la funzione [**QueryServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicestatus) .</span><span class="sxs-lookup"><span data-stu-id="324b2-110">The service control program can retrieve the status of the newly started service in a [**SERVICE\_STATUS**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) structure by calling the [**QueryServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-queryservicestatus) function.</span></span> <span data-ttu-id="324b2-111">Durante l'inizializzazione, il membro **dwCurrentState** deve essere l'avvio del servizio \_ \_ in sospeso.</span><span class="sxs-lookup"><span data-stu-id="324b2-111">During initialization, the **dwCurrentState** member should be SERVICE\_START\_PENDING.</span></span> <span data-ttu-id="324b2-112">Il membro **dwWaitHint** è un intervallo di tempo, in millisecondi, che indica per quanto tempo il programma di controllo del servizio deve attendere prima di chiamare di nuovo **QueryServiceStatus** .</span><span class="sxs-lookup"><span data-stu-id="324b2-112">The **dwWaitHint** member is a time interval, in milliseconds, that indicates how long the service control program should wait before calling **QueryServiceStatus** again.</span></span> <span data-ttu-id="324b2-113">Al termine dell'inizializzazione, il servizio modifica **dwCurrentState** nel servizio \_ in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="324b2-113">When the initialization is complete, the service changes **dwCurrentState** to SERVICE\_RUNNING.</span></span>

<span data-ttu-id="324b2-114">Gestione controllo servizi non supporta il passaggio di variabili di ambiente personalizzate a un servizio all'avvio.</span><span class="sxs-lookup"><span data-stu-id="324b2-114">The service control manager does not support passing custom environment variables to a service at startup.</span></span> <span data-ttu-id="324b2-115">Inoltre, gestione controllo servizi non rileva e passa le modifiche alle variabili di ambiente durante l'esecuzione del servizio.</span><span class="sxs-lookup"><span data-stu-id="324b2-115">Also, the service control manager does not detect and pass on changes to environment variables as the service is running.</span></span> <span data-ttu-id="324b2-116">Anziché rendere un servizio dipendente da una variabile di ambiente, utilizzare i valori del registro di sistema o gli argomenti [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) .</span><span class="sxs-lookup"><span data-stu-id="324b2-116">Instead of making a service dependent on an environment variable, use registry values or [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) arguments.</span></span>

<span data-ttu-id="324b2-117">Di seguito è riportata una panoramica semplificata di ciò che accade quando un servizio tipico viene avviato da Gestione controllo servizi:</span><span class="sxs-lookup"><span data-stu-id="324b2-117">The following is a simplified overview of what happens when a typical service is started by the service control manager:</span></span>

-   <span data-ttu-id="324b2-118">SCM legge il percorso del servizio dal registro di sistema e prepara l'avvio del servizio.</span><span class="sxs-lookup"><span data-stu-id="324b2-118">The SCM reads the service path from the registry and prepares to start the service.</span></span> <span data-ttu-id="324b2-119">Ciò include l'acquisizione del blocco del servizio.</span><span class="sxs-lookup"><span data-stu-id="324b2-119">This includes acquiring the service lock.</span></span> <span data-ttu-id="324b2-120">Qualsiasi tentativo di avviare un altro servizio mentre viene mantenuto il blocco del servizio si bloccherà fino a quando non viene rilasciato il blocco del servizio.</span><span class="sxs-lookup"><span data-stu-id="324b2-120">Any attempt to start another service while the service lock is held will block until the service lock is released.</span></span>
-   <span data-ttu-id="324b2-121">Il gestore SCM avvia il processo e attende fino a quando non viene chiuso il processo figlio (indicante un errore) o segnala lo stato di esecuzione del servizio \_ .</span><span class="sxs-lookup"><span data-stu-id="324b2-121">The SCM starts the process and waits until either the child process exits (indicating a failure) or reports the SERVICE\_RUNNING status.</span></span>
-   <span data-ttu-id="324b2-122">L'applicazione esegue l'inizializzazione molto semplice e chiama la funzione [**Impossibile eseguire StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) .</span><span class="sxs-lookup"><span data-stu-id="324b2-122">The application performs its very simple initialization and calls the [**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) function.</span></span>
-   <span data-ttu-id="324b2-123">[**Impossibile eseguire StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) si connette a gestione controllo servizi e avvia un secondo thread che chiama la funzione [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) per il servizio.</span><span class="sxs-lookup"><span data-stu-id="324b2-123">[**StartServiceCtrlDispatcher**](/windows/desktop/api/Winsvc/nf-winsvc-startservicectrldispatchera) connects to the service control manager and starts a second thread that calls the [**ServiceMain**](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) function for the service.</span></span> <span data-ttu-id="324b2-124">**ServiceMain** deve segnalare \_ il servizio in esecuzione il prima possibile.</span><span class="sxs-lookup"><span data-stu-id="324b2-124">**ServiceMain** should report SERVICE\_RUNNING as soon as possible.</span></span>
-   <span data-ttu-id="324b2-125">Quando Gestione controllo servizi riceve una notifica che indica che il servizio è in esecuzione, rilascia il blocco del servizio.</span><span class="sxs-lookup"><span data-stu-id="324b2-125">When the service control manager is notified that the service is running, it releases the service lock.</span></span>

<span data-ttu-id="324b2-126">Se il servizio non aggiorna lo stato entro 80 secondi, più l'ultimo hint di attesa, gestione controllo servizi determina che il servizio non risponde.</span><span class="sxs-lookup"><span data-stu-id="324b2-126">If service does not update its status within 80 seconds, plus the last wait hint, the service control manager determines that the service has stopped responding.</span></span> <span data-ttu-id="324b2-127">Gestione controllo servizi registrerà un evento e arresterà il servizio.</span><span class="sxs-lookup"><span data-stu-id="324b2-127">The service control manager will log an event and stop the service.</span></span>

<span data-ttu-id="324b2-128">Se il programma avvia un servizio driver, [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) viene restituito dopo che il driver di dispositivo ha completato l'inizializzazione.</span><span class="sxs-lookup"><span data-stu-id="324b2-128">If the program is starting a driver service, [**StartService**](/windows/desktop/api/Winsvc/nf-winsvc-startservicea) returns after the device driver has completed its initialization.</span></span>

<span data-ttu-id="324b2-129">Per ulteriori informazioni, vedere [avvio di un servizio](starting-a-service.md).</span><span class="sxs-lookup"><span data-stu-id="324b2-129">For more information, see [Starting a Service](starting-a-service.md).</span></span>

 

 
