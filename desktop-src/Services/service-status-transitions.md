---
description: Un servizio è responsabile della segnalazione delle modifiche apportate allo stato a gestione controllo servizi (SCM).
ms.assetid: 74a85730-6667-46fe-ae12-26561ccedb73
title: Transizioni di stato del servizio
ms.topic: article
ms.date: 05/31/2018
ms.openlocfilehash: 8df7684b1ebc04aa1116b09a3ae4321f2552d7b6
ms.sourcegitcommit: 831e8f3db78ab820e1710cede244553c70e50500
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/08/2021
ms.locfileid: "104550539"
---
# <a name="service-state-transitions"></a><span data-ttu-id="5fd59-103">Transizioni di stato del servizio</span><span class="sxs-lookup"><span data-stu-id="5fd59-103">Service State Transitions</span></span>

<span data-ttu-id="5fd59-104">Un servizio è responsabile della segnalazione delle modifiche apportate allo stato a gestione controllo servizi (SCM).</span><span class="sxs-lookup"><span data-stu-id="5fd59-104">A service is responsible for reporting changes in its state to the service control manager (SCM).</span></span> <span data-ttu-id="5fd59-105">I programmi di controllo del servizio e il sistema possono individuare lo stato di un servizio solo da SCM, quindi è importante che un servizio segnali correttamente lo stato.</span><span class="sxs-lookup"><span data-stu-id="5fd59-105">Service control programs and the system can find out the state of a service only from the SCM, so it is important that a service report its state correctly.</span></span> <span data-ttu-id="5fd59-106">Un servizio segnala il proprio stato chiamando la funzione [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) con un puntatore a una struttura di [**\_ stato del servizio**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) completamente inizializzata.</span><span class="sxs-lookup"><span data-stu-id="5fd59-106">A service reports its state by calling the [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) function with a pointer to a fully initialized [**SERVICE\_STATUS**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) structure.</span></span> <span data-ttu-id="5fd59-107">Il membro **dwCurrentState** della struttura contiene lo stato del servizio da segnalare.</span><span class="sxs-lookup"><span data-stu-id="5fd59-107">The **dwCurrentState** member of the structure contains the service state to be reported.</span></span>

<span data-ttu-id="5fd59-108">Lo stato iniziale di un servizio è servizio \_ interrotto.</span><span class="sxs-lookup"><span data-stu-id="5fd59-108">The initial state of a service is SERVICE\_STOPPED.</span></span> <span data-ttu-id="5fd59-109">Quando SCM avvia il servizio, imposta lo stato del servizio su avvio servizio \_ \_ in sospeso e chiama la funzione [*ServiceMain*](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) del servizio.</span><span class="sxs-lookup"><span data-stu-id="5fd59-109">When the SCM starts the service, it sets the service state to SERVICE\_START\_PENDING and calls the service's [*ServiceMain*](/windows/win32/api/winsvc/nc-winsvc-lpservice_main_functiona) function.</span></span> <span data-ttu-id="5fd59-110">Il servizio quindi completa l'inizializzazione usando una delle tecniche descritte nella [funzione ServiceMain del servizio](service-servicemain-function.md).</span><span class="sxs-lookup"><span data-stu-id="5fd59-110">The service then completes its initialization using one of the techniques described in [Service ServiceMain Function](service-servicemain-function.md).</span></span> <span data-ttu-id="5fd59-111">Dopo che il servizio ha completato l'inizializzazione ed è pronto per iniziare a ricevere richieste di controllo, il servizio chiama [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) per segnalare il servizio \_ in esecuzione e specifica le richieste di controllo che il servizio è pronto ad accettare.</span><span class="sxs-lookup"><span data-stu-id="5fd59-111">After the service completes its initialization and is ready to start receiving control requests, the service calls [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) to report SERVICE\_RUNNING and specify the control requests the service is prepared to accept.</span></span> <span data-ttu-id="5fd59-112">La transizione dall'avvio del servizio in \_ \_ sospeso al servizio \_ in esecuzione indica agli strumenti SCM e di monitoraggio dei servizi che il servizio è stato avviato correttamente.</span><span class="sxs-lookup"><span data-stu-id="5fd59-112">The transition from SERVICE\_START\_PENDING to SERVICE\_RUNNING indicates to the SCM and service-monitoring tools that the service has started successfully.</span></span> <span data-ttu-id="5fd59-113">Se il servizio segnala uno stato diverso dal servizio \_ in esecuzione, gli strumenti SCM o di monitoraggio dei servizi potrebbero contrassegnare il servizio come non avviato.</span><span class="sxs-lookup"><span data-stu-id="5fd59-113">If the service reports a state other than SERVICE\_RUNNING, the SCM or service-monitoring tools might mark the service as having failed to start.</span></span>

<span data-ttu-id="5fd59-114">SCM invia al servizio solo le richieste di controllo specificate, ad eccezione della richiesta di \_ interrogazione del controllo del servizio \_ , che viene sempre inviata.</span><span class="sxs-lookup"><span data-stu-id="5fd59-114">The SCM sends only the specified control requests to the service (except for the SERVICE\_CONTROL\_INTERROGATE request, which is always sent).</span></span> <span data-ttu-id="5fd59-115">Per un elenco delle richieste di controllo che un servizio può accettare, vedere il membro **dwControlsAccepted** della struttura [**\_ dello stato del servizio**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) .</span><span class="sxs-lookup"><span data-stu-id="5fd59-115">For a list of the control requests that a service can accept, see the **dwControlsAccepted** member of the [**SERVICE\_STATUS**](/windows/desktop/api/Winsvc/ns-winsvc-service_status) structure.</span></span> <span data-ttu-id="5fd59-116">Per informazioni sulla registrazione per la ricezione di eventi del dispositivo, vedere la funzione [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) .</span><span class="sxs-lookup"><span data-stu-id="5fd59-116">For information about registering to receive device events, see the [**RegisterDeviceNotification**](/windows/desktop/api/winuser/nf-winuser-registerdevicenotificationa) function.</span></span>

<span data-ttu-id="5fd59-117">Lo stato del servizio cambia in genere in seguito alla gestione di una richiesta di controllo.</span><span class="sxs-lookup"><span data-stu-id="5fd59-117">The service state typically changes as a result of handling a control request.</span></span> <span data-ttu-id="5fd59-118">Le richieste di controllo che provocano la modifica dello stato del servizio includono l'arresto del controllo del servizio, la sospensione del controllo del servizio \_ e il \_ controllo del \_ \_ servizio \_ \_ continuano</span><span class="sxs-lookup"><span data-stu-id="5fd59-118">Control requests that cause the service state to change include SERVICE\_CONTROL\_STOP, SERVICE\_CONTROL\_PAUSE, and SERVICE\_CONTROL\_CONTINUE.</span></span> <span data-ttu-id="5fd59-119">Se il servizio deve eseguire un'elaborazione lunga per gestire una di queste richieste, deve creare un thread secondario per eseguire l'elaborazione lunga e segnalare lo stato in sospeso corrispondente a SCM.</span><span class="sxs-lookup"><span data-stu-id="5fd59-119">If the service must do lengthy processing to handle any of these requests, it should create a secondary thread to perform the lengthy processing and report the corresponding pending state to the SCM.</span></span> <span data-ttu-id="5fd59-120">Per prestazioni ottimali in Windows Vista e versioni successive di Windows, il servizio deve usare un thread di lavoro da un [pool di thread](/windows/desktop/ProcThread/thread-pools) a questo scopo. Il servizio deve quindi segnalare la transizione di stato completata al termine dell'elaborazione di lunga durata.</span><span class="sxs-lookup"><span data-stu-id="5fd59-120">(For best performance on Windows Vista and later versions of Windows, the service should use a worker thread from a [thread pool](/windows/desktop/ProcThread/thread-pools) for this purpose.) The service should then report the completed state transition when the lengthy processing is finished.</span></span> <span data-ttu-id="5fd59-121">Per ulteriori informazioni sulla gestione delle richieste di controllo, vedere [funzione del gestore di controllo del servizio](service-control-handler-function.md).</span><span class="sxs-lookup"><span data-stu-id="5fd59-121">For more information about handling control requests, see [Service Control Handler Function](service-control-handler-function.md).</span></span>

<span data-ttu-id="5fd59-122">Sono valide solo alcune transizioni di stato del servizio.</span><span class="sxs-lookup"><span data-stu-id="5fd59-122">Only certain service state transitions are valid.</span></span> <span data-ttu-id="5fd59-123">Nel diagramma seguente vengono illustrate le transizioni valide.</span><span class="sxs-lookup"><span data-stu-id="5fd59-123">The following diagram shows the valid transitions.</span></span>

![transizioni di stato del servizio valide](images/service-status-transitions.png)

<span data-ttu-id="5fd59-125">Lo stato del servizio segnalato a SCM determina il modo in cui SCM interagisce con il servizio.</span><span class="sxs-lookup"><span data-stu-id="5fd59-125">The service state reported to the SCM determines how the SCM interacts with the service.</span></span> <span data-ttu-id="5fd59-126">Se, ad esempio, un servizio segnala l'arresto del servizio \_ \_ in sospeso, SCM non trasmette ulteriori richieste di controllo al servizio perché questo stato indica che il servizio è in fase di chiusura.</span><span class="sxs-lookup"><span data-stu-id="5fd59-126">For example, if a service reports SERVICE\_STOP\_PENDING, the SCM does not transmit further control requests to the service because this state indicates that the service is shutting down.</span></span> <span data-ttu-id="5fd59-127">Lo stato successivo segnalato dal servizio deve essere arrestato dal servizio \_ perché è l'unico stato valido dopo l'arresto del servizio \_ \_ in sospeso.</span><span class="sxs-lookup"><span data-stu-id="5fd59-127">The next state reported by the service should be SERVICE\_STOPPED because that is the only valid state after SERVICE\_STOP\_PENDING.</span></span> <span data-ttu-id="5fd59-128">Tuttavia, se un servizio segnala una transizione non valida, SCM non ha esito negativo per la chiamata.</span><span class="sxs-lookup"><span data-stu-id="5fd59-128">However, if a service reports a transition that is not valid, the SCM does not fail the call.</span></span>

<span data-ttu-id="5fd59-129">Il diagramma seguente mostra le transizioni dello stato del servizio in modo più dettagliato, incluse le richieste di controllo avviate da un programma di controllo del servizio (il client del servizio) e le chiamate [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) che un servizio esegue per segnalare le modifiche di stato a SCM.</span><span class="sxs-lookup"><span data-stu-id="5fd59-129">The following diagram shows service state transitions in more detail, including the control requests initiated by a service control program (the service client) and the [**SetServiceStatus**](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus) calls that a service makes to report state changes to the SCM.</span></span> <span data-ttu-id="5fd59-130">Come indicato in precedenza, SCM Invia solo le richieste di controllo che il servizio ha specificato di accettare, quindi un servizio potrebbe non ricevere tutte le richieste visualizzate nel diagramma.</span><span class="sxs-lookup"><span data-stu-id="5fd59-130">As mentioned earlier, the SCM sends only control requests that the service has specified it will accept, so a service might not receive all of the requests shown in the diagram.</span></span>

![<span data-ttu-id="5fd59-131">informazioni dettagliate sulle transizioni di stato del servizio</span><span class="sxs-lookup"><span data-stu-id="5fd59-131">service status transitions in detail</span></span> ](images/service-status-flow-diagram.png)

## <a name="related-topics"></a><span data-ttu-id="5fd59-132">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="5fd59-132">Related topics</span></span>

<dl> <dt>

[<span data-ttu-id="5fd59-133">**ControlService**</span><span class="sxs-lookup"><span data-stu-id="5fd59-133">**ControlService**</span></span>](/windows/desktop/api/Winsvc/nf-winsvc-controlservice)
</dt> <dt>

[<span data-ttu-id="5fd59-134">**ControlServiceEx**</span><span class="sxs-lookup"><span data-stu-id="5fd59-134">**ControlServiceEx**</span></span>](/windows/desktop/api/Winsvc/nf-winsvc-controlserviceexa)
</dt> <dt>

[<span data-ttu-id="5fd59-135">**SetServiceStatus**</span><span class="sxs-lookup"><span data-stu-id="5fd59-135">**SetServiceStatus**</span></span>](/windows/desktop/api/Winsvc/nf-winsvc-setservicestatus)
</dt> </dl>

 

 
